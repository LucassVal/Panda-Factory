var CW=Object.defineProperty;var EW=(t,e,n)=>e in t?CW(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var b=(t,e,n)=>EW(t,typeof e!="symbol"?e+"":e,n);function TW(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in t)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(t,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=n(i);fetch(i.href,r)}})();var qn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var eO={exports:{}},lx={},tO={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Qp=Symbol.for("react.element"),IW=Symbol.for("react.portal"),PW=Symbol.for("react.fragment"),kW=Symbol.for("react.strict_mode"),jW=Symbol.for("react.profiler"),NW=Symbol.for("react.provider"),AW=Symbol.for("react.context"),RW=Symbol.for("react.forward_ref"),MW=Symbol.for("react.suspense"),OW=Symbol.for("react.memo"),DW=Symbol.for("react.lazy"),TP=Symbol.iterator;function LW(t){return t===null||typeof t!="object"?null:(t=TP&&t[TP]||t["@@iterator"],typeof t=="function"?t:null)}var nO={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},sO=Object.assign,iO={};function qd(t,e,n){this.props=t,this.context=e,this.refs=iO,this.updater=n||nO}qd.prototype.isReactComponent={};qd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};qd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function rO(){}rO.prototype=qd.prototype;function sE(t,e,n){this.props=t,this.context=e,this.refs=iO,this.updater=n||nO}var iE=sE.prototype=new rO;iE.constructor=sE;sO(iE,qd.prototype);iE.isPureReactComponent=!0;var IP=Array.isArray,oO=Object.prototype.hasOwnProperty,rE={current:null},aO={key:!0,ref:!0,__self:!0,__source:!0};function lO(t,e,n){var s,i={},r=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)oO.call(e,s)&&!aO.hasOwnProperty(s)&&(i[s]=e[s]);var l=arguments.length-2;if(l===1)i.children=n;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}if(t&&t.defaultProps)for(s in l=t.defaultProps,l)i[s]===void 0&&(i[s]=l[s]);return{$$typeof:Qp,type:t,key:r,ref:o,props:i,_owner:rE.current}}function FW(t,e){return{$$typeof:Qp,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function oE(t){return typeof t=="object"&&t!==null&&t.$$typeof===Qp}function BW(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var PP=/\/+/g;function XS(t,e){return typeof t=="object"&&t!==null&&t.key!=null?BW(""+t.key):e.toString(36)}function um(t,e,n,s,i){var r=typeof t;(r==="undefined"||r==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Qp:case IW:o=!0}}if(o)return o=t,i=i(o),t=s===""?"."+XS(o,0):s,IP(i)?(n="",t!=null&&(n=t.replace(PP,"$&/")+"/"),um(i,e,n,"",function(d){return d})):i!=null&&(oE(i)&&(i=FW(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(PP,"$&/")+"/")+t)),e.push(i)),1;if(o=0,s=s===""?".":s+":",IP(t))for(var l=0;l<t.length;l++){r=t[l];var c=s+XS(r,l);o+=um(r,e,n,c,i)}else if(c=LW(t),typeof c=="function")for(t=c.call(t),l=0;!(r=t.next()).done;)r=r.value,c=s+XS(r,l++),o+=um(r,e,n,c,i);else if(r==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Jf(t,e,n){if(t==null)return t;var s=[],i=0;return um(t,s,"","",function(r){return e.call(n,r,i++)}),s}function UW(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ms={current:null},hm={transition:null},$W={ReactCurrentDispatcher:ms,ReactCurrentBatchConfig:hm,ReactCurrentOwner:rE};function cO(){throw Error("act(...) is not supported in production builds of React.")}He.Children={map:Jf,forEach:function(t,e,n){Jf(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Jf(t,function(){e++}),e},toArray:function(t){return Jf(t,function(e){return e})||[]},only:function(t){if(!oE(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};He.Component=qd;He.Fragment=PW;He.Profiler=jW;He.PureComponent=sE;He.StrictMode=kW;He.Suspense=MW;He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$W;He.act=cO;He.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=sO({},t.props),i=t.key,r=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=rE.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(c in e)oO.call(e,c)&&!aO.hasOwnProperty(c)&&(s[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)s.children=n;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}return{$$typeof:Qp,type:t.type,key:i,ref:r,props:s,_owner:o}};He.createContext=function(t){return t={$$typeof:AW,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:NW,_context:t},t.Consumer=t};He.createElement=lO;He.createFactory=function(t){var e=lO.bind(null,t);return e.type=t,e};He.createRef=function(){return{current:null}};He.forwardRef=function(t){return{$$typeof:RW,render:t}};He.isValidElement=oE;He.lazy=function(t){return{$$typeof:DW,_payload:{_status:-1,_result:t},_init:UW}};He.memo=function(t,e){return{$$typeof:OW,type:t,compare:e===void 0?null:e}};He.startTransition=function(t){var e=hm.transition;hm.transition={};try{t()}finally{hm.transition=e}};He.unstable_act=cO;He.useCallback=function(t,e){return ms.current.useCallback(t,e)};He.useContext=function(t){return ms.current.useContext(t)};He.useDebugValue=function(){};He.useDeferredValue=function(t){return ms.current.useDeferredValue(t)};He.useEffect=function(t,e){return ms.current.useEffect(t,e)};He.useId=function(){return ms.current.useId()};He.useImperativeHandle=function(t,e,n){return ms.current.useImperativeHandle(t,e,n)};He.useInsertionEffect=function(t,e){return ms.current.useInsertionEffect(t,e)};He.useLayoutEffect=function(t,e){return ms.current.useLayoutEffect(t,e)};He.useMemo=function(t,e){return ms.current.useMemo(t,e)};He.useReducer=function(t,e,n){return ms.current.useReducer(t,e,n)};He.useRef=function(t){return ms.current.useRef(t)};He.useState=function(t){return ms.current.useState(t)};He.useSyncExternalStore=function(t,e,n){return ms.current.useSyncExternalStore(t,e,n)};He.useTransition=function(){return ms.current.useTransition()};He.version="18.3.1";tO.exports=He;var S=tO.exports;const Oe=qa(S),dO=TW({__proto__:null,default:Oe},[S]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zW=S,WW=Symbol.for("react.element"),HW=Symbol.for("react.fragment"),GW=Object.prototype.hasOwnProperty,VW=zW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,KW={key:!0,ref:!0,__self:!0,__source:!0};function uO(t,e,n){var s,i={},r=null,o=null;n!==void 0&&(r=""+n),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)GW.call(e,s)&&!KW.hasOwnProperty(s)&&(i[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:WW,type:t,key:r,ref:o,props:i,_owner:VW.current}}lx.Fragment=HW;lx.jsx=uO;lx.jsxs=uO;eO.exports=lx;var a=eO.exports,k0={},hO={exports:{}},li={},pO={exports:{}},fO={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(M,D){var U=M.length;M.push(D);e:for(;0<U;){var z=U-1>>>1,H=M[z];if(0<i(H,D))M[z]=D,M[U]=H,U=z;else break e}}function n(M){return M.length===0?null:M[0]}function s(M){if(M.length===0)return null;var D=M[0],U=M.pop();if(U!==D){M[0]=U;e:for(var z=0,H=M.length,q=H>>>1;z<q;){var V=2*(z+1)-1,ee=M[V],Q=V+1,ae=M[Q];if(0>i(ee,U))Q<H&&0>i(ae,ee)?(M[z]=ae,M[Q]=U,z=Q):(M[z]=ee,M[V]=U,z=V);else if(Q<H&&0>i(ae,U))M[z]=ae,M[Q]=U,z=Q;else break e}}return D}function i(M,D){var U=M.sortIndex-D.sortIndex;return U!==0?U:M.id-D.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;t.unstable_now=function(){return r.now()}}else{var o=Date,l=o.now();t.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,p=3,f=!1,g=!1,y=!1,x=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,v=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(M){for(var D=n(d);D!==null;){if(D.callback===null)s(d);else if(D.startTime<=M)s(d),D.sortIndex=D.expirationTime,e(c,D);else break;D=n(d)}}function _(M){if(y=!1,w(M),!g)if(n(c)!==null)g=!0,L(C);else{var D=n(d);D!==null&&$(_,D.startTime-M)}}function C(M,D){g=!1,y&&(y=!1,m(P),P=-1),f=!0;var U=p;try{for(w(D),h=n(c);h!==null&&(!(h.expirationTime>D)||M&&!O());){var z=h.callback;if(typeof z=="function"){h.callback=null,p=h.priorityLevel;var H=z(h.expirationTime<=D);D=t.unstable_now(),typeof H=="function"?h.callback=H:h===n(c)&&s(c),w(D)}else s(c);h=n(c)}if(h!==null)var q=!0;else{var V=n(d);V!==null&&$(_,V.startTime-D),q=!1}return q}finally{h=null,p=U,f=!1}}var I=!1,T=null,P=-1,k=5,N=-1;function O(){return!(t.unstable_now()-N<k)}function R(){if(T!==null){var M=t.unstable_now();N=M;var D=!0;try{D=T(!0,M)}finally{D?j():(I=!1,T=null)}}else I=!1}var j;if(typeof v=="function")j=function(){v(R)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,B=A.port2;A.port1.onmessage=R,j=function(){B.postMessage(null)}}else j=function(){x(R,0)};function L(M){T=M,I||(I=!0,j())}function $(M,D){P=x(function(){M(t.unstable_now())},D)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(M){M.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,L(C))},t.unstable_forceFrameRate=function(M){0>M||125<M?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<M?Math.floor(1e3/M):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(M){switch(p){case 1:case 2:case 3:var D=3;break;default:D=p}var U=p;p=D;try{return M()}finally{p=U}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(M,D){switch(M){case 1:case 2:case 3:case 4:case 5:break;default:M=3}var U=p;p=M;try{return D()}finally{p=U}},t.unstable_scheduleCallback=function(M,D,U){var z=t.unstable_now();switch(typeof U=="object"&&U!==null?(U=U.delay,U=typeof U=="number"&&0<U?z+U:z):U=z,M){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=U+H,M={id:u++,callback:D,priorityLevel:M,startTime:U,expirationTime:H,sortIndex:-1},U>z?(M.sortIndex=U,e(d,M),n(c)===null&&M===n(d)&&(y?(m(P),P=-1):y=!0,$(_,U-z))):(M.sortIndex=H,e(c,M),g||f||(g=!0,L(C))),M},t.unstable_shouldYield=O,t.unstable_wrapCallback=function(M){var D=p;return function(){var U=p;p=D;try{return M.apply(this,arguments)}finally{p=U}}}})(fO);pO.exports=fO;var YW=pO.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var XW=S,ri=YW;function ie(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var gO=new Set,ip={};function ac(t,e){Cd(t,e),Cd(t+"Capture",e)}function Cd(t,e){for(ip[t]=e,t=0;t<e.length;t++)gO.add(e[t])}var To=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),j0=Object.prototype.hasOwnProperty,qW=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,kP={},jP={};function ZW(t){return j0.call(jP,t)?!0:j0.call(kP,t)?!1:qW.test(t)?jP[t]=!0:(kP[t]=!0,!1)}function JW(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function QW(t,e,n,s){if(e===null||typeof e>"u"||JW(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ys(t,e,n,s,i,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var Rn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Rn[t]=new ys(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Rn[e]=new ys(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Rn[t]=new ys(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Rn[t]=new ys(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Rn[t]=new ys(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Rn[t]=new ys(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Rn[t]=new ys(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Rn[t]=new ys(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Rn[t]=new ys(t,5,!1,t.toLowerCase(),null,!1,!1)});var aE=/[\-:]([a-z])/g;function lE(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(aE,lE);Rn[e]=new ys(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(aE,lE);Rn[e]=new ys(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(aE,lE);Rn[e]=new ys(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Rn[t]=new ys(t,1,!1,t.toLowerCase(),null,!1,!1)});Rn.xlinkHref=new ys("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Rn[t]=new ys(t,1,!1,t.toLowerCase(),null,!0,!0)});function cE(t,e,n,s){var i=Rn.hasOwnProperty(e)?Rn[e]:null;(i!==null?i.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(QW(e,n,i,s)&&(n=null),s||i===null?ZW(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,s=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var Bo=XW.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Qf=Symbol.for("react.element"),Lc=Symbol.for("react.portal"),Fc=Symbol.for("react.fragment"),dE=Symbol.for("react.strict_mode"),N0=Symbol.for("react.profiler"),mO=Symbol.for("react.provider"),yO=Symbol.for("react.context"),uE=Symbol.for("react.forward_ref"),A0=Symbol.for("react.suspense"),R0=Symbol.for("react.suspense_list"),hE=Symbol.for("react.memo"),aa=Symbol.for("react.lazy"),vO=Symbol.for("react.offscreen"),NP=Symbol.iterator;function Eu(t){return t===null||typeof t!="object"?null:(t=NP&&t[NP]||t["@@iterator"],typeof t=="function"?t:null)}var Lt=Object.assign,qS;function oh(t){if(qS===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);qS=e&&e[1]||""}return`
`+qS+t}var ZS=!1;function JS(t,e){if(!t||ZS)return"";ZS=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var s=d}Reflect.construct(t,[],e)}else{try{e.call()}catch(d){s=d}t.call(e.prototype)}else{try{throw Error()}catch(d){s=d}t()}}catch(d){if(d&&s&&typeof d.stack=="string"){for(var i=d.stack.split(`
`),r=s.stack.split(`
`),o=i.length-1,l=r.length-1;1<=o&&0<=l&&i[o]!==r[l];)l--;for(;1<=o&&0<=l;o--,l--)if(i[o]!==r[l]){if(o!==1||l!==1)do if(o--,l--,0>l||i[o]!==r[l]){var c=`
`+i[o].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=o&&0<=l);break}}}finally{ZS=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?oh(t):""}function e9(t){switch(t.tag){case 5:return oh(t.type);case 16:return oh("Lazy");case 13:return oh("Suspense");case 19:return oh("SuspenseList");case 0:case 2:case 15:return t=JS(t.type,!1),t;case 11:return t=JS(t.type.render,!1),t;case 1:return t=JS(t.type,!0),t;default:return""}}function M0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Fc:return"Fragment";case Lc:return"Portal";case N0:return"Profiler";case dE:return"StrictMode";case A0:return"Suspense";case R0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case yO:return(t.displayName||"Context")+".Consumer";case mO:return(t._context.displayName||"Context")+".Provider";case uE:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case hE:return e=t.displayName||null,e!==null?e:M0(t.type)||"Memo";case aa:e=t._payload,t=t._init;try{return M0(t(e))}catch{}}return null}function t9(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return M0(e);case 8:return e===dE?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ua(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function xO(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function n9(t){var e=xO(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,r=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){s=""+o,r.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function eg(t){t._valueTracker||(t._valueTracker=n9(t))}function SO(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=xO(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function yy(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function O0(t,e){var n=e.checked;return Lt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function AP(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=Ua(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function bO(t,e){e=e.checked,e!=null&&cE(t,"checked",e,!1)}function D0(t,e){bO(t,e);var n=Ua(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?L0(t,e.type,n):e.hasOwnProperty("defaultValue")&&L0(t,e.type,Ua(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function RP(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function L0(t,e,n){(e!=="number"||yy(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var ah=Array.isArray;function ad(t,e,n,s){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&s&&(t[n].defaultSelected=!0)}else{for(n=""+Ua(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,s&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function F0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ie(91));return Lt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function MP(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(ie(92));if(ah(n)){if(1<n.length)throw Error(ie(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ua(n)}}function wO(t,e){var n=Ua(e.value),s=Ua(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function OP(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function _O(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function B0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?_O(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var tg,CO=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(tg=tg||document.createElement("div"),tg.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=tg.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function rp(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Rh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},s9=["Webkit","ms","Moz","O"];Object.keys(Rh).forEach(function(t){s9.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Rh[e]=Rh[t]})});function EO(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Rh.hasOwnProperty(t)&&Rh[t]?(""+e).trim():e+"px"}function TO(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,i=EO(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,i):t[n]=i}}var i9=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function U0(t,e){if(e){if(i9[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ie(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ie(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ie(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ie(62))}}function $0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var z0=null;function pE(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var W0=null,ld=null,cd=null;function DP(t){if(t=nf(t)){if(typeof W0!="function")throw Error(ie(280));var e=t.stateNode;e&&(e=px(e),W0(t.stateNode,t.type,e))}}function IO(t){ld?cd?cd.push(t):cd=[t]:ld=t}function PO(){if(ld){var t=ld,e=cd;if(cd=ld=null,DP(t),e)for(t=0;t<e.length;t++)DP(e[t])}}function kO(t,e){return t(e)}function jO(){}var QS=!1;function NO(t,e,n){if(QS)return t(e,n);QS=!0;try{return kO(t,e,n)}finally{QS=!1,(ld!==null||cd!==null)&&(jO(),PO())}}function op(t,e){var n=t.stateNode;if(n===null)return null;var s=px(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(ie(231,e,typeof n));return n}var H0=!1;if(To)try{var Tu={};Object.defineProperty(Tu,"passive",{get:function(){H0=!0}}),window.addEventListener("test",Tu,Tu),window.removeEventListener("test",Tu,Tu)}catch{H0=!1}function r9(t,e,n,s,i,r,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(n,d)}catch(u){this.onError(u)}}var Mh=!1,vy=null,xy=!1,G0=null,o9={onError:function(t){Mh=!0,vy=t}};function a9(t,e,n,s,i,r,o,l,c){Mh=!1,vy=null,r9.apply(o9,arguments)}function l9(t,e,n,s,i,r,o,l,c){if(a9.apply(this,arguments),Mh){if(Mh){var d=vy;Mh=!1,vy=null}else throw Error(ie(198));xy||(xy=!0,G0=d)}}function lc(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function AO(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function LP(t){if(lc(t)!==t)throw Error(ie(188))}function c9(t){var e=t.alternate;if(!e){if(e=lc(t),e===null)throw Error(ie(188));return e!==t?null:t}for(var n=t,s=e;;){var i=n.return;if(i===null)break;var r=i.alternate;if(r===null){if(s=i.return,s!==null){n=s;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===n)return LP(i),t;if(r===s)return LP(i),e;r=r.sibling}throw Error(ie(188))}if(n.return!==s.return)n=i,s=r;else{for(var o=!1,l=i.child;l;){if(l===n){o=!0,n=i,s=r;break}if(l===s){o=!0,s=i,n=r;break}l=l.sibling}if(!o){for(l=r.child;l;){if(l===n){o=!0,n=r,s=i;break}if(l===s){o=!0,s=r,n=i;break}l=l.sibling}if(!o)throw Error(ie(189))}}if(n.alternate!==s)throw Error(ie(190))}if(n.tag!==3)throw Error(ie(188));return n.stateNode.current===n?t:e}function RO(t){return t=c9(t),t!==null?MO(t):null}function MO(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=MO(t);if(e!==null)return e;t=t.sibling}return null}var OO=ri.unstable_scheduleCallback,FP=ri.unstable_cancelCallback,d9=ri.unstable_shouldYield,u9=ri.unstable_requestPaint,Vt=ri.unstable_now,h9=ri.unstable_getCurrentPriorityLevel,fE=ri.unstable_ImmediatePriority,DO=ri.unstable_UserBlockingPriority,Sy=ri.unstable_NormalPriority,p9=ri.unstable_LowPriority,LO=ri.unstable_IdlePriority,cx=null,Nr=null;function f9(t){if(Nr&&typeof Nr.onCommitFiberRoot=="function")try{Nr.onCommitFiberRoot(cx,t,void 0,(t.current.flags&128)===128)}catch{}}var qi=Math.clz32?Math.clz32:y9,g9=Math.log,m9=Math.LN2;function y9(t){return t>>>=0,t===0?32:31-(g9(t)/m9|0)|0}var ng=64,sg=4194304;function lh(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function by(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,i=t.suspendedLanes,r=t.pingedLanes,o=n&268435455;if(o!==0){var l=o&~i;l!==0?s=lh(l):(r&=o,r!==0&&(s=lh(r)))}else o=n&~i,o!==0?s=lh(o):r!==0&&(s=lh(r));if(s===0)return 0;if(e!==0&&e!==s&&!(e&i)&&(i=s&-s,r=e&-e,i>=r||i===16&&(r&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-qi(e),i=1<<n,s|=t[n],e&=~i;return s}function v9(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function x9(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,i=t.expirationTimes,r=t.pendingLanes;0<r;){var o=31-qi(r),l=1<<o,c=i[o];c===-1?(!(l&n)||l&s)&&(i[o]=v9(l,e)):c<=e&&(t.expiredLanes|=l),r&=~l}}function V0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function FO(){var t=ng;return ng<<=1,!(ng&4194240)&&(ng=64),t}function eb(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ef(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-qi(e),t[e]=n}function S9(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-qi(n),r=1<<i;e[i]=0,s[i]=-1,t[i]=-1,n&=~r}}function gE(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-qi(n),i=1<<s;i&e|t[s]&e&&(t[s]|=e),n&=~i}}var rt=0;function BO(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var UO,mE,$O,zO,WO,K0=!1,ig=[],_a=null,Ca=null,Ea=null,ap=new Map,lp=new Map,ca=[],b9="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function BP(t,e){switch(t){case"focusin":case"focusout":_a=null;break;case"dragenter":case"dragleave":Ca=null;break;case"mouseover":case"mouseout":Ea=null;break;case"pointerover":case"pointerout":ap.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":lp.delete(e.pointerId)}}function Iu(t,e,n,s,i,r){return t===null||t.nativeEvent!==r?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:r,targetContainers:[i]},e!==null&&(e=nf(e),e!==null&&mE(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function w9(t,e,n,s,i){switch(e){case"focusin":return _a=Iu(_a,t,e,n,s,i),!0;case"dragenter":return Ca=Iu(Ca,t,e,n,s,i),!0;case"mouseover":return Ea=Iu(Ea,t,e,n,s,i),!0;case"pointerover":var r=i.pointerId;return ap.set(r,Iu(ap.get(r)||null,t,e,n,s,i)),!0;case"gotpointercapture":return r=i.pointerId,lp.set(r,Iu(lp.get(r)||null,t,e,n,s,i)),!0}return!1}function HO(t){var e=Tl(t.target);if(e!==null){var n=lc(e);if(n!==null){if(e=n.tag,e===13){if(e=AO(n),e!==null){t.blockedOn=e,WO(t.priority,function(){$O(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function pm(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Y0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);z0=s,n.target.dispatchEvent(s),z0=null}else return e=nf(n),e!==null&&mE(e),t.blockedOn=n,!1;e.shift()}return!0}function UP(t,e,n){pm(t)&&n.delete(e)}function _9(){K0=!1,_a!==null&&pm(_a)&&(_a=null),Ca!==null&&pm(Ca)&&(Ca=null),Ea!==null&&pm(Ea)&&(Ea=null),ap.forEach(UP),lp.forEach(UP)}function Pu(t,e){t.blockedOn===e&&(t.blockedOn=null,K0||(K0=!0,ri.unstable_scheduleCallback(ri.unstable_NormalPriority,_9)))}function cp(t){function e(i){return Pu(i,t)}if(0<ig.length){Pu(ig[0],t);for(var n=1;n<ig.length;n++){var s=ig[n];s.blockedOn===t&&(s.blockedOn=null)}}for(_a!==null&&Pu(_a,t),Ca!==null&&Pu(Ca,t),Ea!==null&&Pu(Ea,t),ap.forEach(e),lp.forEach(e),n=0;n<ca.length;n++)s=ca[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<ca.length&&(n=ca[0],n.blockedOn===null);)HO(n),n.blockedOn===null&&ca.shift()}var dd=Bo.ReactCurrentBatchConfig,wy=!0;function C9(t,e,n,s){var i=rt,r=dd.transition;dd.transition=null;try{rt=1,yE(t,e,n,s)}finally{rt=i,dd.transition=r}}function E9(t,e,n,s){var i=rt,r=dd.transition;dd.transition=null;try{rt=4,yE(t,e,n,s)}finally{rt=i,dd.transition=r}}function yE(t,e,n,s){if(wy){var i=Y0(t,e,n,s);if(i===null)db(t,e,s,_y,n),BP(t,s);else if(w9(i,t,e,n,s))s.stopPropagation();else if(BP(t,s),e&4&&-1<b9.indexOf(t)){for(;i!==null;){var r=nf(i);if(r!==null&&UO(r),r=Y0(t,e,n,s),r===null&&db(t,e,s,_y,n),r===i)break;i=r}i!==null&&s.stopPropagation()}else db(t,e,s,null,n)}}var _y=null;function Y0(t,e,n,s){if(_y=null,t=pE(s),t=Tl(t),t!==null)if(e=lc(t),e===null)t=null;else if(n=e.tag,n===13){if(t=AO(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return _y=t,null}function GO(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(h9()){case fE:return 1;case DO:return 4;case Sy:case p9:return 16;case LO:return 536870912;default:return 16}default:return 16}}var ma=null,vE=null,fm=null;function VO(){if(fm)return fm;var t,e=vE,n=e.length,s,i="value"in ma?ma.value:ma.textContent,r=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(s=1;s<=o&&e[n-s]===i[r-s];s++);return fm=i.slice(t,1<s?1-s:void 0)}function gm(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function rg(){return!0}function $P(){return!1}function ci(t){function e(n,s,i,r,o){this._reactName=n,this._targetInst=i,this.type=s,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(r):r[l]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?rg:$P,this.isPropagationStopped=$P,this}return Lt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=rg)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=rg)},persist:function(){},isPersistent:rg}),e}var Zd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xE=ci(Zd),tf=Lt({},Zd,{view:0,detail:0}),T9=ci(tf),tb,nb,ku,dx=Lt({},tf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:SE,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ku&&(ku&&t.type==="mousemove"?(tb=t.screenX-ku.screenX,nb=t.screenY-ku.screenY):nb=tb=0,ku=t),tb)},movementY:function(t){return"movementY"in t?t.movementY:nb}}),zP=ci(dx),I9=Lt({},dx,{dataTransfer:0}),P9=ci(I9),k9=Lt({},tf,{relatedTarget:0}),sb=ci(k9),j9=Lt({},Zd,{animationName:0,elapsedTime:0,pseudoElement:0}),N9=ci(j9),A9=Lt({},Zd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),R9=ci(A9),M9=Lt({},Zd,{data:0}),WP=ci(M9),O9={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},D9={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},L9={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function F9(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=L9[t])?!!e[t]:!1}function SE(){return F9}var B9=Lt({},tf,{key:function(t){if(t.key){var e=O9[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=gm(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?D9[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:SE,charCode:function(t){return t.type==="keypress"?gm(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?gm(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),U9=ci(B9),$9=Lt({},dx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),HP=ci($9),z9=Lt({},tf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:SE}),W9=ci(z9),H9=Lt({},Zd,{propertyName:0,elapsedTime:0,pseudoElement:0}),G9=ci(H9),V9=Lt({},dx,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),K9=ci(V9),Y9=[9,13,27,32],bE=To&&"CompositionEvent"in window,Oh=null;To&&"documentMode"in document&&(Oh=document.documentMode);var X9=To&&"TextEvent"in window&&!Oh,KO=To&&(!bE||Oh&&8<Oh&&11>=Oh),GP=" ",VP=!1;function YO(t,e){switch(t){case"keyup":return Y9.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XO(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Bc=!1;function q9(t,e){switch(t){case"compositionend":return XO(e);case"keypress":return e.which!==32?null:(VP=!0,GP);case"textInput":return t=e.data,t===GP&&VP?null:t;default:return null}}function Z9(t,e){if(Bc)return t==="compositionend"||!bE&&YO(t,e)?(t=VO(),fm=vE=ma=null,Bc=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return KO&&e.locale!=="ko"?null:e.data;default:return null}}var J9={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function KP(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!J9[t.type]:e==="textarea"}function qO(t,e,n,s){IO(s),e=Cy(e,"onChange"),0<e.length&&(n=new xE("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var Dh=null,dp=null;function Q9(t){aD(t,0)}function ux(t){var e=zc(t);if(SO(e))return t}function eH(t,e){if(t==="change")return e}var ZO=!1;if(To){var ib;if(To){var rb="oninput"in document;if(!rb){var YP=document.createElement("div");YP.setAttribute("oninput","return;"),rb=typeof YP.oninput=="function"}ib=rb}else ib=!1;ZO=ib&&(!document.documentMode||9<document.documentMode)}function XP(){Dh&&(Dh.detachEvent("onpropertychange",JO),dp=Dh=null)}function JO(t){if(t.propertyName==="value"&&ux(dp)){var e=[];qO(e,dp,t,pE(t)),NO(Q9,e)}}function tH(t,e,n){t==="focusin"?(XP(),Dh=e,dp=n,Dh.attachEvent("onpropertychange",JO)):t==="focusout"&&XP()}function nH(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ux(dp)}function sH(t,e){if(t==="click")return ux(e)}function iH(t,e){if(t==="input"||t==="change")return ux(e)}function rH(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var nr=typeof Object.is=="function"?Object.is:rH;function up(t,e){if(nr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var i=n[s];if(!j0.call(e,i)||!nr(t[i],e[i]))return!1}return!0}function qP(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ZP(t,e){var n=qP(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=qP(n)}}function QO(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?QO(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function eD(){for(var t=window,e=yy();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=yy(t.document)}return e}function wE(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function oH(t){var e=eD(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&QO(n.ownerDocument.documentElement,n)){if(s!==null&&wE(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,r=Math.min(s.start,i);s=s.end===void 0?r:Math.min(s.end,i),!t.extend&&r>s&&(i=s,s=r,r=i),i=ZP(n,r);var o=ZP(n,s);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),r>s?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var aH=To&&"documentMode"in document&&11>=document.documentMode,Uc=null,X0=null,Lh=null,q0=!1;function JP(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;q0||Uc==null||Uc!==yy(s)||(s=Uc,"selectionStart"in s&&wE(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),Lh&&up(Lh,s)||(Lh=s,s=Cy(X0,"onSelect"),0<s.length&&(e=new xE("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=Uc)))}function og(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var $c={animationend:og("Animation","AnimationEnd"),animationiteration:og("Animation","AnimationIteration"),animationstart:og("Animation","AnimationStart"),transitionend:og("Transition","TransitionEnd")},ob={},tD={};To&&(tD=document.createElement("div").style,"AnimationEvent"in window||(delete $c.animationend.animation,delete $c.animationiteration.animation,delete $c.animationstart.animation),"TransitionEvent"in window||delete $c.transitionend.transition);function hx(t){if(ob[t])return ob[t];if(!$c[t])return t;var e=$c[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in tD)return ob[t]=e[n];return t}var nD=hx("animationend"),sD=hx("animationiteration"),iD=hx("animationstart"),rD=hx("transitionend"),oD=new Map,QP="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Za(t,e){oD.set(t,e),ac(e,[t])}for(var ab=0;ab<QP.length;ab++){var lb=QP[ab],lH=lb.toLowerCase(),cH=lb[0].toUpperCase()+lb.slice(1);Za(lH,"on"+cH)}Za(nD,"onAnimationEnd");Za(sD,"onAnimationIteration");Za(iD,"onAnimationStart");Za("dblclick","onDoubleClick");Za("focusin","onFocus");Za("focusout","onBlur");Za(rD,"onTransitionEnd");Cd("onMouseEnter",["mouseout","mouseover"]);Cd("onMouseLeave",["mouseout","mouseover"]);Cd("onPointerEnter",["pointerout","pointerover"]);Cd("onPointerLeave",["pointerout","pointerover"]);ac("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ac("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ac("onBeforeInput",["compositionend","keypress","textInput","paste"]);ac("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ac("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ac("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ch="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dH=new Set("cancel close invalid load scroll toggle".split(" ").concat(ch));function ek(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,l9(s,e,void 0,t),t.currentTarget=null}function aD(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],i=s.event;s=s.listeners;e:{var r=void 0;if(e)for(var o=s.length-1;0<=o;o--){var l=s[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==r&&i.isPropagationStopped())break e;ek(i,l,d),r=c}else for(o=0;o<s.length;o++){if(l=s[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==r&&i.isPropagationStopped())break e;ek(i,l,d),r=c}}}if(xy)throw t=G0,xy=!1,G0=null,t}function wt(t,e){var n=e[t_];n===void 0&&(n=e[t_]=new Set);var s=t+"__bubble";n.has(s)||(lD(e,t,2,!1),n.add(s))}function cb(t,e,n){var s=0;e&&(s|=4),lD(n,t,s,e)}var ag="_reactListening"+Math.random().toString(36).slice(2);function hp(t){if(!t[ag]){t[ag]=!0,gO.forEach(function(n){n!=="selectionchange"&&(dH.has(n)||cb(n,!1,t),cb(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ag]||(e[ag]=!0,cb("selectionchange",!1,e))}}function lD(t,e,n,s){switch(GO(e)){case 1:var i=C9;break;case 4:i=E9;break;default:i=yE}n=i.bind(null,e,n,t),i=void 0,!H0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),s?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function db(t,e,n,s,i){var r=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var l=s.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(o===4)for(o=s.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;l!==null;){if(o=Tl(l),o===null)return;if(c=o.tag,c===5||c===6){s=r=o;continue e}l=l.parentNode}}s=s.return}NO(function(){var d=r,u=pE(n),h=[];e:{var p=oD.get(t);if(p!==void 0){var f=xE,g=t;switch(t){case"keypress":if(gm(n)===0)break e;case"keydown":case"keyup":f=U9;break;case"focusin":g="focus",f=sb;break;case"focusout":g="blur",f=sb;break;case"beforeblur":case"afterblur":f=sb;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=zP;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=P9;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=W9;break;case nD:case sD:case iD:f=N9;break;case rD:f=G9;break;case"scroll":f=T9;break;case"wheel":f=K9;break;case"copy":case"cut":case"paste":f=R9;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=HP}var y=(e&4)!==0,x=!y&&t==="scroll",m=y?p!==null?p+"Capture":null:p;y=[];for(var v=d,w;v!==null;){w=v;var _=w.stateNode;if(w.tag===5&&_!==null&&(w=_,m!==null&&(_=op(v,m),_!=null&&y.push(pp(v,_,w)))),x)break;v=v.return}0<y.length&&(p=new f(p,g,null,n,u),h.push({event:p,listeners:y}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",p&&n!==z0&&(g=n.relatedTarget||n.fromElement)&&(Tl(g)||g[Io]))break e;if((f||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,f?(g=n.relatedTarget||n.toElement,f=d,g=g?Tl(g):null,g!==null&&(x=lc(g),g!==x||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=d),f!==g)){if(y=zP,_="onMouseLeave",m="onMouseEnter",v="mouse",(t==="pointerout"||t==="pointerover")&&(y=HP,_="onPointerLeave",m="onPointerEnter",v="pointer"),x=f==null?p:zc(f),w=g==null?p:zc(g),p=new y(_,v+"leave",f,n,u),p.target=x,p.relatedTarget=w,_=null,Tl(u)===d&&(y=new y(m,v+"enter",g,n,u),y.target=w,y.relatedTarget=x,_=y),x=_,f&&g)t:{for(y=f,m=g,v=0,w=y;w;w=Sc(w))v++;for(w=0,_=m;_;_=Sc(_))w++;for(;0<v-w;)y=Sc(y),v--;for(;0<w-v;)m=Sc(m),w--;for(;v--;){if(y===m||m!==null&&y===m.alternate)break t;y=Sc(y),m=Sc(m)}y=null}else y=null;f!==null&&tk(h,p,f,y,!1),g!==null&&x!==null&&tk(h,x,g,y,!0)}}e:{if(p=d?zc(d):window,f=p.nodeName&&p.nodeName.toLowerCase(),f==="select"||f==="input"&&p.type==="file")var C=eH;else if(KP(p))if(ZO)C=iH;else{C=nH;var I=tH}else(f=p.nodeName)&&f.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(C=sH);if(C&&(C=C(t,d))){qO(h,C,n,u);break e}I&&I(t,p,d),t==="focusout"&&(I=p._wrapperState)&&I.controlled&&p.type==="number"&&L0(p,"number",p.value)}switch(I=d?zc(d):window,t){case"focusin":(KP(I)||I.contentEditable==="true")&&(Uc=I,X0=d,Lh=null);break;case"focusout":Lh=X0=Uc=null;break;case"mousedown":q0=!0;break;case"contextmenu":case"mouseup":case"dragend":q0=!1,JP(h,n,u);break;case"selectionchange":if(aH)break;case"keydown":case"keyup":JP(h,n,u)}var T;if(bE)e:{switch(t){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else Bc?YO(t,n)&&(P="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(P="onCompositionStart");P&&(KO&&n.locale!=="ko"&&(Bc||P!=="onCompositionStart"?P==="onCompositionEnd"&&Bc&&(T=VO()):(ma=u,vE="value"in ma?ma.value:ma.textContent,Bc=!0)),I=Cy(d,P),0<I.length&&(P=new WP(P,t,null,n,u),h.push({event:P,listeners:I}),T?P.data=T:(T=XO(n),T!==null&&(P.data=T)))),(T=X9?q9(t,n):Z9(t,n))&&(d=Cy(d,"onBeforeInput"),0<d.length&&(u=new WP("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:d}),u.data=T))}aD(h,e)})}function pp(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Cy(t,e){for(var n=e+"Capture",s=[];t!==null;){var i=t,r=i.stateNode;i.tag===5&&r!==null&&(i=r,r=op(t,n),r!=null&&s.unshift(pp(t,r,i)),r=op(t,e),r!=null&&s.push(pp(t,r,i))),t=t.return}return s}function Sc(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function tk(t,e,n,s,i){for(var r=e._reactName,o=[];n!==null&&n!==s;){var l=n,c=l.alternate,d=l.stateNode;if(c!==null&&c===s)break;l.tag===5&&d!==null&&(l=d,i?(c=op(n,r),c!=null&&o.unshift(pp(n,c,l))):i||(c=op(n,r),c!=null&&o.push(pp(n,c,l)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var uH=/\r\n?/g,hH=/\u0000|\uFFFD/g;function nk(t){return(typeof t=="string"?t:""+t).replace(uH,`
`).replace(hH,"")}function lg(t,e,n){if(e=nk(e),nk(t)!==e&&n)throw Error(ie(425))}function Ey(){}var Z0=null,J0=null;function Q0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var e_=typeof setTimeout=="function"?setTimeout:void 0,pH=typeof clearTimeout=="function"?clearTimeout:void 0,sk=typeof Promise=="function"?Promise:void 0,fH=typeof queueMicrotask=="function"?queueMicrotask:typeof sk<"u"?function(t){return sk.resolve(null).then(t).catch(gH)}:e_;function gH(t){setTimeout(function(){throw t})}function ub(t,e){var n=e,s=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(s===0){t.removeChild(i),cp(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=i}while(n);cp(e)}function Ta(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function ik(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Jd=Math.random().toString(36).slice(2),Sr="__reactFiber$"+Jd,fp="__reactProps$"+Jd,Io="__reactContainer$"+Jd,t_="__reactEvents$"+Jd,mH="__reactListeners$"+Jd,yH="__reactHandles$"+Jd;function Tl(t){var e=t[Sr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Io]||n[Sr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=ik(t);t!==null;){if(n=t[Sr])return n;t=ik(t)}return e}t=n,n=t.parentNode}return null}function nf(t){return t=t[Sr]||t[Io],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function zc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ie(33))}function px(t){return t[fp]||null}var n_=[],Wc=-1;function Ja(t){return{current:t}}function Et(t){0>Wc||(t.current=n_[Wc],n_[Wc]=null,Wc--)}function mt(t,e){Wc++,n_[Wc]=t.current,t.current=e}var $a={},Jn=Ja($a),Fs=Ja(!1),Fl=$a;function Ed(t,e){var n=t.type.contextTypes;if(!n)return $a;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var i={},r;for(r in n)i[r]=e[r];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function Bs(t){return t=t.childContextTypes,t!=null}function Ty(){Et(Fs),Et(Jn)}function rk(t,e,n){if(Jn.current!==$a)throw Error(ie(168));mt(Jn,e),mt(Fs,n)}function cD(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var i in s)if(!(i in e))throw Error(ie(108,t9(t)||"Unknown",i));return Lt({},n,s)}function Iy(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||$a,Fl=Jn.current,mt(Jn,t),mt(Fs,Fs.current),!0}function ok(t,e,n){var s=t.stateNode;if(!s)throw Error(ie(169));n?(t=cD(t,e,Fl),s.__reactInternalMemoizedMergedChildContext=t,Et(Fs),Et(Jn),mt(Jn,t)):Et(Fs),mt(Fs,n)}var oo=null,fx=!1,hb=!1;function dD(t){oo===null?oo=[t]:oo.push(t)}function vH(t){fx=!0,dD(t)}function Qa(){if(!hb&&oo!==null){hb=!0;var t=0,e=rt;try{var n=oo;for(rt=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}oo=null,fx=!1}catch(i){throw oo!==null&&(oo=oo.slice(t+1)),OO(fE,Qa),i}finally{rt=e,hb=!1}}return null}var Hc=[],Gc=0,Py=null,ky=0,Si=[],bi=0,Bl=null,ho=1,po="";function Sl(t,e){Hc[Gc++]=ky,Hc[Gc++]=Py,Py=t,ky=e}function uD(t,e,n){Si[bi++]=ho,Si[bi++]=po,Si[bi++]=Bl,Bl=t;var s=ho;t=po;var i=32-qi(s)-1;s&=~(1<<i),n+=1;var r=32-qi(e)+i;if(30<r){var o=i-i%5;r=(s&(1<<o)-1).toString(32),s>>=o,i-=o,ho=1<<32-qi(e)+i|n<<i|s,po=r+t}else ho=1<<r|n<<i|s,po=t}function _E(t){t.return!==null&&(Sl(t,1),uD(t,1,0))}function CE(t){for(;t===Py;)Py=Hc[--Gc],Hc[Gc]=null,ky=Hc[--Gc],Hc[Gc]=null;for(;t===Bl;)Bl=Si[--bi],Si[bi]=null,po=Si[--bi],Si[bi]=null,ho=Si[--bi],Si[bi]=null}var ei=null,Qs=null,Pt=!1,Wi=null;function hD(t,e){var n=Ci(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function ak(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ei=t,Qs=Ta(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ei=t,Qs=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Bl!==null?{id:ho,overflow:po}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Ci(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ei=t,Qs=null,!0):!1;default:return!1}}function s_(t){return(t.mode&1)!==0&&(t.flags&128)===0}function i_(t){if(Pt){var e=Qs;if(e){var n=e;if(!ak(t,e)){if(s_(t))throw Error(ie(418));e=Ta(n.nextSibling);var s=ei;e&&ak(t,e)?hD(s,n):(t.flags=t.flags&-4097|2,Pt=!1,ei=t)}}else{if(s_(t))throw Error(ie(418));t.flags=t.flags&-4097|2,Pt=!1,ei=t}}}function lk(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ei=t}function cg(t){if(t!==ei)return!1;if(!Pt)return lk(t),Pt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Q0(t.type,t.memoizedProps)),e&&(e=Qs)){if(s_(t))throw pD(),Error(ie(418));for(;e;)hD(t,e),e=Ta(e.nextSibling)}if(lk(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ie(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Qs=Ta(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Qs=null}}else Qs=ei?Ta(t.stateNode.nextSibling):null;return!0}function pD(){for(var t=Qs;t;)t=Ta(t.nextSibling)}function Td(){Qs=ei=null,Pt=!1}function EE(t){Wi===null?Wi=[t]:Wi.push(t)}var xH=Bo.ReactCurrentBatchConfig;function ju(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(ie(309));var s=n.stateNode}if(!s)throw Error(ie(147,t));var i=s,r=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var l=i.refs;o===null?delete l[r]:l[r]=o},e._stringRef=r,e)}if(typeof t!="string")throw Error(ie(284));if(!n._owner)throw Error(ie(290,t))}return t}function dg(t,e){throw t=Object.prototype.toString.call(e),Error(ie(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function ck(t){var e=t._init;return e(t._payload)}function fD(t){function e(m,v){if(t){var w=m.deletions;w===null?(m.deletions=[v],m.flags|=16):w.push(v)}}function n(m,v){if(!t)return null;for(;v!==null;)e(m,v),v=v.sibling;return null}function s(m,v){for(m=new Map;v!==null;)v.key!==null?m.set(v.key,v):m.set(v.index,v),v=v.sibling;return m}function i(m,v){return m=ja(m,v),m.index=0,m.sibling=null,m}function r(m,v,w){return m.index=w,t?(w=m.alternate,w!==null?(w=w.index,w<v?(m.flags|=2,v):w):(m.flags|=2,v)):(m.flags|=1048576,v)}function o(m){return t&&m.alternate===null&&(m.flags|=2),m}function l(m,v,w,_){return v===null||v.tag!==6?(v=xb(w,m.mode,_),v.return=m,v):(v=i(v,w),v.return=m,v)}function c(m,v,w,_){var C=w.type;return C===Fc?u(m,v,w.props.children,_,w.key):v!==null&&(v.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===aa&&ck(C)===v.type)?(_=i(v,w.props),_.ref=ju(m,v,w),_.return=m,_):(_=wm(w.type,w.key,w.props,null,m.mode,_),_.ref=ju(m,v,w),_.return=m,_)}function d(m,v,w,_){return v===null||v.tag!==4||v.stateNode.containerInfo!==w.containerInfo||v.stateNode.implementation!==w.implementation?(v=Sb(w,m.mode,_),v.return=m,v):(v=i(v,w.children||[]),v.return=m,v)}function u(m,v,w,_,C){return v===null||v.tag!==7?(v=Ml(w,m.mode,_,C),v.return=m,v):(v=i(v,w),v.return=m,v)}function h(m,v,w){if(typeof v=="string"&&v!==""||typeof v=="number")return v=xb(""+v,m.mode,w),v.return=m,v;if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Qf:return w=wm(v.type,v.key,v.props,null,m.mode,w),w.ref=ju(m,null,v),w.return=m,w;case Lc:return v=Sb(v,m.mode,w),v.return=m,v;case aa:var _=v._init;return h(m,_(v._payload),w)}if(ah(v)||Eu(v))return v=Ml(v,m.mode,w,null),v.return=m,v;dg(m,v)}return null}function p(m,v,w,_){var C=v!==null?v.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return C!==null?null:l(m,v,""+w,_);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Qf:return w.key===C?c(m,v,w,_):null;case Lc:return w.key===C?d(m,v,w,_):null;case aa:return C=w._init,p(m,v,C(w._payload),_)}if(ah(w)||Eu(w))return C!==null?null:u(m,v,w,_,null);dg(m,w)}return null}function f(m,v,w,_,C){if(typeof _=="string"&&_!==""||typeof _=="number")return m=m.get(w)||null,l(v,m,""+_,C);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Qf:return m=m.get(_.key===null?w:_.key)||null,c(v,m,_,C);case Lc:return m=m.get(_.key===null?w:_.key)||null,d(v,m,_,C);case aa:var I=_._init;return f(m,v,w,I(_._payload),C)}if(ah(_)||Eu(_))return m=m.get(w)||null,u(v,m,_,C,null);dg(v,_)}return null}function g(m,v,w,_){for(var C=null,I=null,T=v,P=v=0,k=null;T!==null&&P<w.length;P++){T.index>P?(k=T,T=null):k=T.sibling;var N=p(m,T,w[P],_);if(N===null){T===null&&(T=k);break}t&&T&&N.alternate===null&&e(m,T),v=r(N,v,P),I===null?C=N:I.sibling=N,I=N,T=k}if(P===w.length)return n(m,T),Pt&&Sl(m,P),C;if(T===null){for(;P<w.length;P++)T=h(m,w[P],_),T!==null&&(v=r(T,v,P),I===null?C=T:I.sibling=T,I=T);return Pt&&Sl(m,P),C}for(T=s(m,T);P<w.length;P++)k=f(T,m,P,w[P],_),k!==null&&(t&&k.alternate!==null&&T.delete(k.key===null?P:k.key),v=r(k,v,P),I===null?C=k:I.sibling=k,I=k);return t&&T.forEach(function(O){return e(m,O)}),Pt&&Sl(m,P),C}function y(m,v,w,_){var C=Eu(w);if(typeof C!="function")throw Error(ie(150));if(w=C.call(w),w==null)throw Error(ie(151));for(var I=C=null,T=v,P=v=0,k=null,N=w.next();T!==null&&!N.done;P++,N=w.next()){T.index>P?(k=T,T=null):k=T.sibling;var O=p(m,T,N.value,_);if(O===null){T===null&&(T=k);break}t&&T&&O.alternate===null&&e(m,T),v=r(O,v,P),I===null?C=O:I.sibling=O,I=O,T=k}if(N.done)return n(m,T),Pt&&Sl(m,P),C;if(T===null){for(;!N.done;P++,N=w.next())N=h(m,N.value,_),N!==null&&(v=r(N,v,P),I===null?C=N:I.sibling=N,I=N);return Pt&&Sl(m,P),C}for(T=s(m,T);!N.done;P++,N=w.next())N=f(T,m,P,N.value,_),N!==null&&(t&&N.alternate!==null&&T.delete(N.key===null?P:N.key),v=r(N,v,P),I===null?C=N:I.sibling=N,I=N);return t&&T.forEach(function(R){return e(m,R)}),Pt&&Sl(m,P),C}function x(m,v,w,_){if(typeof w=="object"&&w!==null&&w.type===Fc&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Qf:e:{for(var C=w.key,I=v;I!==null;){if(I.key===C){if(C=w.type,C===Fc){if(I.tag===7){n(m,I.sibling),v=i(I,w.props.children),v.return=m,m=v;break e}}else if(I.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===aa&&ck(C)===I.type){n(m,I.sibling),v=i(I,w.props),v.ref=ju(m,I,w),v.return=m,m=v;break e}n(m,I);break}else e(m,I);I=I.sibling}w.type===Fc?(v=Ml(w.props.children,m.mode,_,w.key),v.return=m,m=v):(_=wm(w.type,w.key,w.props,null,m.mode,_),_.ref=ju(m,v,w),_.return=m,m=_)}return o(m);case Lc:e:{for(I=w.key;v!==null;){if(v.key===I)if(v.tag===4&&v.stateNode.containerInfo===w.containerInfo&&v.stateNode.implementation===w.implementation){n(m,v.sibling),v=i(v,w.children||[]),v.return=m,m=v;break e}else{n(m,v);break}else e(m,v);v=v.sibling}v=Sb(w,m.mode,_),v.return=m,m=v}return o(m);case aa:return I=w._init,x(m,v,I(w._payload),_)}if(ah(w))return g(m,v,w,_);if(Eu(w))return y(m,v,w,_);dg(m,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,v!==null&&v.tag===6?(n(m,v.sibling),v=i(v,w),v.return=m,m=v):(n(m,v),v=xb(w,m.mode,_),v.return=m,m=v),o(m)):n(m,v)}return x}var Id=fD(!0),gD=fD(!1),jy=Ja(null),Ny=null,Vc=null,TE=null;function IE(){TE=Vc=Ny=null}function PE(t){var e=jy.current;Et(jy),t._currentValue=e}function r_(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function ud(t,e){Ny=t,TE=Vc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Rs=!0),t.firstContext=null)}function ji(t){var e=t._currentValue;if(TE!==t)if(t={context:t,memoizedValue:e,next:null},Vc===null){if(Ny===null)throw Error(ie(308));Vc=t,Ny.dependencies={lanes:0,firstContext:t}}else Vc=Vc.next=t;return e}var Il=null;function kE(t){Il===null?Il=[t]:Il.push(t)}function mD(t,e,n,s){var i=e.interleaved;return i===null?(n.next=n,kE(e)):(n.next=i.next,i.next=n),e.interleaved=n,Po(t,s)}function Po(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var la=!1;function jE(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function yD(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function So(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Ia(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,qe&2){var i=s.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),s.pending=e,Po(t,n)}return i=s.interleaved,i===null?(e.next=e,kE(s)):(e.next=i.next,i.next=e),s.interleaved=e,Po(t,n)}function mm(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,gE(t,n)}}function dk(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var i=null,r=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};r===null?i=r=o:r=r.next=o,n=n.next}while(n!==null);r===null?i=r=e:r=r.next=e}else i=r=e;n={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ay(t,e,n,s){var i=t.updateQueue;la=!1;var r=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?r=d:o.next=d,o=c;var u=t.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(r!==null){var h=i.baseState;o=0,u=d=c=null,l=r;do{var p=l.lane,f=l.eventTime;if((s&p)===p){u!==null&&(u=u.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var g=t,y=l;switch(p=e,f=n,y.tag){case 1:if(g=y.payload,typeof g=="function"){h=g.call(f,h,p);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,p=typeof g=="function"?g.call(f,h,p):g,p==null)break e;h=Lt({},h,p);break e;case 2:la=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,p=i.effects,p===null?i.effects=[l]:p.push(l))}else f={eventTime:f,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=f,c=h):u=u.next=f,o|=p;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;p=l,l=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(u===null&&(c=h),i.baseState=c,i.firstBaseUpdate=d,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else r===null&&(i.shared.lanes=0);$l|=o,t.lanes=o,t.memoizedState=h}}function uk(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],i=s.callback;if(i!==null){if(s.callback=null,s=n,typeof i!="function")throw Error(ie(191,i));i.call(s)}}}var sf={},Ar=Ja(sf),gp=Ja(sf),mp=Ja(sf);function Pl(t){if(t===sf)throw Error(ie(174));return t}function NE(t,e){switch(mt(mp,e),mt(gp,t),mt(Ar,sf),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:B0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=B0(e,t)}Et(Ar),mt(Ar,e)}function Pd(){Et(Ar),Et(gp),Et(mp)}function vD(t){Pl(mp.current);var e=Pl(Ar.current),n=B0(e,t.type);e!==n&&(mt(gp,t),mt(Ar,n))}function AE(t){gp.current===t&&(Et(Ar),Et(gp))}var At=Ja(0);function Ry(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var pb=[];function RE(){for(var t=0;t<pb.length;t++)pb[t]._workInProgressVersionPrimary=null;pb.length=0}var ym=Bo.ReactCurrentDispatcher,fb=Bo.ReactCurrentBatchConfig,Ul=0,Dt=null,Qt=null,ln=null,My=!1,Fh=!1,yp=0,SH=0;function Bn(){throw Error(ie(321))}function ME(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!nr(t[n],e[n]))return!1;return!0}function OE(t,e,n,s,i,r){if(Ul=r,Dt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ym.current=t===null||t.memoizedState===null?CH:EH,t=n(s,i),Fh){r=0;do{if(Fh=!1,yp=0,25<=r)throw Error(ie(301));r+=1,ln=Qt=null,e.updateQueue=null,ym.current=TH,t=n(s,i)}while(Fh)}if(ym.current=Oy,e=Qt!==null&&Qt.next!==null,Ul=0,ln=Qt=Dt=null,My=!1,e)throw Error(ie(300));return t}function DE(){var t=yp!==0;return yp=0,t}function yr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ln===null?Dt.memoizedState=ln=t:ln=ln.next=t,ln}function Ni(){if(Qt===null){var t=Dt.alternate;t=t!==null?t.memoizedState:null}else t=Qt.next;var e=ln===null?Dt.memoizedState:ln.next;if(e!==null)ln=e,Qt=t;else{if(t===null)throw Error(ie(310));Qt=t,t={memoizedState:Qt.memoizedState,baseState:Qt.baseState,baseQueue:Qt.baseQueue,queue:Qt.queue,next:null},ln===null?Dt.memoizedState=ln=t:ln=ln.next=t}return ln}function vp(t,e){return typeof e=="function"?e(t):e}function gb(t){var e=Ni(),n=e.queue;if(n===null)throw Error(ie(311));n.lastRenderedReducer=t;var s=Qt,i=s.baseQueue,r=n.pending;if(r!==null){if(i!==null){var o=i.next;i.next=r.next,r.next=o}s.baseQueue=i=r,n.pending=null}if(i!==null){r=i.next,s=s.baseState;var l=o=null,c=null,d=r;do{var u=d.lane;if((Ul&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),s=d.hasEagerState?d.eagerState:t(s,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=s):c=c.next=h,Dt.lanes|=u,$l|=u}d=d.next}while(d!==null&&d!==r);c===null?o=s:c.next=l,nr(s,e.memoizedState)||(Rs=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=c,n.lastRenderedState=s}if(t=n.interleaved,t!==null){i=t;do r=i.lane,Dt.lanes|=r,$l|=r,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function mb(t){var e=Ni(),n=e.queue;if(n===null)throw Error(ie(311));n.lastRenderedReducer=t;var s=n.dispatch,i=n.pending,r=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do r=t(r,o.action),o=o.next;while(o!==i);nr(r,e.memoizedState)||(Rs=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),n.lastRenderedState=r}return[r,s]}function xD(){}function SD(t,e){var n=Dt,s=Ni(),i=e(),r=!nr(s.memoizedState,i);if(r&&(s.memoizedState=i,Rs=!0),s=s.queue,LE(_D.bind(null,n,s,t),[t]),s.getSnapshot!==e||r||ln!==null&&ln.memoizedState.tag&1){if(n.flags|=2048,xp(9,wD.bind(null,n,s,i,e),void 0,null),fn===null)throw Error(ie(349));Ul&30||bD(n,e,i)}return i}function bD(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Dt.updateQueue,e===null?(e={lastEffect:null,stores:null},Dt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function wD(t,e,n,s){e.value=n,e.getSnapshot=s,CD(e)&&ED(t)}function _D(t,e,n){return n(function(){CD(e)&&ED(t)})}function CD(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!nr(t,n)}catch{return!0}}function ED(t){var e=Po(t,1);e!==null&&Zi(e,t,1,-1)}function hk(t){var e=yr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vp,lastRenderedState:t},e.queue=t,t=t.dispatch=_H.bind(null,Dt,t),[e.memoizedState,t]}function xp(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=Dt.updateQueue,e===null?(e={lastEffect:null,stores:null},Dt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function TD(){return Ni().memoizedState}function vm(t,e,n,s){var i=yr();Dt.flags|=t,i.memoizedState=xp(1|e,n,void 0,s===void 0?null:s)}function gx(t,e,n,s){var i=Ni();s=s===void 0?null:s;var r=void 0;if(Qt!==null){var o=Qt.memoizedState;if(r=o.destroy,s!==null&&ME(s,o.deps)){i.memoizedState=xp(e,n,r,s);return}}Dt.flags|=t,i.memoizedState=xp(1|e,n,r,s)}function pk(t,e){return vm(8390656,8,t,e)}function LE(t,e){return gx(2048,8,t,e)}function ID(t,e){return gx(4,2,t,e)}function PD(t,e){return gx(4,4,t,e)}function kD(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function jD(t,e,n){return n=n!=null?n.concat([t]):null,gx(4,4,kD.bind(null,e,t),n)}function FE(){}function ND(t,e){var n=Ni();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&ME(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function AD(t,e){var n=Ni();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&ME(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function RD(t,e,n){return Ul&21?(nr(n,e)||(n=FO(),Dt.lanes|=n,$l|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Rs=!0),t.memoizedState=n)}function bH(t,e){var n=rt;rt=n!==0&&4>n?n:4,t(!0);var s=fb.transition;fb.transition={};try{t(!1),e()}finally{rt=n,fb.transition=s}}function MD(){return Ni().memoizedState}function wH(t,e,n){var s=ka(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},OD(t))DD(e,n);else if(n=mD(t,e,n,s),n!==null){var i=hs();Zi(n,t,s,i),LD(n,e,s)}}function _H(t,e,n){var s=ka(t),i={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(OD(t))DD(e,i);else{var r=t.alternate;if(t.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,l=r(o,n);if(i.hasEagerState=!0,i.eagerState=l,nr(l,o)){var c=e.interleaved;c===null?(i.next=i,kE(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}n=mD(t,e,i,s),n!==null&&(i=hs(),Zi(n,t,s,i),LD(n,e,s))}}function OD(t){var e=t.alternate;return t===Dt||e!==null&&e===Dt}function DD(t,e){Fh=My=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function LD(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,gE(t,n)}}var Oy={readContext:ji,useCallback:Bn,useContext:Bn,useEffect:Bn,useImperativeHandle:Bn,useInsertionEffect:Bn,useLayoutEffect:Bn,useMemo:Bn,useReducer:Bn,useRef:Bn,useState:Bn,useDebugValue:Bn,useDeferredValue:Bn,useTransition:Bn,useMutableSource:Bn,useSyncExternalStore:Bn,useId:Bn,unstable_isNewReconciler:!1},CH={readContext:ji,useCallback:function(t,e){return yr().memoizedState=[t,e===void 0?null:e],t},useContext:ji,useEffect:pk,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,vm(4194308,4,kD.bind(null,e,t),n)},useLayoutEffect:function(t,e){return vm(4194308,4,t,e)},useInsertionEffect:function(t,e){return vm(4,2,t,e)},useMemo:function(t,e){var n=yr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=yr();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=wH.bind(null,Dt,t),[s.memoizedState,t]},useRef:function(t){var e=yr();return t={current:t},e.memoizedState=t},useState:hk,useDebugValue:FE,useDeferredValue:function(t){return yr().memoizedState=t},useTransition:function(){var t=hk(!1),e=t[0];return t=bH.bind(null,t[1]),yr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=Dt,i=yr();if(Pt){if(n===void 0)throw Error(ie(407));n=n()}else{if(n=e(),fn===null)throw Error(ie(349));Ul&30||bD(s,e,n)}i.memoizedState=n;var r={value:n,getSnapshot:e};return i.queue=r,pk(_D.bind(null,s,r,t),[t]),s.flags|=2048,xp(9,wD.bind(null,s,r,n,e),void 0,null),n},useId:function(){var t=yr(),e=fn.identifierPrefix;if(Pt){var n=po,s=ho;n=(s&~(1<<32-qi(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=yp++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=SH++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},EH={readContext:ji,useCallback:ND,useContext:ji,useEffect:LE,useImperativeHandle:jD,useInsertionEffect:ID,useLayoutEffect:PD,useMemo:AD,useReducer:gb,useRef:TD,useState:function(){return gb(vp)},useDebugValue:FE,useDeferredValue:function(t){var e=Ni();return RD(e,Qt.memoizedState,t)},useTransition:function(){var t=gb(vp)[0],e=Ni().memoizedState;return[t,e]},useMutableSource:xD,useSyncExternalStore:SD,useId:MD,unstable_isNewReconciler:!1},TH={readContext:ji,useCallback:ND,useContext:ji,useEffect:LE,useImperativeHandle:jD,useInsertionEffect:ID,useLayoutEffect:PD,useMemo:AD,useReducer:mb,useRef:TD,useState:function(){return mb(vp)},useDebugValue:FE,useDeferredValue:function(t){var e=Ni();return Qt===null?e.memoizedState=t:RD(e,Qt.memoizedState,t)},useTransition:function(){var t=mb(vp)[0],e=Ni().memoizedState;return[t,e]},useMutableSource:xD,useSyncExternalStore:SD,useId:MD,unstable_isNewReconciler:!1};function Ui(t,e){if(t&&t.defaultProps){e=Lt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function o_(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:Lt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var mx={isMounted:function(t){return(t=t._reactInternals)?lc(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=hs(),i=ka(t),r=So(s,i);r.payload=e,n!=null&&(r.callback=n),e=Ia(t,r,i),e!==null&&(Zi(e,t,i,s),mm(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=hs(),i=ka(t),r=So(s,i);r.tag=1,r.payload=e,n!=null&&(r.callback=n),e=Ia(t,r,i),e!==null&&(Zi(e,t,i,s),mm(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=hs(),s=ka(t),i=So(n,s);i.tag=2,e!=null&&(i.callback=e),e=Ia(t,i,s),e!==null&&(Zi(e,t,s,n),mm(e,t,s))}};function fk(t,e,n,s,i,r,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,r,o):e.prototype&&e.prototype.isPureReactComponent?!up(n,s)||!up(i,r):!0}function FD(t,e,n){var s=!1,i=$a,r=e.contextType;return typeof r=="object"&&r!==null?r=ji(r):(i=Bs(e)?Fl:Jn.current,s=e.contextTypes,r=(s=s!=null)?Ed(t,i):$a),e=new e(n,r),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=mx,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=r),e}function gk(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&mx.enqueueReplaceState(e,e.state,null)}function a_(t,e,n,s){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},jE(t);var r=e.contextType;typeof r=="object"&&r!==null?i.context=ji(r):(r=Bs(e)?Fl:Jn.current,i.context=Ed(t,r)),i.state=t.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(o_(t,e,r,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&mx.enqueueReplaceState(i,i.state,null),Ay(t,n,i,s),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function kd(t,e){try{var n="",s=e;do n+=e9(s),s=s.return;while(s);var i=n}catch(r){i=`
Error generating stack: `+r.message+`
`+r.stack}return{value:t,source:e,stack:i,digest:null}}function yb(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function l_(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var IH=typeof WeakMap=="function"?WeakMap:Map;function BD(t,e,n){n=So(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){Ly||(Ly=!0,v_=s),l_(t,e)},n}function UD(t,e,n){n=So(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var i=e.value;n.payload=function(){return s(i)},n.callback=function(){l_(t,e)}}var r=t.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(n.callback=function(){l_(t,e),typeof s!="function"&&(Pa===null?Pa=new Set([this]):Pa.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function mk(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new IH;var i=new Set;s.set(e,i)}else i=s.get(e),i===void 0&&(i=new Set,s.set(e,i));i.has(n)||(i.add(n),t=$H.bind(null,t,e,n),e.then(t,t))}function yk(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function vk(t,e,n,s,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=So(-1,1),e.tag=2,Ia(n,e,1))),n.lanes|=1),t)}var PH=Bo.ReactCurrentOwner,Rs=!1;function as(t,e,n,s){e.child=t===null?gD(e,null,n,s):Id(e,t.child,n,s)}function xk(t,e,n,s,i){n=n.render;var r=e.ref;return ud(e,i),s=OE(t,e,n,s,r,i),n=DE(),t!==null&&!Rs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,ko(t,e,i)):(Pt&&n&&_E(e),e.flags|=1,as(t,e,s,i),e.child)}function Sk(t,e,n,s,i){if(t===null){var r=n.type;return typeof r=="function"&&!VE(r)&&r.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=r,$D(t,e,r,s,i)):(t=wm(n.type,null,s,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(r=t.child,!(t.lanes&i)){var o=r.memoizedProps;if(n=n.compare,n=n!==null?n:up,n(o,s)&&t.ref===e.ref)return ko(t,e,i)}return e.flags|=1,t=ja(r,s),t.ref=e.ref,t.return=e,e.child=t}function $D(t,e,n,s,i){if(t!==null){var r=t.memoizedProps;if(up(r,s)&&t.ref===e.ref)if(Rs=!1,e.pendingProps=s=r,(t.lanes&i)!==0)t.flags&131072&&(Rs=!0);else return e.lanes=t.lanes,ko(t,e,i)}return c_(t,e,n,s,i)}function zD(t,e,n){var s=e.pendingProps,i=s.children,r=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},mt(Yc,Xs),Xs|=n;else{if(!(n&1073741824))return t=r!==null?r.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,mt(Yc,Xs),Xs|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=r!==null?r.baseLanes:n,mt(Yc,Xs),Xs|=s}else r!==null?(s=r.baseLanes|n,e.memoizedState=null):s=n,mt(Yc,Xs),Xs|=s;return as(t,e,i,n),e.child}function WD(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function c_(t,e,n,s,i){var r=Bs(n)?Fl:Jn.current;return r=Ed(e,r),ud(e,i),n=OE(t,e,n,s,r,i),s=DE(),t!==null&&!Rs?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,ko(t,e,i)):(Pt&&s&&_E(e),e.flags|=1,as(t,e,n,i),e.child)}function bk(t,e,n,s,i){if(Bs(n)){var r=!0;Iy(e)}else r=!1;if(ud(e,i),e.stateNode===null)xm(t,e),FD(e,n,s),a_(e,n,s,i),s=!0;else if(t===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=n.contextType;typeof d=="object"&&d!==null?d=ji(d):(d=Bs(n)?Fl:Jn.current,d=Ed(e,d));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==s||c!==d)&&gk(e,o,s,d),la=!1;var p=e.memoizedState;o.state=p,Ay(e,s,o,i),c=e.memoizedState,l!==s||p!==c||Fs.current||la?(typeof u=="function"&&(o_(e,n,u,s),c=e.memoizedState),(l=la||fk(e,n,l,s,p,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=c),o.props=s,o.state=c,o.context=d,s=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,yD(t,e),l=e.memoizedProps,d=e.type===e.elementType?l:Ui(e.type,l),o.props=d,h=e.pendingProps,p=o.context,c=n.contextType,typeof c=="object"&&c!==null?c=ji(c):(c=Bs(n)?Fl:Jn.current,c=Ed(e,c));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||p!==c)&&gk(e,o,s,c),la=!1,p=e.memoizedState,o.state=p,Ay(e,s,o,i);var g=e.memoizedState;l!==h||p!==g||Fs.current||la?(typeof f=="function"&&(o_(e,n,f,s),g=e.memoizedState),(d=la||fk(e,n,d,s,p,g,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,g,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,g,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=g),o.props=s,o.state=g,o.context=c,s=d):(typeof o.componentDidUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),s=!1)}return d_(t,e,n,s,r,i)}function d_(t,e,n,s,i,r){WD(t,e);var o=(e.flags&128)!==0;if(!s&&!o)return i&&ok(e,n,!1),ko(t,e,r);s=e.stateNode,PH.current=e;var l=o&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&o?(e.child=Id(e,t.child,null,r),e.child=Id(e,null,l,r)):as(t,e,l,r),e.memoizedState=s.state,i&&ok(e,n,!0),e.child}function HD(t){var e=t.stateNode;e.pendingContext?rk(t,e.pendingContext,e.pendingContext!==e.context):e.context&&rk(t,e.context,!1),NE(t,e.containerInfo)}function wk(t,e,n,s,i){return Td(),EE(i),e.flags|=256,as(t,e,n,s),e.child}var u_={dehydrated:null,treeContext:null,retryLane:0};function h_(t){return{baseLanes:t,cachePool:null,transitions:null}}function GD(t,e,n){var s=e.pendingProps,i=At.current,r=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=t!==null&&t.memoizedState===null?!1:(i&2)!==0),l?(r=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),mt(At,i&1),t===null)return i_(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,t=s.fallback,r?(s=e.mode,r=e.child,o={mode:"hidden",children:o},!(s&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=xx(o,s,0,null),t=Ml(t,s,n,null),r.return=e,t.return=e,r.sibling=t,e.child=r,e.child.memoizedState=h_(n),e.memoizedState=u_,t):BE(e,o));if(i=t.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return kH(t,e,o,s,l,i,n);if(r){r=s.fallback,o=e.mode,i=t.child,l=i.sibling;var c={mode:"hidden",children:s.children};return!(o&1)&&e.child!==i?(s=e.child,s.childLanes=0,s.pendingProps=c,e.deletions=null):(s=ja(i,c),s.subtreeFlags=i.subtreeFlags&14680064),l!==null?r=ja(l,r):(r=Ml(r,o,n,null),r.flags|=2),r.return=e,s.return=e,s.sibling=r,e.child=s,s=r,r=e.child,o=t.child.memoizedState,o=o===null?h_(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=t.childLanes&~n,e.memoizedState=u_,s}return r=t.child,t=r.sibling,s=ja(r,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function BE(t,e){return e=xx({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function ug(t,e,n,s){return s!==null&&EE(s),Id(e,t.child,null,n),t=BE(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function kH(t,e,n,s,i,r,o){if(n)return e.flags&256?(e.flags&=-257,s=yb(Error(ie(422))),ug(t,e,o,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(r=s.fallback,i=e.mode,s=xx({mode:"visible",children:s.children},i,0,null),r=Ml(r,i,o,null),r.flags|=2,s.return=e,r.return=e,s.sibling=r,e.child=s,e.mode&1&&Id(e,t.child,null,o),e.child.memoizedState=h_(o),e.memoizedState=u_,r);if(!(e.mode&1))return ug(t,e,o,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var l=s.dgst;return s=l,r=Error(ie(419)),s=yb(r,s,void 0),ug(t,e,o,s)}if(l=(o&t.childLanes)!==0,Rs||l){if(s=fn,s!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|o)?0:i,i!==0&&i!==r.retryLane&&(r.retryLane=i,Po(t,i),Zi(s,t,i,-1))}return GE(),s=yb(Error(ie(421))),ug(t,e,o,s)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=zH.bind(null,t),i._reactRetry=e,null):(t=r.treeContext,Qs=Ta(i.nextSibling),ei=e,Pt=!0,Wi=null,t!==null&&(Si[bi++]=ho,Si[bi++]=po,Si[bi++]=Bl,ho=t.id,po=t.overflow,Bl=e),e=BE(e,s.children),e.flags|=4096,e)}function _k(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),r_(t.return,e,n)}function vb(t,e,n,s,i){var r=t.memoizedState;r===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:i}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=n,r.tailMode=i)}function VD(t,e,n){var s=e.pendingProps,i=s.revealOrder,r=s.tail;if(as(t,e,s.children,n),s=At.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&_k(t,n,e);else if(t.tag===19)_k(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(mt(At,s),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Ry(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),vb(e,!1,i,n,r);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Ry(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}vb(e,!0,n,null,r);break;case"together":vb(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function xm(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function ko(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),$l|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(ie(153));if(e.child!==null){for(t=e.child,n=ja(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=ja(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function jH(t,e,n){switch(e.tag){case 3:HD(e),Td();break;case 5:vD(e);break;case 1:Bs(e.type)&&Iy(e);break;case 4:NE(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,i=e.memoizedProps.value;mt(jy,s._currentValue),s._currentValue=i;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(mt(At,At.current&1),e.flags|=128,null):n&e.child.childLanes?GD(t,e,n):(mt(At,At.current&1),t=ko(t,e,n),t!==null?t.sibling:null);mt(At,At.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return VD(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),mt(At,At.current),s)break;return null;case 22:case 23:return e.lanes=0,zD(t,e,n)}return ko(t,e,n)}var KD,p_,YD,XD;KD=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};p_=function(){};YD=function(t,e,n,s){var i=t.memoizedProps;if(i!==s){t=e.stateNode,Pl(Ar.current);var r=null;switch(n){case"input":i=O0(t,i),s=O0(t,s),r=[];break;case"select":i=Lt({},i,{value:void 0}),s=Lt({},s,{value:void 0}),r=[];break;case"textarea":i=F0(t,i),s=F0(t,s),r=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=Ey)}U0(n,s);var o;n=null;for(d in i)if(!s.hasOwnProperty(d)&&i.hasOwnProperty(d)&&i[d]!=null)if(d==="style"){var l=i[d];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(ip.hasOwnProperty(d)?r||(r=[]):(r=r||[]).push(d,null));for(d in s){var c=s[d];if(l=i!=null?i[d]:void 0,s.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(r||(r=[]),r.push(d,n)),n=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(r=r||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(r=r||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(ip.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&wt("scroll",t),r||l===c||(r=[])):(r=r||[]).push(d,c))}n&&(r=r||[]).push("style",n);var d=r;(e.updateQueue=d)&&(e.flags|=4)}};XD=function(t,e,n,s){n!==s&&(e.flags|=4)};function Nu(t,e){if(!Pt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function Un(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function NH(t,e,n){var s=e.pendingProps;switch(CE(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Un(e),null;case 1:return Bs(e.type)&&Ty(),Un(e),null;case 3:return s=e.stateNode,Pd(),Et(Fs),Et(Jn),RE(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(cg(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Wi!==null&&(b_(Wi),Wi=null))),p_(t,e),Un(e),null;case 5:AE(e);var i=Pl(mp.current);if(n=e.type,t!==null&&e.stateNode!=null)YD(t,e,n,s,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(ie(166));return Un(e),null}if(t=Pl(Ar.current),cg(e)){s=e.stateNode,n=e.type;var r=e.memoizedProps;switch(s[Sr]=e,s[fp]=r,t=(e.mode&1)!==0,n){case"dialog":wt("cancel",s),wt("close",s);break;case"iframe":case"object":case"embed":wt("load",s);break;case"video":case"audio":for(i=0;i<ch.length;i++)wt(ch[i],s);break;case"source":wt("error",s);break;case"img":case"image":case"link":wt("error",s),wt("load",s);break;case"details":wt("toggle",s);break;case"input":AP(s,r),wt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!r.multiple},wt("invalid",s);break;case"textarea":MP(s,r),wt("invalid",s)}U0(n,r),i=null;for(var o in r)if(r.hasOwnProperty(o)){var l=r[o];o==="children"?typeof l=="string"?s.textContent!==l&&(r.suppressHydrationWarning!==!0&&lg(s.textContent,l,t),i=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(r.suppressHydrationWarning!==!0&&lg(s.textContent,l,t),i=["children",""+l]):ip.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&wt("scroll",s)}switch(n){case"input":eg(s),RP(s,r,!0);break;case"textarea":eg(s),OP(s);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(s.onclick=Ey)}s=i,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=_O(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=o.createElement(n,{is:s.is}):(t=o.createElement(n),n==="select"&&(o=t,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):t=o.createElementNS(t,n),t[Sr]=e,t[fp]=s,KD(t,e,!1,!1),e.stateNode=t;e:{switch(o=$0(n,s),n){case"dialog":wt("cancel",t),wt("close",t),i=s;break;case"iframe":case"object":case"embed":wt("load",t),i=s;break;case"video":case"audio":for(i=0;i<ch.length;i++)wt(ch[i],t);i=s;break;case"source":wt("error",t),i=s;break;case"img":case"image":case"link":wt("error",t),wt("load",t),i=s;break;case"details":wt("toggle",t),i=s;break;case"input":AP(t,s),i=O0(t,s),wt("invalid",t);break;case"option":i=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},i=Lt({},s,{value:void 0}),wt("invalid",t);break;case"textarea":MP(t,s),i=F0(t,s),wt("invalid",t);break;default:i=s}U0(n,i),l=i;for(r in l)if(l.hasOwnProperty(r)){var c=l[r];r==="style"?TO(t,c):r==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&CO(t,c)):r==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&rp(t,c):typeof c=="number"&&rp(t,""+c):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(ip.hasOwnProperty(r)?c!=null&&r==="onScroll"&&wt("scroll",t):c!=null&&cE(t,r,c,o))}switch(n){case"input":eg(t),RP(t,s,!1);break;case"textarea":eg(t),OP(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Ua(s.value));break;case"select":t.multiple=!!s.multiple,r=s.value,r!=null?ad(t,!!s.multiple,r,!1):s.defaultValue!=null&&ad(t,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Ey)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Un(e),null;case 6:if(t&&e.stateNode!=null)XD(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(ie(166));if(n=Pl(mp.current),Pl(Ar.current),cg(e)){if(s=e.stateNode,n=e.memoizedProps,s[Sr]=e,(r=s.nodeValue!==n)&&(t=ei,t!==null))switch(t.tag){case 3:lg(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&lg(s.nodeValue,n,(t.mode&1)!==0)}r&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[Sr]=e,e.stateNode=s}return Un(e),null;case 13:if(Et(At),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Pt&&Qs!==null&&e.mode&1&&!(e.flags&128))pD(),Td(),e.flags|=98560,r=!1;else if(r=cg(e),s!==null&&s.dehydrated!==null){if(t===null){if(!r)throw Error(ie(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ie(317));r[Sr]=e}else Td(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Un(e),r=!1}else Wi!==null&&(b_(Wi),Wi=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||At.current&1?nn===0&&(nn=3):GE())),e.updateQueue!==null&&(e.flags|=4),Un(e),null);case 4:return Pd(),p_(t,e),t===null&&hp(e.stateNode.containerInfo),Un(e),null;case 10:return PE(e.type._context),Un(e),null;case 17:return Bs(e.type)&&Ty(),Un(e),null;case 19:if(Et(At),r=e.memoizedState,r===null)return Un(e),null;if(s=(e.flags&128)!==0,o=r.rendering,o===null)if(s)Nu(r,!1);else{if(nn!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Ry(t),o!==null){for(e.flags|=128,Nu(r,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)r=n,t=s,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=t,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,t=o.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return mt(At,At.current&1|2),e.child}t=t.sibling}r.tail!==null&&Vt()>jd&&(e.flags|=128,s=!0,Nu(r,!1),e.lanes=4194304)}else{if(!s)if(t=Ry(o),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Nu(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!Pt)return Un(e),null}else 2*Vt()-r.renderingStartTime>jd&&n!==1073741824&&(e.flags|=128,s=!0,Nu(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(n=r.last,n!==null?n.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Vt(),e.sibling=null,n=At.current,mt(At,s?n&1|2:n&1),e):(Un(e),null);case 22:case 23:return HE(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?Xs&1073741824&&(Un(e),e.subtreeFlags&6&&(e.flags|=8192)):Un(e),null;case 24:return null;case 25:return null}throw Error(ie(156,e.tag))}function AH(t,e){switch(CE(e),e.tag){case 1:return Bs(e.type)&&Ty(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Pd(),Et(Fs),Et(Jn),RE(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return AE(e),null;case 13:if(Et(At),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ie(340));Td()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Et(At),null;case 4:return Pd(),null;case 10:return PE(e.type._context),null;case 22:case 23:return HE(),null;case 24:return null;default:return null}}var hg=!1,Yn=!1,RH=typeof WeakSet=="function"?WeakSet:Set,fe=null;function Kc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){$t(t,e,s)}else n.current=null}function f_(t,e,n){try{n()}catch(s){$t(t,e,s)}}var Ck=!1;function MH(t,e){if(Z0=wy,t=eD(),wE(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var i=s.anchorOffset,r=s.focusNode;s=s.focusOffset;try{n.nodeType,r.nodeType}catch{n=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=t,p=null;t:for(;;){for(var f;h!==n||i!==0&&h.nodeType!==3||(l=o+i),h!==r||s!==0&&h.nodeType!==3||(c=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)p=h,h=f;for(;;){if(h===t)break t;if(p===n&&++d===i&&(l=o),p===r&&++u===s&&(c=o),(f=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=f}n=l===-1||c===-1?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(J0={focusedElem:t,selectionRange:n},wy=!1,fe=e;fe!==null;)if(e=fe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,fe=t;else for(;fe!==null;){e=fe;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,x=g.memoizedState,m=e.stateNode,v=m.getSnapshotBeforeUpdate(e.elementType===e.type?y:Ui(e.type,y),x);m.__reactInternalSnapshotBeforeUpdate=v}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ie(163))}}catch(_){$t(e,e.return,_)}if(t=e.sibling,t!==null){t.return=e.return,fe=t;break}fe=e.return}return g=Ck,Ck=!1,g}function Bh(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&t)===t){var r=i.destroy;i.destroy=void 0,r!==void 0&&f_(e,n,r)}i=i.next}while(i!==s)}}function yx(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function g_(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function qD(t){var e=t.alternate;e!==null&&(t.alternate=null,qD(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Sr],delete e[fp],delete e[t_],delete e[mH],delete e[yH])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function ZD(t){return t.tag===5||t.tag===3||t.tag===4}function Ek(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||ZD(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function m_(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Ey));else if(s!==4&&(t=t.child,t!==null))for(m_(t,e,n),t=t.sibling;t!==null;)m_(t,e,n),t=t.sibling}function y_(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(y_(t,e,n),t=t.sibling;t!==null;)y_(t,e,n),t=t.sibling}var _n=null,$i=!1;function Qo(t,e,n){for(n=n.child;n!==null;)JD(t,e,n),n=n.sibling}function JD(t,e,n){if(Nr&&typeof Nr.onCommitFiberUnmount=="function")try{Nr.onCommitFiberUnmount(cx,n)}catch{}switch(n.tag){case 5:Yn||Kc(n,e);case 6:var s=_n,i=$i;_n=null,Qo(t,e,n),_n=s,$i=i,_n!==null&&($i?(t=_n,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):_n.removeChild(n.stateNode));break;case 18:_n!==null&&($i?(t=_n,n=n.stateNode,t.nodeType===8?ub(t.parentNode,n):t.nodeType===1&&ub(t,n),cp(t)):ub(_n,n.stateNode));break;case 4:s=_n,i=$i,_n=n.stateNode.containerInfo,$i=!0,Qo(t,e,n),_n=s,$i=i;break;case 0:case 11:case 14:case 15:if(!Yn&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var r=i,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&f_(n,e,o),i=i.next}while(i!==s)}Qo(t,e,n);break;case 1:if(!Yn&&(Kc(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(l){$t(n,e,l)}Qo(t,e,n);break;case 21:Qo(t,e,n);break;case 22:n.mode&1?(Yn=(s=Yn)||n.memoizedState!==null,Qo(t,e,n),Yn=s):Qo(t,e,n);break;default:Qo(t,e,n)}}function Tk(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new RH),e.forEach(function(s){var i=WH.bind(null,t,s);n.has(s)||(n.add(s),s.then(i,i))})}}function Bi(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var i=n[s];try{var r=t,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:_n=l.stateNode,$i=!1;break e;case 3:_n=l.stateNode.containerInfo,$i=!0;break e;case 4:_n=l.stateNode.containerInfo,$i=!0;break e}l=l.return}if(_n===null)throw Error(ie(160));JD(r,o,i),_n=null,$i=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(d){$t(i,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)QD(e,t),e=e.sibling}function QD(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Bi(e,t),hr(t),s&4){try{Bh(3,t,t.return),yx(3,t)}catch(y){$t(t,t.return,y)}try{Bh(5,t,t.return)}catch(y){$t(t,t.return,y)}}break;case 1:Bi(e,t),hr(t),s&512&&n!==null&&Kc(n,n.return);break;case 5:if(Bi(e,t),hr(t),s&512&&n!==null&&Kc(n,n.return),t.flags&32){var i=t.stateNode;try{rp(i,"")}catch(y){$t(t,t.return,y)}}if(s&4&&(i=t.stateNode,i!=null)){var r=t.memoizedProps,o=n!==null?n.memoizedProps:r,l=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{l==="input"&&r.type==="radio"&&r.name!=null&&bO(i,r),$0(l,o);var d=$0(l,r);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?TO(i,h):u==="dangerouslySetInnerHTML"?CO(i,h):u==="children"?rp(i,h):cE(i,u,h,d)}switch(l){case"input":D0(i,r);break;case"textarea":wO(i,r);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!r.multiple;var f=r.value;f!=null?ad(i,!!r.multiple,f,!1):p!==!!r.multiple&&(r.defaultValue!=null?ad(i,!!r.multiple,r.defaultValue,!0):ad(i,!!r.multiple,r.multiple?[]:"",!1))}i[fp]=r}catch(y){$t(t,t.return,y)}}break;case 6:if(Bi(e,t),hr(t),s&4){if(t.stateNode===null)throw Error(ie(162));i=t.stateNode,r=t.memoizedProps;try{i.nodeValue=r}catch(y){$t(t,t.return,y)}}break;case 3:if(Bi(e,t),hr(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{cp(e.containerInfo)}catch(y){$t(t,t.return,y)}break;case 4:Bi(e,t),hr(t);break;case 13:Bi(e,t),hr(t),i=t.child,i.flags&8192&&(r=i.memoizedState!==null,i.stateNode.isHidden=r,!r||i.alternate!==null&&i.alternate.memoizedState!==null||(zE=Vt())),s&4&&Tk(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Yn=(d=Yn)||u,Bi(e,t),Yn=d):Bi(e,t),hr(t),s&8192){if(d=t.memoizedState!==null,(t.stateNode.isHidden=d)&&!u&&t.mode&1)for(fe=t,u=t.child;u!==null;){for(h=fe=u;fe!==null;){switch(p=fe,f=p.child,p.tag){case 0:case 11:case 14:case 15:Bh(4,p,p.return);break;case 1:Kc(p,p.return);var g=p.stateNode;if(typeof g.componentWillUnmount=="function"){s=p,n=p.return;try{e=s,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){$t(s,n,y)}}break;case 5:Kc(p,p.return);break;case 22:if(p.memoizedState!==null){Pk(h);continue}}f!==null?(f.return=p,fe=f):Pk(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,d?(r=i.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=EO("display",o))}catch(y){$t(t,t.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(y){$t(t,t.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Bi(e,t),hr(t),s&4&&Tk(t);break;case 21:break;default:Bi(e,t),hr(t)}}function hr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(ZD(n)){var s=n;break e}n=n.return}throw Error(ie(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(rp(i,""),s.flags&=-33);var r=Ek(t);y_(t,r,i);break;case 3:case 4:var o=s.stateNode.containerInfo,l=Ek(t);m_(t,l,o);break;default:throw Error(ie(161))}}catch(c){$t(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function OH(t,e,n){fe=t,e2(t)}function e2(t,e,n){for(var s=(t.mode&1)!==0;fe!==null;){var i=fe,r=i.child;if(i.tag===22&&s){var o=i.memoizedState!==null||hg;if(!o){var l=i.alternate,c=l!==null&&l.memoizedState!==null||Yn;l=hg;var d=Yn;if(hg=o,(Yn=c)&&!d)for(fe=i;fe!==null;)o=fe,c=o.child,o.tag===22&&o.memoizedState!==null?kk(i):c!==null?(c.return=o,fe=c):kk(i);for(;r!==null;)fe=r,e2(r),r=r.sibling;fe=i,hg=l,Yn=d}Ik(t)}else i.subtreeFlags&8772&&r!==null?(r.return=i,fe=r):Ik(t)}}function Ik(t){for(;fe!==null;){var e=fe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Yn||yx(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!Yn)if(n===null)s.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Ui(e.type,n.memoizedProps);s.componentDidUpdate(i,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&uk(e,r,s);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}uk(e,o,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&cp(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ie(163))}Yn||e.flags&512&&g_(e)}catch(p){$t(e,e.return,p)}}if(e===t){fe=null;break}if(n=e.sibling,n!==null){n.return=e.return,fe=n;break}fe=e.return}}function Pk(t){for(;fe!==null;){var e=fe;if(e===t){fe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,fe=n;break}fe=e.return}}function kk(t){for(;fe!==null;){var e=fe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{yx(4,e)}catch(c){$t(e,n,c)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var i=e.return;try{s.componentDidMount()}catch(c){$t(e,i,c)}}var r=e.return;try{g_(e)}catch(c){$t(e,r,c)}break;case 5:var o=e.return;try{g_(e)}catch(c){$t(e,o,c)}}}catch(c){$t(e,e.return,c)}if(e===t){fe=null;break}var l=e.sibling;if(l!==null){l.return=e.return,fe=l;break}fe=e.return}}var DH=Math.ceil,Dy=Bo.ReactCurrentDispatcher,UE=Bo.ReactCurrentOwner,Pi=Bo.ReactCurrentBatchConfig,qe=0,fn=null,Jt=null,Nn=0,Xs=0,Yc=Ja(0),nn=0,Sp=null,$l=0,vx=0,$E=0,Uh=null,ks=null,zE=0,jd=1/0,io=null,Ly=!1,v_=null,Pa=null,pg=!1,ya=null,Fy=0,$h=0,x_=null,Sm=-1,bm=0;function hs(){return qe&6?Vt():Sm!==-1?Sm:Sm=Vt()}function ka(t){return t.mode&1?qe&2&&Nn!==0?Nn&-Nn:xH.transition!==null?(bm===0&&(bm=FO()),bm):(t=rt,t!==0||(t=window.event,t=t===void 0?16:GO(t.type)),t):1}function Zi(t,e,n,s){if(50<$h)throw $h=0,x_=null,Error(ie(185));ef(t,n,s),(!(qe&2)||t!==fn)&&(t===fn&&(!(qe&2)&&(vx|=n),nn===4&&da(t,Nn)),Us(t,s),n===1&&qe===0&&!(e.mode&1)&&(jd=Vt()+500,fx&&Qa()))}function Us(t,e){var n=t.callbackNode;x9(t,e);var s=by(t,t===fn?Nn:0);if(s===0)n!==null&&FP(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&FP(n),e===1)t.tag===0?vH(jk.bind(null,t)):dD(jk.bind(null,t)),fH(function(){!(qe&6)&&Qa()}),n=null;else{switch(BO(s)){case 1:n=fE;break;case 4:n=DO;break;case 16:n=Sy;break;case 536870912:n=LO;break;default:n=Sy}n=l2(n,t2.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function t2(t,e){if(Sm=-1,bm=0,qe&6)throw Error(ie(327));var n=t.callbackNode;if(hd()&&t.callbackNode!==n)return null;var s=by(t,t===fn?Nn:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=By(t,s);else{e=s;var i=qe;qe|=2;var r=s2();(fn!==t||Nn!==e)&&(io=null,jd=Vt()+500,Rl(t,e));do try{BH();break}catch(l){n2(t,l)}while(!0);IE(),Dy.current=r,qe=i,Jt!==null?e=0:(fn=null,Nn=0,e=nn)}if(e!==0){if(e===2&&(i=V0(t),i!==0&&(s=i,e=S_(t,i))),e===1)throw n=Sp,Rl(t,0),da(t,s),Us(t,Vt()),n;if(e===6)da(t,s);else{if(i=t.current.alternate,!(s&30)&&!LH(i)&&(e=By(t,s),e===2&&(r=V0(t),r!==0&&(s=r,e=S_(t,r))),e===1))throw n=Sp,Rl(t,0),da(t,s),Us(t,Vt()),n;switch(t.finishedWork=i,t.finishedLanes=s,e){case 0:case 1:throw Error(ie(345));case 2:bl(t,ks,io);break;case 3:if(da(t,s),(s&130023424)===s&&(e=zE+500-Vt(),10<e)){if(by(t,0)!==0)break;if(i=t.suspendedLanes,(i&s)!==s){hs(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=e_(bl.bind(null,t,ks,io),e);break}bl(t,ks,io);break;case 4:if(da(t,s),(s&4194240)===s)break;for(e=t.eventTimes,i=-1;0<s;){var o=31-qi(s);r=1<<o,o=e[o],o>i&&(i=o),s&=~r}if(s=i,s=Vt()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*DH(s/1960))-s,10<s){t.timeoutHandle=e_(bl.bind(null,t,ks,io),s);break}bl(t,ks,io);break;case 5:bl(t,ks,io);break;default:throw Error(ie(329))}}}return Us(t,Vt()),t.callbackNode===n?t2.bind(null,t):null}function S_(t,e){var n=Uh;return t.current.memoizedState.isDehydrated&&(Rl(t,e).flags|=256),t=By(t,e),t!==2&&(e=ks,ks=n,e!==null&&b_(e)),t}function b_(t){ks===null?ks=t:ks.push.apply(ks,t)}function LH(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var i=n[s],r=i.getSnapshot;i=i.value;try{if(!nr(r(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function da(t,e){for(e&=~$E,e&=~vx,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-qi(e),s=1<<n;t[n]=-1,e&=~s}}function jk(t){if(qe&6)throw Error(ie(327));hd();var e=by(t,0);if(!(e&1))return Us(t,Vt()),null;var n=By(t,e);if(t.tag!==0&&n===2){var s=V0(t);s!==0&&(e=s,n=S_(t,s))}if(n===1)throw n=Sp,Rl(t,0),da(t,e),Us(t,Vt()),n;if(n===6)throw Error(ie(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,bl(t,ks,io),Us(t,Vt()),null}function WE(t,e){var n=qe;qe|=1;try{return t(e)}finally{qe=n,qe===0&&(jd=Vt()+500,fx&&Qa())}}function zl(t){ya!==null&&ya.tag===0&&!(qe&6)&&hd();var e=qe;qe|=1;var n=Pi.transition,s=rt;try{if(Pi.transition=null,rt=1,t)return t()}finally{rt=s,Pi.transition=n,qe=e,!(qe&6)&&Qa()}}function HE(){Xs=Yc.current,Et(Yc)}function Rl(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,pH(n)),Jt!==null)for(n=Jt.return;n!==null;){var s=n;switch(CE(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Ty();break;case 3:Pd(),Et(Fs),Et(Jn),RE();break;case 5:AE(s);break;case 4:Pd();break;case 13:Et(At);break;case 19:Et(At);break;case 10:PE(s.type._context);break;case 22:case 23:HE()}n=n.return}if(fn=t,Jt=t=ja(t.current,null),Nn=Xs=e,nn=0,Sp=null,$E=vx=$l=0,ks=Uh=null,Il!==null){for(e=0;e<Il.length;e++)if(n=Il[e],s=n.interleaved,s!==null){n.interleaved=null;var i=s.next,r=n.pending;if(r!==null){var o=r.next;r.next=i,s.next=o}n.pending=s}Il=null}return t}function n2(t,e){do{var n=Jt;try{if(IE(),ym.current=Oy,My){for(var s=Dt.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}My=!1}if(Ul=0,ln=Qt=Dt=null,Fh=!1,yp=0,UE.current=null,n===null||n.return===null){nn=1,Sp=e,Jt=null;break}e:{var r=t,o=n.return,l=n,c=e;if(e=Nn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=yk(o);if(f!==null){f.flags&=-257,vk(f,o,l,r,e),f.mode&1&&mk(r,d,e),e=f,c=d;var g=e.updateQueue;if(g===null){var y=new Set;y.add(c),e.updateQueue=y}else g.add(c);break e}else{if(!(e&1)){mk(r,d,e),GE();break e}c=Error(ie(426))}}else if(Pt&&l.mode&1){var x=yk(o);if(x!==null){!(x.flags&65536)&&(x.flags|=256),vk(x,o,l,r,e),EE(kd(c,l));break e}}r=c=kd(c,l),nn!==4&&(nn=2),Uh===null?Uh=[r]:Uh.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var m=BD(r,c,e);dk(r,m);break e;case 1:l=c;var v=r.type,w=r.stateNode;if(!(r.flags&128)&&(typeof v.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(Pa===null||!Pa.has(w)))){r.flags|=65536,e&=-e,r.lanes|=e;var _=UD(r,l,e);dk(r,_);break e}}r=r.return}while(r!==null)}r2(n)}catch(C){e=C,Jt===n&&n!==null&&(Jt=n=n.return);continue}break}while(!0)}function s2(){var t=Dy.current;return Dy.current=Oy,t===null?Oy:t}function GE(){(nn===0||nn===3||nn===2)&&(nn=4),fn===null||!($l&268435455)&&!(vx&268435455)||da(fn,Nn)}function By(t,e){var n=qe;qe|=2;var s=s2();(fn!==t||Nn!==e)&&(io=null,Rl(t,e));do try{FH();break}catch(i){n2(t,i)}while(!0);if(IE(),qe=n,Dy.current=s,Jt!==null)throw Error(ie(261));return fn=null,Nn=0,nn}function FH(){for(;Jt!==null;)i2(Jt)}function BH(){for(;Jt!==null&&!d9();)i2(Jt)}function i2(t){var e=a2(t.alternate,t,Xs);t.memoizedProps=t.pendingProps,e===null?r2(t):Jt=e,UE.current=null}function r2(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=AH(n,e),n!==null){n.flags&=32767,Jt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{nn=6,Jt=null;return}}else if(n=NH(n,e,Xs),n!==null){Jt=n;return}if(e=e.sibling,e!==null){Jt=e;return}Jt=e=t}while(e!==null);nn===0&&(nn=5)}function bl(t,e,n){var s=rt,i=Pi.transition;try{Pi.transition=null,rt=1,UH(t,e,n,s)}finally{Pi.transition=i,rt=s}return null}function UH(t,e,n,s){do hd();while(ya!==null);if(qe&6)throw Error(ie(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(ie(177));t.callbackNode=null,t.callbackPriority=0;var r=n.lanes|n.childLanes;if(S9(t,r),t===fn&&(Jt=fn=null,Nn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||pg||(pg=!0,l2(Sy,function(){return hd(),null})),r=(n.flags&15990)!==0,n.subtreeFlags&15990||r){r=Pi.transition,Pi.transition=null;var o=rt;rt=1;var l=qe;qe|=4,UE.current=null,MH(t,n),QD(n,t),oH(J0),wy=!!Z0,J0=Z0=null,t.current=n,OH(n),u9(),qe=l,rt=o,Pi.transition=r}else t.current=n;if(pg&&(pg=!1,ya=t,Fy=i),r=t.pendingLanes,r===0&&(Pa=null),f9(n.stateNode),Us(t,Vt()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],s(i.value,{componentStack:i.stack,digest:i.digest});if(Ly)throw Ly=!1,t=v_,v_=null,t;return Fy&1&&t.tag!==0&&hd(),r=t.pendingLanes,r&1?t===x_?$h++:($h=0,x_=t):$h=0,Qa(),null}function hd(){if(ya!==null){var t=BO(Fy),e=Pi.transition,n=rt;try{if(Pi.transition=null,rt=16>t?16:t,ya===null)var s=!1;else{if(t=ya,ya=null,Fy=0,qe&6)throw Error(ie(331));var i=qe;for(qe|=4,fe=t.current;fe!==null;){var r=fe,o=r.child;if(fe.flags&16){var l=r.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(fe=d;fe!==null;){var u=fe;switch(u.tag){case 0:case 11:case 15:Bh(8,u,r)}var h=u.child;if(h!==null)h.return=u,fe=h;else for(;fe!==null;){u=fe;var p=u.sibling,f=u.return;if(qD(u),u===d){fe=null;break}if(p!==null){p.return=f,fe=p;break}fe=f}}}var g=r.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var x=y.sibling;y.sibling=null,y=x}while(y!==null)}}fe=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,fe=o;else e:for(;fe!==null;){if(r=fe,r.flags&2048)switch(r.tag){case 0:case 11:case 15:Bh(9,r,r.return)}var m=r.sibling;if(m!==null){m.return=r.return,fe=m;break e}fe=r.return}}var v=t.current;for(fe=v;fe!==null;){o=fe;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,fe=w;else e:for(o=v;fe!==null;){if(l=fe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:yx(9,l)}}catch(C){$t(l,l.return,C)}if(l===o){fe=null;break e}var _=l.sibling;if(_!==null){_.return=l.return,fe=_;break e}fe=l.return}}if(qe=i,Qa(),Nr&&typeof Nr.onPostCommitFiberRoot=="function")try{Nr.onPostCommitFiberRoot(cx,t)}catch{}s=!0}return s}finally{rt=n,Pi.transition=e}}return!1}function Nk(t,e,n){e=kd(n,e),e=BD(t,e,1),t=Ia(t,e,1),e=hs(),t!==null&&(ef(t,1,e),Us(t,e))}function $t(t,e,n){if(t.tag===3)Nk(t,t,n);else for(;e!==null;){if(e.tag===3){Nk(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(Pa===null||!Pa.has(s))){t=kd(n,t),t=UD(e,t,1),e=Ia(e,t,1),t=hs(),e!==null&&(ef(e,1,t),Us(e,t));break}}e=e.return}}function $H(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=hs(),t.pingedLanes|=t.suspendedLanes&n,fn===t&&(Nn&n)===n&&(nn===4||nn===3&&(Nn&130023424)===Nn&&500>Vt()-zE?Rl(t,0):$E|=n),Us(t,e)}function o2(t,e){e===0&&(t.mode&1?(e=sg,sg<<=1,!(sg&130023424)&&(sg=4194304)):e=1);var n=hs();t=Po(t,e),t!==null&&(ef(t,e,n),Us(t,n))}function zH(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),o2(t,n)}function WH(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(ie(314))}s!==null&&s.delete(e),o2(t,n)}var a2;a2=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Fs.current)Rs=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Rs=!1,jH(t,e,n);Rs=!!(t.flags&131072)}else Rs=!1,Pt&&e.flags&1048576&&uD(e,ky,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;xm(t,e),t=e.pendingProps;var i=Ed(e,Jn.current);ud(e,n),i=OE(null,e,s,t,i,n);var r=DE();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Bs(s)?(r=!0,Iy(e)):r=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,jE(e),i.updater=mx,e.stateNode=i,i._reactInternals=e,a_(e,s,t,n),e=d_(null,e,s,!0,r,n)):(e.tag=0,Pt&&r&&_E(e),as(null,e,i,n),e=e.child),e;case 16:s=e.elementType;e:{switch(xm(t,e),t=e.pendingProps,i=s._init,s=i(s._payload),e.type=s,i=e.tag=GH(s),t=Ui(s,t),i){case 0:e=c_(null,e,s,t,n);break e;case 1:e=bk(null,e,s,t,n);break e;case 11:e=xk(null,e,s,t,n);break e;case 14:e=Sk(null,e,s,Ui(s.type,t),n);break e}throw Error(ie(306,s,""))}return e;case 0:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Ui(s,i),c_(t,e,s,i,n);case 1:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Ui(s,i),bk(t,e,s,i,n);case 3:e:{if(HD(e),t===null)throw Error(ie(387));s=e.pendingProps,r=e.memoizedState,i=r.element,yD(t,e),Ay(e,s,null,n);var o=e.memoizedState;if(s=o.element,r.isDehydrated)if(r={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){i=kd(Error(ie(423)),e),e=wk(t,e,s,n,i);break e}else if(s!==i){i=kd(Error(ie(424)),e),e=wk(t,e,s,n,i);break e}else for(Qs=Ta(e.stateNode.containerInfo.firstChild),ei=e,Pt=!0,Wi=null,n=gD(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Td(),s===i){e=ko(t,e,n);break e}as(t,e,s,n)}e=e.child}return e;case 5:return vD(e),t===null&&i_(e),s=e.type,i=e.pendingProps,r=t!==null?t.memoizedProps:null,o=i.children,Q0(s,i)?o=null:r!==null&&Q0(s,r)&&(e.flags|=32),WD(t,e),as(t,e,o,n),e.child;case 6:return t===null&&i_(e),null;case 13:return GD(t,e,n);case 4:return NE(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=Id(e,null,s,n):as(t,e,s,n),e.child;case 11:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Ui(s,i),xk(t,e,s,i,n);case 7:return as(t,e,e.pendingProps,n),e.child;case 8:return as(t,e,e.pendingProps.children,n),e.child;case 12:return as(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,i=e.pendingProps,r=e.memoizedProps,o=i.value,mt(jy,s._currentValue),s._currentValue=o,r!==null)if(nr(r.value,o)){if(r.children===i.children&&!Fs.current){e=ko(t,e,n);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var l=r.dependencies;if(l!==null){o=r.child;for(var c=l.firstContext;c!==null;){if(c.context===s){if(r.tag===1){c=So(-1,n&-n),c.tag=2;var d=r.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}r.lanes|=n,c=r.alternate,c!==null&&(c.lanes|=n),r_(r.return,n,e),l.lanes|=n;break}c=c.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(ie(341));o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),r_(o,n,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}as(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps.children,ud(e,n),i=ji(i),s=s(i),e.flags|=1,as(t,e,s,n),e.child;case 14:return s=e.type,i=Ui(s,e.pendingProps),i=Ui(s.type,i),Sk(t,e,s,i,n);case 15:return $D(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Ui(s,i),xm(t,e),e.tag=1,Bs(s)?(t=!0,Iy(e)):t=!1,ud(e,n),FD(e,s,i),a_(e,s,i,n),d_(null,e,s,!0,t,n);case 19:return VD(t,e,n);case 22:return zD(t,e,n)}throw Error(ie(156,e.tag))};function l2(t,e){return OO(t,e)}function HH(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ci(t,e,n,s){return new HH(t,e,n,s)}function VE(t){return t=t.prototype,!(!t||!t.isReactComponent)}function GH(t){if(typeof t=="function")return VE(t)?1:0;if(t!=null){if(t=t.$$typeof,t===uE)return 11;if(t===hE)return 14}return 2}function ja(t,e){var n=t.alternate;return n===null?(n=Ci(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function wm(t,e,n,s,i,r){var o=2;if(s=t,typeof t=="function")VE(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Fc:return Ml(n.children,i,r,e);case dE:o=8,i|=8;break;case N0:return t=Ci(12,n,e,i|2),t.elementType=N0,t.lanes=r,t;case A0:return t=Ci(13,n,e,i),t.elementType=A0,t.lanes=r,t;case R0:return t=Ci(19,n,e,i),t.elementType=R0,t.lanes=r,t;case vO:return xx(n,i,r,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case mO:o=10;break e;case yO:o=9;break e;case uE:o=11;break e;case hE:o=14;break e;case aa:o=16,s=null;break e}throw Error(ie(130,t==null?t:typeof t,""))}return e=Ci(o,n,e,i),e.elementType=t,e.type=s,e.lanes=r,e}function Ml(t,e,n,s){return t=Ci(7,t,s,e),t.lanes=n,t}function xx(t,e,n,s){return t=Ci(22,t,s,e),t.elementType=vO,t.lanes=n,t.stateNode={isHidden:!1},t}function xb(t,e,n){return t=Ci(6,t,null,e),t.lanes=n,t}function Sb(t,e,n){return e=Ci(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function VH(t,e,n,s,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=eb(0),this.expirationTimes=eb(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=eb(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function KE(t,e,n,s,i,r,o,l,c){return t=new VH(t,e,n,l,c),e===1?(e=1,r===!0&&(e|=8)):e=0,r=Ci(3,null,null,e),t.current=r,r.stateNode=t,r.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},jE(r),t}function KH(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Lc,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function c2(t){if(!t)return $a;t=t._reactInternals;e:{if(lc(t)!==t||t.tag!==1)throw Error(ie(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Bs(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ie(171))}if(t.tag===1){var n=t.type;if(Bs(n))return cD(t,n,e)}return e}function d2(t,e,n,s,i,r,o,l,c){return t=KE(n,s,!0,t,i,r,o,l,c),t.context=c2(null),n=t.current,s=hs(),i=ka(n),r=So(s,i),r.callback=e??null,Ia(n,r,i),t.current.lanes=i,ef(t,i,s),Us(t,s),t}function Sx(t,e,n,s){var i=e.current,r=hs(),o=ka(i);return n=c2(n),e.context===null?e.context=n:e.pendingContext=n,e=So(r,o),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=Ia(i,e,o),t!==null&&(Zi(t,i,o,r),mm(t,i,o)),o}function Uy(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Ak(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function YE(t,e){Ak(t,e),(t=t.alternate)&&Ak(t,e)}function YH(){return null}var u2=typeof reportError=="function"?reportError:function(t){console.error(t)};function XE(t){this._internalRoot=t}bx.prototype.render=XE.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ie(409));Sx(t,e,null,null)};bx.prototype.unmount=XE.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;zl(function(){Sx(null,t,null,null)}),e[Io]=null}};function bx(t){this._internalRoot=t}bx.prototype.unstable_scheduleHydration=function(t){if(t){var e=zO();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ca.length&&e!==0&&e<ca[n].priority;n++);ca.splice(n,0,t),n===0&&HO(t)}};function qE(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function wx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Rk(){}function XH(t,e,n,s,i){if(i){if(typeof s=="function"){var r=s;s=function(){var d=Uy(o);r.call(d)}}var o=d2(e,s,t,0,null,!1,!1,"",Rk);return t._reactRootContainer=o,t[Io]=o.current,hp(t.nodeType===8?t.parentNode:t),zl(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof s=="function"){var l=s;s=function(){var d=Uy(c);l.call(d)}}var c=KE(t,0,!1,null,null,!1,!1,"",Rk);return t._reactRootContainer=c,t[Io]=c.current,hp(t.nodeType===8?t.parentNode:t),zl(function(){Sx(e,c,n,s)}),c}function _x(t,e,n,s,i){var r=n._reactRootContainer;if(r){var o=r;if(typeof i=="function"){var l=i;i=function(){var c=Uy(o);l.call(c)}}Sx(e,o,t,i)}else o=XH(n,e,t,i,s);return Uy(o)}UO=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=lh(e.pendingLanes);n!==0&&(gE(e,n|1),Us(e,Vt()),!(qe&6)&&(jd=Vt()+500,Qa()))}break;case 13:zl(function(){var s=Po(t,1);if(s!==null){var i=hs();Zi(s,t,1,i)}}),YE(t,1)}};mE=function(t){if(t.tag===13){var e=Po(t,134217728);if(e!==null){var n=hs();Zi(e,t,134217728,n)}YE(t,134217728)}};$O=function(t){if(t.tag===13){var e=ka(t),n=Po(t,e);if(n!==null){var s=hs();Zi(n,t,e,s)}YE(t,e)}};zO=function(){return rt};WO=function(t,e){var n=rt;try{return rt=t,e()}finally{rt=n}};W0=function(t,e,n){switch(e){case"input":if(D0(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var i=px(s);if(!i)throw Error(ie(90));SO(s),D0(s,i)}}}break;case"textarea":wO(t,n);break;case"select":e=n.value,e!=null&&ad(t,!!n.multiple,e,!1)}};kO=WE;jO=zl;var qH={usingClientEntryPoint:!1,Events:[nf,zc,px,IO,PO,WE]},Au={findFiberByHostInstance:Tl,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ZH={bundleType:Au.bundleType,version:Au.version,rendererPackageName:Au.rendererPackageName,rendererConfig:Au.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Bo.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=RO(t),t===null?null:t.stateNode},findFiberByHostInstance:Au.findFiberByHostInstance||YH,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fg.isDisabled&&fg.supportsFiber)try{cx=fg.inject(ZH),Nr=fg}catch{}}li.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qH;li.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qE(e))throw Error(ie(200));return KH(t,e,null,n)};li.createRoot=function(t,e){if(!qE(t))throw Error(ie(299));var n=!1,s="",i=u2;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=KE(t,1,!1,null,null,n,!1,s,i),t[Io]=e.current,hp(t.nodeType===8?t.parentNode:t),new XE(e)};li.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ie(188)):(t=Object.keys(t).join(","),Error(ie(268,t)));return t=RO(e),t=t===null?null:t.stateNode,t};li.flushSync=function(t){return zl(t)};li.hydrate=function(t,e,n){if(!wx(e))throw Error(ie(200));return _x(null,t,e,!0,n)};li.hydrateRoot=function(t,e,n){if(!qE(t))throw Error(ie(405));var s=n!=null&&n.hydratedSources||null,i=!1,r="",o=u2;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(r=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=d2(e,null,t,1,n??null,i,!1,r,o),t[Io]=e.current,hp(t),s)for(t=0;t<s.length;t++)n=s[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new bx(e)};li.render=function(t,e,n){if(!wx(e))throw Error(ie(200));return _x(null,t,e,!1,n)};li.unmountComponentAtNode=function(t){if(!wx(t))throw Error(ie(40));return t._reactRootContainer?(zl(function(){_x(null,null,t,!1,function(){t._reactRootContainer=null,t[Io]=null})}),!0):!1};li.unstable_batchedUpdates=WE;li.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!wx(n))throw Error(ie(200));if(t==null||t._reactInternals===void 0)throw Error(ie(38));return _x(t,e,n,!1,s)};li.version="18.3.1-next-f1338f8080-20240426";function h2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h2)}catch(t){console.error(t)}}h2(),hO.exports=li;var Br=hO.exports;const JH=qa(Br);var ZE,Mk=Br;ZE=k0.createRoot=Mk.createRoot,k0.hydrateRoot=Mk.hydrateRoot;var Ru=function(t){return t&&t.Math===Math&&t},es=Ru(typeof globalThis=="object"&&globalThis)||Ru(typeof window=="object"&&window)||Ru(typeof self=="object"&&self)||Ru(typeof qn=="object"&&qn)||Ru(typeof qn=="object"&&qn)||function(){return this}()||Function("return this")(),JE={},ts=function(t){try{return!!t()}catch{return!0}},QH=ts,Uo=!QH(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),e7=ts,Cx=!e7(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),t7=Cx,gg=Function.prototype.call,$o=t7?gg.bind(gg):function(){return gg.apply(gg,arguments)},p2={},f2={}.propertyIsEnumerable,g2=Object.getOwnPropertyDescriptor,n7=g2&&!f2.call({1:2},1);p2.f=n7?function(e){var n=g2(this,e);return!!n&&n.enumerable}:f2;var QE=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}},m2=Cx,y2=Function.prototype,w_=y2.call,s7=m2&&y2.bind.bind(w_,w_),mn=m2?s7:function(t){return function(){return w_.apply(t,arguments)}},v2=mn,i7=v2({}.toString),r7=v2("".slice),Qd=function(t){return r7(i7(t),8,-1)},o7=mn,a7=ts,l7=Qd,bb=Object,c7=o7("".split),d7=a7(function(){return!bb("z").propertyIsEnumerable(0)})?function(t){return l7(t)==="String"?c7(t,""):bb(t)}:bb,x2=function(t){return t==null},u7=x2,h7=TypeError,eu=function(t){if(u7(t))throw new h7("Can't call method on "+t);return t},p7=d7,f7=eu,Ex=function(t){return p7(f7(t))},wb=typeof document=="object"&&document.all,vs=typeof wb>"u"&&wb!==void 0?function(t){return typeof t=="function"||t===wb}:function(t){return typeof t=="function"},g7=vs,el=function(t){return typeof t=="object"?t!==null:g7(t)},_b=es,m7=vs,y7=function(t){return m7(t)?t:void 0},Tx=function(t,e){return arguments.length<2?y7(_b[t]):_b[t]&&_b[t][e]},v7=mn,S2=v7({}.isPrototypeOf),x7=es,Ok=x7.navigator,Dk=Ok&&Ok.userAgent,S7=Dk?String(Dk):"",b2=es,Cb=S7,Lk=b2.process,Fk=b2.Deno,Bk=Lk&&Lk.versions||Fk&&Fk.version,Uk=Bk&&Bk.v8,Hi,$y;Uk&&(Hi=Uk.split("."),$y=Hi[0]>0&&Hi[0]<4?1:+(Hi[0]+Hi[1]));!$y&&Cb&&(Hi=Cb.match(/Edge\/(\d+)/),(!Hi||Hi[1]>=74)&&(Hi=Cb.match(/Chrome\/(\d+)/),Hi&&($y=+Hi[1])));var b7=$y,$k=b7,w7=ts,_7=es,C7=_7.String,w2=!!Object.getOwnPropertySymbols&&!w7(function(){var t=Symbol("symbol detection");return!C7(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&$k&&$k<41}),E7=w2,_2=E7&&!Symbol.sham&&typeof Symbol.iterator=="symbol",T7=Tx,I7=vs,P7=S2,k7=_2,j7=Object,C2=k7?function(t){return typeof t=="symbol"}:function(t){var e=T7("Symbol");return I7(e)&&P7(e.prototype,j7(t))},N7=String,A7=function(t){try{return N7(t)}catch{return"Object"}},R7=vs,M7=A7,O7=TypeError,eT=function(t){if(R7(t))return t;throw new O7(M7(t)+" is not a function")},D7=eT,L7=x2,tT=function(t,e){var n=t[e];return L7(n)?void 0:D7(n)},Eb=$o,Tb=vs,Ib=el,F7=TypeError,B7=function(t,e){var n,s;if(e==="string"&&Tb(n=t.toString)&&!Ib(s=Eb(n,t))||Tb(n=t.valueOf)&&!Ib(s=Eb(n,t))||e!=="string"&&Tb(n=t.toString)&&!Ib(s=Eb(n,t)))return s;throw new F7("Can't convert object to primitive value")},E2={exports:{}},zk=es,U7=Object.defineProperty,nT=function(t,e){try{U7(zk,t,{value:e,configurable:!0,writable:!0})}catch{zk[t]=e}return e},$7=es,z7=nT,Wk="__core-js_shared__",Hk=E2.exports=$7[Wk]||z7(Wk,{});(Hk.versions||(Hk.versions=[])).push({version:"3.48.0",mode:"global",copyright:" 20132025 Denis Pushkarev (zloirock.ru), 20252026 CoreJS Company (core-js.io). All rights reserved.",license:"https://github.com/zloirock/core-js/blob/v3.48.0/LICENSE",source:"https://github.com/zloirock/core-js"});var sT=E2.exports,Gk=sT,iT=function(t,e){return Gk[t]||(Gk[t]=e||{})},W7=eu,H7=Object,rf=function(t){return H7(W7(t))},G7=mn,V7=rf,K7=G7({}.hasOwnProperty),tl=Object.hasOwn||function(e,n){return K7(V7(e),n)},Y7=mn,X7=0,q7=Math.random(),Z7=Y7(1.1.toString),T2=function(t){return"Symbol("+(t===void 0?"":t)+")_"+Z7(++X7+q7,36)},J7=es,Q7=iT,Vk=tl,eG=T2,tG=w2,nG=_2,Xc=J7.Symbol,Pb=Q7("wks"),sG=nG?Xc.for||Xc:Xc&&Xc.withoutSetter||eG,zo=function(t){return Vk(Pb,t)||(Pb[t]=tG&&Vk(Xc,t)?Xc[t]:sG("Symbol."+t)),Pb[t]},iG=$o,Kk=el,Yk=C2,rG=tT,oG=B7,aG=zo,lG=TypeError,cG=aG("toPrimitive"),dG=function(t,e){if(!Kk(t)||Yk(t))return t;var n=rG(t,cG),s;if(n){if(e===void 0&&(e="default"),s=iG(n,t,e),!Kk(s)||Yk(s))return s;throw new lG("Can't convert object to primitive value")}return e===void 0&&(e="number"),oG(t,e)},uG=dG,hG=C2,I2=function(t){var e=uG(t,"string");return hG(e)?e:e+""},pG=es,Xk=el,__=pG.document,fG=Xk(__)&&Xk(__.createElement),P2=function(t){return fG?__.createElement(t):{}},gG=Uo,mG=ts,yG=P2,k2=!gG&&!mG(function(){return Object.defineProperty(yG("div"),"a",{get:function(){return 7}}).a!==7}),vG=Uo,xG=$o,SG=p2,bG=QE,wG=Ex,_G=I2,CG=tl,EG=k2,qk=Object.getOwnPropertyDescriptor;JE.f=vG?qk:function(e,n){if(e=wG(e),n=_G(n),EG)try{return qk(e,n)}catch{}if(CG(e,n))return bG(!xG(SG.f,e,n),e[n])};var cc={},TG=Uo,IG=ts,j2=TG&&IG(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),PG=el,kG=String,jG=TypeError,dc=function(t){if(PG(t))return t;throw new jG(kG(t)+" is not an object")},NG=Uo,AG=k2,RG=j2,mg=dc,Zk=I2,MG=TypeError,kb=Object.defineProperty,OG=Object.getOwnPropertyDescriptor,jb="enumerable",Nb="configurable",Ab="writable";cc.f=NG?RG?function(e,n,s){if(mg(e),n=Zk(n),mg(s),typeof e=="function"&&n==="prototype"&&"value"in s&&Ab in s&&!s[Ab]){var i=OG(e,n);i&&i[Ab]&&(e[n]=s.value,s={configurable:Nb in s?s[Nb]:i[Nb],enumerable:jb in s?s[jb]:i[jb],writable:!1})}return kb(e,n,s)}:kb:function(e,n,s){if(mg(e),n=Zk(n),mg(s),AG)try{return kb(e,n,s)}catch{}if("get"in s||"set"in s)throw new MG("Accessors not supported");return"value"in s&&(e[n]=s.value),e};var DG=Uo,LG=cc,FG=QE,rT=DG?function(t,e,n){return LG.f(t,e,FG(1,n))}:function(t,e,n){return t[e]=n,t},N2={exports:{}},C_=Uo,BG=tl,A2=Function.prototype,UG=C_&&Object.getOwnPropertyDescriptor,$G=BG(A2,"name"),zG=$G&&(!C_||C_&&UG(A2,"name").configurable),WG={CONFIGURABLE:zG},HG=mn,GG=vs,E_=sT,VG=HG(Function.toString);GG(E_.inspectSource)||(E_.inspectSource=function(t){return VG(t)});var R2=E_.inspectSource,KG=es,YG=vs,Jk=KG.WeakMap,XG=YG(Jk)&&/native code/.test(String(Jk)),qG=iT,ZG=T2,Qk=qG("keys"),M2=function(t){return Qk[t]||(Qk[t]=ZG(t))},oT={},JG=XG,O2=es,QG=rT,Rb=tl,Mb=sT,eV=M2,tV=oT,ej="Object already initialized",tj=O2.TypeError,nV=O2.WeakMap,T_,zy,I_,sV=function(t){return I_(t)?zy(t):T_(t,{})};if(JG||Mb.state){var pr=Mb.state||(Mb.state=new nV);pr.get=pr.get,pr.has=pr.has,pr.set=pr.set,T_=function(t,e){if(pr.has(t))throw new tj(ej);return e.facade=t,pr.set(t,e),e},zy=function(t){return pr.get(t)||{}},I_=function(t){return pr.has(t)}}else{var bc=eV("state");tV[bc]=!0,T_=function(t,e){if(Rb(t,bc))throw new tj(ej);return e.facade=t,QG(t,bc,e),e},zy=function(t){return Rb(t,bc)?t[bc]:{}},I_=function(t){return Rb(t,bc)}}var D2={get:zy,enforce:sV},aT=mn,iV=ts,rV=vs,yg=tl,P_=Uo,oV=WG.CONFIGURABLE,aV=R2,L2=D2,lV=L2.enforce,cV=L2.get,nj=String,_m=Object.defineProperty,dV=aT("".slice),uV=aT("".replace),hV=aT([].join),pV=P_&&!iV(function(){return _m(function(){},"length",{value:8}).length!==8}),fV=String(String).split("String"),gV=N2.exports=function(t,e,n){dV(nj(e),0,7)==="Symbol("&&(e="["+uV(nj(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!yg(t,"name")||oV&&t.name!==e)&&(P_?_m(t,"name",{value:e,configurable:!0}):t.name=e),pV&&n&&yg(n,"arity")&&t.length!==n.arity&&_m(t,"length",{value:n.arity});try{n&&yg(n,"constructor")&&n.constructor?P_&&_m(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch{}var s=lV(t);return yg(s,"source")||(s.source=hV(fV,typeof e=="string"?e:"")),t};Function.prototype.toString=gV(function(){return rV(this)&&cV(this).source||aV(this)},"toString");var mV=N2.exports,yV=vs,vV=cc,xV=mV,SV=nT,F2=function(t,e,n,s){s||(s={});var i=s.enumerable,r=s.name!==void 0?s.name:e;if(yV(n)&&xV(n,r,s),s.global)i?t[e]=n:SV(e,n);else{try{s.unsafe?t[e]&&(i=!0):delete t[e]}catch{}i?t[e]=n:vV.f(t,e,{value:n,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return t},B2={},bV=Math.ceil,wV=Math.floor,_V=Math.trunc||function(e){var n=+e;return(n>0?wV:bV)(n)},CV=_V,uc=function(t){var e=+t;return e!==e||e===0?0:CV(e)},EV=uc,TV=Math.max,IV=Math.min,PV=function(t,e){var n=EV(t);return n<0?TV(n+e,0):IV(n,e)},kV=uc,jV=Math.min,U2=function(t){var e=kV(t);return e>0?jV(e,9007199254740991):0},NV=U2,of=function(t){return NV(t.length)},AV=Ex,RV=PV,MV=of,OV=function(t){return function(e,n,s){var i=AV(e),r=MV(i);if(r===0)return!t&&-1;var o=RV(s,r),l;if(t&&n!==n){for(;r>o;)if(l=i[o++],l!==l)return!0}else for(;r>o;o++)if((t||o in i)&&i[o]===n)return t||o||0;return!t&&-1}},DV={indexOf:OV(!1)},LV=mn,Ob=tl,FV=Ex,BV=DV.indexOf,UV=oT,sj=LV([].push),$2=function(t,e){var n=FV(t),s=0,i=[],r;for(r in n)!Ob(UV,r)&&Ob(n,r)&&sj(i,r);for(;e.length>s;)Ob(n,r=e[s++])&&(~BV(i,r)||sj(i,r));return i},lT=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],$V=$2,zV=lT,WV=zV.concat("length","prototype");B2.f=Object.getOwnPropertyNames||function(e){return $V(e,WV)};var z2={};z2.f=Object.getOwnPropertySymbols;var HV=Tx,GV=mn,VV=B2,KV=z2,YV=dc,XV=GV([].concat),qV=HV("Reflect","ownKeys")||function(e){var n=VV.f(YV(e)),s=KV.f;return s?XV(n,s(e)):n},ij=tl,ZV=qV,JV=JE,QV=cc,eK=function(t,e,n){for(var s=ZV(e),i=QV.f,r=JV.f,o=0;o<s.length;o++){var l=s[o];!ij(t,l)&&!(n&&ij(n,l))&&i(t,l,r(e,l))}},tK=ts,nK=vs,sK=/#|\.prototype\./,af=function(t,e){var n=rK[iK(t)];return n===aK?!0:n===oK?!1:nK(e)?tK(e):!!e},iK=af.normalize=function(t){return String(t).replace(sK,".").toLowerCase()},rK=af.data={},oK=af.NATIVE="N",aK=af.POLYFILL="P",lK=af,vg=es,cK=JE.f,dK=rT,uK=F2,hK=nT,pK=eK,fK=lK,tu=function(t,e){var n=t.target,s=t.global,i=t.stat,r,o,l,c,d,u;if(s?o=vg:i?o=vg[n]||hK(n,{}):o=vg[n]&&vg[n].prototype,o)for(l in e){if(d=e[l],t.dontCallGetSet?(u=cK(o,l),c=u&&u.value):c=o[l],r=fK(s?l:n+(i?".":"#")+l,t.forced),!r&&c!==void 0){if(typeof d==typeof c)continue;pK(d,c)}(t.sham||c&&c.sham)&&dK(d,"sham",!0),uK(o,l,d,t)}},W2={},gK=$2,mK=lT,yK=Object.keys||function(e){return gK(e,mK)},vK=Uo,xK=j2,SK=cc,bK=dc,wK=Ex,_K=yK;W2.f=vK&&!xK?Object.defineProperties:function(e,n){bK(e);for(var s=wK(n),i=_K(n),r=i.length,o=0,l;r>o;)SK.f(e,l=i[o++],s[l]);return e};var CK=Tx,EK=CK("document","documentElement"),TK=dc,IK=W2,rj=lT,PK=oT,kK=EK,jK=P2,NK=M2,oj=">",aj="<",k_="prototype",j_="script",H2=NK("IE_PROTO"),Db=function(){},G2=function(t){return aj+j_+oj+t+aj+"/"+j_+oj},lj=function(t){t.write(G2("")),t.close();var e=t.parentWindow.Object;return t=null,e},AK=function(){var t=jK("iframe"),e="java"+j_+":",n;return t.style.display="none",kK.appendChild(t),t.src=String(e),n=t.contentWindow.document,n.open(),n.write(G2("document.F=Object")),n.close(),n.F},xg,Cm=function(){try{xg=new ActiveXObject("htmlfile")}catch{}Cm=typeof document<"u"?document.domain&&xg?lj(xg):AK():lj(xg);for(var t=rj.length;t--;)delete Cm[k_][rj[t]];return Cm()};PK[H2]=!0;var V2=Object.create||function(e,n){var s;return e!==null?(Db[k_]=TK(e),s=new Db,Db[k_]=null,s[H2]=e):s=Cm(),n===void 0?s:IK.f(s,n)},RK=zo,MK=V2,OK=cc.f,N_=RK("unscopables"),A_=Array.prototype;A_[N_]===void 0&&OK(A_,N_,{configurable:!0,value:MK(null)});var cT=function(t){A_[N_][t]=!0},DK=tu,LK=rf,FK=of,BK=uc,UK=cT;DK({target:"Array",proto:!0},{at:function(e){var n=LK(this),s=FK(n),i=BK(e),r=i>=0?i:s+i;return r<0||r>=s?void 0:n[r]}});UK("at");var $K=es,zK=mn,lf=function(t,e){return zK($K[t].prototype[e])},WK=lf;WK("Array","at");var HK=Qd,K2=Array.isArray||function(e){return HK(e)==="Array"},GK=TypeError,VK=9007199254740991,KK=function(t){if(t>VK)throw GK("Maximum allowed index exceeded");return t},YK=Qd,XK=mn,qK=function(t){if(YK(t)==="Function")return XK(t)},cj=qK,ZK=eT,JK=Cx,QK=cj(cj.bind),eY=function(t,e){return ZK(t),e===void 0?t:JK?QK(t,e):function(){return t.apply(e,arguments)}},tY=Uo,nY=cc,sY=QE,iY=function(t,e,n){tY?nY.f(t,e,sY(0,n)):t[e]=n},rY=K2,oY=of,aY=KK,lY=eY,cY=iY,Y2=function(t,e,n,s,i,r,o,l){for(var c=i,d=0,u=o?lY(o,l):!1,h,p;d<s;)d in n&&(h=u?u(n[d],d,e):n[d],r>0&&rY(h)?(p=oY(h),c=Y2(t,e,h,p,c,r-1)-1):(aY(c+1),cY(t,c,h)),c++),d++;return c},X2=Y2,dY=zo,uY=dY("toStringTag"),q2={};q2[uY]="z";var hY=String(q2)==="[object z]",pY=hY,fY=vs,Em=Qd,gY=zo,mY=gY("toStringTag"),yY=Object,vY=Em(function(){return arguments}())==="Arguments",xY=function(t,e){try{return t[e]}catch{}},Z2=pY?Em:function(t){var e,n,s;return t===void 0?"Undefined":t===null?"Null":typeof(n=xY(e=yY(t),mY))=="string"?n:vY?Em(e):(s=Em(e))==="Object"&&fY(e.callee)?"Arguments":s},SY=mn,bY=ts,J2=vs,wY=Z2,_Y=Tx,CY=R2,Q2=function(){},eL=_Y("Reflect","construct"),dT=/^\s*(?:class|function)\b/,EY=SY(dT.exec),TY=!dT.test(Q2),Mu=function(e){if(!J2(e))return!1;try{return eL(Q2,[],e),!0}catch{return!1}},tL=function(e){if(!J2(e))return!1;switch(wY(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return TY||!!EY(dT,CY(e))}catch{return!0}};tL.sham=!0;var IY=!eL||bY(function(){var t;return Mu(Mu.call)||!Mu(Object)||!Mu(function(){t=!0})||t})?tL:Mu,dj=K2,PY=IY,kY=el,jY=zo,NY=jY("species"),uj=Array,AY=function(t){var e;return dj(t)&&(e=t.constructor,PY(e)&&(e===uj||dj(e.prototype))?e=void 0:kY(e)&&(e=e[NY],e===null&&(e=void 0))),e===void 0?uj:e},RY=AY,nL=function(t,e){return new(RY(t))(e===0?0:e)},MY=tu,OY=X2,DY=eT,LY=rf,FY=of,BY=nL;MY({target:"Array",proto:!0},{flatMap:function(e){var n=LY(this),s=FY(n),i;return DY(e),i=BY(n,0),OY(i,n,n,s,0,1,e,arguments.length>1?arguments[1]:void 0),i}});var UY=cT;UY("flatMap");var $Y=lf;$Y("Array","flatMap");var zY=tu,WY=X2,HY=rf,GY=of,VY=uc,KY=nL;zY({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,n=HY(this),s=GY(n),i=KY(n,0);return WY(i,n,n,s,0,e===void 0?1:VY(e)),i}});var YY=cT;YY("flat");var XY=lf;XY("Array","flat");var qY=Z2,ZY=String,cf=function(t){if(qY(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return ZY(t)},JY=tu,QY=mn,eX=eu,tX=uc,nX=cf,sX=ts,iX=QY("".charAt),rX=sX(function(){return"".at(-2)!=="\uD842"});JY({target:"String",proto:!0,forced:rX},{at:function(e){var n=nX(eX(this)),s=n.length,i=tX(e),r=i>=0?i:s+i;return r<0||r>=s?void 0:iX(n,r)}});var oX=lf;oX("String","at");var aX=dc,sL=function(){var t=aX(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},uT=ts,lX=es,hT=lX.RegExp,iL=uT(function(){var t=hT("a","y");return t.lastIndex=2,t.exec("abcd")!==null});iL||uT(function(){return!hT("a","y").sticky});var cX=iL||uT(function(){var t=hT("^r","gy");return t.lastIndex=2,t.exec("str")!==null}),dX={BROKEN_CARET:cX},uX=ts,hX=es,pX=hX.RegExp,fX=uX(function(){var t=pX(".","s");return!(t.dotAll&&t.test(`
`)&&t.flags==="s")}),gX=ts,mX=es,yX=mX.RegExp,vX=gX(function(){var t=yX("(?<a>b)","g");return t.exec("b").groups.a!=="b"||"b".replace(t,"$<a>c")!=="bc"}),qc=$o,Ix=mn,xX=cf,SX=sL,bX=dX,wX=iT,_X=V2,CX=D2.get,EX=fX,TX=vX,IX=wX("native-string-replace",String.prototype.replace),Wy=RegExp.prototype.exec,R_=Wy,PX=Ix("".charAt),kX=Ix("".indexOf),jX=Ix("".replace),Lb=Ix("".slice),M_=function(){var t=/a/,e=/b*/g;return qc(Wy,t,"a"),qc(Wy,e,"a"),t.lastIndex!==0||e.lastIndex!==0}(),rL=bX.BROKEN_CARET,O_=/()??/.exec("")[1]!==void 0,NX=M_||O_||rL||EX||TX;NX&&(R_=function(e){var n=this,s=CX(n),i=xX(e),r=s.raw,o,l,c,d,u,h,p;if(r)return r.lastIndex=n.lastIndex,o=qc(R_,r,i),n.lastIndex=r.lastIndex,o;var f=s.groups,g=rL&&n.sticky,y=qc(SX,n),x=n.source,m=0,v=i;if(g&&(y=jX(y,"y",""),kX(y,"g")===-1&&(y+="g"),v=Lb(i,n.lastIndex),n.lastIndex>0&&(!n.multiline||n.multiline&&PX(i,n.lastIndex-1)!==`
`)&&(x="(?: "+x+")",v=" "+v,m++),l=new RegExp("^(?:"+x+")",y)),O_&&(l=new RegExp("^"+x+"$(?!\\s)",y)),M_&&(c=n.lastIndex),d=qc(Wy,g?l:n,v),g?d?(d.input=Lb(d.input,m),d[0]=Lb(d[0],m),d.index=n.lastIndex,n.lastIndex+=d[0].length):n.lastIndex=0:M_&&d&&(n.lastIndex=n.global?d.index+d[0].length:c),O_&&d&&d.length>1&&qc(IX,d[0],l,function(){for(u=1;u<arguments.length-2;u++)arguments[u]===void 0&&(d[u]=void 0)}),d&&f)for(d.groups=h=_X(null),u=0;u<f.length;u++)p=f[u],h[p[0]]=d[p[1]];return d});var pT=R_,AX=tu,hj=pT;AX({target:"RegExp",proto:!0,forced:/./.exec!==hj},{exec:hj});var RX=Cx,oL=Function.prototype,pj=oL.apply,fj=oL.call,MX=typeof Reflect=="object"&&Reflect.apply||(RX?fj.bind(pj):function(){return fj.apply(pj,arguments)}),gj=$o,mj=F2,OX=pT,yj=ts,aL=zo,DX=rT,LX=aL("species"),Fb=RegExp.prototype,FX=function(t,e,n,s){var i=aL(t),r=!yj(function(){var d={};return d[i]=function(){return 7},""[t](d)!==7}),o=r&&!yj(function(){var d=!1,u=/a/;if(t==="split"){var h={};h[LX]=function(){return u},u={constructor:h,flags:""},u[i]=/./[i]}return u.exec=function(){return d=!0,null},u[i](""),!d});if(!r||!o||n){var l=/./[i],c=e(i,""[t],function(d,u,h,p,f){var g=u.exec;return g===OX||g===Fb.exec?r&&!f?{done:!0,value:gj(l,u,h,p)}:{done:!0,value:gj(d,h,u,p)}:{done:!1}});mj(String.prototype,t,c[0]),mj(Fb,i,c[1])}s&&DX(Fb[i],"sham",!0)},fT=mn,BX=uc,UX=cf,$X=eu,zX=fT("".charAt),vj=fT("".charCodeAt),WX=fT("".slice),HX=function(t){return function(e,n){var s=UX($X(e)),i=BX(n),r=s.length,o,l;return i<0||i>=r?t?"":void 0:(o=vj(s,i),o<55296||o>56319||i+1===r||(l=vj(s,i+1))<56320||l>57343?t?zX(s,i):o:t?WX(s,i,i+2):(o-55296<<10)+(l-56320)+65536)}},GX={charAt:HX(!0)},VX=GX.charAt,KX=function(t,e,n){return e+(n?VX(t,e).length:1)},gT=mn,YX=rf,XX=Math.floor,Bb=gT("".charAt),qX=gT("".replace),Ub=gT("".slice),ZX=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,JX=/\$([$&'`]|\d{1,2})/g,lL=function(t,e,n,s,i,r){var o=n+t.length,l=s.length,c=JX;return i!==void 0&&(i=YX(i),c=ZX),qX(r,c,function(d,u){var h;switch(Bb(u,0)){case"$":return"$";case"&":return t;case"`":return Ub(e,0,n);case"'":return Ub(e,o);case"<":h=i[Ub(u,1,-1)];break;default:var p=+u;if(p===0)return d;if(p>l){var f=XX(p/10);return f===0?d:f<=l?s[f-1]===void 0?Bb(u,1):s[f-1]+Bb(u,1):d}h=s[p-1]}return h===void 0?"":h})},QX=es,eq=ts,xj=QX.RegExp,tq=!eq(function(){var t=!0;try{xj(".","d")}catch{t=!1}var e={},n="",s=t?"dgimsy":"gimsy",i=function(c,d){Object.defineProperty(e,c,{get:function(){return n+=d,!0}})},r={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};t&&(r.hasIndices="d");for(var o in r)i(o,r[o]);var l=Object.getOwnPropertyDescriptor(xj.prototype,"flags").get.call(e);return l!==s||n!==s}),nq={correct:tq},sq=$o,iq=tl,rq=S2,Sj=nq,oq=sL,aq=RegExp.prototype,cL=Sj.correct?function(t){return t.flags}:function(t){return!Sj.correct&&rq(aq,t)&&!iq(t,"flags")?sq(oq,t):t.flags},bj=$o,lq=dc,cq=vs,dq=Qd,uq=pT,hq=TypeError,pq=function(t,e){var n=t.exec;if(cq(n)){var s=bj(n,t,e);return s!==null&&lq(s),s}if(dq(t)==="RegExp")return bj(uq,t,e);throw new hq("RegExp#exec called on incompatible receiver")},fq=MX,wj=$o,Px=mn,gq=FX,mq=ts,yq=dc,vq=vs,xq=el,Sq=uc,bq=U2,ml=cf,wq=eu,_q=KX,Cq=tT,Eq=lL,Tq=cL,Iq=pq,Pq=zo,D_=Pq("replace"),kq=Math.max,jq=Math.min,Nq=Px([].concat),$b=Px([].push),Sg=Px("".indexOf),_j=Px("".slice),Aq=function(t){return t===void 0?t:String(t)},Rq=function(){return"a".replace(/./,"$0")==="$0"}(),Cj=function(){return/./[D_]?/./[D_]("a","$0")==="":!1}(),Mq=!mq(function(){var t=/./;return t.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(t,"$<a>")!=="7"});gq("replace",function(t,e,n){var s=Cj?"$":"$0";return[function(r,o){var l=wq(this),c=xq(r)?Cq(r,D_):void 0;return c?wj(c,r,l,o):wj(e,ml(l),r,o)},function(i,r){var o=yq(this),l=ml(i);if(typeof r=="string"&&Sg(r,s)===-1&&Sg(r,"$<")===-1){var c=n(e,o,l,r);if(c.done)return c.value}var d=vq(r);d||(r=ml(r));var u=ml(Tq(o)),h=Sg(u,"g")!==-1,p;h&&(p=Sg(u,"u")!==-1,o.lastIndex=0);for(var f=[],g;g=Iq(o,l),!(g===null||($b(f,g),!h));){var y=ml(g[0]);y===""&&(o.lastIndex=_q(l,bq(o.lastIndex),p))}for(var x="",m=0,v=0;v<f.length;v++){g=f[v];for(var w=ml(g[0]),_=kq(jq(Sq(g.index),l.length),0),C=[],I,T=1;T<g.length;T++)$b(C,Aq(g[T]));var P=g.groups;if(d){var k=Nq([w],C,_,l);P!==void 0&&$b(k,P),I=ml(fq(r,void 0,k))}else I=Eq(w,l,_,C,P,r);_>=m&&(x+=_j(l,m,_)+I,m=_+w.length)}return x+_j(l,m)}]},!Mq||!Rq||Cj);var Oq=el,Dq=Qd,Lq=zo,Fq=Lq("match"),Bq=function(t){var e;return Oq(t)&&((e=t[Fq])!==void 0?!!e:Dq(t)==="RegExp")},Uq=tu,$q=$o,mT=mn,Ej=eu,zq=vs,Wq=el,Hq=Bq,Ou=cf,Gq=tT,Vq=cL,Kq=lL,Yq=zo,Xq=Yq("replace"),qq=TypeError,zb=mT("".indexOf);mT("".replace);var Tj=mT("".slice),Zq=Math.max;Uq({target:"String",proto:!0},{replaceAll:function(e,n){var s=Ej(this),i,r,o,l,c,d,u,h,p,f,g=0,y="";if(Wq(e)){if(i=Hq(e),i&&(r=Ou(Ej(Vq(e))),!~zb(r,"g")))throw new qq("`.replaceAll` does not allow non-global regexes");if(o=Gq(e,Xq),o)return $q(o,e,s,n)}for(l=Ou(s),c=Ou(e),d=zq(n),d||(n=Ou(n)),u=c.length,h=Zq(1,u),p=zb(l,c);p!==-1;)f=d?Ou(n(c,p,l)):Kq(c,l,p,[],void 0,n),y+=Tj(l,g,p)+f,g=p+u,p=p+h>l.length?-1:zb(l,c,p+h);return g<l.length&&(y+=Tj(l,g)),y}});var Jq=lf;Jq("String","replaceAll");function dL(t){return t&&typeof t=="object"&&"parents"in t}function uL(t){for(let e=0,n=t.parents.length;e<n;e++)if(t.parents[e].__unsafe__getWithoutCapture(!0),t.parents[e].lastChangedEpoch!==t.parentEpochs[e])return!0;return!1}const Hy=(t,e)=>{if(t.children.remove(e)&&t.children.isEmpty&&dL(t))for(let n=0,s=t.parents.length;n<s;n++)Hy(t.parents[n],t)},yT=(t,e)=>{if(t.children.add(e)&&dL(t))for(let n=0,s=t.parents.length;n<s;n++)yT(t.parents[n],t)};function hL(t,e){return t===e||Object.is(t,e)||!!(t&&e&&typeof t.equals=="function"&&t.equals(e))}function nl(t,e){const n=Symbol.for(`com.tldraw.state/${t}`),s=globalThis;return s[n]??(s[n]=e()),s[n]}const bo=nl("empty_array",()=>Object.freeze([])),Ij=8;class Gy{constructor(){b(this,"arraySize",0);b(this,"array",Array(Ij));b(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<Ij?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const n=this.array.indexOf(e);return n===-1?!1:(this.array[n]=void 0,this.arraySize--,n!==this.arraySize&&(this.array[n]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let n=0;n<this.arraySize;n++){const s=this.array[n];typeof s<"u"&&e(s)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const ti=Symbol.for("com.tldraw.state/RESET_VALUE");class pL{constructor(e){b(this,"index",0);b(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,n,s){if(s!==void 0){if(s===ti){this.clear();return}this.buffer[this.index]=[e,n,s],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:n,capacity:s,buffer:i}=this;for(let r=0;r<s;r++){const o=(n-1+s-r)%s,l=i[o];if(!l)return ti;const[c,d]=l;if(r===0&&e>=d)return[];if(c<=e&&e<d){const u=r+1,h=new Array(u);for(let p=0;p<u;p++)h[p]=i[(o+p)%s][2];return h}}return ti}}class Qq{constructor(e,n){b(this,"offset",0);b(this,"maybeRemoved");this.below=e,this.child=n}}const Tt=nl("capture",()=>({stack:null}));function bg(t){const e=Tt.stack;Tt.stack=null;try{return t()}finally{Tt.stack=e}}function fL(t){Tt.stack=new Qq(Tt.stack,t),t.parentSet.clear()}function gL(){const t=Tt.stack;if(Tt.stack=t.below,t.offset<t.child.parents.length){for(let e=t.offset;e<t.child.parents.length;e++){const n=t.child.parents[e];t.child.parentSet.has(n)||Hy(n,t.child)}t.child.parents.length=t.offset,t.child.parentEpochs.length=t.offset}if(t.maybeRemoved)for(let e=0;e<t.maybeRemoved.length;e++){const n=t.maybeRemoved[e];t.child.parentSet.has(n)||Hy(n,t.child)}}function Vy(t){if(Tt.stack){if(Tt.stack.child.parentSet.has(t))return;if(Tt.stack.child.parentSet.add(t),Tt.stack.child.isActivelyListening&&yT(t,Tt.stack.child),Tt.stack.offset<Tt.stack.child.parents.length){const n=Tt.stack.child.parents[Tt.stack.offset];n!==t&&(Tt.stack.maybeRemoved?Tt.stack.maybeRemoved.push(n):Tt.stack.maybeRemoved=[n])}Tt.stack.child.parents[Tt.stack.offset]=t,Tt.stack.child.parentEpochs[Tt.stack.offset]=t.lastChangedEpoch,Tt.stack.offset++}}const va=-1;class eZ{constructor(e,n,s){b(this,"_isActivelyListening",!1);b(this,"lastTraversedEpoch",va);b(this,"lastReactedEpoch",va);b(this,"_scheduleCount",0);b(this,"parentSet",new Gy);b(this,"parentEpochs",[]);b(this,"parents",[]);b(this,"_scheduleEffect");b(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=n,this._scheduleEffect=s==null?void 0:s.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Is()){if(this.parents.length&&!uL(this)){this.lastReactedEpoch=Is();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,n=this.parents.length;e<n;e++)yT(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,n=this.parents.length;e<n;e++)Hy(this.parents[e],this)}execute(){try{fL(this);const e=Is(),n=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,n}finally{gL()}}}const nu=nl("EffectScheduler",()=>eZ);function hc(t,e,n){const s=new nu(t,e,n);return s.attach(),s.scheduleEffect(),()=>{s.detach()}}function tZ(t,e,n){const s=new nu(t,e,n);return{scheduler:s,start:i=>{const r=(i==null?void 0:i.force)??!1;s.attach(),r?s.scheduleEffect():s.maybeScheduleEffect()},stop:()=>{s.detach()}}}class nZ{constructor(e){b(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){this.isRoot?mL(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,n)=>{this.parent.initialAtomValues.has(n)||this.parent.initialAtomValues.set(n,e)})}abort(){at.globalEpoch++,this.initialAtomValues.forEach((e,n)=>{var s;n.set(e),(s=n.historyBuffer)==null||s.clear()}),this.commit()}}const at=nl("transactions",()=>({globalEpoch:va+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:va+1}));function sZ(){return at.reactionEpoch}function Is(){return at.globalEpoch}function iZ(){return at.globalIsReacting}function vT(t,e){e.lastTraversedEpoch!==at.globalEpoch&&(e.lastTraversedEpoch=at.globalEpoch,e instanceof nu?t.add(e):e.children.visit(n=>vT(t,n)))}function mL(t){var e;if(at.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{at.globalIsReacting=!0,at.reactionEpoch=at.globalEpoch;const n=new Set;for(const i of t)i.children.visit(r=>vT(n,r));for(const i of n)i.maybeScheduleEffect();let s=0;for(;(e=at.cleanupReactors)!=null&&e.size;){if(s++>1e3)throw new Error("Reaction update depth limit exceeded");const i=at.cleanupReactors;at.cleanupReactors=null;for(const r of i)r.maybeScheduleEffect()}}finally{at.cleanupReactors=null,at.globalIsReacting=!1}}function rZ(t,e){if(at.globalIsReacting){const n=at.cleanupReactors??(at.cleanupReactors=new Set);t.children.visit(s=>vT(n,s))}else at.currentTransaction?at.currentTransaction.initialAtomValues.has(t)||at.currentTransaction.initialAtomValues.set(t,e):mL([t])}function oZ(){at.globalEpoch++}function aZ(t){const e=new nZ(at.currentTransaction);at.currentTransaction=e;try{let n,s=!1;try{n=t(()=>s=!0)}catch(i){throw e.abort(),i}return s?e.abort():e.commit(),n}finally{at.currentTransaction=at.currentTransaction.parent}}function Rr(t){return at.currentTransaction?t():aZ(t)}class lZ{constructor(e,n,s){b(this,"isEqual");b(this,"computeDiff");b(this,"lastChangedEpoch",Is());b(this,"children",new Gy);b(this,"historyBuffer");this.name=e,this.current=n,this.isEqual=(s==null?void 0:s.isEqual)??null,s&&(s.historyLength&&(this.historyBuffer=new pL(s.historyLength)),this.computeDiff=s.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return Vy(this),this.current}set(e,n){var i,r;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,e))??hL(this.current,e))return this.current;oZ(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Is(),n??((r=this.computeDiff)==null?void 0:r.call(this,this.current,e,this.lastChangedEpoch,Is()))??ti),this.lastChangedEpoch=Is();const s=this.current;return this.current=e,rZ(this,s),e}update(e){return this.set(e(this.current))}getDiffSince(e){var n;return Vy(this),e>=this.lastChangedEpoch?bo:((n=this.historyBuffer)==null?void 0:n.getChangesSince(e))??ti}}const cZ=nl("Atom",()=>lZ);function dn(t,e,n){return new cZ(t,e,n)}let Pj=!1;function dZ(){Pj||(Pj=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const dh=Symbol.for("com.tldraw.state/UNINITIALIZED"),Ol=t=>t===dh,L_=nl("WithDiff",()=>class{constructor(e,n){this.value=e,this.diff=n}});function uh(t,e){return new L_(t,e)}class uZ{constructor(e,n,s){b(this,"lastChangedEpoch",va);b(this,"lastTraversedEpoch",va);b(this,"lastCheckedEpoch",va);b(this,"parentSet",new Gy);b(this,"parents",[]);b(this,"parentEpochs",[]);b(this,"children",new Gy);b(this,"historyBuffer");b(this,"state",dh);b(this,"error",null);b(this,"computeDiff");b(this,"isEqual");this.name=e,this.derive=n,s!=null&&s.historyLength&&(this.historyBuffer=new pL(s.historyLength)),this.computeDiff=s==null?void 0:s.computeDiff,this.isEqual=(s==null?void 0:s.isEqual)??hL}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var i;const n=this.lastChangedEpoch===va,s=Is();if(!n&&(this.lastCheckedEpoch===s||this.isActivelyListening&&iZ()&&this.lastTraversedEpoch<sZ()||!uL(this)))if(this.lastCheckedEpoch=s,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{fL(this);const r=this.derive(this.state,this.lastCheckedEpoch),o=r instanceof L_?r.value:r,l=this.state===dh;if(l||!this.isEqual(o,this.state)){if(this.historyBuffer&&!l){const c=r instanceof L_?r.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Is(),c??((i=this.computeDiff)==null?void 0:i.call(this,this.state,o,this.lastCheckedEpoch,Is()))??ti)}this.lastChangedEpoch=Is(),this.state=o}return this.error=null,this.lastCheckedEpoch=Is(),this.state}catch(r){if(this.state!==dh&&(this.state=dh,this.lastChangedEpoch=Is()),this.lastCheckedEpoch=Is(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:r},!e)throw r;return this.state}finally{gL()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Vy(this)}}getDiffSince(e){var n;return this.__unsafe__getWithoutCapture(!0),Vy(this),e>=this.lastChangedEpoch?bo:((n=this.historyBuffer)==null?void 0:n.getChangesSince(e))??ti}}const xT=nl("Computed",()=>uZ);function hZ(t={},e,n,s){const i=s.value,r=Symbol.for("__@tldraw/state__computed__"+n);return s.value=function(){let o=this[r];return o||(o=new xT(n,i.bind(this),t),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},s.value[fZ]=!0,s}function kj(t={},e,n,s){return s.get?(dZ(),pZ(t,e,n,s)):hZ(t,e,n,s)}function pZ(t={},e,n,s){const i=s.get,r=Symbol.for("__@tldraw/state__computed__"+n);return s.get=function(){let o=this[r];return o||(o=new xT(n,i.bind(this),t),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},s}const fZ="@@__isComputedMethod__@@";function te(){if(arguments.length===1){const t=arguments[0];return(e,n,s)=>kj(t,e,n,s)}else return typeof arguments[0]=="string"?new xT(arguments[0],arguments[1],arguments[2]):kj(void 0,arguments[0],arguments[1],arguments[2])}const yL=1,gZ=nl("apiVersion",()=>yL);if(gZ!==yL)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");var vL="Expected a function",jj=NaN,mZ="[object Symbol]",yZ=/^\s+|\s+$/g,vZ=/^[-+]0x[0-9a-f]+$/i,xZ=/^0b[01]+$/i,SZ=/^0o[0-7]+$/i,bZ=parseInt,wZ=typeof qn=="object"&&qn&&qn.Object===Object&&qn,_Z=typeof self=="object"&&self&&self.Object===Object&&self,CZ=wZ||_Z||Function("return this")(),EZ=Object.prototype,TZ=EZ.toString,IZ=Math.max,PZ=Math.min,Wb=function(){return CZ.Date.now()};function kZ(t,e,n){var s,i,r,o,l,c,d=0,u=!1,h=!1,p=!0;if(typeof t!="function")throw new TypeError(vL);e=Nj(e)||0,Ky(n)&&(u=!!n.leading,h="maxWait"in n,r=h?IZ(Nj(n.maxWait)||0,e):r,p="trailing"in n?!!n.trailing:p);function f(I){var T=s,P=i;return s=i=void 0,d=I,o=t.apply(P,T),o}function g(I){return d=I,l=setTimeout(m,e),u?f(I):o}function y(I){var T=I-c,P=I-d,k=e-T;return h?PZ(k,r-P):k}function x(I){var T=I-c,P=I-d;return c===void 0||T>=e||T<0||h&&P>=r}function m(){var I=Wb();if(x(I))return v(I);l=setTimeout(m,y(I))}function v(I){return l=void 0,p&&s?f(I):(s=i=void 0,o)}function w(){l!==void 0&&clearTimeout(l),d=0,s=c=i=l=void 0}function _(){return l===void 0?o:v(Wb())}function C(){var I=Wb(),T=x(I);if(s=arguments,i=this,c=I,T){if(l===void 0)return g(c);if(h)return l=setTimeout(m,e),f(c)}return l===void 0&&(l=setTimeout(m,e)),o}return C.cancel=w,C.flush=_,C}function jZ(t,e,n){var s=!0,i=!0;if(typeof t!="function")throw new TypeError(vL);return Ky(n)&&(s="leading"in n?!!n.leading:s,i="trailing"in n?!!n.trailing:i),kZ(t,e,{leading:s,maxWait:e,trailing:i})}function Ky(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function NZ(t){return!!t&&typeof t=="object"}function AZ(t){return typeof t=="symbol"||NZ(t)&&TZ.call(t)==mZ}function Nj(t){if(typeof t=="number")return t;if(AZ(t))return jj;if(Ky(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Ky(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(yZ,"");var n=xZ.test(t);return n||SZ.test(t)?bZ(t.slice(2),n?2:8):vZ.test(t)?jj:+t}var RZ=jZ;const xL=qa(RZ);var MZ=200,ST="__lodash_hash_undefined__",OZ=1/0,DZ="[object Function]",LZ="[object GeneratorFunction]",FZ=/[\\^$.*+?()[\]{}|]/g,BZ=/^\[object .+?Constructor\]$/,UZ=typeof qn=="object"&&qn&&qn.Object===Object&&qn,$Z=typeof self=="object"&&self&&self.Object===Object&&self,bT=UZ||$Z||Function("return this")();function zZ(t,e){var n=t?t.length:0;return!!n&&HZ(t,e,0)>-1}function WZ(t,e,n,s){for(var i=t.length,r=n+-1;++r<i;)if(e(t[r],r,t))return r;return-1}function HZ(t,e,n){if(e!==e)return WZ(t,GZ,n);for(var s=n-1,i=t.length;++s<i;)if(t[s]===e)return s;return-1}function GZ(t){return t!==t}function VZ(t,e){return t.has(e)}function KZ(t,e){return t==null?void 0:t[e]}function YZ(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}function SL(t){var e=-1,n=Array(t.size);return t.forEach(function(s){n[++e]=s}),n}var XZ=Array.prototype,qZ=Function.prototype,bL=Object.prototype,Hb=bT["__core-js_shared__"],Aj=function(){var t=/[^.]+$/.exec(Hb&&Hb.keys&&Hb.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),wL=qZ.toString,wT=bL.hasOwnProperty,ZZ=bL.toString,JZ=RegExp("^"+wL.call(wT).replace(FZ,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),QZ=XZ.splice,eJ=_T(bT,"Map"),Gb=_T(bT,"Set"),bp=_T(Object,"create");function Wl(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function tJ(){this.__data__=bp?bp(null):{}}function nJ(t){return this.has(t)&&delete this.__data__[t]}function sJ(t){var e=this.__data__;if(bp){var n=e[t];return n===ST?void 0:n}return wT.call(e,t)?e[t]:void 0}function iJ(t){var e=this.__data__;return bp?e[t]!==void 0:wT.call(e,t)}function rJ(t,e){var n=this.__data__;return n[t]=bp&&e===void 0?ST:e,this}Wl.prototype.clear=tJ;Wl.prototype.delete=nJ;Wl.prototype.get=sJ;Wl.prototype.has=iJ;Wl.prototype.set=rJ;function su(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function oJ(){this.__data__=[]}function aJ(t){var e=this.__data__,n=kx(e,t);if(n<0)return!1;var s=e.length-1;return n==s?e.pop():QZ.call(e,n,1),!0}function lJ(t){var e=this.__data__,n=kx(e,t);return n<0?void 0:e[n][1]}function cJ(t){return kx(this.__data__,t)>-1}function dJ(t,e){var n=this.__data__,s=kx(n,t);return s<0?n.push([t,e]):n[s][1]=e,this}su.prototype.clear=oJ;su.prototype.delete=aJ;su.prototype.get=lJ;su.prototype.has=cJ;su.prototype.set=dJ;function iu(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var s=t[e];this.set(s[0],s[1])}}function uJ(){this.__data__={hash:new Wl,map:new(eJ||su),string:new Wl}}function hJ(t){return jx(this,t).delete(t)}function pJ(t){return jx(this,t).get(t)}function fJ(t){return jx(this,t).has(t)}function gJ(t,e){return jx(this,t).set(t,e),this}iu.prototype.clear=uJ;iu.prototype.delete=hJ;iu.prototype.get=pJ;iu.prototype.has=fJ;iu.prototype.set=gJ;function Yy(t){var e=-1,n=t?t.length:0;for(this.__data__=new iu;++e<n;)this.add(t[e])}function mJ(t){return this.__data__.set(t,ST),this}function yJ(t){return this.__data__.has(t)}Yy.prototype.add=Yy.prototype.push=mJ;Yy.prototype.has=yJ;function kx(t,e){for(var n=t.length;n--;)if(EJ(t[n][0],e))return n;return-1}function vJ(t){if(!_L(t)||wJ(t))return!1;var e=TJ(t)||YZ(t)?JZ:BZ;return e.test(_J(t))}function xJ(t,e,n){var s=-1,i=zZ,r=t.length,o=!0,l=[],c=l;if(r>=MZ){var d=SJ(t);if(d)return SL(d);o=!1,i=VZ,c=new Yy}else c=l;e:for(;++s<r;){var u=t[s],h=u;if(u=u!==0?u:0,o&&h===h){for(var p=c.length;p--;)if(c[p]===h)continue e;l.push(u)}else i(c,h,n)||(c!==l&&c.push(h),l.push(u))}return l}var SJ=Gb&&1/SL(new Gb([,-0]))[1]==OZ?function(t){return new Gb(t)}:IJ;function jx(t,e){var n=t.__data__;return bJ(e)?n[typeof e=="string"?"string":"hash"]:n.map}function _T(t,e){var n=KZ(t,e);return vJ(n)?n:void 0}function bJ(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function wJ(t){return!!Aj&&Aj in t}function _J(t){if(t!=null){try{return wL.call(t)}catch{}try{return t+""}catch{}}return""}function CJ(t){return t&&t.length?xJ(t):[]}function EJ(t,e){return t===e||t!==t&&e!==e}function TJ(t){var e=_L(t)?ZZ.call(t):"";return e==DZ||e==LZ}function _L(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function IJ(){}var PJ=CJ;const kJ=qa(PJ),hh={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},jJ=hh.Good;class CL{constructor(){b(this,"startTime",0);b(this,"name","");b(this,"frames",0);b(this,"started",!1);b(this,"frame",null);b(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,n=e===0?0:Math.floor(this.frames/e),s=n>55?hh.Good:n>30?hh.Mid:hh.Poor,i=s===hh.Mid?"black":"white",r=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${r} %c${n}%c fps`,`color: white; background: ${jJ};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${s};color: ${i};`,"font-weight: normal")}isStarted(){return this.started}}function CT(t,e){const n=[];e:for(const s of t){for(const i of n)if(e?e(s,i):s===i)continue e;n.push(s)}return n}function Re(t){return t.filter(e=>e!=null)}function Tn(t){return t[t.length-1]}function NJ(t,e){let n,s=1/0;for(const i of t){const r=e(i);r<s&&(n=i,s=r)}return n}function AJ(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Object.is(t[n],e[n]))return!1;return!0}class jo{constructor(){b(this,"items",new WeakMap)}get(e,n){return this.items.has(e)||this.items.set(e,n(e)),this.items.get(e)}}function EL(t){const e=(...n)=>{try{return t(...n)}catch(s){throw s instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(s,e),s}};return e}const wp=()=>{},Na={ok(t){return{ok:!0,value:t}},err(t){return{ok:!1,error:t}}};function Zn(t,e){const n=e&&t&&typeof t=="object"&&e in t?t[e]:t;throw new Error(`Unknown switch case ${n}`)}const xt=EL((t,e)=>{if(!t)throw new Error(e||"Assertion Error")}),wi=EL((t,e)=>{if(t==null)throw new Error(e??"value must be defined");return t});function TL(t,e){let n;const s=(...i)=>(n||(n={},n.promise=new Promise((r,o)=>{n.resolve=r,n.reject=o})),clearTimeout(n.timeout),n.latestArgs=i,n.timeout=setTimeout(()=>{const r=n;n=void 0;try{r.resolve(t(...r.latestArgs))}catch(o){r.reject(o)}},e),n.promise);return s.cancel=()=>{n&&clearTimeout(n.timeout)},s}const Rj=new WeakMap;function ET(t,e){if(typeof t!="object"||t===null)return;let n=Rj.get(t);n||(n={tags:{},extras:{}},Rj.set(t,n)),e.tags&&(n.tags={...n.tags,...e.tags}),e.extras&&(n.extras={...n.extras,...e.extras})}async function Ur(t,e){return window.fetch(t,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const Nd=(t,e)=>{const n=new window.Image(t,e);return n.referrerPolicy="strict-origin-when-cross-origin",n};class Dl{static async dataUrlToArrayBuffer(e){return Ur(e).then(function(n){return n.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((n,s)=>{if(e){const i=new FileReader;i.onload=()=>n(i.result),i.onerror=r=>s(r),i.onabort=r=>s(r),i.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((n,s)=>{if(e){const i=new FileReader;i.onload=()=>n(i.result),i.onerror=r=>s(r),i.onabort=r=>s(r),i.readAsText(e)}})}}function F_(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e+""}function RJ(t){const e=new DataView(t);let n=0;for(let s=0;s<e.byteLength;s++)n=(n<<5)-n+e.getUint8(s),n|=0;return n+""}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function MJ(t){const e=new Uint8Array(t);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function s(r,o,l,c,d=1024){if(!o)return-1;o=new RegExp(o,"g");const u=o.source.length,h=new TextDecoder,p=r.length;if(typeof c>"u"&&(c=p),l>=p||c<=0||l>=c)return-1;r=r.subarray(l,c);let f=-1,g=0,y=0,x="";e:for(;g<r.length;){const m=g+d,v=r.subarray(g,m),w=h.decode(v,{stream:!0}),_=x+w;let C,I=-1;for(;(C=o.exec(_))!==null;){I=C.index-x.length,f=y+I;break e}g=m,y+=w.length;const T=I>-1?I+u:w.length-u;x=w.slice(T)}return f>=0&&(f+=l>=0?l:p+l),f}const i=s(e,"IDAT",12);return i>=12?s(e,"acTL",8,i)>=8:!1}const OJ=t=>new Uint8Array(t)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Jzef Sokoowski <j.k.sokolowski@gmail.com>
 */function Mj(t,e){let n=0;for(;t[e+n];)n+=t[e+n]+1;return n+1}function DJ(t){return new TextDecoder("ascii").decode(t.slice(0,3))==="GIF"}function LJ(t){const e=new Uint8Array(t);let n,s,i=0,r=0;if(!DJ(t))return!1;for(n=e[10]&128,s=e[10]&7,i+=6,i+=7,i+=n?3*Math.pow(2,s+1):0;r<2&&i<e.length;)switch(e[i]){case 44:r+=1,n=e[i+9]&128,s=e[i+9]&7,i+=10,i+=n?3*Math.pow(2,s+1):0,i+=Mj(e,i+1)+1;break;case 33:i+=2,i+=Mj(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return r>1}let B_=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(B_=new Int32Array(B_));/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */const FJ=(t,e)=>{let n=-1;for(let s=0;s<t.length;s++)n=B_[(n^t[s])&255]^n>>>8;return n^-1},Oj=4,Dj=4;class br{static isPng(e,n){return e.getUint8(n+0)===137&&e.getUint8(n+1)===80&&e.getUint8(n+2)===78&&e.getUint8(n+3)===71&&e.getUint8(n+4)===13&&e.getUint8(n+5)===10&&e.getUint8(n+6)===26&&e.getUint8(n+7)===10}static getChunkType(e,n){return[String.fromCharCode(e.getUint8(n)),String.fromCharCode(e.getUint8(n+1)),String.fromCharCode(e.getUint8(n+2)),String.fromCharCode(e.getUint8(n+3))].join("")}static readChunks(e,n=0){const s={};if(!br.isPng(e,n))throw new Error("Not a PNG");for(n+=8;n<=e.buffer.byteLength;){const i=n,r=e.getInt32(n);n+=4;const o=br.getChunkType(e,n);if(o==="IDAT"&&s[o]){n+=r+Oj+Dj;continue}if(o==="IEND")break;s[o]={start:i,dataOffset:n+4,size:r},n+=r+Oj+Dj}return s}static parsePhys(e,n){return{ppux:e.getUint32(n),ppuy:e.getUint32(n+4),unit:e.getUint8(n+4)}}static findChunk(e,n){return br.readChunks(e)[n]}static setPhysChunk(e,n=1,s){let i=46,r=0;const o=br.findChunk(e,"pHYs");o&&(i=o.start,r=o.size);const l=br.findChunk(e,"IDAT");l&&(i=l.start,r=0);const c=new ArrayBuffer(21),d=new DataView(c);d.setUint32(0,9),d.setUint8(4,112),d.setUint8(5,72),d.setUint8(6,89),d.setUint8(7,115);const u=2835.5;d.setInt32(8,u*n),d.setInt32(12,u*n),d.setInt8(16,1);const h=new Uint8Array(c.slice(4,17));d.setInt32(17,FJ(h));const p=e.buffer.slice(0,i),f=e.buffer.slice(i+r);return new Blob([p,c,f],s)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function BJ(t){return!t||t.length<12?!1:t[8]===87&&t[9]===69&&t[10]===66&&t[11]===80}function UJ(t){const e=new Uint8Array(t);return!BJ(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const IL=Object.freeze(["image/svg+xml"]),PL=Object.freeze(["image/jpeg","image/png","image/webp"]),kL=Object.freeze(["image/gif","image/apng","image/avif"]),TT=Object.freeze([...PL,...IL,...kL]),jL=Object.freeze(["video/mp4","video/webm","video/quicktime"]),$J=[...TT,...jL].join(",");class Er{static loadVideo(e){return new Promise((n,s)=>{const i=document.createElement("video");i.onloadeddata=()=>n(i),i.onerror=r=>{console.error(r),s(new Error("Could not load video"))},i.crossOrigin="anonymous",i.src=e})}static loadImage(e){return new Promise((n,s)=>{const i=Nd();i.onload=()=>n(i),i.onerror=r=>{console.error(r),s(new Error("Could not load image"))},i.crossOrigin="anonymous",i.referrerPolicy="strict-origin-when-cross-origin",i.src=e})}static async getVideoSize(e){return Er.usingObjectURL(e,async n=>{const s=await Er.loadVideo(n);return{w:s.videoWidth,h:s.videoHeight}})}static async getImageSize(e){const n=await Er.usingObjectURL(e,Er.loadImage);try{if(e.type==="image/png"){const s=new DataView(await e.arrayBuffer());if(br.isPng(s,0)){const i=br.findChunk(s,"pHYs");if(i){const r=br.parsePhys(s,i.dataOffset);if(r.unit===0&&r.ppux===r.ppuy){const o=Math.max(r.ppux/2834.5,1);return{w:Math.round(n.naturalWidth/o),h:Math.round(n.naturalHeight/o)}}}}}}catch(s){return console.error(s),{w:n.naturalWidth,h:n.naturalHeight}}return{w:n.naturalWidth,h:n.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?LJ(await e.arrayBuffer()):e.type==="image/avif"?OJ(await e.arrayBuffer()):e.type==="image/webp"?UJ(await e.arrayBuffer()):e.type==="image/apng"?MJ(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return kL.includes(e||"")}static isStaticImageType(e){return PL.includes(e||"")}static isVectorImageType(e){return IL.includes(e||"")}static isImageType(e){return TT.includes(e)}static async usingObjectURL(e,n){const s=URL.createObjectURL(e);try{return await n(s)}finally{URL.revokeObjectURL(s)}}}function js(t,e,n){return t+(e-t)*n}function or(t=""){let e=0,n=0,s=0,i=0;function r(){const o=e^e<<11;return e=n,n=s,s=i,i^=(i>>>19^o^o>>>8)>>>0,i/4294967296*2}for(let o=0;o<t.length+64;o++)e^=t.charCodeAt(o)|0,r();return r}function Ad(t,e,n,s=!1){const[i,r]=e,[o,l]=n,c=o+(t-i)/(r-i)*(l-o);return s?o<l?Math.max(Math.min(c,l),o):Math.max(Math.min(c,o),l):c}function Mr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ms(t,e){if(Mr(t,e))return t[e]}function Lj(t){return Object.keys(t)}function Ut(t){return Object.values(t)}function $s(t){return Object.entries(t)}function NL(t){return Object.fromEntries(t)}function zh(t,e){const n={};let s=!1;for(const[i,r]of $s(t))e(i,r)?n[i]=r:s=!0;return s?n:t}function df(t,e){const n={};for(const[s,i]of $s(t)){const r=e(s,i);n[s]=r}return n}function AL(t,e){if(t===e)return!0;const n=new Set(Object.keys(t)),s=new Set(Object.keys(e));if(n.size!==s.size)return!1;for(const i of n)if(!s.has(i)||!Object.is(t[i],e[i]))return!1;return!0}const Js="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",RL="a0",ML="A00000000000000000000000000";function OL(t){if(t>="a"&&t<="z")return t.charCodeAt(0)-97+2;if(t>="A"&&t<="Z")return 90-t.charCodeAt(0)+2;throw new Error("Invalid index key head: "+t)}function DL(t){if(t.length!==OL(t.charAt(0)))throw new Error("invalid integer part of index key: "+t)}function Fj(t){if(t===void 0)throw Error("n is undefined")}function Bj(t){DL(t);const[e,...n]=t.split("");let s=!0;for(let i=n.length-1;s&&i>=0;i--){const r=Js.indexOf(n[i])+1;r===Js.length?n[i]="0":(n[i]=Js.charAt(r),s=!1)}if(s){if(e==="Z")return"a0";if(e==="z")return;const i=String.fromCharCode(e.charCodeAt(0)+1);return i>"a"?n.push("0"):n.pop(),i+n.join("")}else return e+n.join("")}function zJ(t){DL(t);const[e,...n]=t.split("");let s=!0;for(let i=n.length-1;s&&i>=0;i--){const r=Js.indexOf(n[i])-1;r===-1?n[i]=Js.slice(-1):(n[i]=Js.charAt(r),s=!1)}if(s){if(e==="a")return"Z"+Js.slice(-1);if(e==="A")return;const i=String.fromCharCode(e.charCodeAt(0)-1);return i<"Z"?n.push(Js.slice(-1)):n.pop(),i+n.join("")}else return e+n.join("")}function Zc(t,e){if(e!==void 0&&t>=e)throw new Error(t+" >= "+e);if(t.slice(-1)==="0"||e&&e.slice(-1)==="0")throw new Error("trailing zero");if(e){let i=0;for(;(t.charAt(i)||"0")===e.charAt(i);)i++;if(i>0)return e.slice(0,i)+Zc(t.slice(i),e.slice(i))}const n=t?Js.indexOf(t.charAt(0)):0,s=e!==void 0?Js.indexOf(e.charAt(0)):Js.length;if(s-n>1){const i=Math.round(.5*(n+s));return Js.charAt(i)}else return e&&e.length>1?e.slice(0,1):Js.charAt(n)+Zc(t.slice(1),void 0)}function ph(t){const e=OL(t.charAt(0));if(e>t.length)throw new Error("invalid index: "+t);return t.slice(0,e)}function U_(t){if(t===ML)throw new Error("invalid index: "+t);const e=ph(t);if(t.slice(e.length).slice(-1)==="0")throw new Error("invalid index: "+t)}function wc(t,e){if(t!==void 0&&U_(t),e!==void 0&&U_(e),t!==void 0&&e!==void 0&&t>=e)throw new Error(t+" >= "+e);if(t===void 0&&e===void 0)return RL;if(t===void 0){if(e===void 0)throw Error("b is undefined");const l=ph(e),c=e.slice(l.length);if(l===ML)return l+Zc("",c);if(l<e)return l;const d=zJ(l);return Fj(d),d}if(e===void 0){const l=ph(t),c=t.slice(l.length),d=Bj(l);return d===void 0?l+Zc(c,void 0):d}const n=ph(t),s=t.slice(n.length),i=ph(e),r=e.slice(i.length);if(n===i)return n+Zc(s,r);const o=Bj(n);return Fj(o),o<e?o:n+Zc(s,void 0)}function za(t,e,n){if(n===0)return[];if(n===1)return[wc(t,e)];if(e===void 0){let r=wc(t,e);const o=[r];for(let l=0;l<n-1;l++)r=wc(r,e),o.push(r);return o}if(t===void 0){let r=wc(t,e);const o=[r];for(let l=0;l<n-1;l++)r=wc(t,r),o.push(r);return o.reverse(),o}const s=Math.floor(n/2),i=wc(t,e);return[...za(t,i,s),i,...za(i,e,n-s-1)]}const LL=RL;function WJ(t){U_(t)}function Rd(t,e,n){return za(t,e,n)}function Vb(t,e){return za(t,void 0,e)}function _p(t,e){return za(t,e,1)[0]}function Vi(t){return za(t,void 0,1)[0]}function HJ(t){return za(void 0,t,1)[0]}function Cp(t,e="a1"){return[e,...za(e,void 0,t)]}function Xn(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function GJ(t,e){return t.id>e.id?1:-1}function IT(t){try{return localStorage.getItem(t)}catch{return null}}function PT(t,e){try{localStorage.setItem(t,e)}catch{}}function VJ(){try{localStorage.clear()}catch{}}function FL(t){try{return sessionStorage.getItem(t)}catch{return null}}function kT(t,e){try{sessionStorage.setItem(t,e)}catch{}}function BL(t){try{sessionStorage.removeItem(t)}catch{}}function KJ(){try{sessionStorage.clear()}catch{}}const Jc=[],YJ=60,Tm=Math.ceil(1e3/YJ);let Du,Kb=0,$_=0;const XJ=()=>{const t=Jc.splice(0,Jc.length);for(const e of t)e()};function UL(){if(Du)return;const t=Date.now(),e=t-$_;if(Kb+e<Tm){Du=requestAnimationFrame(()=>{Du=void 0,UL()});return}Du=requestAnimationFrame(()=>{Du=void 0,$_=t,Kb=Math.min(Kb+e-Tm,Tm*10),XJ()})}let Uj=!1;function $L(t){return Jc.includes(t)||(Jc.push(t),Uj||(Uj=!0,$_=Date.now()-Tm-1),UL()),()=>{const e=Jc.indexOf(t);e>-1&&Jc.splice(e,1)}}class qJ{constructor(){b(this,"timeouts",[]);b(this,"intervals",[]);b(this,"rafs",[])}setTimeout(e,n,...s){const i=window.setTimeout(e,n,s);return this.timeouts.push(i),i}setInterval(e,n,...s){const i=window.setInterval(e,n,s);return this.intervals.push(i),i}requestAnimationFrame(e){const n=window.requestAnimationFrame(e);return this.rafs.push(n),n}dispose(){this.timeouts.forEach(e=>clearTimeout(e)),this.intervals.forEach(e=>clearInterval(e)),this.rafs.forEach(e=>cancelAnimationFrame(e)),this.timeouts.length=0,this.intervals.length=0,this.rafs.length=0}}function ZJ(t){return t!==null}function JJ(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[t=>t&&JSON.parse(JSON.stringify(t)),!1]}const zL=JJ(),yt=zL[0];zL[1];const QJ=Object.getPrototypeOf(yt({}));var Yb={};const jT={enableLicensing:eQ("enableLicensing",{defaults:{all:!0,production:!1}})},WL=Cs("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),Kt={logPreventDefaults:Cs("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:Cs("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:Cs("logElementRemoves",{defaults:{all:!1}}),debugSvg:Cs("debugSvg",{defaults:{all:!1}}),showFps:Cs("showFps",{defaults:{all:!1}}),measurePerformance:Cs("measurePerformance",{defaults:{all:!1}}),throwToBlob:Cs("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:Cs("reconnectOnPing",{defaults:{all:!1}}),debugCursors:Cs("debugCursors",{defaults:{all:!1}}),forceSrgb:Cs("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Cs("debugGeometry",{defaults:{all:!1}}),hideShapes:Cs("hideShapes",{defaults:{all:!1}}),editOnType:Cs("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const t=Element.prototype.removeChild;hc("element removal logging",()=>{Kt.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),t.call(this,e)}:Element.prototype.removeChild=t})}function Cs(t,{defaults:e,shouldStoreForSession:n=!0}){return HL({name:t,defaults:e,shouldStoreForSession:n})}function eQ(t,{defaults:e,shouldStoreForSession:n=!0}){return HL({name:t,defaults:e,shouldStoreForSession:n})}function HL(t){const e=nQ(t),n=t.shouldStoreForSession?tQ(t.name):null,s=dn(`debug:${t.name}`,n??e);return typeof window<"u"&&(t.shouldStoreForSession&&hc(`debug:${t.name}`,()=>{const i=s.get();i===e?BL(`tldraw_debug:${t.name}`):kT(`tldraw_debug:${t.name}`,JSON.stringify(i))}),Object.defineProperty(window,`tldraw${t.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return s.get()},set(i){s.set(i)},configurable:!0})),Object.assign(s,t)}function tQ(t){try{return JSON.parse(FL(`tldraw_debug:${t}`)??"null")}catch{return null}}function Xb(t){try{return t()}catch{return null}}function nQ(t){switch(Xb(()=>Yb.TLDRAW_ENV)??Xb(()=>Yb.VERCEL_PUBLIC_TLDRAW_ENV)??Xb(()=>Yb.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return t.defaults.production??t.defaults.all;case"preview":case"staging":return t.defaults.staging??t.defaults.all;default:return t.defaults.development??t.defaults.all}}class Im{constructor(e){b(this,"nextValue");b(this,"diff");this.previousValue=e}get(){var s,i,r,o;const e=((i=(s=this.diff)==null?void 0:s.removed)==null?void 0:i.size)??0,n=((o=(r=this.diff)==null?void 0:r.added)==null?void 0:o.size)??0;if(!(e===0&&n===0))return{value:this.nextValue,diff:this.diff}}_add(e,n){var s,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),n?(s=this.diff.removed)==null||s.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var i,r,o;const n=this.previousValue.has(e);if(n)return((r=(i=this.diff)==null?void 0:i.removed)==null?void 0:r.has(e))?this._add(e,n):void 0;(o=this.nextValue)!=null&&o.has(e)||this._add(e,n)}_remove(e,n){var s,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),n?((s=this.diff).removed??(s.removed=new Set),this.diff.removed.add(e)):(i=this.diff.added)==null||i.delete(e)}remove(e){var i,r,o,l;const n=this.previousValue.has(e);if(!n)return((r=(i=this.diff)==null?void 0:i.added)==null?void 0:r.has(e))?this._remove(e,n):void 0;(l=(o=this.diff)==null?void 0:o.removed)!=null&&l.has(e)||this._remove(e,n)}}let uf=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");class Nx{constructor(e,n){b(this,"createDefaultProperties");b(this,"validator");b(this,"ephemeralKeys");b(this,"ephemeralKeySet");b(this,"scope");b(this,"isInstance",e=>(e==null?void 0:e.typeName)===this.typeName);this.typeName=e,this.createDefaultProperties=n.createDefaultProperties,this.validator=n.validator??{validate:i=>i},this.scope=n.scope??"document",this.ephemeralKeys=n.ephemeralKeys;const s=new Set;if(n.ephemeralKeys)for(const[i,r]of $s(n.ephemeralKeys))r&&s.add(i);this.ephemeralKeySet=s}create(e){const n={...this.createDefaultProperties(),id:this.createId()};for(const[s,i]of Object.entries(e))i!==void 0&&(n[s]=i);return n.typeName=this.typeName,n}clone(e){return{...yt(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??uf())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isId(e){if(!e)return!1;for(let n=0;n<this.typeName.length;n++)if(e[n]!==this.typeName[n])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new Nx(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,n){return n&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(n,e):this.validator.validate(e)}}function Vr(t,e){return new Nx(t,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function Xy(){return{added:{},updated:{},removed:{}}}function z_(t){const e={added:t.removed,removed:t.added,updated:{}};for(const[n,s]of Object.values(t.updated))e.updated[n.id]=[s,n];return e}function GL(t){return Object.keys(t.added).length===0&&Object.keys(t.updated).length===0&&Object.keys(t.removed).length===0}function NT(t){const e={added:{},removed:{},updated:{}};return Wh(e,t),e}function Wh(t,e){for(const n of e){for(const[s,i]of $s(n.added))if(t.removed[s]){const r=t.removed[s];delete t.removed[s],r!==i&&(t.updated[s]=[r,i])}else t.added[s]=i;for(const[s,[i,r]]of $s(n.updated)){if(t.added[s]){t.added[s]=r,delete t.updated[s],delete t.removed[s];continue}if(t.updated[s]){t.updated[s]=[t.updated[s][0],r],delete t.removed[s];continue}t.updated[s]=n.updated[s],delete t.removed[s]}for(const[s,i]of $s(n.removed))t.added[s]?delete t.added[s]:t.updated[s]?(t.removed[s]=t.updated[s][0],delete t.updated[s]):t.removed[s]=i}}var qy={exports:{}};qy.exports;(function(t,e){var n=200,s="__lodash_hash_undefined__",i=1,r=2,o=9007199254740991,l="[object Arguments]",c="[object Array]",d="[object AsyncFunction]",u="[object Boolean]",h="[object Date]",p="[object Error]",f="[object Function]",g="[object GeneratorFunction]",y="[object Map]",x="[object Number]",m="[object Null]",v="[object Object]",w="[object Promise]",_="[object Proxy]",C="[object RegExp]",I="[object Set]",T="[object String]",P="[object Symbol]",k="[object Undefined]",N="[object WeakMap]",O="[object ArrayBuffer]",R="[object DataView]",j="[object Float32Array]",A="[object Float64Array]",B="[object Int8Array]",L="[object Int16Array]",$="[object Int32Array]",M="[object Uint8Array]",D="[object Uint8ClampedArray]",U="[object Uint16Array]",z="[object Uint32Array]",H=/[\\^$.*+?()[\]{}|]/g,q=/^\[object .+?Constructor\]$/,V=/^(?:0|[1-9]\d*)$/,ee={};ee[j]=ee[A]=ee[B]=ee[L]=ee[$]=ee[M]=ee[D]=ee[U]=ee[z]=!0,ee[l]=ee[c]=ee[O]=ee[u]=ee[R]=ee[h]=ee[p]=ee[f]=ee[y]=ee[x]=ee[v]=ee[C]=ee[I]=ee[T]=ee[N]=!1;var Q=typeof qn=="object"&&qn&&qn.Object===Object&&qn,ae=typeof self=="object"&&self&&self.Object===Object&&self,ue=Q||ae||Function("return this")(),he=e&&!e.nodeType&&e,_e=he&&!0&&t&&!t.nodeType&&t,Pe=_e&&_e.exports===he,qt=Pe&&Q.process,nt=function(){try{return qt&&qt.binding&&qt.binding("util")}catch{}}(),oe=nt&&nt.isTypedArray;function Ge(F,W){for(var ne=-1,pe=F==null?0:F.length,St=0,Ne=[];++ne<pe;){var Ft=F[ne];W(Ft,ne,F)&&(Ne[St++]=Ft)}return Ne}function jt(F,W){for(var ne=-1,pe=W.length,St=F.length;++ne<pe;)F[St+ne]=W[ne];return F}function xn(F,W){for(var ne=-1,pe=F==null?0:F.length;++ne<pe;)if(W(F[ne],ne,F))return!0;return!1}function Su(F,W){for(var ne=-1,pe=Array(F);++ne<F;)pe[ne]=W(ne);return pe}function Xo(F){return function(W){return F(W)}}function x8(F,W){return F.has(W)}function S8(F,W){return F==null?void 0:F[W]}function b8(F){var W=-1,ne=Array(F.size);return F.forEach(function(pe,St){ne[++W]=[St,pe]}),ne}function w8(F,W){return function(ne){return F(W(ne))}}function _8(F){var W=-1,ne=Array(F.size);return F.forEach(function(pe){ne[++W]=pe}),ne}var C8=Array.prototype,E8=Function.prototype,Hf=Object.prototype,zS=ue["__core-js_shared__"],lP=E8.toString,ur=Hf.hasOwnProperty,cP=function(){var F=/[^.]+$/.exec(zS&&zS.keys&&zS.keys.IE_PROTO||"");return F?"Symbol(src)_1."+F:""}(),dP=Hf.toString,T8=RegExp("^"+lP.call(ur).replace(H,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),uP=Pe?ue.Buffer:void 0,Gf=ue.Symbol,hP=ue.Uint8Array,pP=Hf.propertyIsEnumerable,I8=C8.splice,ul=Gf?Gf.toStringTag:void 0,fP=Object.getOwnPropertySymbols,P8=uP?uP.isBuffer:void 0,k8=w8(Object.keys,Object),WS=xc(ue,"DataView"),bu=xc(ue,"Map"),HS=xc(ue,"Promise"),GS=xc(ue,"Set"),VS=xc(ue,"WeakMap"),wu=xc(Object,"create"),j8=fl(WS),N8=fl(bu),A8=fl(HS),R8=fl(GS),M8=fl(VS),gP=Gf?Gf.prototype:void 0,KS=gP?gP.valueOf:void 0;function hl(F){var W=-1,ne=F==null?0:F.length;for(this.clear();++W<ne;){var pe=F[W];this.set(pe[0],pe[1])}}function O8(){this.__data__=wu?wu(null):{},this.size=0}function D8(F){var W=this.has(F)&&delete this.__data__[F];return this.size-=W?1:0,W}function L8(F){var W=this.__data__;if(wu){var ne=W[F];return ne===s?void 0:ne}return ur.call(W,F)?W[F]:void 0}function F8(F){var W=this.__data__;return wu?W[F]!==void 0:ur.call(W,F)}function B8(F,W){var ne=this.__data__;return this.size+=this.has(F)?0:1,ne[F]=wu&&W===void 0?s:W,this}hl.prototype.clear=O8,hl.prototype.delete=D8,hl.prototype.get=L8,hl.prototype.has=F8,hl.prototype.set=B8;function Zr(F){var W=-1,ne=F==null?0:F.length;for(this.clear();++W<ne;){var pe=F[W];this.set(pe[0],pe[1])}}function U8(){this.__data__=[],this.size=0}function $8(F){var W=this.__data__,ne=Kf(W,F);if(ne<0)return!1;var pe=W.length-1;return ne==pe?W.pop():I8.call(W,ne,1),--this.size,!0}function z8(F){var W=this.__data__,ne=Kf(W,F);return ne<0?void 0:W[ne][1]}function W8(F){return Kf(this.__data__,F)>-1}function H8(F,W){var ne=this.__data__,pe=Kf(ne,F);return pe<0?(++this.size,ne.push([F,W])):ne[pe][1]=W,this}Zr.prototype.clear=U8,Zr.prototype.delete=$8,Zr.prototype.get=z8,Zr.prototype.has=W8,Zr.prototype.set=H8;function pl(F){var W=-1,ne=F==null?0:F.length;for(this.clear();++W<ne;){var pe=F[W];this.set(pe[0],pe[1])}}function G8(){this.size=0,this.__data__={hash:new hl,map:new(bu||Zr),string:new hl}}function V8(F){var W=Yf(this,F).delete(F);return this.size-=W?1:0,W}function K8(F){return Yf(this,F).get(F)}function Y8(F){return Yf(this,F).has(F)}function X8(F,W){var ne=Yf(this,F),pe=ne.size;return ne.set(F,W),this.size+=ne.size==pe?0:1,this}pl.prototype.clear=G8,pl.prototype.delete=V8,pl.prototype.get=K8,pl.prototype.has=Y8,pl.prototype.set=X8;function Vf(F){var W=-1,ne=F==null?0:F.length;for(this.__data__=new pl;++W<ne;)this.add(F[W])}function q8(F){return this.__data__.set(F,s),this}function Z8(F){return this.__data__.has(F)}Vf.prototype.add=Vf.prototype.push=q8,Vf.prototype.has=Z8;function qo(F){var W=this.__data__=new Zr(F);this.size=W.size}function J8(){this.__data__=new Zr,this.size=0}function Q8(F){var W=this.__data__,ne=W.delete(F);return this.size=W.size,ne}function eW(F){return this.__data__.get(F)}function tW(F){return this.__data__.has(F)}function nW(F,W){var ne=this.__data__;if(ne instanceof Zr){var pe=ne.__data__;if(!bu||pe.length<n-1)return pe.push([F,W]),this.size=++ne.size,this;ne=this.__data__=new pl(pe)}return ne.set(F,W),this.size=ne.size,this}qo.prototype.clear=J8,qo.prototype.delete=Q8,qo.prototype.get=eW,qo.prototype.has=tW,qo.prototype.set=nW;function sW(F,W){var ne=Xf(F),pe=!ne&&vW(F),St=!ne&&!pe&&YS(F),Ne=!ne&&!pe&&!St&&CP(F),Ft=ne||pe||St||Ne,sn=Ft?Su(F.length,String):[],Sn=sn.length;for(var Nt in F)ur.call(F,Nt)&&!(Ft&&(Nt=="length"||St&&(Nt=="offset"||Nt=="parent")||Ne&&(Nt=="buffer"||Nt=="byteLength"||Nt=="byteOffset")||pW(Nt,Sn)))&&sn.push(Nt);return sn}function Kf(F,W){for(var ne=F.length;ne--;)if(SP(F[ne][0],W))return ne;return-1}function iW(F,W,ne){var pe=W(F);return Xf(F)?pe:jt(pe,ne(F))}function _u(F){return F==null?F===void 0?k:m:ul&&ul in Object(F)?uW(F):yW(F)}function mP(F){return Cu(F)&&_u(F)==l}function yP(F,W,ne,pe,St){return F===W?!0:F==null||W==null||!Cu(F)&&!Cu(W)?F!==F&&W!==W:rW(F,W,ne,pe,yP,St)}function rW(F,W,ne,pe,St,Ne){var Ft=Xf(F),sn=Xf(W),Sn=Ft?c:Zo(F),Nt=sn?c:Zo(W);Sn=Sn==l?v:Sn,Nt=Nt==l?v:Nt;var Gs=Sn==v,Fi=Nt==v,Fn=Sn==Nt;if(Fn&&YS(F)){if(!YS(W))return!1;Ft=!0,Gs=!1}if(Fn&&!Gs)return Ne||(Ne=new qo),Ft||CP(F)?vP(F,W,ne,pe,St,Ne):cW(F,W,Sn,ne,pe,St,Ne);if(!(ne&i)){var hi=Gs&&ur.call(F,"__wrapped__"),pi=Fi&&ur.call(W,"__wrapped__");if(hi||pi){var Jo=hi?F.value():F,Jr=pi?W.value():W;return Ne||(Ne=new qo),St(Jo,Jr,ne,pe,Ne)}}return Fn?(Ne||(Ne=new qo),dW(F,W,ne,pe,St,Ne)):!1}function oW(F){if(!_P(F)||gW(F))return!1;var W=bP(F)?T8:q;return W.test(fl(F))}function aW(F){return Cu(F)&&wP(F.length)&&!!ee[_u(F)]}function lW(F){if(!mW(F))return k8(F);var W=[];for(var ne in Object(F))ur.call(F,ne)&&ne!="constructor"&&W.push(ne);return W}function vP(F,W,ne,pe,St,Ne){var Ft=ne&i,sn=F.length,Sn=W.length;if(sn!=Sn&&!(Ft&&Sn>sn))return!1;var Nt=Ne.get(F);if(Nt&&Ne.get(W))return Nt==W;var Gs=-1,Fi=!0,Fn=ne&r?new Vf:void 0;for(Ne.set(F,W),Ne.set(W,F);++Gs<sn;){var hi=F[Gs],pi=W[Gs];if(pe)var Jo=Ft?pe(pi,hi,Gs,W,F,Ne):pe(hi,pi,Gs,F,W,Ne);if(Jo!==void 0){if(Jo)continue;Fi=!1;break}if(Fn){if(!xn(W,function(Jr,gl){if(!x8(Fn,gl)&&(hi===Jr||St(hi,Jr,ne,pe,Ne)))return Fn.push(gl)})){Fi=!1;break}}else if(!(hi===pi||St(hi,pi,ne,pe,Ne))){Fi=!1;break}}return Ne.delete(F),Ne.delete(W),Fi}function cW(F,W,ne,pe,St,Ne,Ft){switch(ne){case R:if(F.byteLength!=W.byteLength||F.byteOffset!=W.byteOffset)return!1;F=F.buffer,W=W.buffer;case O:return!(F.byteLength!=W.byteLength||!Ne(new hP(F),new hP(W)));case u:case h:case x:return SP(+F,+W);case p:return F.name==W.name&&F.message==W.message;case C:case T:return F==W+"";case y:var sn=b8;case I:var Sn=pe&i;if(sn||(sn=_8),F.size!=W.size&&!Sn)return!1;var Nt=Ft.get(F);if(Nt)return Nt==W;pe|=r,Ft.set(F,W);var Gs=vP(sn(F),sn(W),pe,St,Ne,Ft);return Ft.delete(F),Gs;case P:if(KS)return KS.call(F)==KS.call(W)}return!1}function dW(F,W,ne,pe,St,Ne){var Ft=ne&i,sn=xP(F),Sn=sn.length,Nt=xP(W),Gs=Nt.length;if(Sn!=Gs&&!Ft)return!1;for(var Fi=Sn;Fi--;){var Fn=sn[Fi];if(!(Ft?Fn in W:ur.call(W,Fn)))return!1}var hi=Ne.get(F);if(hi&&Ne.get(W))return hi==W;var pi=!0;Ne.set(F,W),Ne.set(W,F);for(var Jo=Ft;++Fi<Sn;){Fn=sn[Fi];var Jr=F[Fn],gl=W[Fn];if(pe)var EP=Ft?pe(gl,Jr,Fn,W,F,Ne):pe(Jr,gl,Fn,F,W,Ne);if(!(EP===void 0?Jr===gl||St(Jr,gl,ne,pe,Ne):EP)){pi=!1;break}Jo||(Jo=Fn=="constructor")}if(pi&&!Jo){var qf=F.constructor,Zf=W.constructor;qf!=Zf&&"constructor"in F&&"constructor"in W&&!(typeof qf=="function"&&qf instanceof qf&&typeof Zf=="function"&&Zf instanceof Zf)&&(pi=!1)}return Ne.delete(F),Ne.delete(W),pi}function xP(F){return iW(F,bW,hW)}function Yf(F,W){var ne=F.__data__;return fW(W)?ne[typeof W=="string"?"string":"hash"]:ne.map}function xc(F,W){var ne=S8(F,W);return oW(ne)?ne:void 0}function uW(F){var W=ur.call(F,ul),ne=F[ul];try{F[ul]=void 0;var pe=!0}catch{}var St=dP.call(F);return pe&&(W?F[ul]=ne:delete F[ul]),St}var hW=fP?function(F){return F==null?[]:(F=Object(F),Ge(fP(F),function(W){return pP.call(F,W)}))}:wW,Zo=_u;(WS&&Zo(new WS(new ArrayBuffer(1)))!=R||bu&&Zo(new bu)!=y||HS&&Zo(HS.resolve())!=w||GS&&Zo(new GS)!=I||VS&&Zo(new VS)!=N)&&(Zo=function(F){var W=_u(F),ne=W==v?F.constructor:void 0,pe=ne?fl(ne):"";if(pe)switch(pe){case j8:return R;case N8:return y;case A8:return w;case R8:return I;case M8:return N}return W});function pW(F,W){return W=W??o,!!W&&(typeof F=="number"||V.test(F))&&F>-1&&F%1==0&&F<W}function fW(F){var W=typeof F;return W=="string"||W=="number"||W=="symbol"||W=="boolean"?F!=="__proto__":F===null}function gW(F){return!!cP&&cP in F}function mW(F){var W=F&&F.constructor,ne=typeof W=="function"&&W.prototype||Hf;return F===ne}function yW(F){return dP.call(F)}function fl(F){if(F!=null){try{return lP.call(F)}catch{}try{return F+""}catch{}}return""}function SP(F,W){return F===W||F!==F&&W!==W}var vW=mP(function(){return arguments}())?mP:function(F){return Cu(F)&&ur.call(F,"callee")&&!pP.call(F,"callee")},Xf=Array.isArray;function xW(F){return F!=null&&wP(F.length)&&!bP(F)}var YS=P8||_W;function SW(F,W){return yP(F,W)}function bP(F){if(!_P(F))return!1;var W=_u(F);return W==f||W==g||W==d||W==_}function wP(F){return typeof F=="number"&&F>-1&&F%1==0&&F<=o}function _P(F){var W=typeof F;return F!=null&&(W=="object"||W=="function")}function Cu(F){return F!=null&&typeof F=="object"}var CP=oe?Xo(oe):aW;function bW(F){return xW(F)?sW(F):lW(F)}function wW(){return[]}function _W(){return!1}t.exports=SW})(qy,qy.exports);var sQ=qy.exports;const iQ=qa(sQ);function rQ(t){if(t.length===0)return new Set;const e=t[0],n=t.slice(1),s=new Set;for(const i of e)n.every(r=>r.has(i))&&s.add(i);return s}function oQ(t,e){const n={};for(const s of e)t.has(s)||(n.added??(n.added=new Set),n.added.add(s));for(const s of t)e.has(s)||(n.removed??(n.removed=new Set),n.removed.add(s));return n.added||n.removed?n:void 0}function $j(t,e){for(const[n,s]of Object.entries(t)){const i=s,r=e[n];if("eq"in i&&r!==i.eq||"neq"in i&&r===i.neq||"gt"in i&&(typeof r!="number"||r<=i.gt))return!1}return!0}function zj(t,e,n){const s=Object.fromEntries(Object.keys(n).map(i=>[i,new Set]));for(const[i,r]of Object.entries(n))if("eq"in r){const l=t.index(e,i).get().get(r.eq);if(l)for(const c of l)s[i].add(c)}else if("neq"in r){const o=t.index(e,i);for(const[l,c]of o.get())if(l!==r.neq)for(const d of c)s[i].add(d)}else if("gt"in r){const o=t.index(e,i);for(const[l,c]of o.get())if(l>r.gt)for(const d of c)s[i].add(d)}return rQ(Object.values(s))}class aQ{constructor(e,n){b(this,"indexCache",new Map);b(this,"historyCache",new Map);this.atoms=e,this.history=n}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const n=te("filterHistory:"+e,(s,i)=>{if(Ol(s))return this.history.get();const r=this.history.getDiffSince(i);if(r===ti)return this.history.get();const o={added:{},removed:{},updated:{}};let l=0,c=0,d=0;for(const u of r){for(const h of Ut(u.added))if(h.typeName===e)if(o.removed[h.id]){const p=o.removed[h.id];delete o.removed[h.id],c--,p!==h&&(o.updated[h.id]=[p,h],d++)}else o.added[h.id]=h,l++;for(const[h,p]of Ut(u.updated))p.typeName===e&&(o.added[p.id]?o.added[p.id]=p:o.updated[p.id]?o.updated[p.id]=[o.updated[p.id][0],p]:(o.updated[p.id]=[h,p],d++));for(const h of Ut(u.removed))h.typeName===e&&(o.added[h.id]?(delete o.added[h.id],l--):o.updated[h.id]?(o.removed[h.id]=o.updated[h.id][0],delete o.updated[h.id],d--,c++):(o.removed[h.id]=h,c++))}return l||c||d?uh(this.history.get(),o):s},{historyLength:100});return this.historyCache.set(e,n),n}index(e,n){const s=e+":"+n;if(this.indexCache.has(s))return this.indexCache.get(s);const i=this.__uncached_createIndex(e,n);return this.indexCache.set(s,i),i}__uncached_createIndex(e,n){const s=this.filterHistory(e),i=()=>{s.get();const r=new Map;for(const o of Ut(this.atoms.get())){const l=o.get();if(l.typeName===e){const c=l[n];r.has(c)||r.set(c,new Set),r.get(c).add(l.id)}}return r};return te("index:"+e+":"+n,(r,o)=>{if(Ol(r))return i();const l=s.getDiffSince(o);if(l===ti)return i();const c=new Map,d=(f,g)=>{let y=c.get(f);y||(y=new Im(r.get(f)??new Set)),y.add(g),c.set(f,y)},u=(f,g)=>{let y=c.get(f);y||(y=new Im(r.get(f)??new Set)),y.remove(g),c.set(f,y)};for(const f of l){for(const g of Ut(f.added))if(g.typeName===e){const y=g[n];d(y,g.id)}for(const[g,y]of Ut(f.updated))if(y.typeName===e){const x=g[n],m=y[n];x!==m&&(u(x,y.id),d(m,y.id))}for(const g of Ut(f.removed))if(g.typeName===e){const y=g[n];u(y,g.id)}}let h,p;for(const[f,g]of c){const y=g.get();y&&(h||(h=new Map(r)),p||(p=new Map),y.value.size===0?h.delete(f):h.set(f,y.value),p.set(f,y.diff))}return h&&p?uh(h,p):r},{historyLength:100})}record(e,n=()=>({}),s="record:"+e+(n?":"+n.toString():"")){const i=this.ids(e,n,s);return te(s,()=>{var r;for(const o of i.get())return(r=this.atoms.get()[o])==null?void 0:r.get()})}records(e,n=()=>({}),s="records:"+e+(n?":"+n.toString():"")){const i=this.ids(e,n,"ids:"+s);return te(s,()=>[...i.get()].map(r=>{const o=this.atoms.get()[r];if(!o)throw new Error("no atom found for record id: "+r);return o.get()}))}ids(e,n=()=>({}),s="ids:"+e+(n?":"+n.toString():"")){const i=this.filterHistory(e),r=()=>{i.get();const c=n();return Object.keys(c).length===0?new Set(Ut(this.atoms.get()).flatMap(d=>{const u=d.get();return u.typeName===e?u.id:[]})):zj(this,e,c)},o=c=>{const d=r(),u=oQ(c,d);return u?uh(d,u):c},l=te("ids_query:"+s,n,{isEqual:iQ});return te("query:"+s,(c,d)=>{const u=l.get();if(Ol(c))return r();if(d<l.lastChangedEpoch)return o(c);const h=i.getDiffSince(d);if(h===ti)return o(c);const p=new Im(c);for(const g of h){for(const y of Ut(g.added))y.typeName===e&&$j(u,y)&&p.add(y.id);for(const[y,x]of Ut(g.updated))x.typeName===e&&($j(u,x)?p.add(x.id):p.remove(x.id));for(const y of Ut(g.removed))y.typeName===e&&p.remove(y.id)}const f=p.get();return f?uh(f.value,f.diff):c},{historyLength:50})}exec(e,n){const s=zj(this,e,n);if(s.size===0)return bo;const i=this.atoms.get();return[...s].map(r=>i[r].get())}}class lQ{constructor(e){b(this,"_beforeCreateHandlers",{});b(this,"_afterCreateHandlers",{});b(this,"_beforeChangeHandlers",{});b(this,"_afterChangeHandlers",{});b(this,"_beforeDeleteHandlers",{});b(this,"_afterDeleteHandlers",{});b(this,"_operationCompleteHandlers",[]);b(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,n){if(!this._isEnabled)return e;const s=this._beforeCreateHandlers[e.typeName];if(s){let i=e;for(const r of s)i=r(i,n);return i}return e}handleAfterCreate(e,n){if(!this._isEnabled)return;const s=this._afterCreateHandlers[e.typeName];if(s)for(const i of s)i(e,n)}handleBeforeChange(e,n,s){if(!this._isEnabled)return n;const i=this._beforeChangeHandlers[n.typeName];if(i){let r=n;for(const o of i)r=o(e,r,s);return r}return n}handleAfterChange(e,n,s){if(!this._isEnabled)return;const i=this._afterChangeHandlers[n.typeName];if(i)for(const r of i)r(e,n,s)}handleBeforeDelete(e,n){if(!this._isEnabled)return!0;const s=this._beforeDeleteHandlers[e.typeName];if(s){for(const i of s)if(i(e,n)===!1)return!1}return!0}handleAfterDelete(e,n){if(!this._isEnabled)return;const s=this._afterDeleteHandlers[e.typeName];if(s)for(const i of s)i(e,n)}handleOperationComplete(e){if(this._isEnabled)for(const n of this._operationCompleteHandlers)n(e)}register(e){const n=[];for(const[s,i]of Object.entries(e))i!=null&&i.beforeCreate&&n.push(this.registerBeforeCreateHandler(s,i.beforeCreate)),i!=null&&i.afterCreate&&n.push(this.registerAfterCreateHandler(s,i.afterCreate)),i!=null&&i.beforeChange&&n.push(this.registerBeforeChangeHandler(s,i.beforeChange)),i!=null&&i.afterChange&&n.push(this.registerAfterChangeHandler(s,i.afterChange)),i!=null&&i.beforeDelete&&n.push(this.registerBeforeDeleteHandler(s,i.beforeDelete)),i!=null&&i.afterDelete&&n.push(this.registerAfterDeleteHandler(s,i.afterDelete));return()=>{for(const s of n)s()}}registerBeforeCreateHandler(e,n){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(n),()=>yl(this._beforeCreateHandlers[e],n)}registerAfterCreateHandler(e,n){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(n),()=>yl(this._afterCreateHandlers[e],n)}registerBeforeChangeHandler(e,n){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(n),()=>yl(this._beforeChangeHandlers[e],n)}registerAfterChangeHandler(e,n){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(n),()=>yl(this._afterChangeHandlers[e],n)}registerBeforeDeleteHandler(e,n){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(n),()=>yl(this._beforeDeleteHandlers[e],n)}registerAfterDeleteHandler(e,n){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(n),()=>yl(this._afterDeleteHandlers[e],n)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>yl(this._operationCompleteHandlers,e)}}function yl(t,e){const n=t.indexOf(e);n>=0&&t.splice(n,1)}let AT=class{constructor(e){b(this,"id");b(this,"atoms",dn("store_atoms",{}));b(this,"history",dn("history",0,{historyLength:1e3}));b(this,"query",new aQ(this.atoms,this.history));b(this,"listeners",new Set);b(this,"historyAccumulator",new dQ);b(this,"historyReactor");b(this,"cancelHistoryReactor",()=>{});b(this,"schema");b(this,"props");b(this,"scopedTypes");b(this,"sideEffects",new lQ(this));b(this,"put",(e,n)=>{this.atomic(()=>{const s={},i={},r=this.atoms.__unsafe__getWithoutCapture();let o=null,l,c=!1;const d=this.isMergingRemoteChanges?"remote":"user";for(let u=0,h=e.length;u<h;u++){l=e[u];const p=(o??r)[l.id];if(p){const f=p.__unsafe__getWithoutCapture();if(l=this.sideEffects.handleBeforeChange(f,l,d),this.schema.validateRecord(this,l,n??"updateRecord",f)===f)continue;p.set(l),c=!0;const y=p.__unsafe__getWithoutCapture();s[l.id]=[f,y],this.addDiffForAfterEvent(f,y)}else l=this.sideEffects.handleBeforeCreate(l,d),c=!0,l=this.schema.validateRecord(this,l,n??"createRecord",null),i[l.id]=l,this.addDiffForAfterEvent(null,l),o||(o={...r}),o[l.id]=dn("atom:"+l.id,l)}o&&this.atoms.set(o),c&&this.updateHistory({added:i,updated:s,removed:{}})})});b(this,"remove",e=>{this.atomic(()=>{const n=new Set,s=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const r of e){const o=this.atoms.__unsafe__getWithoutCapture()[r];o&&this.sideEffects.handleBeforeDelete(o.get(),s)===!1&&n.add(r)}let i;this.atoms.update(r=>{let o;for(const l of e){if(n.has(l)||!(l in r))continue;o||(o={...r}),i||(i={}),delete o[l];const c=r[l].get();i[l]=c,this.addDiffForAfterEvent(c,null)}return o??r}),i&&this.updateHistory({added:{},updated:{},removed:i})})});b(this,"get",e=>{var n;return(n=this.atoms.get()[e])==null?void 0:n.get()});b(this,"unsafeGetWithoutCapture",e=>{var n;return(n=this.atoms.__unsafe__getWithoutCapture()[e])==null?void 0:n.__unsafe__getWithoutCapture()});b(this,"serialize",(e="document")=>{const n={};for(const[s,i]of $s(this.atoms.get())){const r=i.get();(e==="all"||this.scopedTypes[e].has(r.typeName))&&(n[s]=r)}return n});b(this,"allRecords",()=>Ut(this.atoms.get()).map(e=>e.get()));b(this,"clear",()=>{this.remove(Lj(this.atoms.get()))});b(this,"update",(e,n)=>{const s=this.atoms.get()[e];if(!s){console.error(`Record ${e} not found. This is probably an error`);return}this.put([n(s.__unsafe__getWithoutCapture())])});b(this,"has",e=>!!this.atoms.get()[e]);b(this,"listen",(e,n)=>{this._flushHistory();const s={onHistory:e,filters:{source:(n==null?void 0:n.source)??"all",scope:(n==null?void 0:n.scope)??"all"}};return this.listeners.add(s),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(s),this.listeners.size===0&&this.historyReactor.stop()}});b(this,"isMergingRemoteChanges",!1);b(this,"mergeRemoteChanges",e=>{if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,Rr(e)}finally{this.isMergingRemoteChanges=!1}});b(this,"createComputedCache",(e,n,s)=>{const i=new jo;return{get:r=>{const o=this.atoms.get()[r];if(o)return i.get(o,()=>{const l=s?te(o.name+":equals",()=>o.get(),{isEqual:s}):o;return te(e+":"+r,()=>n(l.get()))}).get()}}});b(this,"createSelectedComputedCache",(e,n,s)=>{const i=new jo;return{get:r=>{const o=this.atoms.get()[r];if(o)return i.get(o,()=>{const l=te(e+":"+r+":selector",()=>n(o.get()));return te(e+":"+r,()=>s(l.get()))}).get()}}});b(this,"_integrityChecker");b(this,"_isPossiblyCorrupted",!1);b(this,"pendingAfterEvents",null);b(this,"_isInAtomicOp",!1);const{initialData:n,schema:s,id:i}=e;this.id=i??uf(),this.schema=s,this.props=e.props,n&&this.atoms.set(NL($s(n).map(([r,o])=>[r,dn("atom:"+r,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=tZ("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:r=>this.cancelHistoryReactor=$L(r)}),this.scopedTypes={document:new Set(Ut(this.schema.types).filter(r=>r.scope==="document").map(r=>r.typeName)),session:new Set(Ut(this.schema.types).filter(r=>r.scope==="session").map(r=>r.typeName)),presence:new Set(Ut(this.schema.types).filter(r=>r.scope==="presence").map(r=>r.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:n,source:s}of e){let i=null,r=null,o=null;for(const{onHistory:l,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==s))if(c.scope!=="all")if(c.scope==="document"){if(r??(r=this.filterChangesByScope(n,"document")),!r)continue;l({changes:r,source:s})}else if(c.scope==="session"){if(i??(i=this.filterChangesByScope(n,"session")),!i)continue;l({changes:i,source:s})}else{if(o??(o=this.filterChangesByScope(n,"presence")),!o)continue;l({changes:o,source:s})}else l({changes:n,source:s})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,n){const s={added:zh(e.added,(i,r)=>this.scopedTypes[n].has(r.typeName)),updated:zh(e.updated,(i,r)=>this.scopedTypes[n].has(r[1].typeName)),removed:zh(e.removed,(i,r)=>this.scopedTypes[n].has(r.typeName))};return Object.keys(s.added).length===0&&Object.keys(s.updated).length===0&&Object.keys(s.removed).length===0?null:s}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(n=>this.schema.validateRecord(this,n,e,null))}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);return{store:n.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);const s=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(n.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(s)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}extractingChanges(e){const n=[],s=this.historyAccumulator.addInterceptor(i=>n.push(i.changes));try{return Rr(e),NT(n)}finally{s()}}applyDiff(e,{runCallbacks:n=!0,ignoreEphemeralKeys:s=!1}={}){this.atomic(()=>{const i=Ut(e.added);for(const[o,l]of Ut(e.updated)){const c=this.schema.getType(l.typeName);if(s&&c.ephemeralKeySet.size){const d=this.get(l.id);if(!d){i.push(l);continue}let u=null;for(const[h,p]of Object.entries(l))c.ephemeralKeySet.has(h)||Object.is(p,Ms(d,h))||(u||(u={...d}),u[h]=p);u&&i.push(u)}else i.push(l)}const r=Lj(e.removed);i.length&&this.put(i),r.length&&this.remove(r)},n)}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,n){if(xt(this.pendingAfterEvents,"must be in event operation"),e===n||(e&&n&&xt(e.id===n.id),!e&&!n))return;const s=(e||n).id,i=this.pendingAfterEvents.get(s);i?i.after=n:this.pendingAfterEvents.set(s,{before:e,after:n})}flushAtomicCallbacks(){let e=0;const n=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const s=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:i,after:r}of s.values())i&&r?this.sideEffects.handleAfterChange(i,r,n):i&&!r?this.sideEffects.handleAfterDelete(i,n):!i&&r&&this.sideEffects.handleAfterCreate(r,n);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(n)}}}atomic(e,n=!0){return Rr(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const s=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(n??s),this._isInAtomicOp=!0;try{const i=e();return this.flushAtomicCallbacks(),i}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(s),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(n=>e(n,this.isMergingRemoteChanges?"remote":"user"))}};function cQ(t){if(t.length===0)return[];const e=[];let n=[t[0]],s;for(let i=1,r=t.length;i<r;i++)s=t[i],n[0].source!==s.source&&(e.push(n),n=[]),n.push(s);return e.push(n),e.map(i=>({source:i[0].source,changes:NT(i.map(r=>r.changes))}))}class dQ{constructor(){b(this,"_history",[]);b(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const n of this._interceptors)n(e)}flush(){const e=cQ(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function uQ(t,e,n){const s=new jo;return{get(i,r){return s.get(i,()=>(i instanceof AT?i:i.store).createComputedCache(t,c=>e(i,c),n)).get(r)}}}function hQ(t){const e=[];for(let n=t.length-1;n>=0;n--){const s=t[n];if("id"in s)e.unshift(s);else{const i=s.dependsOn,r=e[0];r&&(e[0]={...r,dependsOn:i.concat(r.dependsOn??[])})}}return e}function pd({sequence:t,sequenceId:e,retroactive:n=!0}){const s={sequenceId:e,retroactive:n,sequence:hQ(t)};return VL(s),s}function Ws(t,e){return Object.fromEntries($s(e).map(([n,s])=>[n,`${t}/${s}`]))}function di(t){const e=t.sequenceId;return pd({sequenceId:e,retroactive:t.retroactive??!0,sequence:t.sequence.map(n=>"id"in n?{...n,scope:"record",filter:s=>{var i,r;return s.typeName===t.recordType&&(((i=n.filter)==null?void 0:i.call(n,s))??!0)&&(((r=t.filter)==null?void 0:r.call(t,s))??!0)}}:n)})}function pQ(t){const e=new Map(t.map(r=>[r.id,r])),n=new Set,s=[];function i(r){xt(!n.has(r.id),`Circular dependency in migrations: ${r.id}`),n.add(r.id);const{version:o,sequenceId:l}=Zy(r.id),c=e.get(`${l}/${o-1}`);if(c&&i(c),r.dependsOn)for(const d of r.dependsOn){const u=e.get(d);u&&i(u)}e.delete(r.id),s.push(r)}for(const r of e.values())i(r);return s}function Zy(t){const[e,n]=t.split("/");return{sequenceId:e,version:parseInt(n)}}function Wj(t,e){e&&xt(t.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${t}'`),xt(t.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${t}'`)}function VL(t){if(xt(!t.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${t.sequenceId}`),xt(t.sequenceId.length,"sequenceId must be a non-empty string"),t.sequence.length===0)return;Wj(t.sequence[0].id,t.sequenceId);let e=Zy(t.sequence[0].id).version;xt(e===1,`Expected the first migrationId to be '${t.sequenceId}/1' but got '${t.sequence[0].id}'`);for(let n=1;n<t.sequence.length;n++){const s=t.sequence[n].id;Wj(s,t.sequenceId);const i=Zy(s).version;xt(i===e+1,`Migration id numbers must increase in increments of 1, expected ${t.sequenceId}/${e+1} but got '${t.sequence[n].id}'`),e=i}}var ia=(t=>(t.IncompatibleSubtype="incompatible-subtype",t.UnknownType="unknown-type",t.TargetVersionTooNew="target-version-too-new",t.TargetVersionTooOld="target-version-too-old",t.MigrationError="migration-error",t.UnrecognizedSubtype="unrecognized-subtype",t))(ia||{});function fQ(t){if(t.schemaVersion>2||t.schemaVersion<1)return Na.err("Bad schema version");if(t.schemaVersion===2)return Na.ok(t);const e={schemaVersion:2,sequences:{}};for(const[n,s]of Object.entries(t.recordVersions))if(e.sequences[`com.tldraw.${n}`]=s.version,"subTypeKey"in s)for(const[i,r]of Object.entries(s.subTypeVersions))e.sequences[`com.tldraw.${n}.${i}`]=r;return Na.ok(e)}class RT{constructor(e,n){b(this,"migrations",{});b(this,"sortedMigrations");var i;this.types=e,this.options=n;for(const r of n.migrations??[])xt(!this.migrations[r.sequenceId],`Duplicate migration sequenceId ${r.sequenceId}`),VL(r),this.migrations[r.sequenceId]=r;const s=Object.values(this.migrations).flatMap(r=>r.sequence);this.sortedMigrations=pQ(s);for(const r of this.sortedMigrations)if((i=r.dependsOn)!=null&&i.length)for(const o of r.dependsOn){const l=s.find(c=>c.id===o);xt(l,`Migration '${r.id}' depends on missing migration '${o}'`)}}static create(e,n){return new RT(e,n??{})}validateRecord(e,n,s,i){try{const r=Ms(this.types,n.typeName);if(!r)throw new Error(`Missing definition for record type ${n.typeName}`);return r.validate(n,i??void 0)}catch(r){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:n,phase:s,recordBefore:i,error:r});throw r}}getMigrationsSince(e){const n=fQ(e);if(!n.ok)return n;const s=n.value,i=new Set(Object.keys(s.sequences).filter(o=>this.migrations[o]));for(const o in this.migrations)s.sequences[o]===void 0&&this.migrations[o].retroactive&&i.add(o);if(i.size===0)return Na.ok([]);const r=new Set;for(const o of i){const l=s.sequences[o];if(typeof l!="number"&&this.migrations[o].retroactive||l===0){for(const u of this.migrations[o].sequence)r.add(u.id);continue}const c=`${o}/${l}`,d=this.migrations[o].sequence.findIndex(u=>u.id===c);if(d===-1)return Na.err("Incompatible schema?");for(const u of this.migrations[o].sequence.slice(d+1))r.add(u.id)}return Na.ok(this.sortedMigrations.filter(({id:o})=>r.has(o)))}migratePersistedRecord(e,n,s="up"){const i=this.getMigrationsSince(n);if(!i.ok)return console.error("Error migrating record",i.error),{type:"error",reason:ia.MigrationError};let r=i.value;if(r.length===0)return{type:"success",value:e};if(r.some(o=>o.scope==="store"))return{type:"error",reason:s==="down"?ia.TargetVersionTooOld:ia.TargetVersionTooNew};if(s==="down"){if(!r.every(o=>o.down))return{type:"error",reason:ia.TargetVersionTooOld};r=r.slice().reverse()}e=yt(e);try{for(const o of r){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(e):!0))continue;const c=o[s](e);c&&(e=yt(c))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:ia.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:n}=e;const s=this.getMigrationsSince(e.schema);if(!s.ok)return console.error("Error migrating store",s.error),{type:"error",reason:ia.MigrationError};const i=s.value;if(i.length===0)return{type:"success",value:n};n=yt(n);try{for(const r of i)if(r.scope==="record")for(const[o,l]of Object.entries(n)){if(!(r.filter?r.filter(l):!0))continue;const d=r.up(l);d&&(n[o]=yt(d))}else if(r.scope==="store"){const o=r.up(n);o&&(n=yt(o))}else Zn(r)}catch(r){return console.error("Error migrating store",r),{type:"error",reason:ia.MigrationError}}return{type:"success",value:n}}createIntegrityChecker(e){var n,s;return((s=(n=this.options).createIntegrityChecker)==null?void 0:s.call(n,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:n})=>[e,n.length?Zy(n.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const n=Ms(this.types,e);return xt(n,"record type does not exists"),n}}function gQ(t){if(!t.length)return null;let e="";for(const n of t)typeof n=="number"?e+=`.${n}`:n.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${n.slice(1)}`:e+=n:e+=`.${n}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class Ke extends Error{constructor(n,s=[]){const i=gQ(s),r=n.split(`
`).map((o,l)=>l===0?o:`  ${o}`).join(`
`);super(s?`At ${i}: ${r}`:r);b(this,"name","ValidationError");this.rawMessage=n,this.path=s}}function zs(t,e){try{return e()}catch(n){throw n instanceof Ke?new Ke(n.rawMessage,[t,...n.path]):new Ke(n.toString(),[t])}}function Wa(t){if(t===null)return"null";if(Array.isArray(t))return"an array";const e=typeof t;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:Zn(e)}}class xs{constructor(e,n){this.validationFn=e,this.validateUsingKnownGoodVersionFn=n}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,n){return Object.is(e,n)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,n):this.validate(n)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return bQ(this)}optional(){return YL(this)}refine(e){return new xs(n=>e(this.validate(n)),(n,s)=>{const i=this.validateUsingKnownGoodVersion(n,s);return Object.is(n,i)?n:e(i)})}check(e,n){return typeof e=="string"?this.refine(s=>(zs(`(check ${e})`,()=>n(s)),s)):this.refine(s=>(e(s),s))}}class mQ extends xs{constructor(e){super(n=>{const s=Hj.validate(n);for(let i=0;i<s.length;i++)zs(i,()=>e.validate(s[i]));return s},(n,s)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(s);const i=Hj.validate(s);let r=n.length!==i.length;for(let o=0;o<i.length;o++){const l=i[o];if(o>=n.length){r=!0,zs(o,()=>e.validate(l));continue}if(Object.is(n[o],l))continue;const c=zs(o,()=>e.validateUsingKnownGoodVersion(n[o],l));Object.is(c,n[o])||(r=!0)}return r?s:n}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Ke("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Ke("Expected an array with length greater than 1")})}}class Jy extends xs{constructor(e,n=!1){super(s=>{if(typeof s!="object"||s===null)throw new Ke(`Expected object, got ${Wa(s)}`);for(const[i,r]of Object.entries(e))zs(i,()=>{r.validate(Ms(s,i))});if(!n){for(const i of Object.keys(s))if(!Mr(e,i))throw new Ke("Unexpected property",[i])}return s},(s,i)=>{if(typeof i!="object"||i===null)throw new Ke(`Expected object, got ${Wa(i)}`);let r=!1;for(const[o,l]of Object.entries(e)){const c=Ms(s,o),d=Ms(i,o);if(Object.is(c,d))continue;const u=zs(o,()=>{const h=l;return h.validateUsingKnownGoodVersion?h.validateUsingKnownGoodVersion(c,d):h.validate(d)});Object.is(u,c)||(r=!0)}if(!n){for(const o of Object.keys(i))if(!Mr(e,o))throw new Ke("Unexpected property",[o])}for(const o of Object.keys(s))if(!Mr(i,o)){r=!0;break}return r?i:s}),this.config=e,this.shouldAllowUnknownProperties=n}allowUnknownProperties(){return new Jy(this.config,!0)}extend(e){return new Jy({...this.config,...e})}}class Ax extends xs{constructor(e,n,s,i){super(r=>{this.expectObject(r);const{matchingSchema:o,variant:l}=this.getMatchingSchemaAndVariant(r);return o===void 0?this.unknownValueValidation(r,l):zs(`(${e} = ${l})`,()=>o.validate(r))},(r,o)=>{this.expectObject(o),this.expectObject(r);const{matchingSchema:l,variant:c}=this.getMatchingSchemaAndVariant(o);return l===void 0?this.unknownValueValidation(o,c):Ms(r,e)!==Ms(o,e)?zs(`(${e} = ${c})`,()=>l.validate(o)):zs(`(${e} = ${c})`,()=>l.validateUsingKnownGoodVersion?l.validateUsingKnownGoodVersion(r,o):l.validate(o))}),this.key=e,this.config=n,this.unknownValueValidation=s,this.useNumberKeys=i}expectObject(e){if(typeof e!="object"||e===null)throw new Ke(`Expected an object, got ${Wa(e)}`,[])}getMatchingSchemaAndVariant(e){const n=Ms(e,this.key);if(!this.useNumberKeys&&typeof n!="string")throw new Ke(`Expected a string for key "${this.key}", got ${Wa(n)}`);if(this.useNumberKeys&&!Number.isFinite(Number(n)))throw new Ke(`Expected a number for key "${this.key}", got "${n}"`);return{matchingSchema:Mr(this.config,n)?this.config[n]:void 0,variant:n}}validateUnknownVariants(e){return new Ax(this.key,this.config,e,this.useNumberKeys)}}class yQ extends xs{constructor(e,n){super(s=>{if(typeof s!="object"||s===null)throw new Ke(`Expected object, got ${Wa(s)}`);for(const[i,r]of Object.entries(s))zs(i,()=>{e.validate(i),n.validate(r)});return s},(s,i)=>{if(typeof i!="object"||i===null)throw new Ke(`Expected object, got ${Wa(i)}`);let r=!1;for(const[o,l]of Object.entries(i)){if(!Mr(s,o)){r=!0,zs(o,()=>{e.validate(o),n.validate(l)});continue}const c=Ms(s,o),d=l;if(Object.is(c,d))continue;const u=zs(o,()=>n.validateUsingKnownGoodVersion?n.validateUsingKnownGoodVersion(c,d):n.validate(d));Object.is(u,c)||(r=!0)}for(const o of Object.keys(s))if(!Mr(i,o)){r=!0;break}return r?i:s}),this.keyValidator=e,this.valueValidator=n}}function MT(t){return new xs(e=>{if(typeof e!==t)throw new Ke(`Expected ${t}, got ${Wa(e)}`);return e})}const vQ=new xs(t=>t),je=MT("string"),Ce=MT("number").check(t=>{if(Number.isNaN(t))throw new Ke("Expected a number, got NaN");if(!Number.isFinite(t))throw new Ke(`Expected a finite number, got ${t}`)}),Qy=Ce.check(t=>{if(t<0)throw new Ke(`Expected a positive number, got ${t}`)}),Xt=Ce.check(t=>{if(t<=0)throw new Ke(`Expected a non-zero positive number, got ${t}`)}),KL=Ce.check(t=>{if(!Number.isInteger(t))throw new Ke(`Expected an integer, got ${t}`)}),Pm=KL.check(t=>{if(t<0)throw new Ke(`Expected a positive integer, got ${t}`)}),xQ=KL.check(t=>{if(t<=0)throw new Ke(`Expected a non-zero positive integer, got ${t}`)}),De=MT("boolean");function Qn(t){return new xs(e=>{if(e!==t)throw new Ke(`Expected ${t}, got ${JSON.stringify(e)}`);return t})}const Hj=new xs(t=>{if(!Array.isArray(t))throw new Ke(`Expected an array, got ${Wa(t)}`);return t});function Pn(t){return new mQ(t)}function Ue(t){return new Jy(t)}function W_(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null||Object.getPrototypeOf(t)===QJ)}function H_(t){return t===null||typeof t=="number"||typeof t=="string"||typeof t=="boolean"?!0:Array.isArray(t)?t.every(H_):W_(t)?Object.values(t).every(H_):!1}const kn=new xs(t=>{if(H_(t))return t;throw new Ke(`Expected json serializable value, got ${typeof t}`)},(t,e)=>{if(Array.isArray(t)&&Array.isArray(e)){let n=t.length!==e.length;for(let s=0;s<e.length;s++){if(s>=t.length){n=!0,kn.validate(e[s]);continue}const i=t[s],r=e[s];if(Object.is(i,r))continue;const o=kn.validateUsingKnownGoodVersion(i,r);Object.is(o,i)||(n=!0)}return n?e:t}else if(W_(t)&&W_(e)){let n=!1;for(const s of Object.keys(e)){if(!Mr(t,s)){n=!0,kn.validate(e[s]);continue}const i=t[s],r=e[s];if(Object.is(i,r))continue;const o=kn.validateUsingKnownGoodVersion(i,r);Object.is(o,i)||(n=!0)}for(const s of Object.keys(t))if(!Mr(e,s)){n=!0;break}return n?e:t}else return kn.validate(e)});function ev(t,e){return new yQ(t,e)}function OT(t,e){return new Ax(t,e,(n,s)=>{throw new Ke(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(s)}`,[t])},!1)}function SQ(t,e){return new Ax(t,e,(n,s)=>{throw new Ke(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(s)}`,[t])},!0)}function Kr(t,e){return new xs(n=>zs(t,()=>e.validate(n)),(n,s)=>zs(t,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(n,s):e.validate(s)))}function Rx(t){return new xs(e=>{if(!t.has(e)){const n=Array.from(t,s=>JSON.stringify(s)).join(" or ");throw new Ke(`Expected ${n}, got ${e}`)}return e})}function YL(t){return new xs(e=>{if(e!==void 0)return t.validate(e)},(e,n)=>{if(!(e===void 0&&n===void 0)&&n!==void 0)return t.validateUsingKnownGoodVersion&&e!==void 0?t.validateUsingKnownGoodVersion(e,n):t.validate(n)})}function bQ(t){return new xs(e=>e===null?null:t.validate(e),(e,n)=>n===null?null:t.validateUsingKnownGoodVersion&&e!==null?t.validateUsingKnownGoodVersion(e,n):t.validate(n))}function Mx(...t){return Rx(new Set(t))}function DT(t){try{return new URL(t)}catch{if(t.startsWith("/")||t.startsWith("./"))try{return new URL(t,"http://example.com")}catch{throw new Ke(`Expected a valid url, got ${JSON.stringify(t)}`)}throw new Ke(`Expected a valid url, got ${JSON.stringify(t)}`)}}const wQ=new Set(["http:","https:","mailto:"]),oi=je.check(t=>{if(t==="")return;const e=DT(t);if(!wQ.has(e.protocol.toLowerCase()))throw new Ke(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)}),_Q=new Set(["http:","https:","data:","asset:"]),Hl=je.check(t=>{if(t==="")return;const e=DT(t);if(!_Q.has(e.protocol.toLowerCase()))throw new Ke(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});je.check(t=>{if(t==="")return;if(!DT(t).protocol.toLowerCase().match(/^https?:$/))throw new Ke(`Expected a valid url, got ${JSON.stringify(t)} (invalid protocol)`)});const LT=je.refine(t=>{try{return WJ(t),t}catch{throw new Ke(`Expected an index key, got ${JSON.stringify(t)}`)}});function ni(t){return je.refine(e=>{if(!e.startsWith(`${t}:`))throw new Error(`${t} ID must start with "${t}:"`);return e})}const Ox=ni("asset");function FT(t,e){return Ue({id:Ox,typeName:Qn("asset"),type:Qn(t),props:e,meta:kn})}const Gl=Ue({x:Ce,y:Ce,z:Ce.optional()}),Hh=Ue({x:Ce,y:Ce,w:Ce,h:Ce}),XL=Ce.check(t=>{if(t<0||t>1)throw new Ke("Opacity must be between 0 and 1")}),CQ=je.refine(t=>{if(!t.startsWith("page:")&&!t.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return t}),vi=ni("shape");function EQ(t,e,n){return Ue({id:vi,typeName:Qn("shape"),x:Ce,y:Ce,rotation:Ce,index:LT,parentId:CQ,type:Qn(t),isLocked:De,opacity:XL,props:e?Ue(e):kn,meta:n?Ue(n):kn})}const TQ=ni("binding");function IQ(t,e,n){return Ue({id:TQ,typeName:Qn("binding"),type:Qn(t),fromId:vi,toId:vi,props:e?Ue(e):kn,meta:n?Ue(n):kn})}Ws("com.tldraw.binding",{});di({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Ll(t){return`binding:${uf()}`}function PQ(t){return Vr("binding",{scope:"document",validator:Kr("binding",OT("type",df(t,(e,{props:n,meta:s})=>IQ(e,n,s))))}).withDefaultProperties(()=>({meta:{}}))}class On{constructor(e,n,s){this.id=e,this.defaultValue=n,this.type=s}static define(e,n){const{defaultValue:s,type:i=vQ}=n;return new On(e,s,i)}static defineEnum(e,n){const{defaultValue:s,values:i}=n;return new kQ(e,s,i)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,n){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,n):this.validate(n)}}class kQ extends On{constructor(e,n,s){super(e,n,Mx(...s)),this.values=s}}const wg=Ws("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),jQ=di({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:wg.AddIsLocked,up:t=>{t.isLocked=!1},down:t=>{delete t.isLocked}},{id:wg.HoistOpacity,up:t=>{t.opacity=Number(t.props.opacity??"1"),delete t.props.opacity},down:t=>{const e=t.opacity;delete t.opacity,t.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:wg.AddMeta,up:t=>{t.meta={}}},{id:wg.AddWhite,up:t=>{},down:t=>{t.props.color==="white"&&(t.props.color="black")}}]});function Qc(t){return t?t.typeName==="shape":!1}function Ps(t){return t?t.startsWith("shape:"):!1}function it(t){return`shape:${t??uf()}`}function qL(t){const e=new Map;for(const[n,s]of Object.entries(t))if(s instanceof On){if(e.has(s))throw new Error(`Duplicate style prop ${s.id}. Each style prop can only be used once within a shape.`);e.set(s,n)}return e}function ar(t,e){return df(e,(n,s)=>`com.tldraw.shape.${t}/${s}`)}function NQ(t){return Vr("shape",{scope:"document",validator:Kr("shape",OT("type",df(t,(e,{props:n,meta:s})=>EQ(e,n,s))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function Gj(t,e){const n=[];for(const[s,{migrations:i}]of Object.entries(e)){const r=`com.tldraw.${t}.${s}`;i?"sequenceId"in i?(xt(r===i.sequenceId,`sequenceId mismatch for ${s} ${Nx} migrations. Expected '${r}', got '${i.sequenceId}'`),n.push(i)):"sequence"in i?n.push(pd({sequenceId:r,retroactive:!1,sequence:i.sequence.map(o=>"id"in o?ZL(t,s,o):o)})):n.push(pd({sequenceId:r,retroactive:!1,sequence:Object.keys(i.migrators).map(o=>Number(o)).sort((o,l)=>o-l).map(o=>({id:`${r}/${o}`,scope:"record",filter:l=>l.typeName===t&&l.type===s,up:l=>{const c=i.migrators[o].up(l);if(c)return c},down:l=>{const c=i.migrators[o].down(l);if(c)return c}}))})):n.push(pd({sequenceId:r,retroactive:!1,sequence:[]}))}return n}function ZL(t,e,n){return{id:n.id,dependsOn:n.dependsOn,scope:"record",filter:s=>s.typeName===t&&s.type===e,up:s=>{const i=n.up(s.props);i&&(s.props=i)},down:typeof n.down=="function"?s=>{const i=n.down(s.props);i&&(s.props=i)}:void 0}}const JL=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],tv={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function Wo(t){return t.isDarkMode?tv.darkMode:tv.lightMode}const ai=On.defineEnum("tldraw:color",{defaultValue:"black",values:JL}),QL=On.defineEnum("tldraw:labelColor",{defaultValue:"black",values:JL}),Vl=On.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Kl=On.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),$r=On.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),eF={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},zr=On.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),tF=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],nv=On.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:tF}),sv=On.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:tF}),nF={labelColor:QL,color:ai,fill:Kl,dash:Vl,size:zr,arrowheadStart:nv,arrowheadEnd:sv,font:$r,start:Gl,end:Gl,bend:Ce,text:je,labelPosition:Ce,scale:Xt},Mc=ar("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function _g(t){return ZL("shape","arrow",t)}const sF=pd({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[_g({id:Mc.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"}),_g({id:Mc.AddIsPrecise,up:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise=!(t.normalizedAnchor.x===.5&&t.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:t,end:e})=>{t.type==="binding"&&(t.isPrecise||(t.normalizedAnchor={x:.5,y:.5}),delete t.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),_g({id:Mc.AddLabelPosition,up:t=>{t.labelPosition=.5},down:t=>{delete t.labelPosition}}),{id:Mc.ExtractBindings,scope:"store",up:t=>{const e=Object.values(t).filter(n=>n.typeName==="shape"&&n.type==="arrow");for(const n of e){const{start:s,end:i}=n.props;if(s.type==="binding"){const r=Ll(),o={typeName:"binding",id:r,type:"arrow",fromId:n.id,toId:s.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:s.normalizedAnchor,isExact:s.isExact,isPrecise:s.isPrecise}};t[r]=o,n.props.start={x:0,y:0}}else delete n.props.start.type;if(i.type==="binding"){const r=Ll(),o={typeName:"binding",id:r,type:"arrow",fromId:n.id,toId:i.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};t[r]=o,n.props.end={x:0,y:0}}else delete n.props.end.type}}},_g({id:Mc.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}})]}),iF={terminal:Mx("start","end"),normalizedAnchor:Gl,isExact:De,isPrecise:De},rF={sequence:[{dependsOn:[Mc.ExtractBindings]}]},AQ=Kr("camera",Ue({typeName:Qn("camera"),id:ni("camera"),x:Ce,y:Ce,z:Ce,meta:kn})),RQ=Ws("com.tldraw.camera",{AddMeta:1}),MQ=di({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:RQ.AddMeta,up:t=>{t.meta={}}}]}),Tr=Vr("camera",{validator:AQ,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),OQ=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),oF=Rx(OQ),DQ=Ue({type:oF,rotation:Ce}),LQ=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),FQ=Rx(LQ),BQ=new Set(["starting","paused","active","stopping"]),aF=Ue({id:je,points:Pn(Gl),size:Qy,color:FQ,opacity:Ce,state:Rx(BQ),delay:Ce,shrink:Ce,taper:De}),Ep=ni("page"),UQ=Kr("page",Ue({typeName:Qn("page"),id:Ep,name:je,index:LT,meta:kn})),$Q=Ws("com.tldraw.page",{AddMeta:1}),zQ=di({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:$Q.AddMeta,up:t=>{t.meta={}}}]}),No=Vr("page",{validator:UQ,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Ts(t){return No.isId(t)}const WQ={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1},lF=t=>t?zh(t,e=>WQ[e]):null;ni("instance");function HQ(t){const e={};for(const[s,i]of t)e[s]=YL(i);const n=Kr("instance",Ue({typeName:Qn("instance"),id:ni("instance"),currentPageId:Ep,followingUserId:je.nullable(),brush:Hh.nullable(),opacityForNextShape:XL,stylesForNextShape:Ue(e),cursor:DQ,scribbles:Pn(aF),isFocusMode:De,isDebugMode:De,isToolLocked:De,exportBackground:De,screenBounds:Hh,insets:Pn(De),zoomBrush:Hh.nullable(),isPenMode:De,isGridMode:De,chatMessage:je,isChatting:De,highlightedUserIds:Pn(je),isFocused:De,devicePixelRatio:Ce,isCoarsePointer:De,isHoveringCanvas:De.nullable(),openMenus:Pn(je),isChangingStyle:De,isReadonly:De,meta:kn,duplicateProps:Ue({shapeIds:Pn(ni("shape")),offset:Ue({x:Ce,y:Ce})}).nullable()}));return Vr("instance",{validator:n,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const bt=Ws("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),GQ=di({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:bt.AddTransparentExportBgs,up:t=>({...t,exportBackground:!0})},{id:bt.RemoveDialog,up:({dialog:t,...e})=>e},{id:bt.AddToolLockMode,up:t=>({...t,isToolLocked:!1})},{id:bt.RemoveExtraPropsForNextShape,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(t).filter(([n])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(n)))})},{id:bt.AddLabelColor,up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:{...t,labelColor:"black"}})},{id:bt.AddFollowingUserId,up:t=>({...t,followingUserId:null})},{id:bt.RemoveAlignJustify,up:t=>{let e=t.propsForNextShape.align;return e==="justify"&&(e="start"),{...t,propsForNextShape:{...t.propsForNextShape,align:e}}}},{id:bt.AddZoom,up:t=>({...t,zoomBrush:null})},{id:bt.AddVerticalAlign,up:t=>({...t,propsForNextShape:{...t.propsForNextShape,verticalAlign:"middle"}})},{id:bt.AddScribbleDelay,up:t=>t.scribble!==null?{...t,scribble:{...t.scribble,delay:0}}:{...t}},{id:bt.RemoveUserId,up:({userId:t,...e})=>e},{id:bt.AddIsPenModeAndIsGridMode,up:t=>({...t,isPenMode:!1,isGridMode:!1})},{id:bt.HoistOpacity,up:({propsForNextShape:{opacity:t,...e},...n})=>({...n,opacityForNextShape:Number(t??"1"),propsForNextShape:e})},{id:bt.AddChat,up:t=>({...t,chatMessage:"",isChatting:!1})},{id:bt.AddHighlightedUserIds,up:t=>({...t,highlightedUserIds:[]})},{id:bt.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:t,...e})=>({...e,stylesForNextShape:{}})},{id:bt.AddMeta,up:t=>({...t,meta:{}})},{id:bt.RemoveCursorColor,up:t=>{const{color:e,...n}=t.cursor;return{...t,cursor:n}}},{id:bt.AddLonelyProperties,up:t=>({...t,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:bt.ReadOnlyReadonly,up:({isReadOnly:t,...e})=>({...e,isReadonly:t})},{id:bt.AddHoveringCanvas,up:t=>({...t,isHoveringCanvas:null})},{id:bt.AddScribbles,up:({scribble:t,...e})=>({...e,scribbles:[]})},{id:bt.AddInset,up:t=>({...t,insets:[!1,!1,!1,!1]}),down:({insets:t,...e})=>({...e})},{id:bt.AddDuplicateProps,up:t=>({...t,duplicateProps:null}),down:({duplicateProps:t,...e})=>({...e})},{id:bt.RemoveCanMoveCamera,up:({canMoveCamera:t,...e})=>({...e}),down:t=>({...t,canMoveCamera:!0})}]}),ls="instance:instance",VQ=Kr("instance_page_state",Ue({typeName:Qn("instance_page_state"),id:ni("instance_page_state"),pageId:Ep,selectedShapeIds:Pn(vi),hintingShapeIds:Pn(vi),erasingShapeIds:Pn(vi),hoveredShapeId:vi.nullable(),editingShapeId:vi.nullable(),croppingShapeId:vi.nullable(),focusedGroupId:vi.nullable(),meta:kn})),Lu=Ws("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),KQ=di({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Lu.AddCroppingId,up(t){t.croppingShapeId=null}},{id:Lu.RemoveInstanceIdAndCameraId,up(t){delete t.instanceId,delete t.cameraId}},{id:Lu.AddMeta,up:t=>{t.meta={}}},{id:Lu.RenameProperties,up:t=>{},down:t=>{}},{id:Lu.RenamePropertiesAgain,up:t=>{t.selectedShapeIds=t.selectedIds,delete t.selectedIds,t.hintingShapeIds=t.hintingIds,delete t.hintingIds,t.erasingShapeIds=t.erasingIds,delete t.erasingIds,t.hoveredShapeId=t.hoveredId,delete t.hoveredId,t.editingShapeId=t.editingId,delete t.editingId,t.croppingShapeId=t.croppingShapeId??t.croppingId??null,delete t.croppingId,t.focusedGroupId=t.focusLayerId,delete t.focusLayerId},down:t=>{t.selectedIds=t.selectedShapeIds,delete t.selectedShapeIds,t.hintingIds=t.hintingShapeIds,delete t.hintingShapeIds,t.erasingIds=t.erasingShapeIds,delete t.erasingShapeIds,t.hoveredId=t.hoveredShapeId,delete t.hoveredShapeId,t.editingId=t.editingShapeId,delete t.editingShapeId,t.croppingId=t.croppingShapeId,delete t.croppingShapeId,t.focusLayerId=t.focusedGroupId,delete t.focusedGroupId}}]}),Yi=Vr("instance_page_state",{validator:VQ,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),YQ=Kr("pointer",Ue({typeName:Qn("pointer"),id:ni("pointer"),x:Ce,y:Ce,lastActivityTimestamp:Ce,meta:kn})),XQ=Ws("com.tldraw.pointer",{AddMeta:1}),qQ=di({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:XQ.AddMeta,up:t=>{t.meta={}}}]}),BT=Vr("pointer",{validator:YQ,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),iv=BT.createId("pointer"),ZQ=Kr("instance_presence",Ue({typeName:Qn("instance_presence"),id:ni("instance_presence"),userId:je,userName:je,lastActivityTimestamp:Ce,followingUserId:je.nullable(),cursor:Ue({x:Ce,y:Ce,type:oF,rotation:Ce}),color:je,camera:Ue({x:Ce,y:Ce,z:Ce}),screenBounds:Hh,selectedShapeIds:Pn(ni("shape")),currentPageId:ni("page"),brush:Hh.nullable(),scribbles:Pn(aF),chatMessage:je,meta:kn})),Fu=Ws("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),JQ=di({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:Fu.AddScribbleDelay,up:t=>{t.scribble!==null&&(t.scribble.delay=0)}},{id:Fu.RemoveInstanceId,up:t=>{delete t.instanceId}},{id:Fu.AddChatMessage,up:t=>{t.chatMessage=""}},{id:Fu.AddMeta,up:t=>{t.meta={}}},{id:Fu.RenameSelectedShapeIds,up:t=>{}}]}),QQ=Vr("instance_presence",{validator:ZQ,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),eee=Kr("document",Ue({typeName:Qn("document"),id:Qn("document:document"),gridSize:Ce,name:je,meta:kn})),Vj=Ws("com.tldraw.document",{AddName:1,AddMeta:2}),tee=di({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:Vj.AddName,up:t=>{t.name=""},down:t=>{delete t.name}},{id:Vj.AddMeta,up:t=>{t.meta={}}}]}),UT=Vr("document",{validator:eee,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),G_=UT.createId("document");function nee(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function Kj(t){t.typeName==="asset"&&("src"in t&&(t.src="<redacted>"),"src"in t.props&&(t.props.src="<redacted>"))}const see=({error:t,phase:e,record:n,recordBefore:s})=>{throw ET(t,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:s?Kj(yt(s)):void 0,recordAfter:Kj(yt(n))}}),t};function iee(){return[No.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function ree(t){const e=t.query.ids("page"),n=()=>{if(!t.has(G_))return t.put([UT.create({id:G_,name:t.props.defaultName})]),n();if(!t.has(iv))return t.put([BT.create({id:iv})]),n();const s=e.get();if(s.size===0)return t.put(iee()),n();const i=()=>[...s].map(c=>t.get(c)).sort(nee)[0].id,r=t.get(ls);if(r){if(!s.has(r.currentPageId))return t.put([{...r,currentPageId:i()}]),n()}else return t.put([t.schema.types.instance.create({id:ls,currentPageId:i(),exportBackground:!0})]),n();const o=new Set,l=new Set;for(const c of s){const d=Yi.createId(c);t.has(d)||o.add(d);const u=Tr.createId(c);t.has(u)||l.add(u)}o.size>0&&t.put([...o].map(c=>Yi.create({id:c,pageId:Yi.parseId(c)}))),l.size>0&&t.put([...l].map(c=>Tr.create({id:c})))};return n}const oee=FT("bookmark",Ue({title:je,description:je,image:je,favicon:je,src:Hl.nullable()})),Yj=Ws("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),aee=di({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:t=>t.type==="bookmark",sequence:[{id:Yj.MakeUrlsValid,up:t=>{Hl.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:Yj.AddFavicon,up:t=>{Hl.isValid(t.props.favicon)||(t.props.favicon="")},down:t=>{delete t.props.favicon}}]}),lee=FT("image",Ue({w:Ce,h:Ce,name:je,isAnimated:De,mimeType:je.nullable(),src:Hl.nullable(),fileSize:Xt.optional()})),Bu=Ws("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),cee=di({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:t=>t.type==="image",sequence:[{id:Bu.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:Bu.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:Bu.MakeUrlsValid,up:t=>{Hl.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:Bu.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:Bu.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),dee=FT("video",Ue({w:Ce,h:Ce,name:je,isAnimated:De,mimeType:je.nullable(),src:Hl.nullable(),fileSize:Ce.optional()})),Uu=Ws("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),uee=di({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:t=>t.type==="video",sequence:[{id:Uu.AddIsAnimated,up:t=>{t.props.isAnimated=!1},down:t=>{delete t.props.isAnimated}},{id:Uu.RenameWidthHeight,up:t=>{t.props.w=t.props.width,t.props.h=t.props.height,delete t.props.width,delete t.props.height},down:t=>{t.props.width=t.props.w,t.props.height=t.props.h,delete t.props.w,delete t.props.h}},{id:Uu.MakeUrlsValid,up:t=>{Hl.isValid(t.props.src)||(t.props.src="")},down:t=>{}},{id:Uu.AddFileSize,up:t=>{t.props.fileSize=-1},down:t=>{delete t.props.fileSize}},{id:Uu.MakeFileSizeOptional,up:t=>{t.props.fileSize===-1&&(t.props.fileSize=void 0)},down:t=>{t.props.fileSize===void 0&&(t.props.fileSize=-1)}}]}),hee=Kr("asset",OT("type",{image:lee,video:dee,bookmark:oee})),pee=Ws("com.tldraw.asset",{AddMeta:1}),fee=di({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:pee.AddMeta,up:t=>{t.meta={}}}]}),kl=Vr("asset",{validator:hee,scope:"document"}).withDefaultProperties(()=>({meta:{}})),cF={w:Xt,h:Xt,assetId:Ox.nullable(),url:oi},Xj=ar("bookmark",{NullAssetId:1,MakeUrlsValid:2}),dF={sequence:[{id:Xj.NullAssetId,up:t=>{t.assetId===void 0&&(t.assetId=null)},down:"retired"},{id:Xj.MakeUrlsValid,up:t=>{oi.isValid(t.url)||(t.url="")},down:t=>{}}]},uF=Ue({type:Mx("free","straight"),points:Pn(Gl)}),hF={color:ai,fill:Kl,dash:Vl,size:zr,segments:Pn(uF),isComplete:De,isClosed:De,isPen:De,scale:Xt},qj=ar("draw",{AddInPen:1,AddScale:2}),pF={sequence:[{id:qj.AddInPen,up:t=>{const{points:e}=t.segments[0];if(e.length===0){t.isPen=!1;return}let n=!(e[0].z===0||e[0].z===.5);e[1]&&(n=n&&!(e[1].z===0||e[1].z===.5)),t.isPen=n},down:"retired"},{id:qj.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]};var gee={};const Zj=/(^\/r\/[^/]+\/?$)/,Qe=t=>{try{return new URL(t)}catch{return}},hf=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(Zj))return t},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(Zj))return t}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{if(t.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!t.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${t}`},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/^\/embed\/?$/)){const n=e.searchParams.get("url");if(n)return n}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:t=>{if(t.includes("/maps/")){const e=t.match(/@(.*),(.*),(.*)z/);let n;if(e){const[,s,i,r]=e;n=`https://${new URL(t).host.replace("www.","")}/maps/embed/v1/view?key=${gee.NEXT_PUBLIC_GC_API_KEY}&center=${s},${i}&zoom=${r}`}else n="";return n}},fromEmbedUrl:t=>{const e=Qe(t);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const s=e.searchParams.get("zoom"),[i,r]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${r},${s}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=Qe(t),n=e&&e.pathname.match(/\/v\/(.+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:t=>{const e=Qe(t),n=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=Qe(t),n=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:t=>{const e=Qe(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,n=t.match(e);if(n){const[s,i,r]=n;return`https://codepen.io/${i}/embed/${r}`}},fromEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=t.match(e);if(n){const[s,i,r]=n;return`https://codepen.io/${i}/pen/${r}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:t=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,n=t.match(e);if(n){const[s,i]=n;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:t=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=t.match(e);if(n){const[s,i]=n;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=Qe(t);if(!e)return;const n=e.hostname.replace(/^www./,"");if(n==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((n==="youtube.com"||n==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:t=>{const e=Qe(t);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const s=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(s)return`https://www.youtube.com/watch?v=${s[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:t=>{const e=Qe(t),n=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&n){e.pathname="/calendar/embed";const s=Array.from(e.searchParams.keys());for(const i of s)e.searchParams.delete(i);return e.searchParams.set("src",n),e.href}},fromEmbedUrl:t=>{const e=Qe(t),n=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&n){e.pathname="/calendar/u/0";const s=Array.from(e.searchParams.keys());for(const i of s)e.searchParams.delete(i);return e.searchParams.set("cid",n),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:t=>{const e=Qe(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const n=Array.from(e.searchParams.keys());for(const s of n)e.searchParams.delete(s);return e.href}},fromEmbedUrl:t=>{const e=Qe(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const n=Array.from(e.searchParams.keys());for(const s of n)e.searchParams.delete(s);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${t}?embed=true`},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=Qe(t);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.hostname==="player.vimeo.com"){const n=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=Qe(t);if(e&&e.hash.match(/#room=/))return t},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.hash.match(/#room=/))return t}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const n=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${n}?cell=*`}},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:t=>{const e=Qe(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${t}?embed`},fromEmbedUrl:t=>{const e=Qe(t);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return t.replace("?embed","")}}],mee={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},fF={w:Xt,h:Xt,url:je},Cg=ar("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),gF={sequence:[{id:Cg.GenOriginalUrlInEmbed,up:t=>{try{const e=t.url,n=new URL(e).host.replace("www.","");let s;for(const i of hf)if(i.hostnames.includes(n))try{s=i.fromEmbedUrl(e)}catch(r){console.warn(r)}t.tmpOldUrl=t.url,t.url=s??""}catch{t.url="",t.tmpOldUrl=t.url}},down:"retired"},{id:Cg.RemoveDoesResize,up:t=>{delete t.doesResize},down:"retired"},{id:Cg.RemoveTmpOldUrl,up:t=>{delete t.tmpOldUrl},down:"retired"},{id:Cg.RemovePermissionOverrides,up:t=>{delete t.overridePermissions},down:"retired"}]},mF={w:Xt,h:Xt,name:je},yF={sequence:[]},rv=On.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),ov=On.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Ei=On.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),vF={geo:Ei,labelColor:QL,color:ai,fill:Kl,dash:Vl,size:zr,font:$r,align:rv,verticalAlign:ov,url:oi,w:Xt,h:Xt,growY:Qy,text:je,scale:Xt},Qr=ar("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),xF={sequence:[{id:Qr.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Qr.AddLabelColor,up:t=>{t.labelColor="black"},down:"retired"},{id:Qr.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:Qr.AddCheckBox,up:t=>{},down:"retired"},{id:Qr.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:Qr.MigrateLegacyAlign,up:t=>{let e;switch(t.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}t.align=e},down:"retired"},{id:Qr.AddCloud,up:t=>{},down:"retired"},{id:Qr.MakeUrlsValid,up:t=>{oi.isValid(t.url)||(t.url="")},down:t=>{}},{id:Qr.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},SF={},bF={sequence:[]},wF={color:ai,size:zr,segments:Pn(uF),isComplete:De,isPen:De,scale:Xt},yee=ar("highlight",{AddScale:1}),_F={sequence:[{id:yee.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},vee=Ue({topLeft:Gl,bottomRight:Gl}),CF={w:Xt,h:Xt,playing:De,url:oi,assetId:Ox.nullable(),crop:vee.nullable(),flipX:De,flipY:De},Eg=ar("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),EF={sequence:[{id:Eg.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Eg.AddCropProp,up:t=>{t.crop=null},down:t=>{delete t.crop}},{id:Eg.MakeUrlsValid,up:t=>{oi.isValid(t.url)||(t.url="")},down:t=>{}},{id:Eg.AddFlipProps,up:t=>{t.flipX=!1,t.flipY=!1},down:t=>{delete t.flipX,delete t.flipY}}]},av=On.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),xee=Ue({id:je,index:LT,x:Ce,y:Ce}),TF={color:ai,dash:Vl,size:zr,spline:av,points:ev(je,xee),scale:Xt},$u=ar("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),IF={sequence:[{id:$u.AddSnapHandles,up:t=>{for(const e of Object.values(t.handles))e.canSnap=!0},down:"retired"},{id:$u.RemoveExtraHandleProps,up:t=>{t.handles=NL(Object.values(t.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:t=>{const e=Object.entries(t.handles).map(([n,s])=>({index:n,...s})).sort(Xn);t.handles=Object.fromEntries(e.map((n,s)=>{const i=s===0?"start":s===e.length-1?"end":`handle:${n.index}`;return[i,{id:i,type:"vertex",canBind:!1,canSnap:!0,index:n.index,x:n.x,y:n.y}]}))}},{id:$u.HandlesToPoints,up:t=>{const e=Object.entries(t.handles).map(([n,{x:s,y:i}])=>({x:s,y:i,index:n})).sort(Xn);t.points=e.map(({x:n,y:s})=>({x:n,y:s})),delete t.handles},down:t=>{const e=Cp(t.points.length);t.handles=Object.fromEntries(t.points.map((n,s)=>[e[s],{x:n.x,y:n.y}])),delete t.points}},{id:$u.PointIndexIds,up:t=>{const e=Cp(t.points.length);t.points=Object.fromEntries(t.points.map((n,s)=>{const i=e[s];return[i,{id:i,index:i,x:n.x,y:n.y}]}))},down:t=>{const e=Object.values(t.points).sort(Xn);t.points=e.map(({x:n,y:s})=>({x:n,y:s}))}},{id:$u.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},PF={color:ai,size:zr,font:$r,fontSizeAdjustment:Qy,align:rv,verticalAlign:ov,growY:Qy,url:oi,text:je,scale:Xt},vl=ar("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7}),kF={sequence:[{id:vl.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:vl.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:vl.MigrateLegacyAlign,up:t=>{switch(t.align){case"start":t.align="start-legacy";return;case"end":t.align="end-legacy";return;default:t.align="middle-legacy";return}},down:"retired"},{id:vl.AddVerticalAlign,up:t=>{t.verticalAlign="middle"},down:"retired"},{id:vl.MakeUrlsValid,up:t=>{oi.isValid(t.url)||(t.url="")},down:t=>{}},{id:vl.AddFontSizeAdjustment,up:t=>{t.fontSizeAdjustment=0},down:t=>{delete t.fontSizeAdjustment}},{id:vl.AddScale,up:t=>{t.scale=1},down:t=>{delete t.scale}}]},V_=On.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),jF={color:ai,size:zr,font:$r,textAlign:V_,w:Xt,text:je,scale:Xt,autoSize:De},Jj=ar("text",{RemoveJustify:1,AddTextAlign:2}),NF={sequence:[{id:Jj.RemoveJustify,up:t=>{t.align==="justify"&&(t.align="start")},down:"retired"},{id:Jj.AddTextAlign,up:t=>{t.textAlign=t.align,delete t.align},down:t=>{t.align=t.textAlign,delete t.textAlign}}]},AF={w:Xt,h:Xt,time:Ce,playing:De,url:oi,assetId:Ox.nullable()},Qj=ar("video",{AddUrlProp:1,MakeUrlsValid:2}),RF={sequence:[{id:Qj.AddUrlProp,up:t=>{t.url=""},down:"retired"},{id:Qj.MakeUrlsValid,up:t=>{oi.isValid(t.url)||(t.url="")},down:t=>{}}]},Tg=Ws("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),See=pd({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:Tg.RemoveCodeAndIconShapeTypes,scope:"store",up:t=>{for(const[e,n]of $s(t))n.typeName==="shape"&&(n.type==="icon"||n.type==="code")&&delete t[e]}},{id:Tg.AddInstancePresenceType,scope:"store",up(t){}},{id:Tg.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:t=>{for(const[e,n]of $s(t))n.typeName.match(/^(user|user_presence)$/)&&delete t[e]}},{id:Tg.RemoveUserDocument,scope:"store",up:t=>{for(const[e,n]of $s(t))n.typeName.match("user_document")&&delete t[e]}}]}),bee={arrow:{migrations:sF,props:nF},bookmark:{migrations:dF,props:cF},draw:{migrations:pF,props:hF},embed:{migrations:gF,props:fF},frame:{migrations:yF,props:mF},geo:{migrations:xF,props:vF},group:{migrations:bF,props:SF},highlight:{migrations:_F,props:wF},image:{migrations:EF,props:CF},line:{migrations:IF,props:TF},note:{migrations:kF,props:PF},text:{migrations:NF,props:jF},video:{migrations:RF,props:AF}},wee={arrow:{migrations:rF,props:iF}};function _ee({shapes:t=bee,bindings:e=wee,migrations:n}={}){const s=new Map;for(const l of Ut(t))for(const c of qL(l.props??{}).keys()){if(s.has(c.id)&&s.get(c.id)!==c)throw new Error(`Multiple StyleProp instances with the same id: ${c.id}`);s.set(c.id,c)}const i=NQ(t),r=PQ(e),o=HQ(s);return RT.create({asset:kl,binding:r,camera:Tr,document:UT,instance:o,instance_page_state:Yi,page:No,instance_presence:QQ,pointer:BT,shape:i},{migrations:[See,fee,MQ,tee,GQ,KQ,zQ,JQ,qQ,jQ,aee,cee,uee,...Gj("shape",t),...Gj("binding",e),...n??[]],onValidationFailure:see,createIntegrityChecker:ree})}const Tp=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Catal"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espaol"},{locale:"fr",label:"Franais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugus - Brasil"},{locale:"pt-pt",label:"Portugus - Europeu"},{locale:"ro",label:"Romn"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"Trke"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ku",label:""},{locale:"ne",label:""},{locale:"hi-in",label:""},{locale:"te",label:""},{locale:"th",label:""},{locale:"my",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function Cee(){const t=typeof window<"u"?window.navigator.languages??["en"]:["en"];return Eee(t)}function Eee(t){for(const e of t){const n=Tee(e);if(n)return n}return"en"}const eN={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function Tee(t){const e=Tp.find(i=>i.locale===t.toLowerCase());if(e)return e.locale;const[n,s]=t.split(/[-_]/).map(i=>i.toLowerCase());if(s){const i=Tp.find(r=>r.locale===n);if(i)return i.locale}return n in eN?eN[n]:null}function Dx(t,e){const n=Oe.useRef(e);n.current=e;const[s,i,r]=Oe.useMemo(()=>{let o=null;const l=u=>(o=u,()=>{o=null}),c=new nu(`useStateTracking(${t})`,()=>{var u;return(u=n.current)==null?void 0:u.call(n)},{scheduleEffect(){o==null||o()}});return[c,l,()=>c.scheduleCount]},[t]);return Oe.useSyncExternalStore(i,r,r),Oe.useEffect(()=>(s.attach(),s.maybeScheduleEffect(),()=>{s.detach()}),[s]),s.execute()}const tN={apply(t,e,n){return Dx(t.displayName??t.name??"tracked(???)",()=>t.apply(e,n))}},Iee=Symbol.for("react.memo"),Pee=Symbol.for("react.forward_ref");function yn(t){let e=null;const n=t.$$typeof;return n===Iee&&(t=t.type,e=t.compare),n===Pee?S.memo(S.forwardRef(new Proxy(t.render,tN))):S.memo(new Proxy(t,tN),e)}function kee(){const t=arguments[0],e=arguments[1],n=arguments.length===3?void 0:arguments[2],s=arguments.length===3?arguments[2]:arguments[3];return S.useMemo(()=>te(`useComputed(${t})`,e,n),s)}function Aa(t,e,n=bo){S.useEffect(()=>{const s=new nu(t,e);return s.attach(),s.execute(),()=>{s.detach()}},n)}function Z(){const t=arguments,e=t.length===3?t[2]:[t[0]],n=t.length===3?t[0]:`useValue(${t[0].name})`,s=S.useRef(!0);s.current=!0;const i=S.useMemo(()=>t.length===1?t[0]:te(n,()=>{if(s.current)return t[1]();try{return t[1]()}catch{return{}}}),e);try{const{subscribe:r,getSnapshot:o}=S.useMemo(()=>({subscribe:l=>hc(`useValue(${n})`,()=>{i.get(),l()}),getSnapshot:()=>i.get()}),[i]);return S.useSyncExternalStore(r,o,o)}finally{s.current=!1}}var MF={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var r="",o=0;o<arguments.length;o++){var l=arguments[o];l&&(r=i(r,s(l)))}return r}function s(r){if(typeof r=="string"||typeof r=="number")return r;if(typeof r!="object")return"";if(Array.isArray(r))return n.apply(null,r);if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]"))return r.toString();var o="";for(var l in r)e.call(r,l)&&r[l]&&(o=i(o,l));return o}function i(r,o){return o?r?r+" "+o:r+o:r}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(MF);var jee=MF.exports;const Se=qa(jee),OF="2.4.6",nN={major:"2024-06-28T10:56:07.893Z",minor:"2024-07-22T16:42:50.301Z"},Nee={error:null};let DF=class extends S.Component{constructor(){super(...arguments);b(this,"state",Nee)}static getDerivedStateFromError(n){return{error:n}}componentDidCatch(n){var s,i;(i=(s=this.props).onError)==null||i.call(s,n)}render(){const{error:n}=this.state;if(n!==null){const{fallback:s}=this.props;return a.jsx(s,{error:n})}return this.props.children}};function Ip({children:t,fallback:e,...n}){return e===null?t:a.jsx(DF,{fallback:e,...n,children:t})}const Lx=S.createContext(null);function K(){const t=Oe.useContext(Lx);if(!t)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return t}function Aee(){return a.jsx("div",{className:"tl-background"})}function ru(t,e,n,s,i,r){S.useLayoutEffect(()=>{const o=t.current;if(!o||e===void 0)return;let l=`translate(${e}px, ${n}px)`;s!==void 0&&(l+=` scale(${s})`),i!==void 0&&(l+=` rotate(${i}rad)`),r&&(l+=` translate(${r.x}px, ${r.y}px)`),o.style.transform=l})}const un={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:-1+(4-2*t)*t,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t<=0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t>=1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t<=0?0:t>=1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2};class E{constructor(e=0,n=0,s=1){this.x=e,this.y=n,this.z=s}get pressure(){return this.z}set(e=this.x,n=this.y,s=this.z){return this.x=e,this.y=n,this.z=s,this}setTo({x:e=0,y:n=0,z:s=1}){return this.x=e,this.y=n,this.z=s,this}rot(e){if(e===0)return this;const{x:n,y:s}=this,i=Math.sin(e),r=Math.cos(e);return this.x=n*r-s*i,this.y=n*i+s*r,this}rotWith(e,n){if(n===0)return this;const s=this.x-e.x,i=this.y-e.y,r=Math.sin(n),o=Math.cos(n);return this.x=e.x+(s*o-i*r),this.y=e.y+(s*r+i*o),this}clone(){const{x:e,y:n,z:s}=this;return new E(e,n,s)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,n){return this.x-=e,this.y-=n,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,n){return this.x+=e,this.y+=n,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,n){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),n!==void 0&&(this.x=Math.min(this.x,n),this.y=Math.min(this.y,n)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,n){const s=E.Tan(e,this);return this.add(s.mul(n))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return E.Dpr(this,e)}cpr(e){return E.Cpr(this,e)}len2(){return E.Len2(this)}len(){return E.Len(this)}pry(e){return E.Pry(this,e)}per(){const{x:e,y:n}=this;return this.x=n,this.y=-e,this}uni(){return E.Uni(this)}tan(e){return E.Tan(this,e)}dist(e){return E.Dist(this,e)}distanceToLineSegment(e,n){return E.DistanceToLineSegment(e,n,this)}slope(e){return E.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return E.Angle(this,e)}toAngle(){return E.ToAngle(this)}lrp(e,n){return this.x=this.x+(e.x-this.x)*n,this.y=this.y+(e.y-this.y)*n,this}equals(e){return E.Equals(this,e)}equalsXY(e,n){return E.EqualsXY(this,e,n)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return E.ToFixed(this)}toString(){return E.ToString(E.ToFixed(this))}toJson(){return E.ToJson(this)}toArray(){return E.ToArray(this)}static Add(e,n){return new E(e.x+n.x,e.y+n.y)}static AddXY(e,n,s){return new E(e.x+n,e.y+s)}static Sub(e,n){return new E(e.x-n.x,e.y-n.y)}static SubXY(e,n,s){return new E(e.x-n,e.y-s)}static AddScalar(e,n){return new E(e.x+n,e.y+n)}static SubScalar(e,n){return new E(e.x-n,e.y-n)}static Div(e,n){return new E(e.x/n,e.y/n)}static Mul(e,n){return new E(e.x*n,e.y*n)}static DivV(e,n){return new E(e.x/n.x,e.y/n.y)}static MulV(e,n){return new E(e.x*n.x,e.y*n.y)}static Neg(e){return new E(-e.x,-e.y)}static Per(e){return new E(e.y,-e.x)}static Abs(e){return new E(Math.abs(e.x),Math.abs(e.y))}static Dist(e,n){return((e.y-n.y)**2+(e.x-n.x)**2)**.5}static DistMin(e,n,s){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)<s**2}static Dist2(e,n){return(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y)}static Dpr(e,n){return e.x*n.x+e.y*n.y}static Cross(e,n){return new E(e.y*n.z-e.z*n.y,e.z*n.x-e.x*n.z)}static Cpr(e,n){return e.x*n.y-n.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,n){return E.Dpr(e,n)/E.Len(n)}static Uni(e){return E.Div(e,E.Len(e))}static Tan(e,n){return E.Uni(E.Sub(e,n))}static Min(e,n){return new E(Math.min(e.x,n.x),Math.min(e.y,n.y))}static Max(e,n){return new E(Math.max(e.x,n.x),Math.max(e.y,n.y))}static From({x:e,y:n,z:s=1}){return new E(e,n,s)}static FromArray(e){return new E(e[0],e[1])}static Rot(e,n=0){const s=Math.sin(n),i=Math.cos(n);return new E(e.x*i-e.y*s,e.x*s+e.y*i)}static RotWith(e,n,s){const i=e.x-n.x,r=e.y-n.y,o=Math.sin(s),l=Math.cos(s);return new E(n.x+(i*l-r*o),n.y+(i*o+r*l))}static NearestPointOnLineThroughPoint(e,n,s){return E.Mul(n,E.Sub(s,e).pry(n)).add(e)}static NearestPointOnLineSegment(e,n,s,i=!0){if(E.Equals(e,s)||E.Equals(n,s))return E.From(s);const r=E.Tan(n,e),o=E.Add(e,E.Mul(r,E.Sub(s,e).pry(r)));if(i){if(o.x<Math.min(e.x,n.x))return E.Cast(e.x<n.x?e:n);if(o.x>Math.max(e.x,n.x))return E.Cast(e.x>n.x?e:n);if(o.y<Math.min(e.y,n.y))return E.Cast(e.y<n.y?e:n);if(o.y>Math.max(e.y,n.y))return E.Cast(e.y>n.y?e:n)}return o}static DistanceToLineThroughPoint(e,n,s){return E.Dist(s,E.NearestPointOnLineThroughPoint(e,n,s))}static DistanceToLineSegment(e,n,s,i=!0){return E.Dist(s,E.NearestPointOnLineSegment(e,n,s,i))}static Snap(e,n=1){return new E(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}static Cast(e){return e instanceof E?e:E.From(e)}static Slope(e,n){return e.x===n.y?NaN:(e.y-n.y)/(e.x-n.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,n){return Math.atan2(n.y-e.y,n.x-e.x)}static Lrp(e,n,s){return E.Sub(n,e).mul(s).add(e)}static Med(e,n){return new E((e.x+n.x)/2,(e.y+n.y)/2)}static Equals(e,n){return Math.abs(e.x-n.x)<1e-4&&Math.abs(e.y-n.y)<1e-4}static EqualsXY(e,n,s){return e.x===n&&e.y===s}static Clockwise(e,n,s){return(s.x-e.x)*(n.y-e.y)-(n.x-e.x)*(s.y-e.y)<0}static Rescale(e,n){const s=E.Len(e);return new E(n*e.x/s,n*e.y/s)}static ScaleWithOrigin(e,n,s){return E.Sub(e,s).mul(n).add(s)}static ToFixed(e){return new E(ao(e.x),ao(e.y))}static ToInt(e){return new E(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,n,s){return E.Add(e,E.Tan(n,e).mul(s))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let n=Math.atan2(e.y,e.x);return n<0&&(n+=Math.PI*2),n}static FromAngle(e,n=1){return new E(Math.cos(e)*n,Math.sin(e)*n)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:n,y:s,z:i}=e;return{x:n,y:s,z:i}}static Average(e){const n=e.length,s=new E(0,0);if(n===0)return s;for(let i=0;i<n;i++)s.add(e[i]);return s.div(n)}static Clamp(e,n,s){return s===void 0?new E(Math.min(Math.max(e.x,n)),Math.min(Math.max(e.y,n))):new E(Math.min(Math.max(e.x,n),s),Math.min(Math.max(e.y,n),s))}static PointsBetween(e,n,s=6){const i=[];for(let r=0;r<s;r++){const o=un.easeInQuad(r/(s-1)),l=E.Lrp(e,n,o);l.z=Math.min(1,.5+Math.abs(.5-Ree(o))*.65),i.push(l)}return i}static SnapToGrid(e,n=8){return new E(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}}const Ree=t=>t<.5?2*t*t:-1+(4-2*t)*t;function Xe(t){return`${G(t.x)},${G(t.y)} `}function Ns(t,e){return`${G((t.x+e.x)/2)},${G((t.y+e.y)/2)} `}const Ze=Math.PI,vt=Ze/2,tt=Ze*2,Mee=Math.sin;function on(t,e,n){return Math.max(e,typeof n<"u"?Math.min(t,n):t)}function Ig(t,e=1e10){return t?Math.round(t*e)/e:0}function Ra(t,e,n=1e-6){return Math.abs(t-e)<=n}function LF(t,e){const n=Math.pow(t-e,2)/Math.pow(t+e,2);return Ze*(t+e)*(1+3*n/(10+Math.sqrt(4-3*n)))}function Ma(t){return t=t%tt,t<0?t=t+tt:t===0&&(t=0),t}function pf(t,e){return t=Ma(t),e=Ma(e),t>e&&(e+=tt),e-t}function FF(t,e){return tt-pf(t,e)}function km(t,e){const n=(e-t)%tt;return 2*n%tt-n}function K_(t){return(tt+t)%tt}function lv(t,e){const n=tt/e;let s=Math.floor((K_(t)+n/2)/n)*n%tt;return s<Ze&&(s+=tt),s>Ze&&(s-=tt),s}function BF(t,e){return t===e||Ra(t%(Math.PI/2)-e%(Math.PI/2),0)}function Oee(t){return t*Ze/180}function Dee(t){return t*180/Ze}function Yl(t,e,n){return new E(t.x,t.y).add(E.FromAngle(n,e))}function qb(t,e,n){const s=t/2,i=e/2,r=[];let o=1/0,l=-1/0,c=1/0,d=-1/0;for(let g=0;g<n;g++){const y=tt/n,x=-vt+g*y,m=s+s*Math.cos(x),v=i+i*Math.sin(x);m<o&&(o=m),v<c&&(c=v),m>l&&(l=m),v>d&&(d=v),r.push(new E(m,v))}const u=l-o,h=d-c,p=t-u,f=e-h;if(p!==0||f!==0)for(let g=0;g<r.length;g++){const y=r[g];y.x=(y.x-o)/u*t,y.y=(y.y-c)/h*e}return r}function zu(t,e,n,s){return t<s&&n<e}function zi(t,e,n,s){const i=Math.max(t,n),r=Math.min(e,s);return i<=r?[i,r]:null}function sN(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}function si(t,e){let n=0,s,i;for(let r=0;r<e.length;r++){if(s=e[r],s.x===t.x&&s.y===t.y||(i=e[(r+1)%e.length],E.Dist(t,s)+E.Dist(t,i)===E.Dist(s,i)))return!0;s.y<=t.y?i.y>t.y&&sN(s,i,t)>0&&(n+=1):i.y<=t.y&&sN(s,i,t)<0&&(n-=1)}return n!==0}function G(t){return Math.round(t*1e4)/1e4}function ao(t){return Math.round(t*100)/100}const iN=t=>Math.abs(t)<Number.MAX_SAFE_INTEGER;function ua(t,e,n){return n<0?pf(t,e):FF(t,e)}function Y_(t,e,n,s){let i;if(Math.abs(t)>Ze){i=km(e,s);const r=km(s,n);return Math.abs(i)<Math.abs(r)?i/t:(t-r)/t}else{i=km(e,s);const r=i/t;return Math.sign(i)!==Math.sign(t)?Math.abs(r)>.5?1:0:r}}function Lee(t,e,n,s){const i=2*((e-t)%tt)%tt-(e-t)%tt;return s?(tt-Math.abs(i))*(n?1:-1):i}function $T(t,e,n){const s=-2*(t.x*(e.y-n.y)-t.y*(e.x-n.x)+e.x*n.y-n.x*e.y);return new E(((t.x*t.x+t.y*t.y)*(n.y-e.y)+(e.x*e.x+e.y*e.y)*(t.y-n.y)+(n.x*n.x+n.y*n.y)*(e.y-t.y))/s,((t.x*t.x+t.y*t.y)*(e.x-n.x)+(e.x*e.x+e.y*e.y)*(n.x-t.x)+(n.x*n.x+n.y*n.y)*(t.x-e.x))/s)}function Fee(t,e,n,s,i){if(n===null)return[E.From(t),E.From(e)];const r=[],o=E.Angle(n,t),l=E.Angle(n,e),c=pf(o,l);for(let d=0;d<i;d++){const u=d/(i-1),h=o+c*u,p=Yl(n,s,h);r.push(p)}return r}const Zb=({brush:t,color:e,opacity:n,className:s})=>{const i=S.useRef(null);ru(i,t.x,t.y);const r=G(Math.max(1,t.w)),o=G(Math.max(1,t.h));return a.jsx("svg",{className:"tl-overlays__item",ref:i,children:e?a.jsxs("g",{className:"tl-brush",opacity:n,children:[a.jsx("rect",{width:r,height:o,fill:e,opacity:.75}),a.jsx("rect",{width:r,height:o,fill:"none",stroke:e,opacity:.1})]}):a.jsx("rect",{className:`tl-brush tl-brush__default ${s}`,width:r,height:o})})},rN={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},Jb={duration:0,easing:un.easeInOutCubic},oN={CAMERA_MOVE:-10},Bee=["top","right","bottom","left"],aN=0,zT=2,Pg=1,lN=5,Uee=128;function cv(t){if(t instanceof HTMLElement)return t;if(t.parentElement)return cv(t.parentElement);throw Error("Could not find a parent element of an HTML type!")}function Ve(t){t.preventDefault(),Kt.logPreventDefaults.get()&&console.warn("preventDefault called on event:",t)}function ff(t,e){if(t.setPointerCapture(e.pointerId),Kt.logPointerCaptures.get()){const n=WL.get();n.set(t,(n.get(t)??0)+1),console.warn("setPointerCapture called on element:",t,e)}}function gf(t,e){if(t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),Kt.logPointerCaptures.get())){const n=WL.get();n.get(t)===1?n.delete(t):n.has(t)?n.set(t,n.get(t)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",t,e)}}const gn=t=>t.stopPropagation(),Wn=(t,e,n)=>{t&&t.style.setProperty(e,n)};function Os(t){return t.isKilled=!0,{point:{x:t.clientX,y:t.clientY,z:t.pressure},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:t.pointerId,button:t.button,isPen:t.pointerType==="pen"}}function UF(){const t=K();return S.useMemo(function(){let s,i;function r(y){if(!y.isKilled){if(y.button===zT){t.dispatch({type:"pointer",target:"canvas",name:"right_click",...Os(y)});return}y.button!==0&&y.button!==1&&y.button!==5||(ff(y.currentTarget,y),t.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Os(y)}))}}function o(y){y.isKilled||y.clientX===s&&y.clientY===i||(s=y.clientX,i=y.clientY,t.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Os(y)}))}function l(y){y.isKilled||y.button!==0&&y.button!==1&&y.button!==2&&y.button!==5||(s=y.clientX,i=y.clientY,gf(y.currentTarget,y),t.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Os(y)}))}function c(y){if(y.isKilled||t.getInstanceState().isPenMode&&y.pointerType!=="pen")return;const x=y.pointerType==="mouse"||y.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:x?!0:null})}function d(y){if(y.isKilled||t.getInstanceState().isPenMode&&y.pointerType!=="pen")return;const x=y.pointerType==="mouse"||y.pointerType==="pen";t.updateInstanceState({isHoveringCanvas:x?!1:null})}function u(y){y.isKilled=!0,Ve(y)}function h(y){y.isKilled=!0,y.target instanceof HTMLElement&&y.target.tagName!=="A"&&y.target.tagName!=="TEXTAREA"&&!(t.getEditingShape()&&y.target.className.includes("tl-text-content"))&&Ve(y)}function p(y){Ve(y)}async function f(y){var m,v;if(Ve(y),!((v=(m=y.dataTransfer)==null?void 0:m.files)!=null&&v.length))return;const x=Array.from(y.dataTransfer.files);await t.putExternalContent({type:"files",files:x,point:t.screenToPage({x:y.clientX,y:y.clientY}),ignoreParent:!1})}function g(y){gn(y)}return{onPointerDown:r,onPointerMove:o,onPointerUp:l,onPointerEnter:c,onPointerLeave:d,onDragOver:p,onDrop:f,onTouchStart:u,onTouchEnd:h,onClick:g}},[t])}function $ee(){const t=K();S.useEffect(()=>{let e=t.getInstanceState().isCoarsePointer;const n=o=>{const l=o.pointerType!=="mouse";e!==l&&(e=l,t.updateInstanceState({isCoarsePointer:l}))};window.addEventListener("pointerdown",n,{capture:!0});const s=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),i=t.environment.isFirefox&&!t.environment.isAndroid&&!t.environment.isIos,r=()=>{const o=i?!1:s.matches;e===o&&(e=o,t.updateInstanceState({isCoarsePointer:o}))};return s&&(s.addEventListener("change",r),r()),()=>{window.removeEventListener("pointerdown",n,{capture:!0}),s&&s.removeEventListener("change",r)}},[t])}const $F=S.createContext(null);function zee({container:t,children:e}){return a.jsx($F.Provider,{value:t,children:e})}function vn(){return wi(S.useContext($F),"useContainer used outside of <Tldraw />")}function Wee(){const t=K(),e=vn(),n=Z("isFocused",()=>t.getIsFocused(),[t]);S.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let s=null;const i=()=>{s!=null&&s();const r=`(resolution: ${window.devicePixelRatio}dppx)`,o=matchMedia(r),l=c=>{c.type==="change"&&i()};o.addEventListener?o.addEventListener("change",i):o.addListener&&o.addListener(l),s=()=>{o.removeEventListener?o.removeEventListener("change",i):o.removeListener&&o.removeListener(l)},t.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return i(),()=>{s==null||s()}},[t]),S.useEffect(()=>{if(!n)return;const s=l=>{if(l.altKey&&(t.isIn("zoom")||!t.getPath().endsWith(".idle"))&&!kg()&&Ve(l),l.isKilled)return;switch(l.isKilled=!0,l.key){case"=":case"-":case"0":{if(l.metaKey||l.ctrlKey){Ve(l);return}break}case"Tab":{if(kg()||t.getIsMenuOpen())return;break}case",":return;case"Escape":{if((t.getEditingShape()||t.getSelectedShapeIds().length>0)&&l.preventDefault(),t.getOpenMenus().length>0)return;t.inputs.keys.has("Escape")||(t.inputs.keys.add("Escape"),t.cancel(),t.focus());return}default:if(kg()||t.getIsMenuOpen())return}const c={type:"keyboard",name:l.repeat?"key_repeat":"key_down",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey};t.dispatch(c)},i=l=>{if(l.isKilled||(l.isKilled=!0,kg()||t.getIsMenuOpen())||l.key===",")return;const c={type:"keyboard",name:"key_up",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey};t.dispatch(c)};function r(l){var c,d;if(e.contains(l.target)){const u=l.touches[0].pageX,h=l.touches[0].radiusX||0;(u-h<10||u+h>t.getViewportScreenBounds().width-10)&&(((c=l.target)==null?void 0:c.tagName)==="BUTTON"&&((d=l.target)==null||d.click()),Ve(l))}}const o=l=>{e.contains(l.target)&&(l.ctrlKey||l.metaKey)&&Ve(l)};return e.addEventListener("touchstart",r,{passive:!1}),e.addEventListener("wheel",o,{passive:!1}),document.addEventListener("gesturestart",Ve),document.addEventListener("gesturechange",Ve),document.addEventListener("gestureend",Ve),e.addEventListener("keydown",s),e.addEventListener("keyup",i),()=>{e.removeEventListener("touchstart",r),e.removeEventListener("wheel",o),document.removeEventListener("gesturestart",Ve),document.removeEventListener("gesturechange",Ve),document.removeEventListener("gestureend",Ve),e.removeEventListener("keydown",s),e.removeEventListener("keyup",i)}},[t,e,n])}const Hee=["input","select","button","textarea"];function kg(){const{activeElement:t}=document;return!!(t&&(t.getAttribute("contenteditable")||Hee.indexOf(t.tagName.toLowerCase())>-1))}const Gee=["textarea","input"];function Vee(t){const e=K();S.useEffect(()=>{const n=t.current;if(!n)return;const s=i=>{var r;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:o}=i;if(Gee.includes((r=o.tagName)==null?void 0:r.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;Ve(i)}};return n.addEventListener("touchstart",s),n.addEventListener("touchend",s),()=>{n.removeEventListener("touchstart",s),n.removeEventListener("touchend",s)}},[e,t])}function Kee(t,e,n){return Math.max(e,Math.min(t,n))}const jn={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function cN(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function dN(t,e,n,s=.15){return s===0?Kee(t,e,n):t<e?-cN(e-t,n-e,s)+e:t>n?+cN(t-n,n-e,s)+n:t}function Yee(t,[e,n],[s,i]){const[[r,o],[l,c]]=t;return[dN(e,r,o,s),dN(n,l,c,i)]}function Xee(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function qee(t){var e=Xee(t,"string");return typeof e=="symbol"?e:String(e)}function Gn(t,e,n){return e=qee(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function uN(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,s)}return n}function Mt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?uN(Object(n),!0).forEach(function(s){Gn(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uN(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}const zF={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function hN(t){return t?t[0].toUpperCase()+t.slice(1):""}const Zee=["enter","leave"];function Jee(t=!1,e){return t&&!Zee.includes(e)}function Qee(t,e="",n=!1){const s=zF[t],i=s&&s[e]||e;return"on"+hN(t)+hN(i)+(Jee(n,i)?"Capture":"")}const ete=["gotpointercapture","lostpointercapture"];function tte(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const s=ete.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(s);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:n}}function nte(t,e=""){const n=zF[t],s=n&&n[e]||e;return t+s}function WF(t){return"touches"in t}function ste(t){return WF(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function ite(t){return Array.from(t.touches).filter(e=>{var n,s;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(s=n.contains)===null||s===void 0?void 0:s.call(n,e.target))})}function X_(t,e){try{const n=e.clientX-t.clientX,s=e.clientY-t.clientY,i=(e.clientX+t.clientX)/2,r=(e.clientY+t.clientY)/2,o=Math.hypot(n,s);return{angle:-(Math.atan2(n,s)*180)/Math.PI,distance:o,origin:[i,r]}}catch{}return null}function rte(t){return ite(t).map(e=>e.identifier)}function pN(t,e){const[n,s]=Array.from(t.touches).filter(i=>e.includes(i.identifier));return X_(n,s)}const fN=40,gN=800;function HF(t){let{deltaX:e,deltaY:n,deltaMode:s}=t;return s===1?(e*=fN,n*=fN):s===2&&(e*=gN,n*=gN),[e,n]}function ote(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:s,metaKey:i,ctrlKey:r}=t;Object.assign(e,{shiftKey:n,altKey:s,metaKey:i,ctrlKey:r})}return e}function dv(t,...e){return typeof t=="function"?t(...e):t}function ate(){}function lte(...t){return t.length===0?ate:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function mN(t,e){return Object.assign({},e,t||{})}const cte=32;class GF{constructor(e,n,s){this.ctrl=e,this.args=n,this.key=s,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:s,args:i}=this;n[s]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,s=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=s.from?dv(s.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:s,shared:i}=this;n.args=this.args;let r=0;if(e&&(n.event=e,s.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,ote(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,r=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const I=n._delta.map(Math.abs);jn.addTo(n._distance,I)}this.axisIntent&&this.axisIntent(e);const[o,l]=n._movement,[c,d]=s.threshold,{_step:u,values:h}=n;if(s.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=c&&h[0]),u[1]===!1&&(u[1]=Math.abs(l)>=d&&h[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=c&&Math.sign(o)*c),u[1]===!1&&(u[1]=Math.abs(l)>=d&&Math.sign(l)*d)),n.intentional=u[0]!==!1||u[1]!==!1,!n.intentional)return;const p=[0,0];if(s.hasCustomTransform){const[I,T]=h;p[0]=u[0]!==!1?I-u[0]:0,p[1]=u[1]!==!1?T-u[1]:0}else p[0]=u[0]!==!1?o-u[0]:0,p[1]=u[1]!==!1?l-u[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(p);const f=n.offset,g=n._active&&!n._blocked||n.active;g&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=i[this.ingKey]=n._active,e&&(n.first&&("bounds"in s&&(n._bounds=dv(s.bounds,n)),this.setup&&this.setup()),n.movement=p,this.computeOffset()));const[y,x]=n.offset,[[m,v],[w,_]]=n._bounds;n.overflow=[y<m?-1:y>v?1:0,x<w?-1:x>_?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const C=n._active?s.rubberband||[0,0]:[0,0];if(n.offset=Yee(n._bounds,n.offset,C),n.delta=jn.sub(n.offset,f),this.computeMovement(),g&&(!n.last||r>cte)){n.delta=jn.sub(n.offset,f);const I=n.delta.map(Math.abs);jn.addTo(n.distance,I),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&r>0&&(n.velocity=[I[0]/r,I[1]/r],n.timeDelta=r)}}emit(){const e=this.state,n=this.shared,s=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!s.triggerAllEvents)return;const i=this.handler(Mt(Mt(Mt({},n),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function dte([t,e],n){const s=Math.abs(t),i=Math.abs(e);if(s>i&&s>n)return"x";if(i>s&&i>n)return"y"}class ute extends GF{constructor(...e){super(...e),Gn(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=jn.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=jn.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,s=this.config;if(!n.axis&&e){const i=typeof s.axisThreshold=="object"?s.axisThreshold[ste(e)]:s.axisThreshold;n.axis=dte(n._movement,i)}n._blocked=(s.lockDirection||!!s.axis)&&!n.axis||!!s.axis&&s.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const hte=t=>t,yN=.15,VF={enabled(t=!0){return t},eventOptions(t,e,n){return Mt(Mt({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[yN,yN];case!1:return[0,0];default:return jn.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return jn.toVector(t)},transform(t,e,n){const s=t||n.shared.transform;return this.hasCustomTransform=!!s,s||hte},threshold(t){return jn.toVector(t,0)}},pte=0,mf=Mt(Mt({},VF),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=pte){return t},bounds(t={}){if(typeof t=="function")return r=>mf.bounds(t(r));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:s=-1/0,bottom:i=1/0}=t;return[[e,n],[s,i]]}}),yf=typeof window<"u"&&window.document&&window.document.createElement;function KF(){return yf&&"ontouchstart"in window}function fte(){return KF()||yf&&window.navigator.maxTouchPoints>1}function gte(){return yf&&"onpointerdown"in window}function mte(){return yf&&"exitPointerLock"in window.document}function yte(){try{return"constructor"in GestureEvent}catch{return!1}}const _i={isBrowser:yf,gesture:yte(),touch:KF(),touchscreen:fte(),pointer:gte(),pointerLock:mte()},vte=250,xte=180,Ste=.5,bte=50,wte=250,_te=10,vN={mouse:0,touch:0,pen:8};Mt(Mt({},mf),{},{device(t,e,{pointer:{touch:n=!1,lock:s=!1,mouse:i=!1}={}}){return this.pointerLock=s&&_i.pointerLock,_i.touch&&n?"touch":this.pointerLock?"mouse":_i.pointer&&!i?"pointer":_i.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?vte:void 0,!(!_i.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:s=1,keys:i=!0}={}}){return this.pointerButtons=s,this.keys=i,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:s=3,axis:i=void 0}){const r=jn.toVector(t,n?s:i?1:0);return this.filterTaps=n,this.tapsThreshold=s,r},swipe({velocity:t=Ste,distance:e=bte,duration:n=wte}={}){return{velocity:this.transform(jn.toVector(t)),distance:this.transform(jn.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return xte;case!1:return 0;default:return t}},axisThreshold(t){return t?Mt(Mt({},vN),t):vN},keyboardDisplacement(t=_te){return t}});function YF(t){const[e,n]=t.overflow,[s,i]=t._delta,[r,o]=t._direction;(e<0&&s>0&&r<0||e>0&&s<0&&r>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&i>0&&o<0||n>0&&i<0&&o>0)&&(t._movement[1]=t._movementBound[1])}const Cte=30,Ete=100;class Tte extends GF{constructor(...e){super(...e),Gn(this,"ingKey","pinching"),Gn(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:n,lastOffset:s}=this.state;e==="wheel"?this.state.offset=jn.add(n,s):this.state.offset=[(1+n[0])*s[0],n[1]+s[1]]}computeMovement(){const{offset:e,lastOffset:n}=this.state;this.state.movement=[e[0]/n[0],e[1]-n[1]]}axisIntent(){const e=this.state,[n,s]=e._movement;if(!e.axis){const i=Math.abs(n)*Cte-Math.abs(s);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const n=this.state,s=this.ctrl.touchIds;if(n._active&&n._touchIds.every(r=>s.has(r))||s.size<2)return;this.start(e),n._touchIds=Array.from(s).slice(0,2);const i=pN(e,n._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const n=this.state,s=n._pointerEvents,i=this.ctrl.pointerIds;if(n._active&&Array.from(s.keys()).every(o=>i.has(o))||(s.size<2&&s.set(e.pointerId,e),n._pointerEvents.size<2))return;this.start(e);const r=X_(...Array.from(s.values()));r&&this.pinchStart(e,r)}pinchStart(e,n){const s=this.state;s.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const n=pN(e,this.state._touchIds);n&&this.pinchMove(e,n)}pointerMove(e){const n=this.state._pointerEvents;if(n.has(e.pointerId)&&n.set(e.pointerId,e),!this.state._active)return;const s=X_(...Array.from(n.values()));s&&this.pinchMove(e,s)}pinchMove(e,n){const s=this.state,i=s._values[1],r=n.angle-i;let o=0;Math.abs(r)>270&&(o+=Math.sign(r)),this.computeValues([n.distance,n.angle-360*o]),s.origin=n.origin,s.turns=o,s._movement=[s._values[0]/s._initial[0]-1,s._values[1]-s._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const n=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}n._pointerEvents.has(e.pointerId)&&n._pointerEvents.delete(e.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const n=this.state;n._active||(this.start(e),this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY];const s=n._movement;n._movement=[e.scale-1,e.rotation],n._delta=jn.sub(n._movement,s),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const n=this.config.modifierKey;n&&(Array.isArray(n)?!n.find(s=>e[s]):!e[n])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const s=this.state;s._delta=[-HF(e)[1]/Ete*s.offset[0],0],jn.addTo(s._movement,s._delta),YF(s),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const n=this.config.device;n&&(e(n,"start",this[n+"Start"].bind(this)),e(n,"change",this[n+"Move"].bind(this)),e(n,"end",this[n+"End"].bind(this)),e(n,"cancel",this[n+"End"].bind(this)),e("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const Ite=Mt(Mt({},VF),{},{device(t,e,{shared:n,pointer:{touch:s=!1}={}}){if(n.target&&!_i.touch&&_i.gesture)return"gesture";if(_i.touch&&s)return"touch";if(_i.touchscreen){if(_i.pointer)return"pointer";if(_i.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:s={}}){const i=o=>{const l=mN(dv(n,o),{min:-1/0,max:1/0});return[l.min,l.max]},r=o=>{const l=mN(dv(s,o),{min:-1/0,max:1/0});return[l.min,l.max]};return typeof n!="function"&&typeof s!="function"?[i(),r()]:o=>[i(o),r(o)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",jn.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});Mt(Mt({},mf),{},{mouseOnly:(t=!0)=>t});class Pte extends ute{constructor(...e){super(...e),Gn(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const n=this.state;n._delta=HF(e),jn.addTo(n._movement,n._delta),YF(n),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const kte=mf;Mt(Mt({},mf),{},{mouseOnly:(t=!0)=>t});const WT=new Map,q_=new Map;function jte(t){WT.set(t.key,t.engine),q_.set(t.key,t.resolver)}const Nte={key:"pinch",engine:Tte,resolver:Ite},Ate={key:"wheel",engine:Pte,resolver:kte};function Rte(t,e){if(t==null)return{};var n={},s=Object.keys(t),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Mte(t,e){if(t==null)return{};var n=Rte(t,e),s,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}const Ote={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=_i.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},Dte=["target","eventOptions","window","enabled","transform"];function jm(t={},e){const n={};for(const[s,i]of Object.entries(e))switch(typeof i){case"function":n[s]=i.call(n,t[s],s,t);break;case"object":n[s]=jm(t[s],i);break;case"boolean":i&&(n[s]=t[s]);break}return n}function Lte(t,e,n={}){const s=t,{target:i,eventOptions:r,window:o,enabled:l,transform:c}=s,d=Mte(s,Dte);if(n.shared=jm({target:i,eventOptions:r,window:o,enabled:l,transform:c},Ote),e){const u=q_.get(e);n[e]=jm(Mt({shared:n.shared},d),u)}else for(const u in d){const h=q_.get(u);h&&(n[u]=jm(Mt({shared:n.shared},d[u]),h))}return n}class XF{constructor(e,n){Gn(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,s,i,r){const o=this._listeners,l=nte(n,s),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},d=Mt(Mt({},c),r);e.addEventListener(l,i,d);const u=()=>{e.removeEventListener(l,i,d),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class Fte{constructor(){Gn(this,"_timeouts",new Map)}add(e,n,s=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(n,s,...i))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class Bte{constructor(e){Gn(this,"gestures",new Set),Gn(this,"_targetEventStore",new XF(this)),Gn(this,"gestureEventStores",{}),Gn(this,"gestureTimeoutStores",{}),Gn(this,"handlers",{}),Gn(this,"config",{}),Gn(this,"pointerIds",new Set),Gn(this,"touchIds",new Set),Gn(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),Ute(this,e)}setEventIds(e){if(WF(e))return this.touchIds=new Set(rte(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=Lte(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,s={};let i;if(!(n.target&&(i=n.target(),!i))){if(n.enabled){for(const o of this.gestures){const l=this.config[o],c=xN(s,l.eventOptions,!!i);if(l.enabled){const d=WT.get(o);new d(this,e,o).bind(c)}}const r=xN(s,n.eventOptions,!!i);for(const o in this.nativeHandlers)r(o,"",l=>this.nativeHandlers[o](Mt(Mt({},this.state.shared),{},{event:l,args:e})),void 0,!0)}for(const r in s)s[r]=lte(...s[r]);if(!i)return s;for(const r in s){const{device:o,capture:l,passive:c}=tte(r);this._targetEventStore.add(i,o,"",s[r],{capture:l,passive:c})}}}}function _c(t,e){t.gestures.add(e),t.gestureEventStores[e]=new XF(t,e),t.gestureTimeoutStores[e]=new Fte}function Ute(t,e){e.drag&&_c(t,"drag"),e.wheel&&_c(t,"wheel"),e.scroll&&_c(t,"scroll"),e.move&&_c(t,"move"),e.pinch&&_c(t,"pinch"),e.hover&&_c(t,"hover")}const xN=(t,e,n)=>(s,i,r,o={},l=!1)=>{var c,d;const u=(c=o.capture)!==null&&c!==void 0?c:e.capture,h=(d=o.passive)!==null&&d!==void 0?d:e.passive;let p=l?s:Qee(s,i,u);n&&h&&(p+="Passive"),t[p]=t[p]||[],t[p].push(r)},$te=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function zte(t){const e={},n={},s=new Set;for(let i in t)$te.test(i)?(s.add(RegExp.lastMatch),n[i]=t[i]):e[i]=t[i];return[n,e,s]}function Cc(t,e,n,s,i,r){if(!t.has(n)||!WT.has(s))return;const o=n+"Start",l=n+"End",c=d=>{let u;return d.first&&o in e&&e[o](d),n in e&&(u=e[n](d)),d.last&&l in e&&e[l](d),u};i[s]=c,r[s]=r[s]||{}}function Wte(t,e){const[n,s,i]=zte(t),r={};return Cc(i,n,"onDrag","drag",r,e),Cc(i,n,"onWheel","wheel",r,e),Cc(i,n,"onScroll","scroll",r,e),Cc(i,n,"onPinch","pinch",r,e),Cc(i,n,"onMove","move",r,e),Cc(i,n,"onHover","hover",r,e),{handlers:r,config:e,nativeHandlers:s}}function Hte(t,e={},n,s){const i=Oe.useMemo(()=>new Bte(t),[]);if(i.applyHandlers(t,s),i.applyConfig(e,n),Oe.useEffect(i.effect.bind(i)),Oe.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function Gte(t){return t.forEach(jte),function(n,s){const{handlers:i,nativeHandlers:r,config:o}=Wte(n,s||{});return Hte(i,o,void 0,r)}}const SN=10,Vte=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function qF(t){let{deltaY:e,deltaX:n}=t,s=0;return t.ctrlKey||t.altKey||t.metaKey?s=(Math.abs(e)>SN?SN*Math.sign(e):e)/100:t.shiftKey&&!Vte&&(n=e,e=0),{x:-n,y:-e,z:-s}}const Kte=Gte([Ate,Nte]);let Ec;const Yte=t=>Ec===void 0?(Ec=t,!1):t-Ec>120&&t-Ec<160?(Ec=t,!0):(Ec=t,!1);function Xte(t){const e=K(),n=S.useMemo(()=>{let s="not sure";const i=({event:y})=>{if(!e.getInstanceState().isFocused||(s="not sure",Yte(Date.now())))return;const x=e.getEditingShapeId();if(x){const w=e.getShape(x);if(w&&e.getShapeUtil(w).canScroll(w)){const C=e.getShapePageBounds(x);if(C!=null&&C.containsPoint(e.inputs.currentPagePoint))return}}Ve(y),gn(y);const m=qF(y);if(m.x===0&&m.y===0)return;const v={type:"wheel",name:"wheel",delta:m,point:new E(y.clientX,y.clientY),shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey};e.dispatch(v)};let r=1,o=1,l=1,c=0;const d=new E,u=new E,h=y=>{const x=t.current;s="not sure";const{event:m,origin:v,da:w}=y;m instanceof WheelEvent||(m.target===x||x!=null&&x.contains(m.target))&&(u.x=v[0],u.y=v[1],d.x=v[0],d.y=v[1],r=w[0],o=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:v[0],y:v[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey}))},p=y=>{if(y&&(s="zooming"),s==="zooming")return;const x=Math.abs(c-r),m=E.Dist(d,u);switch(s){case"not sure":{x>24?s="zooming":m>16&&(s="panning");break}case"panning":{x>64&&(s="zooming");break}}};return{onWheel:i,onPinchStart:h,onPinchEnd:y=>{const x=t.current,{event:m,origin:v,offset:w}=y;if(m instanceof WheelEvent||!(m.target===x||x!=null&&x.contains(m.target)))return;const _=w[0];s="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:v[0],y:v[1],z:_},delta:{x:v[0],y:v[1]},shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey})})},onPinch:y=>{const x=t.current,{event:m,origin:v,offset:w,da:_}=y;if(m instanceof WheelEvent||!(m.target===x||x!=null&&x.contains(m.target)))return;const C=y.type==="gesturechange"||y.type==="gestureend";c=_[0];const I=v[0]-u.x,T=v[1]-u.y;switch(u.x=v[0],u.y=v[1],p(C),s){case"zooming":{l=w[0],e.dispatch({type:"pinch",name:"pinch",point:{x:v[0],y:v[1],z:l},delta:{x:I,y:T},shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:v[0],y:v[1],z:o},delta:{x:I,y:T},shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey});break}}}}},[e,t]);Kte(n,{target:t,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>({from:e.getZoomLevel(),max:8,min:.05})}})}function Qb(t,e,n){const s=t.getShape(e),i=t.getShapeHandles(s);return{shape:s,handle:i.find(r=>r.id===n)}}function qte(t,e){const n=K();return S.useMemo(()=>{const s=c=>{if(c.isKilled)return;const d=cv(c.currentTarget);ff(d,c);const{shape:u,handle:h}=Qb(n,t,e);h&&n.dispatch({type:"pointer",target:"handle",handle:h,shape:u,name:"pointer_down",...Os(c)})};let i,r;return{onPointerDown:s,onPointerMove:c=>{if(c.isKilled||c.clientX===i&&c.clientY===r)return;i=c.clientX,r=c.clientY;const{shape:d,handle:u}=Qb(n,t,e);u&&n.dispatch({type:"pointer",target:"handle",handle:u,shape:d,name:"pointer_move",...Os(c)})},onPointerUp:c=>{if(c.isKilled)return;const d=cv(c.currentTarget);gf(d,c);const{shape:u,handle:h}=Qb(n,t,e);h&&n.dispatch({type:"pointer",target:"handle",handle:h,shape:u,name:"pointer_up",...Os(c)})}}},[n,t,e])}const _t=class _t{constructor(e=0,n=0,s=0,i=0){b(this,"x",0);b(this,"y",0);b(this,"w",0);b(this,"h",0);this.x=e,this.y=n,this.w=s,this.h=i}get point(){return new E(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new E(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new E(this.minX,this.minY),new E(this.maxX,this.minY),new E(this.maxX,this.maxY),new E(this.minX,this.maxY)]}get cornersAndCenter(){return[new E(this.minX,this.minY),new E(this.maxX,this.minY),new E(this.maxX,this.maxY),new E(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new E(this.w,this.h)}toFixed(){return this.x=Ig(this.x),this.y=Ig(this.y),this.w=Ig(this.w),this.h=Ig(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,n=0,s=0,i=0){return this.x=e,this.y=n,this.w=s,this.h=i,this}expand(e){const n=Math.min(this.minX,e.minX),s=Math.min(this.minY,e.minY),i=Math.max(this.maxX,e.maxX),r=Math.max(this.maxY,e.maxY);return this.x=n,this.y=s,this.w=i-n,this.h=r-s,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:n,w:s,h:i}=this;return new _t(e,n,s,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const n=Math.round(this.minX/e)*e,s=Math.round(this.minY/e)*e,i=Math.round(this.maxX/e)*e,r=Math.round(this.maxY/e)*e;this.minX=n,this.minY=s,this.width=Math.max(1,i-n),this.height=Math.max(1,r-s)}collides(e){return _t.Collides(this,e)}contains(e){return _t.Contains(this,e)}includes(e){return _t.Includes(this,e)}containsPoint(e,n=0){return _t.ContainsPoint(this,e,n)}getHandlePoint(e){switch(e){case"top_left":return new E(this.minX,this.minY);case"top_right":return new E(this.maxX,this.minY);case"bottom_left":return new E(this.minX,this.maxY);case"bottom_right":return new E(this.maxX,this.maxY);case"top":return new E(this.midX,this.minY);case"right":return new E(this.maxX,this.midY);case"bottom":return new E(this.midX,this.maxY);case"left":return new E(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,n,s){const{minX:i,minY:r,maxX:o,maxY:l}=this;let{minX:c,minY:d,maxX:u,maxY:h}=this;switch(e){case"left":case"top_left":case"bottom_left":{c+=n;break}case"right":case"top_right":case"bottom_right":{u+=n;break}}switch(e){case"top":case"top_left":case"top_right":{d+=s;break}case"bottom":case"bottom_left":case"bottom_right":{h+=s;break}}const p=(u-c)/(o-i),f=(h-d)/(l-r),g=p<0,y=f<0;if(g){const x=u;u=c,c=x}if(y){const x=h;h=d,d=x}this.minX=c,this.minY=d,this.width=Math.abs(u-c),this.height=Math.abs(h-d)}union(e){const n=Math.min(this.minX,e.x),s=Math.min(this.minY,e.y),i=Math.max(this.maxX,e.w+e.x),r=Math.max(this.maxY,e.h+e.y);return this.x=n,this.y=s,this.width=i-n,this.height=r-s,this}static From(e){return new _t(e.x,e.y,e.w,e.h)}static FromCenter(e,n){return new _t(e.x-n.x/2,e.y-n.y/2,n.x,n.y)}static FromPoints(e){if(e.length===0)return new _t;let n=1/0,s=1/0,i=-1/0,r=-1/0,o;for(let l=0,c=e.length;l<c;l++)o=e[l],n=Math.min(o.x,n),s=Math.min(o.y,s),i=Math.max(o.x,i),r=Math.max(o.y,r);return new _t(n,s,i-n,r-s)}static Expand(e,n){const s=Math.min(n.minX,e.minX),i=Math.min(n.minY,e.minY),r=Math.max(n.maxX,e.maxX),o=Math.max(n.maxY,e.maxY);return new _t(s,i,r-s,o-i)}static ExpandBy(e,n){return new _t(e.minX-n,e.minY-n,e.width+n*2,e.height+n*2)}static Resize(e,n,s,i,r=!1){const{minX:o,minY:l,maxX:c,maxY:d}=e;let{minX:u,minY:h,maxX:p,maxY:f}=e;switch(n){case"left":case"top_left":case"bottom_left":{u+=s;break}case"right":case"top_right":case"bottom_right":{p+=s;break}}switch(n){case"top":case"top_left":case"top_right":{h+=i;break}case"bottom":case"bottom_left":case"bottom_right":{f+=i;break}}const g=(p-u)/(c-o),y=(f-h)/(d-l),x=g<0,m=y<0;if(r){const w=(c-o)/(d-l),_=Math.abs(p-u),C=Math.abs(f-h),I=_*(y<0?1:-1)*(1/w),T=C*(g<0?1:-1)*w,P=w<_/C;switch(n){case"top_left":{P?h=f+I:u=p+T;break}case"top_right":{P?h=f+I:p=u-T;break}case"bottom_right":{P?f=h-I:p=u-T;break}case"bottom_left":{P?f=h-I:u=p+T;break}case"bottom":case"top":{const k=(u+p)/2,N=C*w;u=k-N/2,p=k+N/2;break}case"left":case"right":{const k=(h+f)/2,N=_/w;h=k-N/2,f=k+N/2;break}}}if(x){const w=p;p=u,u=w}if(m){const w=f;f=h,h=w}const v=new _t(u,h,Math.abs(p-u),Math.abs(f-h));return{box:v,scaleX:+(v.width/e.width*(g>0?1:-1)).toFixed(5),scaleY:+(v.height/e.height*(y>0?1:-1)).toFixed(5)}}equals(e){return _t.Equals(this,e)}static Equals(e,n){return n.x===e.x&&n.y===e.y&&n.w===e.w&&n.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new _t(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};b(_t,"Collides",(e,n)=>!(e.maxX<n.minX||e.minX>n.maxX||e.maxY<n.minY||e.minY>n.maxY)),b(_t,"Contains",(e,n)=>e.minX<n.minX&&e.minY<n.minY&&e.maxY>n.maxY&&e.maxX>n.maxX),b(_t,"Includes",(e,n)=>_t.Collides(e,n)||_t.Contains(e,n)),b(_t,"ContainsPoint",(e,n,s=0)=>!(n.x<e.minX-s||n.y<e.minY-s||n.x>e.maxX+s||n.y>e.maxY+s)),b(_t,"Common",e=>{let n=1/0,s=1/0,i=-1/0,r=-1/0;for(let o=0;o<e.length;o++){const l=e[o];n=Math.min(n,l.minX),s=Math.min(s,l.minY),i=Math.max(i,l.maxX),r=Math.max(r,l.maxY)}return new _t(n,s,i-n,r-s)}),b(_t,"Sides",(e,n=0)=>{const{corners:s}=e;return[[s[0],s[1]],[s[1],s[2]],[s[2],s[3]],[s[3],s[0]]]});let de=_t;function Zte(t){switch(t){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return t}}function Jte(t){switch(t){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return t}}function Qte(t){return t==="top_left"||t==="top_right"||t==="bottom_right"||t==="bottom_left"}function ene(t){const e=K();S.useLayoutEffect(()=>{let n=new de;function s(){const d=t.current;if(!d)return null;const u=d.getBoundingClientRect(),h=new de(u.left||u.x,u.top||u.y,Math.max(u.width,1),Math.max(u.height,1));n.equals(h)||(e.updateViewportScreenBounds(h),n=h)}s();const i=xL(s,200,{trailing:!0}),r=e.timers.setInterval(i,1e3);window.addEventListener("resize",i);const o=new ResizeObserver(d=>{d[0].contentRect&&i()}),l=t.current;let c=null;return l&&(o.observe(l),c=tne(l),c.addEventListener("scroll",i)),()=>{clearInterval(r),window.removeEventListener("resize",i),o.disconnect(),c==null||c.removeEventListener("scroll",i),i.cancel()}},[e,t])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const tne=t=>{let e=t.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:n}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(n==="auto"||n==="scroll"||n==="overlay"))return e;e=e.parentElement}return document},et=class et{constructor(e,n,s,i,r,o){b(this,"a",1);b(this,"b",0);b(this,"c",0);b(this,"d",1);b(this,"e",0);b(this,"f",0);this.a=e,this.b=n,this.c=s,this.d=i,this.e=r,this.f=o}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const n=e,{a:s,b:i,c:r,d:o,e:l,f:c}=this;return this.a=s*n.a+r*n.b,this.c=s*n.c+r*n.d,this.e=s*n.e+r*n.f+l,this.b=i*n.a+o*n.b,this.d=i*n.c+o*n.d,this.f=i*n.e+o*n.f+c,this}rotate(e,n,s){return e===0?this:n===void 0?this.multiply(et.Rotate(e)):this.translate(n,s).multiply(et.Rotate(e)).translate(-n,-s)}translate(e,n){return this.multiply(et.Translate(e,n))}scale(e,n){return this.multiply(et.Scale(e,n))}invert(){const{a:e,b:n,c:s,d:i,e:r,f:o}=this,l=e*i-n*s;return this.a=i/l,this.b=n/-l,this.c=s/-l,this.d=e/l,this.e=(i*r-s*o)/-l,this.f=(n*r-e*o)/l,this}applyToPoint(e){return et.applyToPoint(this,e)}applyToPoints(e){return et.applyToPoints(this,e)}rotation(){return et.Rotation(this)}point(){return et.Point(this)}decomposed(){return et.Decompose(this)}toCssString(){return et.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return et.Decompose(this)}clone(){return new et(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new et(1,0,0,1,0,0)}static Translate(e,n){return new et(1,0,0,1,e,n)}static Rotate(e,n,s){if(e===0)return et.Identity();const i=Math.cos(e),r=Math.sin(e),o=new et(i,r,-r,i,0,0);return n===void 0?o:et.Compose(et.Translate(n,s),o,et.Translate(-n,-s))}static Multiply(e,n){return{a:e.a*n.a+e.c*n.b,c:e.a*n.c+e.c*n.d,e:e.a*n.e+e.c*n.f+e.e,b:e.b*n.a+e.d*n.b,d:e.b*n.c+e.d*n.d,f:e.b*n.e+e.d*n.f+e.f}}static Inverse(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/-n,f:(e.b*e.e-e.a*e.f)/n}}static Absolute(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/n,f:(e.b*e.e-e.a*e.f)/-n}}static Compose(...e){const n=et.Identity();for(let s=0,i=e.length;s<i;s++)n.multiply(e[s]);return n}static Point(e){return new E(e.e,e.f)}static Rotation(e){let n;if(e.a!==0||e.c!==0){const s=(e.a*e.a+e.c*e.c)**.5;n=Math.acos(e.a/s)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const s=(e.b*e.b+e.d*e.d)**.5;n=vt+Math.acos(e.b/s)*(e.d>0?-1:1)}else n=0;return K_(n)}static Decompose(e){let n,s,i;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;n=r,s=(e.a*e.d-e.b*e.c)/r,i=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;n=(e.a*e.d-e.b*e.c)/r,s=r,i=vt+Math.acos(e.b/r)*(e.d>0?-1:1)}else n=0,s=0,i=0;return{x:e.e,y:e.f,scaleX:n,scaleY:s,rotation:K_(i)}}static Smooth(e,n=1e10){return e.a=Math.round(e.a*n)/n,e.b=Math.round(e.b*n)/n,e.c=Math.round(e.c*n)/n,e.d=Math.round(e.d*n)/n,e.e=Math.round(e.e*n)/n,e.f=Math.round(e.f*n)/n,e}static toCssString(e){return`matrix(${G(e.a)}, ${G(e.b)}, ${G(e.c)}, ${G(e.d)}, ${G(e.e)}, ${G(e.f)})`}static applyToPoint(e,n){return new E(e.a*n.x+e.c*n.y+e.e,e.b*n.x+e.d*n.y+e.f,n.z)}static applyToXY(e,n,s){return[e.a*n+e.c*s+e.e,e.b*n+e.d*s+e.f]}static applyToPoints(e,n){return n.map(s=>new E(e.a*s.x+e.c*s.y+e.e,e.b*s.x+e.d*s.y+e.f,s.z))}static applyToBounds(e,n){return new de(e.e+n.minX,e.f+n.minY,n.width,n.height)}static From(e){return new et(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof et?e:et.From(e)}};b(et,"Scale",(e,n,s,i)=>{const r=new et(e,0,0,n,0,0);return s===void 0?r:et.Compose(et.Translate(s,i),r,et.Translate(-s,-i))});let ve=et;function ZF(t,e){return e===0?t:ZF(e,t%e)}function JF(t){const e=t.toString().split(".")[1];if(!e)return 1;const n=Math.pow(10,e.length),s=parseInt(e,10);return n/ZF(s,n)}class sl{constructor(e){b(this,"isFilled",!1);b(this,"isClosed",!0);b(this,"isLabel",!1);b(this,"debugColor");b(this,"ignore");b(this,"_vertices");b(this,"_bounds");b(this,"_area");b(this,"_length");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,n=0,s=!1){return this.isClosed&&(this.isFilled||s)&&si(e,this.vertices)?!0:E.Dist2(e,this.nearestPoint(e))<=n*n}distanceToPoint(e,n=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||n)&&si(e,this.vertices)?-1:1)}distanceToLineSegment(e,n){if(e.equals(n))return this.distanceToPoint(e);const{vertices:s}=this;let i,r=1/0,o,l,c;for(let d=0;d<s.length;d++)l=s[d],c=E.NearestPointOnLineSegment(e,n,l,!0),o=E.Dist2(l,c),o<r&&(r=o,i=c);if(!i)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&si(i,this.vertices)?-r:r}hitTestLineSegment(e,n,s=0){return this.distanceToLineSegment(e,n)<=s}nearestPointOnLineSegment(e,n){const{vertices:s}=this;let i,r=1/0,o,l,c;for(let d=0;d<s.length;d++)l=s[d],c=E.NearestPointOnLineSegment(e,n,l,!0),o=E.Dist2(l,c),o<r&&(r=o,i=c);if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,n=0){const{bounds:s}=this;return!(e.x<s.minX-n||e.y<s.minY-n||e.x>s.maxX+n||e.y>s.maxY+n)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return de.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let n=0;for(let s=0,i=e.length;s<i;s++){const r=e[s],o=e[(s+1)%i];n+=r.x*o.y-o.x*r.y}return n/2}toSimpleSvgPath(){let e="";const{vertices:n}=this,s=n.length;if(s===0)return e;e+=`M${n[0].x},${n[0].y}`;for(let i=1;i<s;i++)e+=`L${n[i].x},${n[i].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let n,s=e[0],i=0;for(let r=1;r<e.length;r++)n=e[r],i+=E.Dist2(s,n),s=n;return Math.sqrt(i)}}class sr extends sl{constructor(n){super({...n,isClosed:!0,isFilled:!1});b(this,"children",[]);b(this,"ignoredChildren",[]);for(const s of n.children)s.ignore?this.ignoredChildren.push(s):this.children.push(s);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(n=>!n.isLabel).flatMap(n=>n.vertices)}nearestPoint(n){let s=1/0,i;const{children:r}=this;if(r.length===0)throw Error("no children");let o,l;for(const c of r)o=c.nearestPoint(n),l=E.Dist2(o,n),l<s&&(s=l,i=o);if(!i)throw Error("nearest point not found");return i}distanceToPoint(n,s=!1){return Math.min(...this.children.map((i,r)=>i.distanceToPoint(n,s||r>0)))}hitTestPoint(n,s,i){return!!this.children.filter(r=>!r.isLabel).find(r=>r.hitTestPoint(n,s,i))}hitTestLineSegment(n,s,i){return!!this.children.filter(r=>!r.isLabel).find(r=>r.hitTestLineSegment(n,s,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let n="";for(const i of this.children)n+=i.toSimpleSvgPath();const s=de.FromPoints(this.vertices).corners;for(let i=0,r=s.length;i<r;i++){const o=s[i],l=s[(i-1+r)%r],c=o.dist(l),d=s[(i+1)%r],u=o.dist(d),h=o.clone().lrp(l,4/c),p=o,f=o.clone().lrp(d,4/u);n+=`M${h.x},${h.y} L${p.x},${p.y} L${f.x},${f.y} `}return n}getLength(){return this.children.reduce((n,s)=>s.isLabel?n:n+s.length,0)}getSvgPathData(){return this.children.map((n,s)=>n.isLabel?"":n.getSvgPathData(s===0)).join(" ")}}function nne(t=!0){const[e,n]=S.useState(0),s=K();S.useEffect(()=>{if(!t)return;const i=()=>n(r=>r+1);return s.on("tick",i),()=>{s.off("tick",i)}},[s,t])}const sne=yn(function({showStroke:e=!0,showVertices:n=!0,showClosestPointOnOutline:s=!0}){const i=K();nne(s);const r=i.getZoomLevel(),o=i.getRenderingShapes(),{inputs:{currentPagePoint:l}}=i;return a.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(c=>{const d=i.getShape(c.id);if(d.type==="group")return null;const u=i.getShapeGeometry(d),h=i.getShapePageTransform(d),p=i.getPointInShapeSpace(d,l),f=u.nearestPoint(p),g=u.distanceToPoint(p,!0),y=Math.abs(g)*r,x=g<0,{vertices:m}=u;return a.jsxs("g",{transform:h.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&a.jsx("g",{stroke:u.debugColor??"red",opacity:"1",strokeWidth:2/r,fill:"none",children:a.jsx(QF,{geometry:u})}),n&&m.map((v,w)=>a.jsx("circle",{cx:v.x,cy:v.y,r:2/r,fill:`hsl(${Ad(w,[0,m.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/r},`v${w}`)),s&&y<150&&a.jsx("line",{x1:f.x,y1:f.y,x2:p.x,y2:p.y,opacity:1-y/150,stroke:x?"goldenrod":"dodgerblue",strokeWidth:2/r})]},c.id+"_outline")})})});function QF({geometry:t}){return t instanceof sr?a.jsx(a.Fragment,{children:[...t.children,...t.ignoredChildren].map((e,n)=>a.jsx(QF,{geometry:e},n))}):a.jsx("path",{d:t.toSimpleSvgPath()})}function e5(t){return kJ(t)}function t5(){const t=K(),e=kee("userIds",()=>e5(t.getCollaborators().map(n=>n.userId)).sort(),{isEqual:(n,s)=>{var i;return n.join(",")===((i=s.join)==null?void 0:i.call(s,","))}},[t]);return Z(e)}function Fx(t){const e=K();return Z(`latestPresence:${t}`,()=>e.getCollaborators().find(s=>s.userId===t),[e,t])??null}const ine=yn(function(){return t5().map(n=>a.jsx(rne,{collaboratorId:n},n))}),rne=yn(function({collaboratorId:e}){const n=K(),s=Fx(e),i=ane(n,s);if(!(s&&s.currentPageId===n.getCurrentPageId()))return null;switch(i){case"inactive":{const{followingUserId:r,highlightedUserIds:o}=n.getInstanceState();if(!(r===s.userId||o.includes(s.userId)))return null;break}case"idle":{const{highlightedUserIds:r}=n.getInstanceState();if(s.followingUserId===n.user.getId()&&!(s.chatMessage||r.includes(s.userId)))return null;break}}return a.jsx(one,{latestPresence:s})}),one=yn(function({latestPresence:e}){const n=K(),{CollaboratorBrush:s,CollaboratorScribble:i,CollaboratorCursor:r,CollaboratorHint:o,CollaboratorShapeIndicator:l}=kt(),c=n.getZoomLevel(),d=n.getViewportPageBounds(),{userId:u,chatMessage:h,brush:p,scribbles:f,selectedShapeIds:g,userName:y,cursor:x,color:m}=e,v=!(x.x<d.minX-12/c||x.y<d.minY-16/c||x.x>d.maxX-12/c||x.y>d.maxY-16/c);return a.jsxs(a.Fragment,{children:[p&&s?a.jsx(s,{className:"tl-collaborator__brush",brush:p,color:m,opacity:.1},u+"_brush"):null,v&&r?a.jsx(r,{className:"tl-collaborator__cursor",point:x,color:m,zoom:c,name:y!=="New User"?y:null,chatMessage:h},u+"_cursor"):o?a.jsx(o,{className:"tl-collaborator__cursor-hint",point:x,color:m,zoom:c,viewport:d},u+"_cursor_hint"):null,i&&f.length?a.jsx(a.Fragment,{children:f.map(w=>a.jsx(i,{className:"tl-collaborator__scribble",scribble:w,color:m,zoom:c,opacity:w.color==="laser"?.5:.1},u+"_scribble_"+w.id))}):null,l&&g.map(w=>a.jsx(l,{className:"tl-collaborator__shape-indicator",shapeId:w,color:m,opacity:.5},u+"_"+w))]})});function bN(t,e){return e>t.options.collaboratorInactiveTimeoutMs?"inactive":e>t.options.collaboratorIdleTimeoutMs?"idle":"active"}function ane(t,e){const n=S.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[s,i]=S.useState(()=>bN(t,Date.now()-n.current));return S.useEffect(()=>{const r=t.timers.setInterval(()=>{i(bN(t,Date.now()-n.current))},t.options.collaboratorCheckIntervalMs);return()=>clearInterval(r)},[t]),e&&(n.current=e.lastActivityTimestamp),s}const n5=S.memo(function({id:e,shape:n,util:s,index:i,backgroundIndex:r,opacity:o,dprMultiple:l}){const c=K(),{ShapeErrorFallback:d}=kt(),u=S.useRef(null),h=S.useRef(null),p=S.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});Aa("set shape stuff",()=>{const y=c.getShape(e);if(!y)return;const x=p.current,m=c.getShapeClipPath(e)??"none";m!==x.clipPath&&(Wn(u.current,"clip-path",m),Wn(h.current,"clip-path",m),x.clipPath=m);const v=c.getShapePageTransform(e),w=ve.toCssString(v),_=c.getShapeGeometry(y).bounds;w!==x.transform&&(Wn(u.current,"transform",w),Wn(h.current,"transform",w),x.transform=w);const C=_.w%l,I=_.h%l,T=C===0?_.w:_.w+(l-C),P=I===0?_.h:_.h+(l-I);(T!==x.width||P!==x.height)&&(Wn(u.current,"width",Math.max(T,l)+"px"),Wn(u.current,"height",Math.max(P,l)+"px"),Wn(h.current,"width",Math.max(T,l)+"px"),Wn(h.current,"height",Math.max(P,l)+"px"),x.width=T,x.height=P)},[c]),Aa("set opacity and z-index",()=>{const y=u.current,x=h.current;Wn(y,"opacity",o),Wn(x,"opacity",o),Wn(y,"z-index",i),Wn(x,"z-index",r)},[o,i,r]),Aa("set display",()=>{if(!c.getShape(e))return;const m=c.getCulledShapes().has(e);m!==p.current.isCulled&&(Wn(u.current,"display",m?"none":"block"),Wn(h.current,"display",m?"none":"block"),p.current.isCulled=m)},[c]);const f=S.useCallback(y=>c.annotateError(y,{origin:"shape",willCrashApp:!1}),[c]);if(!n)return null;const g="fill"in n.props&&n.props.fill!=="none";return a.jsxs(a.Fragment,{children:[s.backgroundComponent&&a.jsx("div",{ref:h,className:"tl-shape tl-shape-background","data-shape-type":n.type,draggable:!1,children:a.jsx(Ip,{fallback:d,onError:f,children:a.jsx(cne,{shape:n,util:s})})}),a.jsx("div",{ref:u,className:"tl-shape","data-shape-type":n.type,"data-shape-is-filled":g,draggable:!1,children:a.jsx(Ip,{fallback:d,onError:f,children:a.jsx(lne,{shape:n,util:s})})})]})}),lne=S.memo(function({shape:e,util:n}){return Dx("InnerShape:"+e.type,()=>n.component(n.editor.store.unsafeGetWithoutCapture(e.id)))},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta),cne=S.memo(function({shape:e,util:n}){return Dx("InnerShape:"+e.type,()=>{var s;return(s=n.backgroundComponent)==null?void 0:s.call(n,n.editor.store.unsafeGetWithoutCapture(e.id))})},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta);function dne({className:t}){const e=K(),{Background:n,SvgDefs:s,ShapeIndicators:i}=kt(),r=S.useRef(null),o=S.useRef(null),l=S.useRef(null),c=vn();ene(r),Wee(),$ee(),Xte(r),Vee(r);const d=S.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});Aa("position layers",function(){const{x:v,y:w,z:_}=e.getCamera();if(d.current.allowTextOutline&&e.environment.isSafari&&(c.style.setProperty("--tl-text-outline","none"),d.current.allowTextOutline=!1),d.current.allowTextOutline&&_<e.options.textShadowLod!==d.current.lodDisableTextOutline){const T=_<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",T?"none":"var(--tl-text-outline-reference)"),d.current.lodDisableTextOutline=T}const C=_>=1?Ad(_,[1,8],[.125,.5],!0):Ad(_,[.1,1],[-2,.125],!0),I=`scale(${G(_)}) translate(${G(v+C)}px,${G(w+C)}px)`;Wn(o.current,"transform",I),Wn(l.current,"transform",I)},[e,c]);const u=UF(),h=Z("shapeSvgDefs",()=>{const m=new Map;for(const v of Ut(e.shapeUtils)){if(!v)return;const w=v.getCanvasSvgDefs();for(const{key:_,component:C}of w)m.has(_)||m.set(_,a.jsx(C,{},_))}return[...m.values()]},[e]),p=Z("debug_shapes",()=>Kt.hideShapes.get(),[Kt]),f=Z("debug_svg",()=>Kt.debugSvg.get(),[Kt]),g=Z("debug_geometry",()=>Kt.debugGeometry.get(),[Kt]),y=Z("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),x=Z("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{ref:r,draggable:!1,"data-iseditinganything":y,"data-isselectinganything":x,className:Se("tl-canvas",t),"data-testid":"canvas",...u,children:[a.jsx("svg",{className:"tl-svg-context",children:a.jsxs("defs",{children:[h,a.jsx(Cne,{}),a.jsx(Ene,{}),s&&a.jsx(s,{})]})}),n&&a.jsx("div",{className:"tl-background__wrapper",children:a.jsx(n,{})}),a.jsx(hne,{}),a.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[a.jsx(kne,{}),a.jsx(Pne,{}),p?null:f?a.jsx(Sne,{}):a.jsx(wne,{})]}),a.jsx("div",{className:"tl-overlays",children:a.jsxs("div",{ref:l,className:"tl-html-layer",children:[g?a.jsx(sne,{}):null,a.jsx(yne,{}),a.jsx(fne,{}),a.jsx(pne,{}),a.jsx(gne,{}),i&&a.jsx(i,{}),a.jsx(_ne,{}),a.jsx(mne,{}),a.jsx(Ine,{}),a.jsx(ine,{})]})}),a.jsx(jne,{})]}),a.jsx(une,{})]})}function une(){const{InFrontOfTheCanvas:t}=kt();return t?a.jsx(t,{}):null}function hne(){const t=K(),e=Z("gridSize",()=>t.getDocumentSettings().gridSize,[t]),{x:n,y:s,z:i}=Z("camera",()=>t.getCamera(),[t]),r=Z("isGridMode",()=>t.getInstanceState().isGridMode,[t]),{Grid:o}=kt();return o&&r?a.jsx(o,{x:n,y:s,z:i,size:e}):null}function pne(){const t=K(),e=Z("scribbles",()=>t.getInstanceState().scribbles,[t]),n=Z("zoomLevel",()=>t.getZoomLevel(),[t]),{Scribble:s}=kt();return s&&e.length?e.map(i=>a.jsx(s,{className:"tl-user-scribble",scribble:i,zoom:n},i.id)):null}function fne(){const t=K(),e=Z("brush",()=>t.getInstanceState().brush,[t]),{Brush:n}=kt();return n&&e?a.jsx(n,{className:"tl-user-brush",brush:e}):null}function gne(){const t=K(),e=Z("zoomBrush",()=>t.getInstanceState().zoomBrush,[t]),{ZoomBrush:n}=kt();return n&&e?a.jsx(n,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function mne(){const t=K(),e=Z("snapLines",()=>t.snaps.getIndicators(),[t]),n=Z("zoomLevel",()=>t.getZoomLevel(),[t]),{SnapIndicator:s}=kt();return s&&e.length>0?e.map(i=>a.jsx(s,{className:"tl-user-snapline",line:i,zoom:n},i.id)):null}function yne(){const t=K(),e=Z("handles shapeIdWithHandles",()=>{const{isReadonly:n,isChangingStyle:s}=t.getInstanceState();if(n||s)return!1;const i=t.getOnlySelectedShape();return!i||!t.getShapeHandles(i)?!1:i.id},[t]);return e?a.jsx(vne,{shapeId:e}):null}function vne({shapeId:t}){const e=K(),{Handles:n}=kt(),s=Z("zoomLevel",()=>e.getZoomLevel(),[e]),i=Z("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),r=Z("handles transform",()=>e.getShapePageTransform(t),[e,t]),o=Z("handles",()=>{const l=e.getShapeHandles(t);if(!l)return null;const c=(i?e.options.coarseHandleRadius:e.options.handleRadius)/s*2;return l.filter(d=>d.type!=="virtual"||!l.some(u=>u!==d&&u.type==="vertex"&&E.Dist(d,u)<c)).sort(d=>d.type==="vertex"?1:-1)},[e,s,i,t]);return!n||!o||!r?null:a.jsx(n,{children:a.jsx("g",{transform:ve.toCssString(r),children:o.map(l=>a.jsx(xne,{shapeId:t,handle:l,zoom:s,isCoarse:i},l.id))})})}function xne({shapeId:t,handle:e,zoom:n,isCoarse:s}){const i=qte(t,e.id),{Handle:r}=kt();return r?a.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:a.jsx(r,{shapeId:t,handle:e,zoom:n,isCoarse:s})}):null}function Sne(){const t=K(),e=Z("rendering shapes",()=>t.getRenderingShapes(),[t]),n=Z("dpr multiple",()=>JF(Math.floor(t.getInstanceState().devicePixelRatio*100)/100),[t]);return e.map(s=>a.jsxs(S.Fragment,{children:[a.jsx(n5,{...s,dprMultiple:n}),a.jsx(Tne,{id:s.id})]},s.id+"_fragment"))}function bne(){const t=K(),e=S.useRef(new Set);return Aa("reflow for culled shapes",()=>{const n=t.getCulledShapes();if(e.current.size===n.size&&[...n].every(i=>e.current.has(i)))return;e.current=n;const s=document.getElementsByClassName("tl-canvas");s.length!==0&&s[0].offsetHeight},[t]),null}function wne(){const t=K(),e=Z("rendering shapes",()=>t.getRenderingShapes(),[t]),n=Z("dpr multiple",()=>JF(Math.floor(t.getInstanceState().devicePixelRatio*100)/100),[t]);return a.jsxs(a.Fragment,{children:[e.map(s=>a.jsx(n5,{...s,dprMultiple:n},s.id+"_shape")),t.environment.isSafari&&a.jsx(bne,{})]})}function _ne(){const t=K(),{ShapeIndicator:e}=kt(),n=Z("hinting shape ids",()=>CT(t.getHintingShapeIds()),[t]);return!n.length||!e?null:n.map(s=>a.jsx(e,{className:"tl-user-indicator__hint",shapeId:s},s+"_hinting"))}function Cne(){return a.jsxs("g",{id:"cursor",children:[a.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[a.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),a.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),a.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[a.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),a.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),a.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[a.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),a.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function Ene(){return a.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function Tne({id:t}){const e=K(),[n,s]=S.useState(null),i=Z("is in root",()=>{const r=e.getShape(t);return(r==null?void 0:r.parentId)===e.getCurrentPageId()},[e,t]);return S.useEffect(()=>{if(!i)return;let r=null;const o=hc("shape to svg",async()=>{const l=Math.random();r=l;const d=e.isShapeOfType(t,"frame")?0:10;let u=e.getShapePageBounds(t);if(!u)return;u=u.clone().expandBy(d);const h=await e.getSvgString([t],{padding:d,background:e.getInstanceState().exportBackground});if(r!==l||!h)return;const p=`data:image/svg+xml;utf8,${encodeURIComponent(h.svg)}`;s({src:p,bounds:u})});return()=>{r=null,o()}},[e,t,i]),!i||!n?null:a.jsx("img",{src:n.src,width:n.bounds.width,height:n.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${n.bounds.x}px, ${n.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function Ine(){const t=K(),e=Z("selection rotation",()=>t.getSelectionRotation(),[t]),n=Z("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionForeground:s}=kt();return!n||!s?null:a.jsx(s,{bounds:n,rotation:e})}function Pne(){const t=K(),e=Z("selection rotation",()=>t.getSelectionRotation(),[t]),n=Z("selection bounds",()=>t.getSelectionRotatedPageBounds(),[t]),{SelectionBackground:s}=kt();return!n||!s?null:a.jsx(s,{bounds:n,rotation:e})}function kne(){const{OnTheCanvas:t}=kt();return t?a.jsx(t,{}):null}function jne(){const t=K(),e=Z("camera state",()=>t.getCameraState(),[t]);return a.jsx("div",{className:Se("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function Nne({className:t,zoom:e,point:n,color:s,viewport:i,opacity:r=1}){const o=S.useRef(null);return ru(o,on(n.x,i.minX+5/e,i.maxX-5/e),on(n.y,i.minY+5/e,i.maxY-5/e),1/e,E.Angle(i.center,n)),a.jsxs("svg",{ref:o,className:Se("tl-overlays__item",t),children:[a.jsx("use",{href:"#cursor_hint",color:s,strokeWidth:3,stroke:"var(--color-background)"}),a.jsx("use",{href:"#cursor_hint",color:s,opacity:r})]})}const wN=S.memo(function({className:e,zoom:n,point:s,color:i,name:r,chatMessage:o}){const l=S.useRef(null);return ru(l,s==null?void 0:s.x,s==null?void 0:s.y,1/n),s?a.jsxs("div",{ref:l,className:Se("tl-overlays__item",e),children:[a.jsx("svg",{className:"tl-cursor",children:a.jsx("use",{href:"#cursor",color:i})}),o?a.jsxs(a.Fragment,{children:[r&&a.jsx("div",{className:"tl-nametag-title",style:{color:i},children:r}),a.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:o})]}):r&&a.jsx("div",{className:"tl-nametag",style:{backgroundColor:i},children:r})]}):null});function s5(){return S.useId().replace(/:/g,"_")}function Ane({x:t,y:e,z:n,size:s}){const i=`grid_${s5()}`,r=K(),{gridSteps:o}=r.options;return a.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("defs",{children:o.map(({min:l,mid:c,step:d},u)=>{const h=d*s*n,p=.5+t*n,f=.5+e*n,g=p>0?p%h:h+p%h,y=f>0?f%h:h+f%h,x=n<c?Ad(n,[l,c],[0,1]):1;return a.jsx("pattern",{id:`${i}_${d}`,width:h,height:h,patternUnits:"userSpaceOnUse",children:a.jsx("circle",{className:"tl-grid-dot",cx:g,cy:y,r:1,opacity:x})},u)})}),o.map(({step:l},c)=>a.jsx("rect",{width:"100%",height:"100%",fill:`url(#${i}_${l})`},c))]})}function Rne({handle:t,isCoarse:e,className:n,zoom:s}){const i=K(),r=(e?i.options.coarseHandleRadius:i.options.handleRadius)/s;if(t.type==="clone"){const l=3/s,c=`M0,${-l} A${l},${l} 0 0,1 0,${l}`,d=Bee.indexOf(t.id);return a.jsxs("g",{className:Se(`tl-handle tl-handle__${t.type}`,n),children:[a.jsx("circle",{className:"tl-handle__bg",r}),a.jsx("path",{className:"tl-handle__fg",d:c,transform:`rotate(${-90+90*d})`})]})}const o=(t.type==="create"&&e?3:4)/Math.max(s,.25);return a.jsxs("g",{className:Se(`tl-handle tl-handle__${t.type}`,n),children:[a.jsx("circle",{className:"tl-handle__bg",r}),a.jsx("circle",{className:"tl-handle__fg",r:o})]})}const Mne=({children:t})=>a.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:t}),One=()=>{const{Spinner:t}=kt();return a.jsx(s1,{children:t?a.jsx(t,{}):null})};function HT(t,e=!0){const n=t.length;if(n<2)return"";let s=t[0],i=t[1];if(n===2)return`M${Xe(s)}L${Xe(i)}`;let r="";for(let o=2,l=n-1;o<l;o++)s=t[o],i=t[o+1],r+=Ns(s,i);return e?`M${Ns(t[0],t[1])}Q${Xe(t[1])}${Ns(t[1],t[2])}T${r}${Ns(t[n-1],t[0])}${Ns(t[0],t[1])}Z`:`M${Xe(t[0])}Q${Xe(t[1])}${Ns(t[1],t[2])}${t.length>3?"T":""}${r}L${Xe(t[n-1])}`}function _N({scribble:t,zoom:e,color:n,opacity:s,className:i}){return t.points.length?a.jsx("svg",{className:i&&Se("tl-overlays__item",i),children:a.jsx("path",{className:"tl-scribble",d:HT(t.points,!1),stroke:n??`var(--color-${t.color})`,fill:"none",strokeWidth:8/e,opacity:s??t.opacity})}):null}function i5({bounds:t,rotation:e}){const n=S.useRef(null);return ru(n,t.x,t.y,1,e),S.useLayoutEffect(()=>{const s=n.current;s&&(s.style.width=G(Math.max(1,t.width))+"px",s.style.height=G(Math.max(1,t.height))+"px")},[t.width,t.height]),a.jsx("div",{ref:n,className:"tl-selection__bg",draggable:!1})}function Dne({bounds:t,rotation:e}){const n=K(),s=S.useRef(null),i=Z("only selected shape",()=>n.getOnlySelectedShape(),[n]),r=i?n.getShapeUtil(i).expandSelectionOutlinePx(i):0;return ru(s,t==null?void 0:t.x,t==null?void 0:t.y,1,e,{x:-r,y:-r}),t=t.clone().expandBy(r).zeroFix(),a.jsx("svg",{ref:s,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:a.jsx("rect",{className:Se("tl-selection__fg__outline"),width:G(t.width),height:G(t.height)})})}const Lne=()=>a.jsx("div",{className:"tl-shape-error-boundary"}),Fne=({shape:t,util:e})=>Dx("Indicator: "+t.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(t.id))),Bne=({editor:t,id:e})=>{const n=Z("shape for indicator",()=>t.store.get(e),[t,e]),{ShapeIndicatorErrorFallback:s}=kt();return!n||n.isLocked?null:a.jsx(Ip,{fallback:s,onError:i=>t.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:a.jsx(Fne,{shape:n,util:t.getShapeUtil(n)},n.id)})},CN=S.memo(function({shapeId:e,className:n,color:s,hidden:i,opacity:r}){const o=K(),l=S.useRef(null);return Aa("indicator transform",()=>{const c=l.current;if(!c)return;const d=o.getShapePageTransform(e);d&&c.style.setProperty("transform",d.toCssString())},[o,e]),S.useLayoutEffect(()=>{const c=l.current;c&&c.style.setProperty("display",i?"none":"block")},[i]),a.jsx("svg",{ref:l,className:Se("tl-overlays__item",n),children:a.jsx("g",{className:"tl-shape-indicator",stroke:s??"var(--color-selected)",opacity:r,children:a.jsx(Bne,{editor:o,id:e})})})}),Une=()=>a.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),r5=S.memo(function(){const e=K(),n=S.useRef(new Set),s=Z("should display selected ids",()=>{const o=n.current,l=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const c=e.getSelectedShapeIds();for(const d of c)l.add(d);if(e.isInAny("select.idle","select.editing_shape")){const d=e.getInstanceState();if(d.isHoveringCanvas&&!d.isCoarsePointer){const u=e.getHoveredShapeId();u&&l.add(u)}}}if(o.size!==l.size)return n.current=l,l;for(const c of l)if(!o.has(c))return n.current=l,l;return o},[e]),i=Z("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:r}=kt();return r?i.map(({id:o})=>a.jsx(r,{shapeId:o,hidden:!s.has(o)},o+"_indicator")):null});function $ne({points:t,zoom:e}){const n=2.5/e,s=t.reduce((p,f)=>Math.min(p,f.x),1/0),i=t.reduce((p,f)=>Math.max(p,f.x),-1/0),r=t.reduce((p,f)=>Math.min(p,f.y),1/0),o=t.reduce((p,f)=>Math.max(p,f.y),-1/0),l=t.some(p=>p.x===s&&p.y===r);let c,d,u,h;return l?(c=s,d=r,u=i,h=o):(c=s,d=o,u=i,h=r),a.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[a.jsx("line",{x1:c,y1:d,x2:u,y2:h}),t.map((p,f)=>a.jsx("g",{transform:`translate(${p.x},${p.y})`,children:a.jsx("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})},f))]})}function zne({gaps:t,direction:e,zoom:n}){const s=3.5/n;let i=[-1/0,1/0],r=null;const o=e==="horizontal";for(const c of t){if(r=zi(i[0],i[1],o?c.startEdge[0].y:c.startEdge[0].x,o?c.startEdge[1].y:c.startEdge[1].x),r)i=r;else continue;if(r=zi(i[0],i[1],o?c.endEdge[0].y:c.endEdge[0].x,o?c.endEdge[1].y:c.endEdge[1].x),r)i=r;else continue}if(i===null)return null;const l=(i[0]+i[1])/2;return a.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:t.map(({startEdge:c,endEdge:d},u)=>a.jsx(S.Fragment,{children:o?a.jsxs(a.Fragment,{children:[a.jsx("line",{x1:c[0].x,y1:l-2*s,x2:c[1].x,y2:l+2*s}),a.jsx("line",{x1:d[0].x,y1:l-2*s,x2:d[1].x,y2:l+2*s}),a.jsx("line",{x1:c[0].x,y1:l,x2:d[0].x,y2:l}),a.jsx("line",{x1:(c[0].x+d[0].x)/2,y1:l-s,x2:(c[0].x+d[0].x)/2,y2:l+s})]}):a.jsxs(a.Fragment,{children:[a.jsx("line",{x1:l-2*s,y1:c[0].y,x2:l+2*s,y2:c[1].y}),a.jsx("line",{x1:l-2*s,y1:d[0].y,x2:l+2*s,y2:d[1].y}),a.jsx("line",{x1:l,y1:c[0].y,x2:l,y2:d[0].y}),a.jsx("line",{x1:l-s,y1:(c[0].y+d[0].y)/2,x2:l+s,y2:(c[0].y+d[0].y)/2})]})},u))})}function Wne({className:t,line:e,zoom:n}){return a.jsx("svg",{className:Se("tl-overlays__item",t),children:e.type==="points"?a.jsx($ne,{...e,zoom:n}):e.type==="gaps"?a.jsx(zne,{...e,zoom:n}):null})}function GT(){return a.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:a.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[a.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),a.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:a.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const Hne=()=>null;function o5(t,e){const n=S.useRef(t);return e(t,n.current)?n.current:(n.current=t,t)}function Gh(t){return o5(t,AJ)}const Gne=(t,e)=>(t??(t=null),e??(e=null),t===e?!0:!t||!e?!1:AL(t,e));function Bx(t){return o5(t,Gne)}const a5=S.createContext(null);function Vne({overrides:t={},children:e}){const n=Bx(t),s=S.useMemo(()=>({Background:Aee,SvgDefs:Hne,Brush:Zb,ZoomBrush:Zb,CollaboratorBrush:Zb,Cursor:wN,CollaboratorCursor:wN,CollaboratorHint:Nne,CollaboratorShapeIndicator:CN,Grid:Ane,Scribble:_N,SnapIndicator:Wne,Handles:Mne,Handle:Rne,CollaboratorScribble:_N,ErrorFallback:c5,ShapeErrorFallback:Lne,ShapeIndicatorErrorFallback:Une,Spinner:GT,SelectionBackground:i5,SelectionForeground:Dne,ShapeIndicators:r5,ShapeIndicator:CN,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:dne,LoadingScreen:One,...n}),[n]);return a.jsx(a5.Provider,{value:s,children:e})}function kt(){const t=S.useContext(a5);if(!t)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return t}const VT={openWindow:(t,e)=>window.open(t,e,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var t;return await((t=window.__tldraw__hardReset)==null?void 0:t.call(window))}};function l5(){VT.hardReset()}function Kne(){VT.refreshPage()}const Yne="https://github.com/tldraw/tldraw/issues/new",c5=({error:t,editor:e})=>{const n=S.useRef(null),[s,i]=S.useState(!1),[r,o]=S.useState(!1),[l,c]=S.useState(!1);let d=null;try{d=kt().Canvas??null}catch{}const u=t instanceof Error?t.message:String(t),h=t instanceof Error?t.stack:null,p=Z("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[f,g]=S.useState(null);S.useLayoutEffect(()=>{var C;p!==null&&g(p);let w=(C=n.current)==null?void 0:C.parentElement,_=!1;for(;w;){if(w.classList.contains("tl-theme__dark")||w.classList.contains("tl-theme__light")){_=!0;break}w=w.parentElement}if(_){g(null);return}typeof window<"u"&&"matchMedia"in window&&g(window.matchMedia("(prefers-color-scheme: dark)").matches)},[p]),S.useEffect(()=>{if(r){const w=e==null?void 0:e.timers.setTimeout(()=>{o(!1)},2e3);return()=>clearTimeout(w)}},[r,e]);const y=()=>{const w=document.createElement("textarea");w.value=h??u,document.body.appendChild(w),w.select(),document.execCommand("copy"),w.remove(),o(!0)},x=()=>{Kne()},m=async()=>{l5()},v=new URL(Yne);return v.searchParams.set("title",u),v.searchParams.set("labels","bug"),v.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${h??u}
\`\`\`

My browser: ${navigator.userAgent}`),a.jsxs("div",{ref:n,className:Se("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[a.jsx("div",{className:"tl-error-boundary__overlay"}),e&&a.jsx(DF,{onError:wp,fallback:()=>null,children:a.jsx(Lx.Provider,{value:e,children:a.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:d?a.jsx(d,{}):null})})}),a.jsx("div",{className:Se("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":s&&!l}),children:l?a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Are you sure?"}),a.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),a.jsxs("div",{className:"tl-error-boundary__content__actions",children:[a.jsx("button",{onClick:()=>c(!1),children:"Cancel"}),a.jsx("button",{className:"tl-error-boundary__reset",onClick:m,children:"Reset data"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Something's gone wrong."}),a.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",a.jsx("a",{href:v.toString(),children:"create a GitHub issue"})," or"," ",a.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),s&&a.jsxs(a.Fragment,{children:["Message:",a.jsx("h4",{children:a.jsx("code",{children:u})}),"Stack trace:",a.jsxs("div",{className:"tl-error-boundary__content__error",children:[a.jsx("pre",{children:a.jsx("code",{children:h??u})}),a.jsx("button",{onClick:y,children:r?"Copied!":"Copy"})]})]}),a.jsxs("div",{className:"tl-error-boundary__content__actions",children:[a.jsx("button",{onClick:()=>i(!s),children:s?"Hide details":"Show details"}),a.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[a.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),a.jsx("button",{className:"tl-error-boundary__refresh",onClick:x,children:"Refresh Page"})]})]})]})})]})};function Rt(){return uf()}const d5="TLDRAW_USER_DATA_v3",u5=Ue({id:je,name:je.nullable().optional(),locale:je.nullable().optional(),color:je.nullable().optional(),colorScheme:Mx("light","dark","system").optional(),animationSpeed:Ce.nullable().optional(),edgeScrollSpeed:Ce.nullable().optional(),isSnapMode:De.nullable().optional(),isWrapMode:De.nullable().optional(),isDynamicSizeMode:De.nullable().optional(),isPasteAtCursorMode:De.nullable().optional()}),to={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},KT=Math.max(...Object.values(to));function Xne(t){t.version<to.AddAnimationSpeed&&(t.user.animationSpeed=1),t.version<to.AddIsSnapMode&&(t.user.isSnapMode=!1),t.version<to.MakeFieldsNullable,t.version<to.AddEdgeScrollSpeed&&(t.user.edgeScrollSpeed=1),t.version<to.AddExcalidrawSelectMode&&(t.user.isWrapMode=!1),t.version<to.AllowSystemColorScheme&&(t.user.isDarkMode===!0?t.user.colorScheme="dark":t.user.isDarkMode===!1&&(t.user.colorScheme="light"),delete t.user.isDarkMode),t.version<to.AddDynamicSizeMode&&(t.user.isDynamicSizeMode=!1),t.version<to.AddPasteAtCursor&&(t.user.isPasteAtCursorMode=!1),t.version=KT}const Z_=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function h5(){return Z_[Math.floor(Math.random()*Z_.length)]}function qne(){var t,e;return typeof window<"u"&&"matchMedia"in window?((e=(t=window.matchMedia)==null?void 0:t.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const eo=Object.freeze({name:"New User",locale:Cee(),color:h5(),edgeScrollSpeed:1,animationSpeed:qne()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"system"});function ew(){return{id:Rt(),color:h5()}}function p5(t){if(t===null||typeof t!="object"||!("version"in t)||!("user"in t)||typeof t.version!="number")return ew();const e=yt(t);Xne(e);try{return u5.validate(e.user)}catch{return ew()}}function Zne(){const t=JSON.parse(IT(d5)||"null")??null;return p5(t)}const Ux=dn("globalUserData",null);function Jne(){PT(d5,JSON.stringify({version:KT,user:Ux.get()}))}function f5(t){u5.validate(t),Ux.set(t),Jne(),Qne()}const fd=typeof BroadcastChannel<"u"?new BroadcastChannel("tldraw-user-sync"):null;fd==null||fd.addEventListener("message",t=>{const e=t.data;(e==null?void 0:e.type)===m5&&(e==null?void 0:e.origin)!==g5()&&Ux.set(p5(e.data))});let tw=null;function g5(){return tw===null&&(tw=Rt()),tw}const m5="tldraw-user-preferences-change";function Qne(){fd==null||fd.postMessage({type:m5,origin:g5(),data:{user:y5(),version:KT}})}function y5(){let t=Ux.get();return t||(t=Zne(),f5(t)),t}const ese=te("defaultLocalStorageUserPrefs",()=>y5());function v5(t={}){return{userPreferences:t.userPreferences??ese,setUserPreferences:t.setUserPreferences??f5}}var x5={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(n=!1));function i(c,d,u){this.fn=c,this.context=d,this.once=u||!1}function r(c,d,u,h,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,h||c,p),g=n?n+d:d;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],f]:c._events[g].push(f):(c._events[g]=f,c._eventsCount++),c}function o(c,d){--c._eventsCount===0?c._events=new s:delete c._events[d]}function l(){this._events=new s,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],u,h;if(this._eventsCount===0)return d;for(h in u=this._events)e.call(u,h)&&d.push(n?h.slice(1):h);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(u)):d},l.prototype.listeners=function(d){var u=n?n+d:d,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,f=h.length,g=new Array(f);p<f;p++)g[p]=h[p].fn;return g},l.prototype.listenerCount=function(d){var u=n?n+d:d,h=this._events[u];return h?h.fn?1:h.length:0},l.prototype.emit=function(d,u,h,p,f,g){var y=n?n+d:d;if(!this._events[y])return!1;var x=this._events[y],m=arguments.length,v,w;if(x.fn){switch(x.once&&this.removeListener(d,x.fn,void 0,!0),m){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,u),!0;case 3:return x.fn.call(x.context,u,h),!0;case 4:return x.fn.call(x.context,u,h,p),!0;case 5:return x.fn.call(x.context,u,h,p,f),!0;case 6:return x.fn.call(x.context,u,h,p,f,g),!0}for(w=1,v=new Array(m-1);w<m;w++)v[w-1]=arguments[w];x.fn.apply(x.context,v)}else{var _=x.length,C;for(w=0;w<_;w++)switch(x[w].once&&this.removeListener(d,x[w].fn,void 0,!0),m){case 1:x[w].fn.call(x[w].context);break;case 2:x[w].fn.call(x[w].context,u);break;case 3:x[w].fn.call(x[w].context,u,h);break;case 4:x[w].fn.call(x[w].context,u,h,p);break;default:if(!v)for(C=1,v=new Array(m-1);C<m;C++)v[C-1]=arguments[C];x[w].fn.apply(x[w].context,v)}}return!0},l.prototype.on=function(d,u,h){return r(this,d,u,h,!1)},l.prototype.once=function(d,u,h){return r(this,d,u,h,!0)},l.prototype.removeListener=function(d,u,h,p){var f=n?n+d:d;if(!this._events[f])return this;if(!u)return o(this,f),this;var g=this._events[f];if(g.fn)g.fn===u&&(!p||g.once)&&(!h||g.context===h)&&o(this,f);else{for(var y=0,x=[],m=g.length;y<m;y++)(g[y].fn!==u||p&&!g[y].once||h&&g[y].context!==h)&&x.push(g[y]);x.length?this._events[f]=x.length===1?x[0]:x:o(this,f)}return this},l.prototype.removeAllListeners=function(d){var u;return d?(u=n?n+d:d,this._events[u]&&o(this,u)):(this._events=new s,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,t.exports=l})(x5);var tse=x5.exports;const nse=qa(tse),gd="TLDRAW_TAB_ID_v2",Or=globalThis.window;function sse(){return Or?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Or.navigator.platform)||Or.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const uv=Or?Or[gd]??FL(gd)??"TLDRAW_INSTANCE_STATE_V1_"+Rt():"<error>";Or&&(Or[gd]=uv,sse()?kT(gd,uv):BL(gd));Or==null||Or.addEventListener("beforeunload",()=>{kT(gd,uv)});const S5={Initial:0},$x=Math.max(...Object.values(S5));function ise(t){t.version<S5.Initial,t.version=$x}const b5=Ue({version:Ce,currentPageId:Ep,isFocusMode:De,exportBackground:De,isDebugMode:De,isToolLocked:De,isGridMode:De,pageStates:Pn(Ue({pageId:Ep,camera:Ue({x:Ce,y:Ce,z:Ce}),selectedShapeIds:Pn(vi),focusedGroupId:vi.nullable()}))});function rse(t){if(!t||typeof t!="object")return console.warn("Invalid instance state"),null;if(!("version"in t)||typeof t.version!="number")return console.warn("No version in instance state"),null;t.version!==$x&&(t=yt(t),ise(t));try{return b5.validate(t)}catch(e){return console.warn(e),null}}function w5(t){const e=t.query.ids("page");return te("sessionStateSnapshot",()=>{const n=t.get(ls);if(!n)return null;const s=[...e.get()];return{version:$x,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:s.map(i=>{const r=t.get(Yi.createId(i)),o=t.get(Tr.createId(i));return{pageId:i,camera:{x:(o==null?void 0:o.x)??0,y:(o==null?void 0:o.y)??0,z:(o==null?void 0:o.z)??1},selectedShapeIds:(r==null?void 0:r.selectedShapeIds)??[],focusedGroupId:(r==null?void 0:r.focusedGroupId)??null}})}})}function _5(t,e){const n=rse(e);if(!n)return;const s=t.schema.types.instance.create({id:ls,...lF(t.get(ls)),currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground}),i=t.allRecords().filter(r=>r.typeName==="instance_page_state"||r.typeName==="camera");t.atomic(()=>{t.remove(i.map(r=>r.id));for(const r of n.pageStates)t.put([Tr.create({id:Tr.createId(r.pageId),x:r.camera.x,y:r.camera.y,z:r.camera.z}),Yi.create({id:Yi.createId(r.pageId),pageId:r.pageId,selectedShapeIds:r.selectedShapeIds,focusedGroupId:r.focusedGroupId})]);t.put([s]),t.ensureStoreIsUsable()})}function ose(t){var i;const e=[];for(const r of Object.values(t))(i=r.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&e.push(r);const n=e.filter(r=>r.typeName==="instance"&&r.id!==ls)[0];if(!n)return null;const s={version:$x,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:e.filter(r=>r.typeName==="instance_page_state"&&r.instanceId===n.id).map(r=>{const o=t[r.cameraId]??{x:0,y:0,z:1};return{pageId:r.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:r.selectedShapeIds,focusedGroupId:r.focusedGroupId}})};try{return b5.validate(s),s}catch{return null}}function C5(t,e){let n={};if("store"in e){const i=t.schema.migrateStoreSnapshot(e);if(i.type!=="success")throw new Error("Failed to migrate store snapshot: "+i.reason);n.document={schema:t.schema.serialize(),store:zh(i.value,(r,{typeName:o})=>t.scopedTypes.document.has(o))}}else n=e;const s=lF(t.get(ls));t.atomic(()=>{n.document&&t.loadStoreSnapshot(n.document),s&&t.update(ls,i=>({...i,...s})),n.session&&_5(t,n.session)})}const ase=new jo;function lse(t){const n=ase.get(t,w5).get();if(!n)throw new Error("Session state is not ready yet");return{document:t.getStoreSnapshot(),session:n}}function E5(t){const e=[],n=new Set;for(const s of t){if(n.has(s.type))throw new Error(`Binding type "${s.type}" is defined more than once`);e.push(s),n.add(s.type)}return e}function Ha({children:t,className:e="",...n}){return a.jsx("svg",{...n,className:Se("tl-svg-container",e),children:t})}function YT(t,e,n,s){const i=t.x-n.x,r=t.y-n.y,o=s.x-n.x,l=s.y-n.y,c=e.x-t.x,d=e.y-t.y,u=o*r-l*i,h=c*r-d*i,p=l*c-o*d;if(u===0||h===0||p===0)return null;if(p!==0){const f=u/p,g=h/p;if(0<=f&&f<=1&&0<=g&&g<=1)return E.AddXY(t,f*c,f*d)}return null}function vf(t,e,n,s){const i=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y),r=2*((e.x-t.x)*(t.x-n.x)+(e.y-t.y)*(t.y-n.y)),o=n.x*n.x+n.y*n.y+t.x*t.x+t.y*t.y-2*(n.x*t.x+n.y*t.y)-s*s,l=r*r-4*i*o;if(l<0||l===0)return null;const c=Math.sqrt(l),d=(-r+c)/(2*i),u=(-r-c)/(2*i);if((d<0||d>1)&&(u<0||u>1))return null;const h=[];return 0<=d&&d<=1&&h.push(E.Lrp(t,e,d)),0<=u&&u<=1&&h.push(E.Lrp(t,e,u)),h.length===0?null:h}function cse(t,e,n){const s=[];let i;for(let r=0,o=n.length-1;r<o;r++)i=YT(t,e,n[r],n[r+1]),i&&s.push(i);return s.length===0?null:s}function XT(t,e,n){const s=[];let i;for(let r=1,o=n.length;r<o+1;r++)i=YT(t,e,n[r-1],n[r%n.length]),i&&s.push(i);return s.length===0?null:s}function dse(t,e,n,s){let i=n.x-t.x,r=n.y-t.y;const o=Math.sqrt(i*i+r*r),l=(o*o-s*s+e*e)/(2*o),c=Math.sqrt(e*e-l*l);return i/=o,r/=o,[new E(t.x+i*l-r*c,t.y+r*l+i*c),new E(t.x+i*l+r*c,t.y+r*l-i*c)]}function J_(t,e,n){const s=[];let i,r,o;for(let l=0,c=n.length;l<c;l++)i=n[l],r=n[(l+1)%n.length],o=vf(i,r,t,e),o&&s.push(...o);return s.length===0?null:s}function EN(t,e,n){const s=[];let i,r,o;for(let l=1,c=n.length;l<c;l++)i=n[l-1],r=n[l],o=vf(i,r,t,e),o&&s.push(...o);return s.length===0?null:s}function jg(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function qT(t,e,n,s){return jg(t,n,s)!==jg(e,n,s)&&jg(t,e,n)!==jg(t,e,s)}function TN(t,e){const n=new Map;let s,i,r,o;for(let l=0,c=t.length;l<c;l++)if(s=t[l],si(s,e)){const d=nw(s);n.has(d)||n.set(d,s)}for(let l=0,c=e.length;l<c;l++)if(s=e[l],si(s,t)){const d=nw(s);n.has(d)||n.set(d,s)}for(let l=0,c=t.length;l<c;l++){s=t[l],i=t[(l+1)%t.length];for(let d=0,u=e.length;d<u;d++){r=e[d],o=e[(d+1)%e.length];const h=YT(s,i,r,o);if(h!==null){const p=nw(h);n.has(p)||n.set(p,h)}}}return n.size===0?null:use([...n.values()])}function nw(t){return`${t.x},${t.y}`}function use(t){const e=E.Average(t);return t.sort((n,s)=>E.Angle(e,n)-E.Angle(e,s))}function T5(t,e){let n,s,i,r;for(let o=0,l=t.length;o<l;o++){n=t[o],s=t[(o+1)%l];for(let c=0,d=e.length;c<d;c++)if(i=e[c],r=e[(c+1)%d],qT(n,s,i,r))return!0}return!1}function hse(t,e){let n,s,i,r;for(let o=0,l=t.length;o<l;o++){n=t[o],s=t[(o+1)%l];for(let c=1,d=e.length;c<d;c++)if(i=e[c-1],r=e[c],qT(n,s,i,r))return!0}return!1}class fo extends sl{constructor(n){super({...n,isClosed:!1,isFilled:!1});b(this,"start");b(this,"end");b(this,"d");b(this,"u");b(this,"ul");const{start:s,end:i}=n;this.start=s,this.end=i,this.d=s.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(n){const{start:s,end:i,u:r,ul:o}=this;if(o===0)return s;const l=E.Sub(n,s).dpr(r)/o,c=s.x+r.x*l;if(c<Math.min(s.x,i.x))return s.x<i.x?s:i;if(c>Math.max(s.x,i.x))return s.x>i.x?s:i;const d=s.y+r.y*l;return d<Math.min(s.y,i.y)?s.y<i.y?s:i:d>Math.max(s.y,i.y)?s.y>i.y?s:i:new E(c,d)}hitTestLineSegment(n,s,i=0){return qT(n,s,this.start,this.end)||this.distanceToLineSegment(n,s)<=i}getSvgPathData(n=!0){const{start:s,end:i}=this;return`${n?`M${s.toFixed()}`:""} L${i.toFixed()}`}}class ou extends sl{constructor(n){super({isClosed:!1,isFilled:!1,...n});b(this,"points");b(this,"_segments");const{points:s}=n;this.points=s}get segments(){if(!this._segments){this._segments=[];const{vertices:n}=this;for(let s=0,i=n.length-1;s<i;s++){const r=n[s],o=n[s+1];this._segments.push(new fo({start:r,end:o}))}this.isClosed&&this._segments.push(new fo({start:n[n.length-1],end:n[0]}))}return this._segments}getLength(){return this.segments.reduce((n,s)=>n+s.length,0)}getVertices(){return this.points}nearestPoint(n){const{segments:s}=this;let i=this.points[0],r=1/0,o,l;for(let c=0;c<s.length;c++)o=s[c].nearestPoint(n),l=E.Dist2(o,n),l<r&&(i=o,r=l);if(!i)throw Error("nearest point not found");return i}hitTestLineSegment(n,s,i=0){const{segments:r}=this;for(let o=0,l=r.length;o<l;o++)if(r[o].hitTestLineSegment(n,s,i))return!0;return!1}getSvgPathData(){const{vertices:n}=this;return n.length<2?"":n.reduce((s,i,r)=>r===0?`M ${i.x} ${i.y}`:`${s} L ${i.x} ${i.y}`,"")}}class Gt extends ou{constructor(e){super({...e}),this.isClosed=!0}}class Ao extends Gt{constructor(n){const{x:s=0,y:i=0,width:r,height:o}=n;super({...n,points:[new E(s,i),new E(s+r,i),new E(s+r,i+o),new E(s,i+o)]});b(this,"x");b(this,"y");b(this,"w");b(this,"h");this.x=s,this.y=i,this.w=r,this.h=o}getBounds(){return new de(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:n,y:s,w:i,h:r}=this;return`M${n},${s} h${i} v${r} h-${i}z`}}class Ji{constructor(e){b(this,"canSnap",()=>!0);b(this,"canScroll",()=>!1);b(this,"canEdit",()=>!1);b(this,"canResize",()=>!0);b(this,"canEditInReadOnly",()=>!1);b(this,"canCrop",()=>!1);b(this,"canBeLaidOut",()=>!0);b(this,"hideResizeHandles",()=>!1);b(this,"hideRotateHandle",()=>!1);b(this,"hideSelectionBoundsBg",()=>!1);b(this,"hideSelectionBoundsFg",()=>!1);b(this,"isAspectRatioLocked",()=>!1);b(this,"onBeforeCreate");b(this,"onBeforeUpdate");b(this,"onDragShapesOver");b(this,"onDragShapesOut");b(this,"onDropShapesOver");b(this,"onResizeStart");b(this,"onResize");b(this,"onResizeEnd");b(this,"onTranslateStart");b(this,"onTranslate");b(this,"onTranslateEnd");b(this,"onHandleDrag");b(this,"onRotateStart");b(this,"onRotate");b(this,"onRotateEnd");b(this,"onBindingChange");b(this,"onChildrenChange");b(this,"onDoubleClickHandle");b(this,"onDoubleClickEdge");b(this,"onDoubleClick");b(this,"onClick");b(this,"onEditEnd");this.editor=e}canBind(e){return!0}providesBackgroundForChildren(e){return!1}canReceiveNewChildrenOfType(e,n){return!1}canDropShapes(e,n){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}}b(Ji,"props"),b(Ji,"migrations"),b(Ji,"type");function pse(t,e,n={}){const{closed:s=!1,snap:i=1,start:r="outset",end:o="outset",lengthRatio:l=2,style:c="dashed"}=n;let d=0,u=0,h=1,p=0,f=0;switch(c){case"dashed":{h=1,d=Math.min(e*l,t/4);break}case"dotted":{h=100,d=e/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return s||(r==="outset"?(t+=d/2,f+=d/2):r==="skip"&&(t-=d,f-=d),o==="outset"?t+=d/2:o==="skip"&&(t-=d)),u=Math.floor(t/d/(2*h)),u-=u%i,u<3&&c==="dashed"?t/e<5?(d=t,u=1,p=0):(d=t*.333,p=t*.333):(u=Math.max(u,3),d=t/u/(2*h),s?(f=d/2,p=(t-u*d)/u):p=(t-u*d)/Math.max(1,u-1)),{strokeDasharray:[d,p].join(" "),strokeDashoffset:f.toString()}}function IN({bounds:t,className:e}){const n=K(),s=Z("zoom level",()=>n.getZoomLevel(),[n]);return a.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:t.sides.map((i,r)=>{const{strokeDasharray:o,strokeDashoffset:l}=pse(i[0].dist(i[1]),1/s,{style:"dashed",lengthRatio:4});return a.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:o,strokeDashoffset:l},r)})})}class Nm extends Ji{constructor(){super(...arguments);b(this,"hideSelectionBoundsFg",()=>!0);b(this,"canBind",()=>!1);b(this,"onChildrenChange",n=>{const s=this.editor.getSortedChildIdsForParent(n.id);if(s.length===0){this.editor.getCurrentPageState().focusedGroupId===n.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([n.id]);return}else if(s.length===1){this.editor.getCurrentPageState().focusedGroupId===n.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(s,n.parentId),this.editor.deleteShapes([n.id]);return}})}getDefaultProps(){return{}}getGeometry(n){const s=this.editor.getSortedChildIdsForParent(n.id);return s.length===0?new Ao({width:1,height:1,isFilled:!1}):new sr({children:s.map(i=>{const r=this.editor.getShape(i),o=this.editor.getShapeGeometry(i),l=this.editor.getShapeLocalTransform(r).applyToPoints(o.vertices);return o.isClosed?new Gt({points:l,isFilled:!0}):new ou({points:l})})})}component(n){const s=this.editor.getErasingShapeIds().includes(n.id),{hintingShapeIds:i}=this.editor.getCurrentPageState(),r=i.length>0&&i.some(c=>c!==n.id&&this.editor.isShapeOfType(this.editor.getShape(c),"group")),o=this.editor.getCurrentPageState().focusedGroupId!==n.id;if(!s&&(o||r))return null;const l=this.editor.getShapeGeometry(n).bounds;return a.jsx(Ha,{id:n.id,children:a.jsx(IN,{className:"tl-group",bounds:l})})}indicator(n){const s=this.editor.getShapeGeometry(n).bounds;return a.jsx(IN,{className:"",bounds:s})}}b(Nm,"type","group"),b(Nm,"props",SF),b(Nm,"migrations",bF);const I5=[Nm],fse=new Set(I5.map(t=>t.type));function P5(t){const e=[...I5],n=new Set;for(const s of t){if(fse.has(s.type))throw new Error(`Shape type "${s.type}" is a core shapes type and cannot be overridden`);if(n.has(s.type))throw new Error(`Shape type "${s.type}" is defined more than once`);e.push(s),n.add(s.type)}return e}const gse={maxShapesPerPage:4e3,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16};function PN(t,e){if(!e)return!1;switch(t.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&t.value===e.value;default:throw Zn(t)}}class mse{constructor(e){b(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const n=this.get(e);if(n&&n.type!=="mixed")return n.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const n=new Set;for(const[s,i]of this){if(!PN(i,e.get(s)))return!1;n.add(s)}for(const[s,i]of e)if(!n.has(s)&&!PN(i,this.get(s)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class Q_ extends mse{set(e,n){this.map.set(e,n)}applyValue(e,n){const s=this.get(e);if(!s){this.set(e,{type:"shared",value:n});return}switch(s.type){case"mixed":return;case"shared":s.value!==n&&this.set(e,{type:"mixed"});return;default:Zn(s,"type")}}}function yse(t,e,n){return Ur(t).then(function(s){return s.arrayBuffer()}).then(function(s){return new File([s],e,{type:n})})}const vse="https://cdn.tldraw.com";function xa(){return`${vse}/${OF}`}function xse(t,e){var i;let n=t;const s=new Set(e);for(;s.has(n);)n=(i=/^.*(\d+)$/.exec(n))!=null&&i[1]?n.replace(/(\d+)(?=\D?)$/,r=>(+r+1).toString()):`${n} 1`;return n}function Ng(t,e,n){if(n.length===0)return[];const s=new Map;for(const r of Re(n.map(o=>t.getShape(o)))){const{parentId:o}=r;s.has(o)||s.set(o,{children:Re(t.getSortedChildIdsForParent(o).map(l=>t.getShape(l))),moving:new Set}),s.get(o).moving.add(r)}const i=[];switch(e){case"toBack":{s.forEach(({moving:r,children:o})=>Sse(r,o,i));break}case"toFront":{s.forEach(({moving:r,children:o})=>bse(r,o,i));break}case"forward":{s.forEach(({moving:r,children:o})=>wse(r,o,i));break}case"backward":{s.forEach(({moving:r,children:o})=>_se(r,o,i));break}}return i}function Sse(t,e,n){const s=e.length;if(t.size===s)return;let i,r;for(let o=0;o<s;o++){const l=e[o];if(t.has(l))i=l.index,t.delete(l);else{r=l.index;break}}if(t.size!==0){const o=Rd(i,r,t.size);n.push(...Array.from(t.values()).sort(Xn).map((l,c)=>({...l,index:o[c]})))}}function bse(t,e,n){const s=e.length;if(t.size===s)return;let i,r;for(let o=s-1;o>-1;o--){const l=e[o];if(t.has(l))r=l.index,t.delete(l);else{i=l.index;break}}if(t.size!==0){const o=Rd(i,r,t.size);n.push(...Array.from(t.values()).sort(Xn).map((l,c)=>({...l,index:o[c]})))}}function wse(t,e,n){var r;const s=e.length;if(t.size===s)return;let i={name:"skipping"};for(let o=0;o<s;o++){const l=t.has(e[o]);switch(i.name){case"skipping":{if(!l)continue;i={name:"selecting",selectIndex:o};break}case"selecting":{if(l)continue;const{selectIndex:c}=i;Rd(e[o].index,(r=e[o+1])==null?void 0:r.index,o-c).forEach((d,u)=>n.push({...e[c+u],index:d})),i={name:"skipping"};break}}}}function _se(t,e,n){var r;const s=e.length;if(t.size===s)return;let i={name:"skipping"};for(let o=s-1;o>-1;o--){const l=t.has(e[o]);switch(i.name){case"skipping":{if(!l)continue;i={name:"selecting",selectIndex:o};break}case"selecting":{if(l)continue;Rd((r=e[o-1])==null?void 0:r.index,e[o].index,i.selectIndex-o).forEach((c,d)=>{n.push({...e[o+d+1],index:c})}),i={name:"skipping"};break}}}}function k5({editor:t}){const e=t.getSelectedShapes(),n=t.getSelectionRotation(),s=t.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:i}}=t;if(!s)return null;const r=s.center.clone().rotWith(s.point,n);return{selectionPageCenter:r,initialCursorAngle:r.angle(i),initialSelectionRotation:n,shapeSnapshots:e.map(o=>({shape:yt(o),initialPagePoint:t.getShapePageTransform(o.id).point()}))}}function Am({delta:t,editor:e,snapshot:n,stage:s}){const{selectionPageCenter:i,shapeSnapshots:r}=n;e.updateShapes(r.map(({shape:l,initialPagePoint:c})=>{const d=Ps(l.parentId)?e.getShapePageTransform(l.parentId):ve.Identity(),u=E.RotWith(c,i,t),h=ve.applyToPoint(ve.Inverse(d),u),p=Ma(l.rotation+t);return{id:l.id,type:l.type,x:h.x,y:h.y,rotation:p}}));const o=[];r.forEach(({shape:l})=>{var h,p,f;const c=e.getShape(l.id);if(!c)return;const d=e.getShapeUtil(l);if(s==="start"||s==="one-off"){const g=(h=d.onRotateStart)==null?void 0:h.call(d,l);g&&o.push(g)}const u=(p=d.onRotate)==null?void 0:p.call(d,l,c);if(u&&o.push(u),s==="end"||s==="one-off"){const g=(f=d.onRotateEnd)==null?void 0:f.call(d,l,c);g&&o.push(g)}}),o.length>0&&e.updateShapes(o)}const Cse=t=>{const{store:e}=t,n=e.query.filterHistory("binding"),s=e.query.records("binding");function i(){const r=s.get(),o=new Map;for(const l of r){const{fromId:c,toId:d}=l,u=o.get(c);u?u.push(l):o.set(c,[l]);const h=o.get(d);h?h.push(l):o.set(d,[l])}return o}return te("arrowBindingsIndex",(r,o)=>{if(Ol(r))return i();const l=r,c=n.getDiffSince(o);if(c===ti)return i();let d;function u(f){d??(d=new Map(l));const g=d.get(f.fromId),y=g==null?void 0:g.filter(v=>v.id!==f.id);y!=null&&y.length?d.set(f.fromId,y):d.delete(f.fromId);const x=d.get(f.toId),m=x==null?void 0:x.filter(v=>v.id!==f.id);m!=null&&m.length?d.set(f.toId,m):d.delete(f.toId)}function h(f){d??(d=new Map(l));let g=d.get(f);return g?g===l.get(f)&&(g=g.slice(0),d.set(f,g)):(g=[],d.set(f,g)),g}function p(f){h(f.fromId).push(f),h(f.toId).push(f)}for(const f of c){for(const g of Ut(f.added))p(g);for(const[g,y]of Ut(f.updated))u(g),p(y);for(const g of Ut(f.removed))u(g)}return d??l})};function Ese(t,e,n){const s=t.getShapeMaskedPageBounds(e);return s===void 0?!0:!n.includes(s)}const Tse=t=>{function e(n){const s=n.getCurrentPageShapeIds(),i=n.getViewportPageBounds(),r=new Set;return s.forEach(o=>{Ese(n,o,i)&&r.add(o)}),r}return te("getCulledShapes",n=>{if(Ol(n))return e(t);const s=e(t);if(n.size!==s.size)return s;for(const i of n)if(!s.has(i))return s;return n})},Ise=t=>{const e=t.query.ids("shape"),n=t.query.filterHistory("shape");function s(){const i={},r=e.get(),o=Array(r.size);return r.forEach(l=>o.push(t.get(l))),o.sort(Xn),o.forEach(l=>{i[l.parentId]||(i[l.parentId]=[]),i[l.parentId].push(l.id)}),i}return te("parentsToChildrenWithIndexes",(i,r)=>{if(Ol(i))return s();const o=n.getDiffSince(r);if(o===ti)return s();if(o.length===0)return i;let l=null;const c=h=>{l||(l={...i}),l[h]?l[h]===i[h]&&(l[h]=[...l[h]]):l[h]=[]},d=new Set;let u;for(let h=0,p=o.length;h<p;h++){u=o[h];for(const f of Object.values(u.added))Qc(f)&&(c(f.parentId),l[f.parentId].push(f.id),d.add(l[f.parentId]));for(const[f,g]of Object.values(u.updated))if(Qc(g)&&Qc(f)){if(f.parentId!==g.parentId)c(f.parentId),c(g.parentId),l[f.parentId].splice(l[f.parentId].indexOf(g.id),1),l[g.parentId].push(g.id),d.add(l[g.parentId]);else if(f.index!==g.index){c(g.parentId);const y=l[g.parentId].indexOf(g.id);l[g.parentId][y]=g.id,d.add(l[g.parentId])}}for(const f of Object.values(u.removed))Qc(f)&&(c(f.parentId),l[f.parentId].splice(l[f.parentId].indexOf(f.id),1))}for(const h of d){const p=Re(h.map(f=>t.get(f)));p.sort(Xn),h.splice(0,h.length,...p.map(f=>f.id))}return l??i})},sw=(t,e,n)=>{for(;!Ts(n.parentId);){const s=t.get(n.parentId);if(!s)return!1;n=s}return n.parentId===e},Pse=(t,e)=>{const n=t.query.ids("shape");let s=null;function i(){const r=e();return s=r,new Set([...n.get()].filter(o=>sw(t,r,t.get(o))))}return te("_shapeIdsInCurrentPage",(r,o)=>{if(Ol(r))return i();const l=e();if(l!==s)return i();const c=t.history.getDiffSince(o);if(c===ti)return i();const d=new Im(r);for(const h of c){for(const p of Object.values(h.added))Qc(p)&&sw(t,l,p)&&d.add(p.id);for(const[p,f]of Object.values(h.updated))Qc(f)&&(sw(t,l,f)?d.add(f.id):d.remove(f.id));for(const p of Object.keys(h.removed))Ps(p)&&d.remove(p)}const u=d.get();return u?uh(u.value,u.diff):r})},j5=S.createContext(null);function kse({context:t,editor:e,children:n}){return a.jsx(Lx.Provider,{value:e,children:a.jsx(j5.Provider,{value:t,children:n})})}function N5(){const t=S.useContext(j5);return t?{isDarkMode:t.isDarkMode}:null}async function jse(t,e,n={}){var C,I;const s=typeof e[0]=="string"?e:e.map(T=>T.id);if(s.length===0)return;if(!window.document)throw Error("No document");const{scale:i=1,background:r=!1,padding:o=t.options.defaultSvgPadding,preserveAspectRatio:l=!1}=n,c=n.darkMode??t.user.getIsDarkMode(),d=Wo({isDarkMode:c}),u=t.getShapeAndDescendantIds(s),h=t.getUnorderedRenderingShapes(!1).filter(({id:T})=>u.has(T));let p=null;if(n.bounds)p=n.bounds;else for(const{id:T}of h){const P=t.getShapeMaskedPageBounds(T);P&&(p?p.union(P):p=P.clone())}if(!p)return;const f=s.length===1&&t.isShapeOfType(t.getShape(s[0]),"frame")?s[0]:null;f||p.expandBy(o);const g=p.width*i,y=p.height*i;try{(I=(C=document.body).focus)==null||I.call(C)}catch{}const x=[],m=new Map,v={isDarkMode:c,addExportDef:T=>{if(m.has(T.key))return;const P=(async()=>{const k=await T.getElement();k&&x.push(a.jsx(S.Fragment,{children:k},x.length))})();m.set(T.key,P)}},w=(await Promise.all(h.map(async({id:T,opacity:P,index:k,backgroundIndex:N})=>{var M,D;if(T===f)return[];const O=t.getShape(T);if(t.isShapeOfType(O,"group"))return[];const R=t.getShapeUtil(O);let j=await((M=R.toSvg)==null?void 0:M.call(R,O,v)),A=await((D=R.toBackgroundSvg)==null?void 0:D.call(R,O,v));if(!j&&!A){const U=t.getShapePageBounds(O);j=a.jsx("rect",{width:U.w,height:U.h,fill:d.solid,stroke:d.grey.pattern,strokeWidth:1})}let B=t.getShapePageTransform(O).toCssString();"scale"in O.props&&O.props.scale!==1&&(B=`${B} scale(${O.props.scale}, ${O.props.scale})`),j&&(j=a.jsx("g",{transform:B,opacity:P,children:j},O.id)),A&&(A=a.jsx("g",{transform:B,opacity:P,children:A},`bg_${O.id}`));const L=t.getShapeMask(O.id);if(L){const U=`mask_${O.id.replace(":","_")}`;x.push(a.jsx("clipPath",{id:U,children:a.jsx("path",{d:`M${L.map(({x:z,y:H})=>`${z},${H}`).join("L")}Z`})},x.length)),j&&(j=a.jsx("g",{clipPath:`url(#${U})`,children:j},O.id)),A&&(A=a.jsx("g",{clipPath:`url(#${U})`,children:A},`bg_${O.id}`))}const $=[];return j&&$.push({zIndex:k,element:j}),A&&$.push({zIndex:N,element:A}),$}))).flat();return await Promise.all(m.values()),{jsx:a.jsx(kse,{editor:t,context:v,children:a.jsxs("svg",{preserveAspectRatio:l||void 0,direction:"ltr",width:g,height:y,viewBox:`${p.minX} ${p.minY} ${p.width} ${p.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:r?f?d.solid:d.background:"transparent"},children:[a.jsx("defs",{children:x}),w.sort((T,P)=>T.zIndex-P.zIndex).map(({element:T})=>T)]})}),width:g,height:y}}const Nse=40;class Ase{constructor(e){b(this,"_clickId","");b(this,"_clickTimeout");b(this,"_clickScreenPoint");b(this,"_previousScreenPoint");b(this,"_getClickTimeout",(e,n=Rt())=>{this._clickId=n,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===n){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)});b(this,"_clickState","idle");b(this,"lastPointerInfo",{});b(this,"handlePointerEvent",e=>{switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=E.From(e.point),this._previousScreenPoint&&E.Dist2(this._previousScreenPoint,this._clickScreenPoint)>Nse**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=E.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&E.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e});b(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});this.editor=e}get clickState(){return this._clickState}}class Rse{constructor(e){b(this,"_isEdgeScrolling",!1);b(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:n}=this,s=this.getEdgeScroll();if(s.x===0&&s.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>n.options.edgeScrollDelay){const i=n.options.edgeScrollEaseDuration>0?un.easeInCubic(Math.min(1,this._edgeScrollDuration/(n.options.edgeScrollDelay+n.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:s.x*i,y:s.y*i})}}getEdgeProximityFactors(e,n,s,i,r){const{editor:o}=this,l=o.options.edgeScrollDistance,c=s?o.options.coarsePointerWidth:0,d=e-c,u=e+c,h=i?0:l,p=r?n:n-l;return d<h?Math.min(1,(h-d)/l):u>p?-Math.min(1,(u-p)/l):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:n,y:s}}}=e,i=e.getViewportScreenBounds(),{isCoarsePointer:r,insets:[o,l,c,d]}=e.getInstanceState(),u=this.getEdgeProximityFactors(n,i.w,r,d,l),h=this.getEdgeProximityFactors(s,i.h,r,o,c);return{x:u,y:h}}moveCameraWhenCloseToEdge(e){const{editor:n}=this;if(!n.inputs.isDragging||n.inputs.isPanning||n.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const s=n.getViewportScreenBounds(),i=s.w<1e3?.612:1,r=s.h<1e3?.612:1,o=n.getZoomLevel(),l=n.user.getEdgeScrollSpeed()*n.options.edgeScrollSpeed,c=l*e.x*i/o,d=l*e.y*r/o,{x:u,y:h,z:p}=n.getCamera();n.setCamera(new E(u+c,h+d,p))}}class Mse{constructor(e){b(this,"isSafari");b(this,"isIos");b(this,"isChromeForIos");b(this,"isFirefox");b(this,"isAndroid");this.editor=e,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}class Ose{constructor(e,n){b(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(i,r)=>{i.isFocused!==r.isFocused&&(r.isFocused?this.focus():this.blur(),this.updateContainerClass())});const s=e.getInstanceState().isFocused;n!==s&&e.updateInstanceState({isFocused:!!n}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;(e=this.disposeSideEffectListener)==null||e.call(this)}}function Wu(t){return Lse}class Dse{constructor(){b(this,"length",0);b(this,"head",null);b(this,"tail",this)}push(e){return new ZT(e,this)}toArray(){return bo}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const Lse=new Dse;class ZT{constructor(e,n){b(this,"length");this.head=e,this.tail=n,this.length=n.length+1}push(e){return new ZT(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const n=e.head;return e=e.tail,{value:n,done:!1}}else return{value:void 0,done:!0}}}}}class Fse{constructor(e){b(this,"store");b(this,"dispose");b(this,"state","recording");b(this,"pendingDiff",new Use);b(this,"stacks",dn("HistoryManager.stacks",{undos:Wu(),redos:Wu()},{isEqual:(e,n)=>e.undos===n.undos&&e.redos===n.redos}));b(this,"annotateError");b(this,"_isInBatch",!1);b(this,"batch",(e,n)=>{const s=this.state;s!=="paused"&&(n!=null&&n.history)&&(this.state=Bse[n.history]);try{if(this._isInBatch)return Rr(e),this;this._isInBatch=!0;try{Rr(e)}catch(i){throw this.annotateError(i),i}finally{this._isInBatch=!1}return this}finally{this.state=s}});b(this,"_undo",({pushToRedoStack:e,toMark:n=void 0})=>{var i;const s=this.state;this.state="paused";try{let{undos:r,redos:o}=this.stacks.get();const l=this.pendingDiff.clear(),c=GL(l),d=z_(l);e&&!c&&(o=o.push({type:"diff",diff:l}));let u=!1;if(c)for(;((i=r.head)==null?void 0:i.type)==="stop";){const h=r.head;if(r=r.tail,e&&(o=o.push(h)),h.id===n){u=!0;break}}if(!u)e:for(;r.head;){const h=r.head;switch(r=r.tail,e&&(o=o.push(h)),h.type){case"diff":Wh(d,[z_(h.diff)]);break;case"stop":if(!n||h.id===n)break e;break;default:Zn(h)}}this.store.applyDiff(d,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:o})}finally{this.state=s}return this});b(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));b(this,"redo",()=>{var n;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:s,redos:i}=this.stacks.get();if(i.length===0)return this;for(;((n=i.head)==null?void 0:n.type)==="stop";)s=s.push(i.head),i=i.tail;const r=Xy();for(;i.head;){const o=i.head;if(s=s.push(o),i=i.tail,o.type==="diff")Wh(r,[o.diff]);else break}this.store.applyDiff(r,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:i})}finally{this.state=e}return this});b(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));b(this,"bailToMark",e=>(this._undo({pushToRedoStack:!1,toMark:e}),this));b(this,"squashToMark",e=>{var r;let n=this.stacks.get().undos;const s=[];for(;n.head&&!(n.head.type==="stop"&&n.head.id===e);)n.head.type==="diff"&&s.push(n.head.diff),n=n.tail;if(!n.head||((r=n.head)==null?void 0:r.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(s.length===0)return this;const i=Xy();return Wh(i,s.reverse()),this.stacks.update(({redos:o})=>({undos:n.push({type:"diff",diff:i}),redos:o})),this});b(this,"mark",(e=Rt())=>(Rr(()=>{this.flushPendingDiff(),this.stacks.update(({undos:n,redos:s})=>({undos:n.push({type:"stop",id:e}),redos:s}))}),e));this.store=e.store,this.annotateError=e.annotateError??wp,this.dispose=this.store.addHistoryInterceptor((n,s)=>{if(s==="user")switch(this.state){case"recording":this.pendingDiff.apply(n.changes),this.stacks.update(({undos:i})=>({undos:i,redos:Wu()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(n.changes);break;case"paused":break;default:Zn(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:n,redos:s})=>({undos:n.push({type:"diff",diff:e}),redos:s}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}clear(){this.stacks.set({undos:Wu(),redos:Wu()}),this.pendingDiff.clear()}debug(){const{undos:e,redos:n}=this.stacks.get();return{undos:e.toArray(),redos:n.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const Bse={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class Use{constructor(){b(this,"diff",Xy());b(this,"isEmptyAtom",dn("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=Xy(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){Wh(this.diff,[e]),this.isEmptyAtom.set(GL(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class $se{constructor(e){b(this,"scribbleItems",new Map);b(this,"state","paused");b(this,"addScribble",(e,n=Rt())=>{const s={id:n,scribble:{id:n,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(n,s),s});b(this,"stop",e=>{const n=this.scribbleItems.get(e);if(!n)throw Error(`Scribble with id ${e} not found`);return n.delayRemaining=Math.min(n.delayRemaining,200),n.scribble.state="stopping",n});b(this,"addPoint",(e,n,s)=>{const i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);const{prev:r}=i,o={x:n,y:s,z:.5};return(!r||E.Dist(r,o)>=1)&&(i.next=o),i});b(this,"tick",e=>{this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(n=>{if(n.scribble.state==="starting"){const{next:c,prev:d}=n;c&&c!==d&&(n.prev=c,n.scribble.points.push(c)),n.scribble.points.length>8&&(n.scribble.state="active");return}n.delayRemaining>0&&(n.delayRemaining=Math.max(0,n.delayRemaining-e)),n.timeoutMs+=e,n.timeoutMs>=16&&(n.timeoutMs=0);const{delayRemaining:s,timeoutMs:i,prev:r,next:o,scribble:l}=n;switch(l.state){case"active":{o&&o!==r?(n.prev=o,l.points.push(o),s===0&&l.points.length>8&&l.points.shift()):i===0&&(l.points.length>1?l.points.shift():n.delayRemaining=l.delay);break}case"stopping":{if(n.delayRemaining===0&&i===0){if(l.points.length===1){this.scribbleItems.delete(n.id);return}l.shrink&&(l.size=Math.max(1,l.size*(1-l.shrink))),l.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:n})=>({...n,points:[...n.points]})).slice(-5)})})});this.editor=e}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}}var zse=Object.defineProperty,Wse=Object.getOwnPropertyDescriptor,zx=(t,e,n,s)=>{for(var i=Wse(e,n),r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(e,n,i)||i);return i&&zse(e,n,i),i};const we=t=>Math.round(t*10**8)/10**8;function no(t,e,n,s,i){const r=t.filter(l=>(s==="forward"?l.startNode.id===e:l.endNode.id===e)&&we(l.length)===we(n)&&zi(l.breadthIntersection[0],l.breadthIntersection[1],i[0],i[1]));if(r.length===0)return[];const o=new Set;return r.forEach(l=>{const c=s==="forward"?l.endNode.id:l.startNode.id;if(!o.has(c)){o.add(c);const d=no(t,c,n,s,zi(l.breadthIntersection[0],l.breadthIntersection[1],i[0],i[1]));r.push(...d)}}),r}function Hse(t){t.sort((e,n)=>n.gaps.length-e.gaps.length);for(let e=t.length-1;e>0;e--){const n=t[e];for(let s=e-1;s>=0;s--){const i=t[s];if(i.direction===n.direction&&n.gaps.every(r=>i.gaps.some(o=>we(r.startEdge[0].x)===we(o.startEdge[0].x)&&we(r.startEdge[0].y)===we(o.startEdge[0].y)&&we(r.startEdge[1].x)===we(o.startEdge[1].x)&&we(r.startEdge[1].y)===we(o.startEdge[1].y))&&i.gaps.some(o=>we(r.endEdge[0].x)===we(o.endEdge[0].x)&&we(r.endEdge[0].y)===we(o.endEdge[0].y)&&we(r.endEdge[1].x)===we(o.endEdge[1].x)&&we(r.endEdge[1].y)===we(o.endEdge[1].y)))){t.splice(e,1);break}}}}class xf{constructor(e){b(this,"editor");this.manager=e,this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",n=>{const s=e.getShapePageTransform(n.id);if(!s)return;const r=e.getShapeUtil(n).getBoundsSnapGeometry(n).points??e.getShapeGeometry(n).bounds.cornersAndCenter;if(!(!s||!r))return r.map((o,l)=>{const{x:c,y:d}=ve.applyToPoint(s,o);return{x:c,y:d,id:`${n.id}:${l}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),n=this.manager.getSnappableShapes(),s=[];for(const i of n){const r=e.get(i);r&&s.push(...r)}return s}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:wi(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],n=[];let s,i;const r=this.getSnappableGapNodes().sort((l,c)=>l.pageBounds.minX-c.pageBounds.minX);for(let l=0;l<r.length;l++){s=r[l];for(let c=l+1;c<r.length;c++)i=r[c],s.pageBounds.maxX<i.pageBounds.minX&&zu(s.pageBounds.minY,s.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:s,endNode:i,startEdge:[new E(s.pageBounds.maxX,s.pageBounds.minY),new E(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new E(i.pageBounds.minX,i.pageBounds.minY),new E(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-s.pageBounds.maxX,breadthIntersection:zi(s.pageBounds.minY,s.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const o=r.sort((l,c)=>l.pageBounds.minY-c.pageBounds.minY);for(let l=0;l<o.length;l++){s=o[l];for(let c=l+1;c<o.length;c++)i=o[c],s.pageBounds.maxY<i.pageBounds.minY&&zu(s.pageBounds.minX,s.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&n.push({startNode:s,endNode:i,startEdge:[new E(s.pageBounds.minX,s.pageBounds.maxY),new E(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new E(i.pageBounds.minX,i.pageBounds.minY),new E(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-s.pageBounds.maxY,breadthIntersection:zi(s.pageBounds.minX,s.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:n}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:n,initialSelectionSnapPoints:s,dragDelta:i}){var x,m;const r=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),l=n.clone().translate(i),c=s.map(({x:v,y:w},_)=>({id:"selection:"+_,x:v+i.x,y:w+i.y})),d=o,u=[],h=[],p=new E(r,r);this.collectPointSnaps({minOffset:p,nearestSnapsX:u,nearestSnapsY:h,otherNodeSnapPoints:d,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:l,nearestSnapsX:u,nearestSnapsY:h,minOffset:p});const f=new E(e==="x"?0:((x=u[0])==null?void 0:x.nudge)??0,e==="y"?0:((m=h[0])==null?void 0:m.nudge)??0);p.x=0,p.y=0,u.length=0,h.length=0,c.forEach(v=>{v.x+=f.x,v.y+=f.y}),l.translate(f),this.collectPointSnaps({minOffset:p,nearestSnapsX:u,nearestSnapsY:h,otherNodeSnapPoints:d,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:l,nearestSnapsX:u,nearestSnapsY:h,minOffset:p});const g=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:h}),y=this.getGapSnapLines({selectionPageBounds:l,nearestSnapsX:u,nearestSnapsY:h});return this.manager.setIndicators([...y,...g]),{nudge:f}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:n,handle:s,isAspectRatioLocked:i,isResizingFromCenter:r}){var T,P;const o=this.manager.getSnapThreshold(),{box:l,scaleX:c,scaleY:d}=de.Resize(e,s,r?n.x*2:n.x,r?n.y*2:n.y,i);let u=s;c<0&&(u=Jte(u)),d<0&&(u=Zte(u)),r&&(l.center=e.center);const h=u==="top"||u==="bottom",p=u==="left"||u==="right",f=kN(u,l),g=this.getSnappablePoints(),y=[],x=[],m=new E(o,o);this.collectPointSnaps({minOffset:m,nearestSnapsX:y,nearestSnapsY:x,otherNodeSnapPoints:g,selectionSnapPoints:f});const v=new E(h?0:((T=y[0])==null?void 0:T.nudge)??0,p?0:((P=x[0])==null?void 0:P.nudge)??0);if(i&&Qte(u)&&v.len()!==0){const k=y.length&&x.length?Math.abs(v.x)<Math.abs(v.y)?"x":"y":y.length?"x":"y",N=e.aspectRatio;k==="x"?(x.length=0,v.y=v.x/N,(u==="bottom_left"||u==="top_right")&&(v.y=-v.y)):(y.length=0,v.x=v.y*N,(u==="bottom_left"||u==="top_right")&&(v.x=-v.x))}const w=E.Add(n,v),{box:_}=de.Resize(e,s,r?w.x*2:w.x,r?w.y*2:w.y,i);r&&(_.center=e.center);const C=kN("any",_);y.length=0,x.length=0,m.x=0,m.y=0,this.collectPointSnaps({minOffset:m,nearestSnapsX:y,nearestSnapsY:x,otherNodeSnapPoints:g,selectionSnapPoints:C});const I=this.getPointSnapLines({nearestSnapsX:y,nearestSnapsY:x});return this.manager.setIndicators([...I]),{nudge:v}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:n,minOffset:s,nearestSnapsX:i,nearestSnapsY:r}){for(const o of e)for(const l of n){const c=E.Sub(o,l),d=Math.abs(c.x),u=Math.abs(c.y);we(d)<=we(s.x)&&(we(d)<we(s.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:l},nudge:l.x-o.x}),s.x=d),we(u)<=we(s.y)&&(we(u)<we(s.y)&&(r.length=0),r.push({type:"points",points:{thisPoint:o,otherPoint:l},nudge:l.y-o.y}),s.y=u)}}collectGapSnaps({selectionPageBounds:e,minOffset:n,nearestSnapsX:s,nearestSnapsY:i}){const{horizontal:r,vertical:o}=this.getVisibleGaps();for(const l of r){if(!zu(l.breadthIntersection[0],l.breadthIntersection[1],e.minY,e.maxY))continue;const d=l.startEdge[0].x+l.length/2-e.center.x;if(l.length>e.width&&we(Math.abs(d))<=we(n.x)){we(Math.abs(d))<we(n.x)&&(s.length=0),n.x=Math.abs(d);const m={type:"gap_center",gap:l,nudge:d},v=s.find(({type:_})=>_==="gap_center"),w=v&&zi(l.breadthIntersection[0],l.breadthIntersection[1],v.gap.breadthIntersection[0],v.gap.breadthIntersection[1]);v&&v.gap.length>l.length&&w?s[s.indexOf(v)]=m:(!v||!w)&&s.push(m)}const h=l.startNode.pageBounds.minX-l.length,p=e.maxX,f=h-p;we(Math.abs(f))<=we(n.x)&&(we(Math.abs(f))<we(n.x)&&(s.length=0),n.x=Math.abs(f),s.push({type:"gap_duplicate",gap:l,protrusionDirection:"left",nudge:f}));const g=l.endNode.pageBounds.maxX+l.length,y=e.minX,x=g-y;we(Math.abs(x))<=we(n.x)&&(we(Math.abs(x))<we(n.x)&&(s.length=0),n.x=Math.abs(x),s.push({type:"gap_duplicate",gap:l,protrusionDirection:"right",nudge:x}))}for(const l of o){if(!zu(l.breadthIntersection[0],l.breadthIntersection[1],e.minX,e.maxX))continue;const d=l.startEdge[0].y+l.length/2-e.center.y;if(l.length>e.height&&we(Math.abs(d))<=we(n.y)){we(Math.abs(d))<we(n.y)&&(i.length=0),n.y=Math.abs(d);const m={type:"gap_center",gap:l,nudge:d},v=i.find(({type:_})=>_==="gap_center"),w=v&&zu(v.gap.breadthIntersection[0],v.gap.breadthIntersection[1],l.breadthIntersection[0],l.breadthIntersection[1]);v&&v.gap.length>l.length&&w?i[i.indexOf(v)]=m:(!v||!w)&&i.push(m);continue}const h=l.startNode.pageBounds.minY-l.length,p=e.maxY,f=h-p;we(Math.abs(f))<=we(n.y)&&(we(Math.abs(f))<we(n.y)&&(i.length=0),n.y=Math.abs(f),i.push({type:"gap_duplicate",gap:l,protrusionDirection:"top",nudge:f}));const g=l.endNode.pageBounds.maxY+l.length,y=e.minY,x=g-y;we(Math.abs(x))<=we(n.y)&&(we(Math.abs(x))<we(n.y)&&(i.length=0),n.y=Math.abs(x),i.push({type:"gap_duplicate",gap:l,protrusionDirection:"bottom",nudge:x}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:n}){const s={},i={};if(e.length>0){for(const r of e)if(r.type==="points"){const o=we(r.points.otherPoint.x);s[o]||(s[o]=[]),s[o].push(r.points)}}if(n.length>0){for(const r of n)if(r.type==="points"){const o=we(r.points.otherPoint.y);i[o]||(i[o]=[]),i[o].push(r.points)}}return Object.values(s).concat(Object.values(i)).map(r=>({id:Rt(),type:"points",points:CT(r.map(o=>E.From(o.otherPoint)).concat(r.map(o=>E.From(o.thisPoint))),(o,l)=>o.equals(l))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:n,nearestSnapsY:s}){const{vertical:i,horizontal:r}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},l=[];if(n.length>0)for(const c of n){if(c.type==="points")continue;const{gap:{breadthIntersection:d,startEdge:u,startNode:h,endNode:p,length:f,endEdge:g}}=c;switch(c.type){case"gap_center":{const y=(f-e.width)/2,x=zi(d[0],d[1],e.minY,e.maxY);l.push({type:"gaps",direction:"horizontal",id:Rt(),gaps:[...no(r,h.id,y,"backward",x),{startEdge:u,endEdge:o.left},{startEdge:o.right,endEdge:g},...no(r,p.id,y,"forward",x)]});break}case"gap_duplicate":{const y=zi(d[0],d[1],e.minY,e.maxY);l.push({type:"gaps",direction:"horizontal",id:Rt(),gaps:c.protrusionDirection==="left"?[{startEdge:o.right,endEdge:u.map(x=>x.clone().addXY(-h.pageBounds.width,0))},{startEdge:u,endEdge:g},...no(r,p.id,f,"forward",y)]:[...no(r,h.id,f,"backward",y),{startEdge:u,endEdge:g},{startEdge:g.map(x=>x.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:o.left}]});break}}}if(s.length>0)for(const c of s){if(c.type==="points")continue;const{gap:{breadthIntersection:d,startEdge:u,startNode:h,endNode:p,length:f,endEdge:g}}=c;switch(c.type){case"gap_center":{const y=(f-e.height)/2,x=zi(d[0],d[1],e.minX,e.maxX);l.push({type:"gaps",direction:"vertical",id:Rt(),gaps:[...no(i,h.id,y,"backward",x),{startEdge:u,endEdge:o.top},{startEdge:o.bottom,endEdge:g},...no(i,c.gap.endNode.id,y,"forward",x)]});break}case"gap_duplicate":{const y=zi(d[0],d[1],e.minX,e.maxX);l.push({type:"gaps",direction:"vertical",id:Rt(),gaps:c.protrusionDirection==="top"?[{startEdge:o.bottom,endEdge:u.map(x=>x.clone().addXY(0,-h.pageBounds.height))},{startEdge:u,endEdge:g},...no(i,p.id,f,"forward",y)]:[...no(i,h.id,f,"backward",y),{startEdge:u,endEdge:g},{startEdge:g.map(x=>x.clone().addXY(0,p.pageBounds.height)),endEdge:o.top}]})}break}}return Hse(l),l}}zx([te],xf.prototype,"getSnapPointsCache");zx([te],xf.prototype,"getSnappablePoints");zx([te],xf.prototype,"getSnappableGapNodes");zx([te],xf.prototype,"getVisibleGaps");function kN(t,e){const{minX:n,maxX:s,minY:i,maxY:r}=e,o=[];switch(t){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(t){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:s,y:i})}switch(t){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:s,y:r})}switch(t){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:n,y:r})}return o}var Gse=Object.defineProperty,Vse=Object.getOwnPropertyDescriptor,Kse=(t,e,n,s)=>{for(var i=Vse(e,n),r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(e,n,i)||i);return i&&Gse(e,n,i),i};const Yse=()=>null,Xse=()=>[];class A5{constructor(e){b(this,"editor");this.manager=e,this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",n=>{const s=e.getShapeUtil(n).getHandleSnapGeometry(n);return{outline:s.outline===void 0?e.getShapeGeometry(n):s.outline,points:s.points??[],getSelfSnapOutline:s.getSelfSnapOutline??Yse,getSelfSnapPoints:s.getSelfSnapPoints??Xse}})}*iterateSnapPointsInPageSpace(e,n){var i,r;const s=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapPoints(n);if(s&&s.length){const o=wi(this.editor.getShapePageTransform(e));for(const l of s)yield o.applyToPoint(l)}for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const l=(r=this.getSnapGeometryCache().get(o))==null?void 0:r.points;if(!l||!l.length)continue;const c=wi(this.editor.getShapePageTransform(o));for(const d of l)yield c.applyToPoint(d)}}*iterateSnapOutlines(e,n){var i,r;const s=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapOutline(n);s&&(yield{shapeId:e,outline:s});for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const l=(r=this.getSnapGeometryCache().get(o))==null?void 0:r.outline;l&&(yield{shapeId:o,outline:l})}}getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:s}){const i=this.manager.getSnapThreshold();let r=i,o=null;for(const d of this.iterateSnapPointsInPageSpace(e,n))E.DistMin(s,d,r)&&(r=E.Dist(s,d),o=d);if(o)return o;let l=i,c=null;for(const{shapeId:d,outline:u}of this.iterateSnapOutlines(e,n)){const h=wi(this.editor.getShapePageTransform(d)),p=this.editor.getPointInShapeSpace(d,s),f=u.nearestPoint(p),g=h.applyToPoint(f);E.DistMin(s,g,l)&&(l=E.Dist(s,g),c=g)}return c||null}snapHandle({currentShapeId:e,handle:n}){const i=wi(this.editor.getShapePageTransform(e)).applyToPoint(n),r=this.getHandleSnapPosition({currentShapeId:e,handle:n,handleInPageSpace:i});return r?(this.manager.setIndicators([{id:Rt(),type:"points",points:[r]}]),{nudge:E.Sub(r,i)}):null}}Kse([te],A5.prototype,"getSnapGeometryCache");var qse=Object.defineProperty,Zse=Object.getOwnPropertyDescriptor,JT=(t,e,n,s)=>{for(var i=Zse(e,n),r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(e,n,i)||i);return i&&qse(e,n,i),i};class Wx{constructor(e){b(this,"shapeBounds");b(this,"handles");b(this,"_snapIndicators",dn("snapLines",void 0));this.editor=e,this.shapeBounds=new xf(this),this.handles=new A5(this)}getIndicators(){return this._snapIndicators.get()??bo}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,n=e.getViewportPageBounds(),s=e.getSelectedShapeIds(),i=new Set,r=o=>{if(Ps(o)){const c=e.getShape(o);c&&e.isShapeOfType(c,"frame")&&i.add(o)}const l=e.getSortedChildIdsForParent(o);for(const c of l){if(s.includes(c))continue;const d=e.getShape(c);if(!d||!e.getShapeUtil(d).canSnap(d))continue;const h=e.getShapePageBounds(c);if(h&&n.includes(h)){if(e.isShapeOfType(d,"group")){r(c);continue}i.add(c)}}};return r(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}JT([te],Wx.prototype,"getSnapThreshold");JT([te],Wx.prototype,"getSnappableShapes");JT([te],Wx.prototype,"getCurrentCommonAncestor");const Jse=/\r?\n|\r/g;function jN(t){return t.replace(Jse,`
`).split(`
`).map(e=>e||" ").join(`
`)}const Qse={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},eie=/\s/;class tie{constructor(e){b(this,"baseElm");b(this,"measureText",(e,n)=>{var o;const s=(o=this.baseElm)==null?void 0:o.cloneNode();this.baseElm.insertAdjacentElement("afterend",s),s.setAttribute("dir","auto"),s.style.setProperty("unicode-bidi","plaintext"),s.style.setProperty("font-family",n.fontFamily),s.style.setProperty("font-style",n.fontStyle),s.style.setProperty("font-weight",n.fontWeight),s.style.setProperty("font-size",n.fontSize+"px"),s.style.setProperty("line-height",n.lineHeight*n.fontSize+"px"),s.style.setProperty("max-width",n.maxWidth===null?null:n.maxWidth+"px"),s.style.setProperty("min-width",n.minWidth===null?null:n.minWidth+"px"),s.style.setProperty("padding",n.padding),s.style.setProperty("overflow-wrap",n.disableOverflowWrapBreaking?"normal":"break-word"),s.textContent=jN(e);const i=s.scrollWidth,r=s.getBoundingClientRect();return s.remove(),{x:0,y:0,w:r.width,h:r.height,scrollWidth:i}});this.editor=e;const n=this.editor.getContainer(),s=document.createElement("div");s.classList.add("tl-text"),s.classList.add("tl-text-measure"),s.tabIndex=-1,n.appendChild(s),this.baseElm=s,e.disposables.add(()=>{s.remove()})}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:n=!1}={}){const s=[],i=e.getBoundingClientRect(),r=-i.left,o=-i.top,l=new Range,c=e.childNodes[0];let d=0,u=null,h=null,p=0,f=0,g=!1;for(const y of e.childNodes)if(y.nodeType===Node.TEXT_NODE)for(const x of y.textContent??""){l.setStart(c,d),l.setEnd(c,d+x.length);const m=l.getClientRects(),v=m[m.length-1],w=v.top+o,_=v.left+r,C=v.right+r,I=_<f,T=eie.test(x);if(T!==h||w!==p||!u){if(u){if(n&&w!==p){g=!0;break}s.push(u)}u={box:{x:_,y:w,w:v.width,h:v.height},text:x},f=_}else I&&(u.box.x=_),u.box.w=I?u.box.w+v.width:C-u.box.x,u.text+=x;x===`
`&&(f=0),h=T,p=w,d+=x.length}return u&&s.push(u),{spans:s,didTruncate:g}}measureTextSpans(e,n){var d;if(e==="")return[];const s=(d=this.baseElm)==null?void 0:d.cloneNode();this.baseElm.insertAdjacentElement("afterend",s);const i=Math.ceil(n.width-n.padding*2);s.setAttribute("dir","auto"),s.style.setProperty("unicode-bidi","plaintext"),s.style.setProperty("width",`${i}px`),s.style.setProperty("height","min-content"),s.style.setProperty("font-size",`${n.fontSize}px`),s.style.setProperty("font-family",n.fontFamily),s.style.setProperty("font-weight",n.fontWeight),s.style.setProperty("line-height",`${n.lineHeight*n.fontSize}px`),s.style.setProperty("text-align",Qse[n.textAlign]);const r=n.overflow==="truncate-ellipsis"||n.overflow==="truncate-clip";r&&(s.style.setProperty("overflow-wrap","anywhere"),s.style.setProperty("word-break","break-all"));const o=jN(e);s.textContent=o;const{spans:l,didTruncate:c}=this.measureElementTextNodeSpans(s,{shouldTruncateToFirstLine:r});if(n.overflow==="truncate-ellipsis"&&c){s.textContent="";const u=Math.ceil(this.measureElementTextNodeSpans(s).spans[0].box.w);s.style.setProperty("width",`${i-u}px`),s.textContent=o;const h=this.measureElementTextNodeSpans(s,{shouldTruncateToFirstLine:!0}).spans,p=h[h.length-1];return h.push({text:"",box:{x:Math.min(p.box.x+p.box.w,n.width-n.padding-u),y:p.box.y,w:u,h:p.box.h}}),h}return s.remove(),l}}const NN=$L;class nie{constructor(e){b(this,"cancelRaf");b(this,"isPaused",!0);b(this,"now",0);b(this,"start",()=>{var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=NN(this.tick),this.now=Date.now()});b(this,"tick",()=>{if(this.isPaused)return;const e=Date.now(),n=e-this.now;this.now=e,this.updatePointerVelocity(n),this.editor.emit("frame",n),this.editor.emit("tick",n),this.cancelRaf=NN(this.tick)});b(this,"dispose",()=>{var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)});b(this,"prevPoint",new E);b(this,"updatePointerVelocity",e=>{const{prevPoint:n,editor:{inputs:{currentScreenPoint:s,pointerVelocity:i}}}=this;if(e===0)return;const r=E.Sub(s,n);this.prevPoint=s.clone();const o=r.len(),l=o?r.div(o):new E(0,0),c=i.clone().lrp(l.mul(o/e),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),i.equals(c)||(this.editor.inputs.pointerVelocity=c)});this.editor=e,this.editor.disposables.add(this.dispose),this.start()}}var sie=Object.defineProperty,iie=Object.getOwnPropertyDescriptor,Di=(t,e,n,s)=>{for(var i=iie(e,n),r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(e,n,i)||i);return i&&sie(e,n,i),i};class ui{constructor(e,n){b(this,"systemColorScheme",dn("systemColorScheme","light"));b(this,"updateUserPreferences",e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})});if(this.user=e,this.inferDarkMode=n,typeof window>"u"||!("matchMedia"in window))return;const s=window.matchMedia("(prefers-color-scheme: dark)");s!=null&&s.matches&&this.systemColorScheme.set("dark"),s==null||s.addEventListener("change",i=>{i.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??eo.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??eo.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??eo.name}getLocale(){return this.user.userPreferences.get().locale??eo.locale}getColor(){return this.user.userPreferences.get().color??eo.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??eo.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??eo.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??eo.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??eo.isPasteAtCursorMode}}Di([te],ui.prototype,"getUserPreferences");Di([te],ui.prototype,"getIsDarkMode");Di([te],ui.prototype,"getEdgeScrollSpeed");Di([te],ui.prototype,"getAnimationSpeed");Di([te],ui.prototype,"getId");Di([te],ui.prototype,"getName");Di([te],ui.prototype,"getLocale");Di([te],ui.prototype,"getColor");Di([te],ui.prototype,"getIsSnapMode");Di([te],ui.prototype,"getIsWrapMode");Di([te],ui.prototype,"getIsDynamicResizeMode");Di([te],ui.prototype,"getIsPasteAtCursorMode");const rie={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},oie=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class ye{constructor(e,n){b(this,"performanceTracker");b(this,"id");b(this,"type");b(this,"shapeType");b(this,"initial");b(this,"children");b(this,"isLockable");b(this,"parent");b(this,"_path");b(this,"_current");b(this,"_isActive");b(this,"transition",(e,n={})=>{var r;const s=e.split(".");let i=this;for(let o=0;o<s.length;o++){const l=s[o],c=i.getCurrent(),d=(r=i.children)==null?void 0:r[l];if(!d)throw Error(`${i.id} - no child state exists with the id ${l}.`);if((c==null?void 0:c.id)!==d.id&&(c==null||c.exit(n,l),i._current.set(d),d.enter(n,(c==null?void 0:c.id)||"initial"),!d.getIsActive()))break;i=d}return this});b(this,"handleEvent",e=>{var i;const n=rie[e.name],s=this._current.__unsafe__getWithoutCapture();(i=this[n])==null||i.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&s&&s===this._current.__unsafe__getWithoutCapture()&&s.handleEvent(e)});b(this,"enter",(e,n)=>{var s;if(Kt.measurePerformance.get()&&oie.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(s=this.onEnter)==null||s.call(this,e,n),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,n)}});b(this,"exit",(e,n)=>{var s,i;Kt.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(s=this.onExit)==null||s.call(this,e,n),this.getIsActive()||(i=this.getCurrent())==null||i.exit(e,n)});b(this,"_currentToolIdMask",dn("curent tool id mask",void 0));b(this,"onWheel");b(this,"onPointerDown");b(this,"onPointerMove");b(this,"onLongPress");b(this,"onPointerUp");b(this,"onDoubleClick");b(this,"onTripleClick");b(this,"onQuadrupleClick");b(this,"onRightClick");b(this,"onMiddleClick");b(this,"onKeyDown");b(this,"onKeyUp");b(this,"onKeyRepeat");b(this,"onCancel");b(this,"onComplete");b(this,"onInterrupt");b(this,"onTick");b(this,"onEnter");b(this,"onExit");this.editor=e;const{id:s,children:i,initial:r,isLockable:o}=this.constructor;this.id=s,this._isActive=dn("toolIsActive"+this.id,!1),this._current=dn("toolState"+this.id,void 0),this._path=te("toolPath"+this.id,()=>{const l=this.getCurrent();return this.id+(l?`.${l.getPath()}`:"")}),this.parent=n??{},this.parent?i&&r?(this.type="branch",this.initial=r,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&r&&(this.initial=r,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=o,this.performanceTracker=new CL}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}b(ye,"id"),b(ye,"initial"),b(ye,"children"),b(ye,"isLockable",!0);class Rm extends ye{constructor(){super(...arguments);b(this,"onKeyDown",n=>{var s;switch(n.code){case"KeyZ":{if(!(n.shiftKey||n.ctrlKey)){const i=this.getCurrent();i&&((s=i.getCurrent())==null?void 0:s.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...n,onInteractionEnd:i.id})}break}}})}}b(Rm,"id","root"),b(Rm,"initial",""),b(Rm,"children",()=>[]);var aie=Object.defineProperty,lie=Object.getOwnPropertyDescriptor,ge=(t,e,n,s)=>{for(var i=lie(e,n),r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(e,n,i)||i);return i&&aie(e,n,i),i};class le extends nse{constructor({store:n,user:s,shapeUtils:i,bindingUtils:r,tools:o,getContainer:l,cameraOptions:c,initialState:d,autoFocus:u,inferDarkMode:h,options:p}){super();b(this,"options");b(this,"store");b(this,"root");b(this,"disposables",new Set);b(this,"isDisposed",!1);b(this,"_tickManager");b(this,"snaps");b(this,"timers");b(this,"user");b(this,"textMeasure");b(this,"environment");b(this,"scribbles");b(this,"sideEffects");b(this,"edgeScrollManager");b(this,"focusManager");b(this,"getContainer");b(this,"shapeUtils");b(this,"styleProps");b(this,"bindingUtils");b(this,"history");b(this,"_shouldIgnoreShapeLock",!1);b(this,"_crashingError",null);b(this,"_updateInstanceState",(n,s)=>{this.run(()=>{this.store.put([{...this.getInstanceState(),...n}])},s)});b(this,"_isChangingStyleTimeout",-1);b(this,"setCursor",n=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...n}}),this));b(this,"_updateCurrentPageState",n=>{this.store.update(n.id??this.getCurrentPageState().id,s=>({...s,...n}))});b(this,"_cameraOptions",dn("camera options",rN));b(this,"_viewportAnimation",null);b(this,"_willSetInitialBounds",!0);b(this,"_isLockedOnFollowingUser",dn("isLockedOnFollowingUser",!1));b(this,"_cameraState",dn("camera state","idle"));b(this,"_cameraStateTimeoutRemaining",0);b(this,"_decayCameraStateTimeout",n=>{this._cameraStateTimeoutRemaining-=n,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))});b(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))});b(this,"_currentPageShapeIds");b(this,"_parentIdsToChildIds");b(this,"animatingShapes",new Map);b(this,"_updateShapes",n=>{this.getInstanceState().isReadonly||this.run(()=>{var o,l;const s=[];let i,r;for(let c=0,d=n.length;c<d;c++){const u=n[c];u&&(i=this.getShape(u.id),i&&(r=fr(i,u),r!==i&&(r=((l=(o=this.getShapeUtil(i)).onBeforeUpdate)==null?void 0:l.call(o,i,r))??r,s.push(r))))}this.store.put(s)})});b(this,"externalAssetContentHandlers",{file:null,url:null});b(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});b(this,"inputs",{originPagePoint:new E,originScreenPoint:new E,previousPagePoint:new E,previousScreenPoint:new E,currentPagePoint:new E,currentScreenPoint:new E,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new E});b(this,"_clickManager",new Ase(this));b(this,"_prevCursor","default");b(this,"_shiftKeyTimeout",-1);b(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});b(this,"_altKeyTimeout",-1);b(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});b(this,"_ctrlKeyTimeout",-1);b(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});b(this,"_restoreToolId","select");b(this,"_pinchStart",1);b(this,"_didPinch",!1);b(this,"_selectedShapeIdsAtPointerDown",[]);b(this,"_longPressTimeout",-1);b(this,"capturedPointerId",null);b(this,"performanceTracker");b(this,"performanceTrackerTimeout",-1);b(this,"dispatch",n=>(this._pendingEventsForNextTick.push(n),n.type==="pointer"&&n.name==="pointer_move"||n.type==="wheel"||n.type==="pinch"||this._flushEventsForTick(0),this));b(this,"_pendingEventsForNextTick",[]);b(this,"_flushEventForTick",n=>{if(this.getCrashingError())return this;const{inputs:s}=this,{type:i}=n;if(n.type==="misc"){(n.name==="cancel"||n.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(n);return}n.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,s.shiftKey=!0):!n.shiftKey&&s.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),n.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,s.altKey=!0):!n.altKey&&s.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),n.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,s.ctrlKey=!0):!n.ctrlKey&&s.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:r,currentPagePoint:o}=s;s.isPointing||(s.isDragging=!1);const l=this.store.unsafeGetWithoutCapture(ls),c=this.store.get(this._getCurrentPageStateId()),d=this._cameraOptions.__unsafe__getWithoutCapture();switch(i){case"pinch":{if(d.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(n),n.name){case"pinch_start":{if(s.isPinching)return;s.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...c.selectedShapeIds]),this._didPinch=!0,s.isPinching=!0,this.interrupt());return}case"pinch":{if(!s.isPinching)return;const{point:{z:u=1},delta:{x:h,y:p}}=n,{x:f,y:g}=E.SubXY(n.point,l.screenBounds.x,l.screenBounds.y);this.stopCameraAnimation(),l.followingUserId&&this.stopFollowingUser();const{x:y,y:x,z:m}=bg(()=>this.getCamera()),{panSpeed:v,zoomSpeed:w}=d;this._setCamera(new E(y+h*v/m-f/m+f/(u*w),x+p*v/m-g/m+g/(u*w),u*w),{immediate:!0});return}case"pinch_end":{if(!s.isPinching)return this;s.isPinching=!1;const{_selectedShapeIdsAtPointerDown:u}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,u.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(u)}));return}}}case"wheel":{if(d.isLocked)return;if(this._updateInputsFromEvent(n),!this.getIsMenuOpen()){const{panSpeed:u,zoomSpeed:h,wheelBehavior:p}=d;if(p!=="none"){this.stopCameraAnimation(),l.followingUserId&&this.stopFollowingUser();const{x:f,y:g,z:y}=bg(()=>this.getCamera()),{x,y:m,z:v=0}=n.delta;let w=p;switch(s.ctrlKey&&(w=p==="pan"?"zoom":"pan"),w){case"zoom":{const{x:_,y:C}=this.inputs.currentScreenPoint;let I=v;p==="zoom"&&(Math.abs(m)>10?I=10*Math.sign(m)/100:I=m/100);const T=y+(I??0)*h*y;this._setCamera(new E(f+(_/T-_)-(_/y-_),g+(C/T-C)-(C/y-C),T),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new E(f+x*u/y,g+m*u/y,y),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}}break}case"pointer":{if(s.isPinching)return;this._updateInputsFromEvent(n);const{isPen:u}=n,{isPenMode:h}=l;switch(n.name){case"pointer_down":{if(h&&!u)return;if(this.clearOpenMenus(),this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{this.dispatch({...n,point:this.inputs.currentScreenPoint,name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),n.button===aN&&(this.capturedPointerId=n.pointerId),s.buttons.add(n.button),s.isPointing=!0,s.isDragging=!1,!h&&u&&this.updateInstanceState({isPenMode:!0}),n.button===lN?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):n.button===Pg&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!u&&h)return;const{x:p,y:f,z:g}=bg(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:y,previousScreenPoint:x}=this.inputs,{panSpeed:m}=d,v=E.Sub(y,x);this.setCamera(new E(p+v.x*m/g,f+v.y*m/g,g),{immediate:!0}),this.maybeTrackPerformance("Panning");return}s.isPointing&&!s.isDragging&&E.Dist2(r,o)*this.getZoomLevel()>(l.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/g&&(s.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(s.isDragging=!1,s.isPointing=!1,clearTimeout(this._longPressTimeout),s.buttons.delete(n.button),this.getIsMenuOpen()||l.isPenMode&&!u)return;if(this.capturedPointerId===n.pointerId&&(this.capturedPointerId=null,n.button=0),s.isPanning){s.keys.has("Space")||(s.isPanning=!1);const p=this.inputs.pointerVelocity,f=Math.min(2,p.len());switch(n.button){case aN:{this.setCursor({type:"grab",rotation:0});break}case Pg:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}f>0&&this.slideCamera({speed:f,direction:p})}else n.button===lN&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(n.key==="ShiftRight"&&(n.key="ShiftLeft"),n.key==="AltRight"&&(n.key="AltLeft"),n.code==="ControlRight"&&(n.code="ControlLeft"),n.name){case"key_down":{s.keys.add(n.code),n.code==="Space"&&!n.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=l.cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0}));break}case"key_up":{s.keys.delete(n.code),n.code==="Space"&&(this.inputs.buttons.has(Pg)||(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(n.type==="pointer"){n.button===Pg?n.name="middle_click":n.button===zT&&(n.name="right_click");const{isPenMode:u}=this.store.unsafeGetWithoutCapture(ls);if(n.isPen===u){const h=this._clickManager.handlePointerEvent(n);if(n.name!==h.name){this.root.handleEvent(n),this.emit("event",n),this.root.handleEvent(h),this.emit("event",h);return}}}return this.root.handleEvent(n),this.emit("event",n),this});this.options={...gse,...p},this.store=n,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new Fse({store:n,annotateError:k=>{this.annotateError(k,{origin:"history.batch",willCrashApp:!0}),this.crash(k)}}),this.snaps=new Wx(this),this.timers=new qJ,this.disposables.add(this.timers.dispose.bind(this.timers)),this._cameraOptions.set({...rN,...c}),this.user=new ui(s??v5(),h??!1),this.getContainer=l??(()=>document.body),this.textMeasure=new tie(this),this._tickManager=new nie(this);class f extends Rm{}b(f,"initial",d??""),this.root=new f(this),this.root.children={};const g=P5(i),y={},x={},m=new Map;for(const k of g){const N=new k(this);y[k.type]=N;const O=qL(k.props??{});x[k.type]=O;for(const R of O.keys())if(!m.has(R.id))m.set(R.id,R);else if(m.get(R.id)!==R)throw Error(`Multiple style props with id "${R.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=y,this.styleProps=x;const v=E5(r),w={};for(const k of v){const N=new k(this);w[k.type]=N}this.bindingUtils=w;for(const k of[...o]){if(Mr(this.root.children,k.id))throw Error(`Can't override tool with id "${k.id}"`);this.root.children[k.id]=new k(this,this.root)}this.environment=new Mse(this),this.scribbles=new $se(this);const _=(k,N)=>{let O=null;const R=k.selectedShapeIds.filter(B=>!N.has(B));R.length!==k.selectedShapeIds.length&&(O||(O={...k}),O.selectedShapeIds=R);const j=k.erasingShapeIds.filter(B=>!N.has(B));j.length!==k.erasingShapeIds.length&&(O||(O={...k}),O.erasingShapeIds=j),k.hoveredShapeId&&N.has(k.hoveredShapeId)&&(O||(O={...k}),O.hoveredShapeId=null),k.editingShapeId&&N.has(k.editingShapeId)&&(O||(O={...k}),O.editingShapeId=null);const A=k.hintingShapeIds.filter(B=>!N.has(B));return A.length!==k.hintingShapeIds.length&&(O||(O={...k}),O.hintingShapeIds=A),k.focusedGroupId&&N.has(k.focusedGroupId)&&(O||(O={...k}),O.focusedGroupId=null),O};this.sideEffects=this.store.sideEffects;let C=new Map;const I=new Set,T=new Set;let P=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var k,N,O,R;I.clear();for(const j of T){T.delete(j);const A=this.getShape(j);if(!A)continue;const B=this.getShapeUtil(A),L=(k=B.onChildrenChange)==null?void 0:k.call(B,A);L!=null&&L.length&&this.updateShapes(L)}if(P.size){const j=P;P=new Set;for(const A of j){const B=this.getBindingUtil(A);(N=B.onOperationComplete)==null||N.call(B)}}if(C.size){const j=C;C=new Map;for(const A of j.values())(R=(O=this.getBindingUtil(A.binding)).onAfterDelete)==null||R.call(O,A)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(k,N)=>{var O,R,j,A;for(const B of this.getBindingsInvolvingShape(N))P.add(B.type),B.fromId===N.id&&((R=(O=this.getBindingUtil(B)).onAfterChangeFromShape)==null||R.call(O,{binding:B,shapeBefore:k,shapeAfter:N})),B.toId===N.id&&((A=(j=this.getBindingUtil(B)).onAfterChangeToShape)==null||A.call(j,{binding:B,shapeBefore:k,shapeAfter:N}));if(k.parentId!==N.parentId){const B=L=>{var M,D,U,z;const $=this.getShape(L);if($)for(const H of this.getBindingsInvolvingShape($))P.add(H.type),H.fromId===$.id&&((D=(M=this.getBindingUtil(H)).onAfterChangeFromShape)==null||D.call(M,{binding:H,shapeBefore:$,shapeAfter:$})),H.toId===$.id&&((z=(U=this.getBindingUtil(H)).onAfterChangeToShape)==null||z.call(U,{binding:H,shapeBefore:$,shapeAfter:$}))};B(N.id),this.visitDescendants(N.id,B)}if(k.parentId!==N.parentId&&Ts(N.parentId)){const B=new Set([k.id]);this.visitDescendants(k.id,L=>{B.add(L)});for(const L of this.getPageStates()){if(L.pageId===N.parentId)continue;const $=_(L,B);$&&this.store.put([$])}}k.parentId&&Ps(k.parentId)&&T.add(k.parentId),N.parentId!==k.parentId&&Ps(N.parentId)&&T.add(N.parentId)},beforeDelete:k=>{var j,A,B,L;if(I.has(k.id))return;k.parentId&&Ps(k.parentId)&&T.add(k.parentId),I.add(k.id);const N=[];for(const $ of this.getBindingsInvolvingShape(k)){P.add($.type),N.push($.id);const M=this.getBindingUtil($);$.fromId===k.id?((j=M.onBeforeIsolateToShape)==null||j.call(M,{binding:$,removedShape:k}),(A=M.onBeforeDeleteFromShape)==null||A.call(M,{binding:$,shape:k})):((B=M.onBeforeIsolateFromShape)==null||B.call(M,{binding:$,removedShape:k}),(L=M.onBeforeDeleteToShape)==null||L.call(M,{binding:$,shape:k}))}N.length&&this.deleteBindings(N);const O=new Set([k.id]),R=Re(this.getPageStates().map($=>_($,O)));R.length&&this.store.put(R)}},binding:{beforeCreate:k=>{var O,R;const N=(R=(O=this.getBindingUtil(k)).onBeforeCreate)==null?void 0:R.call(O,{binding:k});return N||k},afterCreate:k=>{var N,O;P.add(k.type),(O=(N=this.getBindingUtil(k)).onAfterCreate)==null||O.call(N,{binding:k})},beforeChange:(k,N)=>{var R,j;const O=(j=(R=this.getBindingUtil(N)).onBeforeChange)==null?void 0:j.call(R,{bindingBefore:k,bindingAfter:N});return O||N},afterChange:(k,N)=>{var O,R;P.add(N.type),(R=(O=this.getBindingUtil(N)).onAfterChange)==null||R.call(O,{bindingBefore:k,bindingAfter:N})},beforeDelete:k=>{var N,O;(O=(N=this.getBindingUtil(k)).onBeforeDelete)==null||O.call(N,{binding:k})},afterDelete:k=>{var N,O;(O=(N=this.getBindingUtil(k)).onAfterDelete)==null||O.call(N,{binding:k}),P.add(k.type)}},page:{afterCreate:k=>{const N=Tr.createId(k.id),O=Yi.createId(k.id);this.store.has(N)||this.store.put([Tr.create({id:N})]),this.store.has(O)||this.store.put([Yi.create({id:O,pageId:k.id})])},afterDelete:(k,N)=>{var j,A;if(((j=this.getInstanceState())==null?void 0:j.currentPageId)===k.id){const B=(A=this.getPages().find(L=>L.id!==k.id))==null?void 0:A.id;B?this.store.put([{...this.getInstanceState(),currentPageId:B}]):N==="user"&&this.store.ensureStoreIsUsable()}const O=Tr.createId(k.id),R=Yi.createId(k.id);this.store.remove([O,R])}},instance:{afterChange:(k,N,O)=>{var R;if(!this.store.has(N.currentPageId)){const j=this.store.has(k.currentPageId)?k.currentPageId:(R=this.getPages()[0])==null?void 0:R.id;j?this.store.update(N.id,A=>({...A,currentPageId:j})):O==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(k,N)=>{if((k==null?void 0:k.selectedShapeIds)!==(N==null?void 0:N.selectedShapeIds)){const O=N.selectedShapeIds.filter(j=>{var B,L;let A=(B=this.getShape(j))==null?void 0:B.parentId;for(;Ps(A);){if(N.selectedShapeIds.includes(A))return!1;A=(L=this.getShape(A))==null?void 0:L.parentId}return!0});let R=null;if(O.length>0){const j=this.findCommonAncestor(Re(O.map(A=>this.getShape(A))),A=>this.isShapeOfType(A,"group"));j&&(R=j)}else N!=null&&N.focusedGroupId&&(R=N.focusedGroupId);(O.length!==N.selectedShapeIds.length||R!==N.focusedGroupId)&&this.store.put([{...N,selectedShapeIds:O,focusedGroupId:R??null}])}}}})),this._currentPageShapeIds=Pse(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=Ise(this.store),this.disposables.add(this.store.listen(k=>{this.emit("change",k)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),d&&this.root.children[d]===void 0)throw Error(`No state found for initialState "${d}".`);this.root.enter(void 0,"initial"),this.edgeScrollManager=new Rse(this),this.focusManager=new Ose(this,u),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new CL}dispose(){this.disposables.forEach(n=>n()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(n){const s=typeof n=="string"?n:n.type,i=Ms(this.shapeUtils,s);return xt(i,`No shape util found for type "${s}"`),i}getBindingUtil(n){const s=typeof n=="string"?n:n.type,i=Ms(this.bindingUtils,s);return xt(i,`No binding util found for type "${s}"`),i}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(n){return this.history.mark(n),this}squashToMark(n){return this.history.squashToMark(n),this}bail(){return this.history.bail(),this}bailToMark(n){return this.history.bailToMark(n),this}run(n,s){const i=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(s==null?void 0:s.ignoreShapeLock)??i;try{this.history.batch(n,s)}finally{this._shouldIgnoreShapeLock=i}return this}batch(n,s){return this.run(n,s)}annotateError(n,{origin:s,willCrashApp:i,tags:r,extras:o}){const l=this.createErrorAnnotations(s,i);return ET(n,{tags:{...l.tags,...r},extras:{...l.extras,...o}}),i&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(n,s){try{const i=this.getEditingShapeId();return{tags:{origin:n,willCrashApp:s},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:i?this.getShape(i):void 0,inputs:this.inputs}}}catch{return{tags:{origin:n,willCrashApp:s},extras:{}}}}getCrashingError(){return this._crashingError}crash(n){return this._crashingError=n,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:n}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(n){const s=n.split(".").reverse();let i=this.root;for(;s.length>0;){const r=s.pop();if(!r)return!0;const o=i.getCurrent();if((o==null?void 0:o.id)===r){if(s.length===0)return!0;i=o;continue}else return!1}return!1}isInAny(...n){return n.some(s=>this.isIn(s))}setCurrentTool(n,s={}){return this.root.transition(n,s),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const n=this.getCurrentTool();return n?n.getCurrentToolIdMask()??n.id:""}getStateDescendant(n){var r;const s=n.split(".").reverse();let i=this.root;for(;s.length>0;){const o=s.pop();if(!o)return i;const l=(r=i.children)==null?void 0:r[o];if(!l)return;i=l}return i}getDocumentSettings(){return this.store.get(G_)}updateDocumentSettings(n){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...n}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(ls)}updateInstanceState(n,s){return this._updateInstanceState(n,{history:"ignore",...s}),n.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),n.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(n){const s=new Set(this.getOpenMenus());return s.has(n)||(s.add(n),this.updateInstanceState({openMenus:[...s]})),this}deleteOpenMenu(n){const s=new Set(this.getOpenMenus());return s.has(n)&&(s.delete(n),this.updateInstanceState({openMenus:[...s]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Yi.createId(this.getCurrentPageId())}updateCurrentPageState(n){return this._updateCurrentPageState(n),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:n}=this.getCurrentPageState();return Re(n.map(s=>this.store.get(s)))}setSelectedShapes(n){return this.run(()=>{const s=n.map(o=>typeof o=="string"?o:o.id),{selectedShapeIds:i}=this.getCurrentPageState(),r=new Set(i);if(s.length===r.size&&s.every(o=>r.has(o)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:s}])},{history:"record-preserveRedoStack"})}isAncestorSelected(n){const s=typeof n=="string"?n:(n==null?void 0:n.id)??null,i=this.getShape(s);if(!i)return!1;const r=this.getSelectedShapeIds();return!!this.findShapeAncestor(i,o=>r.includes(o.id))}select(...n){const s=typeof n[0]=="string"?n:n.map(i=>i.id);return this.setSelectedShapes(s),this}deselect(...n){const s=typeof n[0]=="string"?n:n.map(r=>r.id),i=this.getSelectedShapeIds();return i.length>0&&s.length>0&&this.setSelectedShapes(i.filter(r=>!s.includes(r))),this}selectAll(){const n=this.getSortedChildIdsForParent(this.getCurrentPageId());return n.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(n)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var n;return((n=this.getOnlySelectedShape())==null?void 0:n.id)??null}getOnlySelectedShape(){const n=this.getSelectedShapes();return n.length===1?n[0]:null}getSelectionPageBounds(){const n=this.getCurrentPageState().selectedShapeIds;return n.length===0?null:de.Common(Re(n.map(s=>this.getShapePageBounds(s))))}getSelectionRotation(){const n=this.getSelectedShapeIds();let s=!1,i=0;for(let r=0,o=n.length;r<o;r++){const l=this.getShapePageTransform(n[r]);if(l)if(s){if(l.rotation()!==i)return 0}else s=!0,i=l.rotation()}return i}getSelectionRotatedPageBounds(){const n=this.getSelectedShapeIds();if(n.length===0)return;const s=this.getSelectionRotation();if(s===0)return this.getSelectionPageBounds();if(n.length===1){const r=this.getShapeGeometry(n[0]).bounds.clone(),o=this.getShapePageTransform(n[0]);return r.point=o.applyToPoint(r.point),r}const i=de.FromPoints(this.getSelectedShapeIds().flatMap(r=>{const o=this.getShapePageTransform(r);return o?o.applyToPoints(this.getShapeGeometry(r).bounds.corners):[]}).map(r=>r.rot(-s)));return i.point=i.point.rot(s),i}getSelectionRotatedScreenBounds(){const n=this.getSelectionRotatedPageBounds();if(!n)return;const{x:s,y:i}=this.pageToScreen(n.point),r=this.getZoomLevel();return new de(s,i,n.width*r,n.height*r)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const n=this.getFocusedGroupId();return n?this.getShape(n):void 0}setFocusedGroup(n){const s=typeof n=="string"?n:(n==null?void 0:n.id)??null;if(s!==null){const i=this.getShape(s);if(!i)throw Error(`Editor.setFocusedGroup: Shape with id ${s} does not exist`);if(!this.isShapeOfType(i,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${i.type}`)}return s===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,i=>({...i,focusedGroupId:s}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const n=this.getFocusedGroup();if(n){const s=this.findShapeAncestor(n,i=>this.isShapeOfType(i,"group"));this.setFocusedGroup((s==null?void 0:s.id)??null),this.select(n.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const n=this.getEditingShapeId();return n?this.getShape(n):void 0}setEditingShape(n){const s=typeof n=="string"?n:(n==null?void 0:n.id)??null;if(s!==this.getEditingShapeId()){if(s){const i=this.getShape(s);if(i&&this.getShapeUtil(i).canEdit(i))return this.run(()=>{this._updateCurrentPageState({editingShapeId:s})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const n=this.getHoveredShapeId();return n?this.getShape(n):void 0}setHoveredShape(n){const s=typeof n=="string"?n:(n==null?void 0:n.id)??null;return s===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:s})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const n=this.getHintingShapeIds();return Re(n.map(s=>this.getShape(s)))}setHintingShapes(n){const s=typeof n[0]=="string"?n:n.map(i=>i.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:CT(s)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const n=this.getErasingShapeIds();return Re(n.map(s=>this.getShape(s)))}setErasingShapes(n){const s=typeof n[0]=="string"?n:n.map(r=>r.id);s.sort();const i=this.getErasingShapeIds();return this.run(()=>{if(s.length===i.length){for(let r=0;r<s.length;r++)if(s[r]!==i[r]){this._updateCurrentPageState({erasingShapeIds:s});break}}else this._updateCurrentPageState({erasingShapeIds:s})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(n){const s=typeof n=="string"?n:(n==null?void 0:n.id)??null;return s!==this.getCroppingShapeId()&&this.run(()=>{if(!s)this.updateCurrentPageState({croppingShapeId:null});else{const i=this.getShape(s),r=this.getShapeUtil(i);i&&r.canCrop(i)&&this.updateCurrentPageState({croppingShapeId:s})}},{history:"ignore"}),this}_unsafe_getCameraId(){return Tr.createId(this.getCurrentPageId())}getCamera(){const n=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const s=this.getCameraForFollowing();if(s)return{...n,...s}}return n}getViewportPageBoundsForFollowing(){const n=this.getInstanceState().followingUserId;if(!n)return null;const s=this.getCollaborators().find(p=>p.userId===n);if(!s)return null;const{w:i,h:r}=s.screenBounds,{x:o,y:l,z:c}=s.camera,d=new de(-o,-l,i/c,r/c),u=this.getViewportScreenBounds().clone(),h=u.width/u.height;return u.width=d.width,u.height=u.width/h,u.height<d.height&&(u.height=d.height,u.width=u.height*h),u.center=d.center,u}getCameraForFollowing(){const n=this.getViewportPageBoundsForFollowing();return n?{x:-n.x,y:-n.y,z:this.getViewportScreenBounds().w/n.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const n=this.getCameraOptions();if(!n.constraints||n.constraints.initialZoom==="default")return 1;const{zx:s,zy:i}=RN(this,n);switch(n.constraints.initialZoom){case"fit-min":return Math.max(s,i);case"fit-max":return Math.min(s,i);case"fit-x":return s;case"fit-y":return i;case"fit-min-100":return Math.min(1,Math.max(s,i));case"fit-max-100":return Math.min(1,Math.min(s,i));case"fit-x-100":return Math.min(1,s);case"fit-y-100":return Math.min(1,i);default:throw Zn(n.constraints.initialZoom)}}getBaseZoom(){const n=this.getCameraOptions();if(!n.constraints||n.constraints.baseZoom==="default")return 1;const{zx:s,zy:i}=RN(this,n);switch(n.constraints.baseZoom){case"fit-min":return Math.max(s,i);case"fit-max":return Math.min(s,i);case"fit-x":return s;case"fit-y":return i;case"fit-min-100":return Math.min(1,Math.max(s,i));case"fit-max-100":return Math.min(1,Math.min(s,i));case"fit-x-100":return Math.min(1,s);case"fit-y-100":return Math.min(1,i);default:throw Zn(n.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(n){var i;const s=yt({...this._cameraOptions.__unsafe__getWithoutCapture(),...n});return((i=s.zoomSteps)==null?void 0:i.length)<1&&(s.zoomSteps=[1]),this._cameraOptions.set(s),this}getConstrainedCamera(n,s){const i=this.getCamera();let{x:r,y:o,z:l=i.z}=n;if(!(s!=null&&s.force)){const c=this.getCameraOptions(),d=c.zoomSteps[0],u=Tn(c.zoomSteps),h=this.getViewportScreenBounds();if(c.constraints){const{constraints:p}=c,f=Math.min(p.padding.y,h.w/2),g=Math.min(p.padding.x,h.h/2),y=de.From(c.constraints.bounds),x=(h.w-g*2)/y.w,m=(h.h-f*2)/y.h,v=this.getBaseZoom(),w=u*v,_=d*v;if(s!=null&&s.reset&&(l=this.getInitialZoom()),l<_||l>w){const{x:j,y:A,z:B}=i,L=-j+h.w/B/2,$=-A+h.h/B/2;l=on(l,_,w);const M=-j+h.w/l/2,D=-A+h.h/l/2;r=j+M-L,o=A+D-$}const C=g/l-y.x,I=f/l-y.y,T=(h.w-g*2)/l-y.w,P=(h.h-f*2)/l-y.h,k=C+T*p.origin.x,N=I+P*p.origin.y,O=typeof p.behavior=="string"?p.behavior:p.behavior.x,R=typeof p.behavior=="string"?p.behavior:p.behavior.y;if(s!=null&&s.reset)r=k,o=N;else{switch(O){case"fixed":{r=k;break}case"contain":{l<x?r=k:r=on(r,C+T,C);break}case"inside":{l<x?r=on(r,C,(h.w-g)/l-y.w):r=on(r,C+T,C);break}case"outside":{r=on(r,g/l-y.w,(h.w-g)/l);break}case"free":break;default:throw Zn(O)}switch(R){case"fixed":{o=N;break}case"contain":{l<m?o=N:o=on(o,I+P,I);break}case"inside":{l<m?o=on(o,I,(h.h-f)/l-y.h):o=on(o,I+P,I);break}case"outside":{o=on(o,f/l-y.h,(h.h-f)/l);break}case"free":break;default:throw Zn(R)}}}else if(l>u||l<d){const{x:p,y:f,z:g}=i;l=on(l,d,u),r=p+(-p+h.w/l/2)-(-p+h.w/g/2),o=f+(-f+h.h/l/2)-(-f+h.h/g/2)}}return{x:r,y:o,z:l}}_setCamera(n,s){const i=this.getCamera(),{x:r,y:o,z:l}=this.getConstrainedCamera(n,s);return i.x===r&&i.y===o&&i.z===l?this:(Rr(()=>{const c={...i,x:r,y:o,z:l};this.run(()=>{this.store.put([c])},{history:"ignore"});const{currentScreenPoint:d,currentPagePoint:u}=this.inputs,{screenBounds:h}=this.store.unsafeGetWithoutCapture(ls);if(d.x/l-r!==u.x||d.y/l-o!==u.y){const p={type:"pointer",target:"canvas",name:"pointer_move",point:E.AddXY(d,h.x,h.y),pointerId:oN.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1};s!=null&&s.immediate?this._flushEventForTick(p):this.dispatch(p)}this._tickCameraState()}),this)}setCamera(n,s){const{isLocked:i}=this._cameraOptions.__unsafe__getWithoutCapture();if(i&&!(s!=null&&s.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const r=E.Cast(n);Number.isFinite(r.x)||(r.x=0),Number.isFinite(r.y)||(r.y=0),(r.z===void 0||!Number.isFinite(r.z))&&(n.z=this.getZoomLevel());const o=this.getConstrainedCamera(r,s);if(s!=null&&s.animation){const{width:l,height:c}=this.getViewportScreenBounds();this._animateToViewport(new de(-o.x,-o.y,l/o.z,c/o.z),s)}else this._setCamera(o,{...s,force:!0});return this}centerOnPoint(n,s){const{isLocked:i}=this.getCameraOptions();if(i&&!(s!=null&&s.force))return this;const{width:r,height:o}=this.getViewportPageBounds();return this.setCamera(new E(-(n.x-r/2),-(n.y-o/2),this.getCamera().z),s),this}zoomToFit(n){const s=[...this.getCurrentPageShapeIds()];if(s.length<=0)return this;const i=de.Common(Re(s.map(r=>this.getShapePageBounds(r))));return this.zoomToBounds(i,n),this}resetZoom(n=this.getViewportScreenCenter(),s){const{isLocked:i,constraints:r}=this.getCameraOptions();if(i&&!(s!=null&&s.force))return this;const o=this.getCamera(),{x:l,y:c,z:d}=o,{x:u,y:h}=n;let p=1;if(r){const f=this.getInitialZoom();d!==f&&(p=f)}return this.setCamera(new E(l+(u/p-u)-(u/d-u),c+(h/p-h)-(h/d-h),p),s),this}zoomIn(n=this.getViewportScreenCenter(),s){const{isLocked:i}=this.getCameraOptions();if(i&&!(s!=null&&s.force))return this;const{x:r,y:o,z:l}=this.getCamera(),{zoomSteps:c}=this.getCameraOptions();if(c!==null&&c.length>1){const d=this.getBaseZoom();let u=Tn(c)*d;for(let h=1;h<c.length;h++){const p=c[h-1]*d,f=c[h]*d;if(!(f-l<=(f-p)/2)){u=f;break}}this.setCamera(new E(r+(n.x/u-n.x)-(n.x/l-n.x),o+(n.y/u-n.y)-(n.y/l-n.y),u),s)}return this}zoomOut(n=this.getViewportScreenCenter(),s){const{isLocked:i}=this.getCameraOptions();if(i&&!(s!=null&&s.force))return this;const{zoomSteps:r}=this.getCameraOptions();if(r!==null&&r.length>1){const o=this.getBaseZoom(),{x:l,y:c,z:d}=this.getCamera();let u=r[0]*o;for(let h=r.length-1;h>0;h--){const p=r[h-1]*o,f=r[h]*o;if(!(f-d>=(f-p)/2)){u=p;break}}this.setCamera(new E(l+(n.x/u-n.x)-(n.x/d-n.x),c+(n.y/u-n.y)-(n.y/d-n.y),u),s)}return this}zoomToSelection(n){const{isLocked:s}=this.getCameraOptions();if(s&&!(n!=null&&n.force))return this;const i=this.getSelectionPageBounds();return i&&this.zoomToBounds(i,{targetZoom:Math.max(1,this.getZoomLevel()),...n}),this}zoomToBounds(n,s){const i=this._cameraOptions.__unsafe__getWithoutCapture();if(i.isLocked&&!(s!=null&&s.force))return this;const r=this.getViewportScreenBounds(),o=(s==null?void 0:s.inset)??Math.min(Uee,r.width*.28),l=this.getBaseZoom(),c=i.zoomSteps[0],d=Tn(i.zoomSteps);let u=on(Math.min((r.width-o)/n.w,(r.height-o)/n.h),c*l,d*l);return(s==null?void 0:s.targetZoom)!==void 0&&(u=Math.min(s.targetZoom,u)),this.setCamera(new E(-n.x+(r.width-n.w*u)/2/u,-n.y+(r.height-n.h*u)/2/u,u),s),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(n){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=n;const{elapsed:s,easing:i,duration:r,start:o,end:l}=this._viewportAnimation;if(s>r){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new E(-l.x,-l.y,this.getViewportScreenBounds().width/l.width));return}const c=r-s,d=i(1-c/r),u=o.minX+(l.minX-o.minX)*d,h=o.minY+(l.minY-o.minY)*d,p=o.maxX+(l.maxX-o.maxX)*d;this._setCamera(new E(-u,-h,this.getViewportScreenBounds().width/(p-u)),{force:!0})}_animateToViewport(n,s={animation:Jb}){const{animation:i,...r}=s;if(!i)return;const{duration:o=0,easing:l=un.easeInOutCubic}=i,c=this.user.getAnimationSpeed(),d=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),o===0||c===0?this._setCamera(new E(-n.x,-n.y,this.getViewportScreenBounds().width/n.width),{...r}):(this._viewportAnimation={elapsed:0,duration:o/c,easing:l,start:d.clone(),end:n.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(n={}){const{isLocked:s}=this.getCameraOptions();if(s&&!(n!=null&&n.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:r,friction:o=this.options.cameraSlideFriction,direction:l,speedThreshold:c=.01}=n;let d=Math.min(r,1);const u=()=>{this.off("tick",h),this.off("stop-camera-animation",u)};this.once("stop-camera-animation",u);const h=p=>{const{x:f,y:g,z:y}=this.getCamera(),x=E.Mul(l,d*p/y);d*=1-o,d<c?u():this._setCamera(new E(f+x.x,g+x.y,y))};return this.on("tick",h),this}zoomToUser(n,s={animation:{duration:500}}){const i=this.getCollaborators().find(r=>r.userId===n);return i?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const r=i.currentPageId===this.getCurrentPageId();r||this.setCurrentPage(i.currentPageId),s&&s.animation&&!r&&(s.animation=void 0),this.centerOnPoint(i.cursor,s);const{highlightedUserIds:o}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...o,n]}),this.timers.setTimeout(()=>{const l=[...this.getInstanceState().highlightedUserIds],c=l.indexOf(n);c<0||(l.splice(c,1),this.updateInstanceState({highlightedUserIds:l}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(n,s=!1){n.width=Math.max(n.width,1),n.height=Math.max(n.height,1);const i=[n.minY!==0,!Ra(document.body.scrollWidth,n.maxX,1),!Ra(document.body.scrollHeight,n.maxY,1),n.minX!==0],{screenBounds:r,insets:o}=this.getInstanceState();if(n.equals(r)&&i.every((c,d)=>c===o[d]))return this;const{_willSetInitialBounds:l}=this;if(this._willSetInitialBounds=!1,l)this.updateInstanceState({screenBounds:n.toJson(),insets:i}),this.setCamera(this.getCamera());else if(s&&!this.getInstanceState().followingUserId){const c=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:n.toJson(),insets:i}),this.centerOnPoint(c)}else this.updateInstanceState({screenBounds:n.toJson(),insets:i}),this._setCamera(E.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:n,y:s,w:i,h:r}=this.getInstanceState().screenBounds;return new de(n,s,i,r)}getViewportScreenCenter(){const n=this.getViewportScreenBounds();return new E(n.midX-n.minX,n.midY-n.minY)}getViewportPageBounds(){const{w:n,h:s}=this.getViewportScreenBounds(),{x:i,y:r,z:o}=this.getCamera();return new de(-i,-r,n/o,s/o)}screenToPage(n){const{screenBounds:s}=this.store.unsafeGetWithoutCapture(ls),{x:i,y:r,z:o=1}=this.getCamera();return new E((n.x-s.x)/o-i,(n.y-s.y)/o-r,n.z??.5)}pageToScreen(n){const{screenBounds:s}=this.store.unsafeGetWithoutCapture(ls),{x:i,y:r,z:o=1}=this.getCamera();return new E((n.x+i)*o+s.x,(n.y+r)*o+s.y,n.z??.5)}pageToViewport(n){const{x:s,y:i,z:r=1}=this.getCamera();return new E((n.x+s)*r,(n.y+i)*r,n.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const n=this._getCollaboratorsQuery().get();return n.length?[...new Set(n.map(i=>i.userId))].sort().map(i=>n.filter(o=>o.userId===i).sort((o,l)=>l.lastActivityTimestamp-o.lastActivityTimestamp)[0]):bo}getCollaboratorsOnCurrentPage(){const n=this.getCurrentPageId();return this.getCollaborators().filter(s=>s.currentPageId===n)}startFollowingUser(n){this.stopFollowingUser();const s=this._getCollaboratorsQuery().get().filter(o=>o.userId===n);if(!s.length)return console.warn("User not found"),this;const i=this.user.getId();if(i||console.warn("You should set the userId for the current instance before following a user"),s.some(o=>o.followingUserId===i))return this;const r=te("latestLeaderPresence",()=>this.getCollaborators().find(o=>o.userId===n));return Rr(()=>{this.updateInstanceState({followingUserId:n},{history:"ignore"});const o=hc("update current page",()=>{const d=r.get();if(!d){this.stopFollowingUser();return}d.currentPageId!==this.getCurrentPageId()&&this.getPage(d.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:d.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),l=()=>{o(),this._isLockedOnFollowingUser.set(!1),this.off("frame",c),this.off("stop-following",l)},c=()=>{if(!r.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const u=this.user.getAnimationSpeed();if(u===0){this._isLockedOnFollowingUser.set(!0);return}const h=this.getViewportPageBoundsForFollowing();if(!h){this.stopFollowingUser();return}const p=this.getViewportPageBounds(),f=Math.abs(h.minX-p.minX)+Math.abs(h.maxX-p.maxX),g=Math.abs(h.minY-p.minY)+Math.abs(h.maxY-p.maxY);if(f<this.options.followChaseViewportSnap&&g<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const y=on(u*.5,.1,.8),x=new de(js(p.minX,h.minX,y),js(p.minY,h.minY,y),js(p.width,h.width,y),js(p.height,h.height,y)),m=new E(-x.x,-x.y,this.getViewportScreenBounds().width/x.width);this.stopCameraAnimation(),this._setCamera(m)};this.once("stop-following",l),this.addListener("frame",c),c()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(n){const s=[];let i=this.options.maxShapesPerPage*2,r=this.options.maxShapesPerPage;const o=this.getErasingShapeIds(),l=(d,u,h)=>{const p=this.getShape(d);if(!p)return;u*=p.opacity;let f=!1;const g=this.getShapeUtil(p);n&&(f=!h&&o.includes(d),f&&(u*=.32)),s.push({id:d,shape:p,util:g,index:i,backgroundIndex:r,opacity:u}),i+=1,r+=1;const y=this.getSortedChildIdsForParent(d);if(!y.length)return;let x=null;g.providesBackgroundForChildren(p)&&(x=r,r=i,i+=this.options.maxShapesPerPage);for(const m of y)l(m,u,h||f);x!==null&&(r=x)},c=n?[this.getCurrentPage()]:this.getPages();for(const d of c)for(const u of this.getSortedChildIdsForParent(d.id))l(u,1,!1);return s}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(GJ)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(Xn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(n){return this.store.get(typeof n=="string"?n:n.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(n){const s=typeof n=="string"?n:n.id,i=this.store.query.exec("shape",{parentId:{eq:s}});return this.getShapeAndDescendantIds(i.map(r=>r.id))}setCurrentPage(n){const s=typeof n=="string"?n:n.id;return this.store.has(s)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:s}])},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(n){return this.getInstanceState().isReadonly?this:this.getPage(n.id)?this.run(()=>this.store.update(n.id,i=>({...i,...n}))):this}createPage(n){return this.run(()=>{if(this.getInstanceState().isReadonly||this.getPages().length>=this.options.maxPages)return;const s=this.getPages(),i=xse(n.name??"Page 1",s.map(l=>l.name));let r=n.index;(!r||s.some(l=>l.index===r))&&(r=Vi(s[s.length-1].index));const o=No.create({meta:{},...n,name:i,index:r});this.store.put([o])}),this}deletePage(n){const s=typeof n=="string"?n:n.id;return this.run(()=>{if(this.getInstanceState().isReadonly)return;const i=this.getPages();if(i.length===1)return;const r=this.getPage(s);if(r){if(s===this.getCurrentPageId()){const o=i.findIndex(c=>c.id===s),l=i[o-1]??i[o+1];this.setCurrentPage(l.id)}this.store.remove([r.id])}}),this}duplicatePage(n,s=No.createId()){if(this.getPages().length>=this.options.maxPages)return this;const i=typeof n=="string"?n:n.id,r=this.getPage(i);if(!r)return this;const o={...this.getCamera()},l=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(r.id));return this.run(()=>{var u;const c=this.getPages(),d=_p(r.index,(u=c[c.indexOf(r)+1])==null?void 0:u.index);if(this.createPage({name:r.name+" Copy",id:s,index:d}),this.setCurrentPage(s),this.setCamera(o),l)return this.putContentOntoCurrentPage(l)}),this}renamePage(n,s){const i=typeof n=="string"?n:n.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:i,name:s}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(n){return this.getInstanceState().isReadonly?this:n.length<=0?this:(this.run(()=>this.store.put(n),{history:"ignore"}),this)}updateAssets(n){return this.getInstanceState().isReadonly?this:n.length<=0?this:(this.run(()=>{this.store.put(n.map(s=>({...this.store.get(s.id),...s})))},{history:"ignore"}),this)}deleteAssets(n){if(this.getInstanceState().isReadonly)return this;const s=typeof n[0]=="string"?n:n.map(i=>i.id);return s.length<=0?this:(this.run(()=>this.store.remove(s),{history:"ignore"}),this)}getAsset(n){return this.store.get(typeof n=="string"?n:n.id)}async resolveAssetUrl(n,s){if(!n)return null;const i=this.getAsset(n);if(!i)return null;const{screenScale:r=1,shouldResolveToOriginal:o=!1}=s,c=Math.max(.125,(h=>Math.pow(2,Math.ceil(Math.log2(h))))(r)),d="connection"in navigator?navigator.connection.effectiveType:null,u=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(i,{screenScale:r||1,steppedScreenScale:c,dpr:u,networkEffectiveType:d,shouldResolveToOriginal:o})}async uploadAsset(n,s){return await this.store.props.assets.upload(n,s)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",n=>this.getShapeUtil(n).getGeometry(n),(n,s)=>n.props===s.props)}getShapeGeometry(n){return this._getShapeGeometryCache().get(typeof n=="string"?n:n.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",n=>{var s,i;return(i=(s=this.getShapeUtil(n)).getHandles)==null?void 0:i.call(s,n)})}getShapeHandles(n){return this._getShapeHandlesCache().get(typeof n=="string"?n:n.id)}getShapeLocalTransform(n){const s=typeof n=="string"?n:n.id,i=this.getShape(s);if(!i)throw Error("Editor.getTransform: shape not found");return ve.Identity().translate(i.x,i.y).rotate(i.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",n=>{if(Ts(n.parentId))return this.getShapeLocalTransform(n);const s=this._getShapePageTransformCache().get(n.parentId)??ve.Identity();return ve.Compose(s,this.getShapeLocalTransform(n))})}getShapeParentTransform(n){const s=typeof n=="string"?n:n.id,i=this.getShape(s);return!i||Ts(i.parentId)?ve.Identity():this._getShapePageTransformCache().get(i.parentId)??ve.Identity()}getShapePageTransform(n){const s=typeof n=="string"?n:n.id;return this._getShapePageTransformCache().get(s)??ve.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",n=>{const s=this._getShapePageTransformCache().get(n.id);return s?de.FromPoints(ve.applyToPoints(s,this.getShapeGeometry(n).vertices)):new de})}getShapePageBounds(n){return this._getShapePageBoundsCache().get(typeof n=="string"?n:n.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",n=>{const s=this._getShapeMaskCache().get(n.id);if(!s)return;if(s.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const i=this._getShapePageTransformCache().get(n.id);return i?`polygon(${ve.applyToPoints(ve.Inverse(i),s).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(n){return this._getShapeClipPathCache().get(typeof n=="string"?n:n.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",n=>{if(Ts(n.parentId))return;const s=this.getShapeAncestors(n.id).filter(r=>this.isShapeOfType(r,"frame"));return s.length===0?void 0:s.map(r=>this._getShapePageTransformCache().get(r.id).applyToPoints(this.getShapeGeometry(r).vertices)).reduce((r,o)=>{if(!(o&&r))return;const l=TN(r,o);return l?l.map(E.Cast):[]})})}getShapeMask(n){return this._getShapeMaskCache().get(typeof n=="string"?n:n.id)}getShapeMaskedPageBounds(n){return typeof n!="string"&&(n=n.id),this._getShapeMaskedPageBoundsCache().get(n)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",n=>{const s=this._getShapePageBoundsCache().get(n.id);if(!s)return;const i=this._getShapeMaskCache().get(n.id);if(i){if(i.length===0)return;const{corners:r}=s;if(r.every((l,c)=>l&&E.Equals(l,i[c])))return s.clone();const o=TN(i,r);return o?de.FromPoints(o):void 0}return s})}getShapeAncestors(n,s=[]){const i=typeof n=="string"?n:n.id,r=this.getShape(i);if(!r)return s;const o=r.parentId;if(Ts(o))return s.reverse(),s;const l=this.store.get(o);return l?(s.push(l),this.getShapeAncestors(l,s)):s}findShapeAncestor(n,s){const i=typeof n=="string"?n:n.id,r=this.getShape(i);if(!r)return;const o=r.parentId;if(Ts(o))return;const l=this.getShape(o);if(l)return s(l)?l:this.findShapeAncestor(l,s)}hasAncestor(n,s){const i=typeof n=="string"?n:n==null?void 0:n.id,r=i&&this.getShape(i);return r?r.parentId===s?!0:this.hasAncestor(this.getShapeParent(r),s):!1}findCommonAncestor(n,s){var d;if(n.length===0)return;const i=typeof n[0]=="string"?n:n.map(u=>u.id),r=Re(i.map(u=>this.getShape(u)));if(r.length===1){const u=r[0].parentId;return Ts(u)?void 0:s?(d=this.findShapeAncestor(r[0],s))==null?void 0:d.id:u}const[o,...l]=r;let c=this.getShapeParent(o);for(;c;){if(s&&!s(c)){c=this.getShapeParent(c);continue}if(l.every(u=>this.hasAncestor(u,c.id)))return c.id;c=this.getShapeParent(c)}}isShapeOrAncestorLocked(n){const s=typeof n=="string"?this.getShape(n):n;return s===void 0?!1:s.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(s))}_notVisibleShapes(){return Tse(this)}getCulledShapes(){const n=this._notVisibleShapes().get(),s=this.getSelectedShapeIds(),i=this.getEditingShapeId(),r=new Set(n);return i&&r.delete(i),s.forEach(o=>{r.delete(o)}),r}getCurrentPageBounds(){let n;return this.getCurrentPageShapeIdsSorted().forEach(s=>{const i=this.getShapeMaskedPageBounds(s);i&&(n?n=n.expand(i):n=i.clone())}),n}getSelectedShapeAtPoint(n){const s=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(i=>i.type!=="group"&&s.includes(i.id)).reverse().find(i=>this.isPointInShape(i,n,{hitInside:!0,margin:0}))}getShapeAtPoint(n,s={}){const i=this.getZoomLevel(),r=this.getViewportPageBounds(),{filter:o,margin:l=0,hitLocked:c=!1,hitLabels:d=!1,hitInside:u=!1,hitFrameInside:h=!1}=s;let p=1/0,f=null,g=1/0,y=null;const x=(s.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(m=>{if(m.isLocked&&!c||this.isShapeOfType(m,"group"))return!1;const v=this.getShapeMask(m);return v&&!si(n,v)?!1:o?o(m):!0});for(let m=x.length-1;m>=0;m--){const v=x[m],w=this.getShapeGeometry(v),_=w instanceof sr,C=this.getPointInShapeSpace(v,n);if((this.isShapeOfType(v,"arrow")||this.isShapeOfType(v,"geo")&&v.props.fill==="none")&&v.props.text.trim()){for(const T of w.children)if(T.isLabel&&T.isPointInBounds(C))return v}if(this.isShapeOfType(v,"frame")){const T=w.distanceToPoint(C,u);if(Math.abs(T)<=l)return y||v;if(w.hitTestPoint(C,0,!0))return y||f||(h?v:void 0);continue}let I;if(_){let T=1/0;for(const P of w.children){if(P.isLabel&&!d)continue;const k=P.distanceToPoint(C,u);k<T&&(T=k)}I=T}else l===0&&(w.bounds.w<1||w.bounds.h<1)||w.bounds.containsPoint(C,l)?I=w.distanceToPoint(C,u):I=1/0;if(w.isClosed){if(I<=l){if(w.isFilled||_&&w.children[0].isFilled)return y||v;if(this.getShapePageBounds(v).contains(r))continue;if(Math.abs(I)<l)Math.abs(I)<g&&(g=Math.abs(I),y=v);else if(!y){const{area:T}=w;T<p&&(p=T,f=v)}}}else if(I<this.options.hitTestMargin/i)return v}return y||f||void 0}getShapesAtPoint(n,s={}){return this.getCurrentPageShapes().filter(i=>this.isPointInShape(i,n,s))}isPointInShape(n,s,i={}){const{hitInside:r=!1,margin:o=0}=i,l=typeof n=="string"?n:n.id,c=this.getShapeMask(l);return c&&!si(s,c)?!1:this.getShapeGeometry(l).hitTestPoint(this.getPointInShapeSpace(n,s),o,r)}getPointInShapeSpace(n,s){const i=typeof n=="string"?n:n.id;return this._getShapePageTransformCache().get(i).clone().invert().applyToPoint(s)}getPointInParentSpace(n,s){const i=typeof n=="string"?n:n.id,r=this.getShape(i);if(!r)return new E(0,0);if(Ts(r.parentId))return E.From(s);const o=this.getShapePageTransform(r.parentId);return o?o.clone().invert().applyToPoint(s):E.From(s)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),n=>this.store.get(n))}getCurrentPageShapesSorted(){const n=[],s=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let i=0,r=s.length;i<r;i++)R5(this,s[i],n);return n}getCurrentPageRenderingShapesSorted(){const n=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:s})=>!n.has(s))}isShapeOfType(n,s){const i=typeof n=="string"?this.getShape(n):n;return i?i.type===s:!1}getShape(n){const s=typeof n=="string"?n:n.id;if(Ps(s))return this.store.get(s)}getShapeParent(n){const s=typeof n=="string"?n:n==null?void 0:n.id;if(!s)return;const i=this.getShape(s);if(!(i===void 0||!Ps(i.parentId)))return this.store.get(i.parentId)}getShapeNearestSibling(n,s){return s?s.parentId===n.parentId?s:this.findShapeAncestor(s,r=>r.parentId===n.parentId):void 0}isShapeInPage(n,s=this.getCurrentPageId()){const i=typeof n=="string"?n:n.id,r=this.getShape(i);if(!r)return!1;let o=!1;if(r.parentId===s)o=!0;else{let l=this.getShape(r.parentId);e:for(;l;){if(l.parentId===s){o=!0;break e}l=this.getShape(l.parentId)}}return o}getAncestorPageId(n){const s=typeof n=="string"?n:n==null?void 0:n.id,i=s&&this.getShape(s);if(i)return Ts(i.parentId)?i.parentId:this.getAncestorPageId(this.getShape(i.parentId))}reparentShapes(n,s,i){const r=typeof n[0]=="string"?n:n.map(f=>f.id);if(r.length===0)return this;const o=[],l=Ts(s)?ve.Identity():this.getShapePageTransform(s),c=l.rotation();let d=[];const u=Re(this.getSortedChildIdsForParent(s).map(f=>this.getShape(f)));if(i){const f=u.find(g=>g.index===i);if(f){const g=u[u.indexOf(f)+1];g?d=Rd(i,g.index,r.length):d=Vb(i,r.length)}else{const g=u.sort(Xn).find(y=>y.index>i);g?d=Rd(i,g.index,r.length):d=Vb(i,r.length)}}else{const f=u.length&&u[u.length-1];d=f?Vb(f.index,r.length):Cp(r.length)}const h=l.clone().invert(),p=Re(r.map(f=>this.getShape(f)));return this.run(()=>{for(let f=0;f<p.length;f++){const g=p[f],y=this.getShapePageTransform(g);if(!y)continue;const x=y.point();if(!x)continue;const m=h.applyToPoint(x),v=y.rotation()-c;o.push({id:g.id,type:g.type,parentId:s,x:m.x,y:m.y,rotation:v,index:d[f]})}this.updateShapes(o)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(n){const s=typeof n=="string"?n:n.id,i=this._parentIdsToChildIds.get()[s];if(!i||i.length===0)return"a1";const r=this.getShape(i[i.length-1]);return Vi(r.index)}getSortedChildIdsForParent(n){const s=typeof n=="string"?n:n.id,i=this._parentIdsToChildIds.get()[s];return i||bo}visitDescendants(n,s){const i=typeof n=="string"?n:n.id,r=this.getSortedChildIdsForParent(i);for(const o of r)s(o)!==!1&&this.visitDescendants(o,s);return this}getShapeAndDescendantIds(n){const s=new Set;for(const i of n.map(r=>this.getShape(r)).sort(Xn))s.add(i.id),this.visitDescendants(i,r=>{s.add(r)});return s}getDroppingOverShape(n,s=[]){const i=this.getCurrentPageShapesSorted();for(let r=i.length-1;r>=0;r--){const o=i[r];if(this.getSelectedShapeIds().includes(o.id)||!this.getShapeUtil(o).canDropShapes(o,s)||s.find(c=>c.id===o.id||this.hasAncestor(o,c.id)))continue;const l=this.getShapeMaskedPageBounds(o.id);if(l&&l.containsPoint(n)&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(o,n),0,!0))return o}}getOutermostSelectableShape(n,s){const i=typeof n=="string"?n:n.id,r=this.getShape(i);let o=r,l=r;const c=this.getFocusedGroup();for(;l;){if(this.isShapeOfType(l,"group")&&(c==null?void 0:c.id)!==l.id&&!this.hasAncestor(c,l.id)&&((s==null?void 0:s(l))??!0))o=l;else if((c==null?void 0:c.id)===l.id)break;l=this.getShapeParent(l)}return o}_getBindingsIndexCache(){const n=Cse(this);return this.store.createComputedCache("bindingsIndex",s=>n.get().get(s.id))}getBinding(n){return this.store.get(n)}getBindingsFromShape(n,s){const i=typeof n=="string"?n:n.id;return this.getBindingsInvolvingShape(i).filter(r=>r.fromId===i&&r.type===s)}getBindingsToShape(n,s){const i=typeof n=="string"?n:n.id;return this.getBindingsInvolvingShape(i).filter(r=>r.toId===i&&r.type===s)}getBindingsInvolvingShape(n,s){const i=typeof n=="string"?n:n.id,r=this._getBindingsIndexCache().get(i)??bo;return s?r.filter(o=>o.type===s):r}createBindings(n){const s=[];for(const i of n){const r=this.getShape(i.fromId),o=this.getShape(i.toId);if(!r||!o||!this.canBindShapes({fromShape:r,toShape:o,binding:i}))continue;const c=this.getBindingUtil(i.type).getDefaultProps(),d=this.store.schema.types.binding.create({...i,id:i.id??Ll(),props:{...c,...i.props}});s.push(d)}return this.store.put(s),this}createBinding(n){return this.createBindings([n])}updateBindings(n){const s=[];for(const i of n){if(!i)continue;const r=this.getBinding(i.id);if(!r)continue;const o=fr(r,i);if(o===r)continue;const l=this.getShape(o.fromId),c=this.getShape(o.toId);!l||!c||this.canBindShapes({fromShape:l,toShape:c,binding:o})&&s.push(o)}return this.store.put(s),this}updateBinding(n){return this.updateBindings([n])}deleteBindings(n,{isolateShapes:s=!1}={}){const i=n.map(r=>typeof r=="string"?r:r.id);return s?this.store.atomic(()=>{var r,o;for(const l of i){const c=this.getBinding(l);if(!c)continue;const d=this.getBindingUtil(c);(r=d.onBeforeIsolateFromShape)==null||r.call(d,{binding:c,removedShape:this.getShape(c.toId)}),(o=d.onBeforeIsolateToShape)==null||o.call(d,{binding:c,removedShape:this.getShape(c.fromId)}),this.store.remove([l])}}):this.store.remove(i),this}deleteBinding(n,s){return this.deleteBindings([n],s)}canBindShapes({fromShape:n,toShape:s,binding:i}){const r=typeof n=="string"?n:n.type,o=typeof s=="string"?s:s.type,l=typeof i=="string"?i:i.type,c={fromShapeType:r,toShapeType:o,bindingType:l};return r===o?this.getShapeUtil(r).canBind(c):this.getShapeUtil(r).canBind(c)&&this.getShapeUtil(o).canBind(c)}rotateShapesBy(n,s){if((typeof n[0]=="string"?n:n.map(o=>o.id)).length<=0)return this;const r=k5({editor:this});return r?(Am({delta:s,snapshot:r,editor:this,stage:"one-off"}),this):this}getChangesToTranslateShape(n,s){var o,l,c;let i=n;const r=this.getShapeUtil(n);return i=fr(i,((o=r.onTranslateStart)==null?void 0:o.call(r,i))??void 0),i=fr(i,{id:n.id,type:n.type,x:s.x,y:s.y}),i=fr(i,((l=r.onTranslate)==null?void 0:l.call(r,n,i))??void 0),i=fr(i,((c=r.onTranslateEnd)==null?void 0:c.call(r,n,i))??void 0),i}nudgeShapes(n,s){const i=typeof n[0]=="string"?n:n.map(o=>o.id);if(i.length<=0)return this;const r=[];for(const o of i){const l=this.getShape(o),c=E.From(s),d=this.getShapeParentTransform(l);d&&c.rot(-d.rotation()),r.push(this.getChangesToTranslateShape(l,c.add(l)))}return this.updateShapes(r),this}duplicateShapes(n,s){return this.run(()=>{const i=typeof n[0]=="string"?n:n.map(p=>p.id);if(i.length<=0)return this;const r=new Set(i),o=this.getShapeAndDescendantIds(i),l=[...o].reverse(),c=new Map;for(const p of o)c.set(p,it());const{shapesToCreate:d,bindingsToCreate:u}=AN(this,o,p=>{const f=[];for(const y of p){const x=this.getBinding(y);if(!x)continue;const m=Ll();f.push({...x,id:m,fromId:wi(c.get(x.fromId)),toId:wi(c.get(x.toId))})}const g=[];for(const y of l){const x=wi(c.get(y)),m=this.getShape(y);if(!m)continue;let v=0,w=0;if(s&&r.has(y)){const N=this.getShapeParentTransform(m),O=new E(s.x,s.y).rot(-N.rotation());v=O.x,w=O.y}const _=m.parentId,C=this.getSortedChildIdsForParent(_),I=C.indexOf(m.id),T=C[I+1],P=T?this.getShape(T):null,k=P?_p(m.index,P.index):Vi(m.index);g.push({...m,id:x,x:m.x+v,y:m.y+w,index:k,parentId:c.get(m.parentId)??m.parentId})}return{shapesToCreate:g,bindingsToCreate:f}});if(d.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){Ag(this);return}if(this.createShapes(d),this.createBindings(u),this.setSelectedShapes(Re(i.map(p=>c.get(p)))),s!==void 0){const p=this.getSelectionPageBounds(),f=this.getViewportPageBounds();p&&!f.contains(p)&&this.centerOnPoint(p.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(n,s){const i=typeof n[0]=="string"?n:n.map(c=>c.id);if(i.length===0)return this;if(this.getInstanceState().isReadonly)return this;const r=this.getCurrentPageId();if(s===r)return this;if(!this.store.has(s))return this;const o=this.getContentFromCurrentPage(i);if(!o)return this;if(this.getPageShapeIds(s).size+o.shapes.length>this.options.maxShapesPerPage)return Ag(this,s),this;const l=this.getCamera().z;return this.run(()=>{this.deleteShapes(i),this.setCurrentPage(s),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(o,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:l}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(n){const s=typeof n[0]=="string"?n:n.map(l=>l.id);if(this.getInstanceState().isReadonly||s.length===0)return this;let i=!0,r=!0;const o=[];for(const l of s){const c=this.getShape(l);c&&(o.push(c),c.isLocked?r=!1:i=!1)}return this.run(()=>{r?(this.updateShapes(o.map(l=>({id:l.id,type:l.type,isLocked:!0}))),this.setSelectedShapes([])):i?this.updateShapes(o.map(l=>({id:l.id,type:l.type,isLocked:!1}))):this.updateShapes(o.map(l=>({id:l.id,type:l.type,isLocked:!0})))}),this}sendToBack(n){const s=typeof n[0]=="string"?n:n.map(r=>r.id),i=Ng(this,"toBack",s);return i&&this.updateShapes(i),this}sendBackward(n){const s=typeof n[0]=="string"?n:n.map(r=>r.id),i=Ng(this,"backward",s);return i&&this.updateShapes(i),this}bringForward(n){const s=typeof n[0]=="string"?n:n.map(r=>r.id),i=Ng(this,"forward",s);return i&&this.updateShapes(i),this}bringToFront(n){const s=typeof n[0]=="string"?n:n.map(r=>r.id),i=Ng(this,"toFront",s);return i&&this.updateShapes(i),this}flipShapes(n,s){const i=typeof n[0]=="string"?n:n.map(l=>l.id);if(this.getInstanceState().isReadonly)return this;let r=Re(i.map(l=>this.getShape(l)));if(!r.length)return this;r=Re(r.map(l=>this.isShapeOfType(l,"group")?this.getSortedChildIdsForParent(l.id).map(c=>this.getShape(c)):l).flat());const o=de.Common(Re(r.map(l=>this.getShapePageBounds(l)))).center;return this.run(()=>{for(const l of r){const c=this.getShapeGeometry(l).bounds,d=this.getShapePageTransform(l.id);d&&this.resizeShape(l.id,{x:s==="horizontal"?-1:1,y:s==="vertical"?-1:1},{initialBounds:c,initialPageTransform:d,initialShape:l,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(l).isAspectRatioLocked(l),scaleOrigin:o,scaleAxisRotation:0})}}),this}stackShapes(n,s,i){const r=typeof n[0]=="string"?n:n.map(x=>x.id);if(this.getInstanceState().isReadonly)return this;const o=r.map(x=>this.getShape(x)).filter(x=>x?this.getShapeUtil(x).canBeLaidOut(x):!1),l=o.length;if(i===0&&l<3||l<2)return this;const c=Object.fromEntries(o.map(x=>[x.id,this.getShapePageBounds(x)]));let d,u,h,p;s==="horizontal"?(d="x",u="minX",h="maxX",p="width"):(d="y",u="minY",h="maxY",p="height");let f;if(i===0){const x=[];o.sort((v,w)=>c[v.id][u]-c[w.id][u]);for(let v=0;v<l-1;v++){const w=o[v],_=o[v+1],C=c[w.id],T=c[_.id][u]-C[h],P=x.find(k=>k.gap===T);P?P.count++:x.push({gap:T,count:1})}let m=0;x.forEach(v=>{v.count>m&&(m=v.count,f=v.gap)}),m===1&&(f=Math.max(0,x.reduce((v,w)=>v+w.gap*w.count,0)/(l-1)))}else f=i;const g=[];let y=c[o[0].id][h];return o.forEach((x,m)=>{var I,T;if(m===0)return;const v={x:0,y:0};v[d]=y+f-c[x.id][d];const w=this.getShapeParent(x),_=w?E.Rot(v,-this.getShapePageTransform(w).decompose().rotation):v,C=(T=(I=this.getShapeUtil(x)).onTranslateStart)==null?void 0:T.call(I,x);g.push(C?{...C,[d]:x[d]+_[d]}:{id:x.id,type:x.type,[d]:x[d]+_[d]}),y+=c[x.id][p]+f}),this.updateShapes(g),this}packShapes(n,s){var T,P;const i=typeof n[0]=="string"?n:n.map(k=>k.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const r=i.map(k=>this.getShape(k)).filter(k=>k?this.getShapeUtil(k).canBeLaidOut(k):!1),o={},l={};let c,d,u=0;for(let k=0;k<r.length;k++)c=r[k],d=this.getShapePageBounds(c),o[c.id]=d,l[c.id]=d.clone(),u+=d.width*d.height;const h=de.Common(Re(Object.values(o))),p=h.width;r.sort((k,N)=>o[N.id].height-o[k.id].height);const f=Math.max(Math.ceil(Math.sqrt(u/.95)),p),g=[new de(h.x,h.y,f,1/0)];let y=0,x=0,m,v;for(let k=0;k<r.length;k++){c=r[k],d=l[c.id];for(let N=g.length-1;N>=0;N--)if(m=g[N],!(d.width>m.width||d.height>m.height)){d.x=m.x,d.y=m.y,x=Math.max(x,d.maxY),y=Math.max(y,d.maxX),d.width===m.width&&d.height===m.height?(v=g.pop(),N<g.length&&(g[N]=v)):d.height===m.height?(m.x+=d.width+s,m.width-=d.width+s):d.width===m.width?(m.y+=d.height+s,m.height-=d.height+s):(g.push(new de(m.x+(d.width+s),m.y,m.width-(d.width+s),d.height)),m.y+=d.height+s,m.height-=d.height+s);break}}const w=de.Common(Object.values(l)),_=E.Sub(h.center,w.center);let C;const I=[];for(let k=0;k<r.length;k++){c=r[k],d=o[c.id],C=l[c.id];const N=E.Sub(C.point,d.point).add(_),O=this.getShapeParentTransform(c);O&&N.rot(-O.rotation());const R={id:c.id,type:c.type,x:c.x+N.x,y:c.y+N.y},j=(P=(T=this.getShapeUtil(c)).onTranslateStart)==null?void 0:P.call(T,{...c,...R});j?I.push({...R,...j}):I.push(R)}return I.length&&this.updateShapes(I),this}alignShapes(n,s){const i=typeof n[0]=="string"?n:n.map(d=>d.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const r=Re(i.map(d=>this.getShape(d))),o=Object.fromEntries(r.map(d=>[d.id,this.getShapePageBounds(d)])),l=de.Common(Re(Object.values(o))),c=[];return r.forEach(d=>{const u=o[d.id];if(!u)return;const h={x:0,y:0};switch(s){case"top":{h.y=l.minY-u.minY;break}case"center-vertical":{h.y=l.midY-u.minY-u.height/2;break}case"bottom":{h.y=l.maxY-u.minY-u.height;break}case"left":{h.x=l.minX-u.minX;break}case"center-horizontal":{h.x=l.midX-u.minX-u.width/2;break}case"right":{h.x=l.maxX-u.minX-u.width;break}}const p=this.getShapeParent(d),f=p?E.Rot(h,-this.getShapePageTransform(p).decompose().rotation):h;c.push(this.getChangesToTranslateShape(d,E.Add(d,f)))}),this.updateShapes(c),this}distributeShapes(n,s){const i=typeof n[0]=="string"?n:n.map(w=>w.id);if(this.getInstanceState().isReadonly)return this;if(i.length<3)return this;const r=i.length,o=Re(i.map(w=>this.getShape(w))),l=Object.fromEntries(o.map(w=>[w.id,this.getShapePageBounds(w)]));let c,d,u,h,p;s==="horizontal"?(c="x",d="minX",u="maxX",h="midX",p="width"):(c="y",d="minY",u="maxY",h="midY",p="height");const f=[],g=o.sort((w,_)=>l[w.id][d]-l[_.id][d])[0],y=o.sort((w,_)=>l[_.id][u]-l[w.id][u])[0],x=l[g.id][h],m=(l[y.id][h]-x)/(r-1),v=x+m;return o.filter(w=>w!==g&&w!==y).sort((w,_)=>l[w.id][h]-l[_.id][h]).forEach((w,_)=>{const C={x:0,y:0};C[c]=v+m*_-l[w.id][p]/2-l[w.id][c];const I=this.getShapeParent(w),T=I?E.Rot(C,-this.getShapePageTransform(I).rotation()):C;f.push(this.getChangesToTranslateShape(w,E.Add(w,T)))}),this.updateShapes(f),this}stretchShapes(n,s){const i=typeof n[0]=="string"?n:n.map(d=>d.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const r=Re(i.map(d=>this.getShape(d))),o=Object.fromEntries(i.map(d=>[d,this.getShapeGeometry(d).bounds])),l=Object.fromEntries(i.map(d=>[d,this.getShapePageBounds(d)])),c=de.Common(Re(Object.values(l)));switch(s){case"vertical":{this.run(()=>{for(const d of r){if(this.getShapePageTransform(d).rotation()%tt)continue;const h=o[d.id],p=l[d.id],f=new E(0,c.minY-p.minY),g=this.getShapeParentTransform(d);g&&f.rot(-g.rotation());const{x:y,y:x}=E.Add(f,d);this.updateShapes([{id:d.id,type:d.type,x:y,y:x}]);const m=new E(1,c.height/p.height);this.resizeShape(d.id,m,{initialBounds:h,scaleOrigin:new E(p.center.x,c.minY),isAspectRatioLocked:this.getShapeUtil(d).isAspectRatioLocked(d),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const d of r){const u=o[d.id],h=l[d.id];if(this.getShapePageTransform(d).rotation()%tt)continue;const f=new E(c.minX-h.minX,0),g=this.getShapeParentTransform(d);g&&f.rot(-g.rotation());const{x:y,y:x}=E.Add(f,d);this.updateShapes([{id:d.id,type:d.type,x:y,y:x}]);const m=new E(c.width/h.width,1);this.resizeShape(d.id,m,{initialBounds:u,scaleOrigin:new E(c.minX,h.center.y),isAspectRatioLocked:this.getShapeUtil(d).isAspectRatioLocked(d),scaleAxisRotation:0})}});break}}return this}resizeShape(n,s,i={}){var g,y,x;const r=typeof n=="string"?n:n.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(s.x)||(s=new E(1,s.y)),Number.isFinite(s.y)||(s=new E(s.x,1));const o=i.initialShape??this.getShape(r);if(!o)return this;const l=i.scaleOrigin??((g=this.getShapePageBounds(r))==null?void 0:g.center);if(!l)return this;const c=i.initialPageTransform?ve.Cast(i.initialPageTransform):this.getShapePageTransform(r);if(!c)return this;const d=c.rotation();if(d==null)return this;const u=i.scaleAxisRotation??d,h=i.initialBounds??this.getShapeGeometry(r).bounds;if(!h)return this;const p=i.isAspectRatioLocked??this.getShapeUtil(o).isAspectRatioLocked(o);if(!BF(d,u))return this._resizeUnalignedShape(r,s,{...i,initialBounds:h,scaleOrigin:l,scaleAxisRotation:u,initialPageTransform:c,isAspectRatioLocked:p,initialShape:o});const f=this.getShapeUtil(o);if(p&&(Math.abs(s.x)>Math.abs(s.y)?s=new E(s.x,Math.sign(s.y)*Math.abs(s.x)):s=new E(Math.sign(s.x)*Math.abs(s.y),s.y)),f.onResize&&f.canResize(o)){const m=this._scalePagePoint(ve.applyToPoint(c,new E(0,0)),l,s,u),v=this.getPointInParentSpace(o.id,m),w=new E(s.x,s.y),_=Ra((d-u)%Math.PI,0);w.x=_?s.x:s.y,w.y=_?s.y:s.x;const C=ve.applyToPoint(c,new E),{x:I,y:T}=this.getPointInParentSpace(o.id,C);let P=o;i.skipStartAndEndCallbacks||(P=fr(o,((y=f.onResizeStart)==null?void 0:y.call(f,o))??void 0)),P=fr(P,{id:r,type:o.type,x:v.x,y:v.y,...f.onResize({...o,x:I,y:T},{newPoint:v,handle:i.dragHandle??"bottom_right",mode:i.mode??"scale_shape",scaleX:w.x,scaleY:w.y,initialBounds:h,initialShape:o})}),i.skipStartAndEndCallbacks||(P=fr(P,((x=f.onResizeEnd)==null?void 0:x.call(f,o,P))??void 0)),this.updateShapes([P])}else{const m=ve.applyToPoint(c,h.center),v=this._scalePagePoint(m,l,s,u),w=this.getPointInParentSpace(o.id,m),_=this.getPointInParentSpace(o.id,v),C=E.Sub(_,w);this.updateShapes([{id:r,type:o.type,x:o.x+C.x,y:o.y+C.y}])}return this}_scalePagePoint(n,s,i,r){const o=E.RotWith(n,s,-r).sub(s),l=E.MulV(o,i);return E.Add(l,s).rotWith(s,r)}_resizeUnalignedShape(n,s,i){const{type:r}=i.initialShape,o=new E(s.x,s.y);if(Math.abs(s.x)>Math.abs(s.y)?o.x=Math.sign(s.x)*Math.abs(s.y):o.y=Math.sign(s.y)*Math.abs(s.x),this.resizeShape(n,o,{initialShape:i.initialShape,initialBounds:i.initialBounds,isAspectRatioLocked:i.isAspectRatioLocked}),Math.sign(s.x)*Math.sign(s.y)<0){let{rotation:m}=ve.Decompose(i.initialPageTransform);m-=2*m,this.updateShapes([{id:n,type:r,rotation:m}])}const l=ve.applyToPoint(i.initialPageTransform,i.initialBounds.center),c=this._scalePagePoint(l,i.scaleOrigin,s,i.scaleAxisRotation),d=this.getShapePageBounds(n),u=this.getShapePageTransform(n),h=d.center,p=u.point();if(!h||!p)return this;const f=E.Sub(c,h),g=E.Add(p,f),{x:y,y:x}=this.getPointInParentSpace(n,g);return this.updateShapes([{id:n,type:r,x:y,y:x}]),this}getInitialMetaForShape(n){return{}}createShape(n){return this.createShapes([n]),this}createShapes(n){if(!Array.isArray(n))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getInstanceState().isReadonly)return this;if(n.length<=0)return this;const s=this.getCurrentPageShapeIds();if(n.length+s.size>this.options.maxShapesPerPage)return Ag(this),this;const r=this.getFocusedGroupId();return this.run(()=>{var h,p;const o=this.getCurrentPageShapesSorted(),l=n.map(f=>{if(f.id||(f={id:it(),...f}),!f.parentId||!(this.store.has(f.parentId)||n.some(g=>g.id===f.parentId))){let g=this.getFocusedGroupId();for(let x=o.length-1;x>=0;x--){const m=o[x];if(this.getShapeUtil(m).canReceiveNewChildrenOfType(m,f.type)&&this.isPointInShape(m,{x:f.x??0,y:f.y??0},{margin:0,hitInside:!0})){g=m.id;break}}const y=f.parentId;if(g===f.id&&(g=r),g!==y&&(f={...f},f.parentId=g,Ps(g))){const x=this.getPointInShapeSpace(this.getShape(g),{x:f.x??0,y:f.y??0});f.x=x.x,f.y=x.y,f.rotation=-this.getShapePageTransform(g).rotation()+(f.rotation??0)}}return f}),c=new Map,d=[],{opacityForNextShape:u}=this.getInstanceState();for(const f of l){const g=this.getShapeUtil(f);let y=f.index;if(!y){const w=f.parentId??r;c.has(w)||c.set(w,this.getHighestIndexForParent(w)),y=c.get(w),c.set(w,Vi(y))}const x=g.getDefaultProps();for(const[w,_]of this.styleProps[f.type])x[_]=this.getStyleForNextShape(w);let m=this.store.schema.types.shape.create({...f,index:y,opacity:f.opacity??u,parentId:f.parentId??r,props:"props"in f?{...x,...f.props}:x});if(m.index===void 0)throw Error("no index!");const v=(p=(h=this.getShapeUtil(m)).onBeforeCreate)==null?void 0:p.call(h,m);v&&(m=v),d.push(m)}d.forEach(f=>{f.meta={...this.getInitialMetaForShape(f),...f.meta}}),this.store.put(d)}),this}animateShape(n,s={animation:Jb}){return this.animateShapes([n],s)}animateShapes(n,s={animation:Jb}){if(!s.animation)return this;const{duration:i=500,easing:r=un.linear}=s.animation,o=Rt();let l=i,c;const d=[];let u,h;for(let f=0,g=n.length;f<g;f++){if(u=n[f],!u)continue;const y=this.getShape(u.id);y&&(h={start:yt(y),end:fr(yt(y),u)},d.push(h),this.animatingShapes.set(y.id,o))}const p=f=>{var m,v;if(l-=f,l<0){const{animatingShapes:w}=this,_=n.filter(C=>C&&w.get(C.id)===o);_.length&&this.updateShapes(_),this.off("tick",p);return}c=r(1-l/i);const{animatingShapes:g}=this,y=[];let x;for(let w=0,_=d.length;w<_;w++){const{start:C,end:I}=d[w];x=g.get(C.id),x===o&&y.push({...I,x:C.x+(I.x-C.x)*c,y:C.y+(I.y-C.y)*c,opacity:C.opacity+(I.opacity-C.opacity)*c,rotation:C.rotation+(I.rotation-C.rotation)*c,props:((v=(m=this.getShapeUtil(I)).getInterpolatedProps)==null?void 0:v.call(m,C,I,c))??I.props})}this._updateShapes(y)};return this.on("tick",p),this}groupShapes(n,s={}){var y;const{groupId:i=it(),select:r=!0}=s;if(!Array.isArray(n))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const o=typeof n[0]=="string"?n:n.map(x=>x.id);if(o.length<=1)return this;const l=Re((this._shouldIgnoreShapeLock?o:this._getUnlockedShapeIds(o)).map(x=>this.getShape(x))),c=l.sort(Xn).map(x=>x.id),d=de.Common(Re(l.map(x=>this.getShapePageBounds(x)))),{x:u,y:h}=d.point,p=this.findCommonAncestor(l)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const f=l.filter(x=>x.parentId===p).sort(Xn),g=(y=f[f.length-1])==null?void 0:y.index;return this.run(()=>{this.createShapes([{id:i,type:"group",parentId:p,index:g,x:u,y:h,opacity:1,props:{}}]),this.reparentShapes(c,i),r&&this.select(i)}),this}ungroupShapes(n,s={}){if(this.getInstanceState().isReadonly)return this;const{select:i=!0}=s,r=typeof n[0]=="string"?n:n.map(d=>d.id),o=Re((this._shouldIgnoreShapeLock?r:this._getUnlockedShapeIds(r)).map(d=>this.getShape(d)));if(o.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const l=new Set,c=[];return o.forEach(d=>{this.isShapeOfType(d,"group")?c.push(d):l.add(d.id)}),c.length===0?this:(this.run(()=>{let d;for(let u=0,h=c.length;u<h;u++){d=c[u];const p=this.getSortedChildIdsForParent(d.id);for(let f=0,g=p.length;f<g;f++)l.add(p[f]);this.reparentShapes(p,d.parentId,d.index)}this.deleteShapes(c.map(u=>u.id)),i&&this.select(...l)}),this)}updateShape(n){return this.updateShapes([n]),this}updateShapes(n){const s=Array(n.length);for(let i=0,r=n.length;i<r;i++){const o=n[i];if(!o)continue;const l=this.getShape(o.id);if(l){if(!this._shouldIgnoreShapeLock){if(l.isLocked){if(!(Object.hasOwn(o,"isLocked")&&!o.isLocked))continue}else if(this.isShapeOrAncestorLocked(l))continue}this.animatingShapes.delete(o.id),s.push(o)}}return this._updateShapes(s),this}_getUnlockedShapeIds(n){return n.filter(s=>{var i;return!((i=this.getShape(s))!=null&&i.isLocked)})}deleteShapes(n){if(this.getInstanceState().isReadonly)return this;if(!Array.isArray(n))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const s=typeof n[0]=="string"?n:n.map(o=>o.id),i=this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s);if(i.length===0)return this;const r=new Set(i);for(const o of i)this.visitDescendants(o,l=>{r.add(l)});return this.run(()=>this.store.remove([...r]))}deleteShape(n){return this.deleteShapes([typeof n=="string"?n:n.id]),this}_extractSharedStyles(n,s){if(this.isShapeOfType(n,"group")){const i=this._parentIdsToChildIds.get()[n.id];if(!i)return;for(let r=0,o=i.length;r<o;r++)this._extractSharedStyles(this.getShape(i[r]),s)}else for(const[i,r]of this.styleProps[n.type])s.applyValue(i,Ms(n.props,r))}_getSelectionSharedStyles(){const n=this.getSelectedShapes(),s=new Q_;for(const i of n)this._extractSharedStyles(i,s);return s}getStyleForNextShape(n){const s=this.getInstanceState().stylesForNextShape[n.id];return s===void 0?n.defaultValue:s}getShapeStyleIfExists(n,s){const i=this.styleProps[n.type].get(s);if(i!==void 0)return Ms(n.props,i)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const n=this.root.getCurrent(),s=new Q_;if(!n)return s;if(n.shapeType)for(const i of this.styleProps[n.shapeType].keys())s.applyValue(i,this.getStyleForNextShape(i));return s}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const n=[],s=r=>{const o=this.getShape(r);if(o)if(this.isShapeOfType(o,"group"))for(const l of this.getSortedChildIdsForParent(o.id))s(l);else n.push(o)};for(const r of this.getSelectedShapeIds())s(r);let i=null;for(const r of n)if(i===null)i=r.opacity;else if(i!==r.opacity)return{type:"mixed"};if(i!==null)return{type:"shared",value:i}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(n,s){return this.updateInstanceState({opacityForNextShape:n},s),this}setOpacityForSelectedShapes(n){const s=this.getSelectedShapes();if(s.length>0){const i=[],r=o=>{if(this.isShapeOfType(o,"group")){const l=this.getSortedChildIdsForParent(o);for(const c of l)r(this.getShape(c))}else i.push(o)};for(const o of s)r(o);this.updateShapes(i.map(o=>({id:o.id,type:o.type,opacity:n})))}return this}setStyleForNextShapes(n,s,i){const r=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...r,[n.id]:s}},i),this}setStyleForSelectedShapes(n,s){const i=this.getSelectedShapes();if(i.length>0){const r=[],o=l=>{if(this.isShapeOfType(l,"group")){const c=this.getSortedChildIdsForParent(l.id);for(const d of c)o(this.getShape(d))}else{const c=this.getShapeUtil(l),d=this.styleProps[l.type].get(n);if(d){const u={id:l.id,type:l.type,props:{[d]:s}};r.push({util:c,originalShape:l,updatePartial:u})}}};for(const l of i)o(l);this.updateShapes(r.map(({updatePartial:l})=>l))}return this}registerExternalAssetHandler(n,s){return this.externalAssetContentHandlers[n]=s,this}async getAssetForExternalContent(n){var s,i;return await((i=(s=this.externalAssetContentHandlers)[n.type])==null?void 0:i.call(s,n))}hasExternalAssetHandler(n){return!!this.externalAssetContentHandlers[n]}registerExternalContentHandler(n,s){return this.externalContentHandlers[n]=s,this}async putExternalContent(n){var s,i;return(i=(s=this.externalContentHandlers)[n.type])==null?void 0:i.call(s,n)}getContentFromCurrentPage(n){const s=typeof n[0]=="string"?n:n.map(r=>r.id);if(!s||s.length===0)return;const i=this.getShapeAndDescendantIds(s);return AN(this,i,r=>{const o=[];for(const h of r){const p=this.getBinding(h);p&&o.push(p)}const l=[],c=[];for(const h of i){const p=this.getShape(h);if(!p)continue;if(!i.has(p.parentId)){const g=this.getShapePageTransform(p.id),y=g.point();c.push({...p,x:y.x,y:y.y,rotation:g.rotation(),parentId:this.getCurrentPageId()}),l.push(p.id)}else c.push(p)}const d=[],u=new Set;for(const h of c){if(!("assetId"in h.props))continue;const p=h.props.assetId;if(!p||u.has(p))continue;u.add(p);const f=this.getAsset(p);f&&d.push(f)}return{schema:this.store.schema.serialize(),shapes:c,rootShapeIds:l,bindings:o,assets:d}})}async resolveAssetsInContent(n){if(!n)return;const s=[];return await Promise.allSettled(n.assets.map(async i=>{var r,o;if((i.type==="image"||i.type==="video")&&!((r=i.props.src)!=null&&r.startsWith("data:image"))&&!((o=i.props.src)!=null&&o.startsWith("http"))){const l=yt(i),c=await this.store.props.assets.resolve(i,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});l.props.src=await Dl.blobToDataUrl(await Ur(c).then(d=>d.blob())),s.push(l)}else s.push(i)})),n.assets=s,n}putContentOntoCurrentPage(n,s={}){var O,R;if(this.getInstanceState().isReadonly)return this;if(!n.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:i=!1,preserveIds:r=!1,preservePosition:o=!1}=s;let{point:l=void 0}=s;const c=this.getCurrentPageId(),{rootShapeIds:d}=n,u=[],h=[],p=[],f={store:{...Object.fromEntries(n.assets.map(j=>[j.id,j])),...Object.fromEntries(n.shapes.map(j=>[j.id,j])),...Object.fromEntries(((O=n.bindings)==null?void 0:O.map(j=>[j.id,j]))??[])},schema:n.schema},g=this.store.schema.migrateStoreSnapshot(f);if(g.type==="error")throw Error("Could not put content: could not migrate content");for(const j of Object.values(g.value))switch(j.typeName){case"asset":{u.push(j);break}case"shape":{h.push(j);break}case"binding":{p.push(j);break}}const y=new Map(r?h.map(j=>[j.id,j.id]):h.map(j=>[j.id,it()])),x=new Map(r?p.map(j=>[j.id,j.id]):p.map(j=>[j.id,Ll()]));let m=this.getCurrentPageId(),v=1/0,w=[];for(const j of this.getSelectedShapes()){if(v===0)break;const A=this.isShapeOfType(j,"frame"),B=this.getShapeAncestors(j);A&&B.push(j);const L=A?B.length+1:B.length;if(L<v)v=L,w=B,m=A?j.id:j.parentId;else if(L===v){if(w.length!==B.length)throw Error(`Ancestors: ${w.length} !== ${B.length}`);if(w.length===0){m=c;break}else{m=c;for(let $=0;$<w.length&&B[$]===w[$];$++)m=B[$].id}}}let _=!1;if(!Ts(m)){const j=this.getShape(m);if(j){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(j)))m=c;else if(d.length===1){const A=h.find(B=>B.id===d[0]);this.isShapeOfType(j,"frame")&&this.isShapeOfType(A,"frame")&&A.props.w===(j==null?void 0:j.props.w)&&A.props.h===(j==null?void 0:j.props.h)&&(_=!0)}}else m=c}_||(_=y.has(m)),_&&(m=this.getShape(m).parentId);let C=this.getHighestIndexForParent(m);const I=[],T=h.map(j=>{const A=y.get(j.id),B={...j,id:A};return d.includes(j.id)&&(B.parentId=c,I.push(B)),y.has(B.parentId)?B.parentId=y.get(j.parentId):(d.push(B.id),B.index=C,C=Vi(C)),B});if(T.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return Ag(this),this;const P=p.map(j=>({...j,id:wi(x.get(j.id)),fromId:wi(y.get(j.fromId)),toId:wi(y.get(j.toId))})),k=[],N=[];for(const j of u)this.store.has(j.id)||((j.type==="image"||j.type==="video")&&((R=j.props.src)!=null&&R.startsWith("data:image"))&&(N.push(yt(j)),j.props.src=null),k.push(j));return Promise.allSettled(N.map(async j=>{const A=await yse(j.props.src,j.props.name,j.props.mimeType??"image/png"),B=await this.getAssetForExternalContent({type:"file",file:A});if(!B){this.deleteAssets([j.id]);return}this.updateAssets([{...B,id:j.id}])})),this.run(()=>{k.length>0&&this.createAssets(k),this.createShapes(T),this.createBindings(P),i&&this.select(...I.map($=>$.id)),m!==c&&this.reparentShapes(I.map($=>$.id),m);const j=T.map($=>this.getShape($.id)),A=de.Common(j.map($=>this.getShapePageBounds($)));if(l===void 0)if(Ts(m)){const $=this.getViewportPageBounds();o||$.includes(de.From(A))?l=A.center:l=$.center}else{const $=this.getShape(m);l=ve.applyToPoint(this.getShapePageTransform($),this.getShapeGeometry($).bounds.center)}if(I.length===1){const $=I[0];if(this.isShapeOfType($,"frame"))for(;this.getShapesAtPoint(l).some(M=>this.isShapeOfType(M,"frame")&&M.props.w===$.props.w&&M.props.h===$.props.h);)l.x+=A.w+16}const B=de.Common(Re(I.map(({id:$})=>this.getShapePageBounds($)))).center,L=E.Sub(l,B);this.updateShapes(I.map(({id:$})=>{const M=this.getShape($),D=this.getShapeParentTransform($).decompose().rotation,U=E.Rot(L,-D);return{id:M.id,type:M.type,x:M.x+U.x,y:M.y+U.y}}))}),this}async getSvgElement(n,s={}){const i=await jse(this,n,s);if(!i)return;const r=document.createDocumentFragment(),o=ZE(r);Br.flushSync(()=>{o.render(i.jsx)});const l=r.firstElementChild;return xt(l instanceof SVGSVGElement,"Expected an SVG element"),o.unmount(),{svg:l,width:i.width,height:i.height}}async getSvgString(n,s={}){const i=await this.getSvgElement(n,s);return i?{svg:new XMLSerializer().serializeToString(i.svg),width:i.width,height:i.height}:void 0}async getSvg(n,s={}){const i=await this.getSvgElement(n,s);if(i)return i.svg}_updateInputsFromEvent(n){const{pointerVelocity:s,previousScreenPoint:i,previousPagePoint:r,currentScreenPoint:o,currentPagePoint:l}=this.inputs,{screenBounds:c}=this.store.unsafeGetWithoutCapture(ls),{x:d,y:u,z:h}=bg(()=>this.getCamera()),p=n.point.x-c.x,f=n.point.y-c.y,g=n.point.z??.5;i.setTo(o),r.setTo(l),o.set(p,f);const y=p/h-d,x=f/h-u;isFinite(y)&&isFinite(x)&&l.set(y,x,g),this.inputs.isPen=n.type==="pointer"&&n.isPen,(n.name==="pointer_down"||this.inputs.isPinching)&&(s.set(0,0),this.inputs.originScreenPoint.setTo(o),this.inputs.originPagePoint.setTo(l)),this.run(()=>{var m;this.store.put([{id:iv,typeName:"pointer",x:l.x,y:l.y,lastActivityTimestamp:n.type==="pointer"&&n.pointerId===oN.CAMERA_MOVE?((m=this.store.unsafeGetWithoutCapture(iv))==null?void 0:m.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:n=!0}={}){return this.getIsFocused()?this:(n&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:n=!0}={}){return this.getIsFocused()?(n?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getSnapshot(){return lse(this.store)}loadSnapshot(n){return C5(this.store,n),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_flushEventsForTick(n){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const s=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const i of s)this._flushEventForTick(i)}n>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:n}),this.scribbles.tick(n)})}maybeTrackPerformance(n){Kt.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(n),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}ge([te],le.prototype,"getCanUndo");ge([te],le.prototype,"getCanRedo");ge([te],le.prototype,"getPath");ge([te],le.prototype,"getCurrentTool");ge([te],le.prototype,"getCurrentToolId");ge([te],le.prototype,"getDocumentSettings");ge([te],le.prototype,"getInstanceState");ge([te],le.prototype,"getOpenMenus");ge([te],le.prototype,"getIsMenuOpen");ge([te],le.prototype,"getPageStates");ge([te],le.prototype,"_getPageStatesQuery");ge([te],le.prototype,"getCurrentPageState");ge([te],le.prototype,"_getCurrentPageStateId");ge([te],le.prototype,"getSelectedShapeIds");ge([te],le.prototype,"getSelectedShapes");ge([te],le.prototype,"getOnlySelectedShapeId");ge([te],le.prototype,"getOnlySelectedShape");ge([te],le.prototype,"getSelectionPageBounds");ge([te],le.prototype,"getSelectionRotation");ge([te],le.prototype,"getSelectionRotatedPageBounds");ge([te],le.prototype,"getSelectionRotatedScreenBounds");ge([te],le.prototype,"getFocusedGroupId");ge([te],le.prototype,"getFocusedGroup");ge([te],le.prototype,"getEditingShapeId");ge([te],le.prototype,"getEditingShape");ge([te],le.prototype,"getHoveredShapeId");ge([te],le.prototype,"getHoveredShape");ge([te],le.prototype,"getHintingShapeIds");ge([te],le.prototype,"getHintingShape");ge([te],le.prototype,"getErasingShapeIds");ge([te],le.prototype,"getErasingShapes");ge([te],le.prototype,"_unsafe_getCameraId");ge([te],le.prototype,"getCamera");ge([te],le.prototype,"getViewportPageBoundsForFollowing");ge([te],le.prototype,"getCameraForFollowing");ge([te],le.prototype,"getZoomLevel");ge([te],le.prototype,"getViewportScreenBounds");ge([te],le.prototype,"getViewportScreenCenter");ge([te],le.prototype,"getViewportPageBounds");ge([te],le.prototype,"_getCollaboratorsQuery");ge([te],le.prototype,"getCollaborators");ge([te],le.prototype,"getCollaboratorsOnCurrentPage");ge([te],le.prototype,"getRenderingShapes");ge([te],le.prototype,"_getAllPagesQuery");ge([te],le.prototype,"getPages");ge([te],le.prototype,"getCurrentPageId");ge([te],le.prototype,"getCurrentPageShapeIdsSorted");ge([te],le.prototype,"_getAllAssetsQuery");ge([te],le.prototype,"_getShapeGeometryCache");ge([te],le.prototype,"_getShapeHandlesCache");ge([te],le.prototype,"_getShapePageTransformCache");ge([te],le.prototype,"_getShapePageBoundsCache");ge([te],le.prototype,"_getShapeClipPathCache");ge([te],le.prototype,"_getShapeMaskCache");ge([te],le.prototype,"_getShapeMaskedPageBoundsCache");ge([te],le.prototype,"_notVisibleShapes");ge([te],le.prototype,"getCulledShapes");ge([te],le.prototype,"getCurrentPageBounds");ge([te],le.prototype,"getCurrentPageShapes");ge([te],le.prototype,"getCurrentPageShapesSorted");ge([te],le.prototype,"getCurrentPageRenderingShapesSorted");ge([te],le.prototype,"_getBindingsIndexCache");ge([te],le.prototype,"_getSelectionSharedStyles");ge([te({isEqual:(t,e)=>t.equals(e)})],le.prototype,"getSharedStyles");ge([te],le.prototype,"getSharedOpacity");ge([te],le.prototype,"getIsFocused");function Ag(t,e=t.getCurrentPageId()){const n=t.getPage(e).name;t.emit("max-shapes",{name:n,pageId:e,count:t.options.maxShapesPerPage})}function fr(t,e){if(!e)return t;let n=null;const s=Object.entries(e);for(let i=0,r=s.length;i<r;i++){const[o,l]=s[i];if(l!==void 0&&!(o==="id"||o==="type"||o==="typeName")&&l!==t[o]){if(n||(n={...t}),o==="props"||o==="meta"){n[o]={...t[o]};for(const[c,d]of Object.entries(l))d!==void 0&&(n[o][c]=d);continue}n[o]=l}}return n||t}function R5(t,e,n){const s=t.getShape(e);if(!s)return;n.push(s);const i=t.getSortedChildIdsForParent(e);for(let r=0,o=i.length;r<o;r++)R5(t,i[r],n)}function AN(t,e,n){let s;if(t.run(()=>{const i=t.store.extractingChanges(()=>{const r=new Set,o=new Set;for(const l of e)if(t.getShape(l))for(const d of t.getBindingsInvolvingShape(l)){const u=e.has(d.fromId),h=e.has(d.toId);if(u&&h){r.add(d.id);continue}(!u||!h)&&o.add(d.id)}t.deleteBindings([...o],{isolateShapes:!0});try{s=Na.ok(n(r))}catch(l){s=Na.err(l)}});t.store.applyDiff(z_(i))},{history:"ignore"}),s.ok)return s.value;throw s.error}function RN(t,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:n,y:s}}=e.constraints,i=t.getViewportScreenBounds(),r=de.From(e.constraints.bounds),o=(i.w-n*2)/r.w,l=(i.h-s*2)/r.h;return{zx:o,zy:l}}function Sf(){const t=K(),e=N5();return Z("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??t.user.getIsDarkMode(),[e,t])}const MN="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",ON="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",Rg='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function ea(t,e,n,s,i,r=16,o=16){const l=(-n-e)*(Ze/180),c=Math.sin(l),d=Math.cos(l),u=1*d-1*c,h=1*c+1*d;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${h}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+n} 16 16)${s?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+t.replaceAll('"',"'")+`</g></svg>") ${r} ${o}, pointer`}const cie=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],die={none:()=>"none","ew-resize":(t,e,n)=>ea(ON,t,0,e,n),"ns-resize":(t,e,n)=>ea(ON,t,90,e,n),"nesw-resize":(t,e,n)=>ea(MN,t,0,e,n),"nwse-resize":(t,e,n)=>ea(MN,t,90,e,n),"nwse-rotate":(t,e,n)=>ea(Rg,t,0,e,n),"nesw-rotate":(t,e,n)=>ea(Rg,t,90,e,n),"senw-rotate":(t,e,n)=>ea(Rg,t,180,e,n),"swne-rotate":(t,e,n)=>ea(Rg,t,270,e,n)};function Ks(t,e=0,n="black"){return die[t](Dee(e),!1,n)}function uie(){const t=K(),e=vn(),n=Sf();Aa("useCursor",()=>{const{type:s,rotation:i}=t.getInstanceState().cursor;if(cie.includes(s)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${s})`);return}e.style.setProperty("--tl-cursor",Ks(s,i,n?"white":"black"))},[t,e,n])}function hie(){const t=K(),e=vn(),n=Sf(),s=Z(Kt.forceSrgb);Oe.useEffect(()=>{n?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),s?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[t,e,s,n])}function M5(t){const e=S.useRef();return S.useLayoutEffect(()=>{e.current=t}),S.useDebugValue(t),S.useCallback((...n)=>{const s=e.current;return xt(s,"fn does not exist"),s(...n)},[])}function pie(){const[t,e]=S.useState(0);S.useEffect(()=>e(n=>n+1),[])}const fie=t=>t.props.src,gie={upload:(t,e)=>Dl.blobToDataUrl(e)};function mie(t){return"schema"in t&&t.schema?t.schema:_ee({shapes:"shapeUtils"in t&&t.shapeUtils?DN(P5(t.shapeUtils)):void 0,bindings:"bindingUtils"in t&&t.bindingUtils?DN(E5(t.bindingUtils)):void 0,migrations:"migrations"in t?t.migrations:void 0})}function hv({initialData:t,defaultName:e="",id:n,assets:s=gie,onMount:i,collaboration:r,...o}={}){const l=mie(o),c=new AT({id:n,schema:l,initialData:t,props:{defaultName:e,assets:{upload:s.upload,resolve:s.resolve??fie},onMount:d=>{xt(d instanceof le),i==null||i(d)},collaboration:r}});if(o.snapshot){if(t)throw new Error("Cannot provide both initialData and snapshot");C5(c,o.snapshot)}return c}function DN(t){return Object.fromEntries(t.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const yie=(t,e)=>e.some(n=>t instanceof n);let LN,FN;function vie(){return LN||(LN=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function xie(){return FN||(FN=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const O5=new WeakMap,eC=new WeakMap,D5=new WeakMap,iw=new WeakMap,QT=new WeakMap;function Sie(t){const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",o)},r=()=>{n(wo(t.result)),i()},o=()=>{s(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&O5.set(n,t)}).catch(()=>{}),QT.set(e,t),e}function bie(t){if(eC.has(t))return;const e=new Promise((n,s)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",o),t.removeEventListener("abort",o)},r=()=>{n(),i()},o=()=>{s(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",o),t.addEventListener("abort",o)});eC.set(t,e)}let tC={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return eC.get(t);if(e==="objectStoreNames")return t.objectStoreNames||D5.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return wo(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function wie(t){tC=t(tC)}function _ie(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const s=t.call(rw(this),e,...n);return D5.set(s,e.sort?e.sort():[e]),wo(s)}:xie().includes(t)?function(...e){return t.apply(rw(this),e),wo(O5.get(this))}:function(...e){return wo(t.apply(rw(this),e))}}function Cie(t){return typeof t=="function"?_ie(t):(t instanceof IDBTransaction&&bie(t),yie(t,vie())?new Proxy(t,tC):t)}function wo(t){if(t instanceof IDBRequest)return Sie(t);if(iw.has(t))return iw.get(t);const e=Cie(t);return e!==t&&(iw.set(t,e),QT.set(e,t)),e}const rw=t=>QT.get(t);function e1(t,e,{blocked:n,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(t,e),l=wo(o);return s&&o.addEventListener("upgradeneeded",c=>{s(wo(o.result),c.oldVersion,c.newVersion,wo(o.transaction),c)}),n&&o.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),l.then(c=>{r&&c.addEventListener("close",()=>r()),i&&c.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}function L5(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",s=>e(s.oldVersion,s)),wo(n).then(()=>{})}const Eie=["get","getKey","getAll","getAllKeys","count"],Tie=["put","add","delete","clear"],ow=new Map;function BN(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(ow.get(e))return ow.get(e);const n=e.replace(/FromIndex$/,""),s=e!==n,i=Tie.includes(n);if(!(n in(s?IDBIndex:IDBObjectStore).prototype)||!(i||Eie.includes(n)))return;const r=async function(o,...l){const c=this.transaction(o,i?"readwrite":"readonly");let d=c.store;return s&&(d=d.index(l.shift())),(await Promise.all([d[n](...l),i&&c.done]))[0]};return ow.set(e,r),r}wie(t=>({...t,get:(e,n,s)=>BN(e,n)||t.get(e,n,s),has:(e,n)=>!!BN(e,n)||t.has(e,n)}));const Iie="TLDRAW_DOCUMENT_v2",Pie="TLDRAW_ASSET_STORE_v1",F5="TLDRAW_DB_NAME_INDEX_v2",ze={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function B5(t){const e=Iie+t;return jie(e),await e1(e,4,{upgrade(n){n.objectStoreNames.contains(ze.Records)||n.createObjectStore(ze.Records),n.objectStoreNames.contains(ze.Schema)||n.createObjectStore(ze.Schema),n.objectStoreNames.contains(ze.SessionState)||n.createObjectStore(ze.SessionState),n.objectStoreNames.contains(ze.Assets)||n.createObjectStore(ze.Assets)}})}async function kie(t){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(p=>p.name):t1(),n=Pie+t;if(!e.find(p=>p===n))return;const i=await e1(n,1,{upgrade(p){p.objectStoreNames.contains("assets")||p.createObjectStore("assets")}}),r=i.transaction(["assets"],"readonly"),o=r.objectStore("assets"),l=await o.getAllKeys(),c=await Promise.all(l.map(async p=>[p,await o.get(p)]));await r.done;const d=await B5(t),u=d.transaction([ze.Assets],"readwrite"),h=u.objectStore(ze.Assets);for(const[p,f]of c)h.put(f,p);await u.done,i.close(),d.close(),await L5(n)}const sp=class sp{constructor(e){b(this,"getDbPromise");b(this,"isClosed",!1);b(this,"pendingTransactionSet",new Set);sp.connectedInstances.add(this),this.getDbPromise=(async()=>(await kie(e),await B5(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(wp)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),sp.connectedInstances.delete(this))}tx(e,n,s){const i=(async()=>{xt(!this.isClosed,"db is closed");const o=(await this.getDb()).transaction(n,e),l=o.done.catch(c=>{if(!this.isClosed)throw c});try{return await s(o)}finally{this.isClosed?o.abort():await l}})();return this.pendingTransactionSet.add(i),i.finally(()=>this.pendingTransactionSet.delete(i)),i}async load({sessionId:e}={}){return await this.tx("readonly",[ze.Records,ze.Schema,ze.SessionState],async n=>{var c,d;const s=n.objectStore(ze.Records),i=n.objectStore(ze.Schema),r=n.objectStore(ze.SessionState);let o=e?(c=await r.get(e))==null?void 0:c.snapshot:null;return o||(o=(d=(await r.getAll()).sort((h,p)=>h.updatedAt-p.updatedAt).pop())==null?void 0:d.snapshot),{records:await s.getAll(),schema:await i.get(ze.Schema),sessionStateSnapshot:o}})}async storeChanges({schema:e,changes:n,sessionId:s,sessionStateSnapshot:i}){await this.tx("readwrite",[ze.Records,ze.Schema,ze.SessionState],async r=>{const o=r.objectStore(ze.Records),l=r.objectStore(ze.Schema),c=r.objectStore(ze.SessionState);for(const[d,u]of Object.entries(n.added))await o.put(u,d);for(const[d,u]of Object.values(n.updated))await o.put(u,u.id);for(const d of Object.keys(n.removed))await o.delete(d);l.put(e.serialize(),ze.Schema),i&&s?c.put({snapshot:i,updatedAt:Date.now(),id:s},s):(i||s)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:n,sessionId:s,sessionStateSnapshot:i}){await this.tx("readwrite",[ze.Records,ze.Schema,ze.SessionState],async r=>{const o=r.objectStore(ze.Records),l=r.objectStore(ze.Schema),c=r.objectStore(ze.SessionState);await o.clear();for(const[d,u]of Object.entries(n))await o.put(u,d);l.put(e.serialize(),ze.Schema),i&&s?c.put({snapshot:i,updatedAt:Date.now(),id:s},s):(i||s)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[ze.SessionState],async e=>{const n=e.objectStore(ze.SessionState),s=(await n.getAll()).sort((r,o)=>r.updatedAt-o.updatedAt);if(s.length<10){await e.done;return}const i=s.slice(0,s.length-10);for(const{id:r}of i)await n.delete(r)})}async getAsset(e){return await this.tx("readonly",[ze.Assets],async n=>await n.objectStore(ze.Assets).get(e))}async storeAsset(e,n){await this.tx("readwrite",[ze.Assets],async s=>{await s.objectStore(ze.Assets).put(n,e)})}};b(sp,"connectedInstances",new Set);let pv=sp;function t1(){const t=JSON.parse(IT(F5)||"[]")??[];return Array.isArray(t)?t:[]}function jie(t){const e=new Set(t1());e.add(t),PT(F5,JSON.stringify([...e]))}function Nie(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
 If your hard disk is full, try clearing up some space and then reload the page.`)}function Aie(){window.alert(`Oops! We could not access your browser's storageand the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const Rie=350,Mie=1e4,UN=Symbol("UPDATE_INSTANCE_STATE"),Oie=t=>t;class Die{constructor(e){b(this,"onmessage")}postMessage(e){}close(){}}const Lie=typeof BroadcastChannel>"u"?Die:BroadcastChannel;class Fie{constructor(e,{persistenceKey:n,sessionId:s=uv,onLoad:i,onLoadError:r},o=new Lie(`tldraw-tab-sync-${n}`)){b(this,"disposables",new Set);b(this,"diffQueue",[]);b(this,"didDispose",!1);b(this,"shouldDoFullDBWrite",!0);b(this,"isReloading",!1);b(this,"persistenceKey");b(this,"sessionId");b(this,"serializedSchema");b(this,"isDebugging",!1);b(this,"documentTypes");b(this,"$sessionStateSnapshot");b(this,"db");b(this,"initTime",Date.now());b(this,"isPersisting",!1);b(this,"didLastWriteError",!1);b(this,"scheduledPersistTimeout",null);this.store=e,this.channel=o,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=s,this.db=new pv(n),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=w5(this.store),this.disposables.add(e.listen(({changes:l})=>{this.diffQueue.push(l),this.channel.postMessage(Oie({type:"diff",storeId:this.store.id,changes:l,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(UN),this.schedulePersist()},{scope:"session"})),this.connect(i,r),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(l=>l.scope==="document").map(l=>l.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,n){this.debug("connecting");let s;try{s=await this.db.load({sessionId:this.sessionId})}catch(i){n(i),Aie();return}if(this.debug("loaded data from store",s,"didDispose",this.didDispose),!this.didDispose)try{if(s){const i=Object.fromEntries(s.records.map(l=>[l.id,l])),r=s.sessionStateSnapshot??ose(i),o=this.store.schema.migrateStoreSnapshot({store:i,schema:s.schema??this.store.schema.serializeEarliestVersion()});if(o.type==="error"){console.error("failed to migrate store",o),n(new Error(`Failed to migrate store: ${o.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(o.value).filter(l=>this.documentTypes.has(l.typeName)),"initialize")}),r&&_5(this.store,r)}this.channel.onmessage=({data:i})=>{var l,c;this.debug("got message",i);const r=i,o=this.store.schema.getMigrationsSince(r.schema);if(o.ok){if(o.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){n(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(c=(l=window==null?void 0:window.location)==null?void 0:l.reload)==null||c.call(l);return}r.type==="diff"&&(this.debug("applying diff"),Rr(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(r.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;n(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?Mie:Rie))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(xt(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const n=NT(e.filter(s=>s!==UN));await this.db.storeChanges({changes:n,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(n){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",n),Nie(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function U5(t){const e=S.useRef(t),[n,s]=S.useState(t);n!==e.current&&s(e.current);const i=S.useCallback(r=>{typeof r=="function"?e.current=r(e.current):e.current=r,s(e.current)},[]);return[n,i]}function Bie(t){const[e,n]=U5({status:"loading"});return t=Bx(t),S.useEffect(()=>{const{persistenceKey:s,sessionId:i,...r}=t;if(!s){n({status:"not-synced",store:hv(r)});return}n({status:"loading"});const o=new jo,l={upload:async(h,p)=>(await u.db.storeAsset(h.id,p),h.id),resolve:async h=>h.props.src?h.props.src.startsWith("asset:")?await o.get(h,async()=>{const p=await u.db.getAsset(h.id);return p?URL.createObjectURL(p):null}):h.props.src:null,...r.assets},c=hv({...r,assets:l});let d=!1;const u=new Fie(c,{sessionId:i,persistenceKey:s,onLoad(){d||n({store:c,status:"synced-local"})},onLoadError(h){d||n({status:"error",error:h})}});return()=>{d=!0,u.close()}},[t,n]),e}function Uie(){const t=K(),e=vn();S.useEffect(()=>{const n=r=>e.style.setProperty("--tl-zoom",r.toString()),s=TL(n,100),i=new nu("useZoomCss",()=>{t.getCurrentPageShapeIds().size<300?n(t.getZoomLevel()):s(t.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach(),s.cancel()}},[t,e])}function nC(t){const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let s=0,i=t.length;s<i;s++)n[s]=t.charCodeAt(s);return e}function $ie(t){const e=atob(t),n=nC(e);return crypto.subtle.importKey("spki",new Uint8Array(n),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const zie=5,Mm={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4},Wie=Math.max(...Object.values(Mm)),fh={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},Hie=Object.keys(fh).length,Mg="sales@tldraw.com";class n1{constructor(e,n,s){b(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");b(this,"isDevelopment");b(this,"isTest");b(this,"isCryptoAvailable");b(this,"state",dn("license state","pending"));this.isTest=!1,this.isDevelopment=this.getIsDevelopment(s),this.publicKey=n||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,jT.enableLicensing.get()?this.getLicenseFromKey(e).then(i=>{const r=Gie(i);this.state.set(r?"unlicensed":"licensed")}):this.state.set("licensed")}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[n,s]=e.split("."),[i,r]=n.split("/");if(!i.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${i}'`);const o=await $ie(this.publicKey);let l;try{l=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,new Uint8Array(nC(atob(s))),new Uint8Array(nC(atob(r))))}catch(d){throw console.error(d),new Error("Could not perform signature validation")}if(!l)throw new Error("Invalid signature");let c;try{c=JSON.parse(atob(r))}catch{throw new Error("Could not parse object")}return c.length>Hie&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:c[fh.ID],hosts:c[fh.HOSTS],flags:c[fh.FLAGS],expiryDate:c[fh.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately."),{isLicenseParseable:!1,reason:"has-key-development-mode"};let n=e.replace(/[\u200B-\u200D\uFEFF]/g,"");n=n.replace(/\r?\n|\r/g,"");try{const s=await this.extractLicenseKey(n),i=new Date(s.expiryDate),r=this.isFlagEnabled(s.flags,Mm.ANNUAL_LICENSE),o=this.isFlagEnabled(s.flags,Mm.PERPETUAL_LICENSE),l={license:s,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(s),expiryDate:i,isAnnualLicense:r,isAnnualLicenseExpired:r&&this.isAnnualLicenseExpired(i),isPerpetualLicense:o,isPerpetualLicenseExpired:o&&this.isPerpetualLicenseExpired(i),isInternalLicense:this.isFlagEnabled(s.flags,Mm.INTERNAL_LICENSE)};return this.outputLicenseInfoIfNeeded(l),l}catch(s){return this.outputInvalidLicenseKey(s.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const n=window.location.hostname.toLowerCase();return e.hosts.some(s=>{const i=s.toLowerCase().trim();return i===n||`www.${i}`===n||i===`www.${n}`||s==="*"?!0:s.includes("*")?new RegExp(s.replace(/\*/g,".*?")).test(n):!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+zie+1)}isAnnualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e),s=new Date>=n;return!s&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${Mg} if you would like to renew your license.`]),s}isPerpetualLicenseExpired(e){const n=this.getExpirationDateWithGracePeriod(e),s={major:new Date(nN.major),minor:new Date(nN.minor)};return s.major>=n||s.minor>=n}isFlagEnabled(e,n){return(e&n)===n}outputNoLicenseKeyProvided(){this.outputMessages(["No tldraw license key provided!",`Please reach out to ${Mg} if you would like to license tldraw or if you'd like a trial.`])}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${Mg} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${Mg} if you would like to use tldraw on other domains.`]),e.license.flags>=Wie*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest){this.outputDelimiter();for(const n of e)console.log(`%c${n}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}b(n1,"className","tl-watermark_SEE-LICENSE");function Gie(t){if(!t.isLicenseParseable||!t.isDomainValid&&!t.isDevelopment)return!0;if(t.isPerpetualLicenseExpired||t.isAnnualLicenseExpired){if(t.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const $5=S.createContext({}),Vie=()=>S.useContext($5);function Kie({licenseKey:t,children:e}){const[n]=S.useState(()=>new n1(t));return a.jsx($5.Provider,{value:n,children:e})}const Yie='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',Xie=`${xa()}/watermarks/watermark-desktop.svg`,Og=`data:image/svg+xml;utf8,${encodeURIComponent(Yie)}`;let aw=null;async function qie(t){return t?Og:(aw||(aw=Promise.race([(async()=>{try{const e=await Ur(Xie);if(!e.ok)return Og;const n=await e.blob();return URL.createObjectURL(n)}catch{return Og}})(),new Promise(e=>{setTimeout(()=>{e(Og)},3e3)})])),aw)}const Zie=Oe.memo(function({forceLocal:e=!1}){const n=UF(),s=K(),i=Vie(),r=Z("show watermark",()=>jT.enableLicensing.get()&&s.getViewportScreenBounds().width>760&&i.state.get()==="unlicensed",[s,i]),o=Z("debug mode",()=>s.getInstanceState().isDebugMode,[s]),l=Z("is menu open",()=>s.getIsMenuOpen(),[s]),[c,d]=S.useState(null),u=e||i.isDevelopment;if(S.useEffect(()=>{if(!r)return;let f=!1;return(async()=>{const g=await qie(u);f||d(g)})(),()=>{f=!0}},[u,r]),!r||!c)return null;const h=n1.className,p=`url('${c}') center 100% / 100% no-repeat`;return a.jsxs(a.Fragment,{children:[a.jsx("style",{children:`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
users. By using this library, you agree to keep the watermark's behavior, 
keeping it visible, unobscured, and available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${h} {
	position: absolute;
	bottom: var(--space-2);
	right: var(--space-2);
	width: 96px;
	height: 32px;
	z-index: 2147483647 !important;
	pointer-events: ${l?"none":"all"};
	background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
	border-radius: 5px;
	padding: 2px;
	box-sizing: content-box;
}

.${h}[data-debug='true'] {
	bottom: 46px;
}

.${h} > a {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: none;
	cursor: inherit;
	color: var(--color-text);
	background-color: currentColor;
	opacity: .28;
}

@media (hover: hover) {
	.${h}:hover {
		background-color: var(--color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}
	.${h}:hover > a {
		animation: delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}
}

@keyframes delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}
`}),a.jsx("div",{className:h,"data-debug":o,draggable:!1,...n,children:a.jsx("a",{href:"https://tldraw.dev",target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:gn,style:{mask:p,WebkitMask:p}})})]})}),Jie=[],Qie=[],ere=[],tre="tl-container",nre=S.memo(function({store:e,components:n,className:s,user:i,...r}){const[o,l]=Oe.useState(null),c=S.useMemo(()=>i??v5(),[i]),d=(n==null?void 0:n.ErrorFallback)===void 0?c5:n==null?void 0:n.ErrorFallback,u={...r,shapeUtils:r.shapeUtils??Jie,bindingUtils:r.bindingUtils??Qie,tools:r.tools??ere,components:n};return a.jsx("div",{ref:l,"data-tldraw":OF,draggable:!1,className:Se(`${tre} tl-theme__light`,s),onPointerDown:gn,tabIndex:-1,children:a.jsx(Ip,{fallback:d,onError:h=>ET(h,{tags:{origin:"react.tldraw-before-app"}}),children:o&&a.jsx(Kie,{licenseKey:r.licenseKey,children:a.jsx(zee,{container:o,children:a.jsx(Vne,{overrides:n,children:e?e instanceof AT?a.jsx(W5,{...u,store:e,user:c}):a.jsx(z5,{...u,store:e,user:c}):a.jsx(sre,{...u,store:e,user:c})})})})})})});function sre(t){const{defaultName:e,snapshot:n,initialData:s,shapeUtils:i,bindingUtils:r,persistenceKey:o,sessionId:l,user:c,assets:d}=t,u=Bie({shapeUtils:i,bindingUtils:r,initialData:s,persistenceKey:o,sessionId:l,defaultName:e,snapshot:n,assets:d});return a.jsx(z5,{...t,store:u,user:c})}const z5=S.memo(function({store:e,user:n,...s}){const i=vn();S.useLayoutEffect(()=>{n.userPreferences.get().colorScheme==="dark"&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))},[i,n]);const{LoadingScreen:r}=kt();switch(e.status){case"error":throw e.error;case"loading":return r?a.jsx(r,{}):null}return a.jsx(W5,{...s,store:e.store,user:n})}),lw=()=>document.location.search.includes("tldraw_preserve_focus");function W5({onMount:t,children:e,store:n,tools:s,shapeUtils:i,bindingUtils:r,user:o,initialState:l,autoFocus:c=!0,inferDarkMode:d,cameraOptions:u,options:h,licenseKey:p}){const{ErrorFallback:f}=kt(),g=vn(),[y,x]=U5(null),m=S.useRef({autoFocus:c&&!lw(),inferDarkMode:d,initialState:l,cameraOptions:u});S.useLayoutEffect(()=>{m.current={autoFocus:c&&!lw(),inferDarkMode:d,initialState:l,cameraOptions:u}},[c,d,l,u]),S.useLayoutEffect(()=>{const{autoFocus:_,inferDarkMode:C,initialState:I,cameraOptions:T}=m.current,P=new le({store:n,shapeUtils:i,bindingUtils:r,tools:s,getContainer:()=>g,user:o,initialState:I,autoFocus:_,inferDarkMode:C,cameraOptions:T,options:h,licenseKey:p});return x(P),()=>{P.dispose()}},[r,g,h,i,n,s,o,x,p]),S.useLayoutEffect(()=>{y&&u&&y.setCameraOptions(u)},[y,u]);const v=S.useSyncExternalStore(S.useCallback(_=>y?(y.on("crash",_),()=>y.off("crash",_)):()=>{},[y]),()=>(y==null?void 0:y.getCrashingError())??null);S.useEffect(function(){if(!y)return;function C(){y&&y.focus()}function I(){y&&y.blur()}if(c&&lw())return y.getContainer().addEventListener("pointerdown",C),document.body.addEventListener("pointerdown",I),()=>{var T;(T=y.getContainer())==null||T.removeEventListener("pointerdown",C),document.body.removeEventListener("pointerdown",I)}},[y,c]);const{Canvas:w}=kt();return y?a.jsx(Ip,{fallback:f,onError:_=>y.annotateError(_,{origin:"react.tldraw",willCrashApp:!0}),children:v?a.jsx(rre,{crashingError:v}):a.jsx(Lx.Provider,{value:y,children:a.jsxs(ire,{onMount:t,children:[e??(w?a.jsx(w,{}):null),a.jsx(Zie,{})]})})}):null}function ire({children:t,onMount:e}){return Uie(),uie(),hie(),pie(),G5(n=>{const s=n.store.props.onMount(n),i=e==null?void 0:e(n);return()=>{s==null||s(),i==null||i()}}),t}function rre({crashingError:t}){throw t}function s1({children:t}){return a.jsx("div",{className:"tl-loading",children:t})}function H5({children:t}){return a.jsx("div",{className:"tl-loading",children:t})}function G5(t){const e=K(),n=M5(s=>{let i;return s.run(()=>{i=t==null?void 0:t(s),s.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,i});Oe.useLayoutEffect(()=>{if(e)return n==null?void 0:n(e)},[e,n])}function Xl({children:t,className:e="",...n}){return a.jsx("div",{...n,className:Se("tl-html-container",e),children:t})}class Om{constructor(e){this.editor=e}}b(Om,"props"),b(Om,"migrations"),b(Om,"type");function i1(t,e,n={}){const{newPoint:s,handle:i,scaleX:r,scaleY:o}=e,{minWidth:l=1,maxWidth:c=1/0,minHeight:d=1,maxHeight:u=1/0}=n;let h=t.props.w*r,p=t.props.h*o;const f=new E(0,0);if(h>0){if(h<l){switch(i){case"top_left":case"left":case"bottom_left":{f.x=h-l;break}case"top":case"bottom":{f.x=(h-l)/2;break}default:f.x=0}h=l}}else if(f.x=h,h=-h,h<l){switch(i){case"top_left":case"left":case"bottom_left":{f.x=-h;break}default:f.x=-l}h=l}if(p>0){if(p<d){switch(i){case"top_left":case"top":case"top_right":{f.y=p-d;break}case"right":case"left":{f.y=(p-d)/2;break}default:f.y=0}p=d}}else if(f.y=p,p=-p,p<d){switch(i){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-d}p=d}const{x:g,y}=f.rot(t.rotation).add(s);return{...t,x:g,y,props:{w:Math.min(c,h),h:Math.min(u,p)}}}class au extends Ji{constructor(){super(...arguments);b(this,"onResize",(n,s)=>i1(n,s))}getGeometry(n){return new Ao({width:n.props.w,height:n.props.h,isFilled:!0})}getHandleSnapGeometry(n){return{points:this.getGeometry(n).bounds.cornersAndCenter}}getInterpolatedProps(n,s,i){return{...s.props,w:js(n.props.w,s.props.w,i),h:js(n.props.h,s.props.h,i)}}}var c0;let ore=(c0=class extends ye{constructor(){super(...arguments);b(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});b(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});b(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},b(c0,"id","idle"),c0);var d0;let are=(d0=class extends ye{constructor(){super(...arguments);b(this,"markId","");b(this,"wasFocusedOnEnter",!1);b(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()});b(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){const{originPagePoint:s}=this.editor.inputs,i=this.parent.shapeType,r=it();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:i,x:s.x,y:s.y,props:{w:1,h:1}}]).select(r),this.editor.setCurrentTool("select.resizing",{...n,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.complete()});b(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:n}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const s=this.parent.shapeType,i=it();this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:s,x:n.x,y:n.y}]);const r=this.editor.getShape(i);if(!r){this.cancel();return}let{w:o,h:l}=r.props;const c=new E(o/2,l/2),d=this.editor.getShapeParentTransform(r);d&&c.rot(-d.rotation());let u=1;this.editor.user.getIsDynamicResizeMode()&&(u=1/this.editor.getZoomLevel(),o*=u,l*=u,c.mul(u));const h=yt(r);h.x=r.x-c.x,h.y=r.y-c.y,h.props.w=o,h.props.h=l,"scale"in r.props&&(h.props.scale=u),this.editor.updateShape(h),this.editor.setSelectedShapes([i]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},b(d0,"id","pointing"),d0);class Dm extends ye{constructor(){super(...arguments);b(this,"onCreate")}}b(Dm,"id","box"),b(Dm,"initial","idle"),b(Dm,"children",()=>[ore,are]);function Hx(t){const e=K();return Z("isEditing",()=>e.getEditingShapeId()===t,[e,t])}function vr(t){const e=K();return S.useMemo(function(){const i=d=>{if(d.isKilled)return;if(d.button===zT){e.dispatch({type:"pointer",target:"selection",handle:t,name:"right_click",...Os(d)});return}if(d.button!==0)return;const u=cv(d.currentTarget);function h(){u.removeEventListener("pointerup",h),gf(u,d)}ff(u,d),u.addEventListener("pointerup",h),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:t,...Os(d)}),gn(d)};let r,o;function l(d){d.isKilled||d.button===0&&(d.clientX===r&&d.clientY===o||(r=d.clientX,o=d.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:t,...Os(d)})))}return{onPointerDown:i,onPointerMove:l,onPointerUp:d=>{d.isKilled||d.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:t,...Os(d)})}}},[e,t])}function lre(t){const[e,n]=S.useState(()=>({store:hv(t),opts:t}));if(!AL(e.opts,t)){const s={store:hv(t),opts:t};return n(s),s.store}return e.store}const cre=20,dre=8;function r1(t,e=cre){return Math.max(dre,Math.ceil(t/e))}class ed extends sl{constructor(n){super({...n,isFilled:!1,isClosed:!1});b(this,"_center");b(this,"radius");b(this,"start");b(this,"end");b(this,"largeArcFlag");b(this,"sweepFlag");b(this,"measure");b(this,"angleStart");b(this,"angleEnd");const{center:s,sweepFlag:i,largeArcFlag:r,start:o,end:l}=n;if(o.equals(l))throw Error("Arc must have different start and end points.");this.angleStart=E.Angle(s,o),this.angleEnd=E.Angle(s,l),this.radius=E.Dist(s,o),this.measure=Lee(this.angleStart,this.angleEnd,i,r),this.start=o,this.end=l,this.sweepFlag=i,this.largeArcFlag=r,this._center=s}nearestPoint(n){const{_center:s,measure:i,radius:r,angleEnd:o,angleStart:l,start:c,end:d}=this,u=Y_(i,l,o,s.angle(n));if(u<=0)return c;if(u>=1)return d;const h=s.clone().add(n.clone().sub(s).uni().mul(r));let p,f=1/0,g;for(const y of[c,d,h])g=E.Dist2(n,y),g<f&&(p=y,f=g);if(!p)throw Error("nearest point not found");return p}hitTestLineSegment(n,s){const{_center:i,radius:r,measure:o,angleStart:l,angleEnd:c}=this,d=vf(n,s,i,r);return d===null?!1:d.some(u=>{const h=Y_(o,l,c,i.angle(u));return h>=0&&h<=1})}getVertices(){const{_center:n,measure:s,length:i,radius:r,angleStart:o}=this,l=[];for(let c=0,d=r1(Math.abs(i));c<d+1;c++){const u=c/d*s,h=o+u;l.push(Yl(n,r,h))}return l}getSvgPathData(n=!0){const{start:s,end:i,radius:r,largeArcFlag:o,sweepFlag:l}=this;return`${n?`M${s.toFixed()}`:""} A${r} ${r} 0 ${o} ${l} ${i.toFixed()}`}getLength(){return this.measure*this.radius}}class o1 extends sl{constructor(n){super({isClosed:!0,...n});b(this,"_center");b(this,"radius");b(this,"x");b(this,"y");this.config=n;const{x:s=0,y:i=0,radius:r}=n;this.x=s,this.y=i,this._center=new E(r+s,r+i),this.radius=r}getBounds(){return new de(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:n,radius:s}=this,i=tt*s,r=[];for(let o=0,l=r1(i);o<l;o++){const c=o/l*tt;r.push(Yl(n,s,c))}return r}nearestPoint(n){const{_center:s,radius:i}=this;return s.equals(n)?E.AddXY(s,i,0):s.clone().add(n.clone().sub(s).uni().mul(i))}hitTestLineSegment(n,s,i=0){const{_center:r,radius:o}=this;return vf(n,s,r,o+i)!==null}getSvgPathData(){const{_center:n,radius:s}=this;return`M${n.x+s},${n.y} a${s},${s} 0 1,0 ${s*2},0a${s},${s} 0 1,0 -${s*2},0`}}class Vn extends ou{constructor(n){const{start:s,cp1:i,cp2:r,end:o}=n;super({...n,points:[s,o]});b(this,"a");b(this,"b");b(this,"c");b(this,"d");this.a=s,this.b=i,this.c=r,this.d=o}getVertices(){const n=[],{a:s,b:i,c:r,d:o}=this;for(let l=0,c=10;l<=c;l++){const d=l/c;n.push(new E((1-d)*(1-d)*(1-d)*s.x+3*((1-d)*(1-d))*d*i.x+3*(1-d)*(d*d)*r.x+d*d*d*o.x,(1-d)*(1-d)*(1-d)*s.y+3*((1-d)*(1-d))*d*i.y+3*(1-d)*(d*d)*r.y+d*d*d*o.y))}return n}midPoint(){return Vn.GetAtT(this,.5)}nearestPoint(n){let s,i=1/0,r,o;for(const l of this.segments)o=l.nearestPoint(n),r=E.Dist2(o,n),r<i&&(s=o,i=r);if(!s)throw Error("nearest point not found");return s}getSvgPathData(n=!0){const{a:s,b:i,c:r,d:o}=this;return`${n?`M ${s.toFixed()} `:""} C${i.toFixed()} ${r.toFixed()} ${o.toFixed()}`}static GetAtT(n,s){const{a:i,b:r,c:o,d:l}=n;return new E((1-s)*(1-s)*(1-s)*i.x+3*((1-s)*(1-s))*s*r.x+3*(1-s)*(s*s)*o.x+s*s*s*l.x,(1-s)*(1-s)*(1-s)*i.y+3*((1-s)*(1-s))*s*r.y+3*(1-s)*(s*s)*o.y+s*s*s*l.y)}getLength(n=32){let s,i=this.a,r=0;for(let o=1;o<=n;o++)s=Vn.GetAtT(this,o/n),r+=E.Dist(i,s),i=s;return r}}class ure extends sl{constructor(n){super({...n,isClosed:!1,isFilled:!1});b(this,"points");b(this,"_segments");const{points:s}=n;this.points=s}get segments(){if(!this._segments){this._segments=[];const{points:n}=this,s=n.length,i=s-2,r=1.25;for(let o=0;o<s-1;o++){const l=o===0?n[0]:n[o-1],c=n[o],d=n[o+1],u=o===i?d:n[o+2],h=c,p=o===0?l:new E(c.x+(d.x-l.x)/6*r,c.y+(d.y-l.y)/6*r),f=o===i?d:new E(d.x-(u.x-c.x)/6*r,d.y-(u.y-c.y)/6*r),g=d;this._segments.push(new Vn({start:h,cp1:p,cp2:f,end:g}))}}return this._segments}getLength(){return this.segments.reduce((n,s)=>n+s.length,0)}getVertices(){const n=this.segments.reduce((s,i)=>s.concat(i.vertices),[]);return n.push(this.points[this.points.length-1]),n}nearestPoint(n){let s,i=1/0,r,o;for(const l of this.segments)o=l.nearestPoint(n),r=E.Dist2(o,n),r<i&&(s=o,i=r);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(n,s){return this.segments.some(i=>i.hitTestLineSegment(n,s))}getSvgPathData(){let n=this.segments.reduce((s,i,r)=>s+i.getSvgPathData(r===0),"");return this.isClosed&&(n+="Z"),n}}class hre extends sl{constructor(n){super({...n,isClosed:!0});b(this,"w");b(this,"h");b(this,"_edges");this.config=n;const{width:s,height:i}=n;this.w=s,this.h=i}get edges(){if(!this._edges){const{vertices:n}=this;this._edges=[];for(let s=0,i=n.length;s<i;s++){const r=n[s],o=n[(s+1)%i];this._edges.push(new fo({start:r,end:o}))}}return this._edges}getVertices(){const n=Math.max(1,this.w),s=Math.max(1,this.h),i=n/2,r=s/2,o=Math.pow(i-r,2)/Math.pow(i+r,2),l=Ze*(i+r)*(1+3*o/(10+Math.sqrt(4-3*o))),c=r1(l),d=tt/c,u=Math.cos(d),h=Math.sin(d);let p=0,f=1,g=0,y=1;const x=Array(c);for(let m=0;m<c;m++)x[m]=new E(i+i*f,r+r*p),g=h*f+u*p,y=u*f-h*p,p=g,f=y;return x}nearestPoint(n){let s,i=1/0,r,o;for(const l of this.edges)o=l.nearestPoint(n),r=E.Dist2(o,n),r<i&&(s=o,i=r);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(n,s){return this.edges.some(i=>i.hitTestLineSegment(n,s))}getBounds(){return new de(0,0,this.w,this.h)}getLength(){const{w:n,h:s}=this,i=n/2,r=s/2,o=Math.max(0,i),l=Math.max(0,r);return LF(o,l)}getSvgPathData(n=!1){const{w:s,h:i}=this,r=s/2,o=i/2,l=Math.max(0,r),c=Math.max(0,o);return`${n?`M${r-l},${o}`:""} a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`}}class pre extends sl{constructor(n){super({...n,isClosed:!0});b(this,"w");b(this,"h");b(this,"a");b(this,"b");b(this,"c");b(this,"d");this.config=n;const{width:s,height:i}=n;if(this.w=s,this.h=i,i>s){const r=s/2;this.a=new ed({start:new E(0,r),end:new E(s,r),center:new E(s/2,r),sweepFlag:1,largeArcFlag:1}),this.b=new fo({start:new E(s,r),end:new E(s,i-r)}),this.c=new ed({start:new E(s,i-r),end:new E(0,i-r),center:new E(s/2,i-r),sweepFlag:1,largeArcFlag:1}),this.d=new fo({start:new E(0,i-r),end:new E(0,r)})}else{const r=i/2;this.a=new ed({start:new E(r,i),end:new E(r,0),center:new E(r,r),sweepFlag:1,largeArcFlag:1}),this.b=new fo({start:new E(r,0),end:new E(s-r,0)}),this.c=new ed({start:new E(s-r,0),end:new E(s-r,i),center:new E(s-r,r),sweepFlag:1,largeArcFlag:1}),this.d=new fo({start:new E(s-r,i),end:new E(r,i)})}}nearestPoint(n){let s,i=1/0,r,o;const{a:l,b:c,c:d,d:u}=this;for(const h of[l,c,d,u])o=h.nearestPoint(n),r=E.Dist2(o,n),r<i&&(s=o,i=r);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(n,s){const{a:i,b:r,c:o,d:l}=this;return[i,r,o,l].some(c=>c.hitTestLineSegment(n,s))}getVertices(){const{a:n,b:s,c:i,d:r}=this;return[n,s,i,r].reduce((o,l)=>(o.push(...l.vertices),o),[])}getBounds(){return new de(0,0,this.w,this.h)}getLength(){const{h:n,w:s}=this;return n>s?(Ze*(s/2)+(n-s))*2:(Ze*(n/2)+(s-n))*2}getSvgPathData(){const{a:n,b:s,c:i,d:r}=this;return[n,s,i,r].map((o,l)=>o.getSvgPathData(l===0)).join(" ")+" Z"}}async function fre({shouldReload:t=!0}={}){KJ();for(const e of pv.connectedInstances)await e.close();await Promise.all(t1().map(e=>L5(e))),VJ(),t&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=fre);function gre(t,e="_blank"){VT.openWindow(t,e)}function mre({children:t}){const e=K();return Z("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const s=e.getOnlySelectedShape();return s&&e.isShapeOfType(s,"note")}return!1},[e])?a.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:t}):null}const{PI:yre}=Math,md=yre+1e-4;function V5(t,e={}){const{size:n=16,smoothing:s=.5}=e;if(t.length===0||n<=0)return{left:[],right:[]};const i=t[0],r=t[t.length-1],o=r.runningLength,l=Math.pow(n*s,2),c=[],d=[];let u=t[0].vector,h=t[0].point,p=h,f=h,g=p,y=!1,x;for(let m=0;m<t.length;m++){x=t[m];const{point:v,vector:w}=t[m],_=x.vector.dpr(u),C=(m<t.length-1?t[m+1]:t[m]).vector,I=m<t.length-1?C.dpr(x.vector):1,T=_<0&&!y,P=I!==null&&I<.2;if(T||P){if(I>-.62&&o-x.runningLength>x.radius){const N=u.clone().mul(x.radius);u.clone().cpr(C)<0?(f=E.Add(v,N),g=E.Sub(v,N)):(f=E.Sub(v,N),g=E.Add(v,N)),c.push(f),d.push(g)}else{const N=u.clone().mul(x.radius).per(),O=E.Sub(x.input,N);for(let R=1/13,j=0;j<1;j+=R)f=E.RotWith(O,x.input,md*j),c.push(f),g=E.RotWith(O,x.input,md+md*-j),d.push(g)}h=f,p=g,P&&(y=!0);continue}if(y=!1,x===i||x===r){const N=E.Per(w).mul(x.radius);c.push(E.Sub(v,N)),d.push(E.Add(v,N));continue}const k=E.Lrp(C,w,I).per().mul(x.radius);f=E.Sub(v,k),(m<=1||E.Dist2(h,f)>l)&&(c.push(f),h=f),g=E.Add(v,k),(m<=1||E.Dist2(p,g)>l)&&(d.push(g),p=g),u=w}return{left:c,right:d}}function a1(t,e={}){const{size:n=16,start:s={},end:i={},last:r=!1}=e,{cap:o=!0}=s,{cap:l=!0}=i;if(t.length===0||n<=0)return[];const c=t[0],d=t[t.length-1],u=d.runningLength,h=s.taper===!1?0:s.taper===!0?Math.max(n,u):s.taper,p=i.taper===!1?0:i.taper===!0?Math.max(n,u):i.taper,{left:f,right:g}=V5(t,e),y=c.point,x=t.length>1?t[t.length-1].point:E.AddXY(c.point,1,1);if(t.length===1&&(!(h||p)||r)){const _=E.Add(y,E.Sub(y,x).uni().per().mul(-c.radius)),C=[];for(let I=1/13,T=I;T<=1;T+=I)C.push(E.RotWith(_,y,md*2*T));return C}const m=[];if(!(h||p&&t.length===1))if(o)for(let _=1/8,C=_;C<=1;C+=_){const I=E.RotWith(g[0],y,md*C);m.push(I)}else{const _=E.Sub(f[0],g[0]),C=E.Mul(_,.5),I=E.Mul(_,.51);m.push(E.Sub(y,C),E.Sub(y,I),E.Add(y,I),E.Add(y,C))}const v=[],w=d.vector.clone().per().neg();if(p||h&&t.length===1)v.push(x);else if(l){const _=E.Add(x,E.Mul(w,d.radius));for(let C=1/29,I=C;I<1;I+=C)v.push(E.RotWith(_,x,md*3*I))}else v.push(E.Add(x,E.Mul(w,d.radius)),E.Add(x,E.Mul(w,d.radius*.99)),E.Sub(x,E.Mul(w,d.radius*.99)),E.Sub(x,E.Mul(w,d.radius)));return f.concat(v,g.reverse(),m)}const vre=.025,xre=.01;function Wr(t,e={}){var x;const{streamline:n=.5,size:s=16,simulatePressure:i=!1}=e;if(t.length===0)return[];const r=.15+(1-n)*.85;let o=t.map(E.From),l=0;if(!i){let m=o[0];for(;m&&!(m.z>=vre);)o.shift(),m=o[0]}if(!i){let m=o[o.length-1];for(;m&&!(m.z>=xre);)o.pop(),m=o[o.length-1]}if(o.length===0)return[{point:E.From(t[0]),input:E.From(t[0]),pressure:i?.5:.15,vector:new E(1,1),distance:0,runningLength:0,radius:1}];let c=o[1];for(;c&&!(E.Dist2(c,o[0])>(s/3)**2);)o[0].z=Math.max(o[0].z,c.z),o.splice(1,1),c=o[1];const d=o.pop();for(c=o[o.length-1];c&&!(E.Dist2(c,d)>(s/3)**2);)o.pop(),c=o[o.length-1],l++;o.push(d);const u=e.last||!e.simulatePressure||o.length>1&&E.Dist2(o[o.length-1],o[o.length-2])<s**2||l>0;if(o.length===2&&e.simulatePressure){const m=o[1];o=o.slice(0,-1);for(let v=1;v<5;v++){const w=E.Lrp(o[0],m,v/4);w.z=(o[0].z+(m.z-o[0].z))*v/4,o.push(w)}}const h=[{point:o[0],input:o[0],pressure:i?.5:o[0].z,vector:new E(1,1),distance:0,runningLength:0,radius:1}];let p=0,f=h[0],g,y;u&&n>0&&o.push(o[o.length-1].clone());for(let m=1,v=o.length;m<v;m++)g=!r||e.last&&m===v-1?o[m].clone():o[m].clone().lrp(f.point,1-r),!f.point.equals(g)&&(y=E.Dist(g,f.point),p+=y,!(m<4&&p<s)&&(f={input:o[m],point:g,pressure:i?.5:o[m].z,vector:E.Sub(f.point,g).uni(),distance:y,runningLength:p,radius:1},h.push(f)));if((x=h[1])!=null&&x.vector&&(h[0].vector=h[1].vector.clone()),p<1){const m=Math.max(.5,...h.map(v=>v.pressure));h.forEach(v=>v.pressure=m)}return h}const{min:ta}=Math,cw=.275;function Gx(t,e){const{size:n=16,thinning:s=.5,simulatePressure:i=!0,easing:r=x=>x,start:o={},end:l={}}=e,{easing:c=un.easeOutQuad}=o,{easing:d=un.easeOutCubic}=l,u=t[t.length-1].runningLength;let h,p=t[0].pressure,f;if(!i&&u<n){const x=t.reduce((m,v)=>Math.max(m,v.pressure),.5);return t.forEach(m=>{m.pressure=x,m.radius=n*r(.5-s*(.5-m.pressure))}),t}else{let x;for(let m=0,v=t.length;m<v&&(f=t[m],!(f.runningLength>n*5));m++){const w=ta(1,f.distance/n);if(i){const _=ta(1,1-w);x=ta(1,p+(_-p)*(w*cw))}else x=ta(1,p+(f.pressure-p)*.5);p=p+(x-p)*.5}for(let m=0;m<t.length;m++){if(f=t[m],s){let{pressure:v}=f;const w=ta(1,f.distance/n);if(i){const _=ta(1,1-w);v=ta(1,p+(_-p)*(w*cw))}else v=ta(1,p+(v-p)*(w*cw));f.radius=n*r(.5-s*(.5-v)),p=v}else f.radius=n/2;h===void 0&&(h=f.radius)}}const g=o.taper===!1?0:o.taper===!0?Math.max(n,u):o.taper,y=l.taper===!1?0:l.taper===!0?Math.max(n,u):l.taper;if(g||y)for(let x=0;x<t.length;x++){f=t[x];const{runningLength:m}=f,v=m<g?c(m/g):1,w=u-m<y?d((u-m)/y):1;f.radius=Math.max(.01,f.radius*Math.min(v,w))}return t}function Sre(t,e={}){return a1(Gx(Wr(t,e),e),e)}function $N({scribble:t,zoom:e,color:n,opacity:s,className:i}){if(!t.points.length)return null;const r=Sre(t.points,{size:t.size/e,start:{taper:t.taper,easing:un.linear},last:t.state==="stopping",simulatePressure:!1,streamline:.32});let o;if(r.length<4){const l=t.size/e/2,{x:c,y:d}=t.points[t.points.length-1];o=`M ${c-l},${d} a ${l},${l} 0 1,0 ${l*2},0 a ${l},${l} 0 1,0 ${-l*2},0`}else o=HT(r);return a.jsx("svg",{className:i&&Se("tl-overlays__item",i),children:a.jsx("path",{className:"tl-scribble",d:o,fill:n??`var(--color-${t.color})`,opacity:s??t.opacity})})}const bre=({bounds:t,rotation:e})=>{const n=K();return Z("should display",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[n])?a.jsx(i5,{bounds:t,rotation:e}):null};function Ho(){const t=K();return Z("isReadonlyMode",()=>t.getInstanceState().isReadonly,[t])}function wre({size:t,width:e,height:n,hideAlternateHandles:s}){const i=G(t/3),r=i/2;return a.jsxs("svg",{className:"tl-overlays__item",children:[a.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${G(0-r)},${G(t)} 
						${G(0-r)},${G(0-r)} 
						${G(t)},${G(0-r)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),a.jsx("line",{className:Se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:G(e/2-t),y1:G(0-r),x2:G(e/2+t),y2:G(0-r),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),a.jsx("polyline",{className:Se("tl-corner-crop-handle",{"tl-hidden":s}),points:`
						${G(e-t)},${G(0-r)} 
						${G(e+r)},${G(0-r)} 
						${G(e+r)},${G(t)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),a.jsx("line",{className:Se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:G(e+r),y1:G(n/2-t),x2:G(e+r),y2:G(n/2+t),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),a.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${G(e+r)},${G(n-t)} 
						${G(e+r)},${G(n+r)}
						${G(e-t)},${G(n+r)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),a.jsx("line",{className:Se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:G(e/2-t),y1:G(n+r),x2:G(e/2+t),y2:G(n+r),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),a.jsx("polyline",{className:Se("tl-corner-crop-handle",{"tl-hidden":s}),points:`
						${G(0+t)},${G(n+r)} 
						${G(0-r)},${G(n+r)}
						${G(0-r)},${G(n-t)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),a.jsx("line",{className:Se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:G(0-r),y1:G(n/2-t),x2:G(0-r),y2:G(n/2+t),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const _re=yn(function({bounds:e,rotation:n}){const s=K(),i=S.useRef(null),r=Ho(),o=vr("top"),l=vr("right"),c=vr("bottom"),d=vr("left"),u=vr("top_left"),h=vr("top_right"),p=vr("bottom_right"),f=vr("bottom_left"),g=!s.getIsMenuOpen()&&s.getInstanceState().cursor.type==="default",y=s.getInstanceState().isCoarsePointer,x=s.getOnlySelectedShape(),m=x&&s.isShapeOrAncestorLocked(x),v=x?s.getShapeUtil(x).expandSelectionOutlinePx(x):0;if(ru(i,e==null?void 0:e.x,e==null?void 0:e.y,1,s.getSelectionRotation(),{x:-v,y:-v}),!e)return null;e=e.clone().expandBy(v).zeroFix();const w=s.getZoomLevel(),_=s.getInstanceState().isChangingStyle,C=e.width,I=e.height,T=8/w,P=C<T*2,k=I<T*2,N=C<T*4,O=I<T*4,R=C<T*5,j=I<T*5,A=y?1.75:1,B=6/w*A,L=(N?B/2:B)*(A*.75),$=(O?B/2:B)*(A*.75),M=(x?!s.getShapeUtil(x).hideSelectionBoundsFg(x):!0)&&!_;let D=M&&s.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||M&&s.isIn("select.resizing")&&x&&s.isShapeOfType(x,"text");x&&D&&s.environment.isFirefox&&s.isShapeOfType(x,"embed")&&(D=!1);const U=s.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!_&&!r,z=s.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!_&&!r,H=!y&&!(P||k)&&(z||U)&&(x?!s.getShapeUtil(x).hideRotateHandle(x):!0)&&!m,q=y&&(!N||!O)&&(z||U)&&(x?!s.getShapeUtil(x).hideRotateHandle(x):!0)&&!m,V=z&&(x?s.getShapeUtil(x).canResize(x)&&!s.getShapeUtil(x).hideResizeHandles(x):!0)&&!U&&!m,ee=P||k,Q=P&&k,ae=R||j,ue=V||U,he=!H,_e=!z||!q,Pe=!z||!ue,qt=!z||!ue||ee,nt=!z||!ue||ee,oe=!z||!ue||Q&&!U;let Ge=!0,jt=!0;if(U)Ge=ae,jt=ae;else if(V){Ge=ee||Q||y;const Xo=y&&x&&x.type==="text";jt=Ge&&!Xo}const xn=Math.min(24/w,I-$*3),Su=z&&y&&x&&s.isShapeOfType(x,"text")&&xn*w>=4;return a.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:a.jsxs("g",{ref:i,children:[D&&a.jsx("rect",{className:"tl-selection__fg__outline",width:G(C),height:G(I)}),a.jsx(Dg,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:B,corner:"top_left_rotate",cursor:g?Ks("nwse-rotate",n):void 0,isHidden:he}),a.jsx(Dg,{"data-testid":"selection.rotate.top-right",cx:C+B*3,cy:0,targetSize:B,corner:"top_right_rotate",cursor:g?Ks("nesw-rotate",n):void 0,isHidden:he}),a.jsx(Dg,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:I+B*3,targetSize:B,corner:"bottom_left_rotate",cursor:g?Ks("swne-rotate",n):void 0,isHidden:he}),a.jsx(Dg,{"data-testid":"selection.rotate.bottom-right",cx:C+B*3,cy:I+B*3,targetSize:B,corner:"bottom_right_rotate",cursor:g?Ks("senw-rotate",n):void 0,isHidden:he}),a.jsx(Ere,{"data-testid":"selection.rotate.mobile",cx:N?-B*1.5:C/2,cy:N?I/2:-B*1.5,size:T,isHidden:_e}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":Ge}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:G(0-(O?$*2:$)),width:G(C),height:G(Math.max(1,$*2)),style:g?{cursor:Ks("ns-resize",n)}:void 0,...o}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":jt}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:G(C-(N?0:L)),y:0,height:G(I),width:G(Math.max(1,L*2)),style:g?{cursor:Ks("ew-resize",n)}:void 0,...l}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":Ge}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:G(I-(O?0:$)),width:G(C),height:G(Math.max(1,$*2)),style:g?{cursor:Ks("ns-resize",n)}:void 0,...c}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":jt}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:G(0-(N?L*2:L)),y:0,height:G(I),width:G(Math.max(1,L*2)),style:g?{cursor:Ks("ew-resize",n)}:void 0,...d}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":Pe}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:G(0-(N?L*2:L*1.5)),y:G(0-(O?$*2:$*1.5)),width:G(L*3),height:G($*3),style:g?{cursor:Ks("nwse-resize",n)}:void 0,...u}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":qt}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:G(C-(N?0:L*1.5)),y:G(0-(O?$*2:$*1.5)),width:G(L*3),height:G($*3),style:g?{cursor:Ks("nesw-resize",n)}:void 0,...h}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":oe}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:G(C-(N?L:L*1.5)),y:G(I-(O?$:$*1.5)),width:G(L*3),height:G($*3),style:g?{cursor:Ks("nwse-resize",n)}:void 0,...p}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":nt}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:G(0-(N?L*3:L*1.5)),y:G(I-(O?0:$*1.5)),width:G(L*3),height:G($*3),style:g?{cursor:Ks("nesw-resize",n)}:void 0,...f}),V&&a.jsxs(a.Fragment,{children:[a.jsx("rect",{"data-testid":"selection.resize.top-left",className:Se("tl-corner-handle",{"tl-hidden":Pe}),"aria-label":"top_left handle",x:G(0-T/2),y:G(0-T/2),width:G(T),height:G(T)}),a.jsx("rect",{"data-testid":"selection.resize.top-right",className:Se("tl-corner-handle",{"tl-hidden":qt}),"aria-label":"top_right handle",x:G(C-T/2),y:G(0-T/2),width:G(T),height:G(T)}),a.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:Se("tl-corner-handle",{"tl-hidden":oe}),"aria-label":"bottom_right handle",x:G(C-T/2),y:G(I-T/2),width:G(T),height:G(T)}),a.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:Se("tl-corner-handle",{"tl-hidden":nt}),"aria-label":"bottom_left handle",x:G(0-T/2),y:G(I-T/2),width:G(T),height:G(T)})]}),Su&&a.jsxs(a.Fragment,{children:[a.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:G(0-T/4),y:G(I/2-xn/2),rx:T/4,width:G(T/2),height:G(xn)}),a.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:T/4,x:G(C-T/4),y:G(I/2-xn/2),width:G(T/2),height:G(xn)})]}),U&&a.jsx(wre,{size:T,width:C,height:I,hideAlternateHandles:ae})]})})}),Dg=function({cx:e,cy:n,targetSize:s,corner:i,cursor:r,isHidden:o,"data-testid":l}){const c=vr(i);return a.jsx("rect",{className:Se("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":l,"aria-label":`${i} target`,pointerEvents:"all",x:G(e-s*3),y:G(n-s*3),width:G(Math.max(1,s*3)),height:G(Math.max(1,s*3)),cursor:r,...c})},Cre=Math.sqrt(Math.PI),Ere=function({cx:e,cy:n,size:s,isHidden:i,"data-testid":r}){const o=vr("mobile_rotate"),l=K(),c=Z("zoom level",()=>l.getZoomLevel(),[l]),d=Math.max(14*(1/c),20/Math.max(1,c));return a.jsxs("g",{children:[a.jsx("circle",{"data-testid":r,pointerEvents:"all",className:Se("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:e,cy:n,r:d,...o}),a.jsx("circle",{className:Se("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:e,cy:n,r:s/Cre})]})};function Tre(){const t=K();return Z("is in a valid select state",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[t])?a.jsx(r5,{}):null}function sC(t,e,n){const{arrowheadStart:s,arrowheadEnd:i}=e.props,r=td(t,e,n),o=r.start.clone(),l=r.end.clone(),c=E.Med(o,l);if(E.Equals(o,l))return{bindings:n,isStraight:!0,start:{handle:o,point:o,arrowhead:e.props.arrowheadStart},end:{handle:l,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const d=E.Sub(l,o).uni(),u=fv(t,e,"start"),h=fv(t,e,"end"),p=t.getShapePageTransform(e);zN(l,r.start,p,h),zN(o,r.end,p,u);let f=0,g=0,y=0,x=0,m=nd*e.props.scale;const v=u&&h&&u.shape===h.shape,w=u&&h?l1(t,u.shape.id,h.shape.id):"safe";w==="safe"&&u&&h&&!v&&!u.isExact&&!h.isExact&&(h.didIntersect&&!u.didIntersect?u.isClosed&&o.setTo(l.clone().add(d.clone().mul(nd*e.props.scale))):h.didIntersect||h.isClosed&&l.setTo(o.clone().sub(d.clone().mul(nd*e.props.scale))));const _=E.Sub(l,o),C=E.Len(_)?_.uni():E.From(_),I=!E.Equals(C,d);v||(w!=="start-contains-end"&&u&&s!=="none"&&!u.isExact&&(y=Sa[e.props.size]/2+("size"in u.shape.props?Sa[u.shape.props.size]/2:0),f=(gv+y)*e.props.scale,m+=y*e.props.scale),w!=="end-contains-start"&&h&&i!=="none"&&!h.isExact&&(x=Sa[e.props.size]/2+("size"in h.shape.props?Sa[h.shape.props.size]/2:0),g=(gv+x)*e.props.scale,m+=x*e.props.scale));const T=o.clone().add(C.clone().mul(f*(I?-1:1))),P=l.clone().sub(C.clone().mul(g*(I?-1:1)));E.DistMin(T,P,m)&&(f!==0&&g!==0?(f*=-1.5,g*=-1.5):f!==0?f*=-1:g!==0&&(g*=-1)),o.add(C.clone().mul(f*(I?-1:1))),l.sub(C.clone().mul(g*(I?-1:1))),I?(u&&h&&l.setTo(E.Add(o,C.clone().mul(-nd*e.props.scale))),c.setTo(E.Med(r.start,r.end))):c.setTo(E.Med(o,l));const k=E.Dist(o,l);return{bindings:n,isStraight:!0,start:{handle:r.start,point:o,arrowhead:e.props.arrowheadStart},end:{handle:r.end,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:k>0,length:k}}function zN(t,e,n,s){if(s===void 0||s.isExact)return;const i=ve.applyToPoint(n,e),r=ve.applyToPoint(n,t),o=ve.applyToPoint(ve.Inverse(s.transform),i),l=ve.applyToPoint(ve.Inverse(s.transform),r),c=s.isClosed,u=(c?XT:cse)(o,l,s.outline);let h;if(u!==null&&(h=u.sort((g,y)=>E.Dist2(g,o)-E.Dist2(y,o))[0]??(c?void 0:l)),h===void 0)return;const p=ve.applyToPoint(s.transform,h),f=ve.applyToPoint(ve.Inverse(n),p);t.setTo(f),s.didIntersect=!0}function Ire(t,e,n){const{arrowheadEnd:s,arrowheadStart:i}=e.props,r=e.props.bend;if(Math.abs(r)>Math.abs(e.props.bend*(Are*e.props.scale)))return sC(t,e,n);const o=td(t,e,n),l=E.Med(o.start,o.end),c=E.Sub(o.end,o.start),d=E.Len(c)?c.uni():E.From(c),u=E.Add(l,d.per().mul(-r)),h=fv(t,e,"start"),p=fv(t,e,"end"),f=o.start.clone(),g=o.end.clone(),y=u.clone();if(E.Equals(f,g))return{bindings:n,isStraight:!0,start:{handle:f,point:f,arrowhead:e.props.arrowheadStart},end:{handle:g,point:g,arrowhead:e.props.arrowheadEnd},middle:y,isValid:!1,length:0};const x=e.props.bend<0,m=x?pf:FF,v=WN(f,g,y),w=E.Angle(v.center,f),_=E.Angle(v.center,g),C=m(w,_);if(v.length===0||v.size===0||!iN(v.length)||!iN(v.size))return sC(t,e,n);const I=f.clone(),T=g.clone(),P=y.clone(),k=t.getShapePageTransform(e);let N=0,O=0,R=nd*e.props.scale;if(h&&!h.isExact){const U=ve.applyToPoint(k,I),z=ve.applyToPoint(k,v.center),H=ve.applyToPoint(k,T),q=ve.Inverse(h.transform),V=ve.applyToPoint(q,U),ee=ve.applyToPoint(q,z),Q=ve.applyToPoint(q,H),{isClosed:ae}=h,ue=ae?J_:EN;let he,_e=ue(ee,v.radius,h.outline);if(_e){const Pe=ee.angle(V),qt=ee.angle(Q),nt=m(Pe,qt);_e=_e.filter(Ge=>m(Pe,ee.angle(Ge))<=nt);const oe=nt*.25;_e.sort(ae?(Ge,jt)=>Math.abs(m(Pe,ee.angle(Ge))-oe)<Math.abs(m(Pe,ee.angle(jt))-oe)?-1:1:(Ge,jt)=>m(Pe,ee.angle(Ge))<m(Pe,ee.angle(jt))?-1:1),he=_e[0]??(ae?void 0:V)}else he=ae?void 0:V;if(he&&(I.setTo(t.getPointInShapeSpace(e,ve.applyToPoint(h.transform,he))),h.didIntersect=!0,i!=="none")){const Pe=Sa[e.props.size]/2+("size"in h.shape.props?Sa[h.shape.props.size]/2:0);N=(gv+Pe)*e.props.scale,R+=Pe*e.props.scale}}if(p&&!p.isExact){const U=ve.applyToPoint(k,I),z=ve.applyToPoint(k,T),H=ve.applyToPoint(k,v.center),q=ve.Inverse(p.transform),V=ve.applyToPoint(q,U),ee=ve.applyToPoint(q,H),Q=ve.applyToPoint(q,z),ae=p.isClosed,ue=ae?J_:EN;let he,_e=ue(ee,v.radius,p.outline);if(_e){const Pe=ee.angle(V),qt=ee.angle(Q),nt=m(Pe,qt),oe=nt*.75;_e=_e.filter(Ge=>m(Pe,ee.angle(Ge))<=nt),_e.sort(ae?(Ge,jt)=>Math.abs(m(Pe,ee.angle(Ge))-oe)<Math.abs(m(Pe,ee.angle(jt))-oe)?-1:1:(Ge,jt)=>m(Pe,ee.angle(Ge))<m(Pe,ee.angle(jt))?-1:1),_e[0]?he=_e[0]:he=ae?void 0:Q}else he=ae?void 0:Q;if(he&&(T.setTo(t.getPointInShapeSpace(e,ve.applyToPoint(p.transform,he))),p.didIntersect=!0,s!=="none")){const Pe=Sa[e.props.size]/2+("size"in p.shape.props?Sa[p.shape.props.size]/2:0);O=(gv+Pe)*e.props.scale,R+=Pe*e.props.scale}}let j=E.Angle(v.center,I),A=E.Angle(v.center,T),B=m(j,A),L=B*v.radius;const $=I.clone(),M=T.clone();if(N!==0&&$.setTo(v.center).add(E.FromAngle(j+B*(N/L*(x?1:-1))).mul(v.radius)),O!==0&&M.setTo(v.center).add(E.FromAngle(A+B*(O/L*(x?-1:1))).mul(v.radius)),E.DistMin($,M,R)&&(N!==0&&O!==0?(N*=-1.5,O*=-1.5):N!==0?N*=-2:O!==0&&(O*=-2)),N!==0&&I.setTo(v.center).add(E.FromAngle(j+B*(N/L*(x?1:-1))).mul(v.radius)),O!==0&&T.setTo(v.center).add(E.FromAngle(A+B*(O/L*(x?-1:1))).mul(v.radius)),h&&p&&!h.isExact&&!p.isExact){j=E.Angle(v.center,I),A=E.Angle(v.center,T),B=m(j,A),L=B*v.radius;const U=l1(t,h.shape.id,p.shape.id);U==="double-bound"&&L<30?(I.setTo(f),T.setTo(g),P.setTo(y)):U==="safe"&&(h&&!h.didIntersect&&I.setTo(f),(p&&!p.didIntersect||m(w,j)>m(w,A))&&T.setTo(v.center).add(E.FromAngle(j+B*(Math.min(.9,nd*e.props.scale/L)*(x?1:-1))).mul(v.radius)))}Pre(v.center,v.radius,I,T,P,C,x),I.equals(T)&&(I.setTo(P.clone().addXY(1,1)),T.setTo(P.clone().subXY(1,1))),f.setTo(I),g.setTo(T),y.setTo(P);const D=WN(f,g,y);return{bindings:n,isStraight:!1,start:{point:f,handle:o.start,arrowhead:e.props.arrowheadStart},end:{point:g,handle:o.end,arrowhead:e.props.arrowheadEnd},middle:y,handleArc:v,bodyArc:D,isValid:D.length!==0&&isFinite(D.center.x)&&isFinite(D.center.y)}}function WN(t,e,n){const s=$T(t,e,n),i=E.Dist(s,t),r=+E.Clockwise(t,n,e),o=((t.y-e.y)**2+(t.x-e.x)**2)**.5,l=((e.y-n.y)**2+(e.x-n.x)**2)**.5,c=((n.y-t.y)**2+(n.x-t.x)**2)**.5,d=Math.acos((l*l+c*c-o*o)/(2*l*c))*2,u=+(Ze>d),h=(tt-d)*(r?1:-1),p=h*i;return{center:s,radius:i,size:h,length:p,largeArcFlag:u,sweepFlag:r}}function Pre(t,e,n,s,i,r,o){const l=E.Angle(t,n),c=E.Angle(t,s);let d=pf(l,c);if(o||(d=tt-d),i.setTo(t).add(E.FromAngle(l+d*(.5*(o?1:-1))).mul(e)),d>r){i.rotWith(t,Ze);const u=s.clone();s.setTo(n),n.setTo(u)}}const kre=8;function jre(t){return Math.abs(t.props.bend)<kre*t.props.scale}function fv(t,e,n){const s=t.getBindingsFromShape(e,"arrow").find(c=>c.props.terminal===n);if(!s)return;const i=t.getShape(s.toId);if(!i)return;const r=t.getShapePageTransform(i),o=t.getShapeGeometry(i),l=o instanceof sr?o.children[0].vertices:o.vertices;return{shape:i,transform:r,isClosed:o.isClosed,isExact:s.props.isExact,didIntersect:!1,outline:l}}function HN(t,e,n,s){const i=t.getShape(n.toId);if(i){const{point:r,size:o}=t.getShapeGeometry(i).bounds,l=E.Add(r,E.MulV(n.props.isPrecise||s?n.props.normalizedAnchor:{x:.5,y:.5},o)),c=ve.applyToPoint(t.getShapePageTransform(i),l);return ve.applyToPoint(ve.Inverse(e),c)}else return new E(0,0)}function As(t,e){const n=t.getBindingsFromShape(e,"arrow");return{start:n.find(s=>s.props.terminal==="start"),end:n.find(s=>s.props.terminal==="end")}}const Nre=uQ("arrow info",(t,e)=>{const n=As(t,e);return jre(e)?sC(t,e,n):Ire(t,e,n)});function Ir(t,e){const n=typeof e=="string"?e:e.id;return Nre.get(t,n)}function td(t,e,n){var l,c;const s=t.getShapePageTransform(e),i=l1(t,(l=n.start)==null?void 0:l.toId,(c=n.end)==null?void 0:c.toId),r=n.start?HN(t,s,n.start,i==="double-bound"||i==="start-contains-end"):E.From(e.props.start),o=n.end?HN(t,s,n.end,i==="double-bound"||i==="end-contains-start"):E.From(e.props.end);return{start:r,end:o}}function Hu(t,e,n,s){const i=typeof e=="string"?e:e.id,r=typeof n=="string"?n:n.id,o=t.getBindingsFromShape(i,"arrow").filter(c=>c.props.terminal===s.terminal);o.length>1&&t.deleteBindings(o.slice(1));const l=o[0];l?t.updateBinding({...l,toId:r,props:s}):t.createBinding({type:"arrow",fromId:i,toId:r,props:s})}function Lm(t,e,n){const s=t.getBindingsFromShape(e,"arrow").filter(i=>i.props.terminal===n);t.deleteBindings(s)}const nd=10,gv=10,Are=10,Sa={s:2,m:3.5,l:5,xl:10};function l1(t,e,n){if(!e||!n)return"safe";if(e===n)return"double-bound";const s=t.getShapePageBounds(e),i=t.getShapePageBounds(n);if(s&&i){if(s.contains(i))return"start-contains-end";if(i.contains(s))return"end-contains-start"}return"safe"}class Fm extends Om{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){dw(this.editor,this.editor.getShape(e.fromId))}onAfterChange({bindingAfter:e}){dw(this.editor,this.editor.getShape(e.fromId))}onAfterChangeFromShape({shapeAfter:e}){dw(this.editor,e)}onAfterChangeToShape({binding:e}){K5(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const n=this.editor.getShape(e.fromId);n&&mv({editor:this.editor,arrow:n,terminal:e.props.terminal})}}b(Fm,"type","arrow"),b(Fm,"props",iF),b(Fm,"migrations",rF);function K5(t,e){var x;const n=t.getShape(e);if(!n)return;const s=As(t,n),{start:i,end:r}=s,o=i?t.getShape(i.toId):void 0,l=r?t.getShape(r.toId):void 0,c=t.getAncestorPageId(n);if(!c)return;let d;if(o&&l)d=t.findCommonAncestor([o,l])??c;else if(o||l){const m=(x=o||l)==null?void 0:x.parentId;m&&m===n.parentId?d=n.parentId:d=c}else return;d&&d!==n.parentId&&t.reparentShapes([e],d);const u=t.getShape(e);if(!u)throw Error("no reparented arrow");const h=t.getShapeNearestSibling(u,o),p=t.getShapeNearestSibling(u,l);let f;if(h&&p)f=h.index>p.index?h:p;else if(h&&!p)f=h;else if(p&&!h)f=p;else return;let g;const y=t.getSortedChildIdsForParent(f.parentId).map(m=>t.getShape(m)).filter(m=>m.index>f.index);if(y.length){const m=y.find(v=>v.type!=="arrow");if(u.index>f.index&&(!m||u.index<m.index))return;g=_p(f.index,y[0].index)}else g=Vi(f.index);g!==u.index&&t.updateShapes([{id:e,type:"arrow",index:g}])}function dw(t,e){const n=As(t,e);for(const s of["start","end"]){const i=n[s];if(!i)continue;const r=t.getShape(i.toId),o=t.getAncestorPageId(e)===t.getAncestorPageId(r);(!r||!o)&&mv({editor:t,arrow:e,terminal:s,unbind:!0})}K5(t,e.id)}function mv({editor:t,arrow:e,terminal:n,unbind:s=!1,useHandle:i=!1}){const r=Ir(t,e);if(!r)throw new Error("expected arrow info");const o=i?r.start.handle:r.start.point,l=i?r.end.handle:r.end.point,c=n==="start"?o:l,d={id:e.id,type:"arrow",props:{[n]:{x:c.x,y:c.y},bend:e.props.bend}};if(!r.isStraight){const u=n==="start"?o:r.start.handle,h=n==="end"?l:r.end.handle,p=E.Med(u,h),f=E.Sub(u,h).per().uni().mul(r.handleArc.radius*2*Math.sign(e.props.bend)),g=vf(r.handleArc.center,E.Add(p,f),r.handleArc.center,r.handleArc.radius);xt((g==null?void 0:g.length)===1);const y=E.Dist(p,g[0])*Math.sign(e.props.bend);Ra(y,d.props.bend)||(d.props.bend=y)}t.updateShape(d),s&&Lm(t,e,n)}const Y5=[Fm],An={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},hn={s:2,m:3.5,l:5,xl:10},Md={s:18,m:24,l:36,xl:44},_o={s:18,m:22,l:26,xl:32},Rre={s:18,m:20,l:24,xl:28},Dr={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},Mre=20,Ore=4.25,xi=16;/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Dre(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var s,i,r,o,l=[],c=!0,d=!1;try{if(r=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(s=r.call(n)).done)&&(l.push(s.value),l.length!==e);c=!0);}catch(u){d=!0,i=u}finally{try{if(!c&&n.return!=null&&(o=n.return(),Object(o)!==o))return}finally{if(d)throw i}}return l}}function GN(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,s)}return n}function Ys(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?GN(Object(n),!0).forEach(function(s){Lre(t,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GN(Object(n)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(n,s))})}return t}function Lre(t,e,n){return e=Vre(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Fre(t,e){if(t==null)return{};var n={},s=Object.keys(t),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Bre(t,e){if(t==null)return{};var n=Fre(t,e),s,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(t,s)&&(n[s]=t[s])}return n}function VN(t,e){return $re(t)||Dre(t,e)||X5(t,e)||Hre()}function Lg(t){return Ure(t)||zre(t)||X5(t)||Wre()}function Ure(t){if(Array.isArray(t))return iC(t)}function $re(t){if(Array.isArray(t))return t}function zre(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function X5(t,e){if(t){if(typeof t=="string")return iC(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return iC(t,e)}}function iC(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function Wre(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hre(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gre(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var s=n.call(t,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function Vre(t){var e=Gre(t,"string");return typeof e=="symbol"?e:String(e)}function Vh(t){var e=t.sizes.shift(),n=Math.max(Math.ceil(e[0]),1),s=Math.max(Math.ceil(e[1]),1),i=[n-1,s-1,1,1],r=Date.now(),o=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,l,c;o?(l=new OffscreenCanvas(1,1),c=new OffscreenCanvas(n,s)):(l=document.createElement("canvas"),l.width=1,l.height=1,c=document.createElement("canvas"),c.width=n,c.height=s);var d=l.getContext("2d"),u=c.getContext("2d");u&&(u.fillRect.apply(u,i),d.drawImage(c,n-1,s-1,1,1,0,0,1,1));var h=d&&d.getImageData(0,0,1,1).data[3]!==0,p=Date.now()-r;return[l,c].forEach(function(f){f.height=0,f.width=0}),o?(postMessage({width:n,height:s,benchmark:p,isTestPass:h}),!h&&t.sizes.length&&Vh(t)):h?t.onSuccess(n,s,p):(t.onError(n,s,p),t.sizes.length&&Vh(t)),h}var uw={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},Kre=["onError","onSuccess"],sd={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Gu={};function hw(t){var e=t.width===t.height,n=t.height===1,s=t.width===1,i=[];if(!t.width||!t.height)t.sizes.forEach(function(u){var h=e||n?u:1,p=e||s?u:1;i.push([h,p])});else for(var r=t.min||sd.min,o=t.step||sd.step,l=Math.max(t.width,t.height);l>=r;){var c=e||n?l:1,d=e||s?l:1;i.push([c,d]),l-=o}return i}function Fg(t){var e=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,s=Date.now(),i=t.onError,r=t.onSuccess,o=Bre(t,Kre),l=null;if(!e)return!1;if(t.useWorker&&n){var c=`
            var canvasTest = `.concat(Vh.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),d=new Blob([c],{type:"application/javascript"}),u=URL.createObjectURL(d);l=new Worker(u),URL.revokeObjectURL(u),l.onmessage=function(h){var p=h.data,f=p.width,g=p.height,y=p.benchmark,x=p.isTestPass;x?(Gu[s].onSuccess(f,g,y),delete Gu[s]):Gu[s].onError(f,g,y)}}if(t.usePromise)return new Promise(function(h,p){var f=Ys(Ys({},t),{},{onError:function(m,v,w){var _;if(t.sizes.length===0)_=!0;else{var C=t.sizes.slice(-1),I=VN(C,1),T=VN(I[0],2),P=T[0],k=T[1];_=m===P&&v===k}i(m,v,w),_&&p({width:m,height:v,benchmark:w})},onSuccess:function(m,v,w){r(m,v,w),h({width:m,height:v,benchmark:w})}});if(l){var g=f.onError,y=f.onSuccess;Gu[s]={onError:g,onSuccess:y},l.postMessage(o)}else Vh(f)});if(l)Gu[s]={onError:i,onSuccess:r},l.postMessage(o);else return Vh(t)}var pw={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=hw({width:e.max,height:e.max,min:e.min,step:e.step,sizes:Lg(uw.area)}),s=Ys(Ys(Ys({},sd),e),{},{sizes:n});return Fg(s)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=hw({width:1,height:e.max,min:e.min,step:e.step,sizes:Lg(uw.height)}),s=Ys(Ys(Ys({},sd),e),{},{sizes:n});return Fg(s)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=hw({width:e.max,height:1,min:e.min,step:e.step,sizes:Lg(uw.width)}),s=Ys(Ys(Ys({},sd),e),{},{sizes:n});return Fg(s)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=Ys(Ys({},sd),e);return n.sizes=Lg(n.sizes),n.width&&n.height&&(n.sizes=[[n.width,n.height]]),Fg(n)}};let fw=null;function Yre(){return fw||(fw=Xre()),fw}async function Xre(){const t=await pw.maxWidth({usePromise:!0}),e=await pw.maxHeight({usePromise:!0}),n=await pw.maxArea({usePromise:!0});return{maxWidth:t.width,maxHeight:e.height,maxArea:n.width*n.height}}const KN=8192,qre=4096*4096;async function Zre(t,e){if(t<=KN&&e<=KN&&t*e<=qre)return[t,e];const{maxWidth:n,maxHeight:s,maxArea:i}=await Yre(),r=t/e;if(t>n&&(t=n,e=t/r),e>s&&(e=s,t=e*r),t*e>i){const o=Math.sqrt(i/(t*e));t*=o,e*=o}return[t,e]}function Jre(t,e){const n=t.w/e.w,s=t.h/e.h;return n<=1&&s<=1?t:n>s?{w:t.w/n,h:t.h/n}:{w:t.w/s,h:t.h/s}}function Qre(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function eoe(t){const e=new URL(t).host.replace("www.","");for(const n of hf)if(q5(n.hostnames,e)){const s=n.fromEmbedUrl(t);if(s)return{definition:n,url:s,embedUrl:t}}}const toe=t=>t.split("*").map(e=>Qre(e)).join(".+"),q5=(t,e)=>!!t.find(n=>{const s=new RegExp(toe(n));return e.match(s)});function noe(t){const e=new URL(t).host.replace("www.","");for(const n of hf)if(q5(n.hostnames,e)){const s=n.toEmbedUrl(t);if(s)return{definition:n,embedUrl:s,url:t}}}function Z5(t){return noe(t)??eoe(t)}function ba(t){try{return Z5(t)}catch(e){console.error(e)}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const id="  ",rs=class rs{static insertTextFirefox(e,n){e.setRangeText(n,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:n,inputType:"insertText",isComposing:!1}))}static insert(e,n){const s=e.ownerDocument,i=s.activeElement;i!==e&&e.focus(),s.execCommand("insertText",!1,n)||rs.insertTextFirefox(e,n),i===s.body?e.blur():i instanceof HTMLElement&&i!==e&&i.focus()}static set(e,n){e.select(),rs.insert(e,n)}static getSelection(e){const{selectionStart:n,selectionEnd:s}=e;return e.value.slice(n||void 0,s||void 0)}static wrapSelection(e,n,s){const{selectionStart:i,selectionEnd:r}=e,o=rs.getSelection(e);rs.insert(e,n+o+(s??n)),e.selectionStart=(i||0)+n.length,e.selectionEnd=(r||0)+n.length}static replace(e,n,s){let i=0;e.value.replace(n,(...r)=>{const o=i+r[r.length-2],l=r[0].length;e.selectionStart=o,e.selectionEnd=o+l;const c=typeof s=="string"?s:s(...r);return rs.insert(e,c),e.selectionStart=o,i+=c.length-l,c})}static findLineEnd(e,n){const s=e.lastIndexOf(`
`,n-1)+1;return e.charAt(s)!=="	"?n:s+1}static indent(e){var l;const{selectionStart:n,selectionEnd:s,value:i}=e,r=i.slice(n,s),o=(l=/\n/g.exec(r))==null?void 0:l.length;if(o&&o>0){const c=i.lastIndexOf(`
`,n-1)+1,d=e.value.slice(c,s-1),u=d.replace(/^|\n/g,`$&${id}`),h=u.length-d.length;e.setSelectionRange(c,s-1),rs.insert(e,u),e.setSelectionRange(n+1,s+h)}else rs.insert(e,id)}static unindent(e){const{selectionStart:n,selectionEnd:s,value:i}=e,r=i.lastIndexOf(`
`,n-1)+1,o=rs.findLineEnd(i,s),l=e.value.slice(r,o),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=l.length-c.length;e.setSelectionRange(r,o),rs.insert(e,c);const u=/\t| {1,2}/.exec(i.slice(r,n)),h=u?u[0].length:0,p=n-h;e.setSelectionRange(n-h,Math.max(p,s-d))}static indentCE(e){var c;const n=window.getSelection(),s=e.innerText,i=Bg(e)??0,r=Bg(e)??0,o=s.slice(i,r),l=(c=/\n/g.exec(o))==null?void 0:c.length;if(l&&l>0){const d=s.lastIndexOf(`
`,i-1)+1,u=s.slice(d,r-1),p=u.replace(/^|\n/g,`$&${id}`).length-u.length;n&&n.setBaseAndExtent(e,i+1,e,r+p)}else{const d=window.getSelection();e.innerText=s.slice(0,i)+id+s.slice(i),d==null||d.setBaseAndExtent(e,i+1,e,i+2)}}static unindentCE(e){const n=window.getSelection(),s=e.innerText,i=Bg(e)??0,r=Bg(e)??0,o=s.lastIndexOf(`
`,i-1)+1,l=rs.findLineEnd(s,r),c=s.slice(o,l),d=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=c.length-d.length;if(n){n.setBaseAndExtent(e,o,e,l);const h=/\t| {1,2}/.exec(s.slice(o,i)),p=h?h[0].length:0,f=i-p;n.setBaseAndExtent(e,i-p,e,Math.max(f,r-u))}}static normalizeText(e){return e.replace(rs.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(rs.fixNewLines,`
`).split(`
`).map(n=>n||" ").join(`
`)}};b(rs,"fixNewLines",/\r?\n|\r/g);let Od=rs;function Bg(t){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let n=0;if(e.rangeCount!==0){const s=e.getRangeAt(0),i=s.cloneRange();i.selectNodeContents(t),i.setEnd(s.endContainer,s.endOffset),n=i.toString().length}return n}const soe=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function J5(t){return soe.test(t)}function ioe(t){return t.replace(/\t/g,id)}function roe(t){const e=t.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let n=1/0;for(const s of e)if(s.trim().length>0){const i=s.length-s.trimStart().length;n=Math.min(n,i)}return e.map(s=>s.slice(n)).join(`
`)}function ooe(t){return t.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function aoe(t){return ooe(roe(ioe(t)))}function loe(t,{maxImageDimension:e,maxAssetSize:n,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:i},{toasts:r,msg:o}){t.registerExternalAssetHandler("file",async({file:l})=>{const c=l.name;let d=l;const u=s.includes(d.type),h=i.includes(d.type);!u&&!h&&r.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),xt(u||h,`File type not allowed: ${d.type}`),d.size>n&&r.addToast({title:o("assets.files.size-too-big"),severity:"error"}),xt(d.size<=n,`File size too big: ${(d.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),d.type==="video/quicktime"&&(d=new File([d],d.name,{type:"video/mp4"}));let p=u?await Er.getImageSize(d):await Er.getVideoSize(d);const f=await Er.isAnimated(d)||h,g=RJ(await d.arrayBuffer());if(isFinite(e)){const m=Jre(p,{w:e,h:e});p!==m&&Er.isStaticImageType(d.type)&&(p=m)}const x={id:kl.createId(g),type:u?"image":"video",typeName:"asset",props:{name:c,src:"",w:p.w,h:p.h,fileSize:d.size,mimeType:d.type,isAnimated:f}};return x.props.src=await t.uploadAsset(x,d),kl.create(x)}),t.registerExternalAssetHandler("url",async({url:l})=>{var d,u,h,p,f;let c;try{const y=await(await Ur(l,{method:"GET",mode:"no-cors"})).text(),x=new DOMParser().parseFromString(y,"text/html");c={image:((d=x.head.querySelector('meta[property="og:image"]'))==null?void 0:d.getAttribute("content"))??"",favicon:((u=x.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:u.getAttribute("href"))??((h=x.head.querySelector('link[rel="icon"]'))==null?void 0:h.getAttribute("href"))??"",title:((p=x.head.querySelector('meta[property="og:title"]'))==null?void 0:p.getAttribute("content"))??l,description:((f=x.head.querySelector('meta[property="og:description"]'))==null?void 0:f.getAttribute("content"))??""},c.image.startsWith("http")||(c.image=new URL(c.image,l).href),c.favicon.startsWith("http")||(c.favicon=new URL(c.favicon,l).href)}catch(g){console.error(g),r.addToast({title:o("assets.url.failed"),severity:"error"}),c={image:"",favicon:"",title:"",description:""}}return{id:kl.createId(F_(l)),typeName:"asset",type:"bookmark",props:{src:l,description:c.description,image:c.image,favicon:c.favicon,title:c.title},meta:{}}}),t.registerExternalContentHandler("svg-text",async({point:l,text:c})=>{const d=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),u=new DOMParser().parseFromString(c,"image/svg+xml").querySelector("svg");if(!u)throw new Error("No <svg/> element present");let h=parseFloat(u.getAttribute("width")||"0"),p=parseFloat(u.getAttribute("height")||"0");if(!(h&&p)){document.body.appendChild(u);const g=u.getBoundingClientRect();document.body.removeChild(u),h=g.width,p=g.height}const f=await t.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});if(!f)throw Error("Could not create an asset");YN(t,[f],d)}),t.registerExternalContentHandler("embed",({point:l,url:c,embed:d})=>{const u=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),{width:h,height:p}=d,f=it(),g={id:f,type:"embed",x:u.x-(h||450)/2,y:u.y-(p||450)/2,props:{w:h,h:p,url:c}};t.createShapes([g]).select(f)}),t.registerExternalContentHandler("files",async({point:l,files:c})=>{const d=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),u=new E(d.x,d.y),h=[];await Promise.all(c.map(async(p,f)=>{if(p.size>n)return r.addToast({title:o("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(p.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),null;if(!p.type)throw new Error("No mime type");if(!s.concat(i).includes(p.type))return r.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${p.name} not loaded - Extension not allowed.`),null;try{const g=await t.getAssetForExternalContent({type:"file",file:p});if(!g)throw Error("Could not create an asset");h[f]=g}catch(g){return r.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(g),null}})),YN(t,Re(h),u)}),t.registerExternalContentHandler("text",async({point:l,text:c})=>{const d=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),u=t.getShapeUtil("text").getDefaultProps(),h=aoe(c),p=t.getOnlySelectedShape();if(p&&"text"in p.props){t.updateShapes([{id:p.id,type:p.type,props:{text:h}}]);return}let f,g,y,x="middle";const m=h.split(`
`).length>1,v=J5(h);m&&(x=m?v?"end":"start":"middle");const w=t.textMeasure.measureText(h,{...An,fontFamily:Dr[u.font],fontSize:Md[u.size],maxWidth:null}),_=Math.min(m?t.getViewportPageBounds().width*.9:920,Math.max(200,t.getViewportPageBounds().width*.9));if(w.w>_){const C=t.textMeasure.measureText(h,{...An,fontFamily:Dr[u.font],fontSize:Md[u.size],maxWidth:_});f=C.w,g=C.h,y=!1,x=v?"end":"start"}else f=w.w,g=w.h,y=!0;d.y-g/2<t.getViewportPageBounds().minY+40&&(d.y=t.getViewportPageBounds().minY+40+g/2),t.createShapes([{id:it(),type:"text",x:d.x-f/2,y:d.y-g/2,props:{text:h,textAlign:x,autoSize:y,w:f}}])}),t.registerExternalContentHandler("url",async({point:l,url:c})=>{const d=ba(c);if(d)return t.putExternalContent({type:"embed",url:d.url,point:l,embed:d.definition});const u=l??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.getViewportPageBounds().center),h=kl.createId(F_(c)),p=coe(t,c,u);let f=t.getAsset(h),g=!1;if(!f){g=!0;try{const y=await t.getAssetForExternalContent({type:"url",url:c});if(!y)throw Error("Could not create an asset");f=y}catch{r.addToast({title:o("assets.url.failed"),severity:"error"});return}}t.run(()=>{g&&t.createAssets([f]),t.updateShapes([{id:p.id,type:p.type,props:{assetId:f.id}}])})})}async function YN(t,e,n){if(!e.length)return[];const s=E.From(n),i=[];for(let r=0;r<e.length;r++){const o=e[r];switch(o.type){case"bookmark":{i.push({id:it(),type:"bookmark",x:s.x,y:s.y,opacity:1,props:{assetId:o.id,url:o.props.src}}),s.x+=300;break}case"image":{i.push({id:it(),type:"image",x:s.x,y:s.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),s.x+=o.props.w;break}case"video":i.push({id:it(),type:"video",x:s.x,y:s.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),s.x+=o.props.w}}return t.run(()=>{const r=e.filter(o=>!t.getAsset(o.id));r.length&&t.createAssets(r),t.createShapes(i).select(...i.map(o=>o.id)),Q5(t,n)}),i.map(r=>r.id)}function Q5(t,e){const n=t.getViewportPageBounds();let s=t.getSelectionPageBounds();if(s){const i=s.center.sub(e);t.updateShapes(t.getSelectedShapes().map(r=>{const o=t.getShapeParentTransform(r).decompose().rotation,l=E.Rot(i,-o);return{id:r.id,type:r.type,x:r.x-l.x,y:r.y-l.y}}))}s=t.getSelectionPageBounds(),s&&!n.contains(s)&&t.zoomToSelection()}function coe(t,e,n){const s={id:it(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:e}};return t.run(()=>{t.createShapes([s]).select(s.id),Q5(t,n)}),t.getShape(s.id)}var u0;let doe=(u0=class extends ye{constructor(){super(...arguments);b(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});b(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});b(this,"onCancel",()=>{this.editor.setCurrentTool("select")});b(this,"onKeyUp",n=>{var s;if(n.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape",{...n,target:"shape",shape:i}))}})}},b(u0,"id","idle"),u0);var h0;let uoe=(h0=class extends ye{constructor(){super(...arguments);b(this,"shape");b(this,"markId","");b(this,"onEnter",()=>{this.didTimeout=!1;const n=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:s=>!s.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:s,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});n?this.editor.setHintingShapes([n.id]):this.createArrowShape(),this.startPreciseTimeout()});b(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()});b(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,onInteractionEnd:"arrow"})}});b(this,"onPointerUp",()=>{this.cancel()});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.cancel()});b(this,"onInterrupt",()=>{this.cancel()});b(this,"preciseTimeout",-1);b(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var u;const{originPagePoint:n}=this.editor.inputs,s=it();this.markId=`creating:${s}`,this.editor.mark(this.markId),this.editor.createShape({id:s,type:"arrow",x:n.x,y:n.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(s);if(!i)throw Error("expected shape");const r=this.editor.getShapeHandles(i);if(!r)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),l=this.shape,c=r.find(h=>h.id==="start"),d=(u=o.onHandleDrag)==null?void 0:u.call(o,i,{handle:{...c,x:0,y:0},isPrecise:!0,initial:l});d&&this.editor.updateShapes([d]),this.shape=this.editor.getShape(s),this.editor.select(s)}updateArrowShapeEndHandle(){var i,r;const n=this.shape;if(!n)throw Error("expected shape");const s=this.editor.getShapeHandles(n);if(!s)throw Error("expected handles for arrow");{const o=this.editor.getShapeUtil("arrow"),l=this.shape,c=s.find(u=>u.id==="start"),d=(i=o.onHandleDrag)==null?void 0:i.call(o,n,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:l});d&&this.editor.updateShapes([d])}{const o=this.editor.getShapeUtil("arrow"),l=this.shape,c=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),d=s.find(h=>h.id==="end"),u=(r=o.onHandleDrag)==null?void 0:r.call(o,this.editor.getShape(n),{handle:{...d,x:c.x,y:c.y},isPrecise:!1,initial:l});u&&this.editor.updateShapes([u])}this.shape=this.editor.getShape(n.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},b(h0,"id","pointing"),h0);class Bm extends ye{constructor(){super(...arguments);b(this,"shapeType","arrow")}}b(Bm,"id","arrow"),b(Bm,"initial","idle"),b(Bm,"children",()=>[doe,uoe]);class c1 extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"initialShape");b(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");b(this,"util",this.editor.getShapeUtil(this.shapeType));b(this,"isPen",!1);b(this,"isPenOrStylus",!1);b(this,"segmentMode","free");b(this,"didJustShiftClickToExtendPreviousShapeLine",!1);b(this,"pagePointWhereCurrentSegmentChanged",{});b(this,"pagePointWhereNextSegmentChanged",null);b(this,"lastRecordedPoint",{});b(this,"mergeNextPoint",!1);b(this,"currentLineLength",0);b(this,"canDraw",!1);b(this,"markId",null);b(this,"onEnter",n=>{this.markId=null,this.info=n,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});b(this,"onPointerMove",()=>{const{inputs:n}=this.editor;if(this.isPen&&!n.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&n.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(this.isPenOrStylus?E.Dist(n.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=n.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())});b(this,"onKeyDown",n=>{if(n.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()});b(this,"onKeyUp",n=>{if(n.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()});b(this,"onExit",()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.complete()});b(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(n,s,i){if(!this.canClose())return!1;const r=hn[s],o=n[0].points[0],l=n[n.length-1],c=l.points[l.points.length-1];return o!==c&&this.currentLineLength>r*4*i&&E.DistMin(o,c,r*2*i)}startShape(){const{inputs:{originPagePoint:n,isPen:s}}=this.editor;this.markId="draw start "+Rt(),this.editor.mark(this.markId);const{z:i=.5}=this.info.point;this.isPen=s,this.isPenOrStylus=s||i>0&&i<.5||i>.5&&i<1;const r=this.isPenOrStylus?i*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=n.clone(),this.initialShape){const l=this.editor.getShape(this.initialShape.id);if(l&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const c=Tn(l.props.segments);if(!c)throw Error("Expected a previous segment!");const d=Tn(c.points);if(!d)throw Error("Expected a previous point!");const{x:u,y:h}=this.editor.getPointInShapeSpace(l,n).toFixed(),p={type:this.segmentMode,points:[{x:d.x,y:d.y,z:+r.toFixed(2)},{x:u,y:h,z:+r.toFixed(2)}]},f=ve.applyToPoint(this.editor.getShapePageTransform(l.id),d);this.pagePointWhereCurrentSegmentChanged=f,this.pagePointWhereNextSegmentChanged=null;const g=[...l.props.segments,p];this.currentLineLength<hn[l.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const y={id:l.id,type:this.shapeType,props:{segments:g}};this.canClose()&&(y.props.isClosed=this.getIsClosed(g,l.props.size,l.props.scale)),this.editor.updateShapes([y]);return}}this.pagePointWhereCurrentSegmentChanged=n.clone();const o=it();this.editor.createShapes([{id:o,type:this.shapeType,x:n.x,y:n.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+r.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateDrawingShape(){const{initialShape:n}=this,{inputs:s}=this.editor;if(!n)return;const{id:i,props:{size:r,scale:o}}=n,l=this.editor.getShape(i);if(!l)return;const{segments:c}=l.props,{x:d,y:u,z:h}=this.editor.getPointInShapeSpace(l,s.currentPagePoint).toFixed(),p=this.isPenOrStylus?+(s.currentPagePoint.z*1.25).toFixed(2):.5,f={x:d,y:u,z:p};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(E.Dist2(g,s.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const x=Tn(c);if(!x)throw Error("Expected a previous segment!");const m=Tn(x.points);if(!m)throw Error("Expected a previous last point!");let v;const w=this.editor.getPointInShapeSpace(l,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(x.type==="straight"){this.currentLineLength+=E.Dist(m,w),v={type:"straight",points:[{...m},w]};const C=this.editor.getShapePageTransform(l);this.pagePointWhereCurrentSegmentChanged=ve.applyToPoint(C,m)}else v={type:"straight",points:[w,f]};const _={id:i,type:this.shapeType,props:{segments:[...c,v]}};this.canClose()&&(_.props.isClosed=this.getIsClosed(c,r,o)),this.editor.updateShapes([_])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(E.Dist2(g,s.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const x=c.slice(),m=x[x.length-1],v=Tn(m.points);if(!v)throw Error("No previous point!");const w={type:"free",points:[...E.PointsBetween(v,f,6).map(I=>({x:ao(I.x),y:ao(I.y),z:ao(I.z)}))]},_=[...x,w];this.currentLineLength<hn[l.props.size]*4&&(this.currentLineLength=this.getLineLength(_));const C={id:i,type:this.shapeType,props:{segments:_}};this.canClose()&&(C.props.isClosed=this.getIsClosed(_,r,o)),this.editor.updateShapes([C])}break}case"straight":{const g=c.slice(),y=g[g.length-1],{pagePointWhereCurrentSegmentChanged:x}=this,{ctrlKey:m,currentPagePoint:v}=this.editor.inputs;if(!x)throw Error("We should have a point where the segment changed");let w,_=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(_=!m,this.didJustShiftClickToExtendPreviousShapeLine=!1):_=!m;let C=this.editor.getPointInShapeSpace(l,v).toFixed().toJson(),I=!1,T;if((this.editor.user.getIsSnapMode()?!m:m)&&g.length>2){let N,O=8/this.editor.getZoomLevel();for(let R=0,j=c.length-2;R<j;R++){const A=c[R];if(!A)break;if(A.type==="free")continue;const B=A.points[0],L=Tn(A.points);if(!(B&&L))continue;const $=E.NearestPointOnLineSegment(B,L,C);if(E.DistMin($,C,O)){N=$.toFixed().toJson(),O=E.Dist($,C),T=A;break}}N&&(I=!0,C=N)}if(I&&T){const N=this.editor.getShapePageTransform(l),O=T.points[0],R=Tn(T.points);if(!R)throw Error("Expected a last point!");const j=ve.applyToPoint(N,O),A=ve.applyToPoint(N,R),B=ve.applyToPoint(N,C);this.editor.snaps.setIndicators([{id:Rt(),type:"points",points:[j,B,A]}])}else{if(this.editor.snaps.clearIndicators(),_){const N=E.Angle(x,v),R=lv(N,24)-N;w=E.RotWith(v,x,R)}else w=v;C=this.editor.getPointInShapeSpace(l,w).toFixed().toJson()}this.currentLineLength+=E.Dist(y.points[0],C),g[g.length-1]={...y,type:"straight",points:[y.points[0],C]};const k={id:i,type:this.shapeType,props:{segments:g}};this.canClose()&&(k.props.isClosed=this.getIsClosed(c,r,o)),this.editor.updateShapes([k]);break}case"free":{const g=c.slice(),y=g[g.length-1],x=[...y.points];if(x.length&&this.mergeNextPoint){const{z:v}=x[x.length-1];x[x.length-1]={x:f.x,y:f.y,z:v?Math.max(v,f.z):f.z}}else this.currentLineLength+=E.Dist(x[x.length-1],f),x.push(f);g[g.length-1]={...y,points:x},this.currentLineLength<hn[l.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const m={id:i,type:this.shapeType,props:{segments:g}};if(this.canClose()&&(m.props.isClosed=this.getIsClosed(g,r,o)),this.editor.updateShapes([m]),x.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const v=it(),w=this.editor.getShape(i).props;this.editor.createShapes([{id:v,type:this.shapeType,x:ao(s.currentPagePoint.x),y:ao(s.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:w.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(h*1.25).toFixed():.5}]}]}}]),this.initialShape=yt(this.editor.getShape(v)),this.mergeNextPoint=!1,this.lastRecordedPoint=s.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(n){let s=0;for(const i of n)for(let r=0;r<i.points.length-1;r++){const o=i.points[r],l=i.points[r+1];s+=E.Dist2(l,o)}return Math.sqrt(s)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:n}=this;n&&(this.editor.updateShapes([{id:n.id,type:n.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}b(c1,"id","drawing");var p0;let eB=(p0=class extends ye{constructor(){super(...arguments);b(this,"onPointerDown",n=>{this.parent.transition("drawing",n)});b(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});b(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},b(p0,"id","idle"),p0);class gh extends ye{constructor(){super(...arguments);b(this,"shapeType","draw");b(this,"onExit",()=>{const n=this.children.drawing;n.initialShape=void 0})}}b(gh,"id","draw"),b(gh,"initial","idle"),b(gh,"isLockable",!1),b(gh,"children",()=>[eB,c1]);class rC extends Dm{constructor(){super(...arguments);b(this,"shapeType","frame");b(this,"onCreate",n=>{if(!n)return;const s=this.editor.getShapePageBounds(n),i=[],r=this.editor.getShapeAncestors(n).map(o=>o.id);this.editor.getSortedChildIdsForParent(n.parentId).map(o=>{const l=this.editor.getShape(o);if(!l||l.id===n.id||l.isLocked)return;const c=this.editor.getShapePageBounds(l);c&&s.contains(c)&&hoe(l,r,n)&&i.push(l.id)}),this.editor.reparentShapes(i,n.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")})}}b(rC,"id","frame"),b(rC,"initial","idle");function hoe(t,e,n){return e.includes(t.id)?!1:t.parentId===n.parentId}var f0;let poe=(f0=class extends ye{constructor(){super(...arguments);b(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});b(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});b(this,"onKeyUp",n=>{var s;if(n.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape",{...n,target:"shape",shape:i}))}});b(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},b(f0,"id","idle"),f0);var g0;let foe=(g0=class extends ye{constructor(){super(...arguments);b(this,"markId","");b(this,"onPointerUp",()=>{this.complete()});b(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){const{originPagePoint:s}=this.editor.inputs,i=it();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:"geo",x:s.x,y:s.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Ei),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(i).setCurrentTool("select.resizing",{...n,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.complete()});b(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:n}=this.editor.inputs,s=it();this.markId=`creating:${s}`,this.editor.mark(this.markId);const i=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,r=this.editor.getStyleForNextShape(Ei),o=r==="star"?{w:200,h:190}:r==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:s,type:"geo",x:n.x,y:n.y,props:{geo:this.editor.getStyleForNextShape(Ei),scale:i,...o}}]);const l=this.editor.getShape(s);if(!l)return;const{w:c,h:d}=l.props,u=new E(c/2,d/2).mul(i),h=this.editor.getShapeParentTransform(l);h&&u.rot(-h.rotation()),this.editor.select(s),this.editor.updateShape({id:l.id,type:"geo",x:l.x-u.x,y:l.y-u.y,props:{geo:this.editor.getStyleForNextShape(Ei),w:c*i,h:d*i}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},b(g0,"id","pointing"),g0);class Um extends ye{constructor(){super(...arguments);b(this,"shapeType","geo")}}b(Um,"id","geo"),b(Um,"initial","idle"),b(Um,"children",()=>[poe,foe]);class mh extends ye{constructor(){super(...arguments);b(this,"shapeType","highlight");b(this,"onExit",()=>{const n=this.children.drawing;n.initialShape=void 0})}}b(mh,"id","highlight"),b(mh,"initial","idle"),b(mh,"children",()=>[eB,c1]),b(mh,"isLockable",!1);var m0;let goe=(m0=class extends ye{constructor(){super(...arguments);b(this,"shapeId","");b(this,"onEnter",n=>{this.shapeId=n.shapeId,this.editor.setCursor({type:"cross",rotation:0})});b(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});b(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},b(m0,"id","idle"),m0);const XN=2;var y0;let moe=(y0=class extends ye{constructor(){super(...arguments);b(this,"shape",{});b(this,"markId");b(this,"onEnter",n=>{const{inputs:s}=this.editor,{currentPagePoint:i}=s;this.markId=void 0;const r=n.shapeId&&this.editor.getShape(n.shapeId);if(r&&s.shiftKey){this.markId=`creating:${r.id}`,this.editor.mark(this.markId),this.shape=r;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const l=o.filter(f=>f.type==="vertex").sort(Xn),c=l[l.length-1],d=l[l.length-2],u=ve.applyToPoint(this.editor.getShapeParentTransform(this.shape),new E(this.shape.x,this.shape.y)),h=E.Sub(i,u).addXY(.1,.1),p=yt(this.shape.props.points);if(E.DistMin(c,d,XN)||E.DistMin(h,c,XN))p[c.id]={id:c.id,index:c.index,x:h.x,y:h.y};else{const f=Vi(c.index);p[f]={id:f,index:f,x:h.x,y:h.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:p}}])}else{const o=it();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:"line",x:i.x,y:i.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(o),this.shape=this.editor.getShape(o)}});b(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const n=this.editor.getShapeHandles(this.shape);if(!n)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const s=Tn(n);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...s,x:s.x-.1,y:s.y-.1},onInteractionEnd:"line"})}});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.complete()});b(this,"onInterrupt",()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},b(y0,"id","pointing"),y0);class $m extends ye{constructor(){super(...arguments);b(this,"shapeType","line")}}b($m,"id","line"),b($m,"initial","idle"),b($m,"children",()=>[goe,moe]);var v0;let yoe=(v0=class extends ye{constructor(){super(...arguments);b(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});b(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});b(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},b(v0,"id","idle"),v0);function pt(t,e){var i;const n=new Set;for(const r of e){const o=t.getShape(r);if(!o)continue;t.getShapeUtil(o).onDragShapesOut&&n.add(o);const l=t.getShape(o.parentId);l&&t.getShapeUtil(l).onDragShapesOut&&n.add(l)}const s=new Map;for(const r of n){const o=tB(t,r);o.length&&s.set(r,o)}for(const[r,o]of s){const l=t.getShapeUtil(r),c=Re(o.map(d=>t.getShape(d)));(i=l.onDragShapesOut)==null||i.call(l,r,c)}}function tB(t,e){const n=t.getSortedChildIdsForParent(e.id);if(n.length===0)return[];const s=t.getShapePageBounds(e);if(!s)return[];let i,r,o;const l=[];for(const c of n){const d=t.getShapePageBounds(c);if(!d)continue;if(!s.includes(d)){l.push(c);continue}i??(i=t.getShapeGeometry(e)),r??(r=t.getShapePageTransform(e)),o??(o=r.applyToPoints(i.vertices));const u=t.getShapePageTransform(c).clone().invert().applyToPoints(o),{vertices:h,isClosed:p}=t.getShapeGeometry(c);if(!h.some(f=>si(f,u))){if(p){if(T5(u,h))continue}else if(hse(u,h))continue;l.push(c)}}return l}function yv(t,e,n=!1){t.select(e),t.setEditingShape(e),t.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),n&&t.emit("select-all-text",{shapeId:e.id}),nB(t)}const voe=16;function nB(t){const e=t.getSelectionPageBounds(),n=t.getViewportPageBounds();if(e&&!n.contains(e)){const s=e.clone().expandBy(voe/t.getZoomLevel()).expand(n),i=n.clone().translate({x:(s.center.x-n.center.x)*2,y:(s.center.y-n.center.y)*2});t.zoomToBounds(i,{animation:{duration:t.options.animationMediumMs},inset:0})}}const xoe=0,lt=200,Vx=new E(lt/2,lt/2),sB=10,Soe=t=>[[["a1"],new E(lt*.5,lt*-.5-t.options.adjacentShapeMargin)],[["a2"],new E(lt*1.5+t.options.adjacentShapeMargin,lt*.5)],[["a3"],new E(lt*.5,lt*1.5+t.options.adjacentShapeMargin)],[["a4"],new E(lt*-.5-t.options.adjacentShapeMargin,lt*.5)]];function boe(t,e){if(e===1)return Soe(t);const n=lt*e,s=t.options.adjacentShapeMargin*e;return[[["a1"],new E(n*.5,n*-.5-s)],[["a2"],new E(n*1.5+s,n*.5)],[["a3"],new E(n*.5,n*1.5+s)],[["a4"],new E(n*-.5-s,n*.5)]]}function iB(t,e,n,s,i,r){return Object.fromEntries(boe(t,r).map(([o,l],c)=>{const d=l.clone();return c===0&&i?d.y-=i:c===2&&s&&(d.y+=s),[o,d.rot(n).add(e)]}))}function rB(t,e,n,s){const i=new Set(t.getSelectedShapeIds()),r=(lt+t.options.adjacentShapeMargin+s)**2,o=new Map,l=[];for(const u of t.getCurrentPageShapes()){if(!t.isShapeOfType(u,"note")||n!==u.props.scale||i.has(u.id))continue;const h=t.getShapePageTransform(u.id);e===h.rotation()&&(o.set(u,t.getShapePageBounds(u).center),l.push(...Object.values(iB(t,h.point(),e,u.props.growY,s,n))))}const c=l.length;let d;for(const[u,h]of o)for(let p=0;p<c;p++)d=l[p],d&&(E.Dist2(h,d)>r||t.isPointInShape(u,d)&&(l[p]=void 0));return Re(l)}function oB(t,e,n,s,i=!1){let r;const o=t.getCurrentPageShapesSorted(),l=(lt+t.options.adjacentShapeMargin**2)**e.props.scale;for(let c=o.length-1;c>=0;c--){const d=o[c];if(d.type==="note"&&d.id!==e.id){const u=t.getShapePageBounds(d);if(u&&E.Dist2(u.center,n)<l&&t.isPointInShape(d,n)){r=d;break}}}if(t.complete(),!r||i){t.mark("creating note shape");const c=it();t.createShape({id:c,type:"note",x:n.x,y:n.y,rotation:s,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const d=t.getShape(c);if(!d)return;const u=t.getPointInParentSpace(d,E.Sub(n,E.Rot(Vx.clone().mul(d.props.scale),s)));t.updateShape({id:c,type:"note",x:u.x,y:u.y}),r=t.getShape(c)}return nB(t),r}var x0;let woe=(x0=class extends ye{constructor(){super(...arguments);b(this,"dragged",!1);b(this,"info",{});b(this,"wasFocusedOnEnter",!1);b(this,"markId","");b(this,"shape",{});b(this,"onEnter",()=>{const{editor:n}=this;if(this.wasFocusedOnEnter=!n.getIsMenuOpen(),this.wasFocusedOnEnter){const s=it();this.markId=`creating:${s}`,n.mark(this.markId);const i=this.editor.inputs.originPagePoint.clone(),r=qN(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);r&&i.sub(r),this.shape=ZN(this.editor,s,i)}});b(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){const s=it(),i=this.editor.inputs.originPagePoint.clone(),r=qN(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);r&&i.sub(r),this.shape=ZN(this.editor,s,i)}this.editor.setCurrentTool("select.translating",{...n,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}});b(this,"onPointerUp",()=>{this.complete()});b(this,"onInterrupt",()=>{this.cancel()});b(this,"onComplete",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},b(x0,"id","pointing"),x0);function qN(t,e,n){let s=sB/t.getZoomLevel(),i;for(const r of rB(t,0,n,0)){const o=E.Sub(e,r),l=o.len();l<s&&(s=l,i=o)}return i}function ZN(t,e,n){t.createShape({id:e,type:"note",x:n.x,y:n.y,props:{scale:t.user.getIsDynamicResizeMode()?1/t.getZoomLevel():1}}).select(e);const s=t.getShape(e),i=t.getShapeGeometry(s).bounds;return t.updateShapes([{id:e,type:"note",x:s.x-i.width/2,y:s.y-i.height/2}]),t.getShape(e)}class zm extends ye{constructor(){super(...arguments);b(this,"shapeType","note")}}b(zm,"id","note"),b(zm,"initial","idle"),b(zm,"children",()=>[yoe,woe]);function _oe(t){const e=t.getShapeAtPoint(t.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),renderingOnly:!0});if(!e)return t.setHoveredShape(null);let n;const s=t.getOutermostSelectableShape(e);return s===e||s.id===t.getFocusedGroupId()||t.getSelectedShapeIds().includes(s.id)?n=e:n=s,t.setHoveredShape(n.id)}const go=xL(_oe,32);var S0;let Coe=(S0=class extends ye{constructor(){super(...arguments);b(this,"onPointerMove",n=>{switch(n.target){case"shape":case"canvas":go(this.editor)}});b(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});b(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});b(this,"onExit",()=>{go.cancel()});b(this,"onKeyDown",n=>{var s;if(n.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape",{...n,target:"shape",shape:i}))}});b(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},b(S0,"id","idle"),S0);var b0;let Eoe=(b0=class extends ye{constructor(){super(...arguments);b(this,"shape");b(this,"markId","");b(this,"onExit",()=>{this.editor.setHintingShapes([])});b(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:s}}=this.editor,i=it();this.markId=`creating:${i}`,this.editor.mark(this.markId);const r=this.createTextShape(i,s,!1);if(!r){this.cancel();return}this.shape=this.editor.getShape(r),this.editor.select(i),this.editor.setCurrentTool("select.resizing",{...n,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:18,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(r.id),this.editor.setCurrentTool("select.editing_shape")}})}});b(this,"onPointerUp",()=>{this.complete()});b(this,"onComplete",()=>{this.cancel()});b(this,"onCancel",()=>{this.cancel()});b(this,"onInterrupt",()=>{this.cancel()})}complete(){var r;this.editor.mark("creating text shape");const n=it(),{currentPagePoint:s}=this.editor.inputs;this.createTextShape(n,s,!0)&&(this.editor.select(n),this.editor.setEditingShape(n),this.editor.setCurrentTool("select"),(r=this.editor.root.getCurrent())==null||r.transition("editing_shape"))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(n,s,i){this.editor.createShape({id:n,type:"text",x:s.x,y:s.y,props:{text:"",autoSize:i,w:20,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const r=this.editor.getShape(n);if(!r){this.cancel();return}const o=this.editor.getShapePageBounds(r),l=new E;if(i)switch(r.props.textAlign){case"start":{l.x=0;break}case"middle":{l.x=-o.width/2;break}case"end":{l.x=-o.width;break}}else l.x=0;if(l.y=-o.height/2,Ps(r.parentId)){const c=this.editor.getShapeParentTransform(r);l.rot(-c.rotation())}return this.editor.updateShape({...r,x:r.x+l.x,y:r.y+l.y}),r}},b(b0,"id","pointing"),b0);class yh extends ye{constructor(){super(...arguments);b(this,"shapeType","text")}}b(yh,"id","text"),b(yh,"initial","idle"),b(yh,"children",()=>[Coe,Eoe]),b(yh,"isLockable",!1);const Toe=[yh,gh,Um,zm,$m,rC,Bm,mh];function Li(){return Wo({isDarkMode:Sf()})}function Kx(t){return{key:`${$r.id}:${t}`,getElement:async()=>{const e=Ioe(t);if(!e)return null;const n=e.$$_url,s=e.$$_fontface;if(!n||!s)return null;const i=await(await Ur(n)).blob(),r=await Dl.blobToDataUrl(i),o=s.replace(n,r);return a.jsx("style",{children:o})}}}function Ioe(t){const e=eF[t];for(const n of document.fonts)if(e.includes(n.family))return n;return null}function d1(t){return{key:`${$r.id}:${t}`,getElement:async()=>t!=="pattern"?null:a.jsx(Poe,{})}}function Poe(){const t=Li(),e=8/12;return a.jsxs(a.Fragment,{children:[a.jsxs("mask",{id:"hash_pattern_mask",children:[a.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),a.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[a.jsx("line",{x1:e*1,y1:e*3,x2:e*3,y2:e*1}),a.jsx("line",{x1:e*5,y1:e*7,x2:e*7,y2:e*5}),a.jsx("line",{x1:e*9,y1:e*11,x2:e*11,y2:e*9})]})]}),a.jsx("pattern",{id:vv(1,t.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:a.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:"url(#hash_pattern_mask)"})})]})}function u1(){return{key:`${$r.id}:pattern`,component:Aoe}}const vh=8,JN=(t,e,n)=>new Promise((s,i)=>{const r=vh*e*t,o=document.createElement("canvas");o.width=r,o.height=r;const l=o.getContext("2d");if(!l)return;l.fillStyle=n?tv.darkMode.solid:tv.lightMode.solid,l.fillRect(0,0,r,r),l.globalCompositeOperation="destination-out",l.lineCap="round",l.lineWidth=1.25*e*t;const c=8/12,d=u=>u*e*t;l.beginPath(),l.moveTo(d(c*1),d(c*3)),l.lineTo(d(c*3),d(c*1)),l.moveTo(d(c*5),d(c*7)),l.lineTo(d(c*7),d(c*5)),l.moveTo(d(c*9),d(c*11)),l.lineTo(d(c*11),d(c*9)),l.stroke(),o.toBlob(u=>{!u||Kt.throwToBlob.get()?i():s(u)})}),QN=(t,e)=>{const n=document.createElement("canvas");n.width=t[0],n.height=t[1];const s=n.getContext("2d");return s?(e(s),n.toDataURL()):""};let gw=null;function koe(){return gw||(gw={white:QN([1,1],t=>{t.fillStyle="#f8f9fa",t.fillRect(0,0,1,1)}),black:QN([1,1],t=>{t.fillStyle="#212529",t.fillRect(0,0,1,1)})}),gw}function aB(t){return Math.ceil(Math.log2(Math.max(1,t)))}function vv(t,e){const n=aB(t);return`tldraw_hash_pattern_${e}_${n}`}function lB(t){const e=[],s=aB(t);for(let i=0;i<=s;i++)e.push(Math.pow(2,i));return e}function joe(t){const e=koe();return lB(t).flatMap(n=>[{zoom:n,url:e.white,theme:"light"},{zoom:n,url:e.black,theme:"dark"}])}function Noe(){const t=K(),e=Z("devicePixelRatio",()=>t.getInstanceState().devicePixelRatio,[t]),n=Z("maxZoom",()=>Math.ceil(Tn(t.getCameraOptions().zoomSteps)),[t]),[s,i]=S.useState(!1),[r,o]=S.useState(()=>joe(n));return S.useEffect(()=>{const c=Promise.all(lB(n).flatMap(u=>[JN(e,u,!1).then(h=>({zoom:u,theme:"light",url:URL.createObjectURL(h)})),JN(e,u,!0).then(h=>({zoom:u,theme:"dark",url:URL.createObjectURL(h)}))]));let d=!1;return c.then(u=>{d||(o(u),i(!0))}),()=>{d=!0,i(!1),c.then(u=>{for(const{url:h}of u)URL.revokeObjectURL(h)})}},[e,n]),{defs:a.jsx(a.Fragment,{children:r.map(c=>{const d=vv(c.zoom,c.theme);return a.jsx("pattern",{id:d,width:vh,height:vh,patternUnits:"userSpaceOnUse",children:a.jsx("image",{href:c.url,width:vh,height:vh})},d)})}),isReady:s}}function Aoe(){const t=K(),e=S.useRef(null),{defs:n,isReady:s}=Noe();return S.useEffect(()=>{if(s&&t.environment.isSafari){const i=cB(e.current);i&&t.timers.requestAnimationFrame(()=>{i.style.display="none",t.timers.requestAnimationFrame(()=>{i.style.display=""})})}},[t,s]),a.jsx("g",{ref:e,"data-testid":s?"ready-pattern-fill-defs":void 0,children:n})}function cB(t){return t.classList.contains("tl-html-layer")?t:t.parentElement?cB(t.parentElement):null}const Hn=Oe.memo(function({theme:e,d:n,color:s,fill:i,scale:r}){switch(i){case"none":return null;case"solid":return a.jsx("path",{fill:e[s].semi,d:n});case"semi":return a.jsx("path",{fill:e.solid,d:n});case"fill":return a.jsx("path",{fill:e[s].fill,d:n});case"pattern":return a.jsx(Roe,{theme:e,color:s,fill:i,d:n,scale:r})}});function Roe({d:t,color:e,theme:n}){const s=K(),i=N5(),r=Z("zoomLevel",()=>s.getZoomLevel(),[s]),o=s.getZoomLevel()<=.18;return a.jsxs(a.Fragment,{children:[a.jsx("path",{fill:n[e].pattern,d:t}),a.jsx("path",{fill:i?`url(#${vv(1,n.id)})`:o?n[e].semi:`url(#${vv(r,n.id)})`,d:t})]})}function Moe(t){return t.replace(/\s/g,"")}function oC(t,e,n){const{padding:s=0}=n;if(e.length===0)return null;const i=de.From(e[0].box);for(const{box:d}of e)i.union(d);const r=s+(n.offsetX??0),o=(n.offsetY??0)+n.fontSize/2+(n.verticalTextAlign==="start"?s:n.verticalTextAlign==="end"?n.height-s-i.height:(Math.ceil(n.height)-i.height)/2);let l=null;const c=[];for(const{text:d,box:u}of e)l!==null&&u.y>l&&c.push(a.jsx("tspan",{alignmentBaseline:"mathematical",x:r,y:u.y+o,children:`
`},c.length)),c.push(a.jsx("tspan",{alignmentBaseline:"mathematical",x:u.x+r,y:u.y+o,unicodeBidi:"plaintext",children:Moe(d)},c.length)),l=u.y;return a.jsx("text",{fontSize:n.fontSize,fontFamily:n.fontFamily,fontStyle:n.fontStyle,fontWeight:n.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:n.stroke,strokeWidth:n.strokeWidth,fill:n.fill,children:c})}function Ooe(t,e,n,s){if((t==="start-legacy"||t==="end-legacy")&&n.length!==0){const i=de.From(n[0].box);for(const{box:r}of n)i.union(r);if(t==="start-legacy")return(s-2*e-i.width)/2;if(t==="end-legacy")return-(s-2*e-i.width)/2}}function Doe(t){return t==="start-legacy"||t==="middle-legacy"||t==="end-legacy"}function Yx({fontSize:t,font:e,align:n,verticalAlign:s,text:i,labelColor:r,bounds:o,padding:l=16,stroke:c=!0}){const d=K(),u=Li(),h={fontSize:t,fontFamily:eF[e],textAlign:n,verticalTextAlign:s,width:Math.ceil(o.width),height:Math.ceil(o.height),padding:l,lineHeight:An.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:r,stroke:void 0,strokeWidth:void 0},p=d.textMeasure.measureTextSpans(i,h),f=Ooe(n,l,p,o.width);f&&(h.offsetX=f),h.offsetX+=o.x,h.offsetY+=o.y;const g=oC(d,p,h);let y=null;return c&&(h.fill=u.background,h.stroke=u.background,h.strokeWidth=2,y=oC(d,p,h)),a.jsxs(a.Fragment,{children:[y,g]})}const Loe=S.forwardRef(function({isEditing:e,text:n,handleFocus:s,handleChange:i,handleKeyDown:r,handleBlur:o,handleInputPointerDown:l,handleDoubleClick:c},d){return a.jsx("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:n,onFocus:s,onChange:i,onKeyDown:r,onBlur:o,onTouchEnd:gn,onContextMenu:e?gn:void 0,onPointerDown:l,onDoubleClick:c,onDragStart:Ve})});function Foe(t,e,n){const s=K(),i=S.useRef(null),r=Z("isEditing",()=>s.getEditingShapeId()===t,[s]),o=Z("isEditingAnything",()=>!!s.getEditingShapeId(),[s]);S.useEffect(()=>{function u({shapeId:h}){var p;h===t&&((p=i.current)==null||p.select())}return s.on("select-all-text",u),()=>{s.off("select-all-text",u)}},[s,t,r]),S.useEffect(()=>{var u,h,p,f;r&&(document.activeElement!==i.current&&((u=i.current)==null||u.focus()),s.getInstanceState().isCoarsePointer&&((h=i.current)==null||h.select()),s.environment.isSafari&&((p=i.current)==null||p.blur(),(f=i.current)==null||f.focus()))},[s,r]);const l=S.useCallback(u=>{if(s.getEditingShapeId()===t)switch(u.key){case"Enter":{(u.ctrlKey||u.metaKey)&&s.complete();break}}},[s,t]),c=S.useCallback(u=>{if(s.getEditingShapeId()!==t)return;let h=Od.normalizeText(u.currentTarget.value);const p=h.replace(/\t/g,id);if(p!==h){const f=u.currentTarget.selectionStart;u.currentTarget.value=p,u.currentTarget.selectionStart=f+(p.length-h.length),u.currentTarget.selectionEnd=f+(p.length-h.length),h=p}s.updateShape({id:t,type:e,props:{text:h}})},[s,t,e]),d=S.useCallback(u=>{s.dispatch({...Os(u),type:"pointer",name:"pointer_down",target:"shape",shape:s.getShape(t)}),gn(u)},[s,t]);return{rInput:i,handleFocus:wp,handleBlur:wp,handleKeyDown:l,handleChange:c,handleInputPointerDown:d,handleDoubleClick:gn,isEmpty:n.trim().length===0,isEditing:r,isEditingAnything:o}}const Xx=Oe.memo(function({id:e,type:n,text:s,labelColor:i,font:r,fontSize:o,lineHeight:l,align:c,verticalAlign:d,wrap:u,isSelected:h,padding:p=0,onKeyDown:f,classNamePrefix:g,style:y,textWidth:x,textHeight:m}){const{rInput:v,isEmpty:w,isEditing:_,isEditingAnything:C,...I}=Foe(e,n,s),[T,P]=S.useState(s);S.useEffect(()=>{_||P(s)},[_,s]);const k=Od.normalizeTextForDom(s),N=k.length>0,O=Doe(c);if(!_&&!N)return null;const R=g||"tl-text";return a.jsx("div",{className:`${R}-label tl-text-wrapper`,"data-font":r,"data-align":c,"data-hastext":!w,"data-isediting":_,"data-iseditinganything":C,"data-textwrap":!!u,"data-isselected":h,style:{justifyContent:c==="middle"||O?"center":c,alignItems:d==="middle"?"center":d,padding:p,...y},children:a.jsxs("div",{className:`${R}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:Math.floor(o*l)+"px",minHeight:Math.floor(o*l)+"px",minWidth:Math.ceil(x||0),color:i,width:x?Math.ceil(x):void 0,height:m?Math.ceil(m):void 0},children:[a.jsx("div",{className:`${R} tl-text tl-text-content`,dir:"auto",children:k.split(`
`).map((j,A)=>a.jsx("div",{dir:"auto",children:j},A))}),(C||h)&&a.jsx(Loe,{ref:v,text:s,isEditing:_,...I,handleKeyDown:f??I.handleKeyDown},T)]})})});function xr(t,e,n={}){const{closed:s=!1,snap:i=1,start:r="outset",end:o="outset",lengthRatio:l=2,style:c="dashed"}=n;let d=0,u=0,h=1,p=0,f=0;switch(c){case"dashed":{h=1,d=Math.min(e*l,t/4);break}case"dotted":{h=100,d=e/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return s||(r==="outset"?(t+=d/2,f+=d/2):r==="skip"&&(t-=d,f-=d),o==="outset"?t+=d/2:o==="skip"&&(t-=d)),u=Math.floor(t/d/(2*h)),u-=u%i,u<3&&c==="dashed"?t/e<4?(d=t,u=1,p=0):(d=t*(1/3),p=t*(1/3)):(d=t/u/(2*h),s?(f=d/2,p=(t-u*d)/u):p=(t-u*d)/Math.max(1,u-1)),{strokeDasharray:[d,p].join(" "),strokeDashoffset:f.toString()}}const eA=new WeakMap;function h1(t,e){const n=eA.get(e);if(n)return n;const s=Ir(t,e);let i=0,r=0;const o=s.isStraight?new fo({start:E.From(s.start.point),end:E.From(s.end.point)}):new ed({center:E.Cast(s.handleArc.center),start:E.Cast(s.start.point),end:E.Cast(s.end.point),sweepFlag:s.bodyArc.sweepFlag,largeArcFlag:s.bodyArc.largeArcFlag});if(e.props.text.trim()){const c=o.bounds,d=aC(e),{w:u,h}=t.textMeasure.measureText(e.props.text,{...An,fontFamily:Dr[e.props.font],fontSize:d,maxWidth:null});if(i=u,r=h,c.width>c.height){i=Math.max(Math.min(u,64),Math.min(c.width-64,u));const{w:p,h:f}=t.textMeasure.measureText(e.props.text,{...An,fontFamily:Dr[e.props.font],fontSize:d,maxWidth:i});i=p,r=f}if(i>16*d){i=16*d;const{w:p,h:f}=t.textMeasure.measureText(e.props.text,{...An,fontFamily:Dr[e.props.font],fontSize:d,maxWidth:i});i=p,r=f}}const l=new E(i,r).addScalar(Ore*2*e.props.scale);return eA.set(e,l),l}function dB(t){const e=hn[t.props.size];return(Mre+(e-hn.s)*2+(e===hn.xl?20:0))*t.props.scale}function Boe(t,e,n){const s=h1(t,e),i=dB(e),r=E.Nudge(n.start.point,n.end.point,i),o=E.Nudge(n.end.point,n.start.point,i),l=XT(r,o,de.FromCenter(n.middle,s).corners);if(!l||l.length!==2)return{start:.5,end:.5};let[c,d]=l;E.Dist2(c,r)>E.Dist2(d,r)&&([d,c]=l);const u=r.add(E.Sub(n.middle,c)),h=o.add(E.Sub(n.middle,d)),p=E.Dist(n.start.point,u)/n.length,f=E.Dist(n.start.point,h)/n.length;return{start:p,end:f}}function Uoe(t,e,n){const s=h1(t,e),i=dB(e),r=Math.sign(e.props.bend),o=i/n.handleArc.radius*r,l=E.Angle(n.bodyArc.center,n.start.point)-o,c=E.Angle(n.bodyArc.center,n.end.point)+o,d=Yl(n.bodyArc.center,n.bodyArc.radius,l),u=Yl(n.bodyArc.center,n.bodyArc.radius,c),h=[],p=tA(n.bodyArc.center,n.bodyArc.radius,l,c,r,de.FromCenter(d,s).corners);h.push(new Gt({points:de.FromCenter(d,s).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const f=tA(n.bodyArc.center,n.bodyArc.radius,l,c,r,de.FromCenter(u,s).corners);h.push(new Gt({points:de.FromCenter(u,s).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const T of[...p??[],...f??[],d,u])h.push(new o1({x:T.x-3,y:T.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const g=(p&&nA(n.start.point,p))??n.middle,y=(f&&nA(n.end.point,f))??n.middle,x=E.Angle(n.bodyArc.center,n.start.point),m=E.Angle(n.bodyArc.center,n.end.point),v=E.Angle(n.bodyArc.center,g),w=E.Angle(n.bodyArc.center,y);if(ua(x,v,r)>ua(x,w,r))return{start:.5,end:.5,dbg:h};const _=ua(x,m,r),C=ua(x,v,r)/_,I=ua(x,w,r)/_;return{start:C,end:I,dbg:h}}function Wm(t,e){let n;const s=[],i=Ir(t,e),r=!!i.bindings.start,o=!!i.bindings.end,l=i.start.arrowhead!=="none",c=i.end.arrowhead!=="none";if(i.isStraight){const u=Boe(t,e,i);let h=on(e.props.labelPosition,l||r?u.start:0,c||o?u.end:1);h=h>=.48&&h<=.52?.5:h,n=E.Lrp(i.start.point,i.end.point,h)}else{const u=Uoe(t,e,i);u.dbg&&s.push(...u.dbg);let h=on(e.props.labelPosition,l||r?u.start:0,c||o?u.end:1);h=h>=.48&&h<=.52?.5:h;const p=$oe(E.Angle(i.bodyArc.center,i.start.point),E.Angle(i.bodyArc.center,i.end.point),Math.sign(e.props.bend),h);n=Yl(i.bodyArc.center,i.bodyArc.radius,p)}const d=h1(t,e);return{box:de.FromCenter(n,d),debugGeom:s}}function tA(t,e,n,s,i,r){const o=J_(t,e,r),l=ua(n,s,i);return o==null?void 0:o.filter(c=>{const d=ua(n,E.Angle(t,c),i);return d>=0&&d<=l})}function nA(t,e){let n=null,s=-1/0;for(const i of e){const r=E.Dist2(t,i);r>s&&(n=i,s=r)}return n}function $oe(t,e,n,s){const i=ua(t,e,n);return t+i*s*n*-1}function aC(t){return Rre[t.props.size]*t.props.scale}function zoe(t,e,n){const s=e==="end"?t.end.point:t.start.point,i=e==="end"?t.start.point:t.end.point,r=t.isStraight?E.Dist(i,s):Math.abs(t.bodyArc.length),o=Math.max(Math.min(r/5,n*3),n);let l;if(t.isStraight)l=E.Nudge(s,i,o);else{const c=dse(s,o,t.handleArc.center,t.handleArc.radius);l=e==="end"?t.handleArc.sweepFlag?c[0]:c[1]:t.handleArc.sweepFlag?c[1]:c[0]}return E.IsNaN(l)&&(l=t.start.point),{point:s,int:l}}function Woe({point:t,int:e}){const n=E.RotWith(e,t,Ze/6),s=E.RotWith(e,t,-Ze/6);return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${s.x} ${s.y}`}function Hoe({point:t,int:e}){const n=E.RotWith(e,t,Ze/6),s=E.RotWith(e,t,-Ze/6);return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${s.x} ${s.y} Z`}function Goe({point:t,int:e}){const n=E.Sub(e,t).div(2),s=E.Add(t,E.Rot(n,vt)),i=E.Sub(t,E.Rot(n,vt));return`M ${s.x} ${s.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function Voe({point:t,int:e}){const n=E.Lrp(t,e,.45),s=E.Dist(n,t);return`M ${n.x-s},${n.y}
  a ${s},${s} 0 1,0 ${s*2},0
  a ${s},${s} 0 1,0 -${s*2},0 `}function Koe({point:t,int:e}){const n=E.Lrp(t,e,.75),s=E.RotWith(n,t,Ze/4),i=E.RotWith(n,t,-Ze/4),r=E.Lrp(s,i,.5);return r.add(E.Sub(r,t)),`M ${r.x} ${r.y} L ${s.x} ${s.y} ${t.x} ${t.y} L ${i.x} ${i.y} Z`}function Yoe({int:t,point:e}){const n=E.Lrp(e,t,.85),s=E.Sub(n,e).div(2),i=E.Add(e,E.Rot(s,vt)),r=E.Sub(e,E.Rot(s,vt)),o=E.Add(n,E.Rot(s,vt)),l=E.Sub(n,E.Rot(s,vt));return`M ${i.x} ${i.y} L ${o.x} ${o.y} L ${l.x} ${l.y} L ${r.x} ${r.y} Z`}function Xoe({int:t,point:e}){const n=E.Sub(t,e).div(2),s=E.Add(e,E.Rot(n,vt)),i=E.Sub(e,E.Rot(n,vt));return`M ${s.x} ${s.y} L ${i.x} ${i.y}`}function xv(t,e,n){const s=e==="end"?t.end.arrowhead:t.start.arrowhead;if(s==="none")return;const i=zoe(t,e,n);if(i){switch(s){case"bar":return Xoe(i);case"square":return Yoe(i);case"diamond":return Koe(i);case"dot":return Voe(i);case"inverted":return Goe(i);case"arrow":return Woe(i);case"triangle":return Hoe(i)}return""}}function qoe(t){const{start:e,end:n,handleArc:{radius:s,largeArcFlag:i,sweepFlag:r}}=t;return`M${e.handle.x},${e.handle.y} A${s} ${s} 0 ${i} ${r} ${n.handle.x},${n.handle.y}`}function uB(t){const{start:e,end:n,bodyArc:{radius:s,largeArcFlag:i,sweepFlag:r}}=t;return`M${e.point.x},${e.point.y} A${s} ${s} 0 ${i} ${r} ${n.point.x},${n.point.y}`}function hB(t,e){return`M${t.x},${t.y}L${e.x},${e.y}`}function Zoe(t){return hB(t.start.handle,t.end.handle)}function pB(t){return hB(t.start.point,t.end.point)}let Joe=0;class Hm extends Ji{constructor(){super(...arguments);b(this,"canEdit",()=>!0);b(this,"canSnap",()=>!1);b(this,"hideResizeHandles",()=>!0);b(this,"hideRotateHandle",()=>!0);b(this,"hideSelectionBoundsBg",()=>!0);b(this,"hideSelectionBoundsFg",()=>!0);b(this,"canBeLaidOut",n=>{const s=As(this.editor,n);return!s.start&&!s.end});b(this,"onHandleDrag",(n,{handle:s,isPrecise:i})=>{const r=s.id,o=As(this.editor,n);if(r==="middle"){const{start:I,end:T}=td(this.editor,n,o),P=E.Sub(T,I),k=E.Per(P),N=E.Med(T,I),O=E.Sub(N,k),R=E.Add(N,k),j=E.NearestPointOnLineSegment(O,R,s,!1);let A=E.Dist(j,N);return E.Clockwise(j,T,N)&&(A*=-1),{id:n.id,type:n.type,props:{bend:A}}}const l={id:n.id,type:"arrow",props:{}},c=o[r],u=o[r==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return Lm(this.editor,n,r),l.props[r]={x:s.x,y:s.y},l;const h=this.editor.getShapePageTransform(n.id).applyToPoint(s),p=this.editor.getShapeAtPoint(h,{hitInside:!0,hitFrameInside:!0,margin:0,filter:I=>!I.isLocked&&this.editor.canBindShapes({fromShape:n,toShape:I,binding:"arrow"})});if(!p)return Lm(this.editor,n,r),l.props[r]={x:s.x,y:s.y},l;const f=this.editor.getShapeGeometry(p),g=de.ZeroFix(f.bounds),x=this.editor.getShapePageTransform(l.id).applyToPoint(s),m=this.editor.getPointInShapeSpace(p,x);let v=i;v||(!c||c&&p.id!==c.toId)&&(v=this.editor.inputs.pointerVelocity.len()<.5),i||(f.isClosed||(v=!0),u&&p.id===u.toId&&u.props.isPrecise&&(v=!0));const w={x:(m.x-g.minX)/g.width,y:(m.y-g.minY)/g.height};v&&E.Dist(m,g.center)<Math.max(4,Math.min(Math.min(g.width,g.height)*.15,16))/this.editor.getZoomLevel()&&(w.x=.5,w.y=.5);const _={terminal:r,normalizedAnchor:w,isPrecise:v,isExact:this.editor.inputs.altKey};Hu(this.editor,n,p.id,_),this.editor.setHintingShapes([p.id]);const C=As(this.editor,n);return C.start&&C.end&&C.start.toId===C.end.toId&&E.Equals(C.start.props.normalizedAnchor,C.end.props.normalizedAnchor)&&Hu(this.editor,n,C.end.toId,{...C.end.props,normalizedAnchor:{x:C.end.props.normalizedAnchor.x+.05,y:C.end.props.normalizedAnchor.y}}),l});b(this,"onTranslateStart",n=>{const s=As(this.editor,n),i=td(this.editor,n,s),r=this.editor.getShapePageTransform(n.id),o=this.editor.getSelectedShapeIds();if(!(s.start&&(o.includes(s.start.toId)||this.editor.isAncestorSelected(s.start.toId))||s.end&&(o.includes(s.end.toId)||this.editor.isAncestorSelected(s.end.toId)))){iA.set(n,{pagePosition:r.applyToPoint(n),terminalBindings:df(i,(l,c)=>{const d=s[l];return d?{binding:d,shapePosition:c,pagePosition:r.applyToPoint(c)}:null})}),s.start&&(mv({editor:this.editor,arrow:n,terminal:"start",useHandle:!0}),n=this.editor.getShape(n.id)),s.end&&mv({editor:this.editor,arrow:n,terminal:"end",useHandle:!0});for(const l of["start","end"]){const c=s[l];c&&this.editor.updateBinding({...c,props:{...c.props,isPrecise:!0}})}}});b(this,"onTranslate",(n,s)=>{const i=iA.get(n);if(!i)return;const r=this.editor.getShapePageTransform(s.id),o=E.Sub(r.applyToPoint(s),i.pagePosition);for(const l of Object.values(i.terminalBindings)){if(!l)continue;const c=E.Add(l.pagePosition,E.Mul(o,.5)),d=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:u=>!u.isLocked&&this.editor.canBindShapes({fromShape:s,toShape:u,binding:"arrow"})});if((d==null?void 0:d.id)===l.binding.toId){const u=de.ZeroFix(this.editor.getShapeGeometry(d).bounds),h=this.editor.getPointInShapeSpace(d,c),p={x:(h.x-u.minX)/u.width,y:(h.y-u.minY)/u.height};Hu(this.editor,s,d.id,{...l.binding.props,normalizedAnchor:p,isPrecise:!0})}else Lm(this.editor,s,l.binding.props.terminal)}});b(this,"_resizeInitialBindings",new jo);b(this,"onResize",(n,s)=>{const{scaleX:i,scaleY:r}=s,o=this._resizeInitialBindings.get(n,()=>As(this.editor,n)),l=td(this.editor,n,o),{start:c,end:d}=yt(n.props);let{bend:u}=n.props;o.start||(c.x=l.start.x*i,c.y=l.start.y*r),o.end||(d.x=l.end.x*i,d.y=l.end.y*r);const h=Math.abs(i),p=Math.abs(r),f=o!=null&&o.start?E.From(o.start.props.normalizedAnchor):null,g=o!=null&&o.end?E.From(o.end.props.normalizedAnchor):null;return i<0&&r>=0?(u!==0&&(u*=-1,u*=Math.max(h,p)),f&&(f.x=1-f.x),g&&(g.x=1-g.x)):i>=0&&r<0?(u!==0&&(u*=-1,u*=Math.max(h,p)),f&&(f.y=1-f.y),g&&(g.y=1-g.y)):i>=0&&r>=0?u!==0&&(u*=Math.max(h,p)):i<0&&r<0&&(u!==0&&(u*=Math.max(h,p)),f&&(f.x=1-f.x,f.y=1-f.y),g&&(g.x=1-g.x,g.y=1-g.y)),o.start&&f&&Hu(this.editor,n,o.start.toId,{...o.start.props,normalizedAnchor:f.toJson()}),o.end&&g&&Hu(this.editor,n,o.end.toId,{...o.end.props,normalizedAnchor:g.toJson()}),{props:{start:c,end:d,bend:u}}});b(this,"onDoubleClickHandle",(n,s)=>{switch(s.id){case"start":return{id:n.id,type:n.type,props:{...n.props,arrowheadStart:n.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:n.id,type:n.type,props:{...n.props,arrowheadEnd:n.props.arrowheadEnd==="none"?"arrow":"none"}}}});b(this,"onEditEnd",n=>{const{id:s,type:i,props:{text:r}}=n;r.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:s,type:i,props:{text:r.trimEnd()}}])})}canBind({toShapeType:n}){return n!=="arrow"}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(n){const s=Ir(this.editor,n),i=[],r=s.isStraight?new fo({start:E.From(s.start.point),end:E.From(s.end.point)}):new ed({center:E.Cast(s.handleArc.center),start:E.Cast(s.start.point),end:E.Cast(s.end.point),sweepFlag:s.bodyArc.sweepFlag,largeArcFlag:s.bodyArc.largeArcFlag});let o;if(n.props.text.trim()){const l=Wm(this.editor,n);i.push(...l.debugGeom),o=new Ao({x:l.box.x,y:l.box.y,width:l.box.w,height:l.box.h,isFilled:!0,isLabel:!0})}return new sr({children:[...o?[r,o]:[r],...i]})}getHandles(n){const s=Ir(this.editor,n);return[{id:"start",type:"vertex",index:"a0",x:s.start.handle.x,y:s.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:s.middle.x,y:s.middle.y},{id:"end",type:"vertex",index:"a3",x:s.end.handle.x,y:s.end.handle.y}].filter(Boolean)}component(n){const s=Li(),i=this.editor.getOnlySelectedShape(),r=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,o=Ir(this.editor,n);if(!(o!=null&&o.isValid))return null;const l=Wm(this.editor,n),c=n.id===this.editor.getOnlySelectedShapeId(),u=this.editor.getEditingShapeId()===n.id||n.props.text;return a.jsxs(a.Fragment,{children:[a.jsx(Ha,{id:n.id,style:{minWidth:50,minHeight:50},children:a.jsx(sA,{shape:n,shouldDisplayHandles:r&&(i==null?void 0:i.id)===n.id})}),u&&a.jsx(Xx,{id:n.id,classNamePrefix:"tl-arrow",type:"arrow",font:n.props.font,fontSize:aC(n),lineHeight:An.lineHeight,align:"middle",verticalAlign:"middle",text:n.props.text,labelColor:s[n.props.labelColor].solid,textWidth:l.box.w,isSelected:c,padding:0,style:{transform:`translate(${l.box.center.x}px, ${l.box.center.y}px)`}})]})}indicator(n){const s=Hx(n.id),i=Ir(this.editor,n);if(!i)return null;const{start:r,end:o}=td(this.editor,n,i==null?void 0:i.bindings),l=this.editor.getShapeGeometry(n),c=l.bounds,d=n.props.text.trim()?l.children[1]:null;if(E.Equals(r,o))return null;const u=hn[n.props.size]*n.props.scale,h=i.start.arrowhead&&xv(i,"start",u),p=i.end.arrowhead&&xv(i,"end",u),f=i.isStraight?pB(i):uB(i),g=h&&i.start.arrowhead!=="arrow"||p&&i.end.arrowhead!=="arrow"||!!d,y=(n.id+"_clip").replace(":","_");return s&&d?a.jsx("rect",{x:G(d.x),y:G(d.y),width:d.w,height:d.h,rx:3.5*n.props.scale,ry:3.5*n.props.scale}):a.jsxs("g",{children:[g&&a.jsx("defs",{children:a.jsxs("mask",{id:y,children:[a.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.w+200,height:c.h+200,fill:"white"}),d&&a.jsx("rect",{x:G(d.x),y:G(d.y),width:d.w,height:d.h,fill:"black",rx:3.5*n.props.scale,ry:3.5*n.props.scale}),h&&a.jsx("path",{d:h,fill:i.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),p&&a.jsx("path",{d:p,fill:i.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),a.jsxs("g",{...g?{mask:`url(#${y})`}:void 0,children:[g&&a.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.width+200,height:c.height+200,opacity:0}),a.jsx("path",{d:f})]}),h&&a.jsx("path",{d:h}),p&&a.jsx("path",{d:p}),d&&a.jsx("rect",{x:G(d.x),y:G(d.y),width:d.w,height:d.h,rx:3.5,ry:3.5})]})}toSvg(n,s){s.addExportDef(d1(n.props.fill)),n.props.text&&s.addExportDef(Kx(n.props.font));const i=Wo(s),r=1/n.props.scale;return a.jsxs("g",{transform:`scale(${r})`,children:[a.jsx(sA,{shape:n,shouldDisplayHandles:!1}),a.jsx(Yx,{fontSize:aC(n),font:n.props.font,align:"middle",verticalAlign:"middle",text:n.props.text,labelColor:i[n.props.labelColor].solid,bounds:Wm(this.editor,n).box,padding:4*n.props.scale})]})}getCanvasSvgDefs(){return[u1(),{key:"arrow:dot",component:eae},{key:"arrow:cross",component:tae}]}getInterpolatedProps(n,s,i){return{...s.props,start:{x:js(n.props.start.x,s.props.start.x,i),y:js(n.props.start.y,s.props.start.y,i)},end:{x:js(n.props.end.x,s.props.end.x,i),y:js(n.props.end.y,s.props.end.y,i)},bend:js(n.props.bend,s.props.bend,i),labelPosition:js(n.props.labelPosition,s.props.labelPosition,i)}}}b(Hm,"type","arrow"),b(Hm,"props",nF),b(Hm,"migrations",sF);function Qoe(t,e){const n=Ir(t,e);return n.isStraight?E.Dist(n.start.handle,n.end.handle):Math.abs(n.handleArc.length)}const sA=yn(function({shape:e,shouldDisplayHandles:n}){const s=K(),i=Li(),r=Ir(s,e),o=de.ZeroFix(s.getShapeGeometry(e).bounds),l=As(s,e),c=Oe.useMemo(()=>s.environment.isSafari?Joe+=1:0,[e]);if(!(r!=null&&r.isValid))return null;const d=hn[e.props.size]*e.props.scale,u=r.start.arrowhead&&xv(r,"start",d),h=r.end.arrowhead&&xv(r,"end",d),p=r.isStraight?pB(r):uB(r);let f=null;if(n){const _=2/s.getZoomLevel(),{strokeDasharray:C,strokeDashoffset:I}=xr(Qoe(s,e),_,{end:"skip",start:"skip",lengthRatio:2.5});f=l.start||l.end?a.jsx("path",{className:"tl-arrow-hint",d:r.isStraight?Zoe(r):qoe(r),strokeDasharray:C,strokeDashoffset:I,strokeWidth:_,markerStart:l.start?l.start.props.isExact?"":l.start.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:l.end?l.end.props.isExact?"":l.end.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:g,strokeDashoffset:y}=xr(r.isStraight?r.length:Math.abs(r.bodyArc.length),d,{style:e.props.dash}),x=Wm(s,e),m=!(r.start.arrowhead==="none"||r.start.arrowhead==="arrow"),v=!(r.end.arrowhead==="none"||r.end.arrowhead==="arrow"),w=(e.id+"_clip_"+c).replace(":","_");return a.jsxs(a.Fragment,{children:[a.jsx("defs",{children:a.jsxs("mask",{id:w,children:[a.jsx("rect",{x:G(-100+o.minX),y:G(-100+o.minY),width:G(o.width+200),height:G(o.height+200),fill:"white"}),e.props.text.trim()&&a.jsx("rect",{x:x.box.x,y:x.box.y,width:x.box.w,height:x.box.h,fill:"black",rx:4,ry:4}),u&&m&&a.jsx("path",{d:u,fill:r.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&v&&a.jsx("path",{d:h,fill:r.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),a.jsxs("g",{fill:"none",stroke:i[e.props.color].solid,strokeWidth:d,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[f,a.jsxs("g",{mask:`url(#${w})`,children:[a.jsx("rect",{x:G(o.minX-100),y:G(o.minY-100),width:G(o.width+200),height:G(o.height+200),opacity:0}),a.jsx("path",{d:p,strokeDasharray:g,strokeDashoffset:y})]}),u&&m&&e.props.fill!=="none"&&a.jsx(Hn,{theme:i,d:u,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),h&&v&&e.props.fill!=="none"&&a.jsx(Hn,{theme:i,d:h,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),u&&a.jsx("path",{d:u}),h&&a.jsx("path",{d:h})]})]})}),iA=new WeakMap;function eae(){return a.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:a.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function tae(){return a.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[a.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),a.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const rA="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Dd({url:t,zoomLevel:e}){return a.jsx("a",{className:Se("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:t,target:"_blank",rel:"noopener noreferrer",onPointerDown:gn,onPointerUp:gn,title:t,draggable:!1,children:a.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${rA}") center 100% / 100% no-repeat`,WebkitMask:`url("${rA}") center 100% / 100% no-repeat`}})})}const oA="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",nae=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function p1(t){return nae.map(n=>{const{offsetX:s,offsetY:i,blur:r,spread:o,color:l}=n,c=new E(s,i),{x:d,y:u}=c.rot(-t);return`${d}px ${u}px ${r}px ${o}px ${l}`}).join(", ")}const sae=300,fB=320,iae=46,rae=101;class Gm extends au{constructor(){super(...arguments);b(this,"canResize",()=>!1);b(this,"hideSelectionBoundsFg",()=>!0);b(this,"onBeforeCreate",n=>aA(this.editor,n));b(this,"onBeforeUpdate",(n,s)=>{if(n.props.url!==s.props.url)if(oi.isValid(s.props.url))aae(this.editor,s);else return{...s,props:{...s.props,url:n.props.url}};if(n.props.assetId!==s.props.assetId)return aA(this.editor,s)})}getDefaultProps(){return{url:"",w:sae,h:fB,assetId:null}}component(n){const s=n.props.assetId?this.editor.getAsset(n.props.assetId):null,i=this.editor.getShapePageTransform(n).rotation(),r=oae(n);return a.jsx(Xl,{children:a.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:p1(i),maxHeight:n.props.h},children:[(!s||s.props.image)&&a.jsxs("div",{className:"tl-bookmark__image_container",children:[s?a.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:s==null?void 0:s.props.image,alt:(s==null?void 0:s.props.title)||""}):a.jsx("div",{className:"tl-bookmark__placeholder"}),(s==null?void 0:s.props.image)&&a.jsx(Dd,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]}),a.jsxs("div",{className:"tl-bookmark__copy_container",children:[s!=null&&s.props.title?a.jsx("h2",{className:"tl-bookmark__heading",children:s.props.title}):null,s!=null&&s.props.description&&(s!=null&&s.props.image)?a.jsx("p",{className:"tl-bookmark__description",children:s.props.description}):null,a.jsxs("a",{className:"tl-bookmark__link",href:n.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:gn,onPointerUp:gn,onClick:gn,children:[s!=null&&s.props.favicon?a.jsx("img",{className:"tl-bookmark__favicon",src:s==null?void 0:s.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",alt:`favicon of ${r}`}):a.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${oA}") center 100% / 100% no-repeat`,WebkitMask:`url("${oA}") center 100% / 100% no-repeat`}}),a.jsx("span",{children:r})]})]})]})})}indicator(n){return a.jsx("rect",{width:G(n.props.w),height:G(n.props.h),rx:"6",ry:"6"})}}b(Gm,"type","bookmark"),b(Gm,"props",cF),b(Gm,"migrations",dF);function aA(t,e){const n=e.props.assetId?t.getAsset(e.props.assetId):null;let s=fB;return n&&(n.props.image||(n.props.title?s=rae:s=iae)),{...e,props:{...e.props,h:s}}}const oae=t=>{try{return new URL(t.props.url).hostname.replace(/^www\./,"")}catch{return t.props.url}};function aae(t,e){const{url:n}=e.props,s=kl.createId(F_(n));t.getAsset(s)?e.props.assetId!==s&&t.updateShapes([{id:e.id,type:e.type,props:{assetId:s}}]):(t.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),lae(t,e))}const lae=TL(async(t,e)=>{if(t.isDisposed)return;const{url:n}=e.props,s=await t.getAssetForExternalContent({type:"url",url:n});s&&t.run(()=>{t.createAssets([s]),t.updateShapes([{id:e.id,type:e.type,props:{assetId:s.id}}])})},500);function ql(t,e=!1){const n=t.length;if(n<2)return"";let s=t[0].point,i=t[1].point;if(n===2)return`M${Xe(s)}L${Xe(i)}`;let r="";for(let o=2,l=n-1;o<l;o++)s=t[o].point,i=t[o+1].point,r+=Ns(s,i);return e?`M${Ns(t[0].point,t[1].point)}Q${Xe(t[1].point)}${Ns(t[1].point,t[2].point)}T${r}${Ns(t[n-1].point,t[0].point)}${Ns(t[0].point,t[1].point)}Z`:`M${Xe(t[0].point)}Q${Xe(t[1].point)}${Ns(t[1].point,t[2].point)}${t.length>3?"T":""}${r}L${Xe(t[n-1].point)}`}function cae(t,e={}){const{start:n={},end:s={}}=e,{cap:i=!0}=n,{cap:r=!0}=s;xt(!n.taper&&!s.taper,"cap taper not supported here"),xt(!n.easing&&!s.easing,"cap easing not supported here"),xt(i&&r,"cap must be true");const o=Wr(t,e);Gx(o,e);const l=dae(o);let c="";for(const d of l)c+=hae(d,e);return c}function dae(t){if(t.length<=2)return[t];const e=[];let n=[t[0]],s=E.Sub(t[1].point,t[0].point).uni(),i,r,o,l,c;for(let d=1,u=t.length;d<u-1;d++){if(o=t[d-1],l=t[d],c=t[d+1],i=E.Sub(c.point,l.point).uni(),r=E.Dpr(s,i),s=i,r<-.8){const h={...l,point:l.input};n.push(h),e.push(mw(n)),n=[h];continue}if(n.push(l),!(r>.7)&&(E.Dist2(o.point,l.point)+E.Dist2(l.point,c.point))/((o.radius+l.radius+c.radius)/3)**2<1.5){n.push(l),e.push(mw(n)),n=[l];continue}}return n.push(t[t.length-1]),e.push(mw(n)),e}function mw(t){const e=t[0];let n;for(;t.length>2&&(n=t[1],E.Dist2(e.point,n.point)<((e.radius+n.radius)/2*.5)**2);)t.splice(1,1);const s=t[t.length-1];let i;for(;t.length>2&&(i=t[t.length-2],E.Dist2(s.point,i.point)<((s.radius+i.radius)/2*.5)**2);)t.splice(t.length-2,1);return t.length>1&&(t[0]={...t[0],vector:E.Sub(t[0].point,t[1].point).uni()},t[t.length-1]={...t[t.length-1],vector:E.Sub(t[t.length-2].point,t[t.length-1].point).uni()}),t}function uae(t,e,n){return"M "+t+" "+e+" m -"+n+", 0 a "+n+","+n+" 0 1,1 "+n*2+",0 a "+n+","+n+" 0 1,1 -"+n*2+",0"}function hae(t,e={}){if(t.length===0)return"";if(t.length===1)return uae(t[0].point.x,t[0].point.y,t[0].radius);const{left:n,right:s}=V5(t,e);s.reverse();let i=`M${Xe(n[0])}T`;for(let r=1;r<n.length;r++)i+=Ns(n[r-1],n[r]);{const r=t[t.length-1],o=r.radius,l=r.vector.clone().per().neg(),c=E.Add(r.point,E.Mul(l,o)),d=E.Add(r.point,E.Mul(l,-o));i+=`${Xe(c)}A${G(o)},${G(o)} 0 0 1 ${Xe(d)}T`}for(let r=1;r<s.length;r++)i+=Ns(s[r-1],s[r]);{const r=t[0],o=r.radius,l=r.vector.clone().per(),c=E.Add(r.point,E.Mul(l,o)),d=E.Add(r.point,E.Mul(l,-o));i+=`${Xe(c)}A${G(o)},${G(o)} 0 0 1 ${Xe(d)}Z`}return i}const pae=t=>t*.65+Mee(t*Ze/2)*.35,fae=t=>({size:t,thinning:.5,streamline:Ad(t,[9,16],[.64,.74],!0),smoothing:.62,easing:un.easeOutSine,simulatePressure:!0}),gae=t=>({size:1+t*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:pae}),lA=t=>({size:t,thinning:0,streamline:Ad(t,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:un.linear}),mae=t=>({size:t,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:un.linear});function f1({strokeWidth:t,showAsComplete:e}){return{size:1+t,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:un.easeOutSine,last:e}}function lC(t,e,n,s){const i=t.isComplete||n;return s?t.isPen?{...mae(e),last:i}:{...lA(e),last:i}:t.dash==="draw"?t.isPen?{...gae(e),last:i}:{...fae(e),last:i}:{...lA(e),last:i}}function Ld(t){const e=[];for(const n of t)if(n.type==="free"||n.points.length<2)e.push(...n.points.map(E.Cast));else{const s=Math.max(4,Math.floor(E.Dist(n.points[0],n.points[1])/16));e.push(...E.PointsBetween(n.points[0],n.points[1],s))}return e}function yae(t,e){return{draw:"none",solid:"none",dotted:`0.1 ${e*2}`,dashed:`${e*2} ${e*2}`}[t.props.dash]}class Vm extends Ji{constructor(){super(...arguments);b(this,"hideResizeHandles",n=>yw(n));b(this,"hideRotateHandle",n=>yw(n));b(this,"hideSelectionBoundsFg",n=>yw(n));b(this,"onResize",(n,s)=>{const{scaleX:i,scaleY:r}=s,o=[];for(const l of n.props.segments)o.push({...l,points:l.points.map(({x:c,y:d,z:u})=>({x:ao(i*c),y:ao(r*d),z:u}))});return{props:{segments:o}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(n){const s=Ld(n.props.segments),i=(hn[n.props.size]+1)*n.props.scale;if(n.props.segments.length===1){const o=de.FromPoints(s);if(o.width<i*2&&o.height<i*2)return new o1({x:-i,y:-i,radius:i,isFilled:!0})}const r=Wr(s,lC(n.props,i,n.props.isPen,!0)).map(o=>o.point);return n.props.isClosed?new Gt({points:r,isFilled:n.props.fill!=="none"}):new ou({points:r})}component(n){return a.jsx(Ha,{id:n.id,children:a.jsx(cA,{shape:n,zoomLevel:this.editor.getZoomLevel()})})}indicator(n){var h;const s=Ld(n.props.segments);let i=(hn[n.props.size]+1)*n.props.scale;const r=this.editor.getZoomLevel();!(r<.5&&r<1.5/i)&&!n.props.isPen&&n.props.dash==="draw"&&s.length===1&&(i+=or(n.id)()*(i/6));const l=n.props.isComplete||((h=Tn(n.props.segments))==null?void 0:h.type)==="straight",c=lC(n.props,i,l,!0),d=Wr(s,c),u=d.length>1?ql(d,n.props.isClosed):gB(s[0],i);return a.jsx("path",{d:u})}toSvg(n,s){s.addExportDef(d1(n.props.fill));const i=1/n.props.scale;return a.jsx("g",{transform:`scale(${i})`,children:a.jsx(cA,{shape:n,zoomLevel:1})})}getCanvasSvgDefs(){return[u1()]}expandSelectionOutlinePx(n){const s=n.props.dash==="draw"?1.6:1;return hn[n.props.size]*s/2*n.props.scale}}b(Vm,"type","draw"),b(Vm,"props",hF),b(Vm,"migrations",pF);function gB(t,e){const n=(e+1)*.5;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function yw(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function cA({shape:t,zoomLevel:e}){var h;const n=Li(),s=Ld(t.props.segments),i=t.props.isComplete||((h=Tn(t.props.segments))==null?void 0:h.type)==="straight";let r=(hn[t.props.size]+1)*t.props.scale;const o=e<.5&&e<1.5/r;!o&&!t.props.isPen&&t.props.dash==="draw"&&s.length===1&&(r+=or(t.id)()*(r/6));const l=lC(t.props,r,i,o);if(!o&&t.props.dash==="draw")return a.jsxs(a.Fragment,{children:[t.props.isClosed&&t.props.fill&&s.length>1?a.jsx(Hn,{d:ql(Wr(s,l),t.props.isClosed),theme:n,color:t.props.color,fill:t.props.isClosed?t.props.fill:"none",scale:t.props.scale}):null,a.jsx("path",{d:cae(s,l),strokeLinecap:"round",fill:n[t.props.color].solid})]});const c=Wr(s,l),d=c.length<2,u=d?gB(s[0],0):ql(c,t.props.isClosed);return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{d:u,theme:n,color:t.props.color,fill:d||t.props.isClosed?t.props.fill:"none",scale:t.props.scale}),a.jsx("path",{d:u,strokeLinecap:"round",fill:d?n[t.props.color].solid:"none",stroke:n[t.props.color].solid,strokeWidth:r,strokeDasharray:d?"none":yae(t,r),strokeDashoffset:"0"})]})}function vae(t,e,n={}){const{newPoint:s,handle:i,scaleX:r,scaleY:o}=e,{minWidth:l=1,maxWidth:c=1/0,minHeight:d=1,maxHeight:u=1/0}=n;let h=t.props.w*r,p=t.props.h*o;const f=new E(0,0);if(h>0){if(h<l){switch(i){case"top_left":case"left":case"bottom_left":{f.x=h-l;break}case"top":case"bottom":{f.x=(h-l)/2;break}default:f.x=0}h=l}}else if(f.x=h,h=-h,h<l){switch(i){case"top_left":case"left":case"bottom_left":{f.x=-h;break}default:f.x=-l}h=l}if(p>0){if(p<d){switch(i){case"top_left":case"top":case"top_right":{f.y=p-d;break}case"right":case"left":{f.y=(p-d)/2;break}default:f.y=0}p=d}}else if(f.y=p,p=-p,p<d){switch(i){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-d}p=d}const{x:g,y}=f.rot(t.rotation).add(s);return{x:g,y,props:{w:Math.min(c,h),h:Math.min(u,p)}}}const xae=t=>Object.entries(t).filter(([e,n])=>n).map(([e])=>e).join(" ");class Km extends au{constructor(){super(...arguments);b(this,"hideSelectionBoundsFg",n=>!this.canResize(n));b(this,"canEdit",()=>!0);b(this,"canResize",n=>{var s,i;return!!((i=(s=ba(n.props.url))==null?void 0:s.definition)!=null&&i.doesResize)});b(this,"canEditInReadOnly",()=>!0);b(this,"isAspectRatioLocked",n=>{const s=ba(n.props.url);return(s==null?void 0:s.definition.isAspectRatioLocked)??!1});b(this,"onResize",(n,s)=>{const i=this.isAspectRatioLocked(n),r=ba(n.props.url);let o=(r==null?void 0:r.definition.minWidth)??200,l=(r==null?void 0:r.definition.minHeight)??200;if(i){const c=n.props.w/n.props.h;c>1?o*=c:l/=c}return vae(n,s,{minWidth:o,minHeight:l})})}getDefaultProps(){return{w:300,h:300,url:""}}component(n){const{w:s,h:i,url:r}=n.props,o=Hx(n.id),l=S.useMemo(()=>Z5(r),[r]),c=Z("is hovering",()=>{const{editingShapeId:f,hoveredShapeId:g}=this.editor.getCurrentPageState();if(f&&g!==f){const y=this.editor.getShape(f);if(y&&this.editor.isShapeOfType(y,"embed"))return!0}return!1},[]),d=this.editor.getShapePageTransform(n).rotation(),u=o||c;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(l==null?void 0:l.definition.type)==="tldraw")return null;if((l==null?void 0:l.definition.type)==="github_gist"){const f=l.url.split("/").pop();if(!f)throw Error("No gist id!");return a.jsx(Xl,{className:"tl-embed-container",id:n.id,children:a.jsx(Sae,{id:f,width:G(s),height:G(i),isInteractive:u,pageRotation:d})})}const p=xae({...mee,...(l==null?void 0:l.definition.overridePermissions)??{}});return a.jsx(Xl,{className:"tl-embed-container",id:n.id,children:l!=null&&l.definition?a.jsx("iframe",{className:"tl-embed",sandbox:p,src:l.embedUrl,width:G(s),height:G(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:p1(d),borderRadius:(l==null?void 0:l.definition.overrideOutlineRadius)??8,background:l==null?void 0:l.definition.backgroundColor}}):null})}indicator(n){const s=S.useMemo(()=>ba(n.props.url),[n.props.url]);return a.jsx("rect",{width:G(n.props.w),height:G(n.props.h),rx:(s==null?void 0:s.definition.overrideOutlineRadius)??8,ry:(s==null?void 0:s.definition.overrideOutlineRadius)??8})}}b(Km,"type","embed"),b(Km,"props",fF),b(Km,"migrations",gF);function Sae({id:t,file:e,isInteractive:n,width:s,height:i,style:r,pageRotation:o}){return a.jsx("iframe",{className:"tl-embed",draggable:!1,width:G(s),height:G(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...r,pointerEvents:n?"all":"none",zIndex:n?"":"-1",boxShadow:p1(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${t}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const bae=S.forwardRef(({id:t,name:e,isEditing:n},s)=>{const i=K(),r=S.useCallback(c=>{c.key==="Enter"&&!c.nativeEvent.isComposing&&(gn(c),c.currentTarget.blur(),i.setEditingShape(null))},[i]),o=S.useCallback(c=>{const d=i.getShape(t);if(!d)return;const u=d.props.name,h=c.currentTarget.value.trim();u!==h&&i.updateShapes([{id:t,type:"frame",props:{name:h}}])},[t,i]),l=S.useCallback(c=>{const d=i.getShape(t);if(!d)return;const u=d.props.name,h=c.currentTarget.value;u!==h&&i.updateShapes([{id:t,type:"frame",props:{name:h}}])},[t,i]);return a.jsxs("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[a.jsx("input",{className:"tl-frame-name-input",ref:s,style:{display:n?void 0:"none"},value:e,autoFocus:!0,onKeyDown:r,onBlur:o,onChange:l}),mB(e,"Frame")+""]})}),wae=function({id:e,name:n,width:s,height:i}){const r=K(),o=Z("shape rotation",()=>Ma(r.getShapePageTransform(e).rotation()),[r,e]),l=Hx(e),c=S.useRef(null),d=S.useCallback(g=>{const y=Os(g);g.preventDefault(),r.getEditingShapeId()!==e&&r.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(e),...y})},[r,e]);S.useEffect(()=>{const g=c.current;g&&l&&(g.focus(),g.select())},[c,l]);const h=((o+Math.PI/4)*(2/Math.PI)+4)%4,p=["top","left","bottom","right"][Math.floor(h)];let f;switch(p){case"top":f="";break;case"right":f=`translate(${G(s)}px, 0px) rotate(90deg)`;break;case"bottom":f=`translate(${G(s)}px, ${G(i)}px) rotate(180deg)`;break;case"left":f=`translate(0px, ${G(i)}px) rotate(270deg)`;break}return a.jsx("div",{className:"tl-frame-heading",style:{overflow:l?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(p==="top"||p==="bottom"?s:i)}px + var(--space-5))`,bottom:"100%",transform:`${f} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:d,children:a.jsx("div",{className:"tl-frame-heading-hit-area",children:a.jsx(bae,{ref:c,id:e,name:n,isEditing:l})})})};function mB(t,e){return t.match(/^\s*$/)?e:t}class Ym extends au{constructor(){super(...arguments);b(this,"canEdit",()=>!0);b(this,"canReceiveNewChildrenOfType",(n,s)=>!n.isLocked);b(this,"canDropShapes",(n,s)=>!n.isLocked);b(this,"onDragShapesOver",(n,s)=>{s.every(i=>i.parentId===n.id)||this.editor.reparentShapes(s,n.id)});b(this,"onDragShapesOut",(n,s)=>{const i=this.editor.getShape(n.parentId);i&&this.editor.isShapeOfType(i,"group")?this.editor.reparentShapes(s,i.id):this.editor.reparentShapes(s,this.editor.getCurrentPageId())});b(this,"onResize",(n,s)=>i1(n,s))}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(n){return new Ao({width:n.props.w,height:n.props.h,isFilled:!1})}component(n){const s=this.editor.getShapeGeometry(n).bounds,i=Li(),r=Z("is creating this shape",()=>{const o=this.editor.getStateDescendant("select.resizing");if(!o||!o.getIsActive())return!1;const l=o==null?void 0:o.info;return l?l.isCreating&&this.editor.getOnlySelectedShapeId()===n.id:!1},[n.id]);return a.jsxs(a.Fragment,{children:[a.jsx(Ha,{children:a.jsx("rect",{className:Se("tl-frame__body",{"tl-frame__creating":r}),width:s.width,height:s.height,fill:i.solid,stroke:i.text})}),r?null:a.jsx(wae,{id:n.id,name:n.props.name,width:s.width,height:s.height})]})}toSvg(n,s){const i=Wo({isDarkMode:s.isDarkMode}),l=((Ma(this.editor.getShapePageTransform(n.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,c=Math.floor(l);let d;switch(c){case 0:d="";break;case 3:d=`translate(${G(n.props.w)}, 0) rotate(90)`;break;case 2:d=`translate(${G(n.props.w)}, ${G(n.props.h)}) rotate(180)`;break;case 1:d=`translate(0, ${G(n.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}const u={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:n.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},h=this.editor.textMeasure.measureTextSpans(mB(n.props.name,"Frame")+"",u),p=h[0],f=Tn(h),g=f.box.w+f.box.x-p.box.x,y=oC(this.editor,h,{offsetY:-u.height-2,...u});return a.jsxs(a.Fragment,{children:[a.jsx("rect",{width:n.props.w,height:n.props.h,fill:i.solid,stroke:i.black.solid,strokeWidth:1,rx:1,ry:1}),a.jsxs("g",{transform:d,children:[a.jsx("rect",{x:-8,y:-u.height-4,width:g+16,height:u.height,fill:i.background,rx:4,ry:4}),y]})]})}indicator(n){const s=this.editor.getShapeGeometry(n).bounds;return a.jsx("rect",{width:G(s.width),height:G(s.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}b(Ym,"type","frame"),b(Ym,"props",mF),b(Ym,"migrations",yF);function dA(t,e){return t>e?(Ze*(e/2)+(t-e))*2:(Ze*(t/2)+(e-t))*2}function yB(t,e){return g1(t,e).map((n,s)=>n.getSvgPathData(s===0)).join(" ")+" Z"}function _ae(t,e,n,s){const i=t/4,r=e/4,o=or(s),l=n*.75,c=v=>v.addXY(o()*l,o()*l),d=new E(t/2,e),u=new E(0,r*1.2),h=new E(t/2,r*.9),p=new E(t,r*1.2),f=c(new E(t/2,e)),g=c(new E(0,r*1.2)),y=c(new E(t/2,r*.9)),x=c(new E(t,r*1.2));return[new Vn({start:d,cp1:new E(i*1.5,r*3),cp2:new E(0,r*2.5),end:u}),new Vn({start:u,cp1:new E(0,-r*.32),cp2:new E(i*1.85,-r*.32),end:h}),new Vn({start:h,cp1:new E(i*2.15,-r*.32),cp2:new E(t,-r*.32),end:p}),new Vn({start:p,cp1:new E(t,r*2.5),cp2:new E(i*2.5,r*3),end:f}),new Vn({start:f,cp1:new E(i*1.5,r*3),cp2:new E(0,r*2.5),end:g}),new Vn({start:g,cp1:new E(0,-r*.32),cp2:new E(i*1.85,-r*.32),end:y}),new Vn({start:y,cp1:new E(i*2.15,-r*.32),cp2:new E(t,-r*.32),end:x}),new Vn({start:x,cp1:new E(t,r*2.5),cp2:new E(i*2.5,r*3),end:d})].map((v,w)=>v.getSvgPathData(w===0)).join(" ")+" Z"}function g1(t,e){const n=t/4,s=e/4;return[new Vn({start:new E(t/2,e),cp1:new E(n*1.5,s*3),cp2:new E(0,s*2.5),end:new E(0,s*1.2)}),new Vn({start:new E(0,s*1.2),cp1:new E(0,-s*.32),cp2:new E(n*1.85,-s*.32),end:new E(t/2,s*.9)}),new Vn({start:new E(t/2,s*.9),cp1:new E(n*2.15,-s*.32),cp2:new E(t,-s*.32),end:new E(t,s*1.2)}),new Vn({start:new E(t,s*1.2),cp1:new E(t,s*2.5),cp2:new E(n*2.5,s*3),end:new E(t/2,e)})]}function Cae(t){return{size:1+t,thinning:.25,end:{taper:t},start:{taper:t},streamline:0,smoothing:1,simulatePressure:!1}}function Eae(t,e,n,s){const i=or(t),r=e/2,o=n/2,l=LF(r,o),c=[],d=tt*i(),u=tt+vt/2+Math.abs(i())*vt,h=Math.max(16,l/10);for(let p=0;p<h;p++){const f=p/(h-1),g=d+f*u,y=Math.cos(g),x=Math.sin(g);c.push(new E(r*y+e*.5+.05*i(),o*x+n/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?un.easeInOutSine(f):un.easeInExpo(f)))/2)))}return Wr(c,Cae(s))}function Tae(t,e,n,s){return ql(Eae(t,e,n,s))}function cC(t){let e="M";const n=t.length;let s,i,r;for(let o=0,l=n;o<l;o+=3)s=t[o],i=t[o+1],r=t[o+2],e+=`${Xe(s)}L${Xe(i)}Q${Xe(r)}`;return e+=`${Xe(t[0])}`,e}function dC(t,e,n,s,i){const r=[],o=or(t);let l=e[0],c;const d=e.length;for(let u=0,h=d*i;u<h;u++){c=E.AddXY(e[(u+1)%d],o()*n,o()*n);const p=E.Sub(c,l),f=E.Len(p),g=E.Div(p,f).mul(Math.min(f/4,s));r.push(E.Add(l,g),E.Add(c,g.neg()),c),l=c}return r}function Iae(t,e,n){const s=Math.min(t,e)/2,i=Math.max(t,e)-s*2,o=(Math.PI*(s*2)+2*i)/n,l=t>e?[{type:"straight",start:new E(s,0),delta:new E(1,0)},{type:"arc",center:new E(t-s,s),startAngle:-Ze/2},{type:"straight",start:new E(t-s,e),delta:new E(-1,0)},{type:"arc",center:new E(s,s),startAngle:Ze/2}]:[{type:"straight",start:new E(t,s),delta:new E(0,1)},{type:"arc",center:new E(s,e-s),startAngle:0},{type:"straight",start:new E(0,e-s),delta:new E(0,-1)},{type:"arc",center:new E(s,s),startAngle:Ze}];let c=0;const d=[];for(let u=0;u<n;u++){const h=l[0];h.type==="straight"?d.push(E.Add(h.start,E.Mul(h.delta,c))):d.push(Yl(h.center,s,h.startAngle+c/s)),c+=o;let p=h.type==="straight"?i:Ze*s;for(;c>p;)c-=p,l.push(l.shift()),p=l[0].type==="straight"?i:Ze*s}return d}const Pae={s:50,m:70,l:100,xl:130},kae=.2;function qx(t,e,n,s){const i=or(n),r=dA(t,e),o=Math.max(Math.ceil(r/Pae[s]),6,Math.ceil(r/Math.min(t,e))),l=r/o*kae,c=Math.max(t-l*2,1),d=Math.max(e-l*2,1),h=dA(c,d)/o,p=(t-c)/2,f=(e-d)/2,g=Iae(c,d,o).map(w=>w.addXY(p,f)),y=t<20?0:l*.3,x=e<20?0:l*.3,m=g.slice(0);for(let w=0;w<Math.floor(o/2);w++)m[w]=E.AddXY(m[w],i()*y,i()*x),m[o-w-1]=E.AddXY(m[o-w-1],i()*y,i()*x);const v=[];for(let w=0;w<m.length;w++){const _=w===m.length-1?0:w+1,C=m[w],I=m[_],T=g[w],P=g[_],k=E.Dist(T,P),N=h-k,R=E.Dist(C,I)/k,j=(Math.max(p,f)+N)*R,A=E.Lrp(T,P,.5).add(E.Sub(P,T).uni().per().mul(j));A.x<0?A.x=0:A.x>t&&(A.x=t),A.y<0?A.y=0:A.y>e&&(A.y=e);const B=$T(C,I,A),L=E.Dist(B||E.Average([C,I]),C);v.push({leftPoint:C,rightPoint:I,arcPoint:A,center:B,radius:L})}return v}function jae(t,e,n,s){const i=[],r=qx(t,e,n,s);for(const{center:o,radius:l,leftPoint:c,rightPoint:d}of r)i.push(...Fee(c,d,o,l,10));return i}function uC(t,e,n,s){const i=qx(t,e,n,s);let r=`M${i[0].leftPoint.toFixed()}`;for(const{leftPoint:o,rightPoint:l,radius:c,center:d}of i){if(d===null){r+=` L${l.toFixed()}`;continue}const u=E.Clockwise(o,l,d)?"0":"1";r+=` A${G(c)},${G(c)} 0 ${u},1 ${l.toFixed()}`}return r+=" Z",r}const Nae={s:.5,m:.7,l:.9,xl:1.6};function Aae(t,e,n,s){const i=or(n),r=Nae[s],o=qx(t,e,n,s),d=o.reduce((f,g)=>f+E.Dist2(g.leftPoint,g.rightPoint),0)/o.length>(r*15)**2?f=>f.addXY(i()*r*2,i()*r*2):f=>f;let u=`M${o[0].leftPoint.toFixed()}`,h=d(o[0].leftPoint),p=`M${h.toFixed()}`;for(const{leftPoint:f,center:g,rightPoint:y,radius:x,arcPoint:m}of o){if(g===null){u+=` L${y.toFixed()}`;const T=d(y);p+=` L${T.toFixed()}`,h=T;continue}const v=E.Clockwise(f,y,g)?"0":"1";u+=` A${G(x)},${G(x)} 0 ${v},1 ${y.toFixed()}`;const w=d(y),_=d(m),C=$T(h,w,_);if(!Number.isFinite(C.x)||!Number.isFinite(C.y)){p+=` L${w.toFixed()}`,h=w;continue}const I=Math.abs(E.Dist(C,h));p+=` A${G(I)},${G(I)} 0 ${v},1 ${w.toFixed()}`,h=w}return u+p+" Z"}function hC(t,e){switch(t.geo){case"x-box":return Rae(t.w,t.h,e,t.dash);case"check-box":return Mae(t.w,t.h);default:return}}function Rae(t,e,n,s){const i=s==="draw"?.62:0;if(s==="dashed")return[[new E(0,0),new E(t/2,e/2)],[new E(t,e),new E(t/2,e/2)],[new E(0,e),new E(t/2,e/2)],[new E(t,0),new E(t/2,e/2)]];const r=l=>Math.max(0,Math.min(t,l)),o=l=>Math.max(0,Math.min(e,l));return[[new E(r(n*i),o(n*i)),new E(r(t-n*i),o(e-n*i))],[new E(r(n*i),o(e-n*i)),new E(r(t-n*i),o(n*i))]]}function Mae(t,e){const n=Math.min(t,e)*.82,s=(t-n)/2,i=(e-n)/2,r=l=>Math.max(0,Math.min(t,l)),o=l=>Math.max(0,Math.min(e,l));return[[new E(r(s+n*.25),o(i+n*.52)),new E(r(s+n*.45),o(i+n*.82))],[new E(r(s+n*.45),o(i+n*.82)),new E(r(s+n*.82),o(i+n*.22))]]}function uA({shape:t,shouldScale:e}){const n=e?t.props.scale:1,s=K(),i=Li(),{id:r,props:o}=t,{w:l,color:c,fill:d,dash:u,growY:h,size:p}=o,f=hn[p]*n,g=o.h+h;switch(o.geo){case"cloud":if(u==="solid"){const y=uC(l,g,r,p);return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:y,color:c,fill:d,scale:n}),a.jsx("path",{d:y,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}else if(u==="draw"){const y=Aae(l,g,r,p);return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:y,color:c,fill:d,scale:n}),a.jsx("path",{d:y,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}else{const y=uC(l,g,r,p),x=qx(l,g,r,p);return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:y,color:c,fill:d,scale:n}),a.jsx("g",{strokeWidth:f,stroke:i[c].solid,fill:"none",pointerEvents:"all",children:x.map(({leftPoint:m,rightPoint:v,center:w,radius:_},C)=>{const I=w?_*Ma(Ma(E.Angle(w,v))-Ma(E.Angle(w,m))):E.Dist(m,v),{strokeDasharray:T,strokeDashoffset:P}=xr(I,f,{style:u,start:"outset",end:"outset"});return a.jsx("path",{d:w?`M${m.x},${m.y}A${_},${_},0,0,1,${v.x},${v.y}`:`M${m.x},${m.y}L${v.x},${v.y}`,strokeDasharray:T,strokeDashoffset:P},C)})})]})}case"ellipse":{const y=e?s.getShapeGeometry(t):s.getShapeUtil(t).getGeometry(t),x=y.getSvgPathData(!0);if(u==="dashed"||u==="dotted"){const m=y.length,{strokeDasharray:v,strokeDashoffset:w}=xr(m<64?m*2:m,f,{style:u,snap:4,closed:!0});return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:x,color:c,fill:d,scale:n}),a.jsx("path",{d:x,strokeWidth:f,fill:"none",stroke:i[c].solid,strokeDasharray:v,strokeDashoffset:w})]})}else{const v=(e?s.getShapeGeometry(t):s.getShapeUtil(t).getGeometry(t)).getSvgPathData(!0);return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:v,color:c,fill:d,scale:n}),a.jsx("path",{d:v,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}}case"oval":{const y=e?s.getShapeGeometry(t):s.getShapeUtil(t).getGeometry(t),x=y.getSvgPathData(!0);if(u==="dashed"||u==="dotted"){const m=y.getLength(),{strokeDasharray:v,strokeDashoffset:w}=xr(m<64?m*2:m,f,{style:u,snap:4,start:"outset",end:"outset",closed:!0});return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:x,color:c,fill:d,scale:n}),a.jsx("path",{d:x,strokeWidth:f,fill:"none",stroke:i[c].solid,strokeDasharray:v,strokeDashoffset:w})]})}else return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:x,color:c,fill:d,scale:n}),a.jsx("path",{d:x,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}case"heart":if(u==="dashed"||u==="dotted"||u==="solid"){const y=yB(l,g),x=g1(l,g);return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:y,color:c,fill:d,scale:n}),x.map((m,v)=>{const{strokeDasharray:w,strokeDashoffset:_}=xr(m.length,f,{style:u,snap:1,start:"outset",end:"outset",closed:!0});return a.jsx("path",{d:m.getSvgPathData(),strokeWidth:f,fill:"none",stroke:i[c].solid,strokeDasharray:w,strokeDashoffset:_,pointerEvents:"all"},`curve_${v}`)})]})}else{const y=_ae(l,g,f,t.id);return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:y,color:c,fill:d,scale:n}),a.jsx("path",{d:y,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}default:{const y=e?s.getShapeGeometry(t):s.getShapeUtil(t).getGeometry(t),x=y instanceof sr?y.children[0].vertices:y.vertices,m=hC(t.props,f);if(u==="solid"){let v="M"+x[0]+"L"+x.slice(1)+"Z";if(m)for(const[w,_]of m)v+=`M${w.x},${w.y}L${_.x},${_.y}`;return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:v,color:c,fill:d,scale:n}),a.jsx("path",{d:v,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}else if(u==="dashed"||u==="dotted"){const v="M"+x[0]+"L"+x.slice(1)+"Z";return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:v,color:c,fill:d,scale:n}),a.jsxs("g",{strokeWidth:f,stroke:i[c].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(x.length)).map((w,_)=>{const C=E.ToFixed(x[_]),I=E.ToFixed(x[(_+1)%x.length]),T=E.Dist(C,I),{strokeDasharray:P,strokeDashoffset:k}=xr(T,f,{style:u,start:"outset",end:"outset"});return a.jsx("line",{x1:C.x,y1:C.y,x2:I.x,y2:I.y,strokeDasharray:P,strokeDashoffset:k},_)}),m&&m.map(([w,_],C)=>{const I=E.Dist(w,_),{strokeDasharray:T,strokeDashoffset:P}=xr(I,f,{style:u,start:"skip",end:"skip",snap:u==="dotted"?4:void 0});return a.jsx("path",{d:`M${w.x},${w.y}L${_.x},${_.y}`,stroke:i[c].solid,strokeWidth:f,fill:"none",strokeDasharray:T,strokeDashoffset:P},`line_fg_${C}`)})]})]})}else if(u==="draw"){let v=cC(dC(r,x,f/3,f*2,2));if(m)for(const[_,C]of m)v+=`M${_.toFixed()}L${C.toFixed()}`;const w=cC(dC(r,x,0,f*2,1));return a.jsxs(a.Fragment,{children:[a.jsx(Hn,{theme:i,d:w,color:c,fill:d,scale:n}),a.jsx("path",{d:v,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}}}}const hA=17*3;class Xm extends au{constructor(){super(...arguments);b(this,"canEdit",()=>!0);b(this,"onEditEnd",n=>{const{id:s,type:i,props:{text:r}}=n;r.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:s,type:i,props:{text:r.trimEnd()}}])});b(this,"onResize",(n,{handle:s,newPoint:i,scaleX:r,scaleY:o,initialShape:l})=>{const c=l.props.w/l.props.scale,d=l.props.h/l.props.scale,u=l.props.growY/l.props.scale;let h=c*r,p=(d+u)*o,f=0,g=0;const y=hA;if(n.props.text.trim()){let C=Math.max(Math.abs(h),y),I=Math.max(Math.abs(p),y);C<y&&I===y&&(C=y),C===y&&I<y&&(I=y);const T=Ug(this.editor,{...n,props:{...n.props,w:C*n.props.scale,h:I*n.props.scale}}),P=Math.max(Math.abs(h),T.w)*Math.sign(h),k=Math.max(Math.abs(p),T.h)*Math.sign(p);f=Math.abs(P)-Math.abs(h),g=Math.abs(k)-Math.abs(p),h=P,p=k}const x=h*n.props.scale,m=p*n.props.scale,v=new E(0,0);r<0&&(v.x+=x),(s==="left"||s==="top_left"||s==="bottom_left")&&(v.x+=r<0?f:-f),o<0&&(v.y+=m),(s==="top"||s==="top_left"||s==="top_right")&&(v.y+=o<0?g:-g);const{x:w,y:_}=v.rot(n.rotation).add(i);return{x:w,y:_,props:{w:Math.max(Math.abs(x),1),h:Math.max(Math.abs(m),1),growY:0}}});b(this,"onBeforeCreate",n=>{if(!n.props.text)return n.props.growY?{...n,props:{...n.props,growY:0}}:void 0;const s=n.props.h/n.props.scale,i=Ug(this.editor,n).h;let r=null;if(i>s?r=i-s:n.props.growY&&(r=0),r!==null)return{...n,props:{...n.props,growY:r*n.props.scale}}});b(this,"onBeforeUpdate",(n,s)=>{const i=n.props.text,r=s.props.text;if(i===r&&n.props.font===s.props.font&&n.props.size===s.props.size)return;if(i&&!r)return{...s,props:{...s.props,growY:0}};const o=n.props.w/n.props.scale,l=n.props.h/n.props.scale,c=n.props.growY/n.props.scale,d=Ug(this.editor,s);if(!i&&r&&r.length===1){let h=Math.max(o,d.w),p=Math.max(l,d.h);const f=hA;return o<f&&l<f&&(h=Math.max(h,f),p=Math.max(p,f),h=Math.max(h,p),p=Math.max(h,p)),{...s,props:{...s.props,w:h*s.props.scale,h:p*s.props.scale,growY:0}}}let u=null;if(d.h>l?u=d.h-l:c&&(u=0),u!==null){const h=s.props.w/s.props.scale;return{...s,props:{...s.props,growY:u*s.props.scale,w:Math.max(h,d.w)*s.props.scale}}}if(d.w>o)return{...s,props:{...s.props,w:d.w*s.props.scale}}});b(this,"onDoubleClick",n=>{if(this.editor.inputs.altKey)switch(n.props.geo){case"rectangle":return{...n,props:{geo:"check-box"}};case"check-box":return{...n,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(n){const s=Math.max(1,n.props.w),i=Math.max(1,n.props.h+n.props.growY),r=s/2,o=i/2,l=n.props.fill!=="none";let c;switch(n.props.geo){case"cloud":{c=new Gt({points:jae(s,i,n.id,n.props.size),isFilled:l});break}case"triangle":{c=new Gt({points:[new E(r,0),new E(s,i),new E(0,i)],isFilled:l});break}case"diamond":{c=new Gt({points:[new E(r,0),new E(s,o),new E(r,i),new E(0,o)],isFilled:l});break}case"pentagon":{c=new Gt({points:qb(s,i,5),isFilled:l});break}case"hexagon":{c=new Gt({points:qb(s,i,6),isFilled:l});break}case"octagon":{c=new Gt({points:qb(s,i,8),isFilled:l});break}case"ellipse":{c=new hre({width:s,height:i,isFilled:l});break}case"oval":{c=new pre({width:s,height:i,isFilled:l});break}case"star":{const w=tt/5/2,_=Math.floor(5/4)*2,C=5*2-_,I=0,T=Math.floor(5/2)*2,P=Math.cos(-vt+_*w)*s/2,k=Math.cos(-vt+C*w)*s/2,N=Math.sin(-vt+I*w)*i/2,O=Math.sin(-vt+T*w)*i/2,R=s-Math.abs(P-k),j=i-Math.abs(O-N),A=s/2+k-(s/2-P),B=i/2+N-(i/2-O),L=1,$=(s-A)/2,M=(i-B)/2,D=(s+R)/2,U=(i+j)/2,z=D*L/2,H=U*L/2;c=new Gt({points:Array.from(Array(5*2)).map((q,V)=>{const ee=-vt+V*w;return new E($+(V%2?z:D)*Math.cos(ee),M+(V%2?H:U)*Math.sin(ee))}),isFilled:l});break}case"rhombus":{const v=Math.min(s*.38,i*.38);c=new Gt({points:[new E(v,0),new E(s,0),new E(s-v,i),new E(0,i)],isFilled:l});break}case"rhombus-2":{const v=Math.min(s*.38,i*.38);c=new Gt({points:[new E(0,0),new E(s-v,0),new E(s,i),new E(v,i)],isFilled:l});break}case"trapezoid":{const v=Math.min(s*.38,i*.38);c=new Gt({points:[new E(v,0),new E(s-v,0),new E(s,i),new E(0,i)],isFilled:l});break}case"arrow-right":{const v=Math.min(s,i)*.38,w=i*.16;c=new Gt({points:[new E(0,w),new E(s-v,w),new E(s-v,0),new E(s,i/2),new E(s-v,i),new E(s-v,i-w),new E(0,i-w)],isFilled:l});break}case"arrow-left":{const v=Math.min(s,i)*.38,w=i*.16;c=new Gt({points:[new E(v,0),new E(v,w),new E(s,w),new E(s,i-w),new E(v,i-w),new E(v,i),new E(0,i/2)],isFilled:l});break}case"arrow-up":{const v=s*.16,w=Math.min(s,i)*.38;c=new Gt({points:[new E(s/2,0),new E(s,w),new E(s-v,w),new E(s-v,i),new E(v,i),new E(v,w),new E(0,w)],isFilled:l});break}case"arrow-down":{const v=s*.16,w=Math.min(s,i)*.38;c=new Gt({points:[new E(v,0),new E(s-v,0),new E(s-v,i-w),new E(s,i-w),new E(s/2,i),new E(0,i-w),new E(v,i-w)],isFilled:l});break}case"check-box":case"x-box":case"rectangle":{c=new Ao({width:s,height:i,isFilled:l});break}case"heart":{const w=g1(s,i).reduce((_,C)=>(_.push(...C.vertices),_),[]);c=new Gt({points:w,isFilled:l});break}default:Zn(n.props.geo)}const d=Ug(this.editor,n),u=s/n.props.scale,h=i/n.props.scale,p=Math.min(100,u/2),f=Math.min(_o[n.props.size]*An.lineHeight+xi*2,h/2),g=Math.min(u,Math.max(d.w,Math.min(p,Math.max(1,u-8)))),y=Math.min(h,Math.max(d.h,Math.min(f,Math.max(1,h-8)))),x=hC(n.props,hn[n.props.size]*n.props.scale),m=x?x.map(v=>new ou({points:v})):[];return new sr({children:[c,new Ao({x:n.props.align==="start"?0:n.props.align==="end"?(u-g)*n.props.scale:(u-g)/2*n.props.scale,y:n.props.verticalAlign==="start"?0:n.props.verticalAlign==="end"?(h-y)*n.props.scale:(h-y)/2*n.props.scale,width:g*n.props.scale,height:y*n.props.scale,isFilled:!0,isLabel:!0}),...m]})}getHandleSnapGeometry(n){const s=this.getGeometry(n),i=s.children[0];switch(n.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:i,points:[...i.getVertices(),s.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:i,points:[s.bounds.center]};default:Zn(n.props.geo)}}component(n){const{id:s,type:i,props:r}=n,{fill:o,font:l,align:c,verticalAlign:d,size:u,text:h}=r,p=Li(),f=this.editor.getEditingShapeId()!==null,g=Z("isGeoOnlySelected",()=>n.id===this.editor.getOnlySelectedShapeId(),[]),y=f||n.props.text;return a.jsxs(a.Fragment,{children:[a.jsx(Ha,{id:s,children:a.jsx(uA,{shape:n,shouldScale:!0})}),y&&a.jsx(Xl,{style:{overflow:"hidden",width:n.props.w,height:n.props.h+r.growY},children:a.jsx(Xx,{id:s,type:i,font:l,fontSize:_o[u]*n.props.scale,lineHeight:An.lineHeight,padding:xi*n.props.scale,fill:o,align:c,verticalAlign:d,text:h,isSelected:g,labelColor:p[r.labelColor].solid,wrap:!0})}),n.props.url&&a.jsx(Dd,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(n){const{id:s,props:i}=n,{w:r,size:o}=i,l=i.h+i.growY,c=hn[o],d=this.editor.getShapeGeometry(n);switch(i.geo){case"ellipse":return i.dash==="draw"?a.jsx("path",{d:Tae(s,r,l,c)}):a.jsx("path",{d:d.getSvgPathData(!0)});case"heart":return a.jsx("path",{d:yB(r,l)});case"oval":return a.jsx("path",{d:d.getSvgPathData(!0)});case"cloud":return a.jsx("path",{d:uC(r,l,s,o)});default:{const u=this.editor.getShapeGeometry(n),h=u instanceof sr?u.children[0].vertices:u.vertices;let p;if(i.dash==="draw"){const g=dC(s,h,0,c*2*n.props.scale,1);p=cC(g)}else p="M"+h[0]+"L"+h.slice(1)+"Z";const f=hC(n.props,c);if(f)for(const[g,y]of f)p+=`M${g.x},${g.y}L${y.x},${y.y}`;return a.jsx("path",{d:p})}}}toSvg(n,s){const i={...n,props:{...n.props,w:n.props.w/n.props.scale,h:n.props.h/n.props.scale}},r=i.props;s.addExportDef(d1(r.fill));let o;if(r.text){s.addExportDef(Kx(r.font));const l=Wo(s),c=new de(0,0,r.w,r.h+r.growY);o=a.jsx(Yx,{fontSize:_o[r.size],font:r.font,align:r.align,verticalAlign:r.verticalAlign,text:r.text,labelColor:l[r.labelColor].solid,bounds:c,padding:16})}return a.jsxs(a.Fragment,{children:[a.jsx(uA,{shouldScale:!1,shape:i}),o]})}getCanvasSvgDefs(){return[u1()]}}b(Xm,"type","geo"),b(Xm,"props",vF),b(Xm,"migrations",xF);function Ug(t,e){const{text:n,font:s,size:i,w:r}=e.props;if(!n)return{w:0,h:0};const o=t.textMeasure.measureText("w",{...An,fontFamily:Dr[s],fontSize:_o[i],maxWidth:100}),l={s:2,m:3.5,l:5,xl:10},c=t.textMeasure.measureText(n,{...An,fontFamily:Dr[s],fontSize:_o[i],minWidth:o.w,maxWidth:Math.max(0,Math.ceil(o.w+l[i]),Math.ceil(r/e.props.scale-xi*2))});return{w:c.w+xi*2,h:c.h+xi*2}}function Oae(){const[t,e]=S.useState(!1);return S.useEffect(()=>{const s=CSS.supports("color","color(display-p3 1 1 1)"),i=matchMedia("(color-gamut: p3)");e(s&&i.matches);const r=()=>e(s&&i.matches);return i.addEventListener("change",r),()=>i.removeEventListener("change",r)},[]),Z(Kt.forceSrgb)||!t?"srgb":"p3"}const pA=.35,fA=.82;class qm extends Ji{constructor(){super(...arguments);b(this,"hideResizeHandles",n=>$g(n));b(this,"hideRotateHandle",n=>$g(n));b(this,"hideSelectionBoundsFg",n=>$g(n));b(this,"onResize",(n,s)=>{const{scaleX:i,scaleY:r}=s,o=[];for(const l of n.props.segments)o.push({...l,points:l.points.map(({x:c,y:d,z:u})=>({x:i*c,y:r*d,z:u}))});return{props:{segments:o}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(n){const s=wl(n);if($g(n))return new o1({x:-s/2,y:-s/2,radius:s/2,isFilled:!0});const{strokePoints:i,sw:r}=gA(n,s,!0),o=f1({strokeWidth:r,showAsComplete:!0});return Gx(i,o),new Gt({points:a1(i,o),isFilled:!0})}component(n){const s=vw(this.editor,n),i=wl(n);return a.jsx(Ha,{id:n.id,children:a.jsx(zg,{shape:n,forceSolid:s,strokeWidth:i,opacity:pA})})}backgroundComponent(n){const s=vw(this.editor,n),i=wl(n);return a.jsx(Ha,{id:n.id,children:a.jsx(zg,{shape:n,forceSolid:s,strokeWidth:i,opacity:fA})})}indicator(n){const s=vw(this.editor,n),i=wl(n),{strokePoints:r,sw:o}=gA(n,i,s),l=Ld(n.props.segments);let c;return r.length<2?c=Lae(l[0],o):c=ql(r,!1),a.jsx("path",{d:c})}toSvg(n){const s=wl(n),i=s<1.5,r=1/n.props.scale;return a.jsx("g",{transform:`scale(${r})`,children:a.jsx(zg,{forceSolid:i,strokeWidth:s,shape:n,opacity:pA})})}toBackgroundSvg(n){const s=wl(n),i=s<1.5,r=1/n.props.scale;return a.jsx("g",{transform:`scale(${r})`,children:a.jsx(zg,{forceSolid:i,strokeWidth:s,shape:n,opacity:fA})})}}b(qm,"type","highlight"),b(qm,"props",wF),b(qm,"migrations",_F);function Dae(t){return`M ${t.x} ${t.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function Lae(t,e){const n=e/2;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function gA(t,e,n){var c;const s=Ld(t.props.segments),i=t.props.isComplete||((c=Tn(t.props.segments))==null?void 0:c.type)==="straight";let r=e;!n&&!t.props.isPen&&s.length===1&&(r+=or(t.id)()*(e/6));const o=f1({strokeWidth:r,showAsComplete:i});return{strokePoints:Wr(s,o),sw:r}}function wl(t){return Md[t.props.size]*1.12*t.props.scale}function $g(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function zg({strokeWidth:t,forceSolid:e,shape:n,opacity:s}){var p;const i=Li(),r=Ld(n.props.segments);let o=t;!e&&!n.props.isPen&&r.length===1&&(o+=or(n.id)()*(o/6));const l=f1({strokeWidth:o,showAsComplete:n.props.isComplete||((p=Tn(n.props.segments))==null?void 0:p.type)==="straight"}),c=Wr(r,l),d=c.length>1?ql(c,!1):Dae(n.props.segments[0].points[0]),u=Oae(),h=i[n.props.color].highlight[u];return a.jsx("path",{d,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:h,strokeWidth:o,opacity:s})}function vw(t,e){return Z("forceSolid",()=>{const n=wl(e),s=t.getZoomLevel();return n/s<1.5},[t])}function vB(){return a.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),a.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),a.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function xB(t,e,n){const s=K(),[i,r]=S.useState(null),o=e?s.getAsset(e):null,c=s.getCulledShapes().has(t),d=S.useRef(!1);S.useEffect(()=>{i&&(d.current=!0)},[i]);const u=o&&"w"in o.props?n/o.props.w:1,h=Z("zoom level",()=>s.getZoomLevel()*u,[s,u]);return S.useEffect(()=>{if(c)return;let p=!1;const f=s.timers.setTimeout(async()=>{const g=await s.resolveAssetUrl(e,{screenScale:h});p||r(g)},d.current?500:0);return()=>{clearTimeout(f),p=!0}},[e,o==null?void 0:o.props.src,c,h,s]),{asset:o,url:i}}function SB(){const[t,e]=S.useState(!1);return S.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const n=window.matchMedia("(prefers-reduced-motion: reduce)"),s=()=>{e(n.matches)};return s(),n.addEventListener("change",s),()=>n.removeEventListener("change",s)},[]),t}async function Fae(t){const n=await(await Ur(t)).blob();return Dl.blobToDataUrl(n)}class Zm extends au{constructor(){super(...arguments);b(this,"isAspectRatioLocked",()=>!0);b(this,"canCrop",()=>!0);b(this,"onResize",(n,s)=>{let i=i1(n,s);const{flipX:r,flipY:o}=s.initialShape.props;return i={...i,props:{...i.props,flipX:s.scaleX<0!==r,flipY:s.scaleY<0!==o}},i});b(this,"onDoubleClick",n=>{const s=n.props.assetId?this.editor.getAsset(n.props.assetId):void 0;!s||!(s.props.src&&this.isAnimated(n))||this.editor.updateShapes([{type:"image",id:n.id,props:{playing:!n.props.playing}}])});b(this,"onDoubleClickEdge",n=>{const s=n.props;if(!s||this.editor.getCroppingShapeId()!==n.id)return;const i=yt(s.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},r=1/(i.bottomRight.x-i.topLeft.x)*n.props.w,o=1/(i.bottomRight.y-i.topLeft.y)*n.props.h,l=new E(i.topLeft.x*r,i.topLeft.y*o).rot(n.rotation),c={id:n.id,type:n.type,x:n.x-l.x,y:n.y-l.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:r,h:o}};this.editor.updateShapes([c])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}isAnimated(n){const s=n.props.assetId?this.editor.getAsset(n.props.assetId):void 0;return s?"mimeType"in s.props&&Er.isAnimatedImageType(s==null?void 0:s.props.mimeType)||"isAnimated"in s.props&&s.props.isAnimated:!1}component(n){var y;const s=this.editor.getCroppingShapeId()===n.id,i=SB(),[r,o]=S.useState(""),[l,c]=S.useState(""),d=n.id===this.editor.getOnlySelectedShapeId(),{asset:u,url:h}=xB(n.id,n.props.assetId,n.props.w);if(S.useEffect(()=>{if(h){let x=!1;const m=Nd();return m.onload=()=>{x||c(h)},m.src=h,()=>{x=!0}}},[h,n]),S.useEffect(()=>{if(h&&this.isAnimated(n)){let x=!1;const m=Nd();return m.onload=()=>{if(x)return;const v=document.createElement("canvas");v.width=m.width,v.height=m.height;const w=v.getContext("2d");w&&(w.drawImage(m,0,0),o(v.toDataURL()),c(h))},m.crossOrigin="anonymous",m.src=h,()=>{x=!0}}},[i,h,n]),(u==null?void 0:u.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const p=d&&s&&this.editor.isIn("select.crop"),f=i&&(((y=u==null?void 0:u.props.mimeType)==null?void 0:y.includes("video"))||this.isAnimated(n)),g=mA(n);return u!=null&&u.props.src?l?a.jsxs(a.Fragment,{children:[p&&a.jsx("div",{style:g,children:a.jsx("img",{className:"tl-image",crossOrigin:this.isAnimated(n)?"anonymous":void 0,src:!n.props.playing||f?r:l,referrerPolicy:"strict-origin-when-cross-origin",style:{opacity:.1},draggable:!1})}),a.jsxs(Xl,{id:n.id,style:{overflow:"hidden",width:n.props.w,height:n.props.h},children:[a.jsxs("div",{className:"tl-image-container",style:g,children:[a.jsx("img",{className:Se("tl-image",{"tl-flip-x":n.props.flipX&&!n.props.flipY,"tl-flip-y":n.props.flipY&&!n.props.flipX,"tl-flip-xy":n.props.flipY&&n.props.flipX}),crossOrigin:this.isAnimated(n)?"anonymous":void 0,src:!n.props.playing||f?r:l,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1}),this.isAnimated(n)&&!n.props.playing&&a.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),n.props.url&&a.jsx(Dd,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]})]}):null:a.jsxs(Xl,{id:n.id,style:{overflow:"hidden",width:n.props.w,height:n.props.h,color:"var(--color-text-3)",backgroundColor:u?"transparent":"var(--color-low)",border:u?"none":"1px solid var(--color-low-border)"},children:[a.jsx("div",{className:"tl-image-container",style:g,children:u?null:a.jsx(vB,{})}),"url"in n.props&&n.props.url&&a.jsx(Dd,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(n){return this.editor.getCroppingShapeId()===n.id?null:a.jsx("rect",{width:G(n.props.w),height:G(n.props.h)})}async toSvg(n){if(!n.props.assetId||!this.editor.getAsset(n.props.assetId))return null;let i=await this.editor.resolveAssetUrl(n.props.assetId,{shouldResolveToOriginal:!0});if(!i)return null;(i.startsWith("blob:")||i.startsWith("http")||i.startsWith("/")||i.startsWith("./"))&&(i=await Fae(i)||"");const r=mA(n),o=n.props.crop;if(r.transform&&o){const{transform:l,width:c,height:d}=r,u=(o.bottomRight.x-o.topLeft.x)*c,h=(o.bottomRight.y-o.topLeft.y)*d,p=[new E(0,0),new E(u,0),new E(u,h),new E(0,h)],f=`cropClipPath_${n.id.replace(":","_")}`;return a.jsxs(a.Fragment,{children:[a.jsx("defs",{children:a.jsx("clipPath",{id:f,children:a.jsx("polygon",{points:p.map(g=>`${g.x},${g.y}`).join(" ")})})}),a.jsx("g",{clipPath:`url(#${f})`,children:a.jsx("image",{href:i,width:c,height:d,style:{transform:l}})})]})}else return a.jsx("image",{href:i,width:n.props.w,height:n.props.h})}}b(Zm,"type","image"),b(Zm,"props",CF),b(Zm,"migrations",EF);function mA(t){const e=t.props.crop,n=e==null?void 0:e.topLeft;if(!n)return{width:t.props.w,height:t.props.h};const s=1/(e.bottomRight.x-e.topLeft.x)*t.props.w,i=1/(e.bottomRight.y-e.topLeft.y)*t.props.h,r=-n.x*s,o=-n.y*i;return{transform:`translate(${r}px, ${o}px)`,width:s,height:i}}function bB(t){return{size:t,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function wB(t,e,n){const s=e.vertices,i=bB(n);return Wr(s,i)}function Bae(t,e,n){const s=bB(n);return a1(Gx(wB(t,e,n),s),s)}function Uae(t,e,n){const s=Bae(t,e,n);return HT(s)}function $ae(t,e,n){if(t.props.dash==="draw"){const s=wB(t,e,n);return ql(s)}return e.getSvgPathData()}function _B(t,e,n){let s=`M ${Xe(e[0])}L`,i=`M ${Xe(e[0])}L`;const r=n/3,o=n*2,l=or(t);let c=e[0],d,u=e[0],h;const p=e.length;for(let f=0,g=p-1;f<g;f++){d=e[f+1],h=E.AddXY(e[f+1],l()*r,l()*r);const y=E.Sub(d,c),x=E.Len(y),m=E.Div(y,x).mul(Math.min(x/4,o)),v=E.Add(c,m),w=E.Add(d,m.neg()),_=E.Sub(h,u),C=E.Len(_),I=E.Div(_,C).mul(Math.min(C/4,o)),T=E.Add(u,I),P=E.Add(h,I.neg());f===g-1?(s+=`${Xe(v)}L ${Xe(d)}`,i+=`${Xe(T)}L ${Xe(h)}`):(s+=`${Xe(v)}L ${Xe(w)}Q ${Xe(d)}`,i+=`${Xe(T)}L ${Xe(P)}Q ${Xe(h)}`,c=d,u=h)}return[s,s+i]}const zae=new jo;class Jm extends Ji{constructor(){super(...arguments);b(this,"hideResizeHandles",()=>!0);b(this,"hideRotateHandle",()=>!0);b(this,"hideSelectionBoundsFg",()=>!0);b(this,"hideSelectionBoundsBg",()=>!0);b(this,"onResize",(n,s)=>{const{scaleX:i,scaleY:r}=s;return{props:{points:df(n.props.points,(o,{id:l,index:c,x:d,y:u})=>({id:l,index:c,x:d*i,y:u*r}))}}});b(this,"onHandleDrag",(n,{handle:s})=>{if(s.type==="vertex")return{...n,props:{...n.props,points:{...n.props.points,[s.id]:{id:s.id,index:s.index,x:s.x,y:s.y}}}}})}getDefaultProps(){const[n,s]=Cp(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[n]:{id:n,index:n,x:0,y:0},[s]:{id:s,index:s,x:.1,y:.1}},scale:1}}getGeometry(n){return Sh(n)}getHandles(n){return zae.get(n.props,()=>{const s=Sh(n),i=xh(n),r=i.map(o=>({...o,id:o.index,type:"vertex",canSnap:!0}));for(let o=0;o<i.length-1;o++){const l=_p(i[o].index,i[o+1].index),d=s.segments[o].midPoint();r.push({id:l,type:"create",index:l,x:d.x,y:d.y,canSnap:!0})}return r.sort(Xn)})}component(n){return a.jsx(Ha,{id:n.id,children:a.jsx(yA,{shape:n})})}indicator(n){const s=hn[n.props.size]*n.props.scale,i=Sh(n),{dash:r}=n.props;let o;if(n.props.spline==="line"){const l=i.points;if(r==="solid"||r==="dotted"||r==="dashed")o="M"+l[0]+"L"+l.slice(1);else{const[c]=_B(n.id,l,s);o=c}}else o=$ae(n,i,s);return a.jsx("path",{d:o})}toSvg(n){return a.jsx(yA,{shouldScale:!0,shape:n})}getHandleSnapGeometry(n){const s=xh(n);return{points:s,getSelfSnapPoints:i=>{const r=this.getHandles(n).filter(o=>o.type==="vertex").findIndex(o=>o.id===i.id);return s.filter((o,l)=>Math.abs(l-r)>1).map(E.From)},getSelfSnapOutline:i=>{const r=this.getHandles(n).filter(l=>l.type==="vertex").findIndex(l=>l.id===i.id),o=Sh(n).segments.filter((l,c)=>c!==r-1&&c!==r);return o.length?new sr({children:o}):null}}}getInterpolatedProps(n,s,i){const r=xh(n),o=xh(s),l=[],c=[];let d=LL;if(r.length>o.length)for(let u=0;u<r.length;u++)l[u]={...r[u]},o[u]===void 0?c[u]={...o[o.length-1],id:d}:c[u]={...o[u],id:d},d=Vi(d);else if(o.length>r.length)for(let u=0;u<o.length;u++)c[u]={...o[u]},r[u]===void 0?l[u]={...r[r.length-1],id:d}:l[u]={...r[u],id:d},d=Vi(d);else for(let u=0;u<o.length;u++)l[u]=r[u],c[u]=o[u];return{...s.props,points:Object.fromEntries(l.map((u,h)=>{const p=c[h];return[u.id,{...u,x:js(u.x,p.x,i),y:js(u.y,p.y,i)}]}))}}}b(Jm,"type","line"),b(Jm,"props",TF),b(Jm,"migrations",IF);function xh(t){return Object.values(t.props.points).sort(Xn)}function Sh(t){const e=xh(t).map(E.From);switch(t.props.spline){case"cubic":return new ure({points:e});case"line":return new ou({points:e})}}function yA({shape:t,shouldScale:e=!1}){const n=Li(),s=Sh(t),{dash:i,color:r,size:o}=t.props,l=1/t.props.scale,c=e?l:1,d=hn[o]*t.props.scale;if(t.props.spline==="line"){if(i==="solid"){const u=s.points,h="M"+u[0]+"L"+u.slice(1);return a.jsx("path",{d:h,stroke:n[r].solid,strokeWidth:d,fill:"none",transform:`scale(${c})`})}if(i==="dashed"||i==="dotted")return a.jsx("g",{stroke:n[r].solid,strokeWidth:d,transform:`scale(${c})`,children:s.segments.map((u,h)=>{const{strokeDasharray:p,strokeDashoffset:f}=xr(u.length,d,{style:i,start:h>0?"outset":"none",end:h<s.segments.length-1?"outset":"none"});return a.jsx("path",{strokeDasharray:p,strokeDashoffset:f,d:u.getSvgPathData(!0),fill:"none"},h)})});if(i==="draw"){const u=s.points,[h,p]=_B(t.id,u,d);return a.jsx("path",{d:p,stroke:n[r].solid,strokeWidth:d,fill:"none",transform:`scale(${c})`})}}if(t.props.spline==="cubic"){const u=s.getSvgPathData();if(i==="solid")return a.jsx("path",{strokeWidth:d,stroke:n[r].solid,fill:"none",d:u,transform:`scale(${c})`});if(i==="dashed"||i==="dotted")return a.jsx("g",{stroke:n[r].solid,strokeWidth:d,transform:`scale(${c})`,children:s.segments.map((h,p)=>{const{strokeDasharray:f,strokeDashoffset:g}=xr(h.length,d,{style:i,start:p>0?"outset":"none",end:p<s.segments.length-1?"outset":"none"});return a.jsx("path",{strokeDasharray:f,strokeDashoffset:g,d:h.getSvgPathData(),fill:"none"},p)})});if(i==="draw")return a.jsx("path",{d:Uae(t,s,d),strokeWidth:1,stroke:n[r].solid,fill:n[r].solid,transform:`scale(${c})`})}}const CB=S.createContext(null);function Wae({assetUrls:t,children:e}){return S.useEffect(()=>{for(const n of Object.values(t.icons)){const s=Nd();s.src=n,s.decode()}for(const n of Object.values(t.embedIcons)){const s=Nd();s.src=n,s.decode()}},[t]),a.jsx(CB.Provider,{value:t,children:e})}function m1(){const t=S.useContext(CB);if(!t)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return t}const pC={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project","share-menu.copied":"Copied link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},Hae=new Set(["ar","fa","he","ur","ku"]),Tc={locale:"en",label:"English",messages:pC,dir:"ltr"};async function Gae(t,e){if(!(await Ur(e.translations.en)).ok)return console.warn("No main translations found."),Tc;if(t==="en")return Tc;const s=Tp.find(o=>o.locale===t);if(!s)return console.warn(`No translation found for locale ${t}`),Tc;const r=await(await Ur(e.translations[s.locale])).json();if(!r)return console.warn(`No messages found for locale ${t}`),Tc;for(const o in Tc.messages)r[o];return{locale:t,label:s.label,dir:Hae.has(s.locale)?"rtl":"ltr",messages:{...Tc.messages,...r}}}const EB=S.createContext(null);function TB(){const t=S.useContext(EB);if(!t)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return t}const Vae=yn(function({overrides:e,children:n}){const i=K().user.getLocale(),r=m1(),[o,l]=S.useState(()=>e&&e.en?{locale:"en",label:"English",dir:"ltr",messages:{...pC,...e.en}}:{locale:"en",label:"English",dir:"ltr",messages:pC});return S.useEffect(()=>{let c=!1;async function d(){const u=await Gae(i,r);u&&!c&&(e&&e[i]?l({...u,messages:{...u.messages,...e[i]}}):l(u))}return d(),()=>{c=!0}},[r,i,e]),a.jsx(EB.Provider,{value:o,children:n})});function $e(){const t=TB();return S.useCallback(function(n){return t.messages[n]??n},[t])}class Qm extends Ji{constructor(){super(...arguments);b(this,"canEdit",()=>!0);b(this,"hideResizeHandles",()=>!0);b(this,"hideSelectionBoundsFg",()=>!1);b(this,"onBeforeCreate",n=>vA(this.editor,n));b(this,"onBeforeUpdate",(n,s)=>{if(!(n.props.text===s.props.text&&n.props.font===s.props.font&&n.props.size===s.props.size))return vA(this.editor,s)});b(this,"onEditEnd",n=>{const{id:s,type:i,props:{text:r}}=n;r.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:s,type:i,props:{text:r.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(n){const{labelHeight:s,labelWidth:i}=IB(this.editor,n),{scale:r}=n.props,o=s*r,l=i*r,c=lt*r,d=Wg(n);return new sr({children:[new Ao({width:c,height:d,isFilled:!0}),new Ao({x:n.props.align==="start"?0:n.props.align==="end"?c-l:(c-l)/2,y:n.props.verticalAlign==="start"?0:n.props.verticalAlign==="end"?d-o:(d-o)/2,width:l,height:o,isFilled:!0,isLabel:!0})]})}getHandles(n){const{scale:s}=n.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const r=this.editor.getZoomLevel();if(r*s<.25)return[];const o=Wg(n),l=lt*s,c=xoe/r*s;return r*s<.5?[{id:"bottom",index:"a3",type:"clone",x:l/2,y:o+c}]:[{id:"top",index:"a1",type:"clone",x:l/2,y:-c},{id:"right",index:"a2",type:"clone",x:l+c,y:o/2},{id:"bottom",index:"a3",type:"clone",x:l/2,y:o+c},{id:"left",index:"a4",type:"clone",x:-c,y:o/2}]}component(n){const{id:s,type:i,props:{scale:r,color:o,font:l,size:c,align:d,text:u,verticalAlign:h,fontSizeAdjustment:p}}=n,f=Xae(s),g=Li(),y=lt*r,x=Wg(n),m=Z("shape rotation",()=>{var _;return((_=this.editor.getShapePageTransform(s))==null?void 0:_.rotation())??0},[this.editor]),v=Z("zoom",()=>this.editor.getZoomLevel()<.35/r,[r,this.editor]),w=n.id===this.editor.getOnlySelectedShapeId();return a.jsxs(a.Fragment,{children:[a.jsx("div",{id:s,className:"tl-note__container",style:{width:y,height:x,backgroundColor:g[o].note.fill,borderBottom:v?`${3*r}px solid rgb(15, 23, 31, .2)`:"none",boxShadow:v?"none":qae(n.id,m,r)},children:a.jsx(Xx,{id:s,type:i,font:l,fontSize:(p||_o[c])*r,lineHeight:An.lineHeight,align:d,verticalAlign:h,text:u,isNote:!0,isSelected:w,labelColor:g[o].note.text,wrap:!0,padding:16*r,onKeyDown:f})}),"url"in n.props&&n.props.url&&a.jsx(Dd,{url:n.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(n){const{scale:s}=n.props;return a.jsx("rect",{rx:s,width:G(lt*s),height:G(Wg(n))})}toSvg(n,s){n.props.text&&s.addExportDef(Kx(n.props.font));const i=Wo({isDarkMode:s.isDarkMode}),r=Zae(n);return a.jsxs(a.Fragment,{children:[a.jsx("rect",{x:5,y:5,rx:1,width:lt-10,height:r.h,fill:"rgba(0,0,0,.1)"}),a.jsx("rect",{rx:1,width:lt,height:r.h,fill:i[n.props.color].note.fill}),a.jsx(Yx,{fontSize:n.props.fontSizeAdjustment||_o[n.props.size],font:n.props.font,align:n.props.align,verticalAlign:n.props.verticalAlign,text:n.props.text,labelColor:i[n.props.color].note.text,bounds:r,stroke:!1})]})}}b(Qm,"type","note"),b(Qm,"props",PF),b(Qm,"migrations",kF);function vA(t,e){const{labelHeight:n,fontSizeAdjustment:s}=IB(t,e),i=Math.max(0,n-lt);if(i!==e.props.growY||s!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:i,fontSizeAdjustment:s}}}function Kae(t,e){const{text:n}=e.props;if(!n)return{labelHeight:_o[e.props.size]*An.lineHeight+xi*2,labelWidth:100,fontSizeAdjustment:0};const s=_o[e.props.size];let i=0,r=0,o=lt,l=lt;const c=1;do{i=Math.min(s,s-r);const d=t.textMeasure.measureText(n,{...An,fontFamily:Dr[e.props.font],fontSize:i,maxWidth:lt-xi*2-c,disableOverflowWrapBreaking:!0});if(o=d.h+xi*2,l=d.w+xi*2,i<=14){const u=t.textMeasure.measureText(n,{...An,fontFamily:Dr[e.props.font],fontSize:i,maxWidth:lt-xi*2-c});o=u.h+xi*2,l=u.w+xi*2;break}if(d.scrollWidth.toFixed(0)===d.w.toFixed(0))break}while(r++<50);return{labelHeight:o,labelWidth:l,fontSizeAdjustment:i}}const Yae=new jo;function IB(t,e){return Yae.get(e,()=>Kae(t,e))}function Xae(t){const e=K(),n=TB();return S.useCallback(s=>{const i=e.getShape(t);if(!i)return;const r=s.key==="Tab",o=(s.metaKey||s.ctrlKey)&&s.key==="Enter";if(r||o){s.preventDefault();const l=e.getShapePageTransform(t),c=l.rotation(),d=!!(n.dir==="rtl"||J5(i.props.text)),u=(lt+e.options.adjacentShapeMargin+(o&&!s.shiftKey?i.props.growY:0))*i.props.scale,h=new E(r?s.shiftKey!=d?-1:1:0,o?s.shiftKey?-1:1:0).mul(u).add(Vx.clone().mul(i.props.scale)).rot(c).add(l.point()),p=oB(e,i,h,c);p&&(e.mark("editing adjacent shape"),yv(e,p,!0))}},[t,e,n.dir])}function Wg(t){return(lt+t.props.growY)*t.props.scale}function qae(t,e,n){const s=or(t),i=Math.abs(s())+.5,r=Math.cos(e),o=5*n,l=4*n,c=6*n,d=7*n;return`0px ${o-i}px ${o}px -${o}px rgba(15, 23, 31, .6),
	0px ${(l+i*d)*Math.max(0,r)}px ${c+i*d}px -${l+i*c}px rgba(15, 23, 31, ${(.3+i*.1).toFixed(2)}), 
	0px ${48*n}px ${10*n}px -${10*n}px inset rgba(15, 23, 44, ${((.022+s()*.005)*((1+r)/2)).toFixed(2)})`}function Zae(t){return new de(0,0,lt,lt+t.props.growY)}function Jae(t,{initialBounds:e,scaleX:n,scaleY:s,newPoint:i}){const r=Math.max(.01,Math.min(Math.abs(n),Math.abs(s))),o=new E(0,0);n<0&&(o.x=-(e.width*r)),s<0&&(o.y=-(e.height*r));const{x:l,y:c}=E.Add(i,o.rot(t.rotation));return{x:l,y:c,props:{scale:r*t.props.scale}}}const Qae=new jo;class ey extends Ji{constructor(){super(...arguments);b(this,"canEdit",()=>!0);b(this,"isAspectRatioLocked",()=>!0);b(this,"onResize",(n,s)=>{const{newPoint:i,initialBounds:r,initialShape:o,scaleX:l,handle:c}=s;if(s.mode==="scale_shape"||c!=="right"&&c!=="left")return{id:n.id,type:n.type,...Jae(n,s)};{const d=Math.max(1,Math.abs(r.width*l)),{x:u,y:h}=l<0?E.Sub(i,E.FromAngle(n.rotation).mul(d)):i;return{id:n.id,type:n.type,x:u,y:h,props:{w:d/o.props.scale,autoSize:!1}}}});b(this,"onEditEnd",n=>{const{id:s,type:i,props:{text:r}}=n,o=n.props.text.trimEnd();o.length===0?this.editor.deleteShapes([n.id]):o!==n.props.text&&this.editor.updateShapes([{id:s,type:i,props:{text:r.trimEnd()}}])});b(this,"onBeforeUpdate",(n,s)=>{if(!s.props.autoSize)return;const i=n.props.size!==s.props.size||n.props.textAlign!==s.props.textAlign||n.props.font!==s.props.font||n.props.scale!==1&&s.props.scale===1,r=n.props.text!==s.props.text;if(!i&&!r)return;const o=this.getMinDimensions(n),l=xA(this.editor,s.props),c=o.width*n.props.scale,d=o.height*n.props.scale,u=l.width*s.props.scale,h=l.height*s.props.scale;let p;switch(s.props.textAlign){case"middle":{p=new E((u-c)/2,r?0:(h-d)/2);break}case"end":{p=new E(u-c,r?0:(h-d)/2);break}default:{if(r)break;p=new E(0,(h-d)/2);break}}if(p){p.rot(s.rotation);const{x:f,y:g}=s;return{...s,x:f-p.x,y:g-p.y,props:{...s.props,w:u}}}else return{...s,props:{...s.props,w:u}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(n){return Qae.get(n.props,s=>xA(this.editor,s))}getGeometry(n){const{scale:s}=n.props,{width:i,height:r}=this.getMinDimensions(n);return new Ao({width:i*s,height:r*s,isFilled:!0,isLabel:!0})}component(n){const{id:s,props:{font:i,size:r,text:o,color:l,scale:c,textAlign:d}}=n,{width:u,height:h}=this.getMinDimensions(n),p=n.id===this.editor.getOnlySelectedShapeId(),f=Li(),g=ele(s);return a.jsx(Xx,{id:s,classNamePrefix:"tl-text-shape",type:"text",font:i,fontSize:Md[r],lineHeight:An.lineHeight,align:d,verticalAlign:"middle",text:o,labelColor:f[l].solid,isSelected:p,textWidth:u,textHeight:h,style:{transform:`scale(${c})`,transformOrigin:"top left"},wrap:!0,onKeyDown:g})}indicator(n){const s=this.editor.getShapeGeometry(n).bounds,i=K();return n.props.autoSize&&i.getEditingShapeId()===n.id?null:a.jsx("rect",{width:G(s.width),height:G(s.height)})}toSvg(n,s){n.props.text&&s.addExportDef(Kx(n.props.font));const i=this.editor.getShapeGeometry(n).bounds,r=i.width/(n.props.scale??1),o=i.height/(n.props.scale??1),l=Wo(s);return a.jsx(Yx,{fontSize:Md[n.props.size],font:n.props.font,align:n.props.textAlign,verticalAlign:"middle",text:n.props.text,labelColor:l[n.props.color].solid,bounds:new de(0,0,r,o),padding:0})}}b(ey,"type","text"),b(ey,"props",jF),b(ey,"migrations",NF);function xA(t,e){const{font:n,text:s,autoSize:i,size:r,w:o}=e,l=i?16:Math.max(16,o),c=Md[r],d=i?null:Math.floor(Math.max(l,o)),u=t.textMeasure.measureText(s,{...An,fontFamily:Dr[n],fontSize:c,maxWidth:d});return i&&(u.w+=1),{width:Math.max(l,u.w),height:Math.max(c,u.h)}}function ele(t){const e=K();return S.useCallback(n=>{if(e.getEditingShapeId()===t)switch(n.key){case"Enter":{(n.ctrlKey||n.metaKey)&&e.complete();break}case"Tab":{Ve(n),n.shiftKey?Od.unindent(n.currentTarget):Od.indent(n.currentTarget);break}}},[e,t])}class ty extends au{constructor(){super(...arguments);b(this,"canEdit",()=>!0);b(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(n){const{editor:s}=this,i=s.getShapeGeometry(n).bounds.w*s.getZoomLevel()>=110,{asset:r,url:o}=xB(n.id,n.props.assetId,n.props.w),{time:l,playing:c}=n.props,d=Hx(n.id),u=SB(),h=S.useRef(null),p=S.useCallback(v=>{const w=v.currentTarget;w&&s.updateShapes([{type:"video",id:n.id,props:{playing:!0,time:w.currentTime}}])},[n.id,s]),f=S.useCallback(v=>{const w=v.currentTarget;w&&s.updateShapes([{type:"video",id:n.id,props:{playing:!1,time:w.currentTime}}])},[n.id,s]),g=S.useCallback(v=>{const w=v.currentTarget;w&&d&&s.updateShapes([{type:"video",id:n.id,props:{time:w.currentTime}}])},[d,n.id,s]),[y,x]=S.useState(!1),m=S.useCallback(v=>{const w=v.currentTarget;w&&(l!==w.currentTime&&(w.currentTime=l),c||w.pause(),x(!0))},[c,l]);return S.useEffect(()=>{const v=h.current;v&&(y&&!d&&l!==v.currentTime&&(v.currentTime=l),d&&document.activeElement!==v&&v.focus())},[d,y,l]),S.useEffect(()=>{if(u){const v=h.current;if(!v)return;v.pause(),v.currentTime=0}},[h,u]),a.jsxs(a.Fragment,{children:[a.jsx(Xl,{id:n.id,style:{color:"var(--color-text-3)",backgroundColor:r?"transparent":"var(--color-low)",border:r?"none":"1px solid var(--color-low-border)"},children:a.jsx("div",{className:"tl-counter-scaled",children:a.jsx("div",{className:"tl-video-container",children:r!=null&&r.props.src?o?a.jsx("video",{ref:h,style:d?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${n.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:d&&i,onPlay:p,onPause:f,onTimeUpdate:g,onLoadedData:m,hidden:!y,children:a.jsx("source",{src:o})}):null:a.jsx(vB,{})})})}),"url"in n.props&&n.props.url&&a.jsx(Dd,{url:n.props.url,zoomLevel:s.getZoomLevel()})]})}indicator(n){return a.jsx("rect",{width:G(n.props.w),height:G(n.props.h)})}toSvg(n){return a.jsx("image",{href:tle(n.id),width:n.props.w,height:n.props.h})}}b(ty,"type","video"),b(ty,"props",AF),b(ty,"migrations",RF);function tle(t){const e=t.split(":")[1],n=document.querySelector(`.tl-video-shape-${e}`);if(n){const s=document.createElement("canvas");return s.width=n.videoWidth,s.height=n.videoHeight,s.getContext("2d").drawImage(n,0,0),s.toDataURL("image/png")}else throw new Error("Video with not found when attempting serialization.")}const PB=[ey,Gm,Vm,Xm,Qm,Jm,Ym,Hm,qm,Km,Zm,ty];function nle(t){return t.sideEffects.register({instance_page_state:{afterChange:(e,n)=>{if(e.croppingShapeId!==n.croppingShapeId){const s=t.isIn("select.crop");!e.croppingShapeId&&n.croppingShapeId?s||t.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!n.croppingShapeId&&s&&t.setCurrentTool("select.idle")}e.editingShapeId!==n.editingShapeId&&(!e.editingShapeId&&n.editingShapeId?t.isIn("select.editing_shape")||t.setCurrentTool("select.editing_shape"):e.editingShapeId&&!n.editingShapeId&&t.isIn("select.editing_shape")&&t.setCurrentTool("select.idle"))}}})}class kB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"scribbleId","id");b(this,"markId","");b(this,"excludedShapeIds",new Set);b(this,"onEnter",n=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=n;const{originPagePoint:s}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(r=>{if(this.editor.isShapeOrAncestorLocked(r))return!0;if(this.editor.isShapeOfType(r,"group")||this.editor.isShapeOfType(r,"frame")){const o=this.editor.getPointInShapeSpace(r,s);return this.editor.getShapeGeometry(r).bounds.containsPoint(o)}return!1}).map(r=>r.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()});b(this,"pushPointToScribble",()=>{const{x:n,y:s}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,s)});b(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});b(this,"onPointerMove",()=>{this.update()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.complete()})}update(){const{editor:n,excludedShapeIds:s}=this,i=n.getErasingShapeIds(),r=n.getZoomLevel(),o=n.getCurrentPageShapes(),{inputs:{currentPagePoint:l,previousPagePoint:c}}=n;this.pushPointToScribble();const d=new Set(i),u=this.editor.options.hitTestMargin/r;for(const h of o){if(n.isShapeOfType(h,"group"))continue;const p=n.getShapeMask(h.id);if(p&&!si(l,p))continue;const f=n.getShapeGeometry(h),g=n.getShapePageTransform(h);if(!f||!g)continue;const y=g.clone().invert(),x=y.applyToPoint(c),m=y.applyToPoint(l),{bounds:v}=f;v.minX-u>Math.max(x.x,m.x)||v.minY-u>Math.max(x.y,m.y)||v.maxX+u<Math.min(x.x,m.x)||v.maxY+u<Math.min(x.y,m.y)||f.hitTestLineSegment(x,m,u)&&d.add(n.getOutermostSelectableShape(h).id)}this.editor.setErasingShapes([...d].filter(h=>!s.has(h)))}complete(){const{editor:n}=this;n.deleteShapes(n.getCurrentPageState().erasingShapeIds),n.setErasingShapes([]),this.parent.transition("idle")}cancel(){const{editor:n}=this;n.setErasingShapes([]),n.bailToMark(this.markId),this.parent.transition("idle",this.info)}}b(kB,"id","erasing");var w0;let sle=(w0=class extends ye{constructor(){super(...arguments);b(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});b(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},b(w0,"id","idle"),w0);var _0;let ile=(_0=class extends ye{constructor(){super(...arguments);b(this,"onEnter",()=>{const n=this.editor.getZoomLevel(),s=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:i}}=this.editor,r=new Set,o=r.size;for(let l=s.length,c=l-1;c>=0;c--){const d=s[c];if(!(this.editor.isShapeOrAncestorLocked(d)||this.editor.isShapeOfType(d,"group"))&&this.editor.isPointInShape(d,i,{hitInside:!1,margin:this.editor.options.hitTestMargin/n})){const u=this.editor.getOutermostSelectableShape(d);if(this.editor.isShapeOfType(u,"frame")&&r.size>o)break;r.add(u.id)}}this.editor.setErasingShapes([...r])});b(this,"onLongPress",n=>{this.startErasing(n)});b(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.startErasing(n)});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.complete()});b(this,"onInterrupt",()=>{this.cancel()})}startErasing(n){this.parent.transition("erasing",n)}complete(){const n=this.editor.getErasingShapeIds();n.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(n)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},b(_0,"id","pointing"),_0);class bh extends ye{constructor(){super(...arguments);b(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}b(bh,"id","eraser"),b(bh,"initial","idle"),b(bh,"isLockable",!1),b(bh,"children",()=>[sle,ile,kB]);class jB extends ye{constructor(){super(...arguments);b(this,"initialCamera",new E);b(this,"onEnter",()=>{this.initialCamera=E.From(this.editor.getCamera()),this.update()});b(this,"onPointerMove",()=>{this.update()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.parent.transition("idle")});b(this,"onComplete",()=>{this.complete()})}update(){const{initialCamera:n,editor:s}=this,{currentScreenPoint:i,originScreenPoint:r}=s.inputs,o=E.Sub(i,r).div(s.getZoomLevel());o.len2()!==0&&s.setCamera(n.clone().add(o))}complete(){const{editor:n}=this,{pointerVelocity:s}=n.inputs,i=Math.min(s.len(),2);i>.1&&this.editor.slideCamera({speed:i,direction:s}),this.parent.transition("idle")}}b(jB,"id","dragging");var C0;let rle=(C0=class extends ye{constructor(){super(...arguments);b(this,"onEnter",()=>{this.editor.setCursor({type:"grab",rotation:0})});b(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});b(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},b(C0,"id","idle"),C0);var E0;let ole=(E0=class extends ye{constructor(){super(...arguments);b(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})});b(this,"onLongPress",()=>{this.startDragging()});b(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startDragging()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.complete()});b(this,"onComplete",()=>{this.complete()});b(this,"onInterrupt",()=>{this.complete()})}startDragging(){this.parent.transition("dragging")}complete(){this.parent.transition("idle")}},b(E0,"id","pointing"),E0);class wh extends ye{constructor(){super(...arguments);b(this,"onDoubleClick",n=>{if(n.phase==="settle"){const{currentScreenPoint:s}=this.editor.inputs;this.editor.zoomIn(s,{animation:{duration:220,easing:un.easeOutQuint}})}});b(this,"onTripleClick",n=>{if(n.phase==="settle"){const{currentScreenPoint:s}=this.editor.inputs;this.editor.zoomOut(s,{animation:{duration:320,easing:un.easeOutQuint}})}});b(this,"onQuadrupleClick",n=>{if(n.phase==="settle"){const s=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:i}}=this.editor;s===1?this.editor.zoomToFit({animation:{duration:400,easing:un.easeOutQuint}}):this.editor.resetZoom(i,{animation:{duration:320,easing:un.easeOutQuint}})}})}}b(wh,"id","hand"),b(wh,"initial","idle"),b(wh,"isLockable",!1),b(wh,"children",()=>[rle,ole,jB]);var T0;let ale=(T0=class extends ye{constructor(){super(...arguments);b(this,"onPointerDown",n=>{this.parent.transition("lasering",n)})}},b(T0,"id","idle"),T0);class NB extends ye{constructor(){super(...arguments);b(this,"scribbleId","id");b(this,"onEnter",()=>{const n=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=n.id,this.pushPointToScribble()});b(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});b(this,"onPointerMove",()=>{this.pushPointToScribble()});b(this,"onPointerUp",()=>{this.complete()});b(this,"pushPointToScribble",()=>{const{x:n,y:s}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,s)});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}b(NB,"id","lasering");class _h extends ye{constructor(){super(...arguments);b(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}b(_h,"id","laser"),b(_h,"initial","idle"),b(_h,"children",()=>[ale,NB]),b(_h,"isLockable",!1);class AB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"initialSelectedShapeIds",[]);b(this,"excludedShapeIds",new Set);b(this,"isWrapMode",!1);b(this,"initialStartShape",null);b(this,"onEnter",n=>{const{altKey:s,currentPagePoint:i}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),s){this.parent.transition("scribble_brushing",n);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(r=>this.editor.isShapeOfType(r,"group")||this.editor.isShapeOrAncestorLocked(r)).map(r=>r.id)),this.info=n,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.hitTestShapes()});b(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});b(this,"onTick",({elapsed:n})=>{const{editor:s}=this;s.edgeScrollManager.updateEdgeScrolling(n)});b(this,"onPointerMove",()=>{this.hitTestShapes()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onComplete",()=>{this.complete()});b(this,"onCancel",n=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",n)});b(this,"onKeyDown",n=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",n):this.hitTestShapes()});b(this,"onKeyUp",()=>{this.hitTestShapes()});b(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:n,excludedShapeIds:s,isWrapMode:i}=this,{inputs:{originPagePoint:r,currentPagePoint:o,shiftKey:l,ctrlKey:c}}=n,d=new Set(l?this.initialSelectedShapeIds:[]),u=i?!c:c,h=de.FromPoints([r,o]),{corners:p}=h;let f,g,y,x,m,v;const w=n.getCurrentPageShapes(),_=n.getCurrentPageId();e:for(let T=0,P=w.length;T<P;T++){if(y=w[T],s.has(y.id)||d.has(y.id)||(x=n.getShapePageBounds(y),!x))continue e;if(h.contains(x)){this.handleHit(y,o,_,d,p);continue e}if(u||n.isShapeOfType(y,"frame"))continue e;if(h.collides(x)){if(m=n.getShapePageTransform(y),!m)continue e;v=m.clone().invert().applyToPoints(p);const k=n.getShapeGeometry(y);t:for(let N=0;N<4;N++)if(f=v[N],g=v[(N+1)%4],k.hitTestLineSegment(f,g,0)){this.handleHit(y,o,_,d,p);break t}}}n.getInstanceState().isCoarsePointer;const C=n.getInstanceState().brush;(!C||!h.equals(C))&&n.updateInstanceState({brush:{...h.toJson()}});const I=n.getSelectedShapeIds();(I.length!==d.size||I.some(T=>!d.has(T)))&&n.setSelectedShapes(Array.from(d))}handleHit(n,s,i,r,o){if(n.parentId===i){r.add(n.id);return}const l=this.editor.getOutermostSelectableShape(n),c=this.editor.getShapeMask(l.id);c&&!T5(c,o)&&!si(s,c)||r.add(l.id)}}b(AB,"id","brushing");const Fd={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class RB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"onEnter",n=>{this.info=n,this.updateCursor()});b(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startResizing()});b(this,"onLongPress",()=>{this.startResizing()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.cancel()});b(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const n=this.editor.getSelectedShapes(),s=Fd[this.info.handle];this.editor.setCursor({type:s,rotation:n.length===1?this.editor.getSelectionRotation():0})}startResizing(){this.editor.getInstanceState().isReadonly||this.parent.transition("resizing",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}b(RB,"id","pointing_resize_handle");const fi=8;class y1 extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"markId","");b(this,"snapshot",{});b(this,"onEnter",n=>{this.info=n,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()});b(this,"onPointerMove",()=>{this.updateShapes()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onComplete",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const s=Fd[this.info.handle];this.editor.setCursor({type:s,rotation:this.editor.getSelectionRotation()})}updateShapes(){const{shape:n,cursorHandleOffset:s}=this.snapshot;if(!n||!this.editor.getShapeUtil("image"))return;const r=n.props,o=this.editor.inputs.currentPagePoint.clone().sub(s),l=this.editor.inputs.originPagePoint.clone().sub(s),c=o.clone().sub(l).rot(-n.rotation),d=r.crop??this.getDefaultCrop(),u=yt(d),h=new E(n.x,n.y),p=new E(0,0),f=1/(d.bottomRight.x-d.topLeft.x)*r.w,g=1/(d.bottomRight.y-d.topLeft.y)*r.h;let y=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(g<fi)break;y=!0,u.topLeft.y=u.topLeft.y+c.y/g,g*(u.bottomRight.y-u.topLeft.y)<fi?(u.topLeft.y=u.bottomRight.y-fi/g,p.y=(u.topLeft.y-d.topLeft.y)*g):u.topLeft.y<=0?(u.topLeft.y=0,p.y=(u.topLeft.y-d.topLeft.y)*g):p.y=c.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(g<fi)break;y=!0,u.bottomRight.y=Math.min(1,u.bottomRight.y+c.y/g),g*(u.bottomRight.y-u.topLeft.y)<fi&&(u.bottomRight.y=u.topLeft.y+fi/g);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(f<fi)break;y=!0,u.topLeft.x=u.topLeft.x+c.x/f,f*(u.bottomRight.x-u.topLeft.x)<fi?(u.topLeft.x=u.bottomRight.x-fi/f,p.x=(u.topLeft.x-d.topLeft.x)*f):u.topLeft.x<=0?(u.topLeft.x=0,p.x=(u.topLeft.x-d.topLeft.x)*f):p.x=c.x;break}case"right":case"top_right":case"bottom_right":{if(f<fi)break;y=!0,u.bottomRight.x=Math.min(1,u.bottomRight.x+c.x/f),f*(u.bottomRight.x-u.topLeft.x)<fi&&(u.bottomRight.x=u.topLeft.x+fi/f);break}}if(!y)return;h.add(p.rot(n.rotation));const x={id:n.id,type:n.type,x:h.x,y:h.y,props:{crop:u,w:(u.bottomRight.x-u.topLeft.x)*f,h:(u.bottomRight.y-u.topLeft.y)*g}};this.editor.updateShapes([x]),this.updateCursor()}complete(){this.updateShapes(),pt(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const n=this.editor.getSelectionRotation(),{inputs:{originPagePoint:s}}=this.editor,i=this.editor.getOnlySelectedShape(),r=this.editor.getSelectionRotatedPageBounds(),o=E.RotWith(r.getHandlePoint(this.info.handle),r.point,n),l=E.Sub(s,o);return{shape:i,cursorHandleOffset:l}}}b(y1,"id","cropping");function MB(t,e=!1){const n=t.getZoomLevel(),{inputs:{currentPagePoint:s}}=t;return t.getShapeAtPoint(s,{hitInside:!1,hitLabels:e,margin:t.options.hitTestMargin/n,renderingOnly:!0})??t.getSelectedShapeAtPoint(s)}function OB(t,e,n){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:s}=e.props;if(!s)return;const i=t.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;i==="x"?n.x=0:i==="y"&&(n.y=0),n.rot(-e.rotation);const r=1/(s.bottomRight.x-s.topLeft.x)*e.props.w,o=1/(s.bottomRight.y-s.topLeft.y)*e.props.h,l=s.bottomRight.y-s.topLeft.y,c=s.bottomRight.x-s.topLeft.x,d=yt(s);return d.topLeft.x=Math.min(1-c,Math.max(0,d.topLeft.x-n.x/r)),d.topLeft.y=Math.min(1-l,Math.max(0,d.topLeft.y-n.y/o)),d.bottomRight.x=d.topLeft.x+c,d.bottomRight.y=d.topLeft.y+l,{id:e.id,type:e.type,props:{crop:d}}}var I0;let lle=(I0=class extends ye{constructor(){super(...arguments);b(this,"onEnter",()=>{this.editor.setCursor({type:"default",rotation:0});const n=this.editor.getOnlySelectedShape();n&&this.editor.setCroppingShape(n.id)});b(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0})});b(this,"onCancel",()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})});b(this,"onPointerDown",n=>{var s;if(!this.editor.getIsMenuOpen()){if(n.ctrlKey){this.cancel(),this.editor.root.handleEvent(n);return}switch(n.target){case"canvas":{const i=MB(this.editor);if(i&&!this.editor.isShapeOfType(i,"group")){this.onPointerDown({...n,shape:i,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(n);break}case"shape":{if(n.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",n);return}else(s=this.editor.getShapeUtil(n.shape))!=null&&s.canCrop(n.shape)?(this.editor.setCroppingShape(n.shape.id),this.editor.setSelectedShapes([n.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",n)):(this.cancel(),this.editor.root.handleEvent(n));break}case"selection":{switch(n.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...n,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...n,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}});b(this,"onDoubleClick",n=>{var o;if(this.editor.inputs.shiftKey||n.phase!=="up")return;const s=this.editor.getCroppingShapeId();if(!s)return;const i=this.editor.getShape(s);if(!i)return;const r=this.editor.getShapeUtil(i);if(r){if(n.target==="selection"){(o=r.onDoubleClickEdge)==null||o.call(r,i);return}this.cancel(),this.editor.root.handleEvent(n)}});b(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});b(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});b(this,"onKeyUp",n=>{switch(n.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(n=!1){const{editor:{inputs:{keys:s}}}=this,i=s.has("ShiftLeft"),r=new E(0,0);if(s.has("ArrowLeft")&&(r.x+=1),s.has("ArrowRight")&&(r.x-=1),s.has("ArrowUp")&&(r.y+=1),s.has("ArrowDown")&&(r.y-=1),r.equals(new E(0,0)))return;i&&r.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const l=OB(this.editor,o,r);l&&(n||this.editor.mark("translate crop"),this.editor.updateShapes([l]))}},b(I0,"id","idle"),I0);class DB extends ye{constructor(){super(...arguments);b(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});b(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",n)});b(this,"onPointerUp",n=>{this.editor.setCurrentTool("select.crop.idle",n)})}}b(DB,"id","pointing_crop");class v1 extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"onEnter",n=>{this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd);const s=this.editor.getSelectedShapes()[0];if(!s)return;const i=Fd[this.info.handle];this.editor.setCursor({type:i,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(s.id)});b(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)});b(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startCropping()});b(this,"onLongPress",()=>{this.startCropping()});b(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.cancel()});b(this,"onInterrupt",()=>{this.cancel()})}startCropping(){this.editor.getInstanceState().isReadonly||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}b(v1,"id","pointing_crop_handle");class LB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"markId","translating crop");b(this,"snapshot",{});b(this,"onEnter",n=>{this.info=n,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()});b(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0})});b(this,"onPointerMove",()=>{this.updateShapes()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onComplete",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onKeyDown",n=>{switch(n.key){case"Alt":case"Shift":{this.updateShapes();return}}});b(this,"onKeyUp",n=>{switch(n.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const n=this.snapshot.shape;if(!n)return;const{originPagePoint:s,currentPagePoint:i}=this.editor.inputs,r=i.clone().sub(s),o=OB(this.editor,n,r);o&&this.editor.updateShapes([o])}}b(LB,"id","translating_crop");class ny extends ye{constructor(){super(...arguments);b(this,"markId","");b(this,"onEnter",()=>{this.didCancel=!1,this.markId="crop",this.editor.mark(this.markId)});b(this,"didCancel",!1);b(this,"onExit",()=>{this.didCancel?this.editor.bailToMark(this.markId):this.editor.squashToMark(this.markId)});b(this,"onCancel",()=>{this.didCancel=!0})}}b(ny,"id","crop"),b(ny,"initial","idle"),b(ny,"children",()=>[lle,LB,DB,v1,y1]);class FB extends ye{constructor(){super(...arguments);b(this,"shapeId","");b(this,"initialHandle",{});b(this,"initialAdjacentHandle",null);b(this,"initialPagePoint",{});b(this,"markId","");b(this,"initialPageTransform");b(this,"initialPageRotation");b(this,"info",{});b(this,"isPrecise",!1);b(this,"isPreciseId",null);b(this,"pointingId",null);b(this,"onEnter",n=>{const{shape:s,isCreating:i,handle:r}=n;if(this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.shapeId=s.id,this.markId=i?`creating:${s.id}`:"dragging handle",i||this.editor.mark(this.markId),this.initialHandle=yt(r),this.editor.isShapeOfType(s,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...s,props:{points:{...s.props.points,[r.index]:{id:r.index,index:r.index,x:r.x,y:r.y}}}});const d=this.editor.getShapeHandles(s).find(u=>u.index===r.index);this.initialHandle=yt(d)}this.initialPageTransform=this.editor.getShapePageTransform(s),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:i?"cross":"grabbing",rotation:0});const o=this.editor.getShapeHandles(s).sort(Xn),l=o.findIndex(c=>c.id===n.handle.id);this.initialAdjacentHandle=null;for(let c=l+1;c<o.length;c++){const d=o[c];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==n.handle.id){this.initialAdjacentHandle=d;break}}if(!this.initialAdjacentHandle)for(let c=o.length-1;c>=0;c--){const d=o[c];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==n.handle.id){this.initialAdjacentHandle=d;break}}if(this.editor.isShapeOfType(s,"arrow")){const c=As(this.editor,s)[n.handle.id];this.isPrecise=!1,c?(this.editor.setHintingShapes([c.toId]),this.isPrecise=c.props.isPrecise,this.isPrecise?this.isPreciseId=c.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)});b(this,"exactTimeout",-1);b(this,"onPointerMove",()=>{this.update()});b(this,"onKeyDown",()=>{this.update()});b(this,"onKeyUp",()=>{this.update()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onComplete",()=>{this.update(),this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clearIndicators(),pt(this.editor,[this.shapeId]);const{onInteractionEnd:n}=this.info;if(this.editor.getInstanceState().isToolLocked&&n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:n}=this.info;if(n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var T;const{editor:n,shapeId:s,initialPagePoint:i}=this,{initialHandle:r,initialPageRotation:o,initialAdjacentHandle:l}=this,c=this.editor.getHintingShapeIds(),d=this.editor.user.getIsSnapMode(),{snaps:u,inputs:{currentPagePoint:h,shiftKey:p,ctrlKey:f,altKey:g,pointerVelocity:y}}=n,x=this.info.shape,m=n.getShape(s);if(!m)return;const v=n.getShapeUtil(m);let w=h.clone().sub(i).rot(-o).add(r);if(p&&l&&r.id!=="middle"){const P=E.Angle(l,w),N=lv(P,24)-P;w=E.RotWith(w,l,N)}n.snaps.clearIndicators();let _={...r,x:w.x,y:w.y};if(r.canSnap&&(d?!f:f)){if(!n.getShapePageTransform(m.id))throw Error("Expected a page transform");const k=u.handles.snapHandle({currentShapeId:s,handle:_});k&&(k.nudge.rot(-n.getShapeParentTransform(m).rotation()),w.add(k.nudge),_={...r,x:w.x,y:w.y})}const C=(T=v.onHandleDrag)==null?void 0:T.call(v,m,{handle:_,isPrecise:this.isPrecise||g,initial:x}),I={id:m.id,type:m.type,...C};if(r.type==="vertex"&&this.editor.isShapeOfType(m,"arrow")){const P=As(n,m)[r.id];P?c[0]!==P.toId&&(n.setHintingShapes([P.toId]),this.pointingId=P.toId,this.isPrecise=y.len()<.5||g,this.isPreciseId=this.isPrecise?P.toId:null,this.resetExactTimeout()):c.length>0&&(n.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}C&&n.updateShapes([I])}}b(FB,"id","dragging_handle");function BB(t){return t.isLabel?[t]:t instanceof sr?t.children.filter(e=>e.isLabel):[]}class UB extends ye{constructor(){super(...arguments);b(this,"hitShapeForPointerUp",null);b(this,"onEnter",()=>{const n=this.editor.getEditingShape();if(!n)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,go(this.editor),this.editor.select(n)});b(this,"onExit",()=>{var r;const{editingShapeId:n}=this.editor.getCurrentPageState();if(!n)return;this.editor.setEditingShape(null),go.cancel();const s=this.editor.getShape(n),i=this.editor.getShapeUtil(s);(r=i.onEditEnd)==null||r.call(i,s)});b(this,"onPointerMove",n=>{if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",n),this.hitShapeForPointerUp=null;return}switch(n.target){case"shape":case"canvas":{go(this.editor);return}}});b(this,"onPointerDown",n=>{switch(this.hitShapeForPointerUp=null,n.target){case"shape":{const{shape:s}=n,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");const r=this.editor.getShapeUtil(s).getGeometry(s),o=BB(r),l=o.length===1?o[0]:void 0,c=this.editor.isShapeOfType(i,"text")&&i.props.text.trim()==="";if(l&&!c){const d=this.editor.getPointInShapeSpace(s,this.editor.inputs.currentPagePoint);if(l.bounds.containsPoint(d,0)&&l.hitTestPoint(d)){if(s.id===i.id)return;this.hitShapeForPointerUp=s,this.editor.mark("editing on pointer up"),this.editor.select(s.id);return}}else{if(s.id===i.id)this.editor.isShapeOfType(s,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",n));else{this.parent.transition("pointing_shape",n);return}return}break}}this.parent.transition("idle",n),this.editor.root.handleEvent(n)});b(this,"onPointerUp",n=>{const s=this.hitShapeForPointerUp;if(!s)return;this.hitShapeForPointerUp=null;const i=this.editor.getShapeUtil(s);if(!s.isLocked){if(this.editor.getInstanceState().isReadonly&&!i.canEditInReadOnly(s)){this.parent.transition("pointing_shape",n);return}this.editor.select(s.id),this.editor.setEditingShape(s.id),go(this.editor)}});b(this,"onComplete",n=>{this.parent.transition("idle",n)});b(this,"onCancel",n=>{this.parent.transition("idle",n)})}}b(UB,"id","editing_shape");function SA(t){const e=t.getOnlySelectedShape();return!!(e&&!t.isShapeOrAncestorLocked(e)&&t.getShapeUtil(e).canCrop(e))}function Sv(t){const e=t.getSelectedShapeIds(),{shiftKey:n,altKey:s,currentPagePoint:i}=t.inputs,r=t.getShapeAtPoint(i,{hitInside:!1,margin:t.options.hitTestMargin/t.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:o=>!o.isLocked});if(r){const o=t.getOutermostSelectableShape(r);if(n&&!s)t.cancelDoubleClick(),e.includes(o.id)?(t.mark("deselecting shape"),t.deselect(o)):(t.mark("shift selecting shape"),t.setSelectedShapes([...e,o.id]));else{let l;o===r||o.id===t.getFocusedGroupId()||e.includes(o.id)?l=r:l=o,l&&!e.includes(l.id)&&(t.mark("selecting shape"),t.select(l.id))}}else{if(n)return;{e.length>0&&(t.mark("selecting none"),t.selectNone());const o=t.getFocusedGroupId();if(Ps(o)){const l=t.getShape(o);t.isPointInShape(l,i,{margin:0,hitInside:!0})||t.setFocusedGroup(null)}}}}const cle=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var P0;let dle=(P0=class extends ye{constructor(){super(...arguments);b(this,"onEnter",()=>{this.parent.setCurrentToolIdMask(void 0),go(this.editor),this.editor.setCursor({type:"default",rotation:0})});b(this,"onExit",()=>{go.cancel()});b(this,"onPointerMove",()=>{go(this.editor)});b(this,"onPointerDown",n=>{if(this.editor.getIsMenuOpen())return;const s=n.ctrlKey&&SA(this.editor);if(n.ctrlKey&&!s){if(n.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(n.shape)){this.parent.transition("pointing_shape",n);return}this.parent.transition("brushing",n);return}switch(n.target){case"canvas":{const i=MB(this.editor);if(i&&!i.isLocked){this.onPointerDown({...n,shape:i,target:"shape"});return}const r=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:l}}=this.editor;if((r.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&bA(this.editor,l)){this.onPointerDown({...n,target:"selection"});return}this.parent.transition("pointing_canvas",n);break}case"shape":{const{shape:i}=n;if(this.isOverArrowLabelTest(i)){this.parent.transition("pointing_arrow_label",n);break}if(this.editor.isShapeOrAncestorLocked(i)){this.parent.transition("pointing_canvas",n);break}this.parent.transition("pointing_shape",n);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",n):this.parent.transition("pointing_handle",n);break}case"selection":{switch(n.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",n);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{s?this.parent.transition("crop.pointing_crop_handle",n):this.parent.transition("pointing_resize_handle",n);break}default:{const i=this.editor.getHoveredShape();if(i&&!this.editor.getSelectedShapeIds().includes(i.id)&&!i.isLocked){this.onPointerDown({...n,shape:i,target:"shape"});return}this.parent.transition("pointing_selection",n)}}break}}});b(this,"onDoubleClick",n=>{var s,i,r,o;if(!(this.editor.inputs.shiftKey||n.phase!=="up"))switch(n.target){case"canvas":{const l=this.editor.getHoveredShape(),c=l&&!this.editor.isShapeOfType(l,"group")?l:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),d=this.editor.getFocusedGroupId();if(c){if(this.editor.isShapeOfType(c,"group")){Sv(this.editor);return}else{const u=this.editor.getShape(c.parentId);if(u&&this.editor.isShapeOfType(u,"group")&&!(d&&u.id===d)){Sv(this.editor);return}}this.onDoubleClick({...n,shape:c,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(n);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const l=this.editor.getOnlySelectedShape();if(l){const c=this.editor.getShapeUtil(l);if(!this.canInteractWithShapeInReadOnly(l))return;if(n.handle==="right"||n.handle==="left"||n.handle==="top"||n.handle==="bottom"){const d=(s=c.onDoubleClickEdge)==null?void 0:s.call(c,l);if(d){this.editor.mark("double click edge"),this.editor.updateShapes([d]),pt(this.editor,[l.id]);return}}if(c.canCrop(l)&&!this.editor.isShapeOrAncestorLocked(l)){this.parent.transition("crop",n);return}this.shouldStartEditingShape(l)&&this.startEditingShape(l,n,!0)}break}case"shape":{const{shape:l}=n,c=this.editor.getShapeUtil(l);if(l.type!=="video"&&l.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(c.onDoubleClick){const d=(i=c.onDoubleClick)==null?void 0:i.call(c,l);if(d){this.editor.updateShapes([d]);return}else if(c.canCrop(l)&&!this.editor.isShapeOrAncestorLocked(l)){this.editor.mark("select and crop"),this.editor.select((r=n.shape)==null?void 0:r.id),this.parent.transition("crop",n);return}}this.shouldStartEditingShape(l)?this.startEditingShape(l,n,!0):this.handleDoubleClickOnCanvas(n);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:l,handle:c}=n,d=this.editor.getShapeUtil(l),u=(o=d.onDoubleClickHandle)==null?void 0:o.call(d,l,c);u?this.editor.updateShapes([u]):this.shouldStartEditingShape(l)&&this.startEditingShape(l,n,!0)}}});b(this,"onRightClick",n=>{switch(n.target){case"canvas":{const s=this.editor.getHoveredShape(),i=s&&!this.editor.isShapeOfType(s,"group")?s:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!1,renderingOnly:!0});if(i){this.onRightClick({...n,shape:i,target:"shape"});return}const r=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:l}}=this.editor;if((r.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&bA(this.editor,l)){this.onRightClick({...n,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:s}=this.editor.getCurrentPageState(),{shape:i}=n,r=this.editor.getOutermostSelectableShape(i,o=>!s.includes(o.id));!s.includes(r.id)&&!this.editor.findShapeAncestor(r,o=>s.includes(o.id))&&(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([r.id]));break}}});b(this,"onCancel",()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())});b(this,"onKeyDown",n=>{switch(n.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(Kt.editOnType.get()&&!cle.includes(n.key)&&!n.altKey&&!n.ctrlKey){const s=this.editor.getOnlySelectedShape();if(s&&this.editor.isShapeOfType(s,"note")&&this.shouldStartEditingShape(s)){this.startEditingShape(s,{...n,target:"shape",shape:s},!0);return}}});b(this,"onKeyRepeat",n=>{switch(n.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});b(this,"onKeyUp",n=>{switch(n.code){case"Enter":{const s=this.editor.getSelectedShapes();if(s.every(r=>this.editor.isShapeOfType(r,"group"))){this.editor.setSelectedShapes(s.flatMap(r=>this.editor.getSortedChildIdsForParent(r.id)));return}const i=this.editor.getOnlySelectedShape();if(i&&this.shouldStartEditingShape(i)){this.startEditingShape(i,{...n,target:"shape",shape:i},!0);return}SA(this.editor)&&this.parent.transition("crop",n);break}}});b(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(n=this.editor.getOnlySelectedShape()){return!n||this.editor.isShapeOrAncestorLocked(n)&&n.type!=="embed"||!this.canInteractWithShapeInReadOnly(n)?!1:this.editor.getShapeUtil(n).canEdit(n)}startEditingShape(n,s,i){this.editor.isShapeOrAncestorLocked(n)&&n.type!=="embed"||(this.editor.mark("editing shape"),yv(this.editor,n,i),this.parent.transition("editing_shape",s))}isOverArrowLabelTest(n){if(!n)return!1;const s=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(n,"arrow")){const i=this.editor.getShapeGeometry(n).children[1];if(i&&si(s,i.vertices))return!0}return!1}handleDoubleClickOnCanvas(n){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const s=it(),{x:i,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:s,type:"text",x:i,y:r,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(s);if(!o)return;const l=this.editor.getShapeUtil(o);this.editor.getInstanceState().isReadonly&&!l.canEditInReadOnly(o)||(this.editor.setEditingShape(s),this.editor.select(s),this.parent.transition("editing_shape",n))}nudgeSelectedShapes(n=!1){const{editor:{inputs:{keys:s}}}=this,i=s.has("ShiftLeft"),r=new E(0,0);if(s.has("ArrowLeft")&&(r.x-=1),s.has("ArrowRight")&&(r.x+=1),s.has("ArrowUp")&&(r.y-=1),s.has("ArrowDown")&&(r.y+=1),r.equals(new E(0,0)))return;n||this.editor.mark("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),l=this.editor.getInstanceState().isGridMode?i?o*ple:o:i?ule:hle,c=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(c,r.mul(l)),pt(this.editor,c)}canInteractWithShapeInReadOnly(n){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(n).canEditInReadOnly(n))}},b(P0,"id","idle"),P0);const ule=10,hle=1,ple=5;function bA(t,e){const n=t.getSelectionRotatedPageBounds();if(!n)return!1;const s=t.getSelectionRotation();return s?si(e,n.corners.map(i=>E.RotWith(i,n.point,s))):n.containsPoint(e)}class $B extends ye{constructor(){super(...arguments);b(this,"shapeId","");b(this,"markId","");b(this,"wasAlreadySelected",!1);b(this,"didDrag",!1);b(this,"info",{});b(this,"onEnter",n=>{const{shape:s}=n;this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.info=n,this.shapeId=s.id,this.didDrag=!1,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===s.id,this.updateCursor();const r=this.editor.getShapeGeometry(s).children[1];if(!r)throw Error(`Expected to find an arrow label geometry for shape: ${s.id}`);const{currentPagePoint:o}=this.editor.inputs,l=this.editor.getPointInShapeSpace(s,o);this._labelDragOffset=E.Sub(r.center,l),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])});b(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})});b(this,"_labelDragOffset",new E(0,0));b(this,"onPointerMove",()=>{const{isDragging:n}=this.editor.inputs;if(!n)return;const s=this.editor.getShape(this.shapeId);if(!s)return;const i=Ir(this.editor,s),r=this.editor.getShapeGeometry(s),o=r.children[0],l=this.editor.getPointInShapeSpace(s,this.editor.inputs.currentPagePoint),c=o.nearestPoint(E.Add(l,this._labelDragOffset));let d;if(i.isStraight){const u=E.Dist(i.start.point,i.end.point);d=1-E.Dist(i.end.point,c)/u}else{const{_center:u,measure:h,angleEnd:p,angleStart:f}=r.children[0];d=Y_(h,f,p,u.angle(c))}isNaN(d)&&(d=.5),this.didDrag=!0,this.editor.updateShape({id:s.id,type:s.type,props:{labelPosition:d}})});b(this,"onPointerUp",()=>{const n=this.editor.getShape(this.shapeId);n&&(this.didDrag||!this.wasAlreadySelected?this.complete():(this.editor.setEditingShape(n.id),this.editor.setCurrentTool("select.editing_shape")))});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.cancel()});b(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}b($B,"id","pointing_arrow_label");class zB extends ye{constructor(){super(...arguments);b(this,"onEnter",()=>{const{inputs:n}=this.editor;n.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});b(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",n)});b(this,"onPointerUp",()=>{Sv(this.editor),this.complete()});b(this,"onComplete",()=>{this.complete()});b(this,"onInterrupt",()=>{this.parent.transition("idle")})}complete(){this.parent.transition("idle")}}b(zB,"id","pointing_canvas");class WB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"onEnter",n=>{this.info=n;const{shape:s}=n;if(this.editor.isShapeOfType(s,"arrow")){const i=As(this.editor,s)[n.handle.id];i&&this.editor.setHintingShapes([i.toId])}this.editor.setCursor({type:"grabbing",rotation:0})});b(this,"onExit",()=>{this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})});b(this,"onPointerUp",()=>{const{shape:n,handle:s}=this.info;if(this.editor.isShapeOfType(n,"note")){const{editor:i}=this,r=wA(i,n,s,!1);if(r){yv(i,r,!0);return}}this.parent.transition("idle",this.info)});b(this,"onPointerMove",()=>{const{editor:n}=this;n.inputs.isDragging&&this.startDraggingHandle()});b(this,"onLongPress",()=>{this.startDraggingHandle()});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.cancel()});b(this,"onInterrupt",()=>{this.cancel()})}startDraggingHandle(){const{editor:n}=this;if(n.getInstanceState().isReadonly)return;const{shape:s,handle:i}=this.info;if(n.isShapeOfType(s,"note")){const r=wA(n,s,i,!0);if(r){const o=n.getPointInParentSpace(r,n.inputs.originPagePoint).sub(E.Rot(Vx.clone().mul(s.props.scale),r.rotation));n.updateShape({...r,x:o.x,y:o.y}),n.setHoveredShape(r.id).select(r.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:n.getShape(r),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{yv(n,r,!0)}});return}}this.parent.transition("dragging_handle",this.info)}cancel(){this.parent.transition("idle")}}b(WB,"id","pointing_handle");function wA(t,e,n,s){const i=t.getShapePageTransform(e.id),r=i.point(),o=i.rotation(),c=iB(t,r,o,e.props.growY,0,e.props.scale)[n.index];if(c)return oB(t,e,c,o,s)}class HB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"onEnter",n=>{this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.info=n,this.updateCursor()});b(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})});b(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startRotating()});b(this,"onLongPress",()=>{this.startRotating()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.cancel()});b(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.setCursor({type:Fd[this.info.handle],rotation:this.editor.getSelectionRotation()})}startRotating(){this.editor.getInstanceState().isReadonly||this.parent.transition("rotating",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}b(HB,"id","pointing_rotate_handle");class GB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"onEnter",n=>{this.info=n});b(this,"onPointerUp",n=>{Sv(this.editor),this.parent.transition("idle",n)});b(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.startTranslating(n)});b(this,"onLongPress",n=>{this.startTranslating(n)});b(this,"onDoubleClick",n=>{var r,o;const s=this.editor.getHoveredShape(),i=s&&!this.editor.isShapeOfType(s,"group")?s:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(o=(r=this.parent).onDoubleClick)==null||o.call(r,{...n,target:"shape",shape:this.editor.getShape(i)});return}});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.cancel()});b(this,"onInterrupt",()=>{this.cancel()})}startTranslating(n){this.editor.getInstanceState().isReadonly||this.parent.transition("translating",n)}cancel(){this.parent.transition("idle")}}b(GB,"id","pointing_selection");class VB extends ye{constructor(){super(...arguments);b(this,"hitShape",{});b(this,"hitShapeForPointerUp",{});b(this,"isDoubleClick",!1);b(this,"didSelectOnEnter",!1);b(this,"onEnter",n=>{const s=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),r=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:o,shiftKey:l,altKey:c}}=this.editor;this.hitShape=n.shape,this.isDoubleClick=!1;const d=this.editor.getOutermostSelectableShape(n.shape),u=this.editor.findShapeAncestor(d,h=>s.includes(h.id));if(this.editor.getShapeUtil(n.shape).onClick||d.id===r||s.includes(d.id)||u||s.length>1&&(i!=null&&i.containsPoint(o))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=d;return}this.didSelectOnEnter=!0,l&&!c?(this.editor.cancelDoubleClick(),s.includes(d.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...s,d.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([d.id]))});b(this,"onPointerUp",n=>{var u;const s=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),r=this.editor.getZoomLevel(),{inputs:{currentPagePoint:o,shiftKey:l}}=this.editor,c=this.editor.getShapeAtPoint(o,{margin:this.editor.options.hitTestMargin/r,hitInside:!0,renderingOnly:!0})??this.hitShape,d=c?this.editor.getOutermostSelectableShape(c):this.hitShapeForPointerUp;if(d){const h=this.editor.getShapeUtil(d);if(h.onClick){const p=(u=h.onClick)==null?void 0:u.call(h,d);if(p){this.editor.mark("shape on click"),this.editor.updateShapes([p]),this.parent.transition("idle",n);return}}if(d.id===i){s.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",n);return}}if(!this.didSelectOnEnter){const h=this.editor.getOutermostSelectableShape(c,p=>!s.includes(p.id));if(s.includes(h.id))if(l)this.editor.mark("deselecting on pointer up"),this.editor.deselect(d);else if(s.includes(d.id)){if(s.length===1){const p=this.editor.getShapeUtil(d).getGeometry(d),f=BB(p),g=f.length===1?f[0]:void 0;if(g){const y=this.editor.getPointInShapeSpace(d,o);if(g.bounds.containsPoint(y,0)&&g.hitTestPoint(y)){this.editor.run(()=>{this.editor.mark("editing on pointer up"),this.editor.select(d.id);const x=this.editor.getShapeUtil(d);this.editor.getInstanceState().isReadonly&&!x.canEditInReadOnly(d)||(this.editor.setEditingShape(d.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:d.id}))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(d.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(d);else if(l){const p=this.editor.getShapeAncestors(h);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(f=>!p.find(g=>g.id===f)),h.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([h.id])}this.parent.transition("idle",n)});b(this,"onDoubleClick",()=>{this.isDoubleClick=!0});b(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.startTranslating(n)});b(this,"onLongPress",n=>{this.startTranslating(n)});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.cancel()});b(this,"onInterrupt",()=>{this.cancel()})}startTranslating(n){this.editor.getInstanceState().isReadonly||(this.editor.focus(),this.parent.transition("translating",n))}cancel(){this.parent.transition("idle")}}b(VB,"id","pointing_shape");class KB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"markId","");b(this,"didHoldCommand",!1);b(this,"creationCursorOffset",{x:0,y:0});b(this,"snapshot",{});b(this,"onEnter",n=>{const{isCreating:s=!1,creationCursorOffset:i={x:0,y:0}}=n;this.info=n,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),s?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.setCursor({type:"cross",rotation:0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()});b(this,"onTick",({elapsed:n})=>{const{editor:s}=this;s.edgeScrollManager.updateEdgeScrolling(n)});b(this,"onPointerMove",()=>{this.updateShapes()});b(this,"onKeyDown",()=>{this.updateShapes()});b(this,"onKeyUp",()=>{this.updateShapes()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onComplete",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()});b(this,"_createSnapshot",()=>{const n=this.editor.getSelectedShapeIds(),s=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,r=this.editor.getSelectionRotatedPageBounds(),o=E.RotWith(r.getHandlePoint(this.info.handle),r.point,s),l=E.Sub(i,o),c=new Map,d=[];n.forEach(h=>{const p=this.editor.getShape(h);if(p){if(p.type==="frame"&&d.push({id:h,children:Re(this.editor.getSortedChildIdsForParent(p).map(f=>this.editor.getShape(f)))}),c.set(p.id,this._createShapeSnapshot(p)),this.editor.isShapeOfType(p,"frame")&&n.length===1)return;this.editor.visitDescendants(p.id,f=>{const g=this.editor.getShape(f);if(g&&(c.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")))return!1})}});const u=![...c.values()].some(h=>!BF(h.pageRotation,s)||h.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:r,cursorHandleOffset:l,selectionRotation:s,selectedShapeIds:n,canShapesDeform:u,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:d}});b(this,"_createShapeSnapshot",n=>{const s=this.editor.getShapePageTransform(n),i=this.editor.getShapeUtil(n);return{shape:n,bounds:this.editor.getShapeGeometry(n).bounds,pageTransform:s,pageRotation:ve.Decompose(s).rotation,isAspectRatioLocked:i.isAspectRatioLocked(n)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var n,s;if(pt(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(s=(n=this.info).onCreate)==null||s.call(n,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:n}=this.snapshot,s=[];n.forEach(({shape:i})=>{var l;const r=this.editor.getShapeUtil(i),o=(l=r.onResizeStart)==null?void 0:l.call(r,i);o&&s.push(o)}),s.length>0&&this.editor.updateShapes(s)}handleResizeEnd(){const{shapeSnapshots:n}=this.snapshot,s=[];n.forEach(({shape:i})=>{var c;const r=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),l=(c=o.onResizeEnd)==null?void 0:c.call(o,i,r);l&&s.push(l)}),s.length>0&&this.editor.updateShapes(s)}updateShapes(){const{altKey:n,shiftKey:s}=this.editor.inputs,{frames:i,shapeSnapshots:r,selectionBounds:o,cursorHandleOffset:l,selectedShapeIds:c,selectionRotation:d,canShapesDeform:u}=this.snapshot;let h=s||!u;if(r.size===1){const P=[...r.values()][0];this.editor.isShapeOfType(P.shape,"text")&&(h=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:p}=this.editor.inputs,f=this.editor.inputs.currentPagePoint.clone().sub(l).sub(this.creationCursorOffset),g=this.editor.inputs.originPagePoint.clone().sub(l);if(this.editor.getInstanceState().isGridMode&&!p){const{gridSize:P}=this.editor.getDocumentSettings();f.snapToGrid(P)}const y=this.info.handle,x=_A(y,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!p:p)&&d%vt===0){const{nudge:P}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:E.Sub(f,g),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:_A(y,d),isAspectRatioLocked:h,isResizingFromCenter:n});f.add(P)}const v=E.RotWith(n?o.center:o.getHandlePoint(x),o.point,d),w=E.Sub(f,v).rot(-d),_=E.Sub(g,v).rot(-d),C=E.DivV(w,_);Number.isFinite(C.x)||(C.x=1),Number.isFinite(C.y)||(C.y=1);const I=y==="top"||y==="bottom",T=y==="left"||y==="right";h?T?C.y=Math.abs(C.x):I?C.x=Math.abs(C.y):Math.abs(C.x)>Math.abs(C.y)?C.y=Math.abs(C.x)*(C.y<0?-1:1):C.x=Math.abs(C.y)*(C.x<0?-1:1):(I&&(C.x=1),T&&(C.y=1)),this.info.isCreating||this.updateCursor({dragHandle:y,isFlippedX:C.x<0,isFlippedY:C.y<0,rotation:d});for(const P of r.keys()){const k=r.get(P);this.editor.resizeShape(P,C,{initialShape:k.shape,initialBounds:k.bounds,initialPageTransform:k.pageTransform,dragHandle:y,mode:c.length===1&&P===c[0]?"resize_bounds":"scale_shape",scaleOrigin:v,isAspectRatioLocked:h,scaleAxisRotation:d,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:P,children:k}of i){if(!k.length)continue;const N=r.get(P).shape,O=this.editor.getShape(P);if(!(N&&O))continue;const R=O.x-N.x,j=O.y-N.y,A=new E(R,j).rot(-N.rotation);if(A.x!==0||A.y!==0)for(const B of k)this.editor.updateShape({id:B.id,type:B.type,x:B.x-A.x,y:B.y-A.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:P}of i)if(P.length)for(const k of P)this.editor.updateShape({id:k.id,type:k.type,x:k.x,y:k.y})}}updateCursor({dragHandle:n,isFlippedX:s,isFlippedY:i,rotation:r}){const o={...this.editor.getInstanceState().cursor};switch(n){case"top_left":case"bottom_right":{o.type="nwse-resize",s!==i&&(o.type="nesw-resize");break}case"top_right":case"bottom_left":{o.type="nesw-resize",s!==i&&(o.type="nwse-resize");break}}o.rotation=r,this.editor.setCursor(o)}}b(KB,"id","resizing");const xw=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function _A(t,e){e=e%tt;const n=Math.round(e/(Ze/4)),s=xw.indexOf(t);return xw[(s+n)%xw.length]}const CA=Math.PI/180;class YB extends ye{constructor(){super(...arguments);b(this,"snapshot",{});b(this,"info",{});b(this,"markId","");b(this,"onEnter",n=>{this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const s=k5({editor:this.editor});if(!s)return this.parent.transition("idle",this.info);this.snapshot=s;const i=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Am({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:Fd[this.info.handle],rotation:i+this.snapshot.initialSelectionRotation})});b(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}});b(this,"onPointerMove",()=>{this.update()});b(this,"onKeyDown",()=>{this.update()});b(this,"onKeyUp",()=>{this.update()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onComplete",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"update",()=>{const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Am({editor:this.editor,delta:n,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:Fd[this.info.handle],rotation:n+this.snapshot.initialSelectionRotation})});b(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});b(this,"complete",()=>{Am({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),pt(this.editor,this.snapshot.shapeSnapshots.map(n=>n.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}_getRotationFromPointerPosition({snapToNearestDegree:n}){const s=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:r,currentPagePoint:o}}=this.editor,{initialCursorAngle:l,initialSelectionRotation:c}=this.snapshot;if(!i)return c;const u=i.center.clone().rotWith(i.point,s).angle(o)-l;let h=c+u;if(r)h=lv(h,24);else if(n&&(h=Math.round(h/CA)*CA,this.editor.getInstanceState().isCoarsePointer)){const p=lv(h,4),f=km(h,p);Math.abs(f)<Oee(5)&&(h=p)}return h-c}}b(YB,"id","rotating");class XB extends ye{constructor(){super(...arguments);b(this,"hits",new Set);b(this,"size",0);b(this,"scribbleId","id");b(this,"initialSelectedShapeIds",new Set);b(this,"newlySelectedShapeIds",new Set);b(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const n=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=n.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})});b(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});b(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});b(this,"onPointerUp",()=>{this.complete()});b(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});b(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")});b(this,"onCancel",()=>{this.cancel()});b(this,"onComplete",()=>{this.complete()});b(this,"pushPointToScribble",()=>{const{x:n,y:s}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,n,s)})}updateScribbleSelection(n){const{editor:s}=this,i=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:r,originPagePoint:o,previousPagePoint:l,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:d,initialSelectedShapeIds:u}=this;n&&this.pushPointToScribble();const h=i;let p,f,g,y;const x=0;for(let w=0,_=h.length;w<_;w++){if(p=h[w],s.isShapeOfType(p,"group")||d.has(p.id)||s.isShapeOrAncestorLocked(p)||(f=s.getShapeGeometry(p),s.isShapeOfType(p,"frame")&&f.bounds.containsPoint(s.getPointInShapeSpace(p,o))))continue;const C=s.getShapePageTransform(p);if(!f||!C)continue;const I=C.clone().invert();g=I.applyToPoint(l),y=I.applyToPoint(c);const{bounds:T}=f;if(!(T.minX-x>Math.max(g.x,y.x)||T.minY-x>Math.max(g.y,y.y)||T.maxX+x<Math.min(g.x,y.x)||T.maxY+x<Math.min(g.y,y.y))&&f.hitTestLineSegment(g,y,x)){const P=this.editor.getOutermostSelectableShape(p),k=this.editor.getShapeMask(P.id);if(k&&XT(l,c,k)!==null&&!si(c,k))continue;d.add(P.id)}}const m=s.getSelectedShapeIds(),v=new Set(r?[...d,...u]:[...d]);(m.length!==v.size||m.some(w=>!v.has(w)))&&this.editor.setSelectedShapes(Array.from(v))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}b(XB,"id","scribble_brushing");const fle=20,gle=100;class mle{constructor(e){b(this,"prevDroppingShapeId",null);b(this,"droppingNodeTimer",null);b(this,"first",!0);b(this,"dispose",()=>{this.clear()});this.editor=e,e.disposables.add(this.dispose)}updateDroppingNode(e,n){var s;this.first&&(this.editor.setHintingShapes(e.map(i=>this.editor.findShapeAncestor(i,r=>r.type!=="group")).filter(i=>i)),this.prevDroppingShapeId=((s=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:s.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,fle,n):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,gle,n))}setDragTimer(e,n,s){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,s)}),this.droppingNodeTimer=null},n)}handleDrag(e,n,s){var c,d,u,h,p;n=Re(n.map(f=>this.editor.getShape(f.id)));const i=((c=this.editor.getDroppingOverShape(e,n))==null?void 0:c.id)??null;if(i===this.prevDroppingShapeId){this.hintParents(n);return}const{prevDroppingShapeId:r}=this,o=r&&this.editor.getShape(r),l=i&&this.editor.getShape(i);o&&((u=(d=this.editor.getShapeUtil(o)).onDragShapesOut)==null||u.call(d,o,n)),l&&((p=(h=this.editor.getShapeUtil(l)).onDragShapesOver)==null||p.call(h,l,n)),this.hintParents(n),s==null||s(),this.prevDroppingShapeId=i}hintParents(e){const n=new Map;for(const i of e){const r=this.editor.findShapeAncestor(i,o=>o.type!=="group");r&&(n.has(r.id)||n.set(r.id,[]),n.get(r.id).push(i.id))}const s=[];for(const[i,r]of n){const o=this.editor.getShape(i);o&&tB(this.editor,o).length<r.length&&s.push(o.id)}this.editor.setHintingShapes(s)}dropShapes(e){var s,i;const{prevDroppingShapeId:n}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),n){const r=this.editor.getShape(n);if(!r)return;(i=(s=this.editor.getShapeUtil(r)).onDropShapesOver)==null||i.call(s,r,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class qB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"selectionSnapshot",{});b(this,"snapshot",{});b(this,"markId","");b(this,"isCloning",!1);b(this,"isCreating",!1);b(this,"onCreate",()=>{});b(this,"dragAndDropManager",new mle(this.editor));b(this,"onEnter",n=>{var r;const{isCreating:s=!1,onCreate:i=()=>{}}=n;if(!((r=this.editor.getSelectedShapeIds())!=null&&r.length)){this.parent.transition("idle");return}if(this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.isCreating=s,this.onCreate=i,s?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=n,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=EA(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()});b(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()});b(this,"onTick",({elapsed:n})=>{const{editor:s}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),s.edgeScrollManager.updateEdgeScrolling(n)});b(this,"onPointerMove",()=>{this.updateShapes()});b(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});b(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onComplete",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()});b(this,"updateParentTransforms",()=>{const{editor:n,snapshot:{shapeSnapshots:s}}=this;s.forEach(i=>{const r=n.getShape(i.shape.id);if(!r)return null;const o=Ts(r.parentId)?null:ve.Inverse(n.getShapePageTransform(r.parentId));i.parentTransform=o})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=EA(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var n;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),pt(this.editor,this.snapshot.movingShapes.map(s=>s.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(n=this.onCreate)==null||n.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:n}=this.snapshot,s=[];n.forEach(i=>{var l;const r=this.editor.getShapeUtil(i),o=(l=r.onTranslateStart)==null?void 0:l.call(r,i);o&&s.push(o)}),s.length>0&&this.editor.updateShapes(s),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:n}=this.snapshot;if(this.isCloning&&n.length>0){const i=E.Average(n.map(o=>this.editor.getShapePageTransform(o.id).point())),r=E.Sub(i,this.selectionSnapshot.averagePagePoint);E.IsNaN(r)||this.editor.updateInstanceState({duplicateProps:{shapeIds:n.map(o=>o.id),offset:{x:r.x,y:r.y}}})}const s=[];n.forEach(i=>{var c;const r=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),l=(c=o.onTranslateEnd)==null?void 0:c.call(o,i,r);l&&s.push(l)}),s.length>0&&this.editor.updateShapes(s)}updateShapes(){const{snapshot:n}=this;this.dragAndDropManager.updateDroppingNode(n.movingShapes,this.updateParentTransforms),yle({editor:this.editor,snapshot:n});const{movingShapes:s}=n,i=[];s.forEach(r=>{var d;const o=this.editor.getShape(r.id),l=this.editor.getShapeUtil(r),c=(d=l.onTranslate)==null?void 0:d.call(l,r,o);c&&i.push(c)}),i.length>0&&this.editor.updateShapes(i)}}b(qB,"id","translating");function EA(t){var h;const e=[],n=[],s=t.getSelectedShapeIds(),i=Re(s.map(p=>{const f=t.getShape(p);if(!f)return null;e.push(f);const g=t.getShapePageTransform(p),y=g.point(),x=g.rotation();n.push(y);const m=No.isId(f.parentId)?null:ve.Inverse(t.getShapePageTransform(f.parentId));return{shape:f,pagePoint:y,pageRotation:x,parentTransform:m}})),r=t.getOnlySelectedShape();let o=[];if(r)o=t.snaps.shapeBounds.getSnapPoints(r.id);else{const p=t.getSelectionPageBounds();p&&(o=p.cornersAndCenter.map((f,g)=>({id:"selection:"+g,x:f.x,y:f.y})))}let l,c;const{originPagePoint:d}=t.inputs,u=i.filter(p=>t.isShapeOfType(p.shape,"note")&&t.isPointInShape(p.shape,d));if(u.length!==0)if(u.length===1)c=u[0];else{const p=t.getCurrentPageShapesSorted();c=(h=u.map(f=>({snapshot:f,index:p.findIndex(g=>g.id===f.shape.id)})).sort((f,g)=>g.index-f.index)[0])==null?void 0:h.snapshot}return c&&(l=rB(t,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:E.Average(n),movingShapes:e,shapeSnapshots:i,initialPageBounds:t.getSelectionPageBounds(),initialSnapPoints:o,noteAdjacentPositions:l,noteSnapshot:c}}function yle({editor:t,snapshot:e}){const{inputs:n}=t,{noteSnapshot:s,noteAdjacentPositions:i,initialPageBounds:r,initialSnapPoints:o,shapeSnapshots:l,averagePagePoint:c}=e,d=t.getInstanceState().isGridMode,u=t.getDocumentSettings().gridSize,h=E.Sub(n.currentPagePoint,n.originPagePoint),p=t.inputs.shiftKey?Math.abs(h.x)<Math.abs(h.y)?"x":"y":null;if(p==="x"?h.x=0:p==="y"&&(h.y=0),t.snaps.clearIndicators(),(t.user.getIsSnapMode()?!n.ctrlKey:n.ctrlKey)&&t.inputs.pointerVelocity.len()<.5){const{nudge:x}=t.snaps.shapeBounds.snapTranslateShapes({dragDelta:h,initialSelectionPageBounds:r,lockedAxis:p,initialSelectionSnapPoints:o});h.add(x)}else if(s&&i){const{scale:x}=s.shape.props,m=s.pagePoint.clone().add(h).add(Vx.clone().mul(x).rot(s.pageRotation));let v=sB/t.getZoomLevel(),w=new E(0,0);for(const _ of i){const C=E.Sub(m,_),I=C.len();I<v&&(v=I,w=C)}h.sub(w)}const g=E.Add(c,h);d&&!n.ctrlKey&&g.snapToGrid(u);const y=E.Sub(g,c);t.updateShapes(Re(l.map(({shape:x,pagePoint:m,parentTransform:v})=>{const w=E.Add(m,y),_=v?ve.applyToPoint(v,w):w;return{id:x.id,type:x.type,x:_.x,y:_.y}})))}class Ch extends ye{constructor(){super(...arguments);b(this,"reactor");b(this,"cleanUpDuplicateProps",()=>{const n=this.editor.getSelectedShapeIds(),s=this.editor.getInstanceState();if(!s.duplicateProps)return;const i=new Set(s.duplicateProps.shapeIds);n.length===i.size&&n.every(r=>i.has(r))||this.editor.updateInstanceState({duplicateProps:null})});b(this,"onEnter",()=>{this.reactor=hc("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(n){console.error(n)}})});b(this,"onExit",()=>{var n;(n=this.reactor)==null||n.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)})}}b(Ch,"id","select"),b(Ch,"initial","idle"),b(Ch,"isLockable",!1),b(Ch,"children",()=>[ny,y1,dle,zB,VB,qB,AB,XB,v1,GB,RB,UB,KB,YB,HB,$B,WB,FB]);class ZB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"onEnter",n=>{this.info=n});b(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}b(ZB,"id","idle");class JB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"onEnter",n=>{this.info=n});b(this,"onPointerUp",()=>{this.complete()});b(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});b(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:n}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(n,{animation:{duration:220}}):this.editor.zoomIn(n,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}b(JB,"id","pointing");class QB extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"zoomBrush",new de);b(this,"onEnter",n=>{this.info=n,this.update()});b(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});b(this,"onPointerMove",()=>{this.update()});b(this,"onPointerUp",()=>{this.complete()});b(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:n,currentPagePoint:s}}=this.editor;this.zoomBrush.setTo(de.FromPoints([n,s])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:n}=this,s=8/this.editor.getZoomLevel();if(n.width<s&&n.height<s){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{animation:{duration:220}}):this.editor.zoomIn(i,{animation:{duration:220}})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(n,{targetZoom:i,animation:{duration:220}})}this.parent.transition("idle",this.info)}}b(QB,"id","zoom_brushing");class Eh extends ye{constructor(){super(...arguments);b(this,"info",{});b(this,"onEnter",n=>{this.info=n,this.parent.setCurrentToolIdMask(n.onInteractionEnd),this.updateCursor()});b(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)});b(this,"onKeyDown",()=>{this.updateCursor()});b(this,"onKeyUp",n=>{this.updateCursor(),n.code==="KeyZ"&&this.complete()});b(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}b(Eh,"id","zoom"),b(Eh,"initial","idle"),b(Eh,"children",()=>[ZB,QB,JB]),b(Eh,"isLockable",!1);const vle=[bh,wh,_h,Eh,Ch];function me(t,e,{checkForDefaultPrevented:n=!0}={}){return function(i){if(t==null||t(i),n===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function TA(t,e){if(typeof t=="function")return t(e);t!=null&&(t.current=e)}function Zx(...t){return e=>{let n=!1;const s=t.map(i=>{const r=TA(i,e);return!n&&typeof r=="function"&&(n=!0),r});if(n)return()=>{for(let i=0;i<s.length;i++){const r=s[i];typeof r=="function"?r():TA(t[i],null)}}}}function ut(...t){return S.useCallback(Zx(...t),t)}function xle(t,e){const n=S.createContext(e),s=r=>{const{children:o,...l}=r,c=S.useMemo(()=>l,Object.values(l));return a.jsx(n.Provider,{value:c,children:o})};s.displayName=t+"Provider";function i(r){const o=S.useContext(n);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${r}\` must be used within \`${t}\``)}return[s,i]}function Yr(t,e=[]){let n=[];function s(r,o){const l=S.createContext(o),c=n.length;n=[...n,o];const d=h=>{var m;const{scope:p,children:f,...g}=h,y=((m=p==null?void 0:p[t])==null?void 0:m[c])||l,x=S.useMemo(()=>g,Object.values(g));return a.jsx(y.Provider,{value:x,children:f})};d.displayName=r+"Provider";function u(h,p){var y;const f=((y=p==null?void 0:p[t])==null?void 0:y[c])||l,g=S.useContext(f);if(g)return g;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${r}\``)}return[d,u]}const i=()=>{const r=n.map(o=>S.createContext(o));return function(l){const c=(l==null?void 0:l[t])||r;return S.useMemo(()=>({[`__scope${t}`]:{...l,[t]:c}}),[l,c])}};return i.scopeName=t,[s,Sle(i,...e)]}function Sle(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const s=t.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(r){const o=s.reduce((l,{useScope:c,scopeName:d})=>{const h=c(r)[`__scope${d}`];return{...l,...h}},{});return S.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return n.scopeName=e.scopeName,n}var Ro=globalThis!=null&&globalThis.document?S.useLayoutEffect:()=>{},ble=dO[" useId ".trim().toString()]||(()=>{}),wle=0;function Co(t){const[e,n]=S.useState(ble());return Ro(()=>{n(s=>s??String(wle++))},[t]),t||(e?`radix-${e}`:"")}var _le=dO[" useInsertionEffect ".trim().toString()]||Ro;function il({prop:t,defaultProp:e,onChange:n=()=>{},caller:s}){const[i,r,o]=Cle({defaultProp:e,onChange:n}),l=t!==void 0,c=l?t:i;{const u=S.useRef(t!==void 0);S.useEffect(()=>{const h=u.current;h!==l&&console.warn(`${s} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,s])}const d=S.useCallback(u=>{var h;if(l){const p=Ele(u)?u(t):u;p!==t&&((h=o.current)==null||h.call(o,p))}else r(u)},[l,t,r,o]);return[c,d]}function Cle({defaultProp:t,onChange:e}){const[n,s]=S.useState(t),i=S.useRef(n),r=S.useRef(e);return _le(()=>{r.current=e},[e]),S.useEffect(()=>{var o;i.current!==n&&((o=r.current)==null||o.call(r,n),i.current=n)},[n,i]),[n,s,r]}function Ele(t){return typeof t=="function"}function Bd(t){const e=Tle(t),n=S.forwardRef((s,i)=>{const{children:r,...o}=s,l=S.Children.toArray(r),c=l.find(Ple);if(c){const d=c.props.children,u=l.map(h=>h===c?S.Children.count(d)>1?S.Children.only(null):S.isValidElement(d)?d.props.children:null:h);return a.jsx(e,{...o,ref:i,children:S.isValidElement(d)?S.cloneElement(d,void 0,u):null})}return a.jsx(e,{...o,ref:i,children:r})});return n.displayName=`${t}.Slot`,n}function Tle(t){const e=S.forwardRef((n,s)=>{const{children:i,...r}=n;if(S.isValidElement(i)){const o=jle(i),l=kle(r,i.props);return i.type!==S.Fragment&&(l.ref=s?Zx(s,o):o),S.cloneElement(i,l)}return S.Children.count(i)>1?S.Children.only(null):null});return e.displayName=`${t}.SlotClone`,e}var Ile=Symbol("radix.slottable");function Ple(t){return S.isValidElement(t)&&typeof t.type=="function"&&"__radixId"in t.type&&t.type.__radixId===Ile}function kle(t,e){const n={...e};for(const s in e){const i=t[s],r=e[s];/^on[A-Z]/.test(s)?i&&r?n[s]=(...l)=>{const c=r(...l);return i(...l),c}:i&&(n[s]=i):s==="style"?n[s]={...i,...r}:s==="className"&&(n[s]=[i,r].filter(Boolean).join(" "))}return{...t,...n}}function jle(t){var s,i;let e=(s=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:s.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var Nle=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ye=Nle.reduce((t,e)=>{const n=Bd(`Primitive.${e}`),s=S.forwardRef((i,r)=>{const{asChild:o,...l}=i,c=o?n:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),a.jsx(c,{...l,ref:r})});return s.displayName=`Primitive.${e}`,{...t,[e]:s}},{});function x1(t,e){t&&Br.flushSync(()=>t.dispatchEvent(e))}function fs(t){const e=S.useRef(t);return S.useEffect(()=>{e.current=t}),S.useMemo(()=>(...n)=>{var s;return(s=e.current)==null?void 0:s.call(e,...n)},[])}function Ale(t,e=globalThis==null?void 0:globalThis.document){const n=fs(t);S.useEffect(()=>{const s=i=>{i.key==="Escape"&&n(i)};return e.addEventListener("keydown",s,{capture:!0}),()=>e.removeEventListener("keydown",s,{capture:!0})},[n,e])}var Rle="DismissableLayer",fC="dismissableLayer.update",Mle="dismissableLayer.pointerDownOutside",Ole="dismissableLayer.focusOutside",IA,e3=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),bf=S.forwardRef((t,e)=>{const{disableOutsidePointerEvents:n=!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:r,onInteractOutside:o,onDismiss:l,...c}=t,d=S.useContext(e3),[u,h]=S.useState(null),p=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=S.useState({}),g=ut(e,T=>h(T)),y=Array.from(d.layers),[x]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),m=y.indexOf(x),v=u?y.indexOf(u):-1,w=d.layersWithOutsidePointerEventsDisabled.size>0,_=v>=m,C=Lle(T=>{const P=T.target,k=[...d.branches].some(N=>N.contains(P));!_||k||(i==null||i(T),o==null||o(T),T.defaultPrevented||l==null||l())},p),I=Fle(T=>{const P=T.target;[...d.branches].some(N=>N.contains(P))||(r==null||r(T),o==null||o(T),T.defaultPrevented||l==null||l())},p);return Ale(T=>{v===d.layers.size-1&&(s==null||s(T),!T.defaultPrevented&&l&&(T.preventDefault(),l()))},p),S.useEffect(()=>{if(u)return n&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(IA=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),PA(),()=>{n&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=IA)}},[u,p,n,d]),S.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),PA())},[u,d]),S.useEffect(()=>{const T=()=>f({});return document.addEventListener(fC,T),()=>document.removeEventListener(fC,T)},[]),a.jsx(Ye.div,{...c,ref:g,style:{pointerEvents:w?_?"auto":"none":void 0,...t.style},onFocusCapture:me(t.onFocusCapture,I.onFocusCapture),onBlurCapture:me(t.onBlurCapture,I.onBlurCapture),onPointerDownCapture:me(t.onPointerDownCapture,C.onPointerDownCapture)})});bf.displayName=Rle;var Dle="DismissableLayerBranch",t3=S.forwardRef((t,e)=>{const n=S.useContext(e3),s=S.useRef(null),i=ut(e,s);return S.useEffect(()=>{const r=s.current;if(r)return n.branches.add(r),()=>{n.branches.delete(r)}},[n.branches]),a.jsx(Ye.div,{...t,ref:i})});t3.displayName=Dle;function Lle(t,e=globalThis==null?void 0:globalThis.document){const n=fs(t),s=S.useRef(!1),i=S.useRef(()=>{});return S.useEffect(()=>{const r=l=>{if(l.target&&!s.current){let c=function(){n3(Mle,n,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=c,e.addEventListener("click",i.current,{once:!0})):c()}else e.removeEventListener("click",i.current);s.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",r)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",r),e.removeEventListener("click",i.current)}},[e,n]),{onPointerDownCapture:()=>s.current=!0}}function Fle(t,e=globalThis==null?void 0:globalThis.document){const n=fs(t),s=S.useRef(!1);return S.useEffect(()=>{const i=r=>{r.target&&!s.current&&n3(Ole,n,{originalEvent:r},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function PA(){const t=new CustomEvent(fC);document.dispatchEvent(t)}function n3(t,e,n,{discrete:s}){const i=n.originalEvent.target,r=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),s?x1(i,r):i.dispatchEvent(r)}var Ble=bf,Ule=t3,Sw="focusScope.autoFocusOnMount",bw="focusScope.autoFocusOnUnmount",kA={bubbles:!1,cancelable:!0},$le="FocusScope",Jx=S.forwardRef((t,e)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:i,onUnmountAutoFocus:r,...o}=t,[l,c]=S.useState(null),d=fs(i),u=fs(r),h=S.useRef(null),p=ut(e,y=>c(y)),f=S.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;S.useEffect(()=>{if(s){let y=function(w){if(f.paused||!l)return;const _=w.target;l.contains(_)?h.current=_:ra(h.current,{select:!0})},x=function(w){if(f.paused||!l)return;const _=w.relatedTarget;_!==null&&(l.contains(_)||ra(h.current,{select:!0}))},m=function(w){if(document.activeElement===document.body)for(const C of w)C.removedNodes.length>0&&ra(l)};document.addEventListener("focusin",y),document.addEventListener("focusout",x);const v=new MutationObserver(m);return l&&v.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",x),v.disconnect()}}},[s,l,f.paused]),S.useEffect(()=>{if(l){NA.add(f);const y=document.activeElement;if(!l.contains(y)){const m=new CustomEvent(Sw,kA);l.addEventListener(Sw,d),l.dispatchEvent(m),m.defaultPrevented||(zle(Kle(s3(l)),{select:!0}),document.activeElement===y&&ra(l))}return()=>{l.removeEventListener(Sw,d),setTimeout(()=>{const m=new CustomEvent(bw,kA);l.addEventListener(bw,u),l.dispatchEvent(m),m.defaultPrevented||ra(y??document.body,{select:!0}),l.removeEventListener(bw,u),NA.remove(f)},0)}}},[l,d,u,f]);const g=S.useCallback(y=>{if(!n&&!s||f.paused)return;const x=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,m=document.activeElement;if(x&&m){const v=y.currentTarget,[w,_]=Wle(v);w&&_?!y.shiftKey&&m===_?(y.preventDefault(),n&&ra(w,{select:!0})):y.shiftKey&&m===w&&(y.preventDefault(),n&&ra(_,{select:!0})):m===v&&y.preventDefault()}},[n,s,f.paused]);return a.jsx(Ye.div,{tabIndex:-1,...o,ref:p,onKeyDown:g})});Jx.displayName=$le;function zle(t,{select:e=!1}={}){const n=document.activeElement;for(const s of t)if(ra(s,{select:e}),document.activeElement!==n)return}function Wle(t){const e=s3(t),n=jA(e,t),s=jA(e.reverse(),t);return[n,s]}function s3(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const i=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||i?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function jA(t,e){for(const n of t)if(!Hle(n,{upTo:e}))return n}function Hle(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Gle(t){return t instanceof HTMLInputElement&&"select"in t}function ra(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&Gle(t)&&e&&t.select()}}var NA=Vle();function Vle(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=AA(t,e),t.unshift(e)},remove(e){var n;t=AA(t,e),(n=t[0])==null||n.resume()}}}function AA(t,e){const n=[...t],s=n.indexOf(e);return s!==-1&&n.splice(s,1),n}function Kle(t){return t.filter(e=>e.tagName!=="A")}var Yle="Portal",wf=S.forwardRef((t,e)=>{var l;const{container:n,...s}=t,[i,r]=S.useState(!1);Ro(()=>r(!0),[]);const o=n||i&&((l=globalThis==null?void 0:globalThis.document)==null?void 0:l.body);return o?JH.createPortal(a.jsx(Ye.div,{...s,ref:e}),o):null});wf.displayName=Yle;function Xle(t,e){return S.useReducer((n,s)=>e[n][s]??n,t)}var lr=t=>{const{present:e,children:n}=t,s=qle(e),i=typeof n=="function"?n({present:s.isPresent}):S.Children.only(n),r=ut(s.ref,Zle(i));return typeof n=="function"||s.isPresent?S.cloneElement(i,{ref:r}):null};lr.displayName="Presence";function qle(t){const[e,n]=S.useState(),s=S.useRef(null),i=S.useRef(t),r=S.useRef("none"),o=t?"mounted":"unmounted",[l,c]=Xle(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return S.useEffect(()=>{const d=Hg(s.current);r.current=l==="mounted"?d:"none"},[l]),Ro(()=>{const d=s.current,u=i.current;if(u!==t){const p=r.current,f=Hg(d);t?c("MOUNT"):f==="none"||(d==null?void 0:d.display)==="none"?c("UNMOUNT"):c(u&&p!==f?"ANIMATION_OUT":"UNMOUNT"),i.current=t}},[t,c]),Ro(()=>{if(e){let d;const u=e.ownerDocument.defaultView??window,h=f=>{const y=Hg(s.current).includes(CSS.escape(f.animationName));if(f.target===e&&y&&(c("ANIMATION_END"),!i.current)){const x=e.style.animationFillMode;e.style.animationFillMode="forwards",d=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=x)})}},p=f=>{f.target===e&&(r.current=Hg(s.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(d),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:S.useCallback(d=>{s.current=d?getComputedStyle(d):null,n(d)},[])}}function Hg(t){return(t==null?void 0:t.animationName)||"none"}function Zle(t){var s,i;let e=(s=Object.getOwnPropertyDescriptor(t.props,"ref"))==null?void 0:s.get,n=e&&"isReactWarning"in e&&e.isReactWarning;return n?t.ref:(e=(i=Object.getOwnPropertyDescriptor(t,"ref"))==null?void 0:i.get,n=e&&"isReactWarning"in e&&e.isReactWarning,n?t.props.ref:t.props.ref||t.ref)}var ww=0;function S1(){S.useEffect(()=>{const t=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",t[0]??RA()),document.body.insertAdjacentElement("beforeend",t[1]??RA()),ww++,()=>{ww===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),ww--}},[])}function RA(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.outline="none",t.style.opacity="0",t.style.position="fixed",t.style.pointerEvents="none",t}var wr=function(){return wr=Object.assign||function(e){for(var n,s=1,i=arguments.length;s<i;s++){n=arguments[s];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},wr.apply(this,arguments)};function _f(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]]);return n}function Jle(t,e,n){if(n||arguments.length===2)for(var s=0,i=e.length,r;s<i;s++)(r||!(s in e))&&(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return t.concat(r||Array.prototype.slice.call(e))}var sy="right-scroll-bar-position",iy="width-before-scroll-bar",Qle="with-scroll-bars-hidden",ece="--removed-body-scroll-bar-size";function _w(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function tce(t,e){var n=S.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(s){var i=n.value;i!==s&&(n.value=s,n.callback(s,i))}}}})[0];return n.callback=e,n.facade}var nce=typeof window<"u"?S.useLayoutEffect:S.useEffect,MA=new WeakMap;function sce(t,e){var n=tce(null,function(s){return t.forEach(function(i){return _w(i,s)})});return nce(function(){var s=MA.get(n);if(s){var i=new Set(s),r=new Set(t),o=n.current;i.forEach(function(l){r.has(l)||_w(l,null)}),r.forEach(function(l){i.has(l)||_w(l,o)})}MA.set(n,t)},[t]),n}function ice(t){return t}function rce(t,e){e===void 0&&(e=ice);var n=[],s=!1,i={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(r){var o=e(r,s);return n.push(o),function(){n=n.filter(function(l){return l!==o})}},assignSyncMedium:function(r){for(s=!0;n.length;){var o=n;n=[],o.forEach(r)}n={push:function(l){return r(l)},filter:function(){return n}}},assignMedium:function(r){s=!0;var o=[];if(n.length){var l=n;n=[],l.forEach(r),o=n}var c=function(){var u=o;o=[],u.forEach(r)},d=function(){return Promise.resolve().then(c)};d(),n={push:function(u){o.push(u),d()},filter:function(u){return o=o.filter(u),n}}}};return i}function oce(t){t===void 0&&(t={});var e=rce(null);return e.options=wr({async:!0,ssr:!1},t),e}var i3=function(t){var e=t.sideCar,n=_f(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=e.read();if(!s)throw new Error("Sidecar medium not found");return S.createElement(s,wr({},n))};i3.isSideCarExport=!0;function ace(t,e){return t.useMedium(e),i3}var r3=oce(),Cw=function(){},Qx=S.forwardRef(function(t,e){var n=S.useRef(null),s=S.useState({onScrollCapture:Cw,onWheelCapture:Cw,onTouchMoveCapture:Cw}),i=s[0],r=s[1],o=t.forwardProps,l=t.children,c=t.className,d=t.removeScrollBar,u=t.enabled,h=t.shards,p=t.sideCar,f=t.noRelative,g=t.noIsolation,y=t.inert,x=t.allowPinchZoom,m=t.as,v=m===void 0?"div":m,w=t.gapMode,_=_f(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),C=p,I=sce([n,e]),T=wr(wr({},_),i);return S.createElement(S.Fragment,null,u&&S.createElement(C,{sideCar:r3,removeScrollBar:d,shards:h,noRelative:f,noIsolation:g,inert:y,setCallbacks:r,allowPinchZoom:!!x,lockRef:n,gapMode:w}),o?S.cloneElement(S.Children.only(l),wr(wr({},T),{ref:I})):S.createElement(v,wr({},T,{className:c,ref:I}),l))});Qx.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Qx.classNames={fullWidth:iy,zeroRight:sy};var lce=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function cce(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=lce();return e&&t.setAttribute("nonce",e),t}function dce(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function uce(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var hce=function(){var t=0,e=null;return{add:function(n){t==0&&(e=cce())&&(dce(e,n),uce(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},pce=function(){var t=hce();return function(e,n){S.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},o3=function(){var t=pce(),e=function(n){var s=n.styles,i=n.dynamic;return t(s,i),null};return e},fce={left:0,top:0,right:0,gap:0},Ew=function(t){return parseInt(t||"",10)||0},gce=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],s=e[t==="padding"?"paddingTop":"marginTop"],i=e[t==="padding"?"paddingRight":"marginRight"];return[Ew(n),Ew(s),Ew(i)]},mce=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return fce;var e=gce(t),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,s-n+e[2]-e[0])}},yce=o3(),yd="data-scroll-locked",vce=function(t,e,n,s){var i=t.left,r=t.top,o=t.right,l=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(Qle,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(l,"px ").concat(s,`;
  }
  body[`).concat(yd,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(r,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(sy,` {
    right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(iy,` {
    margin-right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(sy," .").concat(sy,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(iy," .").concat(iy,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(yd,`] {
    `).concat(ece,": ").concat(l,`px;
  }
`)},OA=function(){var t=parseInt(document.body.getAttribute(yd)||"0",10);return isFinite(t)?t:0},xce=function(){S.useEffect(function(){return document.body.setAttribute(yd,(OA()+1).toString()),function(){var t=OA()-1;t<=0?document.body.removeAttribute(yd):document.body.setAttribute(yd,t.toString())}},[])},Sce=function(t){var e=t.noRelative,n=t.noImportant,s=t.gapMode,i=s===void 0?"margin":s;xce();var r=S.useMemo(function(){return mce(i)},[i]);return S.createElement(yce,{styles:vce(r,!e,i,n?"":"!important")})},gC=!1;if(typeof window<"u")try{var Gg=Object.defineProperty({},"passive",{get:function(){return gC=!0,!0}});window.addEventListener("test",Gg,Gg),window.removeEventListener("test",Gg,Gg)}catch{gC=!1}var Ic=gC?{passive:!1}:!1,bce=function(t){return t.tagName==="TEXTAREA"},a3=function(t,e){if(!(t instanceof Element))return!1;var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!bce(t)&&n[e]==="visible")},wce=function(t){return a3(t,"overflowY")},_ce=function(t){return a3(t,"overflowX")},DA=function(t,e){var n=e.ownerDocument,s=e;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var i=l3(t,s);if(i){var r=c3(t,s),o=r[1],l=r[2];if(o>l)return!0}s=s.parentNode}while(s&&s!==n.body);return!1},Cce=function(t){var e=t.scrollTop,n=t.scrollHeight,s=t.clientHeight;return[e,n,s]},Ece=function(t){var e=t.scrollLeft,n=t.scrollWidth,s=t.clientWidth;return[e,n,s]},l3=function(t,e){return t==="v"?wce(e):_ce(e)},c3=function(t,e){return t==="v"?Cce(e):Ece(e)},Tce=function(t,e){return t==="h"&&e==="rtl"?-1:1},Ice=function(t,e,n,s,i){var r=Tce(t,window.getComputedStyle(e).direction),o=r*s,l=n.target,c=e.contains(l),d=!1,u=o>0,h=0,p=0;do{if(!l)break;var f=c3(t,l),g=f[0],y=f[1],x=f[2],m=y-x-r*g;(g||m)&&l3(t,l)&&(h+=m,p+=g);var v=l.parentNode;l=v&&v.nodeType===Node.DOCUMENT_FRAGMENT_NODE?v.host:v}while(!c&&l!==document.body||c&&(e.contains(l)||e===l));return(u&&Math.abs(h)<1||!u&&Math.abs(p)<1)&&(d=!0),d},Vg=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},LA=function(t){return[t.deltaX,t.deltaY]},FA=function(t){return t&&"current"in t?t.current:t},Pce=function(t,e){return t[0]===e[0]&&t[1]===e[1]},kce=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},jce=0,Pc=[];function Nce(t){var e=S.useRef([]),n=S.useRef([0,0]),s=S.useRef(),i=S.useState(jce++)[0],r=S.useState(o3)[0],o=S.useRef(t);S.useEffect(function(){o.current=t},[t]),S.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(i));var y=Jle([t.lockRef.current],(t.shards||[]).map(FA),!0).filter(Boolean);return y.forEach(function(x){return x.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),y.forEach(function(x){return x.classList.remove("allow-interactivity-".concat(i))})}}},[t.inert,t.lockRef.current,t.shards]);var l=S.useCallback(function(y,x){if("touches"in y&&y.touches.length===2||y.type==="wheel"&&y.ctrlKey)return!o.current.allowPinchZoom;var m=Vg(y),v=n.current,w="deltaX"in y?y.deltaX:v[0]-m[0],_="deltaY"in y?y.deltaY:v[1]-m[1],C,I=y.target,T=Math.abs(w)>Math.abs(_)?"h":"v";if("touches"in y&&T==="h"&&I.type==="range")return!1;var P=window.getSelection(),k=P&&P.anchorNode,N=k?k===I||k.contains(I):!1;if(N)return!1;var O=DA(T,I);if(!O)return!0;if(O?C=T:(C=T==="v"?"h":"v",O=DA(T,I)),!O)return!1;if(!s.current&&"changedTouches"in y&&(w||_)&&(s.current=C),!C)return!0;var R=s.current||C;return Ice(R,x,y,R==="h"?w:_)},[]),c=S.useCallback(function(y){var x=y;if(!(!Pc.length||Pc[Pc.length-1]!==r)){var m="deltaY"in x?LA(x):Vg(x),v=e.current.filter(function(C){return C.name===x.type&&(C.target===x.target||x.target===C.shadowParent)&&Pce(C.delta,m)})[0];if(v&&v.should){x.cancelable&&x.preventDefault();return}if(!v){var w=(o.current.shards||[]).map(FA).filter(Boolean).filter(function(C){return C.contains(x.target)}),_=w.length>0?l(x,w[0]):!o.current.noIsolation;_&&x.cancelable&&x.preventDefault()}}},[]),d=S.useCallback(function(y,x,m,v){var w={name:y,delta:x,target:m,should:v,shadowParent:Ace(m)};e.current.push(w),setTimeout(function(){e.current=e.current.filter(function(_){return _!==w})},1)},[]),u=S.useCallback(function(y){n.current=Vg(y),s.current=void 0},[]),h=S.useCallback(function(y){d(y.type,LA(y),y.target,l(y,t.lockRef.current))},[]),p=S.useCallback(function(y){d(y.type,Vg(y),y.target,l(y,t.lockRef.current))},[]);S.useEffect(function(){return Pc.push(r),t.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,Ic),document.addEventListener("touchmove",c,Ic),document.addEventListener("touchstart",u,Ic),function(){Pc=Pc.filter(function(y){return y!==r}),document.removeEventListener("wheel",c,Ic),document.removeEventListener("touchmove",c,Ic),document.removeEventListener("touchstart",u,Ic)}},[]);var f=t.removeScrollBar,g=t.inert;return S.createElement(S.Fragment,null,g?S.createElement(r,{styles:kce(i)}):null,f?S.createElement(Sce,{noRelative:t.noRelative,gapMode:t.gapMode}):null)}function Ace(t){for(var e=null;t!==null;)t instanceof ShadowRoot&&(e=t.host,t=t.host),t=t.parentNode;return e}const Rce=ace(r3,Nce);var eS=S.forwardRef(function(t,e){return S.createElement(Qx,wr({},t,{ref:e,sideCar:Rce}))});eS.classNames=Qx.classNames;var Mce=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},kc=new WeakMap,Kg=new WeakMap,Yg={},Tw=0,d3=function(t){return t&&(t.host||d3(t.parentNode))},Oce=function(t,e){return e.map(function(n){if(t.contains(n))return n;var s=d3(n);return s&&t.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},Dce=function(t,e,n,s){var i=Oce(e,Array.isArray(t)?t:[t]);Yg[n]||(Yg[n]=new WeakMap);var r=Yg[n],o=[],l=new Set,c=new Set(i),d=function(h){!h||l.has(h)||(l.add(h),d(h.parentNode))};i.forEach(d);var u=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(p){if(l.has(p))u(p);else try{var f=p.getAttribute(s),g=f!==null&&f!=="false",y=(kc.get(p)||0)+1,x=(r.get(p)||0)+1;kc.set(p,y),r.set(p,x),o.push(p),y===1&&g&&Kg.set(p,!0),x===1&&p.setAttribute(n,"true"),g||p.setAttribute(s,"true")}catch(m){console.error("aria-hidden: cannot operate on ",p,m)}})};return u(e),l.clear(),Tw++,function(){o.forEach(function(h){var p=kc.get(h)-1,f=r.get(h)-1;kc.set(h,p),r.set(h,f),p||(Kg.has(h)||h.removeAttribute(s),Kg.delete(h)),f||h.removeAttribute(n)}),Tw--,Tw||(kc=new WeakMap,kc=new WeakMap,Kg=new WeakMap,Yg={})}},b1=function(t,e,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(t)?t:[t]),i=Mce(t);return i?(s.push.apply(s,Array.from(i.querySelectorAll("[aria-live], script"))),Dce(s,i,n,"aria-hidden")):function(){return null}},tS="Dialog",[u3]=Yr(tS),[Lce,cr]=u3(tS),h3=t=>{const{__scopeDialog:e,children:n,open:s,defaultOpen:i,onOpenChange:r,modal:o=!0}=t,l=S.useRef(null),c=S.useRef(null),[d,u]=il({prop:s,defaultProp:i??!1,onChange:r,caller:tS});return a.jsx(Lce,{scope:e,triggerRef:l,contentRef:c,contentId:Co(),titleId:Co(),descriptionId:Co(),open:d,onOpenChange:u,onOpenToggle:S.useCallback(()=>u(h=>!h),[u]),modal:o,children:n})};h3.displayName=tS;var p3="DialogTrigger",Fce=S.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,i=cr(p3,n),r=ut(e,i.triggerRef);return a.jsx(Ye.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":C1(i.open),...s,ref:r,onClick:me(t.onClick,i.onOpenToggle)})});Fce.displayName=p3;var w1="DialogPortal",[Bce,f3]=u3(w1,{forceMount:void 0}),g3=t=>{const{__scopeDialog:e,forceMount:n,children:s,container:i}=t,r=cr(w1,e);return a.jsx(Bce,{scope:e,forceMount:n,children:S.Children.map(s,o=>a.jsx(lr,{present:n||r.open,children:a.jsx(wf,{asChild:!0,container:i,children:o})}))})};g3.displayName=w1;var bv="DialogOverlay",m3=S.forwardRef((t,e)=>{const n=f3(bv,t.__scopeDialog),{forceMount:s=n.forceMount,...i}=t,r=cr(bv,t.__scopeDialog);return r.modal?a.jsx(lr,{present:s||r.open,children:a.jsx($ce,{...i,ref:e})}):null});m3.displayName=bv;var Uce=Bd("DialogOverlay.RemoveScroll"),$ce=S.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,i=cr(bv,n);return a.jsx(eS,{as:Uce,allowPinchZoom:!0,shards:[i.contentRef],children:a.jsx(Ye.div,{"data-state":C1(i.open),...s,ref:e,style:{pointerEvents:"auto",...s.style}})})}),Zl="DialogContent",y3=S.forwardRef((t,e)=>{const n=f3(Zl,t.__scopeDialog),{forceMount:s=n.forceMount,...i}=t,r=cr(Zl,t.__scopeDialog);return a.jsx(lr,{present:s||r.open,children:r.modal?a.jsx(zce,{...i,ref:e}):a.jsx(Wce,{...i,ref:e})})});y3.displayName=Zl;var zce=S.forwardRef((t,e)=>{const n=cr(Zl,t.__scopeDialog),s=S.useRef(null),i=ut(e,n.contentRef,s);return S.useEffect(()=>{const r=s.current;if(r)return b1(r)},[]),a.jsx(v3,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:me(t.onCloseAutoFocus,r=>{var o;r.preventDefault(),(o=n.triggerRef.current)==null||o.focus()}),onPointerDownOutside:me(t.onPointerDownOutside,r=>{const o=r.detail.originalEvent,l=o.button===0&&o.ctrlKey===!0;(o.button===2||l)&&r.preventDefault()}),onFocusOutside:me(t.onFocusOutside,r=>r.preventDefault())})}),Wce=S.forwardRef((t,e)=>{const n=cr(Zl,t.__scopeDialog),s=S.useRef(!1),i=S.useRef(!1);return a.jsx(v3,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{var o,l;(o=t.onCloseAutoFocus)==null||o.call(t,r),r.defaultPrevented||(s.current||(l=n.triggerRef.current)==null||l.focus(),r.preventDefault()),s.current=!1,i.current=!1},onInteractOutside:r=>{var c,d;(c=t.onInteractOutside)==null||c.call(t,r),r.defaultPrevented||(s.current=!0,r.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=r.target;((d=n.triggerRef.current)==null?void 0:d.contains(o))&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&i.current&&r.preventDefault()}})}),v3=S.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:r,...o}=t,l=cr(Zl,n),c=S.useRef(null),d=ut(e,c);return S1(),a.jsxs(a.Fragment,{children:[a.jsx(Jx,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:i,onUnmountAutoFocus:r,children:a.jsx(bf,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":C1(l.open),...o,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),a.jsxs(a.Fragment,{children:[a.jsx(Gce,{titleId:l.titleId}),a.jsx(Kce,{contentRef:c,descriptionId:l.descriptionId})]})]})}),_1="DialogTitle",x3=S.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,i=cr(_1,n);return a.jsx(Ye.h2,{id:i.titleId,...s,ref:e})});x3.displayName=_1;var S3="DialogDescription",Hce=S.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,i=cr(S3,n);return a.jsx(Ye.p,{id:i.descriptionId,...s,ref:e})});Hce.displayName=S3;var b3="DialogClose",w3=S.forwardRef((t,e)=>{const{__scopeDialog:n,...s}=t,i=cr(b3,n);return a.jsx(Ye.button,{type:"button",...s,ref:e,onClick:me(t.onClick,()=>i.onOpenChange(!1))})});w3.displayName=b3;function C1(t){return t?"open":"closed"}var _3="DialogTitleWarning",[cIe,C3]=xle(_3,{contentName:Zl,titleName:_1,docsSlug:"dialog"}),Gce=({titleId:t})=>{const e=C3(_3),n=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return S.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},Vce="DialogDescriptionWarning",Kce=({contentRef:t,descriptionId:e})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${C3(Vce).contentName}}.`;return S.useEffect(()=>{var r;const i=(r=t.current)==null?void 0:r.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(s))},[s,t,e]),null},Yce=h3,Xce=g3,qce=m3,Zce=y3;const E3=()=>{},T3=S.createContext(null);function Jce({onEvent:t,children:e}){return a.jsx(T3.Provider,{value:t??E3,children:e})}function Dn(){return S.useContext(T3)??E3}const I3=S.createContext(null);function Qce({children:t}){const e=K(),n=Dn(),[s,i]=S.useState([]),r=S.useCallback(d=>{const u=d.id??Rt();return i(h=>[...h.filter(p=>p.id!==d.id),{...d,id:u}]),n("open-menu",{source:"dialog",id:u}),e.addOpenMenu(u),u},[e,n]),o=S.useCallback((d,u)=>(i(h=>h.map(p=>p.id===d?{...p,...u}:p)),n("open-menu",{source:"dialog",id:d}),e.addOpenMenu(d),d),[e,n]),l=S.useCallback(d=>(i(u=>u.filter(h=>{var p;return h.id===d?((p=h.onClose)==null||p.call(h),!1):!0})),n("close-menu",{source:"dialog",id:d}),e.deleteOpenMenu(d),d),[e,n]),c=S.useCallback(()=>{i(d=>(d.forEach(u=>{var h;(h=u.onClose)==null||h.call(u),n("close-menu",{source:"dialog",id:u.id}),e.deleteOpenMenu(u.id)}),[]))},[e,n]);return a.jsx(I3.Provider,{value:{dialogs:s,addDialog:r,removeDialog:l,clearDialogs:c,updateDialog:o},children:t})}function pc(){const t=S.useContext(I3);if(!t)throw new Error("useDialogs must be used within a DialogsProvider");return t}const ede=({id:t,component:e,onClose:n})=>{const{removeDialog:s}=pc(),i=vn(),r=S.useCallback(o=>{if(!o){if(n)try{n()}catch(l){console.warn(l)}s(t)}},[t,n,s]);return a.jsx(Yce,{onOpenChange:r,defaultOpen:!0,children:a.jsx(Xce,{container:i,children:a.jsx(qce,{dir:"ltr",className:"tlui-dialog__overlay",onClick:o=>{o.target===o.currentTarget&&r(!1)},children:a.jsx(Zce,{dir:"ltr",className:"tlui-dialog__content",children:a.jsx(e,{onClose:()=>r(!1)})})})})})};function tde(){const{dialogs:t}=pc();return t.map(e=>a.jsx(ede,{...e},e.id))}const nde=Oe.memo(tde);function sde(){const t=K(),e=Z("follow",()=>t.getInstanceState().followingUserId,[t]);return e?a.jsx(ide,{userId:e}):null}function ide({userId:t}){const e=Fx(t);return e?a.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}function nS(t){const e=t+"CollectionProvider",[n,s]=Yr(e),[i,r]=n(e,{collectionRef:{current:null},itemMap:new Map}),o=y=>{const{scope:x,children:m}=y,v=Oe.useRef(null),w=Oe.useRef(new Map).current;return a.jsx(i,{scope:x,itemMap:w,collectionRef:v,children:m})};o.displayName=e;const l=t+"CollectionSlot",c=Bd(l),d=Oe.forwardRef((y,x)=>{const{scope:m,children:v}=y,w=r(l,m),_=ut(x,w.collectionRef);return a.jsx(c,{ref:_,children:v})});d.displayName=l;const u=t+"CollectionItemSlot",h="data-radix-collection-item",p=Bd(u),f=Oe.forwardRef((y,x)=>{const{scope:m,children:v,...w}=y,_=Oe.useRef(null),C=ut(x,_),I=r(u,m);return Oe.useEffect(()=>(I.itemMap.set(_,{ref:_,...w}),()=>void I.itemMap.delete(_))),a.jsx(p,{[h]:"",ref:C,children:v})});f.displayName=u;function g(y){const x=r(t+"CollectionConsumer",y);return Oe.useCallback(()=>{const v=x.collectionRef.current;if(!v)return[];const w=Array.from(v.querySelectorAll(`[${h}]`));return Array.from(x.itemMap.values()).sort((I,T)=>w.indexOf(I.ref.current)-w.indexOf(T.ref.current))},[x.collectionRef,x.itemMap])}return[{Provider:o,Slot:d,ItemSlot:f},g,s]}var rde=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),ode="VisuallyHidden",E1=S.forwardRef((t,e)=>a.jsx(Ye.span,{...t,ref:e,style:{...rde,...t.style}}));E1.displayName=ode;var T1="ToastProvider",[I1,ade,lde]=nS("Toast"),[P3]=Yr("Toast",[lde]),[cde,sS]=P3(T1),k3=t=>{const{__scopeToast:e,label:n="Notification",duration:s=5e3,swipeDirection:i="right",swipeThreshold:r=50,children:o}=t,[l,c]=S.useState(null),[d,u]=S.useState(0),h=S.useRef(!1),p=S.useRef(!1);return n.trim()||console.error(`Invalid prop \`label\` supplied to \`${T1}\`. Expected non-empty \`string\`.`),a.jsx(I1.Provider,{scope:e,children:a.jsx(cde,{scope:e,label:n,duration:s,swipeDirection:i,swipeThreshold:r,toastCount:d,viewport:l,onViewportChange:c,onToastAdd:S.useCallback(()=>u(f=>f+1),[]),onToastRemove:S.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:p,children:o})})};k3.displayName=T1;var j3="ToastViewport",dde=["F8"],mC="toast.viewportPause",yC="toast.viewportResume",N3=S.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:s=dde,label:i="Notifications ({hotkey})",...r}=t,o=sS(j3,n),l=ade(n),c=S.useRef(null),d=S.useRef(null),u=S.useRef(null),h=S.useRef(null),p=ut(e,h,o.onViewportChange),f=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=o.toastCount>0;S.useEffect(()=>{const x=m=>{var w;s.length!==0&&s.every(_=>m[_]||m.code===_)&&((w=h.current)==null||w.focus())};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[s]),S.useEffect(()=>{const x=c.current,m=h.current;if(g&&x&&m){const v=()=>{if(!o.isClosePausedRef.current){const I=new CustomEvent(mC);m.dispatchEvent(I),o.isClosePausedRef.current=!0}},w=()=>{if(o.isClosePausedRef.current){const I=new CustomEvent(yC);m.dispatchEvent(I),o.isClosePausedRef.current=!1}},_=I=>{!x.contains(I.relatedTarget)&&w()},C=()=>{x.contains(document.activeElement)||w()};return x.addEventListener("focusin",v),x.addEventListener("focusout",_),x.addEventListener("pointermove",v),x.addEventListener("pointerleave",C),window.addEventListener("blur",v),window.addEventListener("focus",w),()=>{x.removeEventListener("focusin",v),x.removeEventListener("focusout",_),x.removeEventListener("pointermove",v),x.removeEventListener("pointerleave",C),window.removeEventListener("blur",v),window.removeEventListener("focus",w)}}},[g,o.isClosePausedRef]);const y=S.useCallback(({tabbingDirection:x})=>{const v=l().map(w=>{const _=w.ref.current,C=[_,..._de(_)];return x==="forwards"?C:C.reverse()});return(x==="forwards"?v.reverse():v).flat()},[l]);return S.useEffect(()=>{const x=h.current;if(x){const m=v=>{var C,I,T;const w=v.altKey||v.ctrlKey||v.metaKey;if(v.key==="Tab"&&!w){const P=document.activeElement,k=v.shiftKey;if(v.target===x&&k){(C=d.current)==null||C.focus();return}const R=y({tabbingDirection:k?"backwards":"forwards"}),j=R.findIndex(A=>A===P);Iw(R.slice(j+1))?v.preventDefault():k?(I=d.current)==null||I.focus():(T=u.current)==null||T.focus()}};return x.addEventListener("keydown",m),()=>x.removeEventListener("keydown",m)}},[l,y]),a.jsxs(Ule,{ref:c,role:"region","aria-label":i.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:g?void 0:"none"},children:[g&&a.jsx(vC,{ref:d,onFocusFromOutsideViewport:()=>{const x=y({tabbingDirection:"forwards"});Iw(x)}}),a.jsx(I1.Slot,{scope:n,children:a.jsx(Ye.ol,{tabIndex:-1,...r,ref:p})}),g&&a.jsx(vC,{ref:u,onFocusFromOutsideViewport:()=>{const x=y({tabbingDirection:"backwards"});Iw(x)}})]})});N3.displayName=j3;var A3="ToastFocusProxy",vC=S.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:s,...i}=t,r=sS(A3,n);return a.jsx(E1,{tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:o=>{var d;const l=o.relatedTarget;!((d=r.viewport)!=null&&d.contains(l))&&s()}})});vC.displayName=A3;var Cf="Toast",ude="toast.swipeStart",hde="toast.swipeMove",pde="toast.swipeCancel",fde="toast.swipeEnd",R3=S.forwardRef((t,e)=>{const{forceMount:n,open:s,defaultOpen:i,onOpenChange:r,...o}=t,[l,c]=il({prop:s,defaultProp:i??!0,onChange:r,caller:Cf});return a.jsx(lr,{present:n||l,children:a.jsx(yde,{open:l,...o,ref:e,onClose:()=>c(!1),onPause:fs(t.onPause),onResume:fs(t.onResume),onSwipeStart:me(t.onSwipeStart,d=>{d.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:me(t.onSwipeMove,d=>{const{x:u,y:h}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","move"),d.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:me(t.onSwipeCancel,d=>{d.currentTarget.setAttribute("data-swipe","cancel"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:me(t.onSwipeEnd,d=>{const{x:u,y:h}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","end"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),c(!1)})})})});R3.displayName=Cf;var[gde,mde]=P3(Cf,{onClose(){}}),yde=S.forwardRef((t,e)=>{const{__scopeToast:n,type:s="foreground",duration:i,open:r,onClose:o,onEscapeKeyDown:l,onPause:c,onResume:d,onSwipeStart:u,onSwipeMove:h,onSwipeCancel:p,onSwipeEnd:f,...g}=t,y=sS(Cf,n),[x,m]=S.useState(null),v=ut(e,A=>m(A)),w=S.useRef(null),_=S.useRef(null),C=i||y.duration,I=S.useRef(0),T=S.useRef(C),P=S.useRef(0),{onToastAdd:k,onToastRemove:N}=y,O=fs(()=>{var B;(x==null?void 0:x.contains(document.activeElement))&&((B=y.viewport)==null||B.focus()),o()}),R=S.useCallback(A=>{!A||A===1/0||(window.clearTimeout(P.current),I.current=new Date().getTime(),P.current=window.setTimeout(O,A))},[O]);S.useEffect(()=>{const A=y.viewport;if(A){const B=()=>{R(T.current),d==null||d()},L=()=>{const $=new Date().getTime()-I.current;T.current=T.current-$,window.clearTimeout(P.current),c==null||c()};return A.addEventListener(mC,L),A.addEventListener(yC,B),()=>{A.removeEventListener(mC,L),A.removeEventListener(yC,B)}}},[y.viewport,C,c,d,R]),S.useEffect(()=>{r&&!y.isClosePausedRef.current&&R(C)},[r,C,y.isClosePausedRef,R]),S.useEffect(()=>(k(),()=>N()),[k,N]);const j=S.useMemo(()=>x?U3(x):null,[x]);return y.viewport?a.jsxs(a.Fragment,{children:[j&&a.jsx(vde,{__scopeToast:n,role:"status","aria-live":s==="foreground"?"assertive":"polite",children:j}),a.jsx(gde,{scope:n,onClose:O,children:Br.createPortal(a.jsx(I1.ItemSlot,{scope:n,children:a.jsx(Ble,{asChild:!0,onEscapeKeyDown:me(l,()=>{y.isFocusedToastEscapeKeyDownRef.current||O(),y.isFocusedToastEscapeKeyDownRef.current=!1}),children:a.jsx(Ye.li,{tabIndex:0,"data-state":r?"open":"closed","data-swipe-direction":y.swipeDirection,...g,ref:v,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:me(t.onKeyDown,A=>{A.key==="Escape"&&(l==null||l(A.nativeEvent),A.nativeEvent.defaultPrevented||(y.isFocusedToastEscapeKeyDownRef.current=!0,O()))}),onPointerDown:me(t.onPointerDown,A=>{A.button===0&&(w.current={x:A.clientX,y:A.clientY})}),onPointerMove:me(t.onPointerMove,A=>{if(!w.current)return;const B=A.clientX-w.current.x,L=A.clientY-w.current.y,$=!!_.current,M=["left","right"].includes(y.swipeDirection),D=["left","up"].includes(y.swipeDirection)?Math.min:Math.max,U=M?D(0,B):0,z=M?0:D(0,L),H=A.pointerType==="touch"?10:2,q={x:U,y:z},V={originalEvent:A,delta:q};$?(_.current=q,Xg(hde,h,V,{discrete:!1})):BA(q,y.swipeDirection,H)?(_.current=q,Xg(ude,u,V,{discrete:!1}),A.target.setPointerCapture(A.pointerId)):(Math.abs(B)>H||Math.abs(L)>H)&&(w.current=null)}),onPointerUp:me(t.onPointerUp,A=>{const B=_.current,L=A.target;if(L.hasPointerCapture(A.pointerId)&&L.releasePointerCapture(A.pointerId),_.current=null,w.current=null,B){const $=A.currentTarget,M={originalEvent:A,delta:B};BA(B,y.swipeDirection,y.swipeThreshold)?Xg(fde,f,M,{discrete:!0}):Xg(pde,p,M,{discrete:!0}),$.addEventListener("click",D=>D.preventDefault(),{once:!0})}})})})}),y.viewport)})]}):null}),vde=t=>{const{__scopeToast:e,children:n,...s}=t,i=sS(Cf,e),[r,o]=S.useState(!1),[l,c]=S.useState(!1);return bde(()=>o(!0)),S.useEffect(()=>{const d=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(d)},[]),l?null:a.jsx(wf,{asChild:!0,children:a.jsx(E1,{...s,children:r&&a.jsxs(a.Fragment,{children:[i.label," ",n]})})})},xde="ToastTitle",M3=S.forwardRef((t,e)=>{const{__scopeToast:n,...s}=t;return a.jsx(Ye.div,{...s,ref:e})});M3.displayName=xde;var Sde="ToastDescription",O3=S.forwardRef((t,e)=>{const{__scopeToast:n,...s}=t;return a.jsx(Ye.div,{...s,ref:e})});O3.displayName=Sde;var D3="ToastAction",L3=S.forwardRef((t,e)=>{const{altText:n,...s}=t;return n.trim()?a.jsx(B3,{altText:n,asChild:!0,children:a.jsx(P1,{...s,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${D3}\`. Expected non-empty \`string\`.`),null)});L3.displayName=D3;var F3="ToastClose",P1=S.forwardRef((t,e)=>{const{__scopeToast:n,...s}=t,i=mde(F3,n);return a.jsx(B3,{asChild:!0,children:a.jsx(Ye.button,{type:"button",...s,ref:e,onClick:me(t.onClick,i.onClose)})})});P1.displayName=F3;var B3=S.forwardRef((t,e)=>{const{__scopeToast:n,altText:s,...i}=t;return a.jsx(Ye.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...i,ref:e})});function U3(t){const e=[];return Array.from(t.childNodes).forEach(s=>{if(s.nodeType===s.TEXT_NODE&&s.textContent&&e.push(s.textContent),wde(s)){const i=s.ariaHidden||s.hidden||s.style.display==="none",r=s.dataset.radixToastAnnounceExclude==="";if(!i)if(r){const o=s.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...U3(s))}}),e}function Xg(t,e,n,{discrete:s}){const i=n.originalEvent.currentTarget,r=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&i.addEventListener(t,e,{once:!0}),s?x1(i,r):i.dispatchEvent(r)}var BA=(t,e,n=0)=>{const s=Math.abs(t.x),i=Math.abs(t.y),r=s>i;return e==="left"||e==="right"?r&&s>n:!r&&i>n};function bde(t=()=>{}){const e=fs(t);Ro(()=>{let n=0,s=0;return n=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(s)}},[e])}function wde(t){return t.nodeType===t.ELEMENT_NODE}function _de(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const i=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||i?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function Iw(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}var Cde=R3,Ede=M3,Tde=O3,Ide=L3,UA=P1;const $3=S.createContext(null);function Pde({children:t}){const[e,n]=S.useState([]),s=S.useCallback(o=>{const l=o.id??Rt();return n(c=>[...c.filter(d=>d.id!==o.id),{...o,id:l}]),l},[]),i=S.useCallback(o=>(n(l=>l.filter(c=>c.id!==o)),o),[]),r=S.useCallback(()=>{n(()=>[])},[]);return a.jsx(k3,{children:a.jsx($3.Provider,{value:{toasts:e,addToast:s,removeToast:i,clearToasts:r},children:t})})}function dr(){const t=S.useContext($3);if(!t)throw new Error("useToasts must be used within a ToastsProvider");return t}const be=S.forwardRef(function({children:e,disabled:n,type:s,...i},r){return a.jsx("button",{ref:r,type:"button",draggable:!1,disabled:n,...i,className:Se("tlui-button",`tlui-button__${s}`,i.className),children:e})});function Yt({children:t}){return a.jsx("span",{className:"tlui-button__label",children:t})}const Hr=S.memo(function({small:e,invertIcon:n,icon:s,color:i,className:r,...o}){const l=m1(),c=l.icons[s]??l.icons["question-mark-circle"],d=S.useRef(null);return S.useLayoutEffect(()=>{c||console.error(`Icon not found: ${s}. Add it to the assetUrls.icons object.`),d!=null&&d.current&&(d.current.style.webkitMask=`url(${c}) center 100% / 100% no-repeat`)},[d,c,s]),s==="none"?a.jsx("div",{className:Se("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},r)}):a.jsx("div",{...o,ref:d,className:Se("tlui-icon",{"tlui-icon__small":e},r),style:{color:i,mask:`url(${c}) center 100% / 100% no-repeat`,transform:n?"scale(-1, 1)":void 0}})}),kde={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function jde({toast:t}){const{removeToast:e}=dr(),n=$e(),s=o=>{o||e(t.id)},i=t.actions&&t.actions.length>0,r=t.icon||t.severity&&kde[t.severity];return a.jsxs(Cde,{onOpenChange:s,className:"tlui-toast__container",duration:t.keepOpen?1/0:5e3,"data-severity":t.severity,children:[r&&a.jsx("div",{className:"tlui-toast__icon",children:a.jsx(Hr,{icon:r})}),a.jsxs("div",{className:"tlui-toast__main",children:[a.jsxs("div",{className:"tlui-toast__content",children:[t.title&&a.jsx(Ede,{className:"tlui-toast__title",children:t.title}),t.description&&a.jsx(Tde,{className:"tlui-toast__description",children:t.description})]}),t.actions&&a.jsxs("div",{className:"tlui-toast__actions",children:[t.actions.map((o,l)=>a.jsx(Ide,{altText:o.label,asChild:!0,onClick:o.onClick,children:a.jsx(be,{type:o.type,children:a.jsx(Yt,{children:o.label})})},l)),a.jsx(UA,{asChild:!0,children:a.jsx(be,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:a.jsx(Yt,{children:t.closeLabel??n("toast.close")})})})]})]}),!i&&a.jsx(UA,{asChild:!0,children:a.jsx(be,{type:"normal",className:"tlui-toast__close",children:a.jsx(Yt,{children:t.closeLabel??n("toast.close")})})})]})}function Nde(){const{toasts:t}=dr();return t.map(e=>a.jsx(jde,{toast:e},e.id))}const Ade=S.memo(Nde);function Rde(){const t=K(),{toasts:e}=dr(),[n,s]=S.useState(!1);return S.useEffect(()=>{let i=-1;return e.length?s(!0):i=t.timers.setTimeout(()=>{s(!1)},1e3),()=>{clearTimeout(i)}},[e.length,s,t]),n?a.jsx(N3,{className:"tlui-toast__viewport"}):null}function Be({icon:t,small:e,invertIcon:n}){return a.jsx(Hr,{className:"tlui-button__icon",icon:t,small:e,invertIcon:n})}const Pw=[0,390,428,468,580,640,840,1023];var Ht=(t=>(t[t.ZERO=0]="ZERO",t[t.MOBILE_XXS=1]="MOBILE_XXS",t[t.MOBILE_XS=2]="MOBILE_XS",t[t.MOBILE_SM=3]="MOBILE_SM",t[t.MOBILE=4]="MOBILE",t[t.TABLET_SM=5]="TABLET_SM",t[t.TABLET=6]="TABLET",t[t.DESKTOP=7]="DESKTOP",t))(Ht||{});let xC={fonts:{draw:`${xa()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${xa()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${xa()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${xa()}/fonts/IBMPlexMono-Medium.woff2`}};function z3(t){return S.useMemo(()=>t?{fonts:{...xC.fonts,...t==null?void 0:t.fonts}}:xC,[t])}const Mde=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let Vu={...xC,icons:Object.fromEntries(Mde.map(t=>[t,`${xa()}/icons/icon/${t}.svg`])),translations:Object.fromEntries(Tp.map(t=>[t.locale,`${xa()}/translations/${t.locale}.json`])),embedIcons:Object.fromEntries(hf.map(t=>[t.type,`${xa()}/embed-icons/${t.type}.png`]))};function Ode(t){return t?{fonts:Object.assign({...Vu.fonts},{...t==null?void 0:t.fonts}),icons:Object.assign({...Vu.icons},{...t==null?void 0:t.icons}),embedIcons:Object.assign({...Vu.embedIcons},{...t==null?void 0:t.embedIcons}),translations:Object.assign({...Vu.translations},{...t==null?void 0:t.translations})}:Vu}function iS({className:t,children:e}){return a.jsx("div",{className:Se("tlui-dialog__header",t),children:e})}function rS({className:t,children:e}){return a.jsx(x3,{dir:"ltr",className:Se("tlui-dialog__header__title",t),children:e})}function oS(){return a.jsx("div",{className:"tlui-dialog__header__close",children:a.jsx(w3,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:a.jsx(be,{type:"icon","aria-label":"Close",onTouchEnd:t=>t.target.click(),children:a.jsx(Be,{small:!0,icon:"cross-2"})})})})}function Pp({className:t,children:e,style:n}){return a.jsx("div",{className:Se("tlui-dialog__body",t),style:n,children:e})}function k1({className:t,children:e}){return a.jsx("div",{className:Se("tlui-dialog__footer",t),children:e})}const aS=S.forwardRef(function({className:e,label:n,icon:s,iconLeft:i,autoSelect:r=!1,autoFocus:o=!1,defaultValue:l,placeholder:c,onComplete:d,onValueChange:u,onCancel:h,onFocus:p,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:g=!1,children:y,value:x},m){const v=K(),w=S.useRef(null);S.useImperativeHandle(m,()=>w.current);const _=$e(),C=S.useRef(l??""),I=S.useRef(l??""),[T,P]=S.useState(!1),k=S.useCallback(j=>{P(!0);const A=j.currentTarget;I.current=A.value,v.timers.requestAnimationFrame(()=>{r&&A.select()}),p==null||p()},[r,p,v.timers]),N=S.useCallback(j=>{const A=j.currentTarget.value;I.current=A,u==null||u(A)},[u]),O=S.useCallback(j=>{switch(j.key){case"Enter":{j.currentTarget.blur(),gn(j),d==null||d(j.currentTarget.value);break}case"Escape":{j.currentTarget.value=C.current,j.currentTarget.blur(),gn(j),h==null||h(j.currentTarget.value);break}}},[d,h]),R=S.useCallback(j=>{P(!1);const A=j.currentTarget.value;f==null||f(A)},[f]);return S.useEffect(()=>{if(!v.environment.isIos)return;const j=window.visualViewport;if(T&&g&&j){const A=()=>{var B;(B=w.current)==null||B.scrollIntoView({block:"center"})};return j.addEventListener("resize",A),j.addEventListener("scroll",A),v.timers.requestAnimationFrame(()=>{var B;(B=w.current)==null||B.scrollIntoView({block:"center"})}),()=>{j.removeEventListener("resize",A),j.removeEventListener("scroll",A)}}},[v,T,g]),a.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[y,n&&a.jsx("label",{children:_(n)}),i&&a.jsx(Hr,{icon:i,className:"tlui-icon-left",small:!0}),a.jsx("input",{ref:w,className:Se("tlui-input",e),type:"text",defaultValue:l,onKeyUp:O,onChange:N,onFocus:k,onBlur:R,autoFocus:o,placeholder:c,value:x}),s&&a.jsx(Hr,{icon:s,small:!!n})]})}),W3=yn(function({onClose:e}){const n=K(),s=$e(),i=m1(),[r,o]=S.useState(null),[l,c]=S.useState(""),[d,u]=S.useState(null),[h,p]=S.useState(!1),f=S.useRef(-1);return a.jsxs(a.Fragment,{children:[a.jsxs(iS,{children:[a.jsx(rS,{children:r?`${s("embed-dialog.title")}  ${r.title}`:s("embed-dialog.title")}),a.jsx(oS,{})]}),r?a.jsxs(a.Fragment,{children:[a.jsxs(Pp,{className:"tlui-embed-dialog__enter",children:[a.jsx(aS,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autoFocus:!0,onValueChange:g=>{c(g);const y=ba(g);u(y&&y.definition.type===r.type?y:null),p(!1),clearTimeout(f.current),f.current=n.timers.setTimeout(()=>p(!y),320)}}),l===""?a.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[a.jsx("span",{children:s("embed-dialog.instruction")})," ",r.instructionLink&&a.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:r.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",a.jsx(Hr,{icon:"external-link",small:!0})]})]}):a.jsx("div",{className:"tlui-embed-dialog__warning",children:h?s("embed-dialog.invalid-url"):""})]}),a.jsxs(k1,{className:"tlui-dialog__footer__actions",children:[a.jsx(be,{type:"normal",onClick:()=>{o(null),u(null),c("")},children:a.jsx(Yt,{children:s("embed-dialog.back")})}),a.jsx("div",{className:"tlui-embed__spacer"}),a.jsx(be,{type:"normal",onClick:e,children:a.jsx(Yt,{children:s("embed-dialog.cancel")})}),a.jsx(be,{type:"primary",disabled:!d,onClick:()=>{d&&(n.putExternalContent({type:"embed",url:l,point:n.getViewportPageBounds().center,embed:d.definition}),e())},children:a.jsx(Yt,{children:s("embed-dialog.create")})})]})]}):a.jsx(a.Fragment,{children:a.jsx(Pp,{className:"tlui-embed-dialog__list",children:hf.map(g=>a.jsxs(be,{type:"menu",onClick:()=>o(g),children:[a.jsx(Yt,{children:g.title}),a.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${i.embedIcons[g.type]})`}})]},g.type))})})]})});function H3(){const t=K(),e=S.useRef();return S.useEffect(()=>{const n=window.document.createElement("input");n.type="file",n.accept=$J,n.multiple=!0,e.current=n;async function s(i){const r=i.target.files;!r||r.length===0||(t.mark("insert media"),await t.putExternalContent({type:"files",files:Array.from(r),point:t.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.addEventListener("change",s),()=>{e.current=void 0,n.removeEventListener("change",s)}},[t]),S.useCallback(()=>{var n;(n=e.current)==null||n.click()},[e])}const G3=S.createContext(null);function Dde({overrides:t,children:e}){const n=K(),s=Dn(),{addDialog:i}=pc(),r=H3(),o=S.useMemo(()=>{const l=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(d){n.setCurrentTool("select"),s("select-tool",{source:d,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(d){n.setCurrentTool("hand"),s("select-tool",{source:d,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(d){n.setCurrentTool("eraser"),s("select-tool",{source:d,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(d){n.setCurrentTool("draw"),s("select-tool",{source:d,id:"draw"})}},...[...Ei.values].map(d=>({id:d,label:`tool.${d}`,meta:{geo:d},kbd:d==="rectangle"?"r":d==="ellipse"?"o":void 0,icon:"geo-"+d,onSelect(u){n.run(()=>{n.setStyleForNextShapes(Ei,d),n.setCurrentTool("geo"),s("select-tool",{source:u,id:`geo-${d}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(d){n.setCurrentTool("arrow"),s("select-tool",{source:d,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(d){n.setCurrentTool("line"),s("select-tool",{source:d,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(d){n.setCurrentTool("frame"),s("select-tool",{source:d,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(d){n.setCurrentTool("text"),s("select-tool",{source:d,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(d){r(),s("select-tool",{source:d,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(d){n.setCurrentTool("note"),s("select-tool",{source:d,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(d){n.setCurrentTool("laser"),s("select-tool",{source:d,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(d){i({component:W3}),s("select-tool",{source:d,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(d){n.setCurrentTool("highlight"),s("select-tool",{source:d,id:"highlight"})}}];l.push();const c=Object.fromEntries(l.map(d=>[d.id,d]));return t?t(n,c,{insertMedia:r}):c},[t,n,s,r,i]);return a.jsx(G3.Provider,{value:o,children:e})}function lS(){const t=S.useContext(G3);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}const V3=Oe.createContext(null);function Lde({forceMobile:t=!1,children:e}){const n=K(),s=Z("breakpoint",()=>{const{width:i}=n.getViewportScreenBounds(),r=t?Ht.MOBILE_SM:Pw.length-1;for(let o=0;o<r;o++)if(i>Pw[o]&&i<=Pw[o+1])return o;return r},[n]);return a.jsx(V3.Provider,{value:s,children:e})}function Ss(){const t=S.useContext(V3);if(t===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return t}function Fde(){const{addToast:t,removeToast:e,clearToasts:n}=dr(),{addDialog:s,clearDialogs:i,removeDialog:r,updateDialog:o}=pc(),c=Ss()<Ht.TABLET_SM,d=$e();return S.useMemo(()=>({addToast:t,removeToast:e,clearToasts:n,addDialog:s,clearDialogs:i,removeDialog:r,updateDialog:o,msg:d,isMobile:c}),[s,t,i,n,d,r,e,o,c])}function Bde(t,e){const n={};for(const s of t)if(s.translations)for(const[i,r]of $s(s.translations)){let o=n[i];o||(o=n[i]={}),Object.assign(o,r)}return{actions:(s,i)=>{for(const r of t)r.actions&&(i=r.actions(s,i,e));return i},tools:(s,i,r)=>{for(const o of t)o.tools&&(i=o.tools(s,i,{...e,...r}));return i},translations:n}}function K3(t){return S.useMemo(()=>t,t)}function Ude(t){const e=K3(t==null?[]:Array.isArray(t)?t:[t]);return S.useMemo(()=>{const n={};for(const s of e)if(s.translations)for(const[i,r]of $s(s.translations)){let o=n[i];o||(o=n[i]={}),Object.assign(o,r)}return n},[e])}function $de(t){const e=Fde(),n=K3(t==null?[]:Array.isArray(t)?t:[t]);return S.useMemo(()=>Bde(n,e),[n,e])}function zde(t,e){const n=Re(e.map(i=>t.getShape(i)).filter(i=>i&&t.isShapeOfType(i,"frame")));if(!n.length)return;const s=[];t.run(()=>{n.map(i=>{const r=t.getSortedChildIdsForParent(i.id);r.length&&(t.reparentShapes(r,i.parentId,i.index),s.push(...r))}),t.setSelectedShapes(s),t.deleteShapes(e)})}const Wde=50;function Hde(t,e,n={}){const s=t.getShape(e);if(!s)return;const i=t.getSortedChildIdsForParent(s.id),r=Re(i.map(f=>t.getShape(f)));if(!r.length)return;const o=de.FromPoints(r.flatMap(f=>{const g=t.getShapeGeometry(f.id);return t.getShapeLocalTransform(f).applyToPoints(g.vertices)})),{padding:l=Wde}=n,c=o.w+2*l,d=o.h+2*l,u=l-o.minX,h=l-o.minY;if(u===0&&h===0&&s.props.w===c&&s.props.h===d)return;const p=new E(u,h).rot(s.rotation);t.run(()=>{const f=i.map(g=>{const y=t.getShape(g);return{id:y.id,type:y.type,x:y.x+u,y:y.y+h}});f.push({id:s.id,type:s.type,x:s.x-p.x,y:s.y-p.y,props:{w:c,h:d}}),t.updateShapes(f)})}function $A(t){return oi.isValid(t)?{isValid:!0,hasProtocol:!0}:oi.isValid("https://"+t)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const Gde=yn(function({onClose:e}){const s=K().getOnlySelectedShape();return s&&"url"in s.props&&typeof s.props.url=="string"?a.jsx(Vde,{onClose:e,selectedShape:s}):null}),Vde=yn(function({onClose:e,selectedShape:n}){const s=K(),i=$e(),r=S.useRef(null);S.useEffect(()=>{s.timers.requestAnimationFrame(()=>{var g;return(g=r.current)==null?void 0:g.focus()})},[s]);const o=S.useRef(n.props.url),[l,c]=S.useState(()=>{const g=$A(n.props.url),y=g.isValid===!0?g.hasProtocol?n.props.url:"https://"+n.props.url:"https://";return{actual:y,safe:y,valid:!0}}),d=S.useCallback(g=>{const y=g.replace(/https?:\/\/(https?:\/\/)/,(v,w)=>w),x=$A(y),m=x.isValid===!0?x.hasProtocol?y:"https://"+y:"https://";c({actual:y,safe:m,valid:x.isValid})},[]),u=S.useCallback(()=>{const g=s.getOnlySelectedShape();g&&(s.updateShapes([{id:g.id,type:g.type,props:{url:""}}]),e())},[s,e]),h=S.useCallback(()=>{const g=s.getOnlySelectedShape();g&&(g&&"url"in g.props&&g.props.url!==l.safe&&s.updateShapes([{id:g.id,type:g.type,props:{url:l.safe}}]),e())},[s,e,l]),p=S.useCallback(()=>{e()},[e]);if(!n)return e(),null;const f=o.current&&!l.valid;return a.jsxs(a.Fragment,{children:[a.jsxs(iS,{children:[a.jsx(rS,{children:i("edit-link-dialog.title")}),a.jsx(oS,{})]}),a.jsx(Pp,{children:a.jsxs("div",{className:"tlui-edit-link-dialog",children:[a.jsx(aS,{ref:r,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:l.actual,onValueChange:d,onComplete:h,onCancel:p}),a.jsx("div",{children:l.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),a.jsxs(k1,{className:"tlui-dialog__footer__actions",children:[a.jsx(be,{type:"normal",onClick:p,onTouchEnd:p,children:a.jsx(Yt,{children:i("edit-link-dialog.cancel")})}),f?a.jsx(be,{type:"danger",onTouchEnd:u,onClick:u,children:a.jsx(Yt,{children:i("edit-link-dialog.clear")})}):a.jsx(be,{type:"primary",disabled:!l.valid,onTouchEnd:h,onClick:h,children:a.jsx(Yt,{children:i("edit-link-dialog.save")})})]})]})});var Y3={exports:{}};(function(t){var e=function(){var n=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(c,d){if(!r[c]){r[c]={};for(var u=0;u<c.length;u++)r[c][c.charAt(u)]=u}return r[c][d]}var l={compressToBase64:function(c){if(c==null)return"";var d=l._compress(c,6,function(u){return s.charAt(u)});switch(d.length%4){default:case 0:return d;case 1:return d+"===";case 2:return d+"==";case 3:return d+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:l._decompress(c.length,32,function(d){return o(s,c.charAt(d))})},compressToUTF16:function(c){return c==null?"":l._compress(c,15,function(d){return n(d+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:l._decompress(c.length,16384,function(d){return c.charCodeAt(d)-32})},compressToUint8Array:function(c){for(var d=l.compress(c),u=new Uint8Array(d.length*2),h=0,p=d.length;h<p;h++){var f=d.charCodeAt(h);u[h*2]=f>>>8,u[h*2+1]=f%256}return u},decompressFromUint8Array:function(c){if(c==null)return l.decompress(c);for(var d=new Array(c.length/2),u=0,h=d.length;u<h;u++)d[u]=c[u*2]*256+c[u*2+1];var p=[];return d.forEach(function(f){p.push(n(f))}),l.decompress(p.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":l._compress(c,6,function(d){return i.charAt(d)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),l._decompress(c.length,32,function(d){return o(i,c.charAt(d))}))},compress:function(c){return l._compress(c,16,function(d){return n(d)})},_compress:function(c,d,u){if(c==null)return"";var h,p,f={},g={},y="",x="",m="",v=2,w=3,_=2,C=[],I=0,T=0,P;for(P=0;P<c.length;P+=1)if(y=c.charAt(P),Object.prototype.hasOwnProperty.call(f,y)||(f[y]=w++,g[y]=!0),x=m+y,Object.prototype.hasOwnProperty.call(f,x))m=x;else{if(Object.prototype.hasOwnProperty.call(g,m)){if(m.charCodeAt(0)<256){for(h=0;h<_;h++)I=I<<1,T==d-1?(T=0,C.push(u(I)),I=0):T++;for(p=m.charCodeAt(0),h=0;h<8;h++)I=I<<1|p&1,T==d-1?(T=0,C.push(u(I)),I=0):T++,p=p>>1}else{for(p=1,h=0;h<_;h++)I=I<<1|p,T==d-1?(T=0,C.push(u(I)),I=0):T++,p=0;for(p=m.charCodeAt(0),h=0;h<16;h++)I=I<<1|p&1,T==d-1?(T=0,C.push(u(I)),I=0):T++,p=p>>1}v--,v==0&&(v=Math.pow(2,_),_++),delete g[m]}else for(p=f[m],h=0;h<_;h++)I=I<<1|p&1,T==d-1?(T=0,C.push(u(I)),I=0):T++,p=p>>1;v--,v==0&&(v=Math.pow(2,_),_++),f[x]=w++,m=String(y)}if(m!==""){if(Object.prototype.hasOwnProperty.call(g,m)){if(m.charCodeAt(0)<256){for(h=0;h<_;h++)I=I<<1,T==d-1?(T=0,C.push(u(I)),I=0):T++;for(p=m.charCodeAt(0),h=0;h<8;h++)I=I<<1|p&1,T==d-1?(T=0,C.push(u(I)),I=0):T++,p=p>>1}else{for(p=1,h=0;h<_;h++)I=I<<1|p,T==d-1?(T=0,C.push(u(I)),I=0):T++,p=0;for(p=m.charCodeAt(0),h=0;h<16;h++)I=I<<1|p&1,T==d-1?(T=0,C.push(u(I)),I=0):T++,p=p>>1}v--,v==0&&(v=Math.pow(2,_),_++),delete g[m]}else for(p=f[m],h=0;h<_;h++)I=I<<1|p&1,T==d-1?(T=0,C.push(u(I)),I=0):T++,p=p>>1;v--,v==0&&(v=Math.pow(2,_),_++)}for(p=2,h=0;h<_;h++)I=I<<1|p&1,T==d-1?(T=0,C.push(u(I)),I=0):T++,p=p>>1;for(;;)if(I=I<<1,T==d-1){C.push(u(I));break}else T++;return C.join("")},decompress:function(c){return c==null?"":c==""?null:l._decompress(c.length,32768,function(d){return c.charCodeAt(d)})},_decompress:function(c,d,u){var h=[],p=4,f=4,g=3,y="",x=[],m,v,w,_,C,I,T,P={val:u(0),position:d,index:1};for(m=0;m<3;m+=1)h[m]=m;for(w=0,C=Math.pow(2,2),I=1;I!=C;)_=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),w|=(_>0?1:0)*I,I<<=1;switch(w){case 0:for(w=0,C=Math.pow(2,8),I=1;I!=C;)_=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),w|=(_>0?1:0)*I,I<<=1;T=n(w);break;case 1:for(w=0,C=Math.pow(2,16),I=1;I!=C;)_=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),w|=(_>0?1:0)*I,I<<=1;T=n(w);break;case 2:return""}for(h[3]=T,v=T,x.push(T);;){if(P.index>c)return"";for(w=0,C=Math.pow(2,g),I=1;I!=C;)_=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),w|=(_>0?1:0)*I,I<<=1;switch(T=w){case 0:for(w=0,C=Math.pow(2,8),I=1;I!=C;)_=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),w|=(_>0?1:0)*I,I<<=1;h[f++]=n(w),T=f-1,p--;break;case 1:for(w=0,C=Math.pow(2,16),I=1;I!=C;)_=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),w|=(_>0?1:0)*I,I<<=1;h[f++]=n(w),T=f-1,p--;break;case 2:return x.join("")}if(p==0&&(p=Math.pow(2,g),g++),h[T])y=h[T];else if(T===f)y=v+v.charAt(0);else return null;x.push(y),h[f++]=v+y.charAt(0),p--,v=y,p==0&&(p=Math.pow(2,g),g++)}}};return l}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(Y3);var Kde=Y3.exports;const X3=qa(Kde);async function Yde(t,e,n){var m,v,w;const{elements:s,files:i}=e,r={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:t.store.schema.serialize()},o=new Map,l=new Map,c=t.getCurrentPageId(),d=new Map,u=[],h=new Set;s.forEach(_=>{if(d.set(_.id,it()),_.boundElements!==null)for(const C of _.boundElements)C.type==="text"&&h.add(C.id)});let p=LL;for(const _ of s){if(h.has(_.id))continue;const C=d.get(_.id),I={id:C,typeName:"shape",parentId:c,index:p,x:_.x,y:_.y,rotation:0,isLocked:_.locked,opacity:Xde(_.opacity),meta:{}};switch(_.angle!==0&&l.set(C,_.angle),_.groupIds&&_.groupIds.length>0?o.has(_.groupIds[0])?(m=o.get(_.groupIds[0]))==null||m.push(C):o.set(_.groupIds[0],[C]):u.push(C),_.type){case"rectangle":case"ellipse":case"diamond":{let T="",P="middle";if(_.boundElements!==null){for(const N of _.boundElements)if(N.type==="text"){const O=s.find(R=>R.id===N.id);O&&(T=O.text,P=tue[O.textAlign])}}const k=_.backgroundColor==="transparent"?_.strokeColor:_.backgroundColor;r.shapes.push({...I,type:"geo",props:{geo:_.type,url:_.link??"",w:_.width,h:_.height,size:qg[_.strokeWidth]??"draw",color:Ku[k]??"black",text:T,align:P,dash:Zg(_),fill:iue(_)}});break}case"freedraw":{r.shapes.push({...I,type:"draw",props:{dash:Zg(_),size:qg[_.strokeWidth],color:Ku[_.strokeColor]??"black",segments:[{type:"free",points:_.points.map(([T,P,k=.5])=>({x:T,y:P,z:k}))}]}});break}case"line":{if(_.points.slice().length<2)break;const P=Cp(_.points.length);r.shapes.push({...I,type:"line",props:{dash:Zg(_),size:qg[_.strokeWidth],color:Ku[_.strokeColor]??"black",spline:_.roundness?"cubic":"line",points:{...Object.fromEntries(_.points.map(([k,N],O)=>{const R=P[O];return[R,{id:R,index:R,x:k,y:N}]}))}}});break}case"arrow":{let T="";if(_.boundElements!==null){for(const R of _.boundElements)if(R.type==="text"){const j=s.find(A=>A.id===R.id);j&&(T=j.text)}}const P=_.points[0],k=_.points[_.points.length-1],N=d.get((v=_.startBinding)==null?void 0:v.elementId),O=d.get((w=_.endBinding)==null?void 0:w.elementId);r.shapes.push({...I,type:"arrow",props:{text:T,bend:sue(_,P,k),dash:Zg(_),size:qg[_.strokeWidth]??"m",color:Ku[_.strokeColor]??"black",start:{x:P[0],y:P[1]},end:{x:k[0],y:k[1]},arrowheadEnd:zA[_.endArrowhead]??"none",arrowheadStart:zA[_.startArrowhead]??"none"}}),N&&r.bindings.push({id:Ll(),typeName:"binding",type:"arrow",fromId:C,toId:N,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),O&&r.bindings.push({id:Ll(),typeName:"binding",type:"arrow",fromId:C,toId:O,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:T,scale:P}=Zde(_.fontSize);r.shapes.push({...I,type:"text",props:{size:T,scale:P,font:Jde[_.fontFamily]??"draw",color:Ku[_.strokeColor]??"black",text:_.text,textAlign:nue[_.textAlign]}});break}case"image":{const T=i[_.fileId];if(!T)break;const P=kl.createId();r.assets.push({id:P,typeName:"asset",type:"image",props:{w:_.width,h:_.height,fileSize:T.size,name:_.id??"Untitled",isAnimated:!1,mimeType:T.mimeType,src:T.dataURL},meta:{}}),r.shapes.push({...I,type:"image",props:{w:_.width,h:_.height,assetId:P}})}}p=Vi(p)}const f=n??(t.inputs.shiftKey?t.inputs.currentPagePoint:void 0);t.mark("paste"),t.putContentOntoCurrentPage(r,{point:f,select:!1,preserveIds:!0});for(const _ of o.values())if(_.length>1){t.groupShapes(_);const C=t.getShape(_[0]);C!=null&&C.parentId&&Ps(C.parentId)&&u.push(C.parentId)}for(const[_,C]of l)t.select(_),t.rotateShapesBy([_],C);const g=Re(u.map(_=>t.getShape(_))),y=de.Common(g.map(_=>t.getShapePageBounds(_))),x=t.getViewportPageBounds().center;t.updateShapes(g.map(_=>{const C={x:(_.x??0)-(y.x+y.w/2),y:(_.y??0)-(y.y+y.h/2)};return{id:_.id,type:_.type,x:x.x+C.x,y:x.y+C.y}})),t.setSelectedShapes(u)}const Xde=t=>{const e=t/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},qg={1:"s",2:"m",3:"l",4:"xl"},qde={16:"s",20:"m",28:"l",36:"xl"};function Zde(t){const e=qde[t];return e?{size:e,scale:1}:t<16?{size:"s",scale:t/16}:t>36?{size:"xl",scale:t/36}:{size:"m",scale:1}}const Jde={1:"draw",2:"sans",3:"mono"},Ku={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},Qde={solid:"draw",dashed:"dashed",dotted:"dotted"},eue={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},tue={left:"start",center:"middle",right:"end"},nue={left:"start",center:"middle",right:"end"},zA={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function sue(t,e,n){let s=0;if(t.points.length>2){const i=new E(e[0],e[1]),r=new E(n[0],n[1]),o=new E(t.points[1][0],t.points[1][1]),l=E.Sub(r,i),c=E.Per(l),d=E.Med(r,i),u=E.Sub(d,c),h=E.Add(d,c),p=E.NearestPointOnLineSegment(u,h,o,!1);s=E.Dist(p,d),E.Clockwise(p,r,d)&&(s*=-1)}return s}const Zg=t=>{let e=Qde[t.strokeStyle]??"draw";return e==="draw"&&t.roughness===0&&(e="solid"),e},iue=t=>t.backgroundColor==="transparent"?"none":eue[t.fillStyle]??"solid";async function rue(t,e,n,s){const r=(await Promise.all(e.map(async o=>await(await Ur(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));t.mark("paste"),await t.putExternalContent({type:"files",files:r,point:n,ignoreParent:!1,sources:s}),e.forEach(o=>URL.revokeObjectURL(o))}function oue(t,e,n){const s=t.getSelectionPageBounds();t.mark("paste"),t.putContentOntoCurrentPage(e,{point:n,select:!0});const i=t.getSelectionPageBounds();s&&i&&(s!=null&&s.collides(i))&&(t.updateInstanceState({isChangingStyle:!0}),t.timers.setTimeout(()=>{t.updateInstanceState({isChangingStyle:!1})},150))}async function SC(t,e,n,s){return t.mark("paste"),await t.putExternalContent({type:"url",point:n,url:e,sources:s})}function aue(t){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=t.trim(),e.body.textContent||e.body.innerText||""}const lue=t=>{try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},cue=t=>{const e=t.split(/[\n\s]/);for(const n of e)try{const s=new URL(n);if(!(s.protocol==="http:"||s.protocol==="https:"))return}catch{return}return e5(e)},due=t=>/^<svg/.test(t),uue=["input","select","textarea"];function kw(t){const{activeElement:e}=document;return t.getIsMenuOpen()||e&&(e.getAttribute("contenteditable")||uue.indexOf(e.tagName.toLowerCase())>-1)}const hue=t=>t.types.find(e=>e.match(/^image\//)),jw=(t,e,n,s)=>{const i=cue(e);if(i)for(const r of i)SC(t,r,n);else lue(e)?SC(t,e,n):due(e)?(t.mark("paste"),t.putExternalContent({type:"svg-text",text:e,point:n,sources:s})):(t.mark("paste"),t.putExternalContent({type:"text",text:e,point:n,sources:s}))},pue=async(t,e,n)=>{if(t.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const s=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{s.push({type:"file",source:new Promise(r=>r(i.getAsFile()))});break}case"string":{i.type==="text/html"?s.push({type:"html",source:new Promise(r=>i.getAsString(r))}):i.type==="text/plain"?s.push({type:"text",source:new Promise(r=>i.getAsString(r))}):s.push({type:i.type,source:new Promise(r=>i.getAsString(r))});break}}Z3(t,s,n)},q3=async(t,e,n)=>{const s=[];for(const i of e){if(hue(i))for(const r of i.types)r.match(/^image\//)&&s.push({type:"blob",source:i.getType(r)});i.types.includes("text/html")&&s.push({type:"html",source:(async()=>{const r=await i.getType("text/html");return await Dl.blobToText(r)})()}),i.types.includes("text/uri-list")&&s.push({type:"url",source:(async()=>{const r=await i.getType("text/uri-list");return await Dl.blobToText(r)})()}),i.types.includes("text/plain")&&s.push({type:"text",source:(async()=>{const r=await i.getType("text/plain");return await Dl.blobToText(r)})()})}return await Z3(t,s,n)};async function Z3(t,e,n){const s=e.filter(r=>(r.type==="file"||r.type==="blob")&&r.source!==null);if(s.length){const o=(await Promise.all(s.map(l=>l.source))).filter(Boolean).map(l=>URL.createObjectURL(l));return await rue(t,o,n)}const i=await Promise.all(e.filter(r=>r.type!=="file").map(r=>new Promise(o=>{const l=r;if(l.type==="file"){o({type:"error",data:null,reason:"unexpected file"});return}l.source.then(c=>{var u;const d=(u=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:u[1];if(d)try{const h=X3.decompressFromBase64(d);if(h===null){o({type:"error",data:h,reason:"found tldraw data comment but could not parse base64"});return}else{const p=JSON.parse(h);if(p.type!=="application/tldraw"&&o({type:"error",data:p,reason:`found tldraw data comment but JSON was of a different type: ${p.type}`}),typeof p.data=="string"){o({type:"error",data:p,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}o({type:"tldraw",data:p.data});return}}catch{o({type:"error",data:d,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(l.type==="html"){o({type:"text",data:c,subtype:"html"});return}if(l.type==="url"){o({type:"text",data:c,subtype:"url"});return}try{const h=JSON.parse(c);if(h.type==="excalidraw/clipboard"){o({type:"excalidraw",data:h});return}else{o({type:"text",data:c,subtype:"json"});return}}catch{o({type:"text",data:c,subtype:"text"});return}}o({type:"error",data:c,reason:"unhandled case"})})})));for(const r of i)if(r.type==="tldraw"){oue(t,r.data,n);return}for(const r of i)if(r.type==="excalidraw"){Yde(t,r.data,n);return}for(const r of i)if(r.type==="text"&&r.subtype==="html"){const l=new DOMParser().parseFromString(r.data,"text/html").querySelector("body");if(l&&Array.from(l.children).filter(d=>d.nodeType===1).length===1&&l.firstElementChild&&l.firstElementChild.tagName==="A"&&l.firstElementChild.hasAttribute("href")&&l.firstElementChild.getAttribute("href")!==""){const d=l.firstElementChild.getAttribute("href");jw(t,d,n,i);return}if(!i.some(d=>d.type==="text"&&d.subtype!=="html")&&r.data.trim()){jw(t,aue(r.data),n,i);return}}for(const r of i)if(r.type==="text"&&r.subtype==="url"){SC(t,r.data,n,i);return}for(const r of i)if(r.type==="text"&&r.subtype==="text"&&r.data.trim()){jw(t,r.data,n,i);return}}const wv=async t=>{var s;const e=await t.resolveAssetsInContent(t.getContentFromCurrentPage(t.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const n=X3.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const i=e.shapes.map(r=>t.isShapeOfType(r,"text")||t.isShapeOfType(r,"geo")||t.isShapeOfType(r,"arrow")?r.props.text:t.isShapeOfType(r,"bookmark")||t.isShapeOfType(r,"embed")?r.props.url:null).filter(ZJ);if((s=navigator.clipboard)!=null&&s.write){const r=new Blob([`<div data-tldraw>${n}</div>`],{type:"text/html"});let o=i.join(" ");o===""&&(o=" "),navigator.clipboard.write([new ClipboardItem({"text/html":r,"text/plain":new Blob([o],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${n}</div>`)}};function fue(){const t=K(),e=Dn(),n=S.useCallback(async function(o){t.getSelectedShapeIds().length!==0&&(await wv(t),e("copy",{source:o}))},[t,e]),s=S.useCallback(async function(o){t.getSelectedShapeIds().length!==0&&(await wv(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:o}))},[t,e]),i=S.useCallback(async function(o,l,c){t.getEditingShapeId()===null&&(Array.isArray(o)&&o[0]instanceof ClipboardItem?(q3(t,o,c),e("paste",{source:"menu"})):navigator.clipboard.read().then(d=>{i(d,l,c)}))},[t,e]);return{copy:n,cut:s,paste:i}}function gue(){const t=K(),e=Dn(),n=Z("editor.isFocused",()=>t.getInstanceState().isFocused,[t]);S.useEffect(()=>{if(!n)return;const s=async c=>{t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||kw(t)||(Ve(c),await wv(t),e("copy",{source:"kbd"}))};async function i(c){t.getSelectedShapeIds().length===0||t.getEditingShapeId()!==null||kw(t)||(Ve(c),await wv(t),t.deleteShapes(t.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let r=!1;const o=c=>{c.button===1&&(r=!0,t.timers.requestAnimationFrame(()=>{r=!1}))},l=c=>{if(r){gn(c);return}if(t.getEditingShapeId()!==null||kw(t))return;let d,u=!1;t.inputs.shiftKey&&(u=!0),t.user.getIsPasteAtCursorMode()&&(u=!u),u&&(d=t.inputs.currentPagePoint),c.clipboardData&&!t.inputs.shiftKey?pue(t,c.clipboardData,d):navigator.clipboard.read().then(h=>{Array.isArray(h)&&h[0]instanceof ClipboardItem&&q3(t,h,d)}),Ve(c),e("paste",{source:"kbd"})};return document.addEventListener("copy",s),document.addEventListener("cut",i),document.addEventListener("paste",l),document.addEventListener("pointerup",o),()=>{document.removeEventListener("copy",s),document.removeEventListener("cut",i),document.removeEventListener("paste",l),document.removeEventListener("pointerup",o)}},[t,e,n])}async function J3(t,e,n){const{type:s,quality:i,scale:r,width:o,height:l}=n;let[c,d]=await Zre(o*r,l*r);c=Math.floor(c),d=Math.floor(d);const u=c/o,h=URL.createObjectURL(new Blob([e],{type:"image/svg+xml"})),p=await new Promise(g=>{const y=Nd();y.crossOrigin="anonymous",y.onload=async()=>{t.environment.isSafari&&await new Promise(v=>t.timers.setTimeout(v,250));const x=document.createElement("canvas"),m=x.getContext("2d");x.width=c,x.height=d,m.imageSmoothingEnabled=!0,m.imageSmoothingQuality="high",m.drawImage(y,0,0,c,d),URL.revokeObjectURL(h),g(x)},y.onerror=()=>{g(null)},y.src=h});if(!p)return null;const f=await new Promise(g=>p.toBlob(y=>{(!y||Kt.throwToBlob.get())&&g(null),g(y)},"image/"+s,i));if(!f)return null;if(s==="png"){const g=new DataView(await f.arrayBuffer());return br.setPhysChunk(g,u,{type:"image/"+s})}else return f}async function Q3(t,e,n){const s=await t.getSvgString(e!=null&&e.length?e:[...t.getCurrentPageShapeIds()],{scale:1,background:t.getInstanceState().exportBackground,...n});if(!s)throw new Error("Could not construct SVG.");return s}async function bC(t,e,n,s={}){var i;switch(n){case"svg":return(i=await Q3(t,e,s))==null?void 0:i.svg;case"json":{const r=await t.resolveAssetsInContent(t.getContentFromCurrentPage(e));return JSON.stringify(r)}default:Zn(n)}}async function eU({editor:t,ids:e,format:n,opts:s={}}){switch(n){case"svg":return new Blob([await bC(t,e,"svg",s)],{type:"text/plain"});case"json":return new Blob([await bC(t,e,"json",s)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const i=await Q3(t,e,s);if(!i)throw new Error("Could not construct image.");const r=await J3(t,i.svg,{type:n,quality:1,scale:2,width:i.width,height:i.height});if(!r)throw new Error("Could not construct image.");return r}default:Zn(n)}}const mue={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function yue(t,e,n,s={}){return{blobPromise:eU({editor:t,ids:e,format:n,opts:s}),mimeType:mue[n]}}function vue(t,e,n="svg",s={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:i,mimeType:r}=yue(t,e,n,s);return window.navigator.clipboard.write([new ClipboardItem({[r]:i})]).catch(o=>(console.error(o),i.then(l=>window.navigator.clipboard.write([new ClipboardItem({[r]:l})]))))}switch(n){case"json":case"svg":return xue(async()=>bC(t,e,n,s));case"jpeg":case"png":throw new Error("Copy not supported");default:Zn(n)}}async function xue(t){var e,n;await((n=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:n.call(e,await t()))}function Sue(){const t=K(),{addToast:e}=dr(),n=$e();return S.useCallback((s,i="svg")=>{vue(t,s,i).catch(()=>{e({id:"copy-fail",severity:"warning",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[t,e,n])}async function bue(t,e,n="png",s,i={}){if(!s&&(s=`shapes at ${WA()}`,e.length===1)){const l=t.getShape(e[0]);t.isShapeOfType(l,"frame")?s=l.props.name??"frame":s=`${l.id.replace(/:/,"_")} at ${WA()}`}s+=`.${n}`;const r=await eU({editor:t,ids:e,format:n,opts:i}),o=new File([r],s,{type:r.type});wue(o)}function WA(){const t=new Date,e=String(t.getFullYear()).slice(2),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0"),i=String(t.getHours()).padStart(2,"0"),r=String(t.getMinutes()).padStart(2,"0"),o=String(t.getSeconds()).padStart(2,"0");return`${e}-${n}-${s} ${i}.${r}.${o}`}function wue(t){const e=document.createElement("a"),n=URL.createObjectURL(t);e.href=n,e.download=t.name,e.click(),URL.revokeObjectURL(n)}function _ue(){const t=K(),{addToast:e}=dr(),n=$e();return S.useCallback((s,i="png",r)=>{bue(t,s,i,r,{scale:1,background:t.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),e({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc"),severity:"error"})})},[t,e,n])}async function Cue(t,e,n){const s=Re(e.map(l=>{const c=t.getShape(l);if(!(!c||t.getShapeUtil(c.type).toSvg===void 0))return c}));if(s.length===0)return;if(s.length===1){const l=s[0];if(!l||t.isShapeOfType(l,"image"))return}const i=[];if(n!==void 0){const l=s.map(c=>({shape:c,bounds:t.getShapeMaskedPageBounds(c).clone().expandBy(n)}));for(let c=0;c<l.length;c++){const d=l[c];if(c===0){i[0]={shapes:[d.shape],bounds:d.bounds};continue}let u=!1;for(const h of i)if(h.bounds.includes(d.bounds)){h.shapes.push(d.shape),h.bounds.expand(d.bounds),u=!0;break}u||i.push({shapes:[d.shape],bounds:d.bounds})}}else{const l=de.Common(s.map(c=>t.getShapeMaskedPageBounds(c)));i.push({shapes:s,bounds:l})}const r=t.options.flattenImageBoundsPadding;for(const l of i){n!==void 0&&l.bounds.expandBy(-n);const c=await t.getSvgString(l.shapes,{padding:r});if(!(c!=null&&c.svg))continue;const d=new Blob([c.svg],{type:"image/svg+xml"}),u=await t.getAssetForExternalContent({type:"file",file:new File([d],"asset.svg",{type:"image/svg+xml"})});u&&(l.asset=u)}const o=[];return Rr(()=>{for(const l of i){const{asset:c,bounds:d,shapes:u}=l;if(!c)continue;const h=t.findCommonAncestor(u)??t.getCurrentPageId();if(!h)continue;let p="a1";for(const m of u)if(m.parentId===h){m.index>p&&(p=m.index);break}let f,g,y;if(Ps(h)){const m=t.getShape(h);if(!m)continue;const v=t.getPointInShapeSpace(m,{x:d.x,y:d.y});y=t.getShapePageTransform(h).rotation(),v.sub(new E(r,r).rot(-y)),f=v.x,g=v.y}else f=d.x-r,g=d.y-r,y=0;t.deleteShapes(u),t.createAssets([{...c,id:c.id}]);const x=it();t.createShape({id:x,type:"image",index:p,parentId:h,x:f,y:g,rotation:-y,props:{assetId:c.id,w:d.w+r*2,h:d.h+r*2}}),o.push(x)}}),o}function cS(){return K().store.props.collaboration!==void 0}function Eue(){const t=K();return Z("sync status",()=>{var e;return(e=t.store.props.collaboration)!=null&&e.status?t.store.props.collaboration.status.get():null},[t])}function Tue(){const t=K(),e=S.useRef(null),n=S.useRef(null);return S.useCallback(async function(){const i=document.createElement("div"),r=document.createElement("style"),o=(m,v)=>{m&&(m.innerHTML=""),v&&document.head.contains(v)&&document.head.removeChild(v),m&&document.body.contains(m)&&document.body.removeChild(m)};o(e.current,n.current),e.current=i,n.current=r;const l=`tl-print-surface-${Rt()}`;i.className=l,r.innerHTML=`
			.${l} {
				display: none;
			}

			.${l} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${l} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${l}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${l}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${l}__item__header {
					display: none;
				}

				.${l}__item__footer {
					display: none;
					text-align: right;
				}

				.${l}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(r),document.body.appendChild(i)},d=()=>{t.once("tick",()=>{o(i,r)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",d);function u(m,v,w){try{i.innerHTML+=`<div class="${l}__item">
        <div class="${l}__item__header">
          ${m.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${l}__item__main">
          ${w}
        </div>
        <div class="${l}__item__footer ${l}__item__footer__${v?"":"hide"}">
          ${v??""}
        </div>
      </div>`}catch(_){console.error(_)}}function h(){t.environment.isChromeForIos?(c(),window.print()):t.environment.isSafari?(c(),document.execCommand("print",!1)):window.print()}const p=t.getSelectedShapeIds(),f=t.getCurrentPageId(),g=t.getPages(),x={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(t.getSelectedShapeIds().length>0){const m=await t.getSvgString(p,x);if(m){const v=g.find(w=>w.id===f);u(`tldraw  ${v==null?void 0:v.name}`,null,m.svg),h()}}else{const m=t.getCurrentPage(),v=await t.getSvgString(t.getSortedChildIdsForParent(m.id),x);v&&(u(`tldraw  ${m.name}`,null,v.svg),h())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",d)},[t])}const tU=S.createContext(null);function Iue(t){return Object.fromEntries(t.map(e=>[e.id,e]))}function jc(t,e){if(t.getSelectedShapes().length===0)return t.getDocumentSettings().name||e}function Pue({overrides:t,children:e}){const n=K(),s=cS(),{addDialog:i,clearDialogs:r}=pc(),{clearToasts:o,addToast:l}=dr(),c=$e(),d=H3(),u=Tue(),{cut:h,copy:p,paste:f}=fue(),g=Sue(),y=_ue(),x=c("document.default-name"),m=Dn(),v=S.useMemo(()=>{function w(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function _(){return n.isIn("select")&&n.getSelectedShapeIds().length>0}const C=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(T){_()&&(w()||(m("edit-link",{source:T}),n.mark("edit-link"),i({component:Gde})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(T){m("insert-embed",{source:T}),i({component:W3})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(T){m("insert-media",{source:T}),d()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(T){m("undo",{source:T}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(T){m("redo",{source:T}),n.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(T){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(m("export-as",{format:"svg",source:T}),y(P,"svg",jc(n,x)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(T){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(m("export-as",{format:"png",source:T}),y(P,"png",jc(n,x)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(T){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(m("export-as",{format:"json",source:T}),y(P,"json",jc(n,x)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(T){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(m("export-all-as",{format:"svg",source:T}),y(Array.from(n.getCurrentPageShapeIds()),"svg",jc(n,x)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(T){const P=Array.from(n.getCurrentPageShapeIds().values());P.length!==0&&(m("export-all-as",{format:"png",source:T}),y(P,"png",jc(n,x)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(T){const P=Array.from(n.getCurrentPageShapeIds().values());P.length!==0&&(m("export-all-as",{format:"json",source:T}),y(P,"json",jc(n,x)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(T){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(m("copy-as",{format:"svg",source:T}),g(P,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(T){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(m("copy-as",{format:"png",source:T}),g(P,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(T){let P=n.getSelectedShapeIds();P.length===0&&(P=Array.from(n.getCurrentPageShapeIds().values())),P.length!==0&&(m("copy-as",{format:"json",source:T}),g(P,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(T){if(!_()||w())return;m("toggle-auto-size",{source:T}),n.mark("toggling auto size");const P=n.getSelectedShapes().filter(k=>n.isShapeOfType(k,"text")&&k.props.autoSize===!1);n.updateShapes(P.map(k=>({id:k.id,type:k.type,props:{...k.props,w:8,autoSize:!0}}))),pt(n,P.map(k=>k.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(T){m("open-embed-link",{source:T});const P=n.getSelectedShapeIds(),k="No embed shapes selected";if(P.length!==1){console.error(k);return}const N=n.getShape(P[0]);if(!N||!n.isShapeOfType(N,"embed")){console.error(k);return}gre(N.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(T){var P,k;if(((P=n.root.getCurrent())==null?void 0:P.id)!=="zoom"&&(m("zoom-tool",{source:T}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){const N=n.root.getCurrent();N&&((k=N.getCurrent())==null?void 0:k.id)==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:N.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(T){_()&&(w()||n.run(()=>{m("convert-to-bookmark",{source:T});const P=n.getSelectedShapes(),k=[],N=[];for(const O of P){if(!O||!n.isShapeOfType(O,"embed")||!O.props.url)continue;const R=new E(O.x,O.y);R.rot(-O.rotation),R.add(new E(O.props.w/2-300/2,O.props.h/2-320/2)),R.rot(O.rotation);const j={id:it(),type:"bookmark",rotation:O.rotation,x:R.x,y:R.y,opacity:1,props:{url:O.props.url}};k.push(j),N.push(O.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(N),n.createShapes(k)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(T){_()&&(w()||(m("convert-to-embed",{source:T}),n.run(()=>{const P=n.getSelectedShapeIds(),k=Re(P.map(R=>n.getShape(R))),N=[],O=[];for(const R of k){if(!n.isShapeOfType(R,"bookmark"))continue;const{url:j}=R.props,A=ba(R.props.url);if(!A||!A.definition)continue;const{width:B,height:L}=A.definition,$=new E(R.x,R.y);$.rot(-R.rotation),$.add(new E(R.props.w/2-B/2,R.props.h/2-L/2)),$.rot(R.rotation);const M={id:it(),type:"embed",x:$.x,y:$.y,rotation:R.rotation,props:{url:j,w:B,h:L}};N.push(M),O.push(R.id)}n.mark("convert shapes to embed"),n.deleteShapes(O),n.createShapes(N)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(T){if(!_()||w())return;m("duplicate-shapes",{source:T});const P=n.getInstanceState();let k,N;if(P.duplicateProps)k=P.duplicateProps.shapeIds,N=P.duplicateProps.offset;else{k=n.getSelectedShapeIds();const O=de.Common(Re(k.map(R=>n.getShapePageBounds(R))));N=n.getCameraOptions().isLocked?{x:n.options.adjacentShapeMargin,y:n.options.adjacentShapeMargin}:{x:O.width+n.options.adjacentShapeMargin,y:0}}n.mark("duplicate shapes"),n.duplicateShapes(k,N),P.duplicateProps&&n.updateInstanceState({duplicateProps:{...P.duplicateProps,shapeIds:n.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(T){_()&&(w()||(m("ungroup-shapes",{source:T}),n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(T){if(!_()||w())return;m("group-shapes",{source:T});const P=n.getOnlySelectedShape();P&&n.isShapeOfType(P,"group")?(n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.mark("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(T){if(!_())return;m("remove-frame",{source:T});const P=n.getSelectedShapes();P.length>0&&P.every(k=>n.isShapeOfType(k,"frame"))&&(n.mark("remove-frame"),zde(n,P.map(k=>k.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(T){if(!_())return;m("fit-frame-to-content",{source:T});const P=n.getOnlySelectedShape();P&&n.isShapeOfType(P,"frame")&&(n.mark("fit-frame-to-content"),Hde(n,P.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(T){if(!_()||w())return;m("align-shapes",{operation:"left",source:T}),n.mark("align left");const P=n.getSelectedShapeIds();n.alignShapes(P,"left"),pt(n,P)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(T){if(!_()||w())return;m("align-shapes",{operation:"center-horizontal",source:T}),n.mark("align center horizontal");const P=n.getSelectedShapeIds();n.alignShapes(P,"center-horizontal"),pt(n,P)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(T){if(!_()||w())return;m("align-shapes",{operation:"right",source:T}),n.mark("align right");const P=n.getSelectedShapeIds();n.alignShapes(P,"right"),pt(n,P)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(T){if(!_()||w())return;m("align-shapes",{operation:"center-vertical",source:T}),n.mark("align center vertical");const P=n.getSelectedShapeIds();n.alignShapes(P,"center-vertical"),pt(n,P)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(T){if(!_()||w())return;m("align-shapes",{operation:"top",source:T}),n.mark("align top");const P=n.getSelectedShapeIds();n.alignShapes(P,"top"),pt(n,P)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(T){if(!_()||w())return;m("align-shapes",{operation:"bottom",source:T}),n.mark("align bottom");const P=n.getSelectedShapeIds();n.alignShapes(P,"bottom"),pt(n,P)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(T){if(!_()||w())return;m("distribute-shapes",{operation:"horizontal",source:T}),n.mark("distribute horizontal");const P=n.getSelectedShapeIds();n.distributeShapes(P,"horizontal"),pt(n,P)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(T){if(!_()||w())return;m("distribute-shapes",{operation:"vertical",source:T}),n.mark("distribute vertical");const P=n.getSelectedShapeIds();n.distributeShapes(P,"vertical"),pt(n,P)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(T){if(!_()||w())return;m("stretch-shapes",{operation:"horizontal",source:T}),n.mark("stretch horizontal");const P=n.getSelectedShapeIds();n.stretchShapes(P,"horizontal"),pt(n,P)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(T){if(!_()||w())return;m("stretch-shapes",{operation:"vertical",source:T}),n.mark("stretch vertical");const P=n.getSelectedShapeIds();n.stretchShapes(P,"vertical"),pt(n,P)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(T){if(!_()||w())return;m("flip-shapes",{operation:"horizontal",source:T}),n.mark("flip horizontal");const P=n.getSelectedShapeIds();n.flipShapes(P,"horizontal"),pt(n,P)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(T){if(!_()||w())return;m("flip-shapes",{operation:"vertical",source:T}),n.mark("flip vertical");const P=n.getSelectedShapeIds();n.flipShapes(P,"vertical"),pt(n,P)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(T){if(!_()||w())return;m("pack-shapes",{source:T}),n.mark("pack");const P=n.getSelectedShapeIds();n.packShapes(P,n.options.adjacentShapeMargin),pt(n,P)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(T){if(!_()||w())return;m("stack-shapes",{operation:"vertical",source:T}),n.mark("stack-vertical");const P=n.getSelectedShapeIds();n.stackShapes(P,"vertical",16),pt(n,P)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(T){if(!_()||w())return;m("stack-shapes",{operation:"horizontal",source:T}),n.mark("stack-horizontal");const P=n.getSelectedShapeIds();n.stackShapes(P,"horizontal",16),pt(n,P)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(T){_()&&(w()||(m("reorder-shapes",{operation:"toFront",source:T}),n.mark("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(T){_()&&(w()||(m("reorder-shapes",{operation:"forward",source:T}),n.mark("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(T){_()&&(w()||(m("reorder-shapes",{operation:"backward",source:T}),n.mark("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(T){_()&&(w()||(m("reorder-shapes",{operation:"toBack",source:T}),n.mark("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(T){_()&&(w()||(n.mark("cut"),h(T)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(T){_()&&(w()||p(T))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(T){var P;(P=navigator.clipboard)==null||P.read().then(k=>{f(k,T,T==="context-menu"?n.inputs.currentPagePoint:void 0)}).catch(()=>{l({title:c("action.paste-error-title"),description:c("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(T){n.run(()=>{w()||(m("select-all-shapes",{source:T}),n.mark("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(T){_()&&(w()||(m("select-none-shapes",{source:T}),n.mark("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",onSelect(T){_()&&(w()||(m("delete-shapes",{source:T}),n.mark("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(T){if(!_()||w())return;m("rotate-cw",{source:T}),n.mark("rotate-cw");const P=n.getSelectionRotation()%(vt/2),k=Ra(P,0)||Ra(P,vt/2),N=n.getSelectedShapeIds();n.rotateShapesBy(N,vt/2-(k?0:P)),pt(n,N)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(T){if(!_()||w())return;m("rotate-ccw",{source:T}),n.mark("rotate-ccw");const P=n.getSelectionRotation()%(vt/2),k=Ra(P,0),N=n.getSelectedShapeIds();n.rotateShapesBy(N,k?-(vt/2):-P),pt(n,N)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(T){m("zoom-in",{source:T}),n.zoomIn(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(T){m("zoom-out",{source:T}),n.zoomOut(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(T){m("reset-zoom",{source:T}),n.resetZoom(void 0,{animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(T){m("zoom-to-fit",{source:T}),n.zoomToFit({animation:{duration:n.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(T){_()&&(w()||(m("zoom-to-selection",{source:T}),n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(T){m("toggle-snap-mode",{source:T}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(T){const P=n.user.getIsDarkMode()?"light":"dark";m("color-scheme",{source:T,value:P}),n.user.updateUserPreferences({colorScheme:P})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(T){m("toggle-wrap-mode",{source:T}),n.user.updateUserPreferences({isWrapMode:!n.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(T){m("toggle-dynamic-size-mode",{source:T}),n.user.updateUserPreferences({isDynamicSizeMode:!n.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(T){m("toggle-paste-at-cursor",{source:T}),n.user.updateUserPreferences({isPasteAtCursorMode:!n.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(T){m("toggle-reduce-motion",{source:T}),n.user.updateUserPreferences({animationSpeed:n.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(T){m("toggle-edge-scrolling",{source:T}),n.user.updateUserPreferences({edgeScrollSpeed:n.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(T){m("toggle-transparent",{source:T}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(T){m("toggle-tool-lock",{source:T}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(T){m("unlock-all",{source:T});const P=[];for(const k of n.getCurrentPageShapes())k.isLocked&&P.push({id:k.id,type:k.type,isLocked:!1});P.length>0&&n.updateShapes(P)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(T){n.timers.requestAnimationFrame(()=>{n.run(()=>{m("toggle-focus-mode",{source:T}),r(),o(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(T){m("toggle-grid-mode",{source:T}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(T){m("toggle-debug-mode",{source:T}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(T){m("print",{source:T}),u()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(T){m("exit-pen-mode",{source:T}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(T){m("stop-following",{source:T}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(T){m("zoom-to-content",{source:T});const P=n.getSelectionPageBounds()??n.getCurrentPageBounds();P&&n.zoomToBounds(P,{targetZoom:Math.min(1,n.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(T){n.mark("locking"),m("toggle-lock",{source:T}),n.toggleLock(n.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(T){const P=No.createId(),k=n.getSelectedShapeIds();n.run(()=>{n.mark("move_shapes_to_page"),n.createPage({name:c("page-menu.new-page-initial-name"),id:P}),n.moveShapesToPage(k,P)}),m("move-to-new-page",{source:T})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(T){const P=ai;n.run(()=>{n.mark("change-color"),n.isIn("select")&&n.setStyleForSelectedShapes(P,"white"),n.setStyleForNextShapes(P,"white")}),m("set-style",{source:T,id:P.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(T){const P=Kl;n.run(()=>{n.mark("change-fill"),n.isIn("select")&&n.setStyleForSelectedShapes(P,"fill"),n.setStyleForNextShapes(P,"fill")}),m("set-style",{source:T,id:P.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async T=>{const P=n.getSelectedShapeIds();if(P.length===0)return;n.mark("flattening to image"),m("flatten-to-image",{source:T});const k=await Cue(n,P,n.options.flattenImageBoundsExpand);k!=null&&k.length&&n.setSelectedShapes(k)}}];s&&C.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(T){m("open-cursor-chat",{source:T}),!n.getInstanceState().isCoarsePointer&&n.timers.requestAnimationFrame(()=>{n.updateInstanceState({isChatting:!0})})}});const I=Iue(C);return t?t(n,I,void 0):I},[n,m,t,i,l,d,y,g,h,p,f,r,o,u,c,x,s]);return a.jsx(tU.Provider,{value:v,children:e})}function xe(){const t=S.useContext(tU);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function kp(t,e){return t?typeof t=="string"?t:e?t[e]??t.default:void 0:void 0}const kue=["top","right","bottom","left"],Ga=Math.min,Zs=Math.max,_v=Math.round,Jg=Math.floor,Lr=t=>({x:t,y:t}),jue={left:"right",right:"left",bottom:"top",top:"bottom"},Nue={start:"end",end:"start"};function wC(t,e,n){return Zs(t,Ga(e,n))}function Mo(t,e){return typeof t=="function"?t(e):t}function Oo(t){return t.split("-")[0]}function lu(t){return t.split("-")[1]}function j1(t){return t==="x"?"y":"x"}function N1(t){return t==="y"?"height":"width"}const Aue=new Set(["top","bottom"]);function Pr(t){return Aue.has(Oo(t))?"y":"x"}function A1(t){return j1(Pr(t))}function Rue(t,e,n){n===void 0&&(n=!1);const s=lu(t),i=A1(t),r=N1(i);let o=i==="x"?s===(n?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=Cv(o)),[o,Cv(o)]}function Mue(t){const e=Cv(t);return[_C(t),e,_C(e)]}function _C(t){return t.replace(/start|end/g,e=>Nue[e])}const HA=["left","right"],GA=["right","left"],Oue=["top","bottom"],Due=["bottom","top"];function Lue(t,e,n){switch(t){case"top":case"bottom":return n?e?GA:HA:e?HA:GA;case"left":case"right":return e?Oue:Due;default:return[]}}function Fue(t,e,n,s){const i=lu(t);let r=Lue(Oo(t),n==="start",s);return i&&(r=r.map(o=>o+"-"+i),e&&(r=r.concat(r.map(_C)))),r}function Cv(t){return t.replace(/left|right|bottom|top/g,e=>jue[e])}function Bue(t){return{top:0,right:0,bottom:0,left:0,...t}}function nU(t){return typeof t!="number"?Bue(t):{top:t,right:t,bottom:t,left:t}}function Ev(t){const{x:e,y:n,width:s,height:i}=t;return{width:s,height:i,top:n,left:e,right:e+s,bottom:n+i,x:e,y:n}}function VA(t,e,n){let{reference:s,floating:i}=t;const r=Pr(e),o=A1(e),l=N1(o),c=Oo(e),d=r==="y",u=s.x+s.width/2-i.width/2,h=s.y+s.height/2-i.height/2,p=s[l]/2-i[l]/2;let f;switch(c){case"top":f={x:u,y:s.y-i.height};break;case"bottom":f={x:u,y:s.y+s.height};break;case"right":f={x:s.x+s.width,y:h};break;case"left":f={x:s.x-i.width,y:h};break;default:f={x:s.x,y:s.y}}switch(lu(e)){case"start":f[o]-=p*(n&&d?-1:1);break;case"end":f[o]+=p*(n&&d?-1:1);break}return f}async function Uue(t,e){var n;e===void 0&&(e={});const{x:s,y:i,platform:r,rects:o,elements:l,strategy:c}=t,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:p=!1,padding:f=0}=Mo(e,t),g=nU(f),x=l[p?h==="floating"?"reference":"floating":h],m=Ev(await r.getClippingRect({element:(n=await(r.isElement==null?void 0:r.isElement(x)))==null||n?x:x.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(l.floating)),boundary:d,rootBoundary:u,strategy:c})),v=h==="floating"?{x:s,y:i,width:o.floating.width,height:o.floating.height}:o.reference,w=await(r.getOffsetParent==null?void 0:r.getOffsetParent(l.floating)),_=await(r.isElement==null?void 0:r.isElement(w))?await(r.getScale==null?void 0:r.getScale(w))||{x:1,y:1}:{x:1,y:1},C=Ev(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:v,offsetParent:w,strategy:c}):v);return{top:(m.top-C.top+g.top)/_.y,bottom:(C.bottom-m.bottom+g.bottom)/_.y,left:(m.left-C.left+g.left)/_.x,right:(C.right-m.right+g.right)/_.x}}const $ue=async(t,e,n)=>{const{placement:s="bottom",strategy:i="absolute",middleware:r=[],platform:o}=n,l=r.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let d=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:u,y:h}=VA(d,s,c),p=s,f={},g=0;for(let x=0;x<l.length;x++){var y;const{name:m,fn:v}=l[x],{x:w,y:_,data:C,reset:I}=await v({x:u,y:h,initialPlacement:s,placement:p,strategy:i,middlewareData:f,rects:d,platform:{...o,detectOverflow:(y=o.detectOverflow)!=null?y:Uue},elements:{reference:t,floating:e}});u=w??u,h=_??h,f={...f,[m]:{...f[m],...C}},I&&g<=50&&(g++,typeof I=="object"&&(I.placement&&(p=I.placement),I.rects&&(d=I.rects===!0?await o.getElementRects({reference:t,floating:e,strategy:i}):I.rects),{x:u,y:h}=VA(d,p,c)),x=-1)}return{x:u,y:h,placement:p,strategy:i,middlewareData:f}},zue=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:s,placement:i,rects:r,platform:o,elements:l,middlewareData:c}=e,{element:d,padding:u=0}=Mo(t,e)||{};if(d==null)return{};const h=nU(u),p={x:n,y:s},f=A1(i),g=N1(f),y=await o.getDimensions(d),x=f==="y",m=x?"top":"left",v=x?"bottom":"right",w=x?"clientHeight":"clientWidth",_=r.reference[g]+r.reference[f]-p[f]-r.floating[g],C=p[f]-r.reference[f],I=await(o.getOffsetParent==null?void 0:o.getOffsetParent(d));let T=I?I[w]:0;(!T||!await(o.isElement==null?void 0:o.isElement(I)))&&(T=l.floating[w]||r.floating[g]);const P=_/2-C/2,k=T/2-y[g]/2-1,N=Ga(h[m],k),O=Ga(h[v],k),R=N,j=T-y[g]-O,A=T/2-y[g]/2+P,B=wC(R,A,j),L=!c.arrow&&lu(i)!=null&&A!==B&&r.reference[g]/2-(A<R?N:O)-y[g]/2<0,$=L?A<R?A-R:A-j:0;return{[f]:p[f]+$,data:{[f]:B,centerOffset:A-B-$,...L&&{alignmentOffset:$}},reset:L}}}),Wue=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n,s;const{placement:i,middlewareData:r,rects:o,initialPlacement:l,platform:c,elements:d}=e,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:p,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:y=!0,...x}=Mo(t,e);if((n=r.arrow)!=null&&n.alignmentOffset)return{};const m=Oo(i),v=Pr(l),w=Oo(l)===l,_=await(c.isRTL==null?void 0:c.isRTL(d.floating)),C=p||(w||!y?[Cv(l)]:Mue(l)),I=g!=="none";!p&&I&&C.push(...Fue(l,y,g,_));const T=[l,...C],P=await c.detectOverflow(e,x),k=[];let N=((s=r.flip)==null?void 0:s.overflows)||[];if(u&&k.push(P[m]),h){const A=Rue(i,o,_);k.push(P[A[0]],P[A[1]])}if(N=[...N,{placement:i,overflows:k}],!k.every(A=>A<=0)){var O,R;const A=(((O=r.flip)==null?void 0:O.index)||0)+1,B=T[A];if(B&&(!(h==="alignment"?v!==Pr(B):!1)||N.every(M=>Pr(M.placement)===v?M.overflows[0]>0:!0)))return{data:{index:A,overflows:N},reset:{placement:B}};let L=(R=N.filter($=>$.overflows[0]<=0).sort(($,M)=>$.overflows[1]-M.overflows[1])[0])==null?void 0:R.placement;if(!L)switch(f){case"bestFit":{var j;const $=(j=N.filter(M=>{if(I){const D=Pr(M.placement);return D===v||D==="y"}return!0}).map(M=>[M.placement,M.overflows.filter(D=>D>0).reduce((D,U)=>D+U,0)]).sort((M,D)=>M[1]-D[1])[0])==null?void 0:j[0];$&&(L=$);break}case"initialPlacement":L=l;break}if(i!==L)return{reset:{placement:L}}}return{}}}};function KA(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function YA(t){return kue.some(e=>t[e]>=0)}const Hue=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n,platform:s}=e,{strategy:i="referenceHidden",...r}=Mo(t,e);switch(i){case"referenceHidden":{const o=await s.detectOverflow(e,{...r,elementContext:"reference"}),l=KA(o,n.reference);return{data:{referenceHiddenOffsets:l,referenceHidden:YA(l)}}}case"escaped":{const o=await s.detectOverflow(e,{...r,altBoundary:!0}),l=KA(o,n.floating);return{data:{escapedOffsets:l,escaped:YA(l)}}}default:return{}}}}},sU=new Set(["left","top"]);async function Gue(t,e){const{placement:n,platform:s,elements:i}=t,r=await(s.isRTL==null?void 0:s.isRTL(i.floating)),o=Oo(n),l=lu(n),c=Pr(n)==="y",d=sU.has(o)?-1:1,u=r&&c?-1:1,h=Mo(e,t);let{mainAxis:p,crossAxis:f,alignmentAxis:g}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return l&&typeof g=="number"&&(f=l==="end"?g*-1:g),c?{x:f*u,y:p*d}:{x:p*d,y:f*u}}const Vue=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){var n,s;const{x:i,y:r,placement:o,middlewareData:l}=e,c=await Gue(e,t);return o===((n=l.offset)==null?void 0:n.placement)&&(s=l.arrow)!=null&&s.alignmentOffset?{}:{x:i+c.x,y:r+c.y,data:{...c,placement:o}}}}},Kue=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:s,placement:i,platform:r}=e,{mainAxis:o=!0,crossAxis:l=!1,limiter:c={fn:m=>{let{x:v,y:w}=m;return{x:v,y:w}}},...d}=Mo(t,e),u={x:n,y:s},h=await r.detectOverflow(e,d),p=Pr(Oo(i)),f=j1(p);let g=u[f],y=u[p];if(o){const m=f==="y"?"top":"left",v=f==="y"?"bottom":"right",w=g+h[m],_=g-h[v];g=wC(w,g,_)}if(l){const m=p==="y"?"top":"left",v=p==="y"?"bottom":"right",w=y+h[m],_=y-h[v];y=wC(w,y,_)}const x=c.fn({...e,[f]:g,[p]:y});return{...x,data:{x:x.x-n,y:x.y-s,enabled:{[f]:o,[p]:l}}}}}},Yue=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:s,placement:i,rects:r,middlewareData:o}=e,{offset:l=0,mainAxis:c=!0,crossAxis:d=!0}=Mo(t,e),u={x:n,y:s},h=Pr(i),p=j1(h);let f=u[p],g=u[h];const y=Mo(l,e),x=typeof y=="number"?{mainAxis:y,crossAxis:0}:{mainAxis:0,crossAxis:0,...y};if(c){const w=p==="y"?"height":"width",_=r.reference[p]-r.floating[w]+x.mainAxis,C=r.reference[p]+r.reference[w]-x.mainAxis;f<_?f=_:f>C&&(f=C)}if(d){var m,v;const w=p==="y"?"width":"height",_=sU.has(Oo(i)),C=r.reference[h]-r.floating[w]+(_&&((m=o.offset)==null?void 0:m[h])||0)+(_?0:x.crossAxis),I=r.reference[h]+r.reference[w]+(_?0:((v=o.offset)==null?void 0:v[h])||0)-(_?x.crossAxis:0);g<C?g=C:g>I&&(g=I)}return{[p]:f,[h]:g}}}},Xue=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){var n,s;const{placement:i,rects:r,platform:o,elements:l}=e,{apply:c=()=>{},...d}=Mo(t,e),u=await o.detectOverflow(e,d),h=Oo(i),p=lu(i),f=Pr(i)==="y",{width:g,height:y}=r.floating;let x,m;h==="top"||h==="bottom"?(x=h,m=p===(await(o.isRTL==null?void 0:o.isRTL(l.floating))?"start":"end")?"left":"right"):(m=h,x=p==="end"?"top":"bottom");const v=y-u.top-u.bottom,w=g-u.left-u.right,_=Ga(y-u[x],v),C=Ga(g-u[m],w),I=!e.middlewareData.shift;let T=_,P=C;if((n=e.middlewareData.shift)!=null&&n.enabled.x&&(P=w),(s=e.middlewareData.shift)!=null&&s.enabled.y&&(T=v),I&&!p){const N=Zs(u.left,0),O=Zs(u.right,0),R=Zs(u.top,0),j=Zs(u.bottom,0);f?P=g-2*(N!==0||O!==0?N+O:Zs(u.left,u.right)):T=y-2*(R!==0||j!==0?R+j:Zs(u.top,u.bottom))}await c({...e,availableWidth:P,availableHeight:T});const k=await o.getDimensions(l.floating);return g!==k.width||y!==k.height?{reset:{rects:!0}}:{}}}};function dS(){return typeof window<"u"}function cu(t){return iU(t)?(t.nodeName||"").toLowerCase():"#document"}function ii(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function Xr(t){var e;return(e=(iU(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function iU(t){return dS()?t instanceof Node||t instanceof ii(t).Node:!1}function ir(t){return dS()?t instanceof Element||t instanceof ii(t).Element:!1}function Gr(t){return dS()?t instanceof HTMLElement||t instanceof ii(t).HTMLElement:!1}function XA(t){return!dS()||typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof ii(t).ShadowRoot}const que=new Set(["inline","contents"]);function Ef(t){const{overflow:e,overflowX:n,overflowY:s,display:i}=rr(t);return/auto|scroll|overlay|hidden|clip/.test(e+s+n)&&!que.has(i)}const Zue=new Set(["table","td","th"]);function Jue(t){return Zue.has(cu(t))}const Que=[":popover-open",":modal"];function uS(t){return Que.some(e=>{try{return t.matches(e)}catch{return!1}})}const ehe=["transform","translate","scale","rotate","perspective"],the=["transform","translate","scale","rotate","perspective","filter"],nhe=["paint","layout","strict","content"];function R1(t){const e=M1(),n=ir(t)?rr(t):t;return ehe.some(s=>n[s]?n[s]!=="none":!1)||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||the.some(s=>(n.willChange||"").includes(s))||nhe.some(s=>(n.contain||"").includes(s))}function she(t){let e=Va(t);for(;Gr(e)&&!Ud(e);){if(R1(e))return e;if(uS(e))return null;e=Va(e)}return null}function M1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const ihe=new Set(["html","body","#document"]);function Ud(t){return ihe.has(cu(t))}function rr(t){return ii(t).getComputedStyle(t)}function hS(t){return ir(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.scrollX,scrollTop:t.scrollY}}function Va(t){if(cu(t)==="html")return t;const e=t.assignedSlot||t.parentNode||XA(t)&&t.host||Xr(t);return XA(e)?e.host:e}function rU(t){const e=Va(t);return Ud(e)?t.ownerDocument?t.ownerDocument.body:t.body:Gr(e)&&Ef(e)?e:rU(e)}function jp(t,e,n){var s;e===void 0&&(e=[]),n===void 0&&(n=!0);const i=rU(t),r=i===((s=t.ownerDocument)==null?void 0:s.body),o=ii(i);if(r){const l=CC(o);return e.concat(o,o.visualViewport||[],Ef(i)?i:[],l&&n?jp(l):[])}return e.concat(i,jp(i,[],n))}function CC(t){return t.parent&&Object.getPrototypeOf(t.parent)?t.frameElement:null}function oU(t){const e=rr(t);let n=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const i=Gr(t),r=i?t.offsetWidth:n,o=i?t.offsetHeight:s,l=_v(n)!==r||_v(s)!==o;return l&&(n=r,s=o),{width:n,height:s,$:l}}function O1(t){return ir(t)?t:t.contextElement}function vd(t){const e=O1(t);if(!Gr(e))return Lr(1);const n=e.getBoundingClientRect(),{width:s,height:i,$:r}=oU(e);let o=(r?_v(n.width):n.width)/s,l=(r?_v(n.height):n.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!l||!Number.isFinite(l))&&(l=1),{x:o,y:l}}const rhe=Lr(0);function aU(t){const e=ii(t);return!M1()||!e.visualViewport?rhe:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function ohe(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==ii(t)?!1:e}function Jl(t,e,n,s){e===void 0&&(e=!1),n===void 0&&(n=!1);const i=t.getBoundingClientRect(),r=O1(t);let o=Lr(1);e&&(s?ir(s)&&(o=vd(s)):o=vd(t));const l=ohe(r,n,s)?aU(r):Lr(0);let c=(i.left+l.x)/o.x,d=(i.top+l.y)/o.y,u=i.width/o.x,h=i.height/o.y;if(r){const p=ii(r),f=s&&ir(s)?ii(s):s;let g=p,y=CC(g);for(;y&&s&&f!==g;){const x=vd(y),m=y.getBoundingClientRect(),v=rr(y),w=m.left+(y.clientLeft+parseFloat(v.paddingLeft))*x.x,_=m.top+(y.clientTop+parseFloat(v.paddingTop))*x.y;c*=x.x,d*=x.y,u*=x.x,h*=x.y,c+=w,d+=_,g=ii(y),y=CC(g)}}return Ev({width:u,height:h,x:c,y:d})}function pS(t,e){const n=hS(t).scrollLeft;return e?e.left+n:Jl(Xr(t)).left+n}function lU(t,e){const n=t.getBoundingClientRect(),s=n.left+e.scrollLeft-pS(t,n),i=n.top+e.scrollTop;return{x:s,y:i}}function ahe(t){let{elements:e,rect:n,offsetParent:s,strategy:i}=t;const r=i==="fixed",o=Xr(s),l=e?uS(e.floating):!1;if(s===o||l&&r)return n;let c={scrollLeft:0,scrollTop:0},d=Lr(1);const u=Lr(0),h=Gr(s);if((h||!h&&!r)&&((cu(s)!=="body"||Ef(o))&&(c=hS(s)),Gr(s))){const f=Jl(s);d=vd(s),u.x=f.x+s.clientLeft,u.y=f.y+s.clientTop}const p=o&&!h&&!r?lU(o,c):Lr(0);return{width:n.width*d.x,height:n.height*d.y,x:n.x*d.x-c.scrollLeft*d.x+u.x+p.x,y:n.y*d.y-c.scrollTop*d.y+u.y+p.y}}function lhe(t){return Array.from(t.getClientRects())}function che(t){const e=Xr(t),n=hS(t),s=t.ownerDocument.body,i=Zs(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),r=Zs(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let o=-n.scrollLeft+pS(t);const l=-n.scrollTop;return rr(s).direction==="rtl"&&(o+=Zs(e.clientWidth,s.clientWidth)-i),{width:i,height:r,x:o,y:l}}const qA=25;function dhe(t,e){const n=ii(t),s=Xr(t),i=n.visualViewport;let r=s.clientWidth,o=s.clientHeight,l=0,c=0;if(i){r=i.width,o=i.height;const u=M1();(!u||u&&e==="fixed")&&(l=i.offsetLeft,c=i.offsetTop)}const d=pS(s);if(d<=0){const u=s.ownerDocument,h=u.body,p=getComputedStyle(h),f=u.compatMode==="CSS1Compat"&&parseFloat(p.marginLeft)+parseFloat(p.marginRight)||0,g=Math.abs(s.clientWidth-h.clientWidth-f);g<=qA&&(r-=g)}else d<=qA&&(r+=d);return{width:r,height:o,x:l,y:c}}const uhe=new Set(["absolute","fixed"]);function hhe(t,e){const n=Jl(t,!0,e==="fixed"),s=n.top+t.clientTop,i=n.left+t.clientLeft,r=Gr(t)?vd(t):Lr(1),o=t.clientWidth*r.x,l=t.clientHeight*r.y,c=i*r.x,d=s*r.y;return{width:o,height:l,x:c,y:d}}function ZA(t,e,n){let s;if(e==="viewport")s=dhe(t,n);else if(e==="document")s=che(Xr(t));else if(ir(e))s=hhe(e,n);else{const i=aU(t);s={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return Ev(s)}function cU(t,e){const n=Va(t);return n===e||!ir(n)||Ud(n)?!1:rr(n).position==="fixed"||cU(n,e)}function phe(t,e){const n=e.get(t);if(n)return n;let s=jp(t,[],!1).filter(l=>ir(l)&&cu(l)!=="body"),i=null;const r=rr(t).position==="fixed";let o=r?Va(t):t;for(;ir(o)&&!Ud(o);){const l=rr(o),c=R1(o);!c&&l.position==="fixed"&&(i=null),(r?!c&&!i:!c&&l.position==="static"&&!!i&&uhe.has(i.position)||Ef(o)&&!c&&cU(t,o))?s=s.filter(u=>u!==o):i=l,o=Va(o)}return e.set(t,s),s}function fhe(t){let{element:e,boundary:n,rootBoundary:s,strategy:i}=t;const o=[...n==="clippingAncestors"?uS(e)?[]:phe(e,this._c):[].concat(n),s],l=o[0],c=o.reduce((d,u)=>{const h=ZA(e,u,i);return d.top=Zs(h.top,d.top),d.right=Ga(h.right,d.right),d.bottom=Ga(h.bottom,d.bottom),d.left=Zs(h.left,d.left),d},ZA(e,l,i));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function ghe(t){const{width:e,height:n}=oU(t);return{width:e,height:n}}function mhe(t,e,n){const s=Gr(e),i=Xr(e),r=n==="fixed",o=Jl(t,!0,r,e);let l={scrollLeft:0,scrollTop:0};const c=Lr(0);function d(){c.x=pS(i)}if(s||!s&&!r)if((cu(e)!=="body"||Ef(i))&&(l=hS(e)),s){const f=Jl(e,!0,r,e);c.x=f.x+e.clientLeft,c.y=f.y+e.clientTop}else i&&d();r&&!s&&i&&d();const u=i&&!s&&!r?lU(i,l):Lr(0),h=o.left+l.scrollLeft-c.x-u.x,p=o.top+l.scrollTop-c.y-u.y;return{x:h,y:p,width:o.width,height:o.height}}function Nw(t){return rr(t).position==="static"}function JA(t,e){if(!Gr(t)||rr(t).position==="fixed")return null;if(e)return e(t);let n=t.offsetParent;return Xr(t)===n&&(n=n.ownerDocument.body),n}function dU(t,e){const n=ii(t);if(uS(t))return n;if(!Gr(t)){let i=Va(t);for(;i&&!Ud(i);){if(ir(i)&&!Nw(i))return i;i=Va(i)}return n}let s=JA(t,e);for(;s&&Jue(s)&&Nw(s);)s=JA(s,e);return s&&Ud(s)&&Nw(s)&&!R1(s)?n:s||she(t)||n}const yhe=async function(t){const e=this.getOffsetParent||dU,n=this.getDimensions,s=await n(t.floating);return{reference:mhe(t.reference,await e(t.floating),t.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function vhe(t){return rr(t).direction==="rtl"}const xhe={convertOffsetParentRelativeRectToViewportRelativeRect:ahe,getDocumentElement:Xr,getClippingRect:fhe,getOffsetParent:dU,getElementRects:yhe,getClientRects:lhe,getDimensions:ghe,getScale:vd,isElement:ir,isRTL:vhe};function uU(t,e){return t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height}function She(t,e){let n=null,s;const i=Xr(t);function r(){var l;clearTimeout(s),(l=n)==null||l.disconnect(),n=null}function o(l,c){l===void 0&&(l=!1),c===void 0&&(c=1),r();const d=t.getBoundingClientRect(),{left:u,top:h,width:p,height:f}=d;if(l||e(),!p||!f)return;const g=Jg(h),y=Jg(i.clientWidth-(u+p)),x=Jg(i.clientHeight-(h+f)),m=Jg(u),w={rootMargin:-g+"px "+-y+"px "+-x+"px "+-m+"px",threshold:Zs(0,Ga(1,c))||1};let _=!0;function C(I){const T=I[0].intersectionRatio;if(T!==c){if(!_)return o();T?o(!1,T):s=setTimeout(()=>{o(!1,1e-7)},1e3)}T===1&&!uU(d,t.getBoundingClientRect())&&o(),_=!1}try{n=new IntersectionObserver(C,{...w,root:i.ownerDocument})}catch{n=new IntersectionObserver(C,w)}n.observe(t)}return o(!0),r}function bhe(t,e,n,s){s===void 0&&(s={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:c=!1}=s,d=O1(t),u=i||r?[...d?jp(d):[],...jp(e)]:[];u.forEach(m=>{i&&m.addEventListener("scroll",n,{passive:!0}),r&&m.addEventListener("resize",n)});const h=d&&l?She(d,n):null;let p=-1,f=null;o&&(f=new ResizeObserver(m=>{let[v]=m;v&&v.target===d&&f&&(f.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var w;(w=f)==null||w.observe(e)})),n()}),d&&!c&&f.observe(d),f.observe(e));let g,y=c?Jl(t):null;c&&x();function x(){const m=Jl(t);y&&!uU(y,m)&&n(),y=m,g=requestAnimationFrame(x)}return n(),()=>{var m;u.forEach(v=>{i&&v.removeEventListener("scroll",n),r&&v.removeEventListener("resize",n)}),h==null||h(),(m=f)==null||m.disconnect(),f=null,c&&cancelAnimationFrame(g)}}const whe=Vue,_he=Kue,Che=Wue,Ehe=Xue,The=Hue,QA=zue,Ihe=Yue,Phe=(t,e,n)=>{const s=new Map,i={platform:xhe,...n},r={...i.platform,_c:s};return $ue(t,e,{...i,platform:r})};var khe=typeof document<"u",jhe=function(){},ry=khe?S.useLayoutEffect:jhe;function Tv(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,s,i;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!==e.length)return!1;for(s=n;s--!==0;)if(!Tv(t[s],e[s]))return!1;return!0}if(i=Object.keys(t),n=i.length,n!==Object.keys(e).length)return!1;for(s=n;s--!==0;)if(!{}.hasOwnProperty.call(e,i[s]))return!1;for(s=n;s--!==0;){const r=i[s];if(!(r==="_owner"&&t.$$typeof)&&!Tv(t[r],e[r]))return!1}return!0}return t!==t&&e!==e}function hU(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function eR(t,e){const n=hU(t);return Math.round(e*n)/n}function Aw(t){const e=S.useRef(t);return ry(()=>{e.current=t}),e}function Nhe(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:s=[],platform:i,elements:{reference:r,floating:o}={},transform:l=!0,whileElementsMounted:c,open:d}=t,[u,h]=S.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[p,f]=S.useState(s);Tv(p,s)||f(s);const[g,y]=S.useState(null),[x,m]=S.useState(null),v=S.useCallback(M=>{M!==I.current&&(I.current=M,y(M))},[]),w=S.useCallback(M=>{M!==T.current&&(T.current=M,m(M))},[]),_=r||g,C=o||x,I=S.useRef(null),T=S.useRef(null),P=S.useRef(u),k=c!=null,N=Aw(c),O=Aw(i),R=Aw(d),j=S.useCallback(()=>{if(!I.current||!T.current)return;const M={placement:e,strategy:n,middleware:p};O.current&&(M.platform=O.current),Phe(I.current,T.current,M).then(D=>{const U={...D,isPositioned:R.current!==!1};A.current&&!Tv(P.current,U)&&(P.current=U,Br.flushSync(()=>{h(U)}))})},[p,e,n,O,R]);ry(()=>{d===!1&&P.current.isPositioned&&(P.current.isPositioned=!1,h(M=>({...M,isPositioned:!1})))},[d]);const A=S.useRef(!1);ry(()=>(A.current=!0,()=>{A.current=!1}),[]),ry(()=>{if(_&&(I.current=_),C&&(T.current=C),_&&C){if(N.current)return N.current(_,C,j);j()}},[_,C,j,N,k]);const B=S.useMemo(()=>({reference:I,floating:T,setReference:v,setFloating:w}),[v,w]),L=S.useMemo(()=>({reference:_,floating:C}),[_,C]),$=S.useMemo(()=>{const M={position:n,left:0,top:0};if(!L.floating)return M;const D=eR(L.floating,u.x),U=eR(L.floating,u.y);return l?{...M,transform:"translate("+D+"px, "+U+"px)",...hU(L.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:D,top:U}},[n,l,L.floating,u.x,u.y]);return S.useMemo(()=>({...u,update:j,refs:B,elements:L,floatingStyles:$}),[u,j,B,L,$])}const Ahe=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:s,padding:i}=typeof t=="function"?t(n):t;return s&&e(s)?s.current!=null?QA({element:s.current,padding:i}).fn(n):{}:s?QA({element:s,padding:i}).fn(n):{}}}},Rhe=(t,e)=>({...whe(t),options:[t,e]}),Mhe=(t,e)=>({..._he(t),options:[t,e]}),Ohe=(t,e)=>({...Ihe(t),options:[t,e]}),Dhe=(t,e)=>({...Che(t),options:[t,e]}),Lhe=(t,e)=>({...Ehe(t),options:[t,e]}),Fhe=(t,e)=>({...The(t),options:[t,e]}),Bhe=(t,e)=>({...Ahe(t),options:[t,e]});var Uhe="Arrow",pU=S.forwardRef((t,e)=>{const{children:n,width:s=10,height:i=5,...r}=t;return a.jsx(Ye.svg,{...r,ref:e,width:s,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:t.asChild?n:a.jsx("polygon",{points:"0,0 30,0 15,10"})})});pU.displayName=Uhe;var $he=pU;function fU(t){const[e,n]=S.useState(void 0);return Ro(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const s=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const r=i[0];let o,l;if("borderBoxSize"in r){const c=r.borderBoxSize,d=Array.isArray(c)?c[0]:c;o=d.inlineSize,l=d.blockSize}else o=t.offsetWidth,l=t.offsetHeight;n({width:o,height:l})});return s.observe(t,{box:"border-box"}),()=>s.unobserve(t)}else n(void 0)},[t]),e}var D1="Popper",[gU,fS]=Yr(D1),[zhe,mU]=gU(D1),yU=t=>{const{__scopePopper:e,children:n}=t,[s,i]=S.useState(null);return a.jsx(zhe,{scope:e,anchor:s,onAnchorChange:i,children:n})};yU.displayName=D1;var vU="PopperAnchor",xU=S.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:s,...i}=t,r=mU(vU,n),o=S.useRef(null),l=ut(e,o),c=S.useRef(null);return S.useEffect(()=>{const d=c.current;c.current=(s==null?void 0:s.current)||o.current,d!==c.current&&r.onAnchorChange(c.current)}),s?null:a.jsx(Ye.div,{...i,ref:l})});xU.displayName=vU;var L1="PopperContent",[Whe,Hhe]=gU(L1),SU=S.forwardRef((t,e)=>{var ae,ue,he,_e,Pe,qt;const{__scopePopper:n,side:s="bottom",sideOffset:i=0,align:r="center",alignOffset:o=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:d=[],collisionPadding:u=0,sticky:h="partial",hideWhenDetached:p=!1,updatePositionStrategy:f="optimized",onPlaced:g,...y}=t,x=mU(L1,n),[m,v]=S.useState(null),w=ut(e,nt=>v(nt)),[_,C]=S.useState(null),I=fU(_),T=(I==null?void 0:I.width)??0,P=(I==null?void 0:I.height)??0,k=s+(r!=="center"?"-"+r:""),N=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},O=Array.isArray(d)?d:[d],R=O.length>0,j={padding:N,boundary:O.filter(Vhe),altBoundary:R},{refs:A,floatingStyles:B,placement:L,isPositioned:$,middlewareData:M}=Nhe({strategy:"fixed",placement:k,whileElementsMounted:(...nt)=>bhe(...nt,{animationFrame:f==="always"}),elements:{reference:x.anchor},middleware:[Rhe({mainAxis:i+P,alignmentAxis:o}),c&&Mhe({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?Ohe():void 0,...j}),c&&Dhe({...j}),Lhe({...j,apply:({elements:nt,rects:oe,availableWidth:Ge,availableHeight:jt})=>{const{width:xn,height:Su}=oe.reference,Xo=nt.floating.style;Xo.setProperty("--radix-popper-available-width",`${Ge}px`),Xo.setProperty("--radix-popper-available-height",`${jt}px`),Xo.setProperty("--radix-popper-anchor-width",`${xn}px`),Xo.setProperty("--radix-popper-anchor-height",`${Su}px`)}}),_&&Bhe({element:_,padding:l}),Khe({arrowWidth:T,arrowHeight:P}),p&&Fhe({strategy:"referenceHidden",...j})]}),[D,U]=_U(L),z=fs(g);Ro(()=>{$&&(z==null||z())},[$,z]);const H=(ae=M.arrow)==null?void 0:ae.x,q=(ue=M.arrow)==null?void 0:ue.y,V=((he=M.arrow)==null?void 0:he.centerOffset)!==0,[ee,Q]=S.useState();return Ro(()=>{m&&Q(window.getComputedStyle(m).zIndex)},[m]),a.jsx("div",{ref:A.setFloating,"data-radix-popper-content-wrapper":"",style:{...B,transform:$?B.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ee,"--radix-popper-transform-origin":[(_e=M.transformOrigin)==null?void 0:_e.x,(Pe=M.transformOrigin)==null?void 0:Pe.y].join(" "),...((qt=M.hide)==null?void 0:qt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:t.dir,children:a.jsx(Whe,{scope:n,placedSide:D,onArrowChange:C,arrowX:H,arrowY:q,shouldHideArrow:V,children:a.jsx(Ye.div,{"data-side":D,"data-align":U,...y,ref:w,style:{...y.style,animation:$?void 0:"none"}})})})});SU.displayName=L1;var bU="PopperArrow",Ghe={top:"bottom",right:"left",bottom:"top",left:"right"},wU=S.forwardRef(function(e,n){const{__scopePopper:s,...i}=e,r=Hhe(bU,s),o=Ghe[r.placedSide];return a.jsx("span",{ref:r.onArrowChange,style:{position:"absolute",left:r.arrowX,top:r.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[r.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[r.placedSide],visibility:r.shouldHideArrow?"hidden":void 0},children:a.jsx($he,{...i,ref:n,style:{...i.style,display:"block"}})})});wU.displayName=bU;function Vhe(t){return t!==null}var Khe=t=>({name:"transformOrigin",options:t,fn(e){var x,m,v;const{placement:n,rects:s,middlewareData:i}=e,o=((x=i.arrow)==null?void 0:x.centerOffset)!==0,l=o?0:t.arrowWidth,c=o?0:t.arrowHeight,[d,u]=_U(n),h={start:"0%",center:"50%",end:"100%"}[u],p=(((m=i.arrow)==null?void 0:m.x)??0)+l/2,f=(((v=i.arrow)==null?void 0:v.y)??0)+c/2;let g="",y="";return d==="bottom"?(g=o?h:`${p}px`,y=`${-c}px`):d==="top"?(g=o?h:`${p}px`,y=`${s.floating.height+c}px`):d==="right"?(g=`${-c}px`,y=o?h:`${f}px`):d==="left"&&(g=`${s.floating.width+c}px`,y=o?h:`${f}px`),{data:{x:g,y}}}});function _U(t){const[e,n="center"]=t.split("-");return[e,n]}var F1=yU,B1=xU,CU=SU,EU=wU,gS="Popover",[TU]=Yr(gS,[fS]),Tf=fS(),[Yhe,rl]=TU(gS),IU=t=>{const{__scopePopover:e,children:n,open:s,defaultOpen:i,onOpenChange:r,modal:o=!1}=t,l=Tf(e),c=S.useRef(null),[d,u]=S.useState(!1),[h,p]=il({prop:s,defaultProp:i??!1,onChange:r,caller:gS});return a.jsx(F1,{...l,children:a.jsx(Yhe,{scope:e,contentId:Co(),triggerRef:c,open:h,onOpenChange:p,onOpenToggle:S.useCallback(()=>p(f=>!f),[p]),hasCustomAnchor:d,onCustomAnchorAdd:S.useCallback(()=>u(!0),[]),onCustomAnchorRemove:S.useCallback(()=>u(!1),[]),modal:o,children:n})})};IU.displayName=gS;var PU="PopoverAnchor",Xhe=S.forwardRef((t,e)=>{const{__scopePopover:n,...s}=t,i=rl(PU,n),r=Tf(n),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=i;return S.useEffect(()=>(o(),()=>l()),[o,l]),a.jsx(B1,{...r,...s,ref:e})});Xhe.displayName=PU;var kU="PopoverTrigger",jU=S.forwardRef((t,e)=>{const{__scopePopover:n,...s}=t,i=rl(kU,n),r=Tf(n),o=ut(e,i.triggerRef),l=a.jsx(Ye.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":OU(i.open),...s,ref:o,onClick:me(t.onClick,i.onOpenToggle)});return i.hasCustomAnchor?l:a.jsx(B1,{asChild:!0,...r,children:l})});jU.displayName=kU;var U1="PopoverPortal",[qhe,Zhe]=TU(U1,{forceMount:void 0}),NU=t=>{const{__scopePopover:e,forceMount:n,children:s,container:i}=t,r=rl(U1,e);return a.jsx(qhe,{scope:e,forceMount:n,children:a.jsx(lr,{present:n||r.open,children:a.jsx(wf,{asChild:!0,container:i,children:s})})})};NU.displayName=U1;var $d="PopoverContent",AU=S.forwardRef((t,e)=>{const n=Zhe($d,t.__scopePopover),{forceMount:s=n.forceMount,...i}=t,r=rl($d,t.__scopePopover);return a.jsx(lr,{present:s||r.open,children:r.modal?a.jsx(Qhe,{...i,ref:e}):a.jsx(epe,{...i,ref:e})})});AU.displayName=$d;var Jhe=Bd("PopoverContent.RemoveScroll"),Qhe=S.forwardRef((t,e)=>{const n=rl($d,t.__scopePopover),s=S.useRef(null),i=ut(e,s),r=S.useRef(!1);return S.useEffect(()=>{const o=s.current;if(o)return b1(o)},[]),a.jsx(eS,{as:Jhe,allowPinchZoom:!0,children:a.jsx(RU,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:me(t.onCloseAutoFocus,o=>{var l;o.preventDefault(),r.current||(l=n.triggerRef.current)==null||l.focus()}),onPointerDownOutside:me(t.onPointerDownOutside,o=>{const l=o.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;r.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:me(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),epe=S.forwardRef((t,e)=>{const n=rl($d,t.__scopePopover),s=S.useRef(!1),i=S.useRef(!1);return a.jsx(RU,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{var o,l;(o=t.onCloseAutoFocus)==null||o.call(t,r),r.defaultPrevented||(s.current||(l=n.triggerRef.current)==null||l.focus(),r.preventDefault()),s.current=!1,i.current=!1},onInteractOutside:r=>{var c,d;(c=t.onInteractOutside)==null||c.call(t,r),r.defaultPrevented||(s.current=!0,r.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=r.target;((d=n.triggerRef.current)==null?void 0:d.contains(o))&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&i.current&&r.preventDefault()}})}),RU=S.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:r,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...h}=t,p=rl($d,n),f=Tf(n);return S1(),a.jsx(Jx,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:i,onUnmountAutoFocus:r,children:a.jsx(bf,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>p.onOpenChange(!1),children:a.jsx(CU,{"data-state":OU(p.open),role:"dialog",id:p.contentId,...f,...h,ref:e,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),MU="PopoverClose",tpe=S.forwardRef((t,e)=>{const{__scopePopover:n,...s}=t,i=rl(MU,n);return a.jsx(Ye.button,{type:"button",...s,ref:e,onClick:me(t.onClick,()=>i.onOpenChange(!1))})});tpe.displayName=MU;var npe="PopoverArrow",spe=S.forwardRef((t,e)=>{const{__scopePopover:n,...s}=t,i=Tf(n);return a.jsx(EU,{...i,...s,ref:e})});spe.displayName=npe;function OU(t){return t?"open":"closed"}var $1=IU,z1=jU,W1=NU,H1=AU;function Go(t,e){const n=K(),s=S.useRef(!1),i=Dn(),r=S.useCallback(l=>{s.current=l,n.run(()=>{l?(n.complete(),n.addOpenMenu(t)):n.updateInstanceState({openMenus:n.getOpenMenus().filter(c=>!c.startsWith(t))}),e==null||e(l)})},[n,t,e]),o=Z("is menu open",()=>n.getOpenMenus().includes(t),[n,t]);return S.useEffect(()=>(s.current&&(i("open-menu",{source:"unknown",id:t}),n.addOpenMenu(t)),()=>{s.current&&(n.deleteOpenMenu(t),n.getOpenMenus().forEach(l=>{l.startsWith(t)&&(i("close-menu",{source:"unknown",id:t}),n.deleteOpenMenu(l))}),s.current=!1)}),[n,t,i]),[o,r]}function G1({id:t,children:e,onOpenChange:n,open:s}){const[i,r]=Go(t,n);return a.jsx($1,{onOpenChange:r,open:s||i,children:a.jsx("div",{className:"tlui-popover",children:e})})}function V1({children:t}){return a.jsx(z1,{asChild:!0,dir:"ltr",children:t})}function K1({side:t,children:e,align:n="center",sideOffset:s=8,alignOffset:i=0}){const r=vn();return a.jsx(W1,{container:r,children:a.jsx(H1,{className:"tlui-popover__content",side:t,sideOffset:s,align:n,alignOffset:i,dir:"ltr",children:e})})}const DU=S.createContext(null);function mS(){const t=S.useContext(DU);if(!t)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return t}function Ai({type:t,sourceId:e,children:n}){return a.jsx(DU.Provider,{value:{type:t,sourceId:e},children:n})}function ipe(t){return t.getSelectedShapeIds().map(s=>t.getShape(s)).filter(s=>{if(!s)return!1;if(t.isShapeOfType(s,"arrow")){const i=As(t,s);if(i.start||i.end)return!1}return!0})}const LU=()=>{const t=K();return Z("threeStackableItems",()=>ipe(t).length>2,[t])},Vo=()=>{const t=K();return Z("isInSelectState",()=>t.isIn("select"),[t])},FU=()=>{const t=K();return Z("allow group",()=>{const e=t.getSelectedShapes();if(e.length<2)return!1;for(const n of e)if(t.isShapeOfType(n,"arrow")){const s=As(t,n);if(s.start&&!e.some(i=>i.id===s.start.toId)||s.end&&!e.some(i=>i.id===s.end.toId))return!1}return!0},[t])},BU=()=>{const t=K();return Z("allowUngroup",()=>t.getSelectedShapeIds().some(e=>{var n;return((n=t.getShape(e))==null?void 0:n.type)==="group"}),[t])},rpe=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function UU(t,e){const n=K();return Z("selectedShapes",()=>n.getSelectedShapes().length>=t,[n,t,e])}function bs(t,e){const n=K();return Z("selectedShapes",()=>{const s=n.getSelectedShapes().filter(i=>!n.isShapeOrAncestorLocked(i)).length;return t===void 0?s:s>=t},[n])}function ope(){const t=K();return Z("showAutoSizeToggle",()=>{const e=t.getSelectedShapes();return e.length===1&&t.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[t])}function $U(){const t=K();return Z("hasLinkShapeSelected",()=>{const e=t.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[t])}function ape(){const t=K();return Z("onlyFlippableShape",()=>{const e=t.getOnlySelectedShape();return e&&(t.isShapeOfType(e,"group")||t.isShapeOfType(e,"image")||t.isShapeOfType(e,"arrow")||t.isShapeOfType(e,"line")||t.isShapeOfType(e,"draw"))},[t])}function zU(){const t=K();return Z("useCanRedo",()=>t.getCanRedo(),[t])}function WU(){const t=K();return Z("useCanUndo",()=>t.getCanUndo(),[t])}var lpe=S.createContext(void 0);function Y1(t){const e=S.useContext(lpe);return t||e||"ltr"}var Rw="rovingFocusGroup.onEntryFocus",cpe={bubbles:!1,cancelable:!0},If="RovingFocusGroup",[EC,HU,dpe]=nS(If),[upe,GU]=Yr(If,[dpe]),[hpe,ppe]=upe(If),VU=S.forwardRef((t,e)=>a.jsx(EC.Provider,{scope:t.__scopeRovingFocusGroup,children:a.jsx(EC.Slot,{scope:t.__scopeRovingFocusGroup,children:a.jsx(fpe,{...t,ref:e})})}));VU.displayName=If;var fpe=S.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:s,loop:i=!1,dir:r,currentTabStopId:o,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:u=!1,...h}=t,p=S.useRef(null),f=ut(e,p),g=Y1(r),[y,x]=il({prop:o,defaultProp:l??null,onChange:c,caller:If}),[m,v]=S.useState(!1),w=fs(d),_=HU(n),C=S.useRef(!1),[I,T]=S.useState(0);return S.useEffect(()=>{const P=p.current;if(P)return P.addEventListener(Rw,w),()=>P.removeEventListener(Rw,w)},[w]),a.jsx(hpe,{scope:n,orientation:s,dir:g,loop:i,currentTabStopId:y,onItemFocus:S.useCallback(P=>x(P),[x]),onItemShiftTab:S.useCallback(()=>v(!0),[]),onFocusableItemAdd:S.useCallback(()=>T(P=>P+1),[]),onFocusableItemRemove:S.useCallback(()=>T(P=>P-1),[]),children:a.jsx(Ye.div,{tabIndex:m||I===0?-1:0,"data-orientation":s,...h,ref:f,style:{outline:"none",...t.style},onMouseDown:me(t.onMouseDown,()=>{C.current=!0}),onFocus:me(t.onFocus,P=>{const k=!C.current;if(P.target===P.currentTarget&&k&&!m){const N=new CustomEvent(Rw,cpe);if(P.currentTarget.dispatchEvent(N),!N.defaultPrevented){const O=_().filter(L=>L.focusable),R=O.find(L=>L.active),j=O.find(L=>L.id===y),B=[R,j,...O].filter(Boolean).map(L=>L.ref.current);XU(B,u)}}C.current=!1}),onBlur:me(t.onBlur,()=>v(!1))})})}),KU="RovingFocusGroupItem",YU=S.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:s=!0,active:i=!1,tabStopId:r,children:o,...l}=t,c=Co(),d=r||c,u=ppe(KU,n),h=u.currentTabStopId===d,p=HU(n),{onFocusableItemAdd:f,onFocusableItemRemove:g,currentTabStopId:y}=u;return S.useEffect(()=>{if(s)return f(),()=>g()},[s,f,g]),a.jsx(EC.ItemSlot,{scope:n,id:d,focusable:s,active:i,children:a.jsx(Ye.span,{tabIndex:h?0:-1,"data-orientation":u.orientation,...l,ref:e,onMouseDown:me(t.onMouseDown,x=>{s?u.onItemFocus(d):x.preventDefault()}),onFocus:me(t.onFocus,()=>u.onItemFocus(d)),onKeyDown:me(t.onKeyDown,x=>{if(x.key==="Tab"&&x.shiftKey){u.onItemShiftTab();return}if(x.target!==x.currentTarget)return;const m=ype(x,u.orientation,u.dir);if(m!==void 0){if(x.metaKey||x.ctrlKey||x.altKey||x.shiftKey)return;x.preventDefault();let w=p().filter(_=>_.focusable).map(_=>_.ref.current);if(m==="last")w.reverse();else if(m==="prev"||m==="next"){m==="prev"&&w.reverse();const _=w.indexOf(x.currentTarget);w=u.loop?vpe(w,_+1):w.slice(_+1)}setTimeout(()=>XU(w))}}),children:typeof o=="function"?o({isCurrentTabStop:h,hasTabStop:y!=null}):o})})});YU.displayName=KU;var gpe={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function mpe(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function ype(t,e,n){const s=mpe(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return gpe[s]}function XU(t,e=!1){const n=document.activeElement;for(const s of t)if(s===n||(s.focus({preventScroll:e}),document.activeElement!==n))return}function vpe(t,e){return t.map((n,s)=>t[(e+s)%t.length])}var xpe=VU,Spe=YU,TC=["Enter"," "],bpe=["ArrowDown","PageUp","Home"],qU=["ArrowUp","PageDown","End"],wpe=[...bpe,...qU],_pe={ltr:[...TC,"ArrowRight"],rtl:[...TC,"ArrowLeft"]},Cpe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Pf="Menu",[Np,Epe,Tpe]=nS(Pf),[fc,yS]=Yr(Pf,[Tpe,fS,GU]),kf=fS(),ZU=GU(),[JU,ol]=fc(Pf),[Ipe,jf]=fc(Pf),QU=t=>{const{__scopeMenu:e,open:n=!1,children:s,dir:i,onOpenChange:r,modal:o=!0}=t,l=kf(e),[c,d]=S.useState(null),u=S.useRef(!1),h=fs(r),p=Y1(i);return S.useEffect(()=>{const f=()=>{u.current=!0,document.addEventListener("pointerdown",g,{capture:!0,once:!0}),document.addEventListener("pointermove",g,{capture:!0,once:!0})},g=()=>u.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",g,{capture:!0}),document.removeEventListener("pointermove",g,{capture:!0})}},[]),a.jsx(F1,{...l,children:a.jsx(JU,{scope:e,open:n,onOpenChange:h,content:c,onContentChange:d,children:a.jsx(Ipe,{scope:e,onClose:S.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:u,dir:p,modal:o,children:s})})})};QU.displayName=Pf;var Ppe="MenuAnchor",X1=S.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t,i=kf(n);return a.jsx(B1,{...i,...s,ref:e})});X1.displayName=Ppe;var q1="MenuPortal",[kpe,e$]=fc(q1,{forceMount:void 0}),t$=t=>{const{__scopeMenu:e,forceMount:n,children:s,container:i}=t,r=ol(q1,e);return a.jsx(kpe,{scope:e,forceMount:n,children:a.jsx(lr,{present:n||r.open,children:a.jsx(wf,{asChild:!0,container:i,children:s})})})};t$.displayName=q1;var ki="MenuContent",[jpe,Z1]=fc(ki),n$=S.forwardRef((t,e)=>{const n=e$(ki,t.__scopeMenu),{forceMount:s=n.forceMount,...i}=t,r=ol(ki,t.__scopeMenu),o=jf(ki,t.__scopeMenu);return a.jsx(Np.Provider,{scope:t.__scopeMenu,children:a.jsx(lr,{present:s||r.open,children:a.jsx(Np.Slot,{scope:t.__scopeMenu,children:o.modal?a.jsx(Npe,{...i,ref:e}):a.jsx(Ape,{...i,ref:e})})})})}),Npe=S.forwardRef((t,e)=>{const n=ol(ki,t.__scopeMenu),s=S.useRef(null),i=ut(e,s);return S.useEffect(()=>{const r=s.current;if(r)return b1(r)},[]),a.jsx(J1,{...t,ref:i,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:me(t.onFocusOutside,r=>r.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)})}),Ape=S.forwardRef((t,e)=>{const n=ol(ki,t.__scopeMenu);return a.jsx(J1,{...t,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)})}),Rpe=Bd("MenuContent.ScrollLock"),J1=S.forwardRef((t,e)=>{const{__scopeMenu:n,loop:s=!1,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:p,onDismiss:f,disableOutsideScroll:g,...y}=t,x=ol(ki,n),m=jf(ki,n),v=kf(n),w=ZU(n),_=Epe(n),[C,I]=S.useState(null),T=S.useRef(null),P=ut(e,T,x.onContentChange),k=S.useRef(0),N=S.useRef(""),O=S.useRef(0),R=S.useRef(null),j=S.useRef("right"),A=S.useRef(0),B=g?eS:S.Fragment,L=g?{as:Rpe,allowPinchZoom:!0}:void 0,$=D=>{var ae,ue;const U=N.current+D,z=_().filter(he=>!he.disabled),H=document.activeElement,q=(ae=z.find(he=>he.ref.current===H))==null?void 0:ae.textValue,V=z.map(he=>he.textValue),ee=Gpe(V,U,q),Q=(ue=z.find(he=>he.textValue===ee))==null?void 0:ue.ref.current;(function he(_e){N.current=_e,window.clearTimeout(k.current),_e!==""&&(k.current=window.setTimeout(()=>he(""),1e3))})(U),Q&&setTimeout(()=>Q.focus())};S.useEffect(()=>()=>window.clearTimeout(k.current),[]),S1();const M=S.useCallback(D=>{var z,H;return j.current===((z=R.current)==null?void 0:z.side)&&Kpe(D,(H=R.current)==null?void 0:H.area)},[]);return a.jsx(jpe,{scope:n,searchRef:N,onItemEnter:S.useCallback(D=>{M(D)&&D.preventDefault()},[M]),onItemLeave:S.useCallback(D=>{var U;M(D)||((U=T.current)==null||U.focus(),I(null))},[M]),onTriggerLeave:S.useCallback(D=>{M(D)&&D.preventDefault()},[M]),pointerGraceTimerRef:O,onPointerGraceIntentChange:S.useCallback(D=>{R.current=D},[]),children:a.jsx(B,{...L,children:a.jsx(Jx,{asChild:!0,trapped:i,onMountAutoFocus:me(r,D=>{var U;D.preventDefault(),(U=T.current)==null||U.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:a.jsx(bf,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:p,onDismiss:f,children:a.jsx(xpe,{asChild:!0,...w,dir:m.dir,orientation:"vertical",loop:s,currentTabStopId:C,onCurrentTabStopIdChange:I,onEntryFocus:me(c,D=>{m.isUsingKeyboardRef.current||D.preventDefault()}),preventScrollOnEntryFocus:!0,children:a.jsx(CU,{role:"menu","aria-orientation":"vertical","data-state":x$(x.open),"data-radix-menu-content":"",dir:m.dir,...v,...y,ref:P,style:{outline:"none",...y.style},onKeyDown:me(y.onKeyDown,D=>{const z=D.target.closest("[data-radix-menu-content]")===D.currentTarget,H=D.ctrlKey||D.altKey||D.metaKey,q=D.key.length===1;z&&(D.key==="Tab"&&D.preventDefault(),!H&&q&&$(D.key));const V=T.current;if(D.target!==V||!wpe.includes(D.key))return;D.preventDefault();const Q=_().filter(ae=>!ae.disabled).map(ae=>ae.ref.current);qU.includes(D.key)&&Q.reverse(),Wpe(Q)}),onBlur:me(t.onBlur,D=>{D.currentTarget.contains(D.target)||(window.clearTimeout(k.current),N.current="")}),onPointerMove:me(t.onPointerMove,Ap(D=>{const U=D.target,z=A.current!==D.clientX;if(D.currentTarget.contains(U)&&z){const H=D.clientX>A.current?"right":"left";j.current=H,A.current=D.clientX}}))})})})})})})});n$.displayName=ki;var Mpe="MenuGroup",Q1=S.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t;return a.jsx(Ye.div,{role:"group",...s,ref:e})});Q1.displayName=Mpe;var Ope="MenuLabel",s$=S.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t;return a.jsx(Ye.div,{...s,ref:e})});s$.displayName=Ope;var Iv="MenuItem",tR="menu.itemSelect",vS=S.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:s,...i}=t,r=S.useRef(null),o=jf(Iv,t.__scopeMenu),l=Z1(Iv,t.__scopeMenu),c=ut(e,r),d=S.useRef(!1),u=()=>{const h=r.current;if(!n&&h){const p=new CustomEvent(tR,{bubbles:!0,cancelable:!0});h.addEventListener(tR,f=>s==null?void 0:s(f),{once:!0}),x1(h,p),p.defaultPrevented?d.current=!1:o.onClose()}};return a.jsx(i$,{...i,ref:c,disabled:n,onClick:me(t.onClick,u),onPointerDown:h=>{var p;(p=t.onPointerDown)==null||p.call(t,h),d.current=!0},onPointerUp:me(t.onPointerUp,h=>{var p;d.current||(p=h.currentTarget)==null||p.click()}),onKeyDown:me(t.onKeyDown,h=>{const p=l.searchRef.current!=="";n||p&&h.key===" "||TC.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});vS.displayName=Iv;var i$=S.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:s=!1,textValue:i,...r}=t,o=Z1(Iv,n),l=ZU(n),c=S.useRef(null),d=ut(e,c),[u,h]=S.useState(!1),[p,f]=S.useState("");return S.useEffect(()=>{const g=c.current;g&&f((g.textContent??"").trim())},[r.children]),a.jsx(Np.ItemSlot,{scope:n,disabled:s,textValue:i??p,children:a.jsx(Spe,{asChild:!0,...l,focusable:!s,children:a.jsx(Ye.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...r,ref:d,onPointerMove:me(t.onPointerMove,Ap(g=>{s?o.onItemLeave(g):(o.onItemEnter(g),g.defaultPrevented||g.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:me(t.onPointerLeave,Ap(g=>o.onItemLeave(g))),onFocus:me(t.onFocus,()=>h(!0)),onBlur:me(t.onBlur,()=>h(!1))})})})}),Dpe="MenuCheckboxItem",r$=S.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:s,...i}=t;return a.jsx(d$,{scope:t.__scopeMenu,checked:n,children:a.jsx(vS,{role:"menuitemcheckbox","aria-checked":Pv(n)?"mixed":n,...i,ref:e,"data-state":nI(n),onSelect:me(i.onSelect,()=>s==null?void 0:s(Pv(n)?!0:!n),{checkForDefaultPrevented:!1})})})});r$.displayName=Dpe;var o$="MenuRadioGroup",[Lpe,Fpe]=fc(o$,{value:void 0,onValueChange:()=>{}}),a$=S.forwardRef((t,e)=>{const{value:n,onValueChange:s,...i}=t,r=fs(s);return a.jsx(Lpe,{scope:t.__scopeMenu,value:n,onValueChange:r,children:a.jsx(Q1,{...i,ref:e})})});a$.displayName=o$;var l$="MenuRadioItem",c$=S.forwardRef((t,e)=>{const{value:n,...s}=t,i=Fpe(l$,t.__scopeMenu),r=n===i.value;return a.jsx(d$,{scope:t.__scopeMenu,checked:r,children:a.jsx(vS,{role:"menuitemradio","aria-checked":r,...s,ref:e,"data-state":nI(r),onSelect:me(s.onSelect,()=>{var o;return(o=i.onValueChange)==null?void 0:o.call(i,n)},{checkForDefaultPrevented:!1})})})});c$.displayName=l$;var eI="MenuItemIndicator",[d$,Bpe]=fc(eI,{checked:!1}),u$=S.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:s,...i}=t,r=Bpe(eI,n);return a.jsx(lr,{present:s||Pv(r.checked)||r.checked===!0,children:a.jsx(Ye.span,{...i,ref:e,"data-state":nI(r.checked)})})});u$.displayName=eI;var Upe="MenuSeparator",h$=S.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t;return a.jsx(Ye.div,{role:"separator","aria-orientation":"horizontal",...s,ref:e})});h$.displayName=Upe;var $pe="MenuArrow",p$=S.forwardRef((t,e)=>{const{__scopeMenu:n,...s}=t,i=kf(n);return a.jsx(EU,{...i,...s,ref:e})});p$.displayName=$pe;var tI="MenuSub",[zpe,f$]=fc(tI),g$=t=>{const{__scopeMenu:e,children:n,open:s=!1,onOpenChange:i}=t,r=ol(tI,e),o=kf(e),[l,c]=S.useState(null),[d,u]=S.useState(null),h=fs(i);return S.useEffect(()=>(r.open===!1&&h(!1),()=>h(!1)),[r.open,h]),a.jsx(F1,{...o,children:a.jsx(JU,{scope:e,open:s,onOpenChange:h,content:d,onContentChange:u,children:a.jsx(zpe,{scope:e,contentId:Co(),triggerId:Co(),trigger:l,onTriggerChange:c,children:n})})})};g$.displayName=tI;var Th="MenuSubTrigger",m$=S.forwardRef((t,e)=>{const n=ol(Th,t.__scopeMenu),s=jf(Th,t.__scopeMenu),i=f$(Th,t.__scopeMenu),r=Z1(Th,t.__scopeMenu),o=S.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=r,d={__scopeMenu:t.__scopeMenu},u=S.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return S.useEffect(()=>u,[u]),S.useEffect(()=>{const h=l.current;return()=>{window.clearTimeout(h),c(null)}},[l,c]),a.jsx(X1,{asChild:!0,...d,children:a.jsx(i$,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":i.contentId,"data-state":x$(n.open),...t,ref:Zx(e,i.onTriggerChange),onClick:h=>{var p;(p=t.onClick)==null||p.call(t,h),!(t.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:me(t.onPointerMove,Ap(h=>{r.onItemEnter(h),!h.defaultPrevented&&!t.disabled&&!n.open&&!o.current&&(r.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:me(t.onPointerLeave,Ap(h=>{var f,g;u();const p=(f=n.content)==null?void 0:f.getBoundingClientRect();if(p){const y=(g=n.content)==null?void 0:g.dataset.side,x=y==="right",m=x?-5:5,v=p[x?"left":"right"],w=p[x?"right":"left"];r.onPointerGraceIntentChange({area:[{x:h.clientX+m,y:h.clientY},{x:v,y:p.top},{x:w,y:p.top},{x:w,y:p.bottom},{x:v,y:p.bottom}],side:y}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>r.onPointerGraceIntentChange(null),300)}else{if(r.onTriggerLeave(h),h.defaultPrevented)return;r.onPointerGraceIntentChange(null)}})),onKeyDown:me(t.onKeyDown,h=>{var f;const p=r.searchRef.current!=="";t.disabled||p&&h.key===" "||_pe[s.dir].includes(h.key)&&(n.onOpenChange(!0),(f=n.content)==null||f.focus(),h.preventDefault())})})})});m$.displayName=Th;var y$="MenuSubContent",v$=S.forwardRef((t,e)=>{const n=e$(ki,t.__scopeMenu),{forceMount:s=n.forceMount,...i}=t,r=ol(ki,t.__scopeMenu),o=jf(ki,t.__scopeMenu),l=f$(y$,t.__scopeMenu),c=S.useRef(null),d=ut(e,c);return a.jsx(Np.Provider,{scope:t.__scopeMenu,children:a.jsx(lr,{present:s||r.open,children:a.jsx(Np.Slot,{scope:t.__scopeMenu,children:a.jsx(J1,{id:l.contentId,"aria-labelledby":l.triggerId,...i,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var h;o.isUsingKeyboardRef.current&&((h=c.current)==null||h.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:me(t.onFocusOutside,u=>{u.target!==l.trigger&&r.onOpenChange(!1)}),onEscapeKeyDown:me(t.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:me(t.onKeyDown,u=>{var f;const h=u.currentTarget.contains(u.target),p=Cpe[o.dir].includes(u.key);h&&p&&(r.onOpenChange(!1),(f=l.trigger)==null||f.focus(),u.preventDefault())})})})})})});v$.displayName=y$;function x$(t){return t?"open":"closed"}function Pv(t){return t==="indeterminate"}function nI(t){return Pv(t)?"indeterminate":t?"checked":"unchecked"}function Wpe(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function Hpe(t,e){return t.map((n,s)=>t[(e+s)%t.length])}function Gpe(t,e,n){const i=e.length>1&&Array.from(e).every(d=>d===e[0])?e[0]:e,r=n?t.indexOf(n):-1;let o=Hpe(t,Math.max(r,0));i.length===1&&(o=o.filter(d=>d!==n));const c=o.find(d=>d.toLowerCase().startsWith(i.toLowerCase()));return c!==n?c:void 0}function Vpe(t,e){const{x:n,y:s}=t;let i=!1;for(let r=0,o=e.length-1;r<e.length;o=r++){const l=e[r],c=e[o],d=l.x,u=l.y,h=c.x,p=c.y;u>s!=p>s&&n<(h-d)*(s-u)/(p-u)+d&&(i=!i)}return i}function Kpe(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return Vpe(n,e)}function Ap(t){return e=>e.pointerType==="mouse"?t(e):void 0}var S$=QU,b$=X1,w$=t$,_$=n$,C$=Q1,E$=s$,T$=vS,I$=r$,P$=a$,k$=c$,j$=u$,N$=h$,A$=p$,R$=g$,M$=m$,O$=v$,sI="ContextMenu",[Ype]=Yr(sI,[yS]),ns=yS(),[Xpe,D$]=Ype(sI),L$=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:s,dir:i,modal:r=!0}=t,[o,l]=S.useState(!1),c=ns(e),d=fs(s),u=S.useCallback(h=>{l(h),d(h)},[d]);return a.jsx(Xpe,{scope:e,open:o,onOpenChange:u,modal:r,children:a.jsx(S$,{...c,dir:i,open:o,onOpenChange:u,modal:r,children:n})})};L$.displayName=sI;var F$="ContextMenuTrigger",B$=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:s=!1,...i}=t,r=D$(F$,n),o=ns(n),l=S.useRef({x:0,y:0}),c=S.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...l.current})}),d=S.useRef(0),u=S.useCallback(()=>window.clearTimeout(d.current),[]),h=p=>{l.current={x:p.clientX,y:p.clientY},r.onOpenChange(!0)};return S.useEffect(()=>u,[u]),S.useEffect(()=>void(s&&u()),[s,u]),a.jsxs(a.Fragment,{children:[a.jsx(b$,{...o,virtualRef:c}),a.jsx(Ye.span,{"data-state":r.open?"open":"closed","data-disabled":s?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:s?t.onContextMenu:me(t.onContextMenu,p=>{u(),h(p),p.preventDefault()}),onPointerDown:s?t.onPointerDown:me(t.onPointerDown,Qg(p=>{u(),d.current=window.setTimeout(()=>h(p),700)})),onPointerMove:s?t.onPointerMove:me(t.onPointerMove,Qg(u)),onPointerCancel:s?t.onPointerCancel:me(t.onPointerCancel,Qg(u)),onPointerUp:s?t.onPointerUp:me(t.onPointerUp,Qg(u))})]})});B$.displayName=F$;var qpe="ContextMenuPortal",iI=t=>{const{__scopeContextMenu:e,...n}=t,s=ns(e);return a.jsx(w$,{...s,...n})};iI.displayName=qpe;var U$="ContextMenuContent",$$=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=D$(U$,n),r=ns(n),o=S.useRef(!1);return a.jsx(_$,{...r,...s,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:l=>{var c;(c=t.onCloseAutoFocus)==null||c.call(t,l),!l.defaultPrevented&&o.current&&l.preventDefault(),o.current=!1},onInteractOutside:l=>{var c;(c=t.onInteractOutside)==null||c.call(t,l),!l.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});$$.displayName=U$;var Zpe="ContextMenuGroup",z$=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(C$,{...i,...s,ref:e})});z$.displayName=Zpe;var Jpe="ContextMenuLabel",Qpe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(E$,{...i,...s,ref:e})});Qpe.displayName=Jpe;var efe="ContextMenuItem",W$=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(T$,{...i,...s,ref:e})});W$.displayName=efe;var tfe="ContextMenuCheckboxItem",H$=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(I$,{...i,...s,ref:e})});H$.displayName=tfe;var nfe="ContextMenuRadioGroup",sfe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(P$,{...i,...s,ref:e})});sfe.displayName=nfe;var ife="ContextMenuRadioItem",rfe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(k$,{...i,...s,ref:e})});rfe.displayName=ife;var ofe="ContextMenuItemIndicator",afe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(j$,{...i,...s,ref:e})});afe.displayName=ofe;var lfe="ContextMenuSeparator",cfe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(N$,{...i,...s,ref:e})});cfe.displayName=lfe;var dfe="ContextMenuArrow",ufe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(A$,{...i,...s,ref:e})});ufe.displayName=dfe;var G$="ContextMenuSub",V$=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:s,open:i,defaultOpen:r}=t,o=ns(e),[l,c]=il({prop:i,defaultProp:r??!1,onChange:s,caller:G$});return a.jsx(R$,{...o,open:l,onOpenChange:c,children:n})};V$.displayName=G$;var hfe="ContextMenuSubTrigger",K$=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(M$,{...i,...s,ref:e})});K$.displayName=hfe;var pfe="ContextMenuSubContent",Y$=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...s}=t,i=ns(n);return a.jsx(O$,{...i,...s,ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Y$.displayName=pfe;function Qg(t){return e=>e.pointerType!=="mouse"?t(e):void 0}var ffe=L$,gfe=B$,mfe=iI,yfe=$$,vfe=H$;const X$=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,xfe=X$?"":"Ctrl",Sfe=X$?"":"Alt";function q$(t){return t.split(",")[0].split("").map(e=>{const n=e.replace(/\$/g,xfe).replace(/\?/g,Sfe).replace(/!/g,"");return n[0].toUpperCase()+n.slice(1)})}function IC(t){return" "+q$(t).join("")}function bfe(t){return a.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...t,children:a.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[a.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),a.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:a.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}var xS="DropdownMenu",[wfe]=Yr(xS,[yS]),ss=yS(),[_fe,Z$]=wfe(xS),J$=t=>{const{__scopeDropdownMenu:e,children:n,dir:s,open:i,defaultOpen:r,onOpenChange:o,modal:l=!0}=t,c=ss(e),d=S.useRef(null),[u,h]=il({prop:i,defaultProp:r??!1,onChange:o,caller:xS});return a.jsx(_fe,{scope:e,triggerId:Co(),triggerRef:d,contentId:Co(),open:u,onOpenChange:h,onOpenToggle:S.useCallback(()=>h(p=>!p),[h]),modal:l,children:a.jsx(S$,{...c,open:u,onOpenChange:h,dir:s,modal:l,children:n})})};J$.displayName=xS;var Q$="DropdownMenuTrigger",e4=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:s=!1,...i}=t,r=Z$(Q$,n),o=ss(n);return a.jsx(b$,{asChild:!0,...o,children:a.jsx(Ye.button,{type:"button",id:r.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":r.open?r.contentId:void 0,"data-state":r.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...i,ref:Zx(e,r.triggerRef),onPointerDown:me(t.onPointerDown,l=>{!s&&l.button===0&&l.ctrlKey===!1&&(r.onOpenToggle(),r.open||l.preventDefault())}),onKeyDown:me(t.onKeyDown,l=>{s||(["Enter"," "].includes(l.key)&&r.onOpenToggle(),l.key==="ArrowDown"&&r.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});e4.displayName=Q$;var Cfe="DropdownMenuPortal",t4=t=>{const{__scopeDropdownMenu:e,...n}=t,s=ss(e);return a.jsx(w$,{...s,...n})};t4.displayName=Cfe;var n4="DropdownMenuContent",s4=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=Z$(n4,n),r=ss(n),o=S.useRef(!1);return a.jsx(_$,{id:i.contentId,"aria-labelledby":i.triggerId,...r,...s,ref:e,onCloseAutoFocus:me(t.onCloseAutoFocus,l=>{var c;o.current||(c=i.triggerRef.current)==null||c.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:me(t.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,u=c.button===2||d;(!i.modal||u)&&(o.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});s4.displayName=n4;var Efe="DropdownMenuGroup",i4=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(C$,{...i,...s,ref:e})});i4.displayName=Efe;var Tfe="DropdownMenuLabel",Ife=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(E$,{...i,...s,ref:e})});Ife.displayName=Tfe;var Pfe="DropdownMenuItem",r4=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(T$,{...i,...s,ref:e})});r4.displayName=Pfe;var kfe="DropdownMenuCheckboxItem",o4=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(I$,{...i,...s,ref:e})});o4.displayName=kfe;var jfe="DropdownMenuRadioGroup",Nfe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(P$,{...i,...s,ref:e})});Nfe.displayName=jfe;var Afe="DropdownMenuRadioItem",Rfe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(k$,{...i,...s,ref:e})});Rfe.displayName=Afe;var Mfe="DropdownMenuItemIndicator",Ofe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(j$,{...i,...s,ref:e})});Ofe.displayName=Mfe;var Dfe="DropdownMenuSeparator",Lfe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(N$,{...i,...s,ref:e})});Lfe.displayName=Dfe;var Ffe="DropdownMenuArrow",Bfe=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(A$,{...i,...s,ref:e})});Bfe.displayName=Ffe;var Ufe=t=>{const{__scopeDropdownMenu:e,children:n,open:s,onOpenChange:i,defaultOpen:r}=t,o=ss(e),[l,c]=il({prop:s,defaultProp:r??!1,onChange:i,caller:"DropdownMenuSub"});return a.jsx(R$,{...o,open:l,onOpenChange:c,children:n})},$fe="DropdownMenuSubTrigger",a4=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(M$,{...i,...s,ref:e})});a4.displayName=$fe;var zfe="DropdownMenuSubContent",l4=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...s}=t,i=ss(n);return a.jsx(O$,{...i,...s,ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});l4.displayName=zfe;var rI=J$,oI=e4,SS=t4,aI=s4,Wfe=i4,Hfe=r4,Gfe=o4,Vfe=Ufe,Kfe=a4,Yfe=l4;function Ql({id:t,children:e,modal:n=!1,debugOpen:s=!1}){const[i,r]=Go(t);return a.jsx(rI,{open:s||i,dir:"ltr",modal:n,onOpenChange:r,children:e})}function ec({children:t,...e}){return a.jsx(oI,{dir:"ltr",asChild:!0,onTouchEnd:n=>Ve(n),...e,children:t})}function tc({side:t="bottom",align:e="start",sideOffset:n=8,alignOffset:s=8,children:i}){const r=vn();return a.jsx(SS,{container:r,children:a.jsx(aI,{className:"tlui-menu",side:t,sideOffset:n,align:e,alignOffset:s,collisionPadding:4,children:i})})}function Xfe({id:t,children:e}){const[n,s]=Go(t);return a.jsx(Vfe,{open:n,onOpenChange:s,children:e})}function qfe({id:t,label:e,title:n,disabled:s}){return a.jsx(Kfe,{dir:"ltr",asChild:!0,disabled:s,children:a.jsxs(be,{"data-testid":t,type:"menu",className:"tlui-menu__submenu__trigger",disabled:s,title:n,children:[a.jsx(Yt,{children:e}),a.jsx(Be,{icon:"chevron-right",small:!0})]})})}function Zfe({id:t,alignOffset:e=-1,sideOffset:n=-4,size:s="small",children:i}){const r=vn();return a.jsx(SS,{container:r,children:a.jsx(Yfe,{"data-testid":t,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:n,collisionPadding:4,"data-size":s,children:i})})}function Jfe({children:t}){return a.jsx(Wfe,{dir:"ltr",className:"tlui-menu__group",children:t})}function Rp({noClose:t,children:e}){return a.jsx(Hfe,{dir:"ltr",asChild:!0,onClick:t?Ve:void 0,children:e})}function Kh({children:t,visibleOnMobileLayout:e=!1}){const n=Ss();return!e&&n<Ht.MOBILE?null:a.jsx("kbd",{className:"tlui-kbd",children:q$(t).map((s,i)=>a.jsx("span",{children:s},i))})}function X({disabled:t=!1,spinner:e=!1,readonlyOk:n=!1,id:s,kbd:i,label:r,icon:o,onSelect:l,noClose:c,isSelected:d}){const{type:u,sourceId:h}=mS(),p=$e(),[f,g]=S.useState(!1);if(Ho()&&!n)return null;const x=kp(r,u),m=i?IC(i):void 0,v=x?p(x):void 0,w=v&&m?`${v} ${m}`:v;switch(u){case"menu":return a.jsx(Rp,{children:a.jsxs(be,{type:"menu","data-testid":`${h}.${s}`,disabled:t,title:w,onClick:_=>{c&&Ve(_),f?g(!1):l(h)},children:[a.jsx(Yt,{children:v}),i&&a.jsx(Kh,{children:i})]})});case"context-menu":return t?null:a.jsxs(W$,{dir:"ltr",title:w,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${h}.${s}`,onSelect:_=>{c&&Ve(_),f?g(!1):l(h)},children:[a.jsx("span",{className:"tlui-button__label",draggable:!1,children:v}),i&&a.jsx(Kh,{children:i}),e&&a.jsx(bfe,{})]});case"panel":return a.jsxs(be,{"data-testid":`${h}.${s}`,type:"menu",title:w,disabled:t,onClick:()=>l(h),children:[a.jsx(Yt,{children:v}),o&&a.jsx(Be,{icon:o})]});case"small-icons":case"icons":return a.jsx(be,{"data-testid":`${h}.${s}`,type:"icon",title:w,disabled:t,onClick:()=>l(h),children:a.jsx(Be,{icon:o,small:u==="small-icons"})});case"keyboard-shortcuts":return i?a.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${h}.${s}`,children:[a.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:v}),a.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:a.jsx(Kh,{visibleOnMobileLayout:!0,children:i})})]}):(console.warn(`Menu item '${r}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return a.jsxs(be,{type:"low",onClick:()=>l(h),children:[a.jsx(Be,{icon:o}),a.jsx(Yt,{children:v})]});case"toolbar":return a.jsx(be,{type:"tool","data-testid":`tools.${s}`,"aria-label":x,"data-value":s,onClick:()=>l("toolbar"),title:w,onTouchStart:_=>{Ve(_),l("toolbar")},role:"radio","aria-checked":d?"true":"false",children:a.jsx(Be,{icon:o})});case"toolbar-overflow":return a.jsx(Rp,{"aria-label":r,children:a.jsx(be,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{l("toolbar")},"data-testid":`tools.more.${s}`,title:w,role:"radio","aria-checked":d?"true":"false","data-value":s,children:a.jsx(Be,{icon:o})})});default:throw Zn(u)}}function Qfe(){return a.jsxs(a.Fragment,{children:[a.jsx(ege,{}),a.jsx(tge,{}),a.jsx(nge,{}),a.jsx(sge,{}),a.jsx(ige,{}),a.jsx(age,{}),a.jsx(lge,{}),a.jsx(cge,{})]})}function ege(){const t=xe(),e=bs(2),n=Vo(),s=e&&n;return a.jsxs(a.Fragment,{children:[a.jsx(X,{...t["align-left"],disabled:!s}),a.jsx(X,{...t["align-center-horizontal"],disabled:!s}),a.jsx(X,{...t["align-right"],disabled:!s}),a.jsx(X,{...t["stretch-horizontal"],disabled:!s}),a.jsx(X,{...t["align-top"],disabled:!s}),a.jsx(X,{...t["align-center-vertical"],disabled:!s}),a.jsx(X,{...t["align-bottom"],disabled:!s}),a.jsx(X,{...t["stretch-vertical"],disabled:!s})]})}function tge(){const t=xe(),e=bs(3),n=Vo(),s=e&&n;return a.jsxs(a.Fragment,{children:[a.jsx(X,{...t["distribute-horizontal"],disabled:!s}),a.jsx(X,{...t["distribute-vertical"],disabled:!s})]})}function nge(){const t=xe(),e=LU(),n=Vo(),s=e&&n;return a.jsxs(a.Fragment,{children:[a.jsx(X,{...t["stack-horizontal"],disabled:!s}),a.jsx(X,{...t["stack-vertical"],disabled:!s})]})}function sge(){const t=xe(),e=bs(1),n=Vo(),s=e&&n;return a.jsxs(a.Fragment,{children:[a.jsx(X,{...t["send-to-back"],disabled:!s}),a.jsx(X,{...t["send-backward"],disabled:!s}),a.jsx(X,{...t["bring-forward"],disabled:!s}),a.jsx(X,{...t["bring-to-front"],disabled:!s})]})}function ige(){return Ss()<Ht.TABLET_SM?a.jsx(rge,{}):a.jsx(oge,{})}function rge(){const t=xe(),e=K(),n=Z("zoom is 1",()=>e.getZoomLevel()===1,[e]);return a.jsx(X,{...t["zoom-to-100"],disabled:n})}function oge(){const t=xe(),e=bs(1),n=Vo(),s=e&&n;return a.jsx(X,{...t["rotate-ccw"],disabled:!s})}function age(){const t=xe(),e=bs(1),n=Vo(),s=e&&n;return a.jsx(X,{...t["rotate-cw"],disabled:!s})}function lge(){const t=xe(),e=$U(),n=Vo(),s=e&&n;return a.jsx(X,{...t["edit-link"],disabled:!s})}function cge(){const t=FU(),e=BU();return t?a.jsx(nR,{}):e?a.jsx(dge,{}):a.jsx(nR,{})}function nR(){const t=xe(),e=bs(2),n=Vo(),s=e&&n;return a.jsx(X,{...t.group,disabled:!s})}function dge(){const t=xe();return a.jsx(X,{...t.ungroup})}const uge=S.memo(function({children:e}){const n=$e(),s=Ss(),i=Ho(),r=K(),o=Z("should display quick actions when in readonly",()=>r.isInAny("hand","zoom"),[r]),l=e??a.jsx(Qfe,{});if(!(i&&!o))return a.jsxs(G1,{id:"actions-menu",children:[a.jsx(V1,{children:a.jsx(be,{type:"icon","data-testid":"actions-menu.button",title:n("actions-menu.title"),children:a.jsx(Be,{icon:"dots-vertical",small:!0})})}),a.jsx(K1,{side:s>=Ht.TABLET?"bottom":"top",sideOffset:6,children:a.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:a.jsx(Ai,{type:"icons",sourceId:"actions-menu",children:l})})})]})});function Hs({id:t,kbd:e,label:n,readonlyOk:s,onSelect:i,toggle:r=!1,disabled:o=!1,checked:l=!1}){const{type:c,sourceId:d}=mS(),u=Ho(),h=$e();if(u&&!s)return null;const p=kp(n,c),f=p?h(p):void 0;switch(c){case"menu":return a.jsxs(Gfe,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:f,onSelect:g=>{i==null||i(d),Ve(g)},disabled:o,checked:l,children:[a.jsx(Hr,{small:!0,icon:r?l?"toggle-on":"toggle-off":l?"check":"none"}),f&&a.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&a.jsx(Kh,{children:e})]});case"context-menu":return a.jsxs(vfe,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:f,onSelect:g=>{i(d),Ve(g)},disabled:o,checked:l,children:[a.jsx(Hr,{small:!0,icon:r?l?"toggle-on":"toggle-off":l?"check":"none"}),f&&a.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&a.jsx(Kh,{children:e})]},t);default:return null}}function ke({id:t,label:e,children:n}){const{type:s,sourceId:i}=mS(),r=$e(),o=kp(e,s),l=o?r(o):void 0;switch(s){case"panel":return a.jsx("div",{className:"tlui-menu__group","data-testid":`${i}-group.${t}`,children:n});case"menu":return a.jsx(Jfe,{"data-testid":`${i}-group.${t}`,children:n});case"context-menu":return a.jsx(z$,{dir:"ltr",className:"tlui-menu__group","data-testid":`${i}-group.${t}`,children:n});case"keyboard-shortcuts":return a.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${i}-group.${t}`,children:[a.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:l}),a.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:n})]});default:return n}}function ws({id:t,disabled:e=!1,label:n,size:s="small",children:i}){const{type:r,sourceId:o}=mS(),l=vn(),c=$e(),d=n?typeof n=="string"?n:n[r]??n.default:void 0,u=d?c(d):void 0;switch(r){case"menu":return a.jsxs(Xfe,{id:`${o}-sub.${t}`,children:[a.jsx(qfe,{id:`${o}-sub.${u?u.toLowerCase()+"-button":""}`,disabled:e,label:u,title:u}),a.jsx(Zfe,{id:`${o}-sub.${u?u.toLowerCase()+"-content":""}`,size:s,children:i})]});case"context-menu":return e?null:a.jsxs(hge,{id:`${o}-sub.${t}`,children:[a.jsx(K$,{dir:"ltr",disabled:e,asChild:!0,children:a.jsxs(be,{"data-testid":`${o}-sub-trigger.${t}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[a.jsx(Yt,{children:u}),a.jsx(Be,{icon:"chevron-right",small:!0})]})}),a.jsx(iI,{container:l,children:a.jsx(Y$,{"data-testid":`${o}-sub-content.${t}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":s,children:i})})]});default:return i}}function hge({id:t,children:e}){const[n,s]=Go(t);return a.jsx(V$,{open:n,onOpenChange:s,children:e})}function c4(){const t=xe();return ope()?a.jsx(X,{...t["toggle-auto-size"]}):null}function d4(){const t=xe();return $U()?a.jsx(X,{...t["edit-link"]}):null}function pge(){const t=xe();return bs(1)?a.jsx(X,{...t.duplicate}):null}function u4(){const t=xe(),e=K();return Z("should display flatten option",()=>{if(e.getSelectedShapeIds().length===0)return!1;const i=e.getOnlySelectedShape();return!(i&&e.isShapeOfType(i,"image"))},[e])?a.jsx(X,{...t["flatten-to-image"]}):null}function h4(){const t=xe();return FU()?a.jsx(X,{...t.group}):null}function p4(){const t=xe();return BU()?a.jsx(X,{...t.ungroup}):null}function f4(){const t=K(),e=xe();return Z("allow unframe",()=>{const s=t.getSelectedShapes();return s.length===0?!1:s.every(i=>t.isShapeOfType(i,"frame"))},[t])?a.jsx(X,{...e["remove-frame"]}):null}function g4(){const t=K(),e=xe();return Z("allow fit frame to content",()=>{const s=t.getOnlySelectedShape();return s?t.isShapeOfType(s,"frame")&&t.getSortedChildIdsForParent(s).length>0:!1},[t])?a.jsx(X,{...e["fit-frame-to-content"]}):null}function m4(){const t=K(),e=xe();return Z("selected shapes",()=>t.getSelectedShapes().length>0,[t])?a.jsx(X,{...e["toggle-lock"]}):null}function lI(){const t=xe(),e=K(),n=Z("isTransparentBg",()=>!e.getInstanceState().exportBackground,[e]);return a.jsx(Hs,{...t["toggle-transparent"],checked:n,toggle:!0})}function fge(){const t=K(),e=xe(),n=Z("any shapes",()=>t.getCurrentPageShapeIds().size>0,[t]);return a.jsx(X,{...e["unlock-all"],disabled:!n})}function y4(){const t=K(),e=Z("zoomed to 100",()=>t.getZoomLevel()===1,[t]),n=xe();return a.jsx(X,{...n["zoom-to-100"],noClose:!0,disabled:e})}function v4(){const t=K(),e=Z("has shapes",()=>t.getCurrentPageShapeIds().size>0,[t]),n=xe();return a.jsx(X,{...n["zoom-to-fit"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function x4(){const t=K(),e=Z("has shapes",()=>t.getSelectedShapeIds().length>0,[t]),n=xe();return a.jsx(X,{...n["zoom-to-selection"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function S4(){return a.jsxs(ke,{id:"clipboard",children:[a.jsx(mge,{}),a.jsx(yge,{}),a.jsx(vge,{}),a.jsx(pge,{}),a.jsx(xge,{})]})}function gge(){var s;const t=K(),e=xe(),n=Z("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return a.jsxs(ws,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!n,children:[a.jsxs(ke,{id:"copy-as-group",children:[a.jsx(X,{...e["copy-as-svg"]}),!!((s=window.navigator.clipboard)!=null&&s.write)&&a.jsx(X,{...e["copy-as-png"]}),a.jsx(X,{...e["copy-as-json"]})]}),a.jsx(ke,{id:"copy-as-bg",children:a.jsx(lI,{})})]})}function mge(){const t=xe(),e=bs(1);return a.jsx(X,{...t.cut,disabled:!e})}function yge(){const t=xe(),e=UU(1);return a.jsx(X,{...t.copy,disabled:!e})}function vge(){const t=xe(),e=rpe;return a.jsx(X,{...t.paste,disabled:!e})}function b4(){const t=K(),e=xe();return Z("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t])?a.jsxs(ke,{id:"conversions",children:[a.jsx(gge,{}),a.jsxs(ws,{id:"export-as",label:"context-menu.export-as",size:"small",children:[a.jsxs(ke,{id:"export-as-group",children:[a.jsx(X,{...e["export-as-svg"]}),a.jsx(X,{...e["export-as-png"]}),a.jsx(X,{...e["export-as-json"]})]}),a.jsx(ke,{id:"export-as-bg",children:a.jsx(lI,{})})]})]}):null}function w4(){const t=xe(),e=K(),n=Z("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e]);return a.jsx(X,{...t["select-all"],disabled:!n})}function xge(){const t=xe(),e=bs(1);return a.jsx(X,{...t.delete,disabled:!e})}function Sge(){return UU(1)?a.jsxs(ws,{id:"edit",label:"context-menu.edit",size:"small",children:[a.jsx(h4,{}),a.jsx(p4,{}),a.jsx(u4,{}),a.jsx(d4,{}),a.jsx(g4,{}),a.jsx(f4,{}),a.jsx(C4,{}),a.jsx(_4,{}),a.jsx(c4,{}),a.jsx(m4,{})]}):null}function bge(){const t=bs(2),e=ape(),n=xe();return t||e?a.jsxs(ws,{id:"arrange",label:"context-menu.arrange",size:"small",children:[t&&a.jsxs(ke,{id:"align",children:[a.jsx(X,{...n["align-left"]}),a.jsx(X,{...n["align-center-horizontal"]}),a.jsx(X,{...n["align-right"]}),a.jsx(X,{...n["align-top"]}),a.jsx(X,{...n["align-center-vertical"]}),a.jsx(X,{...n["align-bottom"]})]}),a.jsx(wge,{}),t&&a.jsxs(ke,{id:"stretch",children:[a.jsx(X,{...n["stretch-horizontal"]}),a.jsx(X,{...n["stretch-vertical"]})]}),(t||e)&&a.jsxs(ke,{id:"flip",children:[a.jsx(X,{...n["flip-horizontal"]}),a.jsx(X,{...n["flip-vertical"]})]}),a.jsx(_ge,{})]}):null}function wge(){const t=xe();return bs(3)?a.jsxs(ke,{id:"distribute",children:[a.jsx(X,{...t["distribute-horizontal"]}),a.jsx(X,{...t["distribute-vertical"]})]}):null}function _ge(){const t=xe(),e=bs(2),n=LU();return e?a.jsxs(ke,{id:"order",children:[a.jsx(X,{...t.pack}),n&&a.jsx(X,{...t["stack-horizontal"]}),n&&a.jsx(X,{...t["stack-vertical"]})]}):null}function Cge(){const t=xe();return bs(1)?a.jsx(ws,{id:"reorder",label:"context-menu.reorder",size:"small",children:a.jsxs(ke,{id:"reorder",children:[a.jsx(X,{...t["bring-to-front"]}),a.jsx(X,{...t["bring-forward"]}),a.jsx(X,{...t["send-backward"]}),a.jsx(X,{...t["send-to-back"]})]})}):null}function Ege(){const t=K(),e=Z("pages",()=>t.getPages(),[t]),n=Z("current page id",()=>t.getCurrentPageId(),[t]),{addToast:s}=dr(),i=xe(),r=Dn();return bs(1)?a.jsxs(ws,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[a.jsx(ke,{id:"pages",children:e.map(l=>a.jsx(X,{id:l.id,disabled:n===l.id,label:l.name,onSelect:()=>{t.mark("move_shapes_to_page"),t.moveShapesToPage(t.getSelectedShapeIds(),l.id);const c=t.getPage(l.id);c&&s({title:"Changed Page",description:`Moved to ${c.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{t.mark("change-page"),t.setCurrentPage(n)}}]}),r("move-to-page",{source:"context-menu"})}},l.id))}),a.jsx(ke,{id:"new-page",children:a.jsx(X,{...i["move-to-new-page"]})})]}):null}function _4(){const t=K(),e=xe();return Z("oneEmbedSelected",()=>{const s=t.getOnlySelectedShape();return s?!!(t.isShapeOfType(s,"embed")&&s.props.url&&!t.isShapeOrAncestorLocked(s)):!1},[t])?a.jsx(X,{...e["convert-to-bookmark"]}):null}function C4(){const t=K(),e=xe();return Z("oneEmbeddableBookmarkSelected",()=>{const s=t.getOnlySelectedShape();return s?!!(t.isShapeOfType(s,"bookmark")&&s.props.url&&ba(s.props.url)&&!t.isShapeOrAncestorLocked(s)):!1},[t])?a.jsx(X,{...e["convert-to-embed"]}):null}function Tge(){const t=xe(),e=K(),n=Z("isSnapMode",()=>e.user.getIsSnapMode(),[e]);return a.jsx(Hs,{...t["toggle-snap-mode"],checked:n})}function Ige(){const t=xe(),e=K(),n=Z("isToolLock",()=>e.getInstanceState().isToolLocked,[e]);return a.jsx(Hs,{...t["toggle-tool-lock"],checked:n})}function Pge(){const t=xe(),e=K(),n=Z("isGridMode",()=>e.getInstanceState().isGridMode,[e]);return a.jsx(Hs,{...t["toggle-grid"],checked:n})}function kge(){const t=xe(),e=K(),n=Z("isWrapMode",()=>e.user.getIsWrapMode(),[e]);return a.jsx(Hs,{...t["toggle-wrap-mode"],checked:n})}function jge(){const t=xe(),e=K(),n=Z("isFocusMode",()=>e.getInstanceState().isFocusMode,[e]);return a.jsx(Hs,{...t["toggle-focus-mode"],checked:n})}function Nge(){const t=xe(),e=K(),n=Z("edgeScrollSpeed",()=>e.user.getEdgeScrollSpeed(),[e]);return a.jsx(Hs,{...t["toggle-edge-scrolling"],checked:n===1})}function Age(){const t=xe(),e=K(),n=Z("animationSpeed",()=>e.user.getAnimationSpeed(),[e]);return a.jsx(Hs,{...t["toggle-reduce-motion"],checked:n===0})}function Rge(){const t=xe(),e=K(),n=Z("isDebugMode",()=>e.getInstanceState().isDebugMode,[e]);return a.jsx(Hs,{...t["toggle-debug-mode"],checked:n})}function Mge(){const t=xe(),e=K(),n=Z("dynamic resize",()=>e.user.getIsDynamicResizeMode(),[e]);return a.jsx(Hs,{...t["toggle-dynamic-size-mode"],checked:n})}function Oge(){const t=xe(),e=K(),n=Z("paste at cursor",()=>e.user.getIsPasteAtCursorMode(),[e]);return a.jsx(Hs,{...t["toggle-paste-at-cursor"],checked:n})}function Dge(){const t=K(),e=xe();return Z("show cursor chat",()=>t.getCurrentToolId()==="select"&&!t.getInstanceState().isCoarsePointer,[t])?a.jsx(X,{...e["open-cursor-chat"]}):null}function Lge(){const t=K(),e=cS();return Z("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t])?a.jsxs(a.Fragment,{children:[e&&a.jsx(Dge,{}),a.jsxs(ke,{id:"modify",children:[a.jsx(Sge,{}),a.jsx(bge,{}),a.jsx(Cge,{}),a.jsx(Ege,{})]}),a.jsx(S4,{}),a.jsx(b4,{}),a.jsx(ke,{id:"select-all",children:a.jsx(w4,{})})]}):null}const Fge=S.memo(function({children:e}){const n=K(),{Canvas:s}=kt(),i=S.useCallback(d=>{if(d){if(n.getInstanceState().isCoarsePointer){const u=n.getSelectedShapes(),{inputs:{currentPagePoint:h}}=n,p=n.getShapesAtPoint(h);if(!n.getSelectedShapes().length||!p.some(f=>u.includes(f))){const f=p.filter(g=>n.isShapeOrAncestorLocked(g));f.length&&n.select(...f.map(g=>g.id))}}}else{const u=n.getOnlySelectedShape();u&&n.isShapeOrAncestorLocked(u)&&n.setSelectedShapes([])}},[n]),r=vn(),[o,l]=Go("context menu",i),c=e??a.jsx(Lge,{});return a.jsxs(ffe,{dir:"ltr",onOpenChange:l,modal:!1,children:[a.jsx(gfe,{onContextMenu:void 0,dir:"ltr",children:s?a.jsx(s,{}):null}),o&&a.jsx(mfe,{container:r,children:a.jsx(yfe,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:Ve,children:a.jsx(Ai,{type:"context-menu",sourceId:"context-menu",children:c})})})]})}),Bge=2e3,Uge=5e3,$ge=yn(function(){const e=K(),{isChatting:n,chatMessage:s}=e.getInstanceState(),i=S.useRef(-1),[r,o]=S.useState("");return S.useEffect(()=>{if(!n&&s||n){const c=n?Uge:Bge;i.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},c)}return()=>{clearTimeout(i.current)}},[e,s,n]),n?a.jsx(Wge,{value:r,setValue:o,chatMessage:s}):s.trim()?a.jsx(zge,{chatMessage:s}):null});function E4(t){const e=K();S.useLayoutEffect(()=>{var o;if(!t.current)return;const{x:s,y:i}=e.inputs.currentScreenPoint;(o=t.current)==null||o.style.setProperty("transform",`translate(${s}px, ${i}px)`);function r(l){var u;const{minX:c,minY:d}=e.getViewportScreenBounds();(u=t.current)==null||u.style.setProperty("transform",`translate(${l.clientX-c}px, ${l.clientY-d}px)`)}return window.addEventListener("pointermove",r),()=>{window.removeEventListener("pointermove",r)}},[t,e])}const zge=({chatMessage:t})=>{const e=K(),n=S.useRef(null);return E4(n),a.jsx("div",{ref:n,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:t})},Wge=yn(function({chatMessage:e,value:n,setValue:s}){const i=K(),r=$e(),o=S.useRef(null),l=e||r("cursor-chat.type-to-chat");E4(o),S.useLayoutEffect(()=>{const p=o.current;if(!p)return;const f=i.textMeasure.measureText(n||l,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});p.style.setProperty("width",f.w+"px")},[i,n,l]),S.useLayoutEffect(()=>{const p=i.timers.requestAnimationFrame(()=>{var f;(f=o.current)==null||f.focus()});return()=>{cancelAnimationFrame(p)}},[i]);const c=S.useCallback(()=>{i.updateInstanceState({isChatting:!1}),i.focus()},[i]),d=S.useCallback(p=>{const{value:f}=p.target;s(f.slice(0,64)),i.updateInstanceState({chatMessage:f})},[i,s]),u=S.useCallback(p=>{const f=o.current;if(!f)return;const{value:g}=f;switch(p.key){case"Enter":{if(Ve(p),p.stopPropagation(),!g){c();return}s("");break}case"Escape":{Ve(p),p.stopPropagation(),c();break}}},[c,s]),h=S.useCallback(p=>{p.stopPropagation()},[]);return a.jsx("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:i.user.getColor()},onBlur:c,onChange:d,onKeyDown:u,onPaste:h,value:n,placeholder:l,spellCheck:!1})});function PC({checked:t}){return a.jsx(Hr,{icon:t?"check":"none",className:"tlui-button__icon",small:!0})}function Hge(){const t=K(),{addToast:e}=dr(),{addDialog:n}=pc(),[s,i]=Oe.useState(!1);return a.jsxs(a.Fragment,{children:[a.jsxs(ke,{id:"items",children:[a.jsx(X,{id:"add-toast",onSelect:()=>{e({id:Rt(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:Rt(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Rt(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Rt(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),a.jsx(X,{id:"show-dialog",label:"Show dialog",onSelect:()=>{n({component:({onClose:r})=>a.jsx(Kge,{displayDontShowAgain:!0,onCancel:()=>r(),onContinue:()=>r()}),onClose:()=>{}})}}),a.jsx(X,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>Yge(t,100)}),a.jsx(X,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var l;const r=t.getSelectedShapes(),o=r.length===0?t.getRenderingShapes():r;window.alert(`Shapes ${o.length}, DOM nodes:${(l=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:l.length}`)}}),(()=>{if(s)throw Error("oh no!");return null})(),a.jsx(X,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"}),a.jsx(X,{id:"hard-reset",onSelect:l5,label:"Hard reset"})]}),a.jsxs(ke,{id:"flags",children:[a.jsx(Gge,{}),a.jsx(Vge,{})]})]})}function Gge(){const t=Object.values(Kt);return t.length?a.jsx(ws,{id:"debug flags",label:"Debug Flags",children:a.jsx(ke,{id:"debug flags",children:t.map(e=>a.jsx(T4,{flag:e},e.name))})}):null}function Vge(){const t=Object.values(jT);return t.length?a.jsx(ws,{id:"feature flags",label:"Feature Flags",children:a.jsx(ke,{id:"feature flags",children:t.map(e=>a.jsx(T4,{flag:e},e.name))})}):null}function Kge({title:t="title",body:e="hello hello hello",cancel:n="Cancel",confirm:s="Continue",displayDontShowAgain:i=!1,onCancel:r,onContinue:o}){const[l,c]=Oe.useState(!1);return a.jsxs(a.Fragment,{children:[a.jsxs(iS,{children:[a.jsx(rS,{children:t}),a.jsx(oS,{})]}),a.jsx(Pp,{style:{maxWidth:350},children:e}),a.jsxs(k1,{className:"tlui-dialog__footer__actions",children:[i&&a.jsxs(be,{type:"normal",onClick:()=>c(!l),style:{marginRight:"auto"},children:[a.jsx(PC,{checked:l}),a.jsx(Yt,{children:"Dont show again"})]}),a.jsx(be,{type:"normal",onClick:r,children:a.jsx(Yt,{children:n})}),a.jsx(be,{type:"primary",onClick:async()=>o(),children:a.jsx(Yt,{children:s})})]})]})}const T4=yn(function({flag:e,onChange:n}){const s=e.get();return a.jsx(Hs,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,i=>`${i[0]} ${i[1].toLowerCase()}`).replace(/^[a-z]/,i=>i.toUpperCase()),checked:s,onSelect:()=>{e.set(!s),n==null||n(!s)}})});let sR=0;function Yge(t,e){const n=Array(e),s=Math.floor(Math.sqrt(e));for(let i=0;i<e;i++)sR++,n[i]={id:it("box"+sR),type:"geo",x:i%s*132,y:Math.floor(i/s)*132};t.run(()=>{t.createShapes(n).setSelectedShapes(n.map(i=>i.id))})}function Xge({children:t}){const e=t??a.jsx(Hge,{});return a.jsxs(Ql,{id:"debug",children:[a.jsx(ec,{children:a.jsx(be,{type:"icon",title:"Debug menu",children:a.jsx(Be,{icon:"dots-horizontal"})})}),a.jsx(tc,{side:"top",align:"end",alignOffset:0,children:a.jsx(Ai,{type:"menu",sourceId:"debug-panel",children:e})})]})}const qge=S.memo(function(){const{DebugMenu:e}=ll();return a.jsxs("div",{className:"tlui-debug-panel",children:[a.jsx(Jge,{}),a.jsx(Qge,{}),e&&a.jsx(e,{})]})});function Zge(t=!0){const[e,n]=S.useState(0),s=K();S.useEffect(()=>{if(!t)return;const i=()=>n(r=>r+1);return s.on("tick",i),()=>{s.off("tick",i)}},[s,t])}const Jge=yn(function(){Zge();const e=K(),n=e.getPath(),s=e.getHoveredShape(),i=e.getOnlySelectedShape(),r=n==="select.idle"||!n.includes("select.")?s:i,o=r&&n.includes("select.")?` / ${r.type||""}${"geo"in r.props?" / "+r.props.geo:""} / [${E.ToInt(e.getPointInShapeSpace(r,e.inputs.currentPagePoint))}]`:"",l=n.startsWith("select.")&&!n.includes(".idle")?` / [${E.ToInt(e.inputs.originPagePoint)}]  [${E.ToInt(e.inputs.currentPagePoint)}] = ${E.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return a.jsx("div",{className:"tlui-debug-panel__current-state",children:`${n}${o}${l}`})});function Qge(){const t=K(),e=Z("show_fps",()=>Kt.showFps.get(),[Kt]),n=S.useRef(null);return S.useEffect(()=>{if(!e)return;const s=250;let i=0,r=-1,o=performance.now(),l=0,c=0,d=!1;function u(){if(c++,l=performance.now()-o,l>s){const h=Math.round(c*(s/l)*(1e3/s));h>i&&(i=h);const p=i*.75;(h<p&&!d||h>=p&&d)&&(d=!d),n.current.innerHTML=`FPS ${h.toString()}`,n.current.className="tlui-debug-panel__fps"+(d?" tlui-debug-panel__fps__slow":""),l-=s,c=0,o=performance.now()}r=t.timers.requestAnimationFrame(u)}return u(),()=>{cancelAnimationFrame(r)}},[e,t]),e?a.jsx("div",{ref:n}):null}const eme=S.memo(function(){const e=Ss(),{MainMenu:n,QuickActions:s,ActionsMenu:i,PageMenu:r}=ll();return!n&&!r&&e<6?null:a.jsx("div",{className:"tlui-menu-zone",children:a.jsxs("div",{className:"tlui-buttons__horizontal",children:[n&&a.jsx(n,{}),r&&a.jsx(r,{}),e<6?null:a.jsxs(a.Fragment,{children:[s&&a.jsx(s,{}),i&&a.jsx(i,{})]})]})})});function tme(){const t=K(),e=xe(),[n,s]=S.useState(!1),i=S.useRef(!1);return Aa("toggle showback to content",()=>{const r=i.current,o=t.getCurrentPageShapeIds();let l=!1;o.size&&(l=o.size===t.getCulledShapes().size),r!==l&&(s(l),i.current=l)},[t]),n?a.jsx(X,{...e["back-to-content"],onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),s(!1)}}):null}function nme(){const t=K(),e=xe();return Z("is pen mode",()=>t.getInstanceState().isPenMode,[t])?a.jsx(X,{...e["exit-pen-mode"]}):null}function sme(){const t=K(),e=xe();return Z("is following user",()=>!!t.getInstanceState().followingUserId,[t])?a.jsx(X,{...e["stop-following"]}):null}function ime(){return a.jsxs(a.Fragment,{children:[a.jsx(nme,{}),a.jsx(tme,{}),a.jsx(sme,{})]})}function rme({children:t}){const e=t??a.jsx(ime,{});return a.jsx("div",{className:"tlui-helper-buttons",children:a.jsx(Ai,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function ome(){const t=xe(),e=lS(),n=cS();return a.jsxs(a.Fragment,{children:[a.jsxs(ke,{label:"shortcuts-dialog.tools",id:"tools",children:[a.jsx(X,{...t["toggle-tool-lock"]}),a.jsx(X,{...t["insert-media"]}),a.jsx(X,{...e.select}),a.jsx(X,{...e.draw}),a.jsx(X,{...e.eraser}),a.jsx(X,{...e.hand}),a.jsx(X,{...e.rectangle}),a.jsx(X,{...e.ellipse}),a.jsx(X,{...e.arrow}),a.jsx(X,{...e.line}),a.jsx(X,{...e.text}),a.jsx(X,{...e.frame}),a.jsx(X,{...e.note}),a.jsx(X,{...e.laser})]}),a.jsxs(ke,{label:"shortcuts-dialog.preferences",id:"preferences",children:[a.jsx(X,{...t["toggle-dark-mode"]}),a.jsx(X,{...t["toggle-focus-mode"]}),a.jsx(X,{...t["toggle-grid"]})]}),a.jsxs(ke,{label:"shortcuts-dialog.edit",id:"edit",children:[a.jsx(X,{...t.undo}),a.jsx(X,{...t.redo}),a.jsx(X,{...t.cut}),a.jsx(X,{...t.copy}),a.jsx(X,{...t.paste}),a.jsx(X,{...t["select-all"]}),a.jsx(X,{...t.delete}),a.jsx(X,{...t.duplicate})]}),a.jsxs(ke,{label:"shortcuts-dialog.view",id:"view",children:[a.jsx(X,{...t["zoom-in"]}),a.jsx(X,{...t["zoom-out"]}),a.jsx(X,{...t["zoom-to-100"]}),a.jsx(X,{...t["zoom-to-fit"]}),a.jsx(X,{...t["zoom-to-selection"]})]}),a.jsxs(ke,{label:"shortcuts-dialog.transform",id:"transform",children:[a.jsx(X,{...t["bring-to-front"]}),a.jsx(X,{...t["bring-forward"]}),a.jsx(X,{...t["send-backward"]}),a.jsx(X,{...t["send-to-back"]}),a.jsx(X,{...t.group}),a.jsx(X,{...t.ungroup}),a.jsx(X,{...t["flip-horizontal"]}),a.jsx(X,{...t["flip-vertical"]}),a.jsx(X,{...t["align-top"]}),a.jsx(X,{...t["align-center-vertical"]}),a.jsx(X,{...t["align-bottom"]}),a.jsx(X,{...t["align-left"]}),a.jsx(X,{...t["align-center-horizontal"]}),a.jsx(X,{...t["align-right"]})]}),n&&a.jsx(ke,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:a.jsx(X,{...t["open-cursor-chat"]})})]})}const ame=S.memo(function({children:e}){const n=$e(),s=Ss(),i=e??a.jsx(ome,{});return a.jsxs(a.Fragment,{children:[a.jsxs(iS,{className:"tlui-shortcuts-dialog__header",children:[a.jsx(rS,{children:n("shortcuts-dialog.title")}),a.jsx(oS,{})]}),a.jsx(Pp,{className:Se("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":s<=Ht.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":s<=Ht.TABLET}),children:a.jsx(Ai,{type:"keyboard-shortcuts",sourceId:"kbd",children:i})}),a.jsx("div",{className:"tlui-dialog__scrim"})]})}),lme=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function cme(){const t=K(),e=Dn(),n=Z("colorScheme",()=>t.user.getUserPreferences().colorScheme??t.user.getIsDarkMode()?"dark":"light",[t]);return a.jsx(ws,{id:"help menu color-scheme",label:"menu.theme",children:a.jsx(ke,{id:"languages",children:lme.map(({colorScheme:s,label:i})=>a.jsx(Hs,{id:`color-scheme-${s}`,label:i,checked:s===n,onSelect:()=>{t.user.updateUserPreferences({colorScheme:s}),e("color-scheme",{source:"menu",value:s})}},s))})})}function I4(){const t=K(),e=Dn(),n=Z("locale",()=>t.user.getLocale(),[t]);return a.jsx(ws,{id:"help menu language",label:"menu.language",children:a.jsx(ke,{id:"languages",children:Tp.map(({locale:s,label:i})=>a.jsx(Hs,{id:`language-${s}`,title:s,label:i,checked:s===n,onSelect:()=>{t.user.updateUserPreferences({locale:s}),e("change-language",{source:"menu",locale:s})}},s))})})}function dme(){return a.jsxs(a.Fragment,{children:[a.jsx(I4,{}),a.jsx(P4,{})]})}function P4(){const{KeyboardShortcutsDialog:t}=ll(),{addDialog:e}=pc();return t?a.jsx(X,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{e({component:t})}}):null}function ume(){return a.jsxs(a.Fragment,{children:[a.jsx(pme,{}),a.jsx(yme,{}),a.jsx(hme,{}),a.jsx(vme,{}),a.jsx(Sme,{}),a.jsx(xme,{})]})}function hme(){const t=xe();return a.jsxs(ws,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[a.jsxs(ke,{id:"export-all-as-group",children:[a.jsx(X,{...t["export-all-as-svg"]}),a.jsx(X,{...t["export-all-as-png"]}),a.jsx(X,{...t["export-all-as-json"]})]}),a.jsx(ke,{id:"export-all-as-bg",children:a.jsx(lI,{})})]})}function pme(){const t=K(),e=Z("isSelectToolActive",()=>t.getCurrentToolId()==="select",[t]);return a.jsxs(ws,{id:"edit",label:"menu.edit",disabled:!e,children:[a.jsx(mme,{}),a.jsx(S4,{}),a.jsx(b4,{}),a.jsx(fme,{}),a.jsx(gme,{}),a.jsx(ke,{id:"select-all",children:a.jsx(w4,{})})]})}function fme(){return a.jsxs(ke,{id:"misc",children:[a.jsx(h4,{}),a.jsx(p4,{}),a.jsx(d4,{}),a.jsx(c4,{}),a.jsx(f4,{}),a.jsx(g4,{}),a.jsx(C4,{}),a.jsx(_4,{}),a.jsx(u4,{})]})}function gme(){return a.jsxs(ke,{id:"lock",children:[a.jsx(m4,{}),a.jsx(fge,{})]})}function mme(){const t=xe(),e=WU(),n=zU();return a.jsxs(ke,{id:"undo-redo",children:[a.jsx(X,{...t.undo,disabled:!e}),a.jsx(X,{...t.redo,disabled:!n})]})}function yme(){const t=xe();return a.jsx(ws,{id:"view",label:"menu.view",children:a.jsxs(ke,{id:"view-actions",children:[a.jsx(X,{...t["zoom-in"]}),a.jsx(X,{...t["zoom-out"]}),a.jsx(y4,{}),a.jsx(v4,{}),a.jsx(x4,{})]})})}function vme(){const t=xe();return a.jsxs(ke,{id:"extras",children:[a.jsx(X,{...t["insert-embed"]}),a.jsx(X,{...t["insert-media"]})]})}function xme(){function t(e){window.open(e,"_blank")}return a.jsx(ke,{id:"help",children:a.jsx(ws,{id:"help",label:"menu.help",children:a.jsxs(ke,{id:"help-actions",children:[a.jsx(P4,{}),a.jsx(X,{id:"about",label:"help-menu.docs",icon:"external-link",readonlyOk:!0,onSelect:()=>{t("https://tldraw.dev")}})]})})})}function Sme(){return a.jsx(ke,{id:"preferences",children:a.jsxs(ws,{id:"preferences",label:"menu.preferences",children:[a.jsxs(ke,{id:"preferences-actions",children:[a.jsx(Tge,{}),a.jsx(Ige,{}),a.jsx(Pge,{}),a.jsx(kge,{}),a.jsx(jge,{}),a.jsx(Nge,{}),a.jsx(Age,{}),a.jsx(Mge,{}),a.jsx(Oge,{}),a.jsx(Rge,{})]}),a.jsx(ke,{id:"color-scheme",children:a.jsx(cme,{})}),a.jsx(ke,{id:"language",children:a.jsx(I4,{})})]})})}const bme=S.memo(function({children:e}){const n=vn(),[s,i]=Go("main menu"),r=$e(),o=e??a.jsx(ume,{});return a.jsxs(rI,{dir:"ltr",open:s,onOpenChange:i,modal:!1,children:[a.jsx(oI,{asChild:!0,dir:"ltr",children:a.jsx(be,{type:"icon","data-testid":"main-menu.button",title:r("menu.title"),children:a.jsx(Be,{icon:"menu",small:!0})})}),a.jsx(SS,{container:n,children:a.jsx(aI,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:a.jsx(Ai,{type:"menu",sourceId:"main-menu",children:o})})})]})}),Mw={};function Yu(t){if(Mw[t])return Mw[t];const n=document.createElement("canvas").getContext("2d");n.fillStyle=t,n.fillRect(0,0,1,1);const[s,i,r,o]=n.getImageData(0,0,1,1).data,l=new Float32Array([s/255,i/255,r/255,o/255]);return Mw[t]=l,l}const oy=10,k4=4*6*oy+12+4*12;function Oc(t,{center:e,radius:n,numArcSegments:s=20,startAngle:i=0,endAngle:r=tt,offset:o=0}){const l=(r-i)/s;let c=o;for(let d=i;d<r;d+=l)t[c++]=e.x,t[c++]=e.y,t[c++]=e.x+Math.cos(d)*n,t[c++]=e.y+Math.sin(d)*n,t[c++]=e.x+Math.cos(d+l)*n,t[c++]=e.y+Math.sin(d+l)*n;return t}function Dc(t,e,n,s,i,r){t[e++]=n,t[e++]=s,t[e++]=n,t[e++]=s+r,t[e++]=n+i,t[e++]=s,t[e++]=n+i,t[e++]=s,t[e++]=n,t[e++]=s+r,t[e++]=n+i,t[e++]=s+r}function wme(t,e,n){const s=oy;n=Math.min(n,Math.min(e.w,e.h)/2);const i=de.ExpandBy(e,-n);if(i.w<=0||i.h<=0)return Oc(t,{center:e.center,radius:n,numArcSegments:oy*4}),oy*4*6;let r=0;return Dc(t,r,i.minX,i.minY,i.w,i.h),r+=12,Dc(t,r,i.minX,e.minY,i.w,n),r+=12,Dc(t,r,i.maxX,i.minY,n,i.h),r+=12,Dc(t,r,i.minX,i.maxY,i.w,n),r+=12,Dc(t,r,e.minX,i.minY,n,i.h),r+=12,Oc(t,{numArcSegments:s,offset:r,center:i.point,radius:n,startAngle:Ze,endAngle:Ze*1.5}),r+=s*6,Oc(t,{numArcSegments:s,offset:r,center:E.Add(i.point,new E(i.w,0)),radius:n,startAngle:Ze*1.5,endAngle:tt}),r+=s*6,Oc(t,{numArcSegments:s,offset:r,center:E.Add(i.point,i.size),radius:n,startAngle:0,endAngle:vt}),r+=s*6,Oc(t,{numArcSegments:s,offset:r,center:E.Add(i.point,new E(0,i.h)),radius:n,startAngle:vt,endAngle:Ze}),k4}function _me(t){if(!t)throw new Error("Canvas element not found");const e=t.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const n=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,s=e.createShader(e.VERTEX_SHADER);if(!s)throw new Error("Failed to create vertex shader");if(e.shaderSource(s,n),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,r=e.createShader(e.FRAGMENT_SHADER);if(!r)throw new Error("Failed to create fragment shader");if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const o=e.createProgram();if(!o)throw new Error("Failed to create program");if(e.attachShader(o,s),e.attachShader(o,r),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(o);const l=e.getAttribLocation(o,"shapeVertexPosition");if(l<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(l);const c=e.getUniformLocation(o,"canvasPageBounds"),d=e.getUniformLocation(o,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:em(e,1024),unselectedShapes:em(e,4096),viewport:em(e,k4),collaborators:em(e,1024),prepareTriangles(p,f){e.bindBuffer(e.ARRAY_BUFFER,p.buffer),e.bufferData(e.ARRAY_BUFFER,p.vertices,e.STATIC_DRAW,0,f),e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(p){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,p/2),e.disable(e.BLEND)},drawTriangles(p){e.drawArrays(e.TRIANGLES,0,p/2)},setFillColor(p){e.uniform4fv(d,p)},setCanvasPageBounds(p){e.uniform4fv(c,p)}}}function em(t,e){const n=t.createBuffer();if(!n)throw new Error("Failed to create buffer");return{buffer:n,vertices:new Float32Array(e)}}function iR(t,e,n){let s=t.vertices.length;for(;s<e+n.length;)s*=2;if(s!=t.vertices.length){const i=new Float32Array(s);i.set(t.vertices),t.vertices=i}t.vertices.set(n,e)}var Cme=Object.defineProperty,Eme=Object.getOwnPropertyDescriptor,al=(t,e,n,s)=>{for(var i=Eme(e,n),r=t.length-1,o;r>=0;r--)(o=t[r])&&(i=o(e,n,i)||i);return i&&Cme(e,n,i),i};class Ko{constructor(e,n,s){b(this,"disposables",[]);b(this,"close",()=>this.disposables.forEach(e=>e()));b(this,"gl");b(this,"shapeGeometryCache");b(this,"colors");b(this,"id",Rt());b(this,"canvasBoundingClientRect",dn("canvasBoundingClientRect",new de));b(this,"originPagePoint",new E);b(this,"originPageCenter",new E);b(this,"isInViewport",!1);b(this,"getMinimapPagePoint",(e,n)=>{const s=this.getCanvasPageBounds(),i=this.getCanvasScreenBounds();let r=e-i.x,o=n-i.y;return r*=s.width/i.width,o*=s.height/i.height,r+=s.minX,o+=s.minY,new E(r,o,1)});b(this,"minimapScreenPointToPagePoint",(e,n,s=!1,i=!1)=>{const{editor:r}=this,o=r.getViewportPageBounds();let{x:l,y:c}=this.getMinimapPagePoint(e,n);if(i){const d=this.editor.getCurrentPageBounds()??new de,u=d.minX-o.width/2,h=d.maxX+o.width/2,p=d.minY-o.height/2,f=d.maxY+o.height/2,g=Math.max(0,u+o.width-l),y=Math.max(0,-(h-o.width-l)),x=Math.max(0,p+o.height-c),m=Math.max(0,-(f-o.height-c));l+=(g-y)/2,c+=(x-m)/2,l=on(l,u,h),c=on(c,p,f)}if(s){const{originPagePoint:d}=this,u=Math.abs(l-d.x),h=Math.abs(c-d.y);u>h?c=d.y:l=d.x}return new E(l,c)});b(this,"render",()=>{const e=this.gl.context,n=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=n.x,this.elem.height=n.y,e.viewport(0,0,n.x,n.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const s=new Set(this.editor.getSelectedShapeIds()),i=this.colors;let r=0,o=0;const l=this.editor.getCurrentPageShapeIdsSorted();for(let c=0,d=l.length;c<d;c++){const u=l[c],h=this.shapeGeometryCache.get(u);if(!h)continue;const p=h.length;s.has(u)?(iR(this.gl.selectedShapes,r,h),r+=p):(iR(this.gl.unselectedShapes,o,h),o+=p)}this.drawShapes(this.gl.unselectedShapes,o,i.shapeFill),this.drawShapes(this.gl.selectedShapes,r,i.selectFill),this.drawViewport(),this.drawCollaborators()});this.editor=e,this.elem=n,this.container=s,this.gl=_me(n),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",i=>{const r=e.getShapeMaskedPageBounds(i.id);if(!r)return null;const o=new Float32Array(12);return Dc(o,0,r.x,r.y,r.w,r.h),o}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),hc("minimap render",this.render))}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:Yu(e.getPropertyValue("--color-text-3").trim()),selectFill:Yu(e.getPropertyValue("--color-selected").trim()),viewportFill:Yu(e.getPropertyValue("--color-muted-1").trim()),background:Yu(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),n=this.editor.getCurrentPageBounds();return n?de.Expand(n,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),n=this.editor.pageToScreen(e.point),s=this.editor.pageToScreen(new E(e.maxX,e.maxY));return new de(n.x,n.y,s.x-n.x,s.y-n.y)}_getCanvasBoundingRect(){const{x:e,y:n,width:s,height:i}=this.elem.getBoundingClientRect();return new de(e,n,s,i)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const n=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(n)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),n=this.getDpr();return new E(e.width*n,e.height*n)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),n=this.getContentPageBounds(),s=e.width/e.height;let i=n.width,r=i/s;r<n.height&&(r=n.height,i=r*s);const o=new de(0,0,i,r);return o.center=n.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:n,w:s,h:i}=this.getCanvasPageBounds();return new Float32Array([e,n,s,i])}drawShapes(e,n,s){this.gl.prepareTriangles(e,n),this.gl.setFillColor(s),this.gl.drawTriangles(n)}drawViewport(){const e=this.editor.getViewportPageBounds(),n=wme(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,n),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(n),this.editor.environment.isSafari&&(this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n),this.gl.drawTrianglesTransparently(n))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const n=20,s=n*6,i=s*e.length;this.gl.collaborators.vertices.length<i&&(this.gl.collaborators.vertices=new Float32Array(i));const r=this.gl.collaborators.vertices;let o=0;const l=this.getZoom();for(const{cursor:c}of e)Oc(r,{center:E.From(c),radius:3*l,offset:o,numArcSegments:n}),o+=s;this.gl.prepareTriangles(this.gl.collaborators,i),o=0;for(const{color:c}of e)this.gl.setFillColor(Yu(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,o/2,s/2),o+=s}}al([te],Ko.prototype,"getDpr");al([te],Ko.prototype,"getContentPageBounds");al([te],Ko.prototype,"getContentScreenBounds");al([te],Ko.prototype,"getCanvasSize");al([te],Ko.prototype,"getCanvasClientPosition");al([te],Ko.prototype,"getCanvasPageBounds");al([te],Ko.prototype,"getZoom");al([te],Ko.prototype,"getCanvasPageBoundsArray");function Tme(){const t=K(),e=vn(),n=S.useRef(null),s=S.useRef(!1),i=S.useRef();S.useEffect(()=>{try{const u=new Ko(t,n.current,e);return i.current=u,i.current.close}catch(u){t.annotateError(u,{origin:"minimap",willCrashApp:!1}),t.timers.setTimeout(()=>{throw u})}},[t,e]);const r=S.useCallback(u=>{if(!t.getCurrentPageShapeIds().size||!i.current)return;const h=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),p=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);i.current.originPagePoint.setTo(p),i.current.originPageCenter.setTo(t.getViewportPageBounds().center),t.centerOnPoint(h,{animation:{duration:t.options.animationMediumMs}})},[t]),o=S.useCallback(u=>{if(!i.current)return;const h=u.currentTarget;if(ff(h,u),!t.getCurrentPageShapeIds().size)return;s.current=!0,i.current.isInViewport=!1;const p=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),f=t.getViewportPageBounds(),g=i.current.getContentPageBounds();if(new de(g.x-f.width/2,g.y-f.height/2,g.width+f.width,g.height+f.height).containsPoint(p)&&!f.containsPoint(p)){i.current.isInViewport=f.containsPoint(p);const m=E.Sub(f.center,f.point),v=E.Add(p,m);i.current.originPagePoint.setTo(v),i.current.originPageCenter.setTo(p),t.centerOnPoint(p,{animation:{duration:t.options.animationMediumMs}})}else{const m=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);i.current.isInViewport=f.containsPoint(m),i.current.originPagePoint.setTo(m),i.current.originPageCenter.setTo(f.center)}function x(m){h&&gf(h,m),s.current=!1,document.body.removeEventListener("pointerup",x)}document.body.addEventListener("pointerup",x)},[t]),l=S.useCallback(u=>{if(!i.current)return;const h=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,u.shiftKey,!0);if(s.current){if(i.current.isInViewport){const y=i.current.originPagePoint.clone().sub(i.current.originPageCenter);t.centerOnPoint(E.Sub(h,y));return}t.centerOnPoint(h)}const p=i.current.getMinimapPagePoint(u.clientX,u.clientY),f=t.pageToScreen(p),g={type:"pointer",target:"canvas",name:"pointer_move",...Os(u),point:f,isPen:t.getInstanceState().isPenMode};t.dispatch(g)},[t]),c=S.useCallback(u=>{const h=qF(u);t.dispatch({type:"wheel",name:"wheel",delta:h,point:new E(u.clientX,u.clientY),shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey})},[t]),d=Sf();return S.useEffect(()=>{t.timers.setTimeout(()=>{var u,h;(u=i.current)==null||u.updateColors(),(h=i.current)==null||h.render()})},[d,t]),a.jsx("div",{className:"tlui-minimap",children:a.jsx("canvas",{role:"img","aria-label":"minimap",ref:n,className:"tlui-minimap__canvas",onDoubleClick:r,onPointerMove:l,onPointerDown:o,onWheel:c})})}function Ime(t,e){const[n,s]=Oe.useState(e);Oe.useLayoutEffect(()=>{const r=IT(t);if(r)try{s(JSON.parse(r))}catch{console.error(`Could not restore value ${t} from local storage.`)}},[t]);const i=Oe.useCallback(r=>{s(o=>{const l=typeof r=="function"?r(o):r;return PT(t,JSON.stringify(l)),l})},[t]);return[n,i]}const Pme=S.memo(function(){const e=xe(),n=$e(),s=Ss(),[i,r]=Ime("minimap",!0),o=S.useCallback(()=>{r(d=>!d)},[r]),{ZoomMenu:l,Minimap:c}=ll();return s<Ht.MOBILE?null:a.jsxs("div",{className:"tlui-navigation-panel",children:[a.jsx("div",{className:"tlui-buttons__horizontal",children:l&&s<Ht.TABLET?a.jsx(l,{}):i?a.jsxs(a.Fragment,{children:[l&&a.jsx(l,{}),c&&a.jsx(be,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:a.jsx(Be,{icon:i?"chevrons-ne":"chevrons-sw"})})]}):a.jsxs(a.Fragment,{children:[a.jsx(be,{type:"icon","data-testid":"minimap.zoom-out",title:`${n(kp(e["zoom-out"].label))} ${IC(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:a.jsx(Be,{icon:"minus"})}),l&&a.jsx(l,{}),a.jsx(be,{type:"icon","data-testid":"minimap.zoom-in",title:`${n(kp(e["zoom-in"].label))} ${IC(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:a.jsx(Be,{icon:"plus"})}),c&&a.jsx(be,{type:"icon","data-testid":"minimap.toggle-button",title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:a.jsx(Be,{icon:i?"chevrons-ne":"chevrons-sw"})})]})}),c&&s>=Ht.TABLET&&!i&&a.jsx(c,{})]})}),kme=function({name:e,id:n,isCurrentPage:s}){const i=K(),r=Dn(),o=S.useRef(null),l=S.useCallback(()=>{i.mark("rename page")},[i]),c=S.useCallback(d=>{i.renamePage(n,d||"New Page"),r("rename-page",{source:"page-menu"})},[i,n,r]);return a.jsx(aS,{className:"tlui-page-menu__item__input",ref:d=>o.current=d,defaultValue:e,onValueChange:c,onFocus:l,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:s,autoSelect:!0})},kC=(t,e,n,s,i)=>{let r;const o=t.getPages(),l=n>s?o[s-1]:o[s],c=n>s?o[s]:o[s+1];l&&!c?r=Vi(l.index):!l&&c?r=HJ(o[0].index):r=_p(l.index,c.index),r!==o[n].index&&(t.mark("moving page"),t.updatePage({id:e,index:r}),i("move-page",{source:"page-menu"}))},rR=yn(function({index:e,listSize:n,item:s,onRename:i}){const r=K(),o=$e(),l=r.getPages(),c=Dn(),d=S.useCallback(()=>{r.mark("creating page");const f=No.createId();r.duplicatePage(s.id,f),c("duplicate-page",{source:"page-menu"})},[r,s,c]),u=S.useCallback(()=>{kC(r,s.id,e,e-1,c)},[r,s,e,c]),h=S.useCallback(()=>{kC(r,s.id,e,e+1,c)},[r,s,e,c]),p=S.useCallback(()=>{r.mark("deleting page"),r.deletePage(s.id),c("delete-page",{source:"page-menu"})},[r,s,c]);return a.jsxs(Ql,{id:`page item submenu ${e}`,children:[a.jsx(ec,{children:a.jsx(be,{type:"icon",title:o("page-menu.submenu.title"),children:a.jsx(Be,{icon:"dots-vertical"})})}),a.jsx(tc,{alignOffset:0,side:"right",sideOffset:-4,children:a.jsxs(Ai,{type:"menu",sourceId:"page-menu",children:[a.jsxs(ke,{id:"modify",children:[i&&a.jsx(X,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),a.jsx(X,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:d,disabled:l.length>=r.options.maxPages}),e>0&&a.jsx(X,{id:"move-up",onSelect:u,label:"page-menu.submenu.move-up"}),e<n-1&&a.jsx(X,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:h})]}),n>1&&a.jsx(ke,{id:"delete",children:a.jsx(X,{id:"delete",onSelect:p,label:"page-menu.submenu.delete"})})]})})]})}),jme=S.memo(function(){const e=K(),n=Dn(),s=$e(),i=Ss(),r=S.useCallback(()=>m(!1),[]),[o,l]=Go("page-menu",r),c=36,d=S.useRef(null),u=Z("pages",()=>e.getPages(),[e]),h=Z("currentPage",()=>e.getCurrentPage(),[e]),p=Z("currentPageId",()=>e.getCurrentPageId(),[e]),f=Ho(),g=Z("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),y=Z("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[x,m]=S.useState(!1),v=S.useCallback(()=>{f||m(j=>!j)},[f]),w=S.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[_,C]=S.useState(Object.fromEntries(u.map((j,A)=>[j.id,{y:A*c,offsetY:0,isSelected:!1}])));S.useLayoutEffect(()=>{C(Object.fromEntries(u.map((j,A)=>[j.id,{y:A*c,offsetY:0,isSelected:!1}])))},[c,u]),S.useEffect(()=>{o&&e.timers.requestAnimationFrame(()=>{const j=document.querySelector(`[data-testid="page-menu-item-${p}"]`);if(j){const A=d.current;if(!A)return;const B=j.offsetTop,L=A.scrollTop;B<L&&A.scrollTo({top:B});const $=B+c,M=A.scrollTop+A.offsetHeight;$>M&&A.scrollTo({top:$-A.offsetHeight})}})},[c,p,o,e]);const I=S.useCallback(j=>{const{clientY:A,currentTarget:B}=j,{dataset:{id:L,index:$}}=B;if(!L||!$)return;const M=w.current;ff(j.currentTarget,j),M.status="pointing",M.pointing={id:L,index:+$};const U=_[L].y;M.startY=A,M.startIndex=Math.max(0,Math.min(Math.round(U/c),u.length-1))},[c,u.length,_]),T=S.useCallback(j=>{const A=w.current;if(A.status==="pointing"){const{clientY:B}=j,L=B-A.startY;Math.abs(L)>5&&(A.status="dragging")}if(A.status==="dragging"){const{clientY:B}=j,L=B-A.startY,$=_[A.pointing.id],{startIndex:M,pointing:D}=A,U=$.y+L,z=Math.max(0,Math.min(Math.round(U/c),u.length-1)),H={..._};if(H[D.id]={y:$.y,offsetY:L,isSelected:!0},z!==A.dragIndex){A.dragIndex=z;for(let q=0;q<u.length;q++){const V=u[q];if(V.id===A.pointing.id)continue;let{y:ee}=H[V.id];z===M?ee=q*c:z<M?z<=q&&q<M?ee=(q+1)*c:ee=q*c:z>M&&(z>=q&&q>M?ee=(q-1)*c:ee=q*c),ee!==H[V.id].y&&(H[V.id]={y:ee,offsetY:0,isSelected:!0})}}C(H)}},[c,u,_]),P=S.useCallback(j=>{const A=w.current;if(A.status==="dragging"){const{id:B,index:L}=A.pointing;kC(e,B,L,A.dragIndex,n)}gf(j.currentTarget,j),A.status="idle"},[e,n]),k=S.useCallback(j=>{const A=w.current;j.key==="Escape"&&(A.status==="dragging"&&C(Object.fromEntries(u.map((B,L)=>[B.id,{y:L*c,offsetY:0,isSelected:!1}]))),A.status="idle")},[c,u]),N=S.useCallback(()=>{f||(e.run(()=>{e.mark("creating page");const j=No.createId();e.createPage({name:s("page-menu.new-page-initial-name"),id:j}),e.setCurrentPage(j),m(!0)}),n("new-page",{source:"page-menu"}))},[e,s,f,n]),O=S.useCallback(j=>{e.setCurrentPage(j),n("change-page",{source:"page-menu"})},[e,n]),R=S.useCallback((j,A)=>{e.renamePage(j,A),n("rename-page",{source:"page-menu"})},[e,n]);return a.jsxs(G1,{id:"pages",onOpenChange:l,open:o,children:[a.jsx(V1,{"data-testid":"main.page-menu",children:a.jsxs(be,{type:"menu",title:h.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[a.jsx("div",{className:"tlui-page-menu__name",children:h.name}),a.jsx(Be,{icon:"chevron-down",small:!0})]})}),a.jsx(K1,{side:"bottom",align:"start",sideOffset:6,children:a.jsxs("div",{className:"tlui-page-menu__wrapper",children:[a.jsxs("div",{className:"tlui-page-menu__header",children:[a.jsx("div",{className:"tlui-page-menu__header__title",children:s("page-menu.title")}),!f&&a.jsxs("div",{className:"tlui-buttons__horizontal",children:[a.jsx(be,{type:"icon","data-testid":"page-menu.edit",title:s(x?"page-menu.edit-done":"page-menu.edit-start"),onClick:v,children:a.jsx(Be,{icon:x?"check":"edit"})}),a.jsx(be,{type:"icon","data-testid":"page-menu.create",title:s(g?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:g,onClick:N,children:a.jsx(Be,{icon:"plus"})})]})]}),a.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:c*u.length+4},ref:d,children:u.map((j,A)=>{const B=_[j.id]??{offsetY:0};return x?a.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:j.id===h.id?888:A,transform:`translate(0px, ${B.y+B.offsetY}px)`},children:[a.jsx(be,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:I,onPointerUp:P,onPointerMove:T,onKeyDown:k,"data-id":j.id,"data-index":A,children:a.jsx(Be,{icon:"drag-handle-dots"})}),i<Ht.TABLET_SM&&y?a.jsxs(be,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const L=window.prompt("Rename page",j.name);L&&L!==j.name&&R(j.id,L)},onDoubleClick:v,children:[a.jsx(PC,{checked:j.id===h.id}),a.jsx(Yt,{children:j.name})]}):a.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:c},children:a.jsx(kme,{id:j.id,name:j.name,isCurrentPage:j.id===h.id})}),!f&&a.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":x,children:a.jsx(rR,{index:A,item:j,listSize:u.length})})]},j.id+"_editing"):a.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[a.jsxs(be,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>O(j.id),onDoubleClick:v,title:s("page-menu.go-to-page"),children:[a.jsx(PC,{checked:j.id===h.id}),a.jsx(Yt,{children:j.name})]}),!f&&a.jsx("div",{className:"tlui-page_menu__item__submenu",children:a.jsx(rR,{index:A,item:j,listSize:u.length,onRename:()=>{if(e.environment.isIos){const L=window.prompt("Rename page",j.name);L&&L!==j.name&&R(j.id,L)}else m(!0),p!==j.id&&O(j.id)}})})]},j.id)})})]})})]})});function Nme(){const t=xe(),e=K(),n=WU(),s=zU(),i=bs(1),r=Ho(),o=Z("should display quick actions",()=>e.isInAny("select","hand","zoom"),[e]),l=Vo(),c=i&&l;if(!(r&&!o))return a.jsxs(a.Fragment,{children:[a.jsx(X,{...t.undo,disabled:!n}),a.jsx(X,{...t.redo,disabled:!s}),a.jsx(X,{...t.delete,disabled:!c}),a.jsx(X,{...t.duplicate,disabled:!c})]})}const Ame=S.memo(function({children:e}){const n=e??a.jsx(Nme,{});return a.jsx(Ai,{type:"small-icons",sourceId:"quick-actions",children:n})});function Rme({userId:t}){const e=Fx(t);return e?a.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},t):null}const Mme=yn(function({userId:e}){const n=K(),s=$e(),i=Dn(),r=Fx(e),o=S.useCallback(()=>{n.getInstanceState().followingUserId===e?(n.stopFollowingUser(),i("stop-following",{source:"people-menu"})):(n.startFollowingUser(e),i("start-following",{source:"people-menu"}))},[n,e,i]),l=(r==null?void 0:r.followingUserId)===n.user.getId(),c=n.getInstanceState().followingUserId===e;return r?a.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[a.jsxs(be,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>n.zoomToUser(e),onDoubleClick:o,children:[a.jsx(Hr,{icon:"color",color:r.color}),a.jsx("div",{className:"tlui-people-menu__name",children:r.userName??"New User"})]}),a.jsx(be,{type:"icon",className:"tlui-people-menu__item__follow",title:s(l?"people-menu.leading":c?"people-menu.following":"people-menu.follow"),onClick:o,disabled:l,"data-active":c||l,children:a.jsx(Be,{icon:l?"leading":c?"following":"follow"})})]}):null});function Ome({count:t}){return a.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(t)})}const Dme=yn(function(){const e=K(),n=vn(),s=$e(),i=Dn(),r=S.useRef(!1),[o,l]=S.useState(!1),c=S.useCallback(y=>{l(y)},[]),d=e.user.getColor(),u=S.useCallback(y=>{e.user.updateUserPreferences({color:y}),i("set-color",{source:"people-menu"})},[e,i]),{handleButtonClick:h,handleButtonPointerDown:p,handleButtonPointerEnter:f,handleButtonPointerUp:g}=Oe.useMemo(()=>{const y=()=>{r.current=!1,window.removeEventListener("pointerup",y)};return{handleButtonClick:_=>{const{id:C}=_.currentTarget.dataset;C&&d!==C&&u(C)},handleButtonPointerDown:_=>{const{id:C}=_.currentTarget.dataset;C&&(u(C),r.current=!0,window.addEventListener("pointerup",y))},handleButtonPointerEnter:_=>{if(!r.current)return;const{id:C}=_.currentTarget.dataset;C&&u(C)},handleButtonPointerUp:_=>{const{id:C}=_.currentTarget.dataset;C&&u(C)}}},[d,u]);return a.jsxs($1,{onOpenChange:c,open:o,children:[a.jsx(z1,{dir:"ltr",asChild:!0,children:a.jsx(be,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:s("people-menu.change-color"),children:a.jsx(Be,{icon:"color"})})}),a.jsx(W1,{container:n,children:a.jsx(H1,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:a.jsx("div",{className:"tlui-buttons__grid",children:Z_.map(y=>a.jsx(be,{type:"icon","data-id":y,"data-testid":y,"aria-label":y,"data-state":d===y?"hinted":void 0,title:y,className:"tlui-button-grid__button",style:{color:y},onPointerEnter:f,onPointerDown:p,onPointerUp:g,onClick:h,children:a.jsx(Be,{icon:"color"})},y))})})})]})});function Lme(){const t=K(),e=Dn(),n=Z("userName",()=>t.user.getName(),[]),s=$e(),i=S.useRef(n),r=S.useRef(n),[o,l]=S.useState(!1),c=S.useCallback(()=>{l(h=>!h)},[]),d=S.useCallback(h=>{r.current=h,t.user.updateUserPreferences({name:h})},[t]),u=S.useCallback(()=>{i.current!==r.current&&(e("change-user-name",{source:"people-menu"}),i.current=r.current)},[e]);return a.jsxs("div",{className:"tlui-people-menu__user",children:[a.jsx(Dme,{}),o?a.jsx(aS,{className:"tlui-people-menu__user__input",defaultValue:n,onValueChange:d,onComplete:c,onCancel:c,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{o||l(!0)},children:n}),n==="New User"?a.jsx("div",{className:"tlui-people-menu__user__label",children:s("people-menu.user")}):null]}),a.jsx(be,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:s("people-menu.change-name"),onClick:c,children:a.jsx(Be,{icon:o?"check":"edit"})})]})}const Fme=yn(function({children:e}){const n=$e(),s=vn(),i=K(),r=t5(),o=Z("user",()=>i.user.getColor(),[i]),l=Z("user",()=>i.user.getName(),[i]),[c,d]=Go("people menu");return a.jsxs($1,{onOpenChange:d,open:c,children:[a.jsx(z1,{dir:"ltr",asChild:!0,children:a.jsxs("button",{className:"tlui-people-menu__avatars-button",title:n("people-menu.title"),children:[r.length>5&&a.jsx(Ome,{count:r.length-5}),a.jsxs("div",{className:"tlui-people-menu__avatars",children:[r.slice(-5).map(u=>a.jsx(Rme,{userId:u},u)),a.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o},children:l==="New User"?"":l[0]??""})]})]})}),a.jsx(W1,{container:s,children:a.jsx(H1,{dir:"ltr",className:"tlui-menu",align:"end",side:"bottom",sideOffset:2,alignOffset:-5,children:a.jsxs("div",{className:"tlui-people-menu__wrapper",children:[a.jsx("div",{className:"tlui-people-menu__section",children:a.jsx(Lme,{})}),r.length>0&&a.jsx("div",{className:"tlui-people-menu__section",children:r.map(u=>a.jsx(Mme,{userId:u},u+"_presence"))}),e]})})})]})});function Bme(){return a.jsx("div",{className:"tlui-share-zone",draggable:!1,children:a.jsx(Fme,{})})}const Ume=Object.freeze([ai,Vl,Kl,zr]);function j4(t=Ume){const e=K();return Z("getRelevantStyles",()=>{var r;const n=new Q_(e.getSharedStyles()),s=!!((r=e.root.getCurrent())!=null&&r.shapeType),i=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(n.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const o of t)n.applyValue(o,e.getStyleForNextShape(o));return s||i||n.size>0?n:null},[e])}const Ti={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},jl=S.memo(function(e){const{uiType:n,items:s,title:i,style:r,value:o,onValueChange:l,theme:c}=e,d=K(),u=$e(),h=S.useRef(!1),p=S.useRef(null),{handleButtonClick:f,handleButtonPointerDown:g,handleButtonPointerEnter:y,handleButtonPointerUp:x}=S.useMemo(()=>{const m=()=>{h.current=!1,window.removeEventListener("pointerup",m);const I=p.current;I&&["TEXTAREA","INPUT"].includes(I.nodeName)&&I.focus(),p.current=null};return{handleButtonClick:I=>{const{id:T}=I.currentTarget.dataset;o.type==="shared"&&o.value===T||(d.mark("point picker item"),l(r,T))},handleButtonPointerDown:I=>{const{id:T}=I.currentTarget.dataset;d.mark("point picker item"),l(r,T),h.current=!0,p.current=document.activeElement,window.addEventListener("pointerup",m)},handleButtonPointerEnter:I=>{if(!h.current)return;const{id:T}=I.currentTarget.dataset;l(r,T)},handleButtonPointerUp:I=>{const{id:T}=I.currentTarget.dataset;o.type==="shared"&&o.value===T||l(r,T)}}},[o,d,l,r]);return a.jsx("div",{"data-testid":`style.${n}`,className:Se("tlui-buttons__grid"),children:s.map(m=>a.jsx(be,{type:"icon","data-id":m.value,"data-testid":`style.${n}.${m.value}`,"aria-label":m.value,"data-state":o.type==="shared"&&o.value===m.value?"hinted":void 0,title:i+"  "+u(`${n}-style.${m.value}`),className:Se("tlui-button-grid__button"),style:r===ai?{color:c[m.value].solid}:void 0,onPointerEnter:y,onPointerDown:g,onPointerUp:x,onClick:f,children:a.jsx(Be,{icon:m.icon})},m.value))})});function N4(t,[e,n]){return Math.min(n,Math.max(e,t))}function $me(t){const e=S.useRef({value:t,previous:t});return S.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}var A4=["PageUp","PageDown"],R4=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],M4={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},du="Slider",[jC,zme,Wme]=nS(du),[O4]=Yr(du,[Wme]),[Hme,bS]=O4(du),D4=S.forwardRef((t,e)=>{const{name:n,min:s=0,max:i=100,step:r=1,orientation:o="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:d=[s],value:u,onValueChange:h=()=>{},onValueCommit:p=()=>{},inverted:f=!1,form:g,...y}=t,x=S.useRef(new Set),m=S.useRef(0),w=o==="horizontal"?Gme:Vme,[_=[],C]=il({prop:u,defaultProp:d,onChange:O=>{var j;(j=[...x.current][m.current])==null||j.focus(),h(O)}}),I=S.useRef(_);function T(O){const R=Zme(_,O);N(O,R)}function P(O){N(O,m.current)}function k(){const O=I.current[m.current];_[m.current]!==O&&p(_)}function N(O,R,{commit:j}={commit:!1}){const A=tye(r),B=nye(Math.round((O-s)/r)*r+s,A),L=N4(B,[s,i]);C(($=[])=>{const M=Xme($,L,R);if(eye(M,c*r)){m.current=M.indexOf(L);const D=String(M)!==String($);return D&&j&&p(M),D?M:$}else return $})}return a.jsx(Hme,{scope:t.__scopeSlider,name:n,disabled:l,min:s,max:i,valueIndexToChangeRef:m,thumbs:x.current,values:_,orientation:o,form:g,children:a.jsx(jC.Provider,{scope:t.__scopeSlider,children:a.jsx(jC.Slot,{scope:t.__scopeSlider,children:a.jsx(w,{"aria-disabled":l,"data-disabled":l?"":void 0,...y,ref:e,onPointerDown:me(y.onPointerDown,()=>{l||(I.current=_)}),min:s,max:i,inverted:f,onSlideStart:l?void 0:T,onSlideMove:l?void 0:P,onSlideEnd:l?void 0:k,onHomeKeyDown:()=>!l&&N(s,0,{commit:!0}),onEndKeyDown:()=>!l&&N(i,_.length-1,{commit:!0}),onStepKeyDown:({event:O,direction:R})=>{if(!l){const B=A4.includes(O.key)||O.shiftKey&&R4.includes(O.key)?10:1,L=m.current,$=_[L],M=r*B*R;N($+M,L,{commit:!0})}}})})})})});D4.displayName=du;var[L4,F4]=O4(du,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Gme=S.forwardRef((t,e)=>{const{min:n,max:s,dir:i,inverted:r,onSlideStart:o,onSlideMove:l,onSlideEnd:c,onStepKeyDown:d,...u}=t,[h,p]=S.useState(null),f=ut(e,w=>p(w)),g=S.useRef(void 0),y=Y1(i),x=y==="ltr",m=x&&!r||!x&&r;function v(w){const _=g.current||h.getBoundingClientRect(),C=[0,_.width],T=cI(C,m?[n,s]:[s,n]);return g.current=_,T(w-_.left)}return a.jsx(L4,{scope:t.__scopeSlider,startEdge:m?"left":"right",endEdge:m?"right":"left",direction:m?1:-1,size:"width",children:a.jsx(B4,{dir:y,"data-orientation":"horizontal",...u,ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:w=>{const _=v(w.clientX);o==null||o(_)},onSlideMove:w=>{const _=v(w.clientX);l==null||l(_)},onSlideEnd:()=>{g.current=void 0,c==null||c()},onStepKeyDown:w=>{const C=M4[m?"from-left":"from-right"].includes(w.key);d==null||d({event:w,direction:C?-1:1})}})})}),Vme=S.forwardRef((t,e)=>{const{min:n,max:s,inverted:i,onSlideStart:r,onSlideMove:o,onSlideEnd:l,onStepKeyDown:c,...d}=t,u=S.useRef(null),h=ut(e,u),p=S.useRef(void 0),f=!i;function g(y){const x=p.current||u.current.getBoundingClientRect(),m=[0,x.height],w=cI(m,f?[s,n]:[n,s]);return p.current=x,w(y-x.top)}return a.jsx(L4,{scope:t.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:a.jsx(B4,{"data-orientation":"vertical",...d,ref:h,style:{...d.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:y=>{const x=g(y.clientY);r==null||r(x)},onSlideMove:y=>{const x=g(y.clientY);o==null||o(x)},onSlideEnd:()=>{p.current=void 0,l==null||l()},onStepKeyDown:y=>{const m=M4[f?"from-bottom":"from-top"].includes(y.key);c==null||c({event:y,direction:m?-1:1})}})})}),B4=S.forwardRef((t,e)=>{const{__scopeSlider:n,onSlideStart:s,onSlideMove:i,onSlideEnd:r,onHomeKeyDown:o,onEndKeyDown:l,onStepKeyDown:c,...d}=t,u=bS(du,n);return a.jsx(Ye.span,{...d,ref:e,onKeyDown:me(t.onKeyDown,h=>{h.key==="Home"?(o(h),h.preventDefault()):h.key==="End"?(l(h),h.preventDefault()):A4.concat(R4).includes(h.key)&&(c(h),h.preventDefault())}),onPointerDown:me(t.onPointerDown,h=>{const p=h.target;p.setPointerCapture(h.pointerId),h.preventDefault(),u.thumbs.has(p)?p.focus():s(h)}),onPointerMove:me(t.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&i(h)}),onPointerUp:me(t.onPointerUp,h=>{const p=h.target;p.hasPointerCapture(h.pointerId)&&(p.releasePointerCapture(h.pointerId),r(h))})})}),U4="SliderTrack",$4=S.forwardRef((t,e)=>{const{__scopeSlider:n,...s}=t,i=bS(U4,n);return a.jsx(Ye.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...s,ref:e})});$4.displayName=U4;var NC="SliderRange",z4=S.forwardRef((t,e)=>{const{__scopeSlider:n,...s}=t,i=bS(NC,n),r=F4(NC,n),o=S.useRef(null),l=ut(e,o),c=i.values.length,d=i.values.map(p=>G4(p,i.min,i.max)),u=c>1?Math.min(...d):0,h=100-Math.max(...d);return a.jsx(Ye.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...s,ref:l,style:{...t.style,[r.startEdge]:u+"%",[r.endEdge]:h+"%"}})});z4.displayName=NC;var AC="SliderThumb",W4=S.forwardRef((t,e)=>{const n=zme(t.__scopeSlider),[s,i]=S.useState(null),r=ut(e,l=>i(l)),o=S.useMemo(()=>s?n().findIndex(l=>l.ref.current===s):-1,[n,s]);return a.jsx(Kme,{...t,ref:r,index:o})}),Kme=S.forwardRef((t,e)=>{const{__scopeSlider:n,index:s,name:i,...r}=t,o=bS(AC,n),l=F4(AC,n),[c,d]=S.useState(null),u=ut(e,v=>d(v)),h=c?o.form||!!c.closest("form"):!0,p=fU(c),f=o.values[s],g=f===void 0?0:G4(f,o.min,o.max),y=qme(s,o.values.length),x=p==null?void 0:p[l.size],m=x?Jme(x,g,l.direction):0;return S.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),a.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${g}% + ${m}px)`},children:[a.jsx(jC.ItemSlot,{scope:t.__scopeSlider,children:a.jsx(Ye.span,{role:"slider","aria-label":t["aria-label"]||y,"aria-valuemin":o.min,"aria-valuenow":f,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...r,ref:u,style:f===void 0?{display:"none"}:t.style,onFocus:me(t.onFocus,()=>{o.valueIndexToChangeRef.current=s})})}),h&&a.jsx(H4,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:f},s)]})});W4.displayName=AC;var Yme="RadioBubbleInput",H4=S.forwardRef(({__scopeSlider:t,value:e,...n},s)=>{const i=S.useRef(null),r=ut(i,s),o=$me(e);return S.useEffect(()=>{const l=i.current;if(!l)return;const c=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==e&&u){const h=new Event("input",{bubbles:!0});u.call(l,e),l.dispatchEvent(h)}},[o,e]),a.jsx(Ye.input,{style:{display:"none"},...n,ref:r,defaultValue:e})});H4.displayName=Yme;function Xme(t=[],e,n){const s=[...t];return s[n]=e,s.sort((i,r)=>i-r)}function G4(t,e,n){const r=100/(n-e)*(t-e);return N4(r,[0,100])}function qme(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function Zme(t,e){if(t.length===1)return 0;const n=t.map(i=>Math.abs(i-e)),s=Math.min(...n);return n.indexOf(s)}function Jme(t,e,n){const s=t/2,r=cI([0,50],[0,s]);return(s-r(e)*n)*n}function Qme(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function eye(t,e){if(e>0){const n=Qme(t);return Math.min(...n)>=e}return!0}function cI(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const s=(e[1]-e[0])/(t[1]-t[0]);return e[0]+s*(n-t[0])}}function tye(t){return(String(t).split(".")[1]||"").length}function nye(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}var sye=D4,iye=$4,rye=z4,oye=W4;const aye=S.memo(function(e){const{title:n,steps:s,value:i,label:r,onValueChange:o}=e,l=K(),c=$e(),d=S.useCallback(p=>{o(p[0])},[o]),u=S.useCallback(()=>{l.mark("click slider")},[l]),h=S.useCallback(()=>{i&&o(i)},[i,o]);return a.jsx("div",{className:"tlui-slider__container",children:a.jsxs(sye,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:s,step:1,value:i?[i]:void 0,onPointerDown:u,onValueChange:d,onPointerUp:h,title:n+"  "+c(r),children:[a.jsx(iye,{className:"tlui-slider__track",dir:"ltr",children:i!==null&&a.jsx(rye,{className:"tlui-slider__range",dir:"ltr"})}),i!==null&&a.jsx(oye,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function lye({label:t,uiTypeA:e,uiTypeB:n,labelA:s,labelB:i,itemsA:r,itemsB:o,styleA:l,styleB:c,valueA:d,valueB:u,onValueChange:h}){const p=$e(),f=S.useMemo(()=>{var y;return((y=r.find(x=>d.type==="shared"&&d.value===x.value))==null?void 0:y.icon)??"mixed"},[r,d]),g=S.useMemo(()=>{var y;return((y=o.find(x=>u.type==="shared"&&u.value===x.value))==null?void 0:y.icon)??"mixed"},[o,u]);return d===void 0&&u===void 0?null:a.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[a.jsx("div",{title:p(t),className:"tlui-style-panel__double-select-picker-label",children:p(t)}),a.jsxs("div",{className:"tlui-buttons__horizontal",children:[a.jsxs(Ql,{id:`style panel ${e} A`,children:[a.jsx(ec,{children:a.jsx(be,{type:"icon","data-testid":`style.${e}`,title:p(s)+"  "+(d===null||d.type==="mixed"?p("style-panel.mixed"):p(`${e}-style.${d.value}`)),children:a.jsx(Be,{icon:f,small:!0,invertIcon:!0})})}),a.jsx(tc,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:a.jsx("div",{className:"tlui-buttons__grid",children:r.map((y,x)=>a.jsx(Rp,{"data-testid":`style.${e}.${y.value}`,children:a.jsx(be,{type:"icon",onClick:()=>h(l,y.value),title:`${p(s)}  ${p(`${e}-style.${y.value}`)}`,children:a.jsx(Be,{icon:y.icon,invertIcon:!0})},y.value)},x))})})]}),a.jsxs(Ql,{id:`style panel ${n}`,children:[a.jsx(ec,{children:a.jsx(be,{type:"icon","data-testid":`style.${n}`,title:p(i)+"  "+(u===null||u.type==="mixed"?p("style-panel.mixed"):p(`${n}-style.${u.value}`)),children:a.jsx(Be,{icon:g,small:!0})})}),a.jsx(tc,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:a.jsx("div",{className:"tlui-buttons__grid",children:o.map(y=>a.jsx(Rp,{children:a.jsx(be,{type:"icon",title:`${p(i)}  ${p(`${n}-style.${y.value}`)}`,"data-testid":`style.${n}.${y.value}`,onClick:()=>h(c,y.value),children:a.jsx(Be,{icon:y.icon})})},y.value))})})]})]})]})}const cye=S.memo(lye);function dye({id:t,label:e,uiType:n,style:s,items:i,type:r,value:o,onValueChange:l}){const c=$e(),d=K(),u=S.useMemo(()=>{var f;return(f=i.find(g=>o.type==="shared"&&g.value===o.value))==null?void 0:f.icon},[i,o]),h=o.type==="mixed"?c("style-panel.mixed"):c(`${n}-style.${o.value}`),p=e?c(e):"";return a.jsxs(Ql,{id:`style panel ${t}`,children:[a.jsx(ec,{children:a.jsxs(be,{type:r,"data-testid":`style.${n}`,title:h,children:[a.jsx(Yt,{children:p}),a.jsx(Be,{icon:u??"mixed"})]})}),a.jsx(tc,{side:"left",align:"center",alignOffset:0,children:a.jsx("div",{className:"tlui-buttons__grid",children:i.map(f=>a.jsx(Rp,{children:a.jsx(be,{type:"icon","data-testid":`style.${n}.${f.value}`,title:c(`${n}-style.${f.value}`),onClick:()=>{d.mark("select style dropdown item"),l(s,f.value)},children:a.jsx(Be,{icon:f.icon})})},f.value))})})]})}const dI=S.memo(dye);function uye({styles:t}){const e=Sf();if(!t)return null;const n=t.get(Ei),s=t.get(sv),i=t.get(nv),r=t.get(av),o=t.get($r),l=n===void 0,c=s===void 0&&i===void 0,d=r===void 0,u=o===void 0,h=Wo({isDarkMode:e});return a.jsxs(a.Fragment,{children:[a.jsx(hye,{theme:h,styles:t}),!u&&a.jsx(pye,{theme:h,styles:t}),!(l&&c&&d)&&a.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a.jsx(fye,{styles:t}),a.jsx(mye,{styles:t}),a.jsx(gye,{styles:t})]})]})}function Nf(){const t=K(),e=Dn();return Oe.useMemo(()=>function(s,i){t.run(()=>{t.isIn("select")&&t.setStyleForSelectedShapes(s,i),t.setStyleForNextShapes(s,i),t.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:s.id,value:i})},[t,e])}function hye({styles:t,theme:e}){const n=$e(),s=K(),i=Nf(),r=t.get(ai),o=t.get(Kl),l=t.get(Vl),c=t.get(zr),d=o!==void 0||l!==void 0||c!==void 0;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[r===void 0?null:a.jsx(jl,{title:n("style-panel.color"),uiType:"color",style:ai,items:Ti.color,value:r,onValueChange:i,theme:e}),a.jsx(yye,{})]}),d&&a.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[o===void 0?null:a.jsx(jl,{title:n("style-panel.fill"),uiType:"fill",style:Kl,items:Ti.fill,value:o,onValueChange:i,theme:e}),l===void 0?null:a.jsx(jl,{title:n("style-panel.dash"),uiType:"dash",style:Vl,items:Ti.dash,value:l,onValueChange:i,theme:e}),c===void 0?null:a.jsx(jl,{title:n("style-panel.size"),uiType:"size",style:zr,items:Ti.size,value:c,onValueChange:(u,h)=>{i(u,h);const p=s.getSelectedShapeIds();p.length>0&&pt(s,p)},theme:e})]})]})}function pye({theme:t,styles:e}){const n=$e(),s=Nf(),i=e.get($r),r=e.get(V_),o=e.get(rv),l=e.get(ov);return i===void 0&&o===void 0?null:a.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[i===void 0?null:a.jsx(jl,{title:n("style-panel.font"),uiType:"font",style:$r,items:Ti.font,value:i,onValueChange:s,theme:t}),r===void 0?null:a.jsxs("div",{className:"tlui-style-panel__row",children:[a.jsx(jl,{title:n("style-panel.align"),uiType:"align",style:V_,items:Ti.textAlign,value:r,onValueChange:s,theme:t}),a.jsx("div",{className:"tlui-style-panel__row__extra-button",children:a.jsx(be,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:a.jsx(Be,{icon:"vertical-align-middle"})})})]}),o===void 0?null:a.jsxs("div",{className:"tlui-style-panel__row",children:[a.jsx(jl,{title:n("style-panel.align"),uiType:"align",style:rv,items:Ti.horizontalAlign,value:o,onValueChange:s,theme:t}),a.jsx("div",{className:"tlui-style-panel__row__extra-button",children:l===void 0?a.jsx(be,{type:"icon",title:n("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:a.jsx(Be,{icon:"vertical-align-middle"})}):a.jsx(dI,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:ov,items:Ti.verticalAlign,value:l,onValueChange:s})})]})]})}function fye({styles:t}){const e=Nf(),n=t.get(Ei);return n===void 0?null:a.jsx(dI,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:Ei,items:Ti.geo,value:n,onValueChange:e})}function gye({styles:t}){const e=Nf(),n=t.get(av);return n===void 0?null:a.jsx(dI,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:av,items:Ti.spline,value:n,onValueChange:e})}function mye({styles:t}){const e=Nf(),n=t.get(sv),s=t.get(nv);return!n||!s?null:a.jsx(cye,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:nv,itemsA:Ti.arrowheadStart,valueA:s,uiTypeB:"arrowheadEnd",styleB:sv,itemsB:Ti.arrowheadEnd,valueB:n,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const Xu=[.1,.25,.5,.75,1];function yye(){const t=K(),e=Z("opacity",()=>t.getSharedOpacity(),[t]),n=Dn(),s=$e(),i=Oe.useCallback(o=>{const l=Xu[o];t.run(()=>{t.isIn("select")&&t.setOpacityForSelectedShapes(l),t.setOpacityForNextShapes(l),t.updateInstanceState({isChangingStyle:!0})}),n("set-style",{source:"style-panel",id:"opacity",value:o})},[t,n]);if(e===void 0)return null;const r=e.type==="mixed"?-1:Xu.indexOf(NJ(Xu,o=>Math.abs(o-e.value)));return a.jsx(aye,{"data-testid":"style.opacity",value:r>=0?r:Xu.length-1,label:e.type==="mixed"?"style-panel.mixed":`opacity-style.${e.value}`,onValueChange:i,steps:Xu.length-1,title:s("style-panel.opacity")})}const vye=S.memo(function({isMobile:e,children:n}){const s=K(),i=j4(),r=S.useCallback(()=>{e||s.updateInstanceState({isChangingStyle:!1})},[s,e]),o=n??a.jsx(uye,{styles:i});return a.jsx("div",{className:Se("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:r,children:o})});function xye(){const t=K(),e=$e(),n=j4(),s=n==null?void 0:n.get(ai),i=Wo({isDarkMode:t.user.getIsDarkMode()}),r=((s==null?void 0:s.type)==="shared"?i[s.value]:i.black).solid,o=Z("disable style panel",()=>t.isInAny("hand","zoom","eraser","laser"),[t]),l=S.useCallback(d=>{d||t.updateInstanceState({isChangingStyle:!1})},[t]),{StylePanel:c}=ll();return c?a.jsxs(G1,{id:"mobile style menu",onOpenChange:l,children:[a.jsx(V1,{children:a.jsx(be,{type:"tool","data-testid":"mobile-styles.button",style:{color:o?"var(--color-muted-1)":r},title:e("style-panel.title"),disabled:o,children:a.jsx(Be,{icon:o?"blob":(s==null?void 0:s.type)==="mixed"?"mixed":"blob"})})}),a.jsx(K1,{side:"top",align:"end",children:c&&a.jsx(c,{isMobile:!0})})]}):null}function Sye(){return a.jsxs(a.Fragment,{children:[a.jsx(wye,{}),a.jsx(_ye,{}),a.jsx(Cye,{}),a.jsx(Eye,{}),a.jsx(Tye,{}),a.jsx(Iye,{}),a.jsx(Pye,{}),a.jsx(kye,{}),a.jsx(jye,{}),a.jsx(Nye,{}),a.jsx(Rye,{}),a.jsx(Aye,{}),a.jsx(Dye,{}),a.jsx(Bye,{}),a.jsx(Mye,{}),a.jsx(Fye,{}),a.jsx(Lye,{}),a.jsx(Oye,{}),a.jsx(Uye,{}),a.jsx($ye,{}),a.jsx(zye,{}),a.jsx(Wye,{}),a.jsx(Hye,{}),a.jsx(Gye,{}),a.jsx(Vye,{}),a.jsx(Kye,{}),a.jsx(Xye,{}),a.jsx(Yye,{})]})}function bye(t){var s;const e=K(),n=(s=t.meta)==null?void 0:s.geo;return Z("is tool selected",()=>{const i=e.getCurrentToolId(),r=e.getSharedStyles().getAsKnownValue(Ei);return n?i==="geo"&&r===n:i===t.id},[e,t.id,n])}function ht({tool:t}){const e=lS(),n=bye(e[t]);return a.jsx(X,{...e[t],isSelected:n})}function wye(){return a.jsx(ht,{tool:"select"})}function _ye(){return a.jsx(ht,{tool:"hand"})}function Cye(){return a.jsx(ht,{tool:"draw"})}function Eye(){return a.jsx(ht,{tool:"eraser"})}function Tye(){return a.jsx(ht,{tool:"arrow"})}function Iye(){return a.jsx(ht,{tool:"text"})}function Pye(){return a.jsx(ht,{tool:"note"})}function kye(){const t=lS();return a.jsx(X,{...t.asset})}function jye(){return a.jsx(ht,{tool:"rectangle"})}function Nye(){return a.jsx(ht,{tool:"ellipse"})}function Aye(){return a.jsx(ht,{tool:"diamond"})}function Rye(){return a.jsx(ht,{tool:"triangle"})}function Mye(){return a.jsx(ht,{tool:"rhombus"})}function Oye(){return a.jsx(ht,{tool:"heart"})}function Dye(){return a.jsx(ht,{tool:"hexagon"})}function Lye(){return a.jsx(ht,{tool:"cloud"})}function Fye(){return a.jsx(ht,{tool:"star"})}function Bye(){return a.jsx(ht,{tool:"oval"})}function Uye(){return a.jsx(ht,{tool:"x-box"})}function $ye(){return a.jsx(ht,{tool:"check-box"})}function zye(){return a.jsx(ht,{tool:"arrow-left"})}function Wye(){return a.jsx(ht,{tool:"arrow-up"})}function Hye(){return a.jsx(ht,{tool:"arrow-down"})}function Gye(){return a.jsx(ht,{tool:"arrow-right"})}function Vye(){return a.jsx(ht,{tool:"line"})}function Kye(){return a.jsx(ht,{tool:"highlight"})}function Yye(){return a.jsx(ht,{tool:"frame"})}function Xye(){return a.jsx(ht,{tool:"laser"})}const Ow=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Dw(t,e,n,s){t.addEventListener?t.addEventListener(e,n,s):t.attachEvent&&t.attachEvent("on".concat(e),n)}function qu(t,e,n,s){t.removeEventListener?t.removeEventListener(e,n,s):t.detachEvent&&t.detachEvent("on".concat(e),n)}function V4(t,e){const n=e.slice(0,e.length-1);for(let s=0;s<n.length;s++)n[s]=t[n[s].toLowerCase()];return n}function K4(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function qye(t,e){const n=t.length>=e.length?t:e,s=t.length>=e.length?e:t;let i=!0;for(let r=0;r<n.length;r++)s.indexOf(n[r])===-1&&(i=!1);return i}const Mp={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":Ow?173:189,"=":Ow?61:187,";":Ow?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Qi={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},Ih={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},En={16:!1,18:!1,17:!1,91:!1},Ot={};for(let t=1;t<20;t++)Mp["f".concat(t)]=111+t;let It=[],Yh=null,Y4="all";const ro=new Map,uu=t=>Mp[t.toLowerCase()]||Qi[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Zye=t=>Object.keys(Mp).find(e=>Mp[e]===t),Jye=t=>Object.keys(Qi).find(e=>Qi[e]===t);function X4(t){Y4=t||"all"}function Op(){return Y4||"all"}function Qye(){return It.slice(0)}function eve(){return It.map(t=>Zye(t)||Jye(t)||String.fromCharCode(t))}function tve(){const t=[];return Object.keys(Ot).forEach(e=>{Ot[e].forEach(n=>{let{key:s,scope:i,mods:r,shortcut:o}=n;t.push({scope:i,shortcut:o,mods:r,keys:s.split("+").map(l=>uu(l))})})}),t}function nve(t){const e=t.target||t.srcElement,{tagName:n}=e;let s=!0;const i=n==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(i||n==="TEXTAREA"||n==="SELECT")&&!e.readOnly)&&(s=!1),s}function sve(t){return typeof t=="string"&&(t=uu(t)),It.indexOf(t)!==-1}function ive(t,e){let n,s;t||(t=Op());for(const i in Ot)if(Object.prototype.hasOwnProperty.call(Ot,i))for(n=Ot[i],s=0;s<n.length;)n[s].scope===t?n.splice(s,1).forEach(o=>{let{element:l}=o;return uI(l)}):s++;Op()===t&&X4(e||"all")}function rve(t){let e=t.keyCode||t.which||t.charCode;t.key&&t.key.toLowerCase()==="capslock"&&(e=uu(t.key));const n=It.indexOf(e);if(n>=0&&It.splice(n,1),t.key&&t.key.toLowerCase()==="meta"&&It.splice(0,It.length),(e===93||e===224)&&(e=91),e in En){En[e]=!1;for(const s in Qi)Qi[s]===e&&(Ds[s]=!1)}}function q4(t){if(typeof t>"u")Object.keys(Ot).forEach(i=>{Array.isArray(Ot[i])&&Ot[i].forEach(r=>tm(r)),delete Ot[i]}),uI(null);else if(Array.isArray(t))t.forEach(i=>{i.key&&tm(i)});else if(typeof t=="object")t.key&&tm(t);else if(typeof t=="string"){for(var e=arguments.length,n=new Array(e>1?e-1:0),s=1;s<e;s++)n[s-1]=arguments[s];let[i,r]=n;typeof i=="function"&&(r=i,i=""),tm({key:t,scope:i,method:r,splitKey:"+"})}}const tm=t=>{let{key:e,scope:n,method:s,splitKey:i="+"}=t;K4(e).forEach(o=>{const l=o.split(i),c=l.length,d=l[c-1],u=d==="*"?"*":uu(d);if(!Ot[u])return;n||(n=Op());const h=c>1?V4(Qi,l):[],p=[];Ot[u]=Ot[u].filter(f=>{const y=(s?f.method===s:!0)&&f.scope===n&&qye(f.mods,h);return y&&p.push(f.element),!y}),p.forEach(f=>uI(f))})};function oR(t,e,n,s){if(e.element!==s)return;let i;if(e.scope===n||e.scope==="all"){i=e.mods.length>0;for(const r in En)Object.prototype.hasOwnProperty.call(En,r)&&(!En[r]&&e.mods.indexOf(+r)>-1||En[r]&&e.mods.indexOf(+r)===-1)&&(i=!1);(e.mods.length===0&&!En[16]&&!En[18]&&!En[17]&&!En[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(It),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function aR(t,e){const n=Ot["*"];let s=t.keyCode||t.which||t.charCode;if(t.key&&t.key.toLowerCase()==="capslock"||!Ds.filter.call(this,t))return;if((s===93||s===224)&&(s=91),It.indexOf(s)===-1&&s!==229&&It.push(s),["metaKey","ctrlKey","altKey","shiftKey"].forEach(l=>{const c=Ih[l];t[l]&&It.indexOf(c)===-1?It.push(c):!t[l]&&It.indexOf(c)>-1?It.splice(It.indexOf(c),1):l==="metaKey"&&t[l]&&(It=It.filter(d=>d in Ih||d===s))}),s in En){En[s]=!0;for(const l in Qi)if(Object.prototype.hasOwnProperty.call(Qi,l)){const c=Ih[Qi[l]];Ds[l]=t[c]}if(!n)return}for(const l in En)Object.prototype.hasOwnProperty.call(En,l)&&(En[l]=t[Ih[l]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(It.indexOf(17)===-1&&It.push(17),It.indexOf(18)===-1&&It.push(18),En[17]=!0,En[18]=!0);const i=Op();if(n)for(let l=0;l<n.length;l++)n[l].scope===i&&(t.type==="keydown"&&n[l].keydown||t.type==="keyup"&&n[l].keyup)&&oR(t,n[l],i,e);if(!(s in Ot))return;const r=Ot[s],o=r.length;for(let l=0;l<o;l++)if((t.type==="keydown"&&r[l].keydown||t.type==="keyup"&&r[l].keyup)&&r[l].key){const c=r[l],{splitKey:d}=c,u=c.key.split(d),h=[];for(let p=0;p<u.length;p++)h.push(uu(u[p]));h.sort().join("")===It.sort().join("")&&oR(t,c,i,e)}}function Ds(t,e,n){It=[];const s=K4(t);let i=[],r="all",o=document,l=0,c=!1,d=!0,u="+",h=!1,p=!1;for(n===void 0&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(r=e.scope),e.element&&(o=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(d=e.keydown),e.capture!==void 0&&(h=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(r=e),p&&q4(t,r);l<s.length;l++)t=s[l].split(u),i=[],t.length>1&&(i=V4(Qi,t)),t=t[t.length-1],t=t==="*"?"*":uu(t),t in Ot||(Ot[t]=[]),Ot[t].push({keyup:c,keydown:d,scope:r,mods:i,shortcut:s[l],method:n,key:s[l],splitKey:u,element:o});if(typeof o<"u"&&window){if(!ro.has(o)){const f=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return aR(y,o)},g=function(){let y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;aR(y,o),rve(y)};ro.set(o,{keydownListener:f,keyupListenr:g,capture:h}),Dw(o,"keydown",f,h),Dw(o,"keyup",g,h)}if(!Yh){const f=()=>{It=[]};Yh={listener:f,capture:h},Dw(window,"focus",f,h)}}}function ove(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Ot).forEach(n=>{Ot[n].filter(i=>i.scope===e&&i.shortcut===t).forEach(i=>{i&&i.method&&i.method()})})}function uI(t){const e=Object.values(Ot).flat();if(e.findIndex(s=>{let{element:i}=s;return i===t})<0){const{keydownListener:s,keyupListenr:i,capture:r}=ro.get(t)||{};s&&i&&(qu(t,"keyup",i,r),qu(t,"keydown",s,r),ro.delete(t))}if((e.length<=0||ro.size<=0)&&(Object.keys(ro).forEach(i=>{const{keydownListener:r,keyupListenr:o,capture:l}=ro.get(i)||{};r&&o&&(qu(i,"keyup",o,l),qu(i,"keydown",r,l),ro.delete(i))}),ro.clear(),Object.keys(Ot).forEach(i=>delete Ot[i]),Yh)){const{listener:i,capture:r}=Yh;qu(window,"focus",i,r),Yh=null}}const Lw={getPressedKeyString:eve,setScope:X4,getScope:Op,deleteScope:ive,getPressedKeyCodes:Qye,getAllKeyCodes:tve,isPressed:sve,filter:nve,trigger:ove,unbind:q4,keyMap:Mp,modifier:Qi,modifierMap:Ih};for(const t in Lw)Object.prototype.hasOwnProperty.call(Lw,t)&&(Ds[t]=Lw[t]);if(typeof window<"u"){const t=window.hotkeys;Ds.noConflict=e=>(e&&window.hotkeys===Ds&&(window.hotkeys=t),Ds),window.hotkeys=Ds}const lR=["copy","cut","paste","asset"];function ave(){const t=K(),e=Ho(),n=xe(),s=lS(),i=Z("is focused",()=>t.getInstanceState().isFocused,[t]);S.useEffect(()=>{if(!i)return;const r=new Array,o=(c,d)=>{Ds(c,{element:document.body},d),r.push(()=>{Ds.unbind(c,d)})},l=(c,d)=>{Ds(c,{element:document.body,keyup:!0,keydown:!1},d),r.push(()=>{Ds.unbind(c,d)})};for(const c of Object.values(n))c.kbd&&(e&&!c.readonlyOk||lR.includes(c.id)||o(cR(c.kbd),d=>{Ph(t)||(Ve(d),c.onSelect("kbd"))}));for(const c of Object.values(s))!c.kbd||!c.readonlyOk&&t.getInstanceState().isReadonly||lR.includes(c.id)||o(cR(c.kbd),d=>{Ph(t)||(Ve(d),c.onSelect("kbd"))});return o(",",c=>{if(Ph(t)||t.inputs.keys.has("Comma"))return;Ve(c),t.focus(),t.inputs.keys.add("Comma");const{x:d,y:u,z:h}=t.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_down",point:{x:d,y:u,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(p)}),l(",",c=>{if(Ph(t)||!t.inputs.keys.has("Comma"))return;t.inputs.keys.delete("Comma");const{x:d,y:u,z:h}=t.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_up",point:{x:d,y:u,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,pointerId:0,button:0,isPen:t.getInstanceState().isPenMode,target:"canvas"};t.dispatch(p)}),()=>{r.forEach(c=>c())}},[n,s,e,t,i])}function cR(t){return lve(t).map(e=>{let n="";const s=e.split("");return s.length===1?n=s[0]:s[0]==="!"?n=`shift+${s[1]}`:s[0]==="?"?s.length===3&&s[1]==="!"?n=`alt+shift+${s[2]}`:n=`alt+${s[1]}`:s[0]==="$"?s[1]==="!"?n=`cmd+shift+${s[2]},ctrl+shift+${s[2]}`:s[1]==="?"?n=`cmd++${s[2]},ctrl+alt+${s[2]}`:n=`cmd+${s[1]},ctrl+${s[1]}`:n=e,n}).join(",")}function lve(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function Ph(t){return t.getIsMenuOpen()||t.getEditingShapeId()!==null||t.getCrashingError()}const cve=S.createContext(!1);function dve({children:t}){const e=K(),n=s5(),s=Ss(),i=$e(),r=Math.min(8,5+s),[o,l]=S.useState(0),c=S.useRef(null),[d,u]=S.useState(null),h=S.useMemo(()=>{const f=d?`:not([data-value="${d}"])`:"";return`
			#${n}_main > *:nth-child(n + ${r+(d?1:2)})${f} {
				display: none;
			}
			#${n}_more > *:nth-child(-n + ${r}) {
				display: none;
			}
        `},[d,n,r]),p=M5(()=>{if(!c.current)return;const f=Array.from(c.current.children);l(f.length),f.findIndex(x=>x.getAttribute("data-value")===d)<=r&&u(null);const y=Array.from(c.current.children).findIndex(x=>x.getAttribute("aria-checked")==="true");y!==-1&&y>=r&&u(f[y].getAttribute("data-value"))});return S.useLayoutEffect(()=>{p()}),S.useLayoutEffect(()=>{if(!c.current)return;const f=new MutationObserver(p);return f.observe(c.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{f.disconnect()}},[p]),S.useEffect(()=>{const f=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[g,y]of f)Ds(g,x=>{var w;if(Ph(e))return;Ve(x);const v=Array.from(((w=c.current)==null?void 0:w.children)??[]).filter(_=>!(_ instanceof HTMLElement)||_.tagName.toLowerCase()!=="button"?!1:!!(_.offsetWidth||_.offsetHeight))[y];v&&v.click()});return()=>{Ds.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),a.jsxs(a.Fragment,{children:[a.jsx("style",{children:h}),a.jsxs("div",{className:Se("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":s<Ht.TABLET_SM}),role:"radiogroup",children:[a.jsx("div",{id:`${n}_main`,ref:c,className:"tlui-toolbar__tools__list",children:a.jsx(Ai,{type:"toolbar",sourceId:"toolbar",children:t})}),o>r+1&&a.jsx(cve.Provider,{value:!0,children:a.jsxs(Ql,{id:"toolbar overflow",modal:!1,children:[a.jsx(ec,{children:a.jsx(be,{title:i("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:a.jsx(Be,{icon:"chevron-up"})})}),a.jsx(tc,{side:"top",align:"center",children:a.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${n}_more`,children:a.jsx(Ai,{type:"toolbar-overflow",sourceId:"toolbar",children:t})})})]})})]})]})}function uve({activeToolId:t}){const e=K(),n=Ss(),s=$e(),i=Z("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),r=Z("current tool",()=>e.getCurrentTool(),[e]);return!t||!r.isLockable?null:a.jsx(be,{type:"normal",title:s("action.toggle-tool-lock"),"data-testid":"tool-lock",className:Se("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<Ht.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!i}),children:a.jsx(Be,{icon:i?"lock":"unlock",small:!0})})}const hve=S.memo(function({children:e}){const n=K(),s=Ss(),i=Ho(),r=Z("current tool id",()=>n.getCurrentToolId(),[n]),{ActionsMenu:o,QuickActions:l}=ll();return a.jsx("div",{className:"tlui-toolbar",children:a.jsxs("div",{className:"tlui-toolbar__inner",children:[a.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&a.jsxs("div",{className:"tlui-toolbar__extras",children:[s<Ht.TABLET&&a.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[l&&a.jsx(l,{}),o&&a.jsx(o,{})]}),a.jsx(uve,{activeToolId:r})]}),a.jsx(dve,{children:e??a.jsx(Sye,{})})]}),s<Ht.TABLET_SM&&!i&&a.jsx("div",{className:"tlui-toolbar__tools",children:a.jsx(xye,{})})]})})});function pve(){const t=$e();return a.jsxs("div",{className:Se("tlui-offline-indicator"),children:[t("status.offline"),a.jsx(Hr,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function fve({maxWidth:t=420,ignoreRightWidth:e=0,stylePanelWidth:n=148,marginBetweenZones:s=12,squeezeAmount:i=52,children:r}){const o=S.useRef(null),l=Ss(),c=S.useCallback(()=>{const d=o.current;if(!d)return;const u=d.parentElement.parentElement,h=u.querySelector(".tlui-layout__top__left"),p=u.querySelector(".tlui-layout__top__right"),f=u.offsetWidth,g=h.offsetWidth,y=p.offsetWidth,x=d.offsetWidth-e;let m=(f-x)/2;f%2!==0&&(m-=.5);const v=g+s,w=d.offsetLeft,_=Math.min(f-y-g-2*s,t),C=Math.max(m,v)-w;p.offsetWidth>n&&l<=6?d.style.setProperty("max-width",_-i+"px"):d.style.setProperty("max-width",_+"px"),d.style.setProperty("transform",`translate(${C}px, 0px)`)},[l,e,s,t,i,n]);return S.useLayoutEffect(()=>{const d=o.current;if(!d)return;const u=d.parentElement.parentElement,h=u.querySelector(".tlui-layout__top__left"),p=u.querySelector(".tlui-layout__top__right"),f=new ResizeObserver(c);return f.observe(h),f.observe(p),f.observe(u),f.observe(d),c(),()=>{f.disconnect()}},[c]),S.useLayoutEffect(()=>{c()}),a.jsx("div",{ref:o,className:"tlui-top-panel__container",children:r})}function gve(){const t=Eue()==="offline";return a.jsx(fve,{children:t&&a.jsx(pve,{})})}function mve(){const t=xe();return a.jsxs(a.Fragment,{children:[a.jsx(X,{...t["zoom-in"],noClose:!0}),a.jsx(X,{...t["zoom-out"],noClose:!0}),a.jsx(y4,{}),a.jsx(v4,{}),a.jsx(x4,{})]})}const yve=S.memo(function({children:e}){const n=vn(),[s,i]=Go("zoom menu"),r=e??a.jsx(mve,{});return a.jsxs(rI,{dir:"ltr",open:s,onOpenChange:i,modal:!1,children:[a.jsx(oI,{asChild:!0,dir:"ltr",children:a.jsx(vve,{})}),a.jsx(SS,{container:n,children:a.jsx(aI,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:a.jsx(Ai,{type:"menu",sourceId:"zoom-menu",children:r})})})]})}),vve=S.forwardRef(function(e,n){const s=K(),i=Ss(),r=Z("zoom",()=>s.getZoomLevel(),[s]),o=$e(),l=S.useCallback(()=>{s.resetZoom(s.getViewportScreenCenter(),{animation:{duration:s.options.animationMediumMs}})},[s]);return a.jsx(be,{ref:n,...e,type:"icon",title:`${o("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:i<Ht.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:l,icon:i<Ht.MOBILE?"zoom-in":void 0,children:i<Ht.MOBILE?null:a.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(r*100),"%"]})})}),Z4=S.createContext(null);function xve({overrides:t={},children:e}){const n=Bx(t),s=cS();return a.jsx(Z4.Provider,{value:S.useMemo(()=>({ContextMenu:Fge,ActionsMenu:uge,HelpMenu:null,ZoomMenu:yve,MainMenu:bme,Minimap:Tme,StylePanel:vye,PageMenu:jme,NavigationPanel:Pme,Toolbar:hve,KeyboardShortcutsDialog:ame,QuickActions:Ame,HelperButtons:rme,DebugPanel:qge,DebugMenu:Xge,MenuPanel:eme,SharePanel:s?Bme:null,CursorChatBubble:s?$ge:null,TopPanel:s?gve:null,...n}),[n,s]),children:e})}function ll(){const t=S.useContext(Z4);if(!t)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return t}function Sve({overrides:t,components:e,assetUrls:n,onUiEvent:s,forceMobile:i,children:r}){return a.jsx(Wae,{assetUrls:Ode(n),children:a.jsx(Vae,{overrides:Ude(t),children:a.jsx(Jce,{onEvent:s,children:a.jsx(Pde,{children:a.jsx(Qce,{children:a.jsx(Lde,{forceMobile:i,children:a.jsx(xve,{overrides:e,children:a.jsx(bve,{overrides:t,children:r})})})})})})})})}function bve({overrides:t,children:e}){const n=$de(t);return a.jsx(Pue,{overrides:n.actions,children:a.jsx(Dde,{overrides:n.tools,children:e})})}function wve(){const t=K(),{addToast:e}=dr();S.useEffect(()=>{function n({name:s,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${s} (${i}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return t.addListener("max-shapes",n),()=>{t.removeListener("max-shapes",n)}},[t,e])}const _ve=Oe.memo(function({renderDebugMenuItems:e,children:n,hideUi:s,components:i,...r}){return a.jsx(Sve,{...r,components:i,children:a.jsx(Cve,{hideUi:s,renderDebugMenuItems:e,children:n})})}),Cve=Oe.memo(function({children:e,hideUi:n,...s}){return a.jsxs(a.Fragment,{children:[e,n?null:a.jsx(Eve,{...s})]})}),Eve=Oe.memo(function(){const e=K(),n=$e(),s=Ss(),i=Ho(),r=Z("focus",()=>e.getInstanceState().isFocusMode,[e]),o=Z("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:l,TopPanel:c,MenuPanel:d,StylePanel:u,Toolbar:h,HelpMenu:p,NavigationPanel:f,HelperButtons:g,DebugPanel:y,CursorChatBubble:x}=ll();ave(),gue(),wve();const{"toggle-focus-mode":m}=xe();return a.jsxs("div",{className:Se("tlui-layout",{"tlui-layout__mobile":s<Ht.TABLET_SM}),"data-breakpoint":s,children:[r?a.jsx("div",{className:"tlui-layout__top",children:a.jsx(be,{type:"icon",className:"tlui-focus-button",title:n("focus-mode.toggle-focus-mode"),onClick:()=>m.onSelect("menu"),children:a.jsx(Be,{icon:"dot"})})}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"tlui-layout__top",children:[a.jsxs("div",{className:"tlui-layout__top__left",children:[d&&a.jsx(d,{}),g&&a.jsx(g,{})]}),a.jsx("div",{className:"tlui-layout__top__center",children:c&&a.jsx(c,{})}),a.jsxs("div",{className:"tlui-layout__top__right",children:[l&&a.jsx(l,{}),u&&s>=Ht.TABLET_SM&&!i&&a.jsx(u,{})]})]}),a.jsxs("div",{className:"tlui-layout__bottom",children:[a.jsxs("div",{className:"tlui-layout__bottom__main",children:[f&&a.jsx(f,{}),h&&a.jsx(h,{}),p&&a.jsx(p,{})]}),o&&y&&a.jsx(y,{})]})]}),a.jsx(Ade,{}),a.jsx(nde,{}),a.jsx(Rde,{}),a.jsx(sde,{}),x&&a.jsx(x,{})]})});async function Tve(t,e){const{url:n,style:s="normal",weight:i="500",display:r,featureSettings:o,stretch:l,unicodeRange:c,variant:d,format:u}=e,h={style:s,weight:i,display:r,featureSettings:o,stretch:l,unicodeRange:c,variant:d},p=new FontFace(t,`url(${n})`,h);return await p.load(),document.fonts.add(p),p.$$_url=n,p.$$_fontface=`
@font-face {
	font-family: ${p.family};
	font-stretch: ${p.stretch};
	font-weight: ${p.weight};
	font-style: ${p.style};
	src: url("${n}") format("${u}")
}`,p}const nm=(t,e)=>{const[n,s]=S.useState(2);return S.useEffect(()=>{let i=!1;return s(2),Tve(t,e).then(()=>{i||s(0)}).catch(r=>{i||(console.error(r),s(1))}),()=>{i=!0}},[t,e]),n};function Ive(t){return{draw:{url:t.fonts.draw,format:t.fonts.draw.split(".").pop()},serif:{url:t.fonts.serif,format:t.fonts.serif.split(".").pop()},sansSerif:{url:t.fonts.sansSerif,format:t.fonts.sansSerif.split(".").pop()},monospace:{url:t.fonts.monospace,format:t.fonts.monospace.split(".").pop()}}}function J4(t){const e=S.useMemo(()=>Ive(t),[t]),n=[nm("tldraw_draw",e.draw),nm("tldraw_serif",e.serif),nm("tldraw_sans",e.sansSerif),nm("tldraw_mono",e.monospace)];return{error:n.some(s=>s===1),done:!n.some(s=>s===2)}}function Pve(t){const{children:e,maxImageDimension:n,maxAssetSize:s,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:r,onMount:o,components:l={},shapeUtils:c=[],bindingUtils:d=[],tools:u=[],...h}=t,p=Bx(l),f=S.useMemo(()=>({Scribble:$N,ShapeIndicators:Tre,CollaboratorScribble:$N,SelectionForeground:_re,SelectionBackground:bre,Handles:mre,...p}),[p]),g=Gh(c),y=S.useMemo(()=>[...PB,...g],[g]),x=Gh(d),m=S.useMemo(()=>[...Y5,...x],[x]),v=Gh(u),w=S.useMemo(()=>[...vle,...Toe,...v],[v]),_=z3(h.assetUrls),{done:C,error:I}=J4(_);return I?a.jsx(H5,{children:"Could not load assets. Please refresh the page."}):C?a.jsx(nre,{initialState:"select",...h,components:f,shapeUtils:y,bindingUtils:m,tools:w,children:a.jsxs(_ve,{...h,components:f,children:[a.jsx(kve,{maxImageDimension:n,maxAssetSize:s,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:r,onMount:o}),e]})}):a.jsx(s1,{children:a.jsx(GT,{})})}function kve({maxImageDimension:t=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:n=TT,acceptedVideoMimeTypes:s=jL,onMount:i}){const r=K(),o=dr(),l=$e();G5(()=>{const u=[];return u.push(nle(r)),loe(r,{maxImageDimension:t,maxAssetSize:e,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:s},{toasts:o,msg:l}),u.push(r.store.props.onMount(r)),u.push(i==null?void 0:i(r)),()=>{u.forEach(h=>h==null?void 0:h())}});const{Canvas:c}=kt(),{ContextMenu:d}=ll();return d?a.jsx(d,{}):c?a.jsx(c,{}):null}S.memo(function(e){const[n,s]=S.useState(null),[i,r]=S.useState(null),o=Gh(e.shapeUtils??[]),l=S.useMemo(()=>[...PB,...o],[o]),c=Gh(e.bindingUtils??[]),d=S.useMemo(()=>[...Y5,...c],[c]),u=lre({snapshot:e.snapshot,shapeUtils:l}),h=z3(),{done:p,error:f}=J4(h),{pageId:g,bounds:y,scale:x,background:m,padding:v,darkMode:w,preserveAspectRatio:_,format:C="svg",licenseKey:I}=e;return S.useLayoutEffect(()=>{if(!i||!u||!p)return;let T=!1;const P=document.createElement("div");i.appendChild(P),i.classList.add("tl-container","tl-theme__light");const k=new le({store:u,shapeUtils:l,bindingUtils:d,tools:[],getContainer:()=>P,licenseKey:I});g&&k.setCurrentPage(g);const N=k.getCurrentPageShapeIds();async function O(){const R=await k.getSvgString([...N],{bounds:y,scale:x,background:m,padding:v,darkMode:w,preserveAspectRatio:_});if(R&&!T){if(C==="svg"){if(!T){const j=new Blob([R.svg],{type:"image/svg+xml"}),A=URL.createObjectURL(j);s(A)}}else if(C==="png"){const j=await J3(k,R.svg,{type:C,quality:1,scale:2,width:R.width,height:R.height});if(j&&!T){const A=URL.createObjectURL(j);s(A)}}}k.dispose()}return O(),()=>{T=!0}},[C,i,u,l,d,g,y,x,m,v,w,_,p,f,I]),f?a.jsx(H5,{children:"Could not load assets."}):p?a.jsx("div",{ref:r,style:{position:"relative",width:"100%",height:"100%"},children:n&&a.jsx("img",{src:n,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):a.jsx(s1,{children:a.jsx(GT,{})})});S.memo(function({children:e}){const n=$e(),s=Ss(),i=e??a.jsx(dme,{});return s<Ht.MOBILE?null:a.jsx("div",{className:"tlui-help-menu",children:a.jsxs(Ql,{id:"help menu",children:[a.jsx(ec,{children:a.jsx(be,{type:"help",title:n("help-menu.title"),"data-testid":"help-menu.button",children:a.jsx(Be,{icon:"question-mark",small:!0})})}),a.jsx(tc,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:a.jsx(Ai,{type:"menu",sourceId:"help-menu",children:i})})]})})});const jve=Ue({schemaVersion:Qn(1),storeVersion:Pm,recordVersions:ev(je,Ue({version:Pm,subTypeVersions:ev(je,Pm).optional(),subTypeKey:je.optional()}))}),Nve=Ue({schemaVersion:Qn(2),sequences:ev(je,Pm)});Ue({tldrawFileFormatVersion:xQ,schema:SQ("schemaVersion",{1:jve,2:Nve}),records:Pn(Ue({id:je,typeName:je}).allowUnknownProperties())});function Ave({onAction:t,onDismiss:e}){const[n,s]=S.useState(!1),i=o=>{s(!0),setTimeout(()=>{e(),t(o)},300)},r=[{id:"draw",icon:"",title:"DRAW",desc:"Start creating on the infinite canvas",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{id:"store",icon:"",title:"PANDA STORE",desc:"Install apps and tools",gradient:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},{id:"chat",icon:"",title:"PANDA AI",desc:"Chat with 5 AI models",gradient:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"}];return a.jsx("div",{className:`pf-welcome-overlay ${n?"pf-welcome-exit":""}`,children:a.jsxs("div",{className:"pf-welcome-content",children:[a.jsx("div",{className:"pf-welcome-logo",children:a.jsx("img",{src:"./panda-icon.png",alt:"Panda Fabrics",className:"pf-logo-icon-lg",style:{width:"80px",height:"80px"}})}),a.jsx("h2",{className:"pf-welcome-title",children:"WELCOME TO PANDA FABRICS"}),a.jsx("p",{className:"pf-welcome-subtitle",children:"Your infinite workspace. Choose where to begin:"}),a.jsx("div",{className:"pf-welcome-cards",children:r.map(o=>a.jsxs("button",{className:"pf-welcome-card",onClick:()=>i(o.id),style:{"--card-gradient":o.gradient},children:[a.jsx("span",{className:"pf-welcome-card-icon",children:o.icon}),a.jsx("strong",{className:"pf-welcome-card-title",children:o.title}),a.jsx("span",{className:"pf-welcome-card-desc",children:o.desc})]},o.id))}),a.jsx("button",{className:"pf-welcome-skip",onClick:()=>i("skip"),children:"Skip and explore freely "})]})})}function Rve({plugins:t,roomId:e="panda-pf-default",onEditorMount:n}){const[s,i]=S.useState(()=>localStorage.getItem("panda_theme")!=="light"),[r,o]=S.useState(()=>localStorage.getItem("panda_grid_visible")!=="false"),[l,c]=S.useState(null),[d,u]=S.useState(!1);S.useEffect(()=>{if(!l)return;const m=setTimeout(()=>{try{const v=l.getCurrentPageShapes(),w=sessionStorage.getItem("pf_welcome_dismissed");v.length===0&&!w?u(!0):u(!1)}catch{}},500);return()=>clearTimeout(m)},[l]);const h=S.useCallback(x=>{if(l)try{l.user.updateUserPreferences({colorScheme:x?"dark":"light"})}catch(m){console.log("Theme sync error:",m)}},[l]);S.useEffect(()=>{const x=new MutationObserver(m=>{m.forEach(v=>{if(v.attributeName==="class"){const w=document.body.classList.contains("light-mode");i(!w),h(!w)}})});return x.observe(document.body,{attributes:!0}),()=>x.disconnect()},[h]),S.useEffect(()=>{l&&h(s)},[l,s,h]),S.useEffect(()=>{window.PandaCanvas={toggleGrid:()=>o(x=>{const m=!x;return localStorage.setItem("panda_grid_visible",String(m)),m}),isGridVisible:()=>r,setDarkMode:x=>{i(x),h(x)}}},[r,h]);const p={Toolbar:null,StylePanel:null,NavigationPanel:null,MainMenu:null,PageMenu:null,ActionsMenu:null,QuickActions:null,HelpMenu:null,ZoomMenu:null,ContextMenu:void 0,KeyboardShortcutsDialog:void 0},f=S.useCallback(x=>{console.log("TLDraw Editor mounted"),c(x);const m=document.body.classList.contains("light-mode");try{x.user.updateUserPreferences({colorScheme:m?"light":"dark"})}catch(v){console.log("Initial theme set error:",v)}window.TLDrawEditor=x,n&&n(x)},[n]),g=S.useCallback(x=>{switch(x){case"draw":if(window.TLDrawEditor)try{window.TLDrawEditor.setCurrentTool("draw")}catch{}break;case"store":window.dispatchEvent(new CustomEvent("panda:open-store"));break;case"chat":window.dispatchEvent(new CustomEvent("panda:toggle-chat"));break}},[]),y=S.useCallback(()=>{sessionStorage.setItem("pf_welcome_dismissed","1"),u(!1)},[]);return a.jsxs("div",{className:`pf-canvas-wrapper ${r?"show-grid":""} ${s?"dark":"light"}`,children:[a.jsx(Pve,{persistenceKey:e,components:p,onMount:f}),d&&a.jsx(Ave,{onAction:g,onDismiss:y}),t&&t.length>0&&a.jsxs("div",{className:"pf-plugins-indicator",children:[t.length," plugin(s) active"]})]})}function Mve({onCatalogClick:t,onToolsClick:e,onStoreClick:n,onSettingsClick:s,onFinanceClick:i,onGasometerClick:r,onCouncilClick:o,onDiagnosticsClick:l,plugins:c=[],onPluginOpen:d,onPluginClose:u,onPluginUninstall:h,onDevModeToggle:p,devMode:f,isFounder:g=!1}){var q;const[y,x]=S.useState(!1),[m,v]=S.useState(!1),[w,_]=S.useState(!1),[C,I]=S.useState({x:16,y:null}),[T,P]=S.useState(null),k=S.useRef(null),N=S.useRef({x:0,y:0}),O=S.useRef({x:0,y:0}),R=5;S.useEffect(()=>{const V=localStorage.getItem("panda_dock_position");if(V)try{I(JSON.parse(V))}catch{}},[]),S.useEffect(()=>{C.y!==null&&localStorage.setItem("panda_dock_position",JSON.stringify(C))},[C]),S.useEffect(()=>{if(!T)return;const V=()=>P(null);return window.addEventListener("click",V),()=>window.removeEventListener("click",V)},[T]);const j=S.useCallback(V=>{if(V.target.closest(".pf-dock-item")||V.target.closest("button"))return;V.preventDefault();const ee=k.current.getBoundingClientRect();N.current={x:V.clientX-ee.left,y:V.clientY-ee.top},O.current={x:V.clientX,y:V.clientY},_(!0)},[]),A=S.useCallback(V=>{var he,_e;if(!m&&!w)return;if(!m&&w){const Pe=Math.abs(V.clientX-O.current.x),qt=Math.abs(V.clientY-O.current.y);if(Pe<R&&qt<R)return;v(!0),_(!1)}const ee=V.clientX-N.current.x,Q=V.clientY-N.current.y,ae=window.innerWidth-(((he=k.current)==null?void 0:he.offsetWidth)||70),ue=window.innerHeight-(((_e=k.current)==null?void 0:_e.offsetHeight)||200);I({x:Math.max(0,Math.min(ee,ae)),y:Math.max(0,Math.min(Q,ue))})},[m,w]),B=S.useCallback(()=>{v(!1),_(!1)},[]);S.useEffect(()=>{if(m||w)return window.addEventListener("mousemove",A),window.addEventListener("mouseup",B),()=>{window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",B)}},[m,w,A,B]);const L=V=>{d?d(V):console.log(" Plugin opened:",V.id,V.name)},$=(V,ee)=>{V.preventDefault(),V.stopPropagation(),P({x:V.clientX,y:V.clientY,plugin:ee})},M=()=>{if(!T)return;const{plugin:V}=T;h&&h(V.id),P(null)},D=()=>{if(!T)return;const{plugin:V}=T;u&&u(V.id),P(null)},U=()=>{y||x(!0),p&&p(!0)},z=c.map(V=>({id:V.id,icon:V.icon||"",label:V.name,data:V})),H={position:"fixed",left:`${C.x}px`,top:C.y!==null?`${C.y}px`:"50%",transform:C.y!==null?"none":"translateY(-50%)",cursor:m?"grabbing":"grab"};return a.jsxs(a.Fragment,{children:[a.jsxs("nav",{className:`pf-left-dock ${m?"dragging":""}`,ref:k,style:H,onMouseDown:j,role:"toolbar","aria-label":"Barra de ferramentas principal","aria-orientation":"vertical",children:[a.jsx("div",{className:"pf-dock-handle",title:"ARRASTE PARA MOVER",children:""}),a.jsxs("div",{className:"pf-dock-items",children:[a.jsx("button",{className:"pf-dock-item section-toggle",onClick:e,title:"FERRAMENTAS","aria-label":"Ferramentas de desenho",children:""}),a.jsx("button",{className:"pf-dock-item",onClick:t,title:"MEU CATLOGO","aria-label":"Meu catlogo de apps",children:""}),a.jsx("div",{className:"pf-dock-separator"}),a.jsx("button",{className:"pf-dock-item",onClick:n,title:"PANDA STORE (Ctrl+K)","aria-label":"Abrir Panda Store",children:a.jsx("img",{src:"./panda-logo.png",alt:"Panda Store",style:{width:28,height:28}})}),a.jsx("div",{className:"pf-dock-separator"}),a.jsx("button",{className:"pf-dock-item",onClick:i,title:"FINANCE","aria-label":"Open finance panel",children:""}),a.jsx("button",{className:"pf-dock-item",onClick:r,title:"GASOMETER","aria-label":"Open gasometer panel",children:""}),a.jsx("button",{className:"pf-dock-item",onClick:o,title:"PAT COUNCIL","aria-label":"Open PAT Council",children:""}),a.jsx("div",{className:"pf-dock-separator"}),a.jsx("button",{className:"pf-dock-item",onClick:s,title:"CONFIGURAES (Ctrl+,)","aria-label":"Configuraes",children:""}),g&&a.jsx("button",{className:"pf-dock-item",onClick:l,title:"DIAGNOSTICS","aria-label":"Open system diagnostics",children:""}),a.jsx("button",{className:`pf-dock-item dev-toggle ${y?"active":""}`,onClick:U,title:"DEV MODE (Ctrl+D)","aria-label":y?"Fechar Dev Mode":"Abrir Dev Mode","aria-expanded":y,"aria-pressed":y,children:y?"":""}),z.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"pf-dock-separator"}),a.jsx("div",{className:"pf-dock-dynamic",children:z.map(V=>{var ee;return a.jsx("button",{className:"pf-dock-item dynamic",onClick:()=>L(V.data),onContextMenu:Q=>$(Q,V.data),title:`${(ee=V.label)==null?void 0:ee.toUpperCase()}
(CLIQUE DIREITO  OPES)`,children:V.icon},V.id)})})]})]})]}),T&&a.jsxs("div",{className:"pf-dock-context-menu",role:"menu","aria-label":`Opes para ${T.plugin.name||"plugin"}`,style:{position:"fixed",left:T.x,top:T.y,zIndex:99999,background:"rgba(15, 15, 30, 0.95)",border:"1px solid rgba(102, 126, 234, 0.3)",borderRadius:8,padding:"4px 0",minWidth:160,boxShadow:"0 8px 24px rgba(0,0,0,0.5)",backdropFilter:"blur(12px)"},onClick:V=>V.stopPropagation(),children:[a.jsxs("div",{style:{padding:"8px 16px",fontSize:12,color:"#8b8bab",borderBottom:"1px solid rgba(102, 126, 234, 0.15)"},children:[T.plugin.icon||""," ",(q=T.plugin.name)==null?void 0:q.toUpperCase()]}),a.jsx("button",{style:{display:"block",width:"100%",padding:"8px 16px",background:"none",border:"none",color:"#e0e0ff",cursor:"pointer",textAlign:"left",fontSize:13},onMouseEnter:V=>V.target.style.background="rgba(102, 126, 234, 0.15)",onMouseLeave:V=>V.target.style.background="none",onClick:()=>L(T.plugin),role:"menuitem",children:" ABRIR"}),a.jsx("button",{style:{display:"block",width:"100%",padding:"8px 16px",background:"none",border:"none",color:"#fbbf24",cursor:"pointer",textAlign:"left",fontSize:13},onMouseEnter:V=>V.target.style.background="rgba(251, 191, 36, 0.15)",onMouseLeave:V=>V.target.style.background="none",onClick:D,role:"menuitem",children:" FECHAR"}),a.jsx("button",{style:{display:"block",width:"100%",padding:"8px 16px",background:"none",border:"none",color:"#ef4444",cursor:"pointer",textAlign:"left",fontSize:13},onMouseEnter:V=>V.target.style.background="rgba(239, 68, 68, 0.15)",onMouseLeave:V=>V.target.style.background="none",onClick:M,role:"menuitem",children:" DESINSTALAR"})]})]})}const kv={jam:{endpoint:"/api/health",services:["rust","firebase","gas","gpu","mcp"],pollInterval:5e3},store:{endpoint:"/api/health/store",services:["github","payment","cdn","analytics"],pollInterval:1e4},devtools:{endpoint:"/api/health/dev",services:["vsx","mcp","debugger","terminal"],pollInterval:5e3},admin:{endpoint:"/api/health/admin",services:["firestore","gas","bigquery","users"],pollInterval:15e3}},Ove=t=>{const e={rust:{status:"ready",message:"Rust Agent v0.2.0"},firebase:{status:"connected",latency_ms:45},gas:{status:"connected",latency_ms:120},gpu:{status:"unavailable",message:"No NVIDIA GPU"},mcp:{status:"ready",details:{tools:"5"}},github:{status:"connected",message:"API connected"},payment:{status:"ready",message:"PC Gateway active"},cdn:{status:"connected",latency_ms:25},analytics:{status:"connected",message:"Firebase Analytics"},vsx:{status:"ready",message:"VSX Extension loaded"},debugger:{status:"unavailable",message:"Not attached"},terminal:{status:"ready",message:"PowerShell"},firestore:{status:"connected",latency_ms:35},bigquery:{status:"connected",message:"1TB/month"},users:{status:"connected",details:{count:"1,247"}}},n=kv[t]||kv.jam,s={};return n.services.forEach(i=>{s[i]=e[i]||{status:"notinitialized"}}),{version:"0.2.0",uptime_secs:Math.floor((Date.now()-(window._pandaStartTime||Date.now()))/1e3),status:"healthy",context:t,services:s}};function Q4(t="jam"){const[e,n]=S.useState(null),[s,i]=S.useState(!0),[r,o]=S.useState(null),l=kv[t]||kv.jam,c=S.useCallback(async()=>{try{const h=Ove(t);n(h),o(null)}catch(h){o(h.message),console.error(`Health check failed for ${t}:`,h)}finally{i(!1)}},[t,l.endpoint]);S.useEffect(()=>{window._pandaStartTime=window._pandaStartTime||Date.now(),c();const h=setInterval(c,l.pollInterval);return()=>clearInterval(h)},[c,l.pollInterval]);const d=(e==null?void 0:e.status)==="healthy",u=e!=null&&e.services?Object.entries(e.services).map(([h,p])=>({name:h,...p,isHealthy:["ready","connected","available"].includes(p.status)})):[];return{health:e,isLoading:s,error:r,isConnected:d,services:u,refresh:c}}const Dve={tagline:"A 4 Camada Digital  Empacote, Venda, Escale",description:"Existem 3 camadas digitais: infraestrutura, plataformas e ferramentas. Nenhuma ajuda voc a COMPOR as trs num produto empacotado. Panda Factory  essa camada  um SDK de orquestrao com marketplace prprio e economia de co-produo. Zero custo fixo. Ganhamos s quando voc ganha.",welcomeBack:"Bem-vindo de volta",signInSubtitle:"Faa login para acessar seu workspace",signInGoogle:"Entrar com Google",soon:"Em breve",or:"ou",email:"Email",password:"Senha",signInEmail:"Entrar com Email",signingIn:"Entrando...",freeHint:" Acesso gratuito  explore sem carto de crdito",forgotPassword:"Esqueceu a senha?",demoLabel:"Credenciais de demonstrao MVP",invalidCredentials:"Email ou senha invlidos",loading:"Carregando...",features:[{icon:"",title:"4 Camada Digital",desc:"Orquestre Infra + Plataformas + IA em um nico SDK"},{icon:"",title:"17 Namespaces",desc:"Auth, Brain, Store, Wallet  tudo com um import"},{icon:"",title:"Revenue Share para Devs",desc:"70% Store  40% Usage  85% Hook Prprio  o split mais justo do mercado"},{icon:"",title:"IA Nativa em Tudo",desc:"Gemini Pro, Flash, Think  j integrado por padro"},{icon:"",title:"Medusa + Hotmart",desc:"Publique com um comando, distribua para 34M+ compradores"},{icon:"",title:"Panda Defend",desc:"A 4 camada se auto-governa  14 regras, kill switch"}],stats:[{value:"17",label:"SDK namespaces"},{value:"3",label:"camadas compostas"},{value:"70%",label:"receita do dev"},{value:"0",label:"custo fixo"}]},Lve={openStore:"ABRIR LOJA",lightMode:"MODO CLARO",darkMode:"MODO ESCURO",notifications:"NOTIFICAES",mining:"MINERAO",defend:"PANDA DEFEND",founder:"PAINEL FOUNDER",settings:"CONFIGURAES",logout:"SAIR",logoutConfirm:"Sair do Panda Fabrics?",unpinBar:"DESAFIXAR BARRA",pinBar:"FIXAR BARRA",energy:"ENERGIA",treasury:"TESOURO  ABRIR CONSELHO PAT",session:"SESSO"},Fve={step1Title:"Bem-vindo ao Panda Factory",step1Desc:"A 4 Camada Digital  vamos configurar seu workspace.",step2Title:"Escolha Seu Tema",step2Desc:"Escolha o visual que mais combina com voc.",step3Title:"Explore o SDK",step3Desc:"17 namespaces na ponta dos dedos  Auth, Brain, Store, Wallet e mais.",step4Title:"Voc Est Pronto!",step4Desc:"Comece a criar, publicar e ganhar.",next:"Prximo",back:"Voltar",finish:"Concluir",skip:"Pular"},Bve={title:"Panda Store",searchPlaceholder:"Buscar mdulos, tentculos, temas...",install:"Instalar",installed:"Instalado",uninstall:"Desinstalar",price:"Preo",free:"Grtis",category:"Categoria",allCategories:"Todas as Categorias",rating:"Avaliao",downloads:"Downloads",publishedBy:"Publicado por",devRevenue:"Dev ganha 70%",usageRevenue:"Dev ganha 40% por uso"},Uve={placeholder:"Pergunte qualquer coisa ao Panda Brain...",send:"Enviar",thinking:"Pensando...",errorGeneric:"Algo deu errado. Tente novamente.",clearHistory:"Limpar Histrico",model:"Modelo",tokens:"Tokens usados"},$ve={title:"Configuraes",general:"Geral",appearance:"Aparncia",language:"Idioma",notifications:"Notificaes",account:"Conta",about:"Sobre",version:"Verso",darkMode:"Modo Escuro",lightMode:"Modo Claro",autoSave:"Salvar Automaticamente",resetDefaults:"Restaurar Padres"},zve={language:"Idioma",close:"Fechar",save:"Salvar",cancel:"Cancelar",confirm:"Confirmar",delete:"Excluir",edit:"Editar",loading:"Carregando...",error:"Erro",success:"Sucesso",retry:"Tentar novamente",back:"Voltar",next:"Prximo",search:"Buscar",noResults:"Nenhum resultado encontrado"},Wve={login:Dve,statusBar:Lve,wizard:Fve,store:Bve,chat:Uve,settings:$ve,common:zve},Hve={tagline:"The 4th Digital Layer  Package, Sell, Scale",description:"There are 3 digital layers today: infrastructure, platforms, and tools. None of them help you COMPOSE all three into a packaged product. Panda Factory IS that layer  an orchestration SDK with its own marketplace and co-production economy. Zero upfront cost. We only earn when you earn.",welcomeBack:"Welcome back",signInSubtitle:"Sign in to access your workspace",signInGoogle:"Sign in with Google",soon:"Soon",or:"or",email:"Email",password:"Password",signInEmail:"Sign in with Email",signingIn:"Signing in...",freeHint:" Free access  explore without a credit card",forgotPassword:"Forgot password?",demoLabel:"MVP Demo Credentials",invalidCredentials:"Invalid email or password",loading:"Loading...",features:[{icon:"",title:"4th Digital Layer",desc:"Orchestrate Infra + Platforms + AI with a single SDK"},{icon:"",title:"17 Namespaces",desc:"Auth, Brain, Store, Wallet  all with one import"},{icon:"",title:"Dev Revenue Share",desc:"70% Store  40% Usage  85% Own Hook  the fairest split in tech"},{icon:"",title:"AI-Native Everything",desc:"Gemini Pro, Flash, Think  built in by default"},{icon:"",title:"Medusa + Hotmart",desc:"Publish with one command, reach 34M+ buyers"},{icon:"",title:"Panda Defend",desc:"The 4th layer governs itself  14 rules, kill switch"}],stats:[{value:"17",label:"SDK namespaces"},{value:"3",label:"layers composed"},{value:"70%",label:"dev revenue"},{value:"0",label:"fixed cost"}]},Gve={openStore:"OPEN STORE",lightMode:"LIGHT MODE",darkMode:"DARK MODE",notifications:"NOTIFICATIONS",mining:"MY MINING",defend:"PANDA DEFEND",founder:"FOUNDER DASHBOARD",settings:"SETTINGS",logout:"LOGOUT",logoutConfirm:"Log out of Panda Fabrics?",unpinBar:"UNPIN BAR",pinBar:"PIN BAR",energy:"ENERGY",treasury:"TREASURY  OPEN PAT COUNCIL",session:"SESSION"},Vve={step1Title:"Welcome to Panda Factory",step1Desc:"The 4th Digital Layer  let's set up your workspace.",step2Title:"Choose Your Theme",step2Desc:"Pick the look that suits you best.",step3Title:"Explore the SDK",step3Desc:"17 namespaces at your fingertips  Auth, Brain, Store, Wallet, and more.",step4Title:"You're Ready!",step4Desc:"Start creating, publishing, and earning.",next:"Next",back:"Back",finish:"Finish",skip:"Skip"},Kve={title:"Panda Store",searchPlaceholder:"Search modules, tentacles, themes...",install:"Install",installed:"Installed",uninstall:"Uninstall",price:"Price",free:"Free",category:"Category",allCategories:"All Categories",rating:"Rating",downloads:"Downloads",publishedBy:"Published by",devRevenue:"Dev earns 70%",usageRevenue:"Dev earns 40% from usage"},Yve={placeholder:"Ask Panda Brain anything...",send:"Send",thinking:"Thinking...",errorGeneric:"Something went wrong. Try again.",clearHistory:"Clear History",model:"Model",tokens:"Tokens used"},Xve={title:"Settings",general:"General",appearance:"Appearance",language:"Language",notifications:"Notifications",account:"Account",about:"About",version:"Version",darkMode:"Dark Mode",lightMode:"Light Mode",autoSave:"Auto Save",resetDefaults:"Reset to Defaults"},qve={language:"Language",close:"Close",save:"Save",cancel:"Cancel",confirm:"Confirm",delete:"Delete",edit:"Edit",loading:"Loading...",error:"Error",success:"Success",retry:"Retry",back:"Back",next:"Next",search:"Search",noResults:"No results found"},Zve={login:Hve,statusBar:Gve,wizard:Vve,store:Kve,chat:Yve,settings:Xve,common:qve},Jve={tagline:"La 4 Capa Digital  Empaqueta, Vende, Escala",description:"Existen 3 capas digitales hoy: infraestructura, plataformas y herramientas. Ninguna te ayuda a COMPONER las tres en un producto empaquetado. Panda Factory ES esa capa  un SDK de orquestacin con marketplace propio y economa de co-produccin. Cero costo fijo. Solo ganamos cuando t ganas.",welcomeBack:"Bienvenido de nuevo",signInSubtitle:"Inicia sesin para acceder a tu workspace",signInGoogle:"Iniciar sesin con Google",soon:"Pronto",or:"o",email:"Correo electrnico",password:"Contrasea",signInEmail:"Iniciar sesin con Email",signingIn:"Iniciando sesin...",freeHint:" Acceso gratuito  explora sin tarjeta de crdito",forgotPassword:"Olvidaste tu contrasea?",demoLabel:"Credenciales de demostracin MVP",invalidCredentials:"Correo o contrasea invlidos",loading:"Cargando...",features:[{icon:"",title:"4 Capa Digital",desc:"Orquesta Infra + Plataformas + IA con un solo SDK"},{icon:"",title:"17 Namespaces",desc:"Auth, Brain, Store, Wallet  todo con un import"},{icon:"",title:"Revenue Share para Devs",desc:"70% Store  40% Usage  85% Hook Propio  el split ms justo del mercado"},{icon:"",title:"IA Nativa en Todo",desc:"Gemini Pro, Flash, Think  integrado por defecto"},{icon:"",title:"Medusa + Hotmart",desc:"Publica con un comando, llega a 34M+ compradores"},{icon:"",title:"Panda Defend",desc:"La 4 capa se autogobierna  14 reglas, kill switch"}],stats:[{value:"17",label:"SDK namespaces"},{value:"3",label:"capas compuestas"},{value:"70%",label:"ingresos del dev"},{value:"0",label:"costo fijo"}]},Qve={openStore:"ABRIR TIENDA",lightMode:"MODO CLARO",darkMode:"MODO OSCURO",notifications:"NOTIFICACIONES",mining:"MI MINERA",defend:"PANDA DEFEND",founder:"PANEL FUNDADOR",settings:"CONFIGURACIN",logout:"SALIR",logoutConfirm:"Salir de Panda Fabrics?",unpinBar:"DESFIJAR BARRA",pinBar:"FIJAR BARRA",energy:"ENERGA",treasury:"TESORO  ABRIR CONSEJO PAT",session:"SESIN"},exe={step1Title:"Bienvenido a Panda Factory",step1Desc:"La 4 Capa Digital  configuremos tu workspace.",step2Title:"Elige Tu Tema",step2Desc:"Escoge el estilo que ms te guste.",step3Title:"Explora el SDK",step3Desc:"17 namespaces a tu alcance  Auth, Brain, Store, Wallet y ms.",step4Title:"Ests Listo!",step4Desc:"Comienza a crear, publicar y ganar.",next:"Siguiente",back:"Atrs",finish:"Finalizar",skip:"Saltar"},txe={title:"Panda Store",searchPlaceholder:"Buscar mdulos, tentculos, temas...",install:"Instalar",installed:"Instalado",uninstall:"Desinstalar",price:"Precio",free:"Gratis",category:"Categora",allCategories:"Todas las Categoras",rating:"Calificacin",downloads:"Descargas",publishedBy:"Publicado por",devRevenue:"Dev gana 70%",usageRevenue:"Dev gana 40% por uso"},nxe={placeholder:"Pregntale lo que quieras a Panda Brain...",send:"Enviar",thinking:"Pensando...",errorGeneric:"Algo sali mal. Intntalo de nuevo.",clearHistory:"Limpiar Historial",model:"Modelo",tokens:"Tokens usados"},sxe={title:"Configuracin",general:"General",appearance:"Apariencia",language:"Idioma",notifications:"Notificaciones",account:"Cuenta",about:"Acerca de",version:"Versin",darkMode:"Modo Oscuro",lightMode:"Modo Claro",autoSave:"Guardar Automticamente",resetDefaults:"Restablecer Predeterminados"},ixe={language:"Idioma",close:"Cerrar",save:"Guardar",cancel:"Cancelar",confirm:"Confirmar",delete:"Eliminar",edit:"Editar",loading:"Cargando...",error:"Error",success:"xito",retry:"Reintentar",back:"Atrs",next:"Siguiente",search:"Buscar",noResults:"No se encontraron resultados"},rxe={login:Jve,statusBar:Qve,wizard:exe,store:txe,chat:nxe,settings:sxe,common:ixe},ay={"pt-BR":{label:"PT",flag:"",name:"Portugus"},en:{label:"ENG",flag:"",name:"English"},es:{label:"ESP",flag:"",name:"Espaol"}},ly={"pt-BR":Wve,en:Zve,es:rxe},ez="panda_locale";function oxe(){const t=localStorage.getItem(ez);if(t&&ly[t])return t;const e=navigator.language||navigator.userLanguage||"pt-BR";return e.startsWith("es")?"es":e.startsWith("en")?"en":"pt-BR"}const tz=S.createContext(null);function axe({children:t}){const[e,n]=S.useState(oxe),s=S.useCallback(r=>{ly[r]&&(n(r),localStorage.setItem(ez,r),window.dispatchEvent(new CustomEvent("panda-locale-change",{detail:r})))},[]),i=S.useCallback((r,o)=>{const l=ly[e]||ly["pt-BR"],c=r.split(".");let d=l;for(const u of c){if(d==null)return o||r;d=d[u]}return d??(o||r)},[e]);return a.jsx(tz.Provider,{value:{locale:e,setLocale:s,t:i},children:t})}function hI(){const t=S.useContext(tz);return t||{locale:"pt-BR",setLocale:()=>{},t:e=>e}}function lxe(){const{locale:t,setLocale:e}=hI(),[n,s]=S.useState(!1),i=S.useRef(null);S.useEffect(()=>{const o=l=>{i.current&&!i.current.contains(l.target)&&s(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const r=ay[t]||ay["pt-BR"];return a.jsxs("div",{className:"pf-lang-selector",ref:i,children:[a.jsxs("button",{className:"pf-lang-trigger pf-header-btn",onClick:()=>s(!n),title:`Language: ${r.name}`,"aria-label":`Current language: ${r.name}. Click to change.`,"aria-haspopup":"listbox","aria-expanded":n,children:[a.jsx("span",{className:"pf-lang-flag",children:r.flag}),a.jsx("span",{className:"pf-lang-code",children:r.label})]}),n&&a.jsx("div",{className:"pf-lang-dropdown",role:"listbox","aria-label":"Select language",children:Object.entries(ay).map(([o,l])=>a.jsxs("button",{className:`pf-lang-option ${o===t?"active":""}`,onClick:()=>{e(o),s(!1)},role:"option","aria-selected":o===t,children:[a.jsx("span",{className:"pf-lang-flag",children:l.flag}),a.jsx("span",{className:"pf-lang-name",children:l.name}),a.jsx("span",{className:"pf-lang-code",children:l.label}),o===t&&a.jsx("span",{className:"pf-lang-check",children:""})]},o))})]})}var dR={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nz={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const re=function(t,e){if(!t)throw hu(e)},hu=function(t){return new Error("Firebase Database ("+nz.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sz=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&s+1<t.length&&(t.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++s)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},cxe=function(t){const e=[];let n=0,s=0;for(;n<t.length;){const i=t[n++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=t[n++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=t[n++],o=t[n++],l=t[n++],c=((i&7)<<18|(r&63)<<12|(o&63)<<6|l&63)-65536;e[s++]=String.fromCharCode(55296+(c>>10)),e[s++]=String.fromCharCode(56320+(c&1023))}else{const r=t[n++],o=t[n++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},pI={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<t.length;i+=3){const r=t[i],o=i+1<t.length,l=o?t[i+1]:0,c=i+2<t.length,d=c?t[i+2]:0,u=r>>2,h=(r&3)<<4|l>>4;let p=(l&15)<<2|d>>6,f=d&63;c||(f=64,o||(p=64)),s.push(n[u],n[h],n[p],n[f])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(sz(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):cxe(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<t.length;){const r=n[t.charAt(i++)],l=i<t.length?n[t.charAt(i)]:0;++i;const d=i<t.length?n[t.charAt(i)]:64;++i;const h=i<t.length?n[t.charAt(i)]:64;if(++i,r==null||l==null||d==null||h==null)throw new dxe;const p=r<<2|l>>4;if(s.push(p),d!==64){const f=l<<4&240|d>>2;if(s.push(f),h!==64){const g=d<<6&192|h;s.push(g)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class dxe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const iz=function(t){const e=sz(t);return pI.encodeByteArray(e,!0)},jv=function(t){return iz(t).replace(/\./g,"")},Nv=function(t){try{return pI.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uxe(t){return rz(void 0,t)}function rz(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const n=e;return new Date(n.getTime());case Object:t===void 0&&(t={});break;case Array:t=[];break;default:return e}for(const n in e)!e.hasOwnProperty(n)||!hxe(n)||(t[n]=rz(t[n],e[n]));return t}function hxe(t){return t!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pxe(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fxe=()=>pxe().__FIREBASE_DEFAULTS__,gxe=()=>{if(typeof process>"u"||typeof dR>"u")return;const t=dR.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},mxe=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&Nv(t[1]);return e&&JSON.parse(e)},fI=()=>{try{return fxe()||gxe()||mxe()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},oz=t=>{var e,n;return(n=(e=fI())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},yxe=t=>{const e=oz(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),s]:[e.substring(0,n),s]},az=()=>{var t;return(t=fI())===null||t===void 0?void 0:t.config},lz=t=>{var e;return(e=fI())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Af{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,s)=>{n?this.reject(n):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vxe(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},s=e||"demo-project",i=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[jv(JSON.stringify(n)),jv(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gs(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function gI(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(gs())}function xxe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Sxe(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function cz(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function bxe(){const t=gs();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function wxe(){return nz.NODE_ADMIN===!0}function _xe(){try{return typeof indexedDB=="object"}catch{return!1}}function Cxe(){return new Promise((t,e)=>{try{let n=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(s),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Exe="FirebaseError";class cl extends Error{constructor(e,n,s){super(n),this.code=e,this.customData=s,this.name=Exe,Object.setPrototypeOf(this,cl.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Rf.prototype.create)}}class Rf{constructor(e,n,s){this.service=e,this.serviceName=n,this.errors=s}create(e,...n){const s=n[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?Txe(r,s):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new cl(i,l,s)}}function Txe(t,e){return t.replace(Ixe,(n,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const Ixe=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dp(t){return JSON.parse(t)}function tn(t){return JSON.stringify(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dz=function(t){let e={},n={},s={},i="";try{const r=t.split(".");e=Dp(Nv(r[0])||""),n=Dp(Nv(r[1])||""),i=r[2],s=n.d||{},delete n.d}catch{}return{header:e,claims:n,data:s,signature:i}},Pxe=function(t){const e=dz(t),n=e.claims;return!!n&&typeof n=="object"&&n.hasOwnProperty("iat")},kxe=function(t){const e=dz(t).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qr(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function zd(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]}function RC(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Av(t,e,n){const s={};for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(s[i]=e.call(n,t[i],i,t));return s}function Rv(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const i of n){if(!s.includes(i))return!1;const r=t[i],o=e[i];if(uR(r)&&uR(o)){if(!Rv(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!n.includes(i))return!1;return!0}function uR(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pu(t){const e=[];for(const[n,s]of Object.entries(t))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function kh(t){const e={};return t.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function jh(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jxe{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,n){n||(n=0);const s=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)s[h]=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),n+=4;else for(let h=0;h<16;h++)s[h]=e[n]<<24|e[n+1]<<16|e[n+2]<<8|e[n+3],n+=4;for(let h=16;h<80;h++){const p=s[h-3]^s[h-8]^s[h-14]^s[h-16];s[h]=(p<<1|p>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],d,u;for(let h=0;h<80;h++){h<40?h<20?(d=l^r&(o^l),u=1518500249):(d=r^o^l,u=1859775393):h<60?(d=r&o|l&(r|o),u=2400959708):(d=r^o^l,u=3395469782);const p=(i<<5|i>>>27)+d+c+u+s[h]&4294967295;c=l,l=o,o=(r<<30|r>>>2)&4294967295,r=i,i=p}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,n){if(e==null)return;n===void 0&&(n=e.length);const s=n-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<n;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<n;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<n;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=n}digest(){const e=[];let n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=n&255,n/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function Nxe(t,e){const n=new Axe(t,e);return n.subscribe.bind(n)}class Axe{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,s){let i;if(e===void 0&&n===void 0&&s===void 0)throw new Error("Missing Observer.");Rxe(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:s},i.next===void 0&&(i.next=Fw),i.error===void 0&&(i.error=Fw),i.complete===void 0&&(i.complete=Fw);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Rxe(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Fw(){}function wS(t,e){return`${t} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mxe=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let i=t.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,re(s<t.length,"Surrogate pair missing trail surrogate.");const o=t.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):i<65536?(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},_S=function(t){let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,n++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function is(t){return t&&t._delegate?t._delegate:t}class nc{constructor(e,n,s){this.name=e,this.instanceFactory=n,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _l="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oxe{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const s=new Af;if(this.instancesDeferred.set(n,s),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Lxe(e))try{this.getOrInitializeService({instanceIdentifier:_l})}catch{}for(const[n,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=_l){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=_l){return this.instances.has(e)}getOptions(e=_l){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:n});for(const[r,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);s===l&&o.resolve(i)}return i}onInit(e,n){var s;const i=this.normalizeInstanceIdentifier(n),r=(s=this.onInitCallbacks.get(i))!==null&&s!==void 0?s:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,n){const s=this.onInitCallbacks.get(n);if(s)for(const i of s)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:Dxe(e),options:n}),this.instances.set(e,s),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=_l){return this.component?this.component.multipleInstances?e:_l:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Dxe(t){return t===_l?void 0:t}function Lxe(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fxe{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new Oxe(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ot;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ot||(ot={}));const Bxe={debug:ot.DEBUG,verbose:ot.VERBOSE,info:ot.INFO,warn:ot.WARN,error:ot.ERROR,silent:ot.SILENT},Uxe=ot.INFO,$xe={[ot.DEBUG]:"log",[ot.VERBOSE]:"log",[ot.INFO]:"info",[ot.WARN]:"warn",[ot.ERROR]:"error"},zxe=(t,e,...n)=>{if(e<t.logLevel)return;const s=new Date().toISOString(),i=$xe[e];if(i)console[i](`[${s}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class mI{constructor(e){this.name=e,this._logLevel=Uxe,this._logHandler=zxe,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ot))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Bxe[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ot.DEBUG,...e),this._logHandler(this,ot.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ot.VERBOSE,...e),this._logHandler(this,ot.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ot.INFO,...e),this._logHandler(this,ot.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ot.WARN,...e),this._logHandler(this,ot.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ot.ERROR,...e),this._logHandler(this,ot.ERROR,...e)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wxe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Hxe(n)){const s=n.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(n=>n).join(" ")}}function Hxe(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const MC="@firebase/app",hR="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Do=new mI("@firebase/app"),Gxe="@firebase/app-compat",Vxe="@firebase/analytics-compat",Kxe="@firebase/analytics",Yxe="@firebase/app-check-compat",Xxe="@firebase/app-check",qxe="@firebase/auth",Zxe="@firebase/auth-compat",Jxe="@firebase/database",Qxe="@firebase/data-connect",eSe="@firebase/database-compat",tSe="@firebase/functions",nSe="@firebase/functions-compat",sSe="@firebase/installations",iSe="@firebase/installations-compat",rSe="@firebase/messaging",oSe="@firebase/messaging-compat",aSe="@firebase/performance",lSe="@firebase/performance-compat",cSe="@firebase/remote-config",dSe="@firebase/remote-config-compat",uSe="@firebase/storage",hSe="@firebase/storage-compat",pSe="@firebase/firestore",fSe="@firebase/vertexai-preview",gSe="@firebase/firestore-compat",mSe="firebase",ySe="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OC="[DEFAULT]",vSe={[MC]:"fire-core",[Gxe]:"fire-core-compat",[Kxe]:"fire-analytics",[Vxe]:"fire-analytics-compat",[Xxe]:"fire-app-check",[Yxe]:"fire-app-check-compat",[qxe]:"fire-auth",[Zxe]:"fire-auth-compat",[Jxe]:"fire-rtdb",[Qxe]:"fire-data-connect",[eSe]:"fire-rtdb-compat",[tSe]:"fire-fn",[nSe]:"fire-fn-compat",[sSe]:"fire-iid",[iSe]:"fire-iid-compat",[rSe]:"fire-fcm",[oSe]:"fire-fcm-compat",[aSe]:"fire-perf",[lSe]:"fire-perf-compat",[cSe]:"fire-rc",[dSe]:"fire-rc-compat",[uSe]:"fire-gcs",[hSe]:"fire-gcs-compat",[pSe]:"fire-fst",[gSe]:"fire-fst-compat",[fSe]:"fire-vertex","fire-js":"fire-js",[mSe]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mv=new Map,xSe=new Map,DC=new Map;function pR(t,e){try{t.container.addComponent(e)}catch(n){Do.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Wd(t){const e=t.name;if(DC.has(e))return Do.debug(`There were multiple attempts to register component ${e}.`),!1;DC.set(e,t);for(const n of Mv.values())pR(n,t);for(const n of xSe.values())pR(n,t);return!0}function yI(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function kr(t){return t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SSe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Oa=new Rf("app","Firebase",SSe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bSe{constructor(e,n,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new nc("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Oa.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu=ySe;function uz(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const s=Object.assign({name:OC,automaticDataCollectionEnabled:!1},e),i=s.name;if(typeof i!="string"||!i)throw Oa.create("bad-app-name",{appName:String(i)});if(n||(n=az()),!n)throw Oa.create("no-options");const r=Mv.get(i);if(r){if(Rv(n,r.options)&&Rv(s,r.config))return r;throw Oa.create("duplicate-app",{appName:i})}const o=new Fxe(i);for(const c of DC.values())o.addComponent(c);const l=new bSe(n,s,o);return Mv.set(i,l),l}function hz(t=OC){const e=Mv.get(t);if(!e&&t===OC&&az())return uz();if(!e)throw Oa.create("no-app",{appName:t});return e}function Da(t,e,n){var s;let i=(s=vSe[t])!==null&&s!==void 0?s:t;n&&(i+=`-${n}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const l=[`Unable to register library "${i}" with version "${e}":`];r&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Do.warn(l.join(" "));return}Wd(new nc(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wSe="firebase-heartbeat-database",_Se=1,Lp="firebase-heartbeat-store";let Bw=null;function pz(){return Bw||(Bw=e1(wSe,_Se,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Lp)}catch(n){console.warn(n)}}}}).catch(t=>{throw Oa.create("idb-open",{originalErrorMessage:t.message})})),Bw}async function CSe(t){try{const n=(await pz()).transaction(Lp),s=await n.objectStore(Lp).get(fz(t));return await n.done,s}catch(e){if(e instanceof cl)Do.warn(e.message);else{const n=Oa.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Do.warn(n.message)}}}async function fR(t,e){try{const s=(await pz()).transaction(Lp,"readwrite");await s.objectStore(Lp).put(e,fz(t)),await s.done}catch(n){if(n instanceof cl)Do.warn(n.message);else{const s=Oa.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});Do.warn(s.message)}}}function fz(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ESe=1024,TSe=30*24*60*60*1e3;class ISe{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new kSe(n),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=gR();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r)?void 0:(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=TSe}),this._storage.overwrite(this._heartbeatsCache))}catch(s){Do.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=gR(),{heartbeatsToSend:s,unsentEntries:i}=PSe(this._heartbeatsCache.heartbeats),r=jv(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(n){return Do.warn(n),""}}}function gR(){return new Date().toISOString().substring(0,10)}function PSe(t,e=ESe){const n=[];let s=t.slice();for(const i of t){const r=n.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),mR(n)>e){r.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),mR(n)>e){n.pop();break}s=s.slice(1)}return{heartbeatsToSend:n,unsentEntries:s}}class kSe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return _xe()?Cxe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await CSe(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return fR(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return fR(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function mR(t){return jv(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jSe(t){Wd(new nc("platform-logger",e=>new Wxe(e),"PRIVATE")),Wd(new nc("heartbeat",e=>new ISe(e),"PRIVATE")),Da(MC,hR,t),Da(MC,hR,"esm2017"),Da("fire-js","")}jSe("");var NSe="firebase",ASe="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Da(NSe,ASe,"app");function gz(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const RSe=gz,mz=new Rf("auth","Firebase",gz());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ov=new mI("@firebase/auth");function MSe(t,...e){Ov.logLevel<=ot.WARN&&Ov.warn(`Auth (${fu}): ${t}`,...e)}function cy(t,...e){Ov.logLevel<=ot.ERROR&&Ov.error(`Auth (${fu}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(t,...e){throw xI(t,...e)}function er(t,...e){return xI(t,...e)}function vI(t,e,n){const s=Object.assign(Object.assign({},RSe()),{[e]:n});return new Rf("auth","Firebase",s).create(e,{appName:t.name})}function La(t){return vI(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function OSe(t,e,n){const s=n;if(!(e instanceof s))throw s.name!==e.constructor.name&&Ri(t,"argument-error"),vI(t,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function xI(t,...e){if(typeof t!="string"){const n=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=t.name),t._errorFactory.create(n,...s)}return mz.create(t,...e)}function Ie(t,e,...n){if(!t)throw xI(e,...n)}function mo(t){const e="INTERNAL ASSERTION FAILED: "+t;throw cy(e),new Error(e)}function Lo(t,e){t||mo(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LC(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.href)||""}function DSe(){return yR()==="http:"||yR()==="https:"}function yR(){var t;return typeof self<"u"&&((t=self.location)===null||t===void 0?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LSe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(DSe()||Sxe()||"connection"in navigator)?navigator.onLine:!0}function FSe(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf{constructor(e,n){this.shortDelay=e,this.longDelay=n,Lo(n>e,"Short delay should be less than long delay!"),this.isMobile=gI()||cz()}get(){return LSe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SI(t,e){Lo(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yz{static initialize(e,n,s){this.fetchImpl=e,n&&(this.headersImpl=n),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;mo("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;mo("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;mo("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BSe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const USe=new Mf(3e4,6e4);function gc(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function dl(t,e,n,s,i={}){return vz(t,i,async()=>{let r={},o={};s&&(e==="GET"?o=s:r={body:JSON.stringify(s)});const l=pu(Object.assign({key:t.config.apiKey},o)).slice(1),c=await t._getAdditionalHeaders();c["Content-Type"]="application/json",t.languageCode&&(c["X-Firebase-Locale"]=t.languageCode);const d=Object.assign({method:e,headers:c},r);return xxe()||(d.referrerPolicy="no-referrer"),yz.fetch()(xz(t,t.config.apiHost,n,l),d)})}async function vz(t,e,n){t._canInitEmulator=!1;const s=Object.assign(Object.assign({},BSe),e);try{const i=new zSe(t),r=await Promise.race([n(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw sm(t,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const l=r.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw sm(t,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw sm(t,"email-already-in-use",o);if(c==="USER_DISABLED")throw sm(t,"user-disabled",o);const u=s[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw vI(t,u,d);Ri(t,u)}}catch(i){if(i instanceof cl)throw i;Ri(t,"network-request-failed",{message:String(i)})}}async function CS(t,e,n,s,i={}){const r=await dl(t,e,n,s,i);return"mfaPendingCredential"in r&&Ri(t,"multi-factor-auth-required",{_serverResponse:r}),r}function xz(t,e,n,s){const i=`${e}${n}?${s}`;return t.config.emulator?SI(t.config,i):`${t.config.apiScheme}://${i}`}function $Se(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class zSe{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,s)=>{this.timer=setTimeout(()=>s(er(this.auth,"network-request-failed")),USe.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function sm(t,e,n){const s={appName:t.name};n.email&&(s.email=n.email),n.phoneNumber&&(s.phoneNumber=n.phoneNumber);const i=er(t,e,s);return i.customData._tokenResponse=n,i}function vR(t){return t!==void 0&&t.enterprise!==void 0}class WSe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return $Se(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function HSe(t,e){return dl(t,"GET","/v2/recaptchaConfig",gc(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GSe(t,e){return dl(t,"POST","/v1/accounts:delete",e)}async function Sz(t,e){return dl(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xh(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function VSe(t,e=!1){const n=is(t),s=await n.getIdToken(e),i=bI(s);Ie(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:i,token:s,authTime:Xh(Uw(i.auth_time)),issuedAtTime:Xh(Uw(i.iat)),expirationTime:Xh(Uw(i.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function Uw(t){return Number(t)*1e3}function bI(t){const[e,n,s]=t.split(".");if(e===void 0||n===void 0||s===void 0)return cy("JWT malformed, contained fewer than 3 sections"),null;try{const i=Nv(n);return i?JSON.parse(i):(cy("Failed to decode base64 JWT payload"),null)}catch(i){return cy("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function xR(t){const e=bI(t);return Ie(e,"internal-error"),Ie(typeof e.exp<"u","internal-error"),Ie(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fp(t,e,n=!1){if(n)return e;try{return await e}catch(s){throw s instanceof cl&&KSe(s)&&t.auth.currentUser===t&&await t.auth.signOut(),s}}function KSe({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YSe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var n;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const i=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FC{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Xh(this.lastLoginAt),this.creationTime=Xh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dv(t){var e;const n=t.auth,s=await t.getIdToken(),i=await Fp(t,Sz(n,{idToken:s}));Ie(i==null?void 0:i.users.length,n,"internal-error");const r=i.users[0];t._notifyReloadListener(r);const o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?bz(r.providerUserInfo):[],l=qSe(t.providerData,o),c=t.isAnonymous,d=!(t.email&&r.passwordHash)&&!(l!=null&&l.length),u=c?d:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:l,metadata:new FC(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(t,h)}async function XSe(t){const e=is(t);await Dv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function qSe(t,e){return[...t.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function bz(t){return t.map(e=>{var{providerId:n}=e,s=_f(e,["providerId"]);return{providerId:n,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ZSe(t,e){const n=await vz(t,{},async()=>{const s=pu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=t.config,o=xz(t,i,"/v1/token",`key=${r}`),l=await t._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",yz.fetch()(o,{method:"POST",headers:l,body:s})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function JSe(t,e){return dl(t,"POST","/v2/accounts:revokeToken",gc(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xd{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ie(e.idToken,"internal-error"),Ie(typeof e.idToken<"u","internal-error"),Ie(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):xR(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ie(e.length!==0,"internal-error");const n=xR(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ie(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:s,refreshToken:i,expiresIn:r}=await ZSe(e,n);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(e,n,s){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,n){const{refreshToken:s,accessToken:i,expirationTime:r}=n,o=new xd;return s&&(Ie(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(Ie(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),r&&(Ie(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new xd,this.toJSON())}_performRefresh(){return mo("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function na(t,e){Ie(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class yo{constructor(e){var{uid:n,auth:s,stsTokenManager:i}=e,r=_f(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new YSe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=s,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new FC(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const n=await Fp(this,this.stsTokenManager.getToken(this.auth,e));return Ie(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return VSe(this,e)}reload(){return XSe(this)}_assign(e){this!==e&&(Ie(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>Object.assign({},n)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new yo(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(e){Ie(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),n&&await Dv(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(kr(this.auth.app))return Promise.reject(La(this.auth));const e=await this.getIdToken();return await Fp(this,GSe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){var s,i,r,o,l,c,d,u;const h=(s=n.displayName)!==null&&s!==void 0?s:void 0,p=(i=n.email)!==null&&i!==void 0?i:void 0,f=(r=n.phoneNumber)!==null&&r!==void 0?r:void 0,g=(o=n.photoURL)!==null&&o!==void 0?o:void 0,y=(l=n.tenantId)!==null&&l!==void 0?l:void 0,x=(c=n._redirectEventId)!==null&&c!==void 0?c:void 0,m=(d=n.createdAt)!==null&&d!==void 0?d:void 0,v=(u=n.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:w,emailVerified:_,isAnonymous:C,providerData:I,stsTokenManager:T}=n;Ie(w&&T,e,"internal-error");const P=xd.fromJSON(this.name,T);Ie(typeof w=="string",e,"internal-error"),na(h,e.name),na(p,e.name),Ie(typeof _=="boolean",e,"internal-error"),Ie(typeof C=="boolean",e,"internal-error"),na(f,e.name),na(g,e.name),na(y,e.name),na(x,e.name),na(m,e.name),na(v,e.name);const k=new yo({uid:w,auth:e,email:p,emailVerified:_,displayName:h,isAnonymous:C,photoURL:g,phoneNumber:f,tenantId:y,stsTokenManager:P,createdAt:m,lastLoginAt:v});return I&&Array.isArray(I)&&(k.providerData=I.map(N=>Object.assign({},N))),x&&(k._redirectEventId=x),k}static async _fromIdTokenResponse(e,n,s=!1){const i=new xd;i.updateFromServerResponse(n);const r=new yo({uid:n.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await Dv(r),r}static async _fromGetAccountInfoResponse(e,n,s){const i=n.users[0];Ie(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?bz(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),l=new xd;l.updateFromIdToken(s);const c=new yo({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new FC(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SR=new Map;function vo(t){Lo(t instanceof Function,"Expected a class definition");let e=SR.get(t);return e?(Lo(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,SR.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wz{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}wz.type="NONE";const bR=wz;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dy(t,e,n){return`firebase:${t}:${e}:${n}`}class Sd{constructor(e,n,s){this.persistence=e,this.auth=n,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=dy(this.userKey,i.apiKey,r),this.fullPersistenceKey=dy("persistence",i.apiKey,r),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?yo._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,s="authUser"){if(!n.length)return new Sd(vo(bR),e,s);const i=(await Promise.all(n.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let r=i[0]||vo(bR);const o=dy(s,e.config.apiKey,e.name);let l=null;for(const d of n)try{const u=await d._get(o);if(u){const h=yo._fromJSON(e,u);d!==r&&(l=h),r=d;break}}catch{}const c=i.filter(d=>d._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new Sd(r,e,s):(r=c[0],l&&await r._set(o,l.toJSON()),await Promise.all(n.map(async d=>{if(d!==r)try{await d._remove(o)}catch{}})),new Sd(r,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wR(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Tz(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(_z(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Pz(e))return"Blackberry";if(kz(e))return"Webos";if(Cz(e))return"Safari";if((e.includes("chrome/")||Ez(e))&&!e.includes("edge/"))return"Chrome";if(Iz(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=t.match(n);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function _z(t=gs()){return/firefox\//i.test(t)}function Cz(t=gs()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Ez(t=gs()){return/crios\//i.test(t)}function Tz(t=gs()){return/iemobile/i.test(t)}function Iz(t=gs()){return/android/i.test(t)}function Pz(t=gs()){return/blackberry/i.test(t)}function kz(t=gs()){return/webos/i.test(t)}function wI(t=gs()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function QSe(t=gs()){var e;return wI(t)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function ebe(){return bxe()&&document.documentMode===10}function jz(t=gs()){return wI(t)||Iz(t)||kz(t)||Pz(t)||/windows phone/i.test(t)||Tz(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nz(t,e=[]){let n;switch(t){case"Browser":n=wR(gs());break;case"Worker":n=`${wR(gs())}-${t}`;break;default:n=t}const s=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${fu}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tbe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const s=r=>new Promise((o,l)=>{try{const c=e(r);o(c)}catch(c){l(c)}});s.onAbort=n,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const s of this.queue)await s(e),s.onAbort&&n.push(s.onAbort)}catch(s){n.reverse();for(const i of n)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nbe(t,e={}){return dl(t,"GET","/v2/passwordPolicy",gc(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sbe=6;class ibe{constructor(e){var n,s,i,r;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=o.minPasswordLength)!==null&&n!==void 0?n:sbe,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var n,s,i,r,o,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(n=c.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),c.isValid&&(c.isValid=(s=c.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(r=c.containsUppercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,n){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(n.meetsMinPasswordLength=e.length>=s),i&&(n.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(n,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,n,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rbe{constructor(e,n,s,i){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new _R(this),this.idTokenSubscription=new _R(this),this.beforeStateQueue=new tbe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=mz,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=vo(n)),this._initializationPromise=this.queue(async()=>{var s,i;if(!this._deleted&&(this.persistenceManager=await Sd.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Sz(this,{idToken:e}),s=await yo._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(s)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var n;if(kr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let i=s,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,l=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(i=c.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Ie(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Dv(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=FSe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(kr(this.app))return Promise.reject(La(this));const n=e?is(e):null;return n&&Ie(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ie(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return kr(this.app)?Promise.reject(La(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return kr(this.app)?Promise.reject(La(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(vo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await nbe(this),n=new ibe(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Rf("auth","Firebase",e())}onAuthStateChanged(e,n,s){return this.registerStateListener(this.authStateSubscription,e,n,s)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,s){return this.registerStateListener(this.idTokenSubscription,e,n,s)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(s.tenantId=this.tenantId),await JSe(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,n){const s=await this.getOrInitRedirectPersistenceManager(n);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&vo(e)||this._popupRedirectResolver;Ie(n,this,"argument-error"),this.redirectPersistenceManager=await Sd.create(this,[vo(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,s;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(n=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,s,i){if(this._deleted)return()=>{};const r=typeof n=="function"?n:n.next.bind(n);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ie(l,this,"internal-error"),l.then(()=>{o||r(this.currentUser)}),typeof n=="function"){const c=e.addObserver(n,s,i);return()=>{o=!0,c()}}else{const c=e.addObserver(n);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ie(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Nz(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(n["X-Firebase-Client"]=s);const i=await this._getAppCheckToken();return i&&(n["X-Firebase-AppCheck"]=i),n}async _getAppCheckToken(){var e;const n=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return n!=null&&n.error&&MSe(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function mc(t){return is(t)}class _R{constructor(e){this.auth=e,this.observer=null,this.addObserver=Nxe(n=>this.observer=n)}get next(){return Ie(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ES={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function obe(t){ES=t}function Az(t){return ES.loadJS(t)}function abe(){return ES.recaptchaEnterpriseScript}function lbe(){return ES.gapiScript}function cbe(t){return`__${t}${Math.floor(Math.random()*1e6)}`}const dbe="recaptcha-enterprise",ube="NO_RECAPTCHA";class hbe{constructor(e){this.type=dbe,this.auth=mc(e)}async verify(e="verify",n=!1){async function s(r){if(!n){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,l)=>{HSe(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new WSe(c);return r.tenantId==null?r._agentRecaptchaConfig=d:r._tenantRecaptchaConfigs[r.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function i(r,o,l){const c=window.grecaptcha;vR(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:e}).then(d=>{o(d)}).catch(()=>{o(ube)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((r,o)=>{s(this.auth).then(l=>{if(!n&&vR(window.grecaptcha))i(l,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=abe();c.length!==0&&(c+=l),Az(c).then(()=>{i(l,r,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function CR(t,e,n,s=!1){const i=new hbe(t);let r;try{r=await i.verify(n)}catch{r=await i.verify(n,!0)}const o=Object.assign({},e);return s?Object.assign(o,{captchaResp:r}):Object.assign(o,{captchaResponse:r}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function ER(t,e,n,s){var i;if(!((i=t._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await CR(t,e,n,n==="getOobCode");return s(t,r)}else return s(t,e).catch(async r=>{if(r.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await CR(t,e,n,n==="getOobCode");return s(t,o)}else return Promise.reject(r)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pbe(t,e){const n=yI(t,"auth");if(n.isInitialized()){const i=n.getImmediate(),r=n.getOptions();if(Rv(r,e??{}))return i;Ri(i,"already-initialized")}return n.initialize({options:e})}function fbe(t,e){const n=(e==null?void 0:e.persistence)||[],s=(Array.isArray(n)?n:[n]).map(vo);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function gbe(t,e,n){const s=mc(t);Ie(s._canInitEmulator,s,"emulator-config-failed"),Ie(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,r=Rz(e),{host:o,port:l}=mbe(e),c=l===null?"":`:${l}`;s.config.emulator={url:`${r}//${o}${c}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:o,port:l,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})}),ybe()}function Rz(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function mbe(t){const e=Rz(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const s=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:TR(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:TR(o)}}}function TR(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function ybe(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _I{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return mo("not implemented")}_getIdTokenResponse(e){return mo("not implemented")}_linkToIdToken(e,n){return mo("not implemented")}_getReauthenticationResolver(e){return mo("not implemented")}}async function vbe(t,e){return dl(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xbe(t,e){return CS(t,"POST","/v1/accounts:signInWithPassword",gc(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sbe(t,e){return CS(t,"POST","/v1/accounts:signInWithEmailLink",gc(t,e))}async function bbe(t,e){return CS(t,"POST","/v1/accounts:signInWithEmailLink",gc(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bp extends _I{constructor(e,n,s,i=null){super("password",s),this._email=e,this._password=n,this._tenantId=i}static _fromEmailAndPassword(e,n){return new Bp(e,n,"password")}static _fromEmailAndCode(e,n,s=null){return new Bp(e,n,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ER(e,n,"signInWithPassword",xbe);case"emailLink":return Sbe(e,{email:this._email,oobCode:this._password});default:Ri(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const s={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return ER(e,s,"signUpPassword",vbe);case"emailLink":return bbe(e,{idToken:n,email:this._email,oobCode:this._password});default:Ri(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bd(t,e){return CS(t,"POST","/v1/accounts:signInWithIdp",gc(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wbe="http://localhost";class sc extends _I{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new sc(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Ri("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i}=n,r=_f(n,["providerId","signInMethod"]);if(!s||!i)return null;const o=new sc(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return bd(e,n)}_linkToIdToken(e,n){const s=this.buildRequest();return s.idToken=n,bd(e,s)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,bd(e,n)}buildRequest(){const e={requestUri:wbe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=pu(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _be(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function Cbe(t){const e=kh(jh(t)).link,n=e?kh(jh(e)).deep_link_id:null,s=kh(jh(t)).deep_link_id;return(s?kh(jh(s)).link:null)||s||n||e||t}class CI{constructor(e){var n,s,i,r,o,l;const c=kh(jh(e)),d=(n=c.apiKey)!==null&&n!==void 0?n:null,u=(s=c.oobCode)!==null&&s!==void 0?s:null,h=_be((i=c.mode)!==null&&i!==void 0?i:null);Ie(d&&u&&h,"argument-error"),this.apiKey=d,this.operation=h,this.code=u,this.continueUrl=(r=c.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const n=Cbe(e);try{return new CI(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(){this.providerId=gu.PROVIDER_ID}static credential(e,n){return Bp._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const s=CI.parseLink(n);return Ie(s,"argument-error"),Bp._fromEmailAndCode(e,s.code,s.tenantId)}}gu.PROVIDER_ID="password";gu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";gu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EI{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of extends EI{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha extends Of{constructor(){super("facebook.com")}static credential(e){return sc._fromParams({providerId:ha.PROVIDER_ID,signInMethod:ha.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ha.credentialFromTaggedObject(e)}static credentialFromError(e){return ha.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ha.credential(e.oauthAccessToken)}catch{return null}}}ha.FACEBOOK_SIGN_IN_METHOD="facebook.com";ha.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lo extends Of{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return sc._fromParams({providerId:lo.PROVIDER_ID,signInMethod:lo.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return lo.credentialFromTaggedObject(e)}static credentialFromError(e){return lo.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:s}=e;if(!n&&!s)return null;try{return lo.credential(n,s)}catch{return null}}}lo.GOOGLE_SIGN_IN_METHOD="google.com";lo.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pa extends Of{constructor(){super("github.com")}static credential(e){return sc._fromParams({providerId:pa.PROVIDER_ID,signInMethod:pa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return pa.credentialFromTaggedObject(e)}static credentialFromError(e){return pa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return pa.credential(e.oauthAccessToken)}catch{return null}}}pa.GITHUB_SIGN_IN_METHOD="github.com";pa.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fa extends Of{constructor(){super("twitter.com")}static credential(e,n){return sc._fromParams({providerId:fa.PROVIDER_ID,signInMethod:fa.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return fa.credentialFromTaggedObject(e)}static credentialFromError(e){return fa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:s}=e;if(!n||!s)return null;try{return fa.credential(n,s)}catch{return null}}}fa.TWITTER_SIGN_IN_METHOD="twitter.com";fa.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hd{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,s,i=!1){const r=await yo._fromIdTokenResponse(e,s,i),o=IR(s);return new Hd({user:r,providerId:o,_tokenResponse:s,operationType:n})}static async _forOperation(e,n,s){await e._updateTokensIfNecessary(s,!0);const i=IR(s);return new Hd({user:e,providerId:i,_tokenResponse:s,operationType:n})}}function IR(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lv extends cl{constructor(e,n,s,i){var r;super(n.code,n.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,Lv.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:n.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,n,s,i){return new Lv(e,n,s,i)}}function Mz(t,e,n,s){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Lv._fromErrorAndOperation(t,r,e,s):r})}async function Ebe(t,e,n=!1){const s=await Fp(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Hd._forOperation(t,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tbe(t,e,n=!1){const{auth:s}=t;if(kr(s.app))return Promise.reject(La(s));const i="reauthenticate";try{const r=await Fp(t,Mz(s,i,e,t),n);Ie(r.idToken,s,"internal-error");const o=bI(r.idToken);Ie(o,s,"internal-error");const{sub:l}=o;return Ie(t.uid===l,s,"user-mismatch"),Hd._forOperation(t,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&Ri(s,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oz(t,e,n=!1){if(kr(t.app))return Promise.reject(La(t));const s="signIn",i=await Mz(t,s,e),r=await Hd._fromIdTokenResponse(t,s,i);return n||await t._updateCurrentUser(r.user),r}async function Ibe(t,e){return Oz(mc(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pbe(t){const e=mc(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function kbe(t,e,n){return kr(t.app)?Promise.reject(La(t)):Ibe(is(t),gu.credential(e,n)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&Pbe(t),s})}function jbe(t,e,n,s){return is(t).onIdTokenChanged(e,n,s)}function Nbe(t,e,n){return is(t).beforeAuthStateChanged(e,n)}function Abe(t,e,n,s){return is(t).onAuthStateChanged(e,n,s)}function Rbe(t){return is(t).signOut()}const Fv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dz{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Fv,"1"),this.storage.removeItem(Fv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mbe=1e3,Obe=10;class Lz extends Dz{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=jz(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const s=this.storage.getItem(n),i=this.localCache[n];s!==i&&e(n,i,s)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const s=e.key;n?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!n&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);ebe()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Obe):i()}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:s}),!0)})},Mbe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}Lz.type="LOCAL";const Dbe=Lz;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fz extends Dz{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}Fz.type="SESSION";const Bz=Fz;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lbe(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TS{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(i=>i.isListeningto(e));if(n)return n;const s=new TS(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:s,eventType:i,data:r}=n.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const l=Array.from(o).map(async d=>d(n.origin,r)),c=await Lbe(l);n.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:c})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}TS.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TI(t="",e=10){let n="";for(let s=0;s<e;s++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fbe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((l,c)=>{const d=TI("",20);i.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(h){const p=h;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),l(p.data.response);break;default:clearTimeout(u),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:n},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fr(){return window}function Bbe(t){Fr().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uz(){return typeof Fr().WorkerGlobalScope<"u"&&typeof Fr().importScripts=="function"}async function Ube(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function $be(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)===null||t===void 0?void 0:t.controller)||null}function zbe(){return Uz()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $z="firebaseLocalStorageDb",Wbe=1,Bv="firebaseLocalStorage",zz="fbase_key";class Df{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function IS(t,e){return t.transaction([Bv],e?"readwrite":"readonly").objectStore(Bv)}function Hbe(){const t=indexedDB.deleteDatabase($z);return new Df(t).toPromise()}function BC(){const t=indexedDB.open($z,Wbe);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const s=t.result;try{s.createObjectStore(Bv,{keyPath:zz})}catch(i){n(i)}}),t.addEventListener("success",async()=>{const s=t.result;s.objectStoreNames.contains(Bv)?e(s):(s.close(),await Hbe(),e(await BC()))})})}async function PR(t,e,n){const s=IS(t,!0).put({[zz]:e,value:n});return new Df(s).toPromise()}async function Gbe(t,e){const n=IS(t,!1).get(e),s=await new Df(n).toPromise();return s===void 0?null:s.value}function kR(t,e){const n=IS(t,!0).delete(e);return new Df(n).toPromise()}const Vbe=800,Kbe=3;class Wz{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await BC(),this.db)}async _withRetries(e){let n=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(n++>Kbe)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Uz()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=TS._getInstance(zbe()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var e,n;if(this.activeServiceWorker=await Ube(),!this.activeServiceWorker)return;this.sender=new Fbe(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((n=s[0])===null||n===void 0)&&n.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||$be()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await BC();return await PR(e,Fv,"1"),await kR(e,Fv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(s=>PR(s,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(s=>Gbe(s,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>kR(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=IS(i,!1).getAll();return new Df(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),n.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),n.push(i));return n}notifyListeners(e,n){this.localCache[e]=n;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Vbe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Wz.type="LOCAL";const Ybe=Wz;new Mf(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hz(t,e){return e?vo(e):(Ie(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class II extends _I{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return bd(e,this._buildIdpRequest())}_linkToIdToken(e,n){return bd(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return bd(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function Xbe(t){return Oz(t.auth,new II(t),t.bypassAuthState)}function qbe(t){const{auth:e,user:n}=t;return Ie(n,e,"internal-error"),Tbe(n,new II(t),t.bypassAuthState)}async function Zbe(t){const{auth:e,user:n}=t;return Ie(n,e,"internal-error"),Ebe(n,new II(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gz{constructor(e,n,s,i,r=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:s,postBody:i,tenantId:r,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:n,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Xbe;case"linkViaPopup":case"linkViaRedirect":return Zbe;case"reauthViaPopup":case"reauthViaRedirect":return qbe;default:Ri(this.auth,"internal-error")}}resolve(e){Lo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Lo(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jbe=new Mf(2e3,1e4);async function Qbe(t,e,n){if(kr(t.app))return Promise.reject(er(t,"operation-not-supported-in-this-environment"));const s=mc(t);OSe(t,e,EI);const i=Hz(s,n);return new Nl(s,"signInViaPopup",e,i).executeNotNull()}class Nl extends Gz{constructor(e,n,s,i,r){super(e,n,i,r),this.provider=s,this.authWindow=null,this.pollId=null,Nl.currentPopupAction&&Nl.currentPopupAction.cancel(),Nl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ie(e,this.auth,"internal-error"),e}async onExecution(){Lo(this.filter.length===1,"Popup operations only handle one event");const e=TI();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(er(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(er(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Nl.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,s;if(!((s=(n=this.authWindow)===null||n===void 0?void 0:n.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(er(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Jbe.get())};e()}}Nl.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ewe="pendingRedirect",uy=new Map;class twe extends Gz{constructor(e,n,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,s),this.eventId=null}async execute(){let e=uy.get(this.auth._key());if(!e){try{const s=await nwe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(n){e=()=>Promise.reject(n)}uy.set(this.auth._key(),e)}return this.bypassAuthState||uy.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nwe(t,e){const n=rwe(e),s=iwe(t);if(!await s._isAvailable())return!1;const i=await s._get(n)==="true";return await s._remove(n),i}function swe(t,e){uy.set(t._key(),e)}function iwe(t){return vo(t._redirectPersistence)}function rwe(t){return dy(ewe,t.config.apiKey,t.name)}async function owe(t,e,n=!1){if(kr(t.app))return Promise.reject(La(t));const s=mc(t),i=Hz(s,e),o=await new twe(s,i,n).execute();return o&&!n&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const awe=10*60*1e3;class lwe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(n=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!cwe(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var s;if(e.error&&!Vz(e)){const i=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";n.onError(er(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const s=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=awe&&this.cachedEventUids.clear(),this.cachedEventUids.has(jR(e))}saveEventToCache(e){this.cachedEventUids.add(jR(e)),this.lastProcessedEventTime=Date.now()}}function jR(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function Vz({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function cwe(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Vz(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dwe(t,e={}){return dl(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uwe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hwe=/^https?/;async function pwe(t){if(t.config.emulator)return;const{authorizedDomains:e}=await dwe(t);for(const n of e)try{if(fwe(n))return}catch{}Ri(t,"unauthorized-domain")}function fwe(t){const e=LC(),{protocol:n,hostname:s}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&s===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===s}if(!hwe.test(n))return!1;if(uwe.test(t))return s===t;const i=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gwe=new Mf(3e4,6e4);function NR(){const t=Fr().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function mwe(t){return new Promise((e,n)=>{var s,i,r;function o(){NR(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{NR(),n(er(t,"network-request-failed"))},timeout:gwe.get()})}if(!((i=(s=Fr().gapi)===null||s===void 0?void 0:s.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((r=Fr().gapi)===null||r===void 0)&&r.load)o();else{const l=cbe("iframefcb");return Fr()[l]=()=>{gapi.load?o():n(er(t,"network-request-failed"))},Az(`${lbe()}?onload=${l}`).catch(c=>n(c))}}).catch(e=>{throw hy=null,e})}let hy=null;function ywe(t){return hy=hy||mwe(t),hy}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vwe=new Mf(5e3,15e3),xwe="__/auth/iframe",Swe="emulator/auth/iframe",bwe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},wwe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function _we(t){const e=t.config;Ie(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?SI(e,Swe):`https://${t.config.authDomain}/${xwe}`,s={apiKey:e.apiKey,appName:t.name,v:fu},i=wwe.get(t.config.apiHost);i&&(s.eid=i);const r=t._getFrameworks();return r.length&&(s.fw=r.join(",")),`${n}?${pu(s).slice(1)}`}async function Cwe(t){const e=await ywe(t),n=Fr().gapi;return Ie(n,t,"internal-error"),e.open({where:document.body,url:_we(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:bwe,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=er(t,"network-request-failed"),l=Fr().setTimeout(()=>{r(o)},vwe.get());function c(){Fr().clearTimeout(l),i(s)}s.ping(c).then(c,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ewe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Twe=500,Iwe=600,Pwe="_blank",kwe="http://localhost";class AR{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function jwe(t,e,n,s=Twe,i=Iwe){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let l="";const c=Object.assign(Object.assign({},Ewe),{width:s.toString(),height:i.toString(),top:r,left:o}),d=gs().toLowerCase();n&&(l=Ez(d)?Pwe:n),_z(d)&&(e=e||kwe,c.scrollbars="yes");const u=Object.entries(c).reduce((p,[f,g])=>`${p}${f}=${g},`,"");if(QSe(d)&&l!=="_self")return Nwe(e||"",l),new AR(null);const h=window.open(e||"",l,u);Ie(h,t,"popup-blocked");try{h.focus()}catch{}return new AR(h)}function Nwe(t,e){const n=document.createElement("a");n.href=t,n.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Awe="__/auth/handler",Rwe="emulator/auth/handler",Mwe=encodeURIComponent("fac");async function RR(t,e,n,s,i,r){Ie(t.config.authDomain,t,"auth-domain-config-required"),Ie(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:s,v:fu,eventId:i};if(e instanceof EI){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",RC(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof Of){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await t._getAppCheckToken(),d=c?`#${Mwe}=${encodeURIComponent(c)}`:"";return`${Owe(t)}?${pu(l).slice(1)}${d}`}function Owe({config:t}){return t.emulator?SI(t,Rwe):`https://${t.authDomain}/${Awe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $w="webStorageSupport";class Dwe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Bz,this._completeRedirectFn=owe,this._overrideRedirectResult=swe}async _openPopup(e,n,s,i){var r;Lo((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=await RR(e,n,s,LC(),i);return jwe(e,o,TI())}async _openRedirect(e,n,s,i){await this._originValidation(e);const r=await RR(e,n,s,LC(),i);return Bbe(r),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:i,promise:r}=this.eventManagers[n];return i?Promise.resolve(i):(Lo(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(e);return this.eventManagers[n]={promise:s},s.catch(()=>{delete this.eventManagers[n]}),s}async initAndGetManager(e){const n=await Cwe(e),s=new lwe(e);return n.register("authEvent",i=>(Ie(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=n,s}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send($w,{type:$w},i=>{var r;const o=(r=i==null?void 0:i[0])===null||r===void 0?void 0:r[$w];o!==void 0&&n(!!o),Ri(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=pwe(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return jz()||Cz()||wI()}}const Lwe=Dwe;var MR="@firebase/auth",OR="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fwe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ie(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bwe(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Uwe(t){Wd(new nc("auth",(e,{options:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=s.options;Ie(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const c={apiKey:o,authDomain:l,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Nz(t)},d=new rbe(s,i,r,c);return fbe(d,n),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,s)=>{e.getProvider("auth-internal").initialize()})),Wd(new nc("auth-internal",e=>{const n=mc(e.getProvider("auth").getImmediate());return(s=>new Fwe(s))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Da(MR,OR,Bwe(t)),Da(MR,OR,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $we=5*60,zwe=lz("authIdTokenMaxAge")||$we;let DR=null;const Wwe=t=>async e=>{const n=e&&await e.getIdTokenResult(),s=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(s&&s>zwe)return;const i=n==null?void 0:n.token;DR!==i&&(DR=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Hwe(t=hz()){const e=yI(t,"auth");if(e.isInitialized())return e.getImmediate();const n=pbe(t,{popupRedirectResolver:Lwe,persistence:[Ybe,Dbe,Bz]}),s=lz("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=Wwe(r.toString());Nbe(n,o,()=>o(n.currentUser)),jbe(n,l=>o(l))}}const i=oz("auth");return i&&gbe(n,`http://${i}`),n}function Gwe(){var t,e;return(e=(t=document.getElementsByTagName("head"))===null||t===void 0?void 0:t[0])!==null&&e!==void 0?e:document}obe({loadJS(t){return new Promise((e,n)=>{const s=document.createElement("script");s.setAttribute("src",t),s.onload=e,s.onerror=i=>{const r=er("internal-error");r.customData=i,n(r)},s.type="text/javascript",s.charset="UTF-8",Gwe().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Uwe("Browser");var LR={};const FR="@firebase/database",BR="1.0.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kz="";function Vwe(t){Kz=t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kwe{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,n){n==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),tn(n))}get(e){const n=this.domStorage_.getItem(this.prefixedName_(e));return n==null?null:Dp(n)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ywe{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,n){n==null?delete this.cache_[e]:this.cache_[e]=n}get(e){return qr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yz=function(t){try{if(typeof window<"u"&&typeof window[t]<"u"){const e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Kwe(e)}}catch{}return new Ywe},Al=Yz("localStorage"),Xwe=Yz("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wd=new mI("@firebase/database"),qwe=function(){let t=1;return function(){return t++}}(),Xz=function(t){const e=Mxe(t),n=new jxe;n.update(e);const s=n.digest();return pI.encodeByteArray(s)},Lf=function(...t){let e="";for(let n=0;n<t.length;n++){const s=t[n];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=Lf.apply(null,s):typeof s=="object"?e+=tn(s):e+=s,e+=" "}return e};let qh=null,UR=!0;const Zwe=function(t,e){re(!0,"Can't turn on custom loggers persistently."),wd.logLevel=ot.VERBOSE,qh=wd.log.bind(wd)},In=function(...t){if(UR===!0&&(UR=!1,qh===null&&Xwe.get("logging_enabled")===!0&&Zwe()),qh){const e=Lf.apply(null,t);qh(e)}},Ff=function(t){return function(...e){In(t,...e)}},UC=function(...t){const e="FIREBASE INTERNAL ERROR: "+Lf(...t);wd.error(e)},Fo=function(...t){const e=`FIREBASE FATAL ERROR: ${Lf(...t)}`;throw wd.error(e),new Error(e)},ps=function(...t){const e="FIREBASE WARNING: "+Lf(...t);wd.warn(e)},Jwe=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ps("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},PI=function(t){return typeof t=="number"&&(t!==t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},Qwe=function(t){if(document.readyState==="complete")t();else{let e=!1;const n=function(){if(!document.body){setTimeout(n,Math.floor(10));return}e||(e=!0,t())};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&n()}),window.attachEvent("onload",n))}},Gd="[MIN_NAME]",ic="[MAX_NAME]",yc=function(t,e){if(t===e)return 0;if(t===Gd||e===ic)return-1;if(e===Gd||t===ic)return 1;{const n=$R(t),s=$R(e);return n!==null?s!==null?n-s===0?t.length-e.length:n-s:-1:s!==null?1:t<e?-1:1}},e0e=function(t,e){return t===e?0:t<e?-1:1},Zu=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+tn(e))},kI=function(t){if(typeof t!="object"||t===null)return tn(t);const e=[];for(const s in t)e.push(s);e.sort();let n="{";for(let s=0;s<e.length;s++)s!==0&&(n+=","),n+=tn(e[s]),n+=":",n+=kI(t[e[s]]);return n+="}",n},qz=function(t,e){const n=t.length;if(n<=e)return[t];const s=[];for(let i=0;i<n;i+=e)i+e>n?s.push(t.substring(i,n)):s.push(t.substring(i,i+e));return s};function Mn(t,e){for(const n in t)t.hasOwnProperty(n)&&e(n,t[n])}const Zz=function(t){re(!PI(t),"Invalid JSON number");const e=11,n=52,s=(1<<e-1)-1;let i,r,o,l,c;t===0?(r=0,o=0,i=1/t===-1/0?1:0):(i=t<0,t=Math.abs(t),t>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(t)/Math.LN2),s),r=l+s,o=Math.round(t*Math.pow(2,n-l)-Math.pow(2,n))):(r=0,o=Math.round(t/Math.pow(2,1-s-n))));const d=[];for(c=n;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(r%2?1:0),r=Math.floor(r/2);d.push(i?1:0),d.reverse();const u=d.join("");let h="";for(c=0;c<64;c+=8){let p=parseInt(u.substr(c,8),2).toString(16);p.length===1&&(p="0"+p),h=h+p}return h.toLowerCase()},t0e=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},n0e=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function s0e(t,e){let n="Unknown Error";t==="too_big"?n="The data requested exceeds the maximum size that can be accessed with a single request.":t==="permission_denied"?n="Client doesn't have permission to access the desired data.":t==="unavailable"&&(n="The service is unavailable");const s=new Error(t+" at "+e._path.toString()+": "+n);return s.code=t.toUpperCase(),s}const i0e=new RegExp("^-?(0*)\\d{1,10}$"),r0e=-2147483648,o0e=2147483647,$R=function(t){if(i0e.test(t)){const e=Number(t);if(e>=r0e&&e<=o0e)return e}return null},mu=function(t){try{t()}catch(e){setTimeout(()=>{const n=e.stack||"";throw ps("Exception was thrown by user callback.",n),e},Math.floor(0))}},a0e=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Zh=function(t,e){const n=setTimeout(t,e);return typeof n=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(n):typeof n=="object"&&n.unref&&n.unref(),n};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l0e{constructor(e,n){this.appName_=e,this.appCheckProvider=n,this.appCheck=n==null?void 0:n.getImmediate({optional:!0}),this.appCheck||n==null||n.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((n,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){var n;(n=this.appCheckProvider)===null||n===void 0||n.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){ps(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c0e{constructor(e,n,s){this.appName_=e,this.firebaseOptions_=n,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(n=>n&&n.code==="auth/token-not-initialized"?(In("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(n)):new Promise((n,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(n,s):n(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(n=>n.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(n=>n.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ps(e)}}class py{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}py.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jI="5",Jz="v",Qz="s",e6="r",t6="f",n6=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,s6="ls",i6="p",$C="ac",r6="websocket",o6="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a6{constructor(e,n,s,i,r=!1,o="",l=!1,c=!1){this.secure=n,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Al.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Al.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",n=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${n}`}}function d0e(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams}function l6(t,e,n){re(typeof e=="string","typeof type must == string"),re(typeof n=="object","typeof params must == object");let s;if(e===r6)s=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else if(e===o6)s=(t.secure?"https://":"http://")+t.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);d0e(t)&&(n.ns=t.namespace);const i=[];return Mn(n,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0e{constructor(){this.counters_={}}incrementCounter(e,n=1){qr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=n}get(){return uxe(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zw={},Ww={};function NI(t){const e=t.toString();return zw[e]||(zw[e]=new u0e),zw[e]}function h0e(t,e){const n=t.toString();return Ww[n]||(Ww[n]=e()),Ww[n]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p0e{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,n){this.closeAfterResponse=e,this.onClose=n,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,n){for(this.pendingResponses[e]=n;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&mu(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zR="start",f0e="close",g0e="pLPCommand",m0e="pRTLPCB",c6="id",d6="pw",u6="ser",y0e="cb",v0e="seg",x0e="ts",S0e="d",b0e="dframe",h6=1870,p6=30,w0e=h6-p6,_0e=25e3,C0e=3e4;class rd{constructor(e,n,s,i,r,o,l){this.connId=e,this.repoInfo=n,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ff(e),this.stats_=NI(n),this.urlFn=c=>(this.appCheckToken&&(c[$C]=this.appCheckToken),l6(n,o6,c))}open(e,n){this.curSegmentNum=0,this.onDisconnect_=n,this.myPacketOrderer=new p0e(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(C0e)),Qwe(()=>{if(this.isClosed_)return;this.scriptTagHolder=new AI((...r)=>{const[o,l,c,d,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===zR)this.id=l,this.password=c;else if(o===f0e)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const s={};s[zR]="t",s[u6]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[y0e]=this.scriptTagHolder.uniqueCallbackIdentifier),s[Jz]=jI,this.transportSessionId&&(s[Qz]=this.transportSessionId),this.lastSessionId&&(s[s6]=this.lastSessionId),this.applicationId&&(s[i6]=this.applicationId),this.appCheckToken&&(s[$C]=this.appCheckToken),typeof location<"u"&&location.hostname&&n6.test(location.hostname)&&(s[e6]=t6);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){rd.forceAllow_=!0}static forceDisallow(){rd.forceDisallow_=!0}static isAvailable(){return rd.forceAllow_?!0:!rd.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!t0e()&&!n0e()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const n=tn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=iz(n),i=qz(s,w0e);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,n){this.myDisconnFrame=document.createElement("iframe");const s={};s[b0e]="t",s[c6]=e,s[d6]=n,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const n=tn(e).length;this.bytesReceived+=n,this.stats_.incrementCounter("bytes_received",n)}}class AI{constructor(e,n,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=qwe(),window[g0e+this.uniqueCallbackIdentifier]=e,window[m0e+this.uniqueCallbackIdentifier]=n,this.myIFrame=AI.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){In("frame writing exception"),l.stack&&In(l.stack),In(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||In("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,n){for(this.myID=e,this.myPW=n,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[c6]=this.myID,e[d6]=this.myPW,e[u6]=this.currentSerial;let n=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+p6+s.length<=h6;){const o=this.pendingSegs.shift();s=s+"&"+v0e+i+"="+o.seg+"&"+x0e+i+"="+o.ts+"&"+S0e+i+"="+o.d,i++}return n=n+s,this.addLongPollTag_(n,this.currentSerial),!0}else return!1}enqueueSegment(e,n,s){this.pendingSegs.push({seg:e,ts:n,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,n){this.outstandingRequests.add(n);const s=()=>{this.outstandingRequests.delete(n),this.newRequest_()},i=setTimeout(s,Math.floor(_0e)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,n){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),n())},s.onerror=()=>{In("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E0e=16384,T0e=45e3;let Uv=null;typeof MozWebSocket<"u"?Uv=MozWebSocket:typeof WebSocket<"u"&&(Uv=WebSocket);class Ki{constructor(e,n,s,i,r,o,l){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ff(this.connId),this.stats_=NI(n),this.connURL=Ki.connectionURL_(n,o,l,i,s),this.nodeAdmin=n.nodeAdmin}static connectionURL_(e,n,s,i,r){const o={};return o[Jz]=jI,typeof location<"u"&&location.hostname&&n6.test(location.hostname)&&(o[e6]=t6),n&&(o[Qz]=n),s&&(o[s6]=s),i&&(o[$C]=i),r&&(o[i6]=r),l6(e,r6,o)}open(e,n){this.onDisconnect=n,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Al.set("previous_websocket_failure",!0);try{let s;wxe(),this.mySock=new Uv(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Ki.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const n=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(n);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&Uv!==null&&!Ki.forceDisallow_}static previouslyFailed(){return Al.isInMemoryStorage||Al.get("previous_websocket_failure")===!0}markConnectionHealthy(){Al.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const n=this.frames.join("");this.frames=null;const s=Dp(n);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(re(this.frames===null,"We already have a frame buffer"),e.length<=6){const n=Number(e);if(!isNaN(n))return this.handleNewFrameCount_(n),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const n=e.data;if(this.bytesReceived+=n.length,this.stats_.incrementCounter("bytes_received",n.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(n);else{const s=this.extractFrameCount_(n);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const n=tn(e);this.bytesSent+=n.length,this.stats_.incrementCounter("bytes_sent",n.length);const s=qz(n,E0e);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(T0e))}sendString_(e){try{this.mySock.send(e)}catch(n){this.log_("Exception thrown from WebSocket.send():",n.message||n.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ki.responsesRequiredToBeHealthy=2;Ki.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Up{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[rd,Ki]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const n=Ki&&Ki.isAvailable();let s=n&&!Ki.previouslyFailed();if(e.webSocketOnly&&(n||ps("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Ki];else{const i=this.transports_=[];for(const r of Up.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);Up.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Up.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I0e=6e4,P0e=5e3,k0e=10*1024,j0e=100*1024,Hw="t",WR="d",N0e="s",HR="r",A0e="e",GR="o",VR="a",KR="n",YR="p",R0e="h";class M0e{constructor(e,n,s,i,r,o,l,c,d,u){this.id=e,this.repoInfo_=n,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ff("c:"+this.id+":"),this.transportManager_=new Up(n),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(n,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Zh(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>j0e?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>k0e?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return n=>{e===this.conn_?this.onConnectionLost_(n):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return n=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(n):e===this.secondaryConn_?this.onSecondaryMessageReceived_(n):this.log_("message on old connection"))}}sendRequest(e){const n={t:"d",d:e};this.sendData_(n)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Hw in e){const n=e[Hw];n===VR?this.upgradeIfSecondaryHealthy_():n===HR?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):n===GR&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const n=Zu("t",e),s=Zu("d",e);if(n==="c")this.onSecondaryControl_(s);else if(n==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+n)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:YR,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:VR,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:KR,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const n=Zu("t",e),s=Zu("d",e);n==="c"?this.onControl_(s):n==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const n=Zu(Hw,e);if(WR in e){const s=e[WR];if(n===R0e){const i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(n===KR){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else n===N0e?this.onConnectionShutdown_(s):n===HR?this.onReset_(s):n===A0e?UC("Server Error: "+s):n===GR?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):UC("Unknown control packet command: "+n)}}onHandshake_(e){const n=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,n),jI!==s&&ps("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const n=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,s),Zh(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(I0e))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,n){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(n,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Zh(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(P0e))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:YR,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Al.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f6{put(e,n,s,i){}merge(e,n,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,n,s){}onDisconnectMerge(e,n,s){}onDisconnectCancel(e,n){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g6{constructor(e){this.allowedEvents_=e,this.listeners_={},re(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...n){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,n)}}on(e,n,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:n,context:s});const i=this.getInitialEvent(e);i&&n.apply(s,i)}off(e,n,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===n&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){re(this.allowedEvents_.find(n=>n===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v extends g6{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!gI()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new $v}getInitialEvent(e){return re(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XR=32,qR=768;class ct{constructor(e,n){if(n===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=n}toString(){let e="";for(let n=this.pieceNum_;n<this.pieces_.length;n++)this.pieces_[n]!==""&&(e+="/"+this.pieces_[n]);return e||"/"}}function Je(){return new ct("")}function Le(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function Ka(t){return t.pieces_.length-t.pieceNum_}function gt(t){let e=t.pieceNum_;return e<t.pieces_.length&&e++,new ct(t.pieces_,e)}function RI(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function O0e(t){let e="";for(let n=t.pieceNum_;n<t.pieces_.length;n++)t.pieces_[n]!==""&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}function $p(t,e=0){return t.pieces_.slice(t.pieceNum_+e)}function m6(t){if(t.pieceNum_>=t.pieces_.length)return null;const e=[];for(let n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new ct(e,0)}function zt(t,e){const n=[];for(let s=t.pieceNum_;s<t.pieces_.length;s++)n.push(t.pieces_[s]);if(e instanceof ct)for(let s=e.pieceNum_;s<e.pieces_.length;s++)n.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&n.push(s[i])}return new ct(n,0)}function We(t){return t.pieceNum_>=t.pieces_.length}function us(t,e){const n=Le(t),s=Le(e);if(n===null)return e;if(n===s)return us(gt(t),gt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function D0e(t,e){const n=$p(t,0),s=$p(e,0);for(let i=0;i<n.length&&i<s.length;i++){const r=yc(n[i],s[i]);if(r!==0)return r}return n.length===s.length?0:n.length<s.length?-1:1}function MI(t,e){if(Ka(t)!==Ka(e))return!1;for(let n=t.pieceNum_,s=e.pieceNum_;n<=t.pieces_.length;n++,s++)if(t.pieces_[n]!==e.pieces_[s])return!1;return!0}function Ii(t,e){let n=t.pieceNum_,s=e.pieceNum_;if(Ka(t)>Ka(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[s])return!1;++n,++s}return!0}class L0e{constructor(e,n){this.errorPrefix_=n,this.parts_=$p(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=_S(this.parts_[s]);y6(this)}}function F0e(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=_S(e),y6(t)}function B0e(t){const e=t.parts_.pop();t.byteLength_-=_S(e),t.parts_.length>0&&(t.byteLength_-=1)}function y6(t){if(t.byteLength_>qR)throw new Error(t.errorPrefix_+"has a key path longer than "+qR+" bytes ("+t.byteLength_+").");if(t.parts_.length>XR)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+XR+") or object contains a cycle "+Cl(t))}function Cl(t){return t.parts_.length===0?"":"in property '"+t.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OI extends g6{constructor(){super(["visible"]);let e,n;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(n="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(n="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(n="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(n="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,n&&document.addEventListener(n,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new OI}getInitialEvent(e){return re(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ju=1e3,U0e=60*5*1e3,ZR=30*1e3,$0e=1.3,z0e=3e4,W0e="server_kill",JR=3;class Eo extends f6{constructor(e,n,s,i,r,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=n,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=Eo.nextPersistentConnectionId_++,this.log_=Ff("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Ju,this.maxReconnectDelay_=U0e,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");OI.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&$v.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,s){const i=++this.requestNumber_,r={r:i,a:e,b:n};this.log_(tn(r)),re(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const n=new Af,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?n.resolve(l):n.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),n.promise}listen(e,n,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),re(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),re(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const l={onComplete:i,hashFn:n,query:e,tag:s};this.listens.get(o).set(r,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const n=this.outstandingGets_[e];this.sendRequest("g",n.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),n.onComplete&&n.onComplete(s)})}sendListen_(e){const n=e.query,s=n._path.toString(),i=n._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=n._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,l=>{const c=l.d,d=l.s;Eo.warnOnListenWarnings_(c,n),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,n){if(e&&typeof e=="object"&&qr(e,"w")){const s=zd(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+n._queryParams.getIndex().toString()+'"',r=n._path.toString();ps(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||kxe(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=ZR)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,n=Pxe(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(n,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const n=e.s,s=e.d||"error";n==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(n,s)})}unlisten(e,n){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),re(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,n)}sendUnlisten_(e,n,s,i){this.log_("Unlisten on "+e+" for "+n);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:n,onComplete:s})}onDisconnectMerge(e,n,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,n,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:n,onComplete:s})}onDisconnectCancel(e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:n})}sendOnDisconnect_(e,n,s,i){const r={p:n,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,n,s,i){this.putInternal("p",e,n,s,i)}merge(e,n,s,i){this.putInternal("m",e,n,s,i)}putInternal(e,n,s,i,r){this.initConnection_();const o={p:n,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+n)}sendPut_(e){const n=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,s,r=>{this.log_(n+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+tn(e));const n=e.r,s=this.requestCBHash_[n];s&&(delete this.requestCBHash_[n],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,n){this.log_("handleServerMessage",e,n),e==="d"?this.onDataUpdate_(n.p,n.d,!1,n.t):e==="m"?this.onDataUpdate_(n.p,n.d,!0,n.t):e==="c"?this.onListenRevoked_(n.p,n.q):e==="ac"?this.onAuthRevoked_(n.s,n.d):e==="apc"?this.onAppCheckRevoked_(n.s,n.d):e==="sd"?this.onSecurityDebugPacket_(n):UC("Unrecognized action received from server: "+tn(e)+`
Are you using the latest client?`)}onReady_(e,n){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=n,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){re(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ju,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Ju,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>z0e&&(this.reconnectDelay_=Ju),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let n=Math.max(0,this.reconnectDelay_-e);n=Math.random()*n,this.log_("Trying to reconnect in "+n+"ms"),this.scheduleConnect_(n),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*$0e)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Eo.nextConnectionId_++,r=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,s())},d=function(h){re(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,p]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?In("getToken() completed but was canceled"):(In("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=p&&p.token,l=new M0e(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,s,f=>{ps(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(W0e)},r))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&ps(h),c())}}}interrupt(e){In("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){In("Resuming connection for reason: "+e),delete this.interruptReasons_[e],RC(this.interruptReasons_)&&(this.reconnectDelay_=Ju,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const n=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:n})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const n=this.outstandingPuts_[e];n&&"h"in n.request&&n.queued&&(n.onComplete&&n.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,n){let s;n?s=n.map(r=>kI(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,n){const s=new ct(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(n),r.delete(n),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,n){In("Auth token revoked: "+e+"/"+n),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=JR&&(this.reconnectDelay_=ZR,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,n){In("App check token revoked: "+e+"/"+n),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=JR&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const n of e.values())this.sendListen_(n);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let n="js";e["sdk."+n+"."+Kz.replace(/\./g,"-")]=1,gI()?e["framework.cordova"]=1:cz()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=$v.getInstance().currentlyOnline();return RC(this.interruptReasons_)&&e}}Eo.nextPersistentConnectionId_=0;Eo.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fe{constructor(e,n){this.name=e,this.node=n}static Wrap(e,n){return new Fe(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PS{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,n){const s=new Fe(Gd,e),i=new Fe(Gd,n);return this.compare(s,i)!==0}minPost(){return Fe.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let im;class v6 extends PS{static get __EMPTY_NODE(){return im}static set __EMPTY_NODE(e){im=e}compare(e,n){return yc(e.name,n.name)}isDefinedOn(e){throw hu("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,n){return!1}minPost(){return Fe.MIN}maxPost(){return new Fe(ic,im)}makePost(e,n){return re(typeof e=="string","KeyIndex indexValue must always be a string."),new Fe(e,im)}toString(){return".key"}}const _d=new v6;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rm{constructor(e,n,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=n?s(e.key,n):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),n;if(this.resultGenerator_?n=this.resultGenerator_(e.key,e.value):n={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return n}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class cn{constructor(e,n,s,i,r){this.key=e,this.value=n,this.color=s??cn.RED,this.left=i??Ls.EMPTY_NODE,this.right=r??Ls.EMPTY_NODE}copy(e,n,s,i,r){return new cn(e??this.key,n??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,n,s),null):r===0?i=i.copy(null,n,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,n,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ls.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,n){let s,i;if(s=this,n(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),n(e,s.key)===0){if(s.right.isEmpty())return Ls.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,cn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,cn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}cn.RED=!0;cn.BLACK=!1;class H0e{copy(e,n,s,i,r){return this}insert(e,n,s){return new cn(e,n,null)}remove(e,n){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Ls{constructor(e,n=Ls.EMPTY_NODE){this.comparator_=e,this.root_=n}insert(e,n){return new Ls(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,cn.BLACK,null,null))}remove(e){return new Ls(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,cn.BLACK,null,null))}get(e){let n,s=this.root_;for(;!s.isEmpty();){if(n=this.comparator_(e,s.key),n===0)return s.value;n<0?s=s.left:n>0&&(s=s.right)}return null}getPredecessorKey(e){let n,s=this.root_,i=null;for(;!s.isEmpty();)if(n=this.comparator_(e,s.key),n===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else n<0?s=s.left:n>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new rm(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,n){return new rm(this.root_,e,this.comparator_,!1,n)}getReverseIteratorFrom(e,n){return new rm(this.root_,e,this.comparator_,!0,n)}getReverseIterator(e){return new rm(this.root_,null,this.comparator_,!0,e)}}Ls.EMPTY_NODE=new H0e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G0e(t,e){return yc(t.name,e.name)}function DI(t,e){return yc(t,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zC;function V0e(t){zC=t}const x6=function(t){return typeof t=="number"?"number:"+Zz(t):"string:"+t},S6=function(t){if(t.isLeafNode()){const e=t.val();re(typeof e=="string"||typeof e=="number"||typeof e=="object"&&qr(e,".sv"),"Priority must be a string or number.")}else re(t===zC||t.isEmpty(),"priority of unexpected type.");re(t===zC||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let QR;class an{constructor(e,n=an.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,re(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),S6(this.priorityNode_)}static set __childrenNodeConstructor(e){QR=e}static get __childrenNodeConstructor(){return QR}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new an(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:an.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return We(e)?this:Le(e)===".priority"?this.priorityNode_:an.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,n){return null}updateImmediateChild(e,n){return e===".priority"?this.updatePriority(n):n.isEmpty()&&e!==".priority"?this:an.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)}updateChild(e,n){const s=Le(e);return s===null?n:n.isEmpty()&&s!==".priority"?this:(re(s!==".priority"||Ka(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,an.__childrenNodeConstructor.EMPTY_NODE.updateChild(gt(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,n){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+x6(this.priorityNode_.val())+":");const n=typeof this.value_;e+=n+":",n==="number"?e+=Zz(this.value_):e+=this.value_,this.lazyHash_=Xz(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===an.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof an.__childrenNodeConstructor?-1:(re(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,s=typeof this.value_,i=an.VALUE_TYPE_ORDER.indexOf(n),r=an.VALUE_TYPE_ORDER.indexOf(s);return re(i>=0,"Unknown leaf type: "+n),re(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const n=e;return this.value_===n.value_&&this.priorityNode_.equals(n.priorityNode_)}else return!1}}an.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let b6,w6;function K0e(t){b6=t}function Y0e(t){w6=t}class X0e extends PS{compare(e,n){const s=e.node.getPriority(),i=n.node.getPriority(),r=s.compareTo(i);return r===0?yc(e.name,n.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,n){return!e.getPriority().equals(n.getPriority())}minPost(){return Fe.MIN}maxPost(){return new Fe(ic,new an("[PRIORITY-POST]",w6))}makePost(e,n){const s=b6(e);return new Fe(n,new an("[PRIORITY-POST]",s))}toString(){return".priority"}}const Wt=new X0e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q0e=Math.log(2);class Z0e{constructor(e){const n=r=>parseInt(Math.log(r)/q0e,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=n(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const zv=function(t,e,n,s){t.sort(e);const i=function(c,d){const u=d-c;let h,p;if(u===0)return null;if(u===1)return h=t[c],p=n?n(h):h,new cn(p,h.node,cn.BLACK,null,null);{const f=parseInt(u/2,10)+c,g=i(c,f),y=i(f+1,d);return h=t[f],p=n?n(h):h,new cn(p,h.node,cn.BLACK,g,y)}},r=function(c){let d=null,u=null,h=t.length;const p=function(g,y){const x=h-g,m=h;h-=g;const v=i(x+1,m),w=t[x],_=n?n(w):w;f(new cn(_,w.node,y,null,v))},f=function(g){d?(d.left=g,d=g):(u=g,d=g)};for(let g=0;g<c.count;++g){const y=c.nextBitIsOne(),x=Math.pow(2,c.count-(g+1));y?p(x,cn.BLACK):(p(x,cn.BLACK),p(x,cn.RED))}return u},o=new Z0e(t.length),l=r(o);return new Ls(s||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gw;const Nc={};class xo{constructor(e,n){this.indexes_=e,this.indexSet_=n}static get Default(){return re(Nc&&Wt,"ChildrenNode.ts has not been loaded"),Gw=Gw||new xo({".priority":Nc},{".priority":Wt}),Gw}get(e){const n=zd(this.indexes_,e);if(!n)throw new Error("No index defined for "+e);return n instanceof Ls?n:null}hasIndex(e){return qr(this.indexSet_,e.toString())}addIndex(e,n){re(e!==_d,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=n.getIterator(Fe.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let l;i?l=zv(s,e.getCompare()):l=Nc;const c=e.toString(),d=Object.assign({},this.indexSet_);d[c]=e;const u=Object.assign({},this.indexes_);return u[c]=l,new xo(u,d)}addToIndexes(e,n){const s=Av(this.indexes_,(i,r)=>{const o=zd(this.indexSet_,r);if(re(o,"Missing index implementation for "+r),i===Nc)if(o.isDefinedOn(e.node)){const l=[],c=n.getIterator(Fe.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),zv(l,o.getCompare())}else return Nc;else{const l=n.get(e.name);let c=i;return l&&(c=c.remove(new Fe(e.name,l))),c.insert(e,e.node)}});return new xo(s,this.indexSet_)}removeFromIndexes(e,n){const s=Av(this.indexes_,i=>{if(i===Nc)return i;{const r=n.get(e.name);return r?i.remove(new Fe(e.name,r)):i}});return new xo(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qu;class Te{constructor(e,n,s){this.children_=e,this.priorityNode_=n,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&S6(this.priorityNode_),this.children_.isEmpty()&&re(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Qu||(Qu=new Te(new Ls(DI),null,xo.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Qu}updatePriority(e){return this.children_.isEmpty()?this:new Te(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const n=this.children_.get(e);return n===null?Qu:n}}getChild(e){const n=Le(e);return n===null?this:this.getImmediateChild(n).getChild(gt(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,n){if(re(n,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(n);{const s=new Fe(e,n);let i,r;n.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,n),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?Qu:this.priorityNode_;return new Te(i,o,r)}}updateChild(e,n){const s=Le(e);if(s===null)return n;{re(Le(e)!==".priority"||Ka(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(gt(e),n);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const n={};let s=0,i=0,r=!0;if(this.forEachChild(Wt,(o,l)=>{n[o]=l.val(e),s++,r&&Te.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const l in n)o[l]=n[l];return o}else return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+x6(this.getPriority().val())+":"),this.forEachChild(Wt,(n,s)=>{const i=s.hash();i!==""&&(e+=":"+n+":"+i)}),this.lazyHash_=e===""?"":Xz(e)}return this.lazyHash_}getPredecessorChildName(e,n,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new Fe(e,n));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const n=this.getFirstChildName(e);return n?new Fe(n,this.children_.get(n)):null}getLastChildName(e){const n=this.resolveIndex_(e);if(n){const s=n.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const n=this.getLastChildName(e);return n?new Fe(n,this.children_.get(n)):null}forEachChild(e,n){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>n(i.name,i.node)):this.children_.inorderTraversal(n)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Fe.Wrap);let r=i.peek();for(;r!=null&&n.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,n){const s=this.resolveIndex_(n);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Fe.Wrap);let r=i.peek();for(;r!=null&&n.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Bf?-1:0}withIndex(e){if(e===_d||this.indexMap_.hasIndex(e))return this;{const n=this.indexMap_.addIndex(e,this.children_);return new Te(this.children_,this.priorityNode_,n)}}isIndexed(e){return e===_d||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const n=e;if(this.getPriority().equals(n.getPriority()))if(this.children_.count()===n.children_.count()){const s=this.getIterator(Wt),i=n.getIterator(Wt);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===_d?null:this.indexMap_.get(e.toString())}}Te.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class J0e extends Te{constructor(){super(new Ls(DI),Te.EMPTY_NODE,xo.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Te.EMPTY_NODE}isEmpty(){return!1}}const Bf=new J0e;Object.defineProperties(Fe,{MIN:{value:new Fe(Gd,Te.EMPTY_NODE)},MAX:{value:new Fe(ic,Bf)}});v6.__EMPTY_NODE=Te.EMPTY_NODE;an.__childrenNodeConstructor=Te;V0e(Bf);Y0e(Bf);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q0e=!0;function en(t,e=null){if(t===null)return Te.EMPTY_NODE;if(typeof t=="object"&&".priority"in t&&(e=t[".priority"]),re(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof t=="object"&&".value"in t&&t[".value"]!==null&&(t=t[".value"]),typeof t!="object"||".sv"in t){const n=t;return new an(n,en(e))}if(!(t instanceof Array)&&Q0e){const n=[];let s=!1;if(Mn(t,(o,l)=>{if(o.substring(0,1)!=="."){const c=en(l);c.isEmpty()||(s=s||!c.getPriority().isEmpty(),n.push(new Fe(o,c)))}}),n.length===0)return Te.EMPTY_NODE;const r=zv(n,G0e,o=>o.name,DI);if(s){const o=zv(n,Wt.getCompare());return new Te(r,en(e),new xo({".priority":o},{".priority":Wt}))}else return new Te(r,en(e),xo.Default)}else{let n=Te.EMPTY_NODE;return Mn(t,(s,i)=>{if(qr(t,s)&&s.substring(0,1)!=="."){const r=en(i);(r.isLeafNode()||!r.isEmpty())&&(n=n.updateImmediateChild(s,r))}}),n.updatePriority(en(e))}}K0e(en);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e_e extends PS{constructor(e){super(),this.indexPath_=e,re(!We(e)&&Le(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,n){const s=this.extractChild(e.node),i=this.extractChild(n.node),r=s.compareTo(i);return r===0?yc(e.name,n.name):r}makePost(e,n){const s=en(e),i=Te.EMPTY_NODE.updateChild(this.indexPath_,s);return new Fe(n,i)}maxPost(){const e=Te.EMPTY_NODE.updateChild(this.indexPath_,Bf);return new Fe(ic,e)}toString(){return $p(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t_e extends PS{compare(e,n){const s=e.node.compareTo(n.node);return s===0?yc(e.name,n.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,n){return!e.equals(n)}minPost(){return Fe.MIN}maxPost(){return Fe.MAX}makePost(e,n){const s=en(e);return new Fe(n,s)}toString(){return".value"}}const n_e=new t_e;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _6(t){return{type:"value",snapshotNode:t}}function Vd(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function zp(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function Wp(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}function s_e(t,e){return{type:"child_moved",snapshotNode:e,childName:t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LI{constructor(e){this.index_=e}updateChild(e,n,s,i,r,o){re(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(n);return l.getChild(i).equals(s.getChild(i))&&l.isEmpty()===s.isEmpty()||(o!=null&&(s.isEmpty()?e.hasChild(n)?o.trackChildChange(zp(n,l)):re(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?o.trackChildChange(Vd(n,s)):o.trackChildChange(Wp(n,s,l))),e.isLeafNode()&&s.isEmpty())?e:e.updateImmediateChild(n,s).withIndex(this.index_)}updateFullNode(e,n,s){return s!=null&&(e.isLeafNode()||e.forEachChild(Wt,(i,r)=>{n.hasChild(i)||s.trackChildChange(zp(i,r))}),n.isLeafNode()||n.forEachChild(Wt,(i,r)=>{if(e.hasChild(i)){const o=e.getImmediateChild(i);o.equals(r)||s.trackChildChange(Wp(i,r,o))}else s.trackChildChange(Vd(i,r))})),n.withIndex(this.index_)}updatePriority(e,n){return e.isEmpty()?Te.EMPTY_NODE:e.updatePriority(n)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hp{constructor(e){this.indexedFilter_=new LI(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Hp.getStartPost_(e),this.endPost_=Hp.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const n=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,s=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return n&&s}updateChild(e,n,s,i,r,o){return this.matches(new Fe(n,s))||(s=Te.EMPTY_NODE),this.indexedFilter_.updateChild(e,n,s,i,r,o)}updateFullNode(e,n,s){n.isLeafNode()&&(n=Te.EMPTY_NODE);let i=n.withIndex(this.index_);i=i.updatePriority(Te.EMPTY_NODE);const r=this;return n.forEachChild(Wt,(o,l)=>{r.matches(new Fe(o,l))||(i=i.updateImmediateChild(o,Te.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const n=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),n)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const n=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),n)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i_e{constructor(e){this.withinDirectionalStart=n=>this.reverse_?this.withinEndPost(n):this.withinStartPost(n),this.withinDirectionalEnd=n=>this.reverse_?this.withinStartPost(n):this.withinEndPost(n),this.withinStartPost=n=>{const s=this.index_.compare(this.rangedFilter_.getStartPost(),n);return this.startIsInclusive_?s<=0:s<0},this.withinEndPost=n=>{const s=this.index_.compare(n,this.rangedFilter_.getEndPost());return this.endIsInclusive_?s<=0:s<0},this.rangedFilter_=new Hp(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,n,s,i,r,o){return this.rangedFilter_.matches(new Fe(n,s))||(s=Te.EMPTY_NODE),e.getImmediateChild(n).equals(s)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,n,s,i,r,o):this.fullLimitUpdateChild_(e,n,s,r,o)}updateFullNode(e,n,s){let i;if(n.isLeafNode()||n.isEmpty())i=Te.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<n.numChildren()&&n.isIndexed(this.index_)){i=Te.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=n.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=n.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const l=r.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))i=i.updateImmediateChild(l.name,l.node),o++;else break;else continue}}else{i=n.withIndex(this.index_),i=i.updatePriority(Te.EMPTY_NODE);let r;this.reverse_?r=i.getReverseIterator(this.index_):r=i.getIterator(this.index_);let o=0;for(;r.hasNext();){const l=r.getNext();o<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?o++:i=i.updateImmediateChild(l.name,Te.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,s)}updatePriority(e,n){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,s,i,r){let o;if(this.reverse_){const h=this.index_.getCompare();o=(p,f)=>h(f,p)}else o=this.index_.getCompare();const l=e;re(l.numChildren()===this.limit_,"");const c=new Fe(n,s),d=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(l.hasChild(n)){const h=l.getImmediateChild(n);let p=i.getChildAfterChild(this.index_,d,this.reverse_);for(;p!=null&&(p.name===n||l.hasChild(p.name));)p=i.getChildAfterChild(this.index_,p,this.reverse_);const f=p==null?1:o(p,c);if(u&&!s.isEmpty()&&f>=0)return r!=null&&r.trackChildChange(Wp(n,s,h)),l.updateImmediateChild(n,s);{r!=null&&r.trackChildChange(zp(n,h));const y=l.updateImmediateChild(n,Te.EMPTY_NODE);return p!=null&&this.rangedFilter_.matches(p)?(r!=null&&r.trackChildChange(Vd(p.name,p.node)),y.updateImmediateChild(p.name,p.node)):y}}else return s.isEmpty()?e:u&&o(d,c)>=0?(r!=null&&(r.trackChildChange(zp(d.name,d.node)),r.trackChildChange(Vd(n,s))),l.updateImmediateChild(n,s).updateImmediateChild(d.name,Te.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FI{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Wt}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return re(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return re(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Gd}hasEnd(){return this.endSet_}getIndexEndValue(){return re(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return re(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ic}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return re(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Wt}copy(){const e=new FI;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function r_e(t){return t.loadsAllData()?new LI(t.getIndex()):t.hasLimit()?new i_e(t):new Hp(t)}function eM(t){const e={};if(t.isDefault())return e;let n;if(t.index_===Wt?n="$priority":t.index_===n_e?n="$value":t.index_===_d?n="$key":(re(t.index_ instanceof e_e,"Unrecognized index type!"),n=t.index_.toString()),e.orderBy=tn(n),t.startSet_){const s=t.startAfterSet_?"startAfter":"startAt";e[s]=tn(t.indexStartValue_),t.startNameSet_&&(e[s]+=","+tn(t.indexStartName_))}if(t.endSet_){const s=t.endBeforeSet_?"endBefore":"endAt";e[s]=tn(t.indexEndValue_),t.endNameSet_&&(e[s]+=","+tn(t.indexEndName_))}return t.limitSet_&&(t.isViewFromLeft()?e.limitToFirst=t.limit_:e.limitToLast=t.limit_),e}function tM(t){const e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_),e.sin=!t.startAfterSet_),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_),e.ein=!t.endBeforeSet_),t.limitSet_){e.l=t.limit_;let n=t.viewFrom_;n===""&&(t.isViewFromLeft()?n="l":n="r"),e.vf=n}return t.index_!==Wt&&(e.i=t.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wv extends f6{constructor(e,n,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=n,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=Ff("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return n!==void 0?"tag$"+n:(re(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,n,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Wv.getListenId_(e,s),l={};this.listens_[o]=l;const c=eM(e._queryParams);this.restRequest_(r+".json",c,(d,u)=>{let h=u;if(d===404&&(h=null,d=null),d===null&&this.onDataUpdate_(r,h,!1,s),zd(this.listens_,o)===l){let p;d?d===401?p="permission_denied":p="rest_error:"+d:p="ok",i(p,null)}})}unlisten(e,n){const s=Wv.getListenId_(e,n);delete this.listens_[s]}get(e){const n=eM(e._queryParams),s=e._path.toString(),i=new Af;return this.restRequest_(s+".json",n,(r,o)=>{let l=o;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(s,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,n={},s){return n.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(n.auth=i.accessToken),r&&r.token&&(n.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+pu(n);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=Dp(l.responseText)}catch{ps("Failed to parse JSON response for "+o+": "+l.responseText)}s(null,c)}else l.status!==401&&l.status!==404&&ps("Got unsuccessful REST response for "+o+" Status: "+l.status),s(l.status);s=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o_e{constructor(){this.rootNode_=Te.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,n){this.rootNode_=this.rootNode_.updateChild(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hv(){return{value:null,children:new Map}}function C6(t,e,n){if(We(e))t.value=n,t.children.clear();else if(t.value!==null)t.value=t.value.updateChild(e,n);else{const s=Le(e);t.children.has(s)||t.children.set(s,Hv());const i=t.children.get(s);e=gt(e),C6(i,e,n)}}function WC(t,e,n){t.value!==null?n(e,t.value):a_e(t,(s,i)=>{const r=new ct(e.toString()+"/"+s);WC(i,r,n)})}function a_e(t,e){t.children.forEach((n,s)=>{e(s,n)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l_e{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),n=Object.assign({},e);return this.last_&&Mn(this.last_,(s,i)=>{n[s]=n[s]-i}),this.last_=e,n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nM=10*1e3,c_e=30*1e3,d_e=5*60*1e3;class u_e{constructor(e,n){this.server_=n,this.statsToReport_={},this.statsListener_=new l_e(e);const s=nM+(c_e-nM)*Math.random();Zh(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),n={};let s=!1;Mn(e,(i,r)=>{r>0&&qr(this.statsToReport_,i)&&(n[i]=r,s=!0)}),s&&this.server_.reportStats(n),Zh(this.reportStats_.bind(this),Math.floor(Math.random()*2*d_e))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xi;(function(t){t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Xi||(Xi={}));function BI(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function UI(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function $I(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gv{constructor(e,n,s){this.path=e,this.affectedTree=n,this.revert=s,this.type=Xi.ACK_USER_WRITE,this.source=BI()}operationForChild(e){if(We(this.path)){if(this.affectedTree.value!=null)return re(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const n=this.affectedTree.subtree(new ct(e));return new Gv(Je(),n,this.revert)}}else return re(Le(this.path)===e,"operationForChild called for unrelated child."),new Gv(gt(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e,n){this.source=e,this.path=n,this.type=Xi.LISTEN_COMPLETE}operationForChild(e){return We(this.path)?new Gp(this.source,Je()):new Gp(this.source,gt(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(e,n,s){this.source=e,this.path=n,this.snap=s,this.type=Xi.OVERWRITE}operationForChild(e){return We(this.path)?new rc(this.source,Je(),this.snap.getImmediateChild(e)):new rc(this.source,gt(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e,n,s){this.source=e,this.path=n,this.children=s,this.type=Xi.MERGE}operationForChild(e){if(We(this.path)){const n=this.children.subtree(new ct(e));return n.isEmpty()?null:n.value?new rc(this.source,Je(),n.value):new Kd(this.source,Je(),n)}else return re(Le(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Kd(this.source,gt(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(e,n,s){this.node_=e,this.fullyInitialized_=n,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(We(e))return this.isFullyInitialized()&&!this.filtered_;const n=Le(e);return this.isCompleteForChild(n)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h_e{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function p_e(t,e,n,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&t.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(s_e(o.childName,o.snapshotNode))}),eh(t,i,"child_removed",e,s,n),eh(t,i,"child_added",e,s,n),eh(t,i,"child_moved",r,s,n),eh(t,i,"child_changed",e,s,n),eh(t,i,"value",e,s,n),i}function eh(t,e,n,s,i,r){const o=s.filter(l=>l.type===n);o.sort((l,c)=>g_e(t,l,c)),o.forEach(l=>{const c=f_e(t,l,r);i.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,t.query_))})})}function f_e(t,e,n){return e.type==="value"||e.type==="child_removed"||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}function g_e(t,e,n){if(e.childName==null||n.childName==null)throw hu("Should only compare child_ events.");const s=new Fe(e.childName,e.snapshotNode),i=new Fe(n.childName,n.snapshotNode);return t.index_.compare(s,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kS(t,e){return{eventCache:t,serverCache:e}}function Jh(t,e,n,s){return kS(new Ya(e,n,s),t.serverCache)}function E6(t,e,n,s){return kS(t.eventCache,new Ya(e,n,s))}function Vv(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function oc(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vw;const m_e=()=>(Vw||(Vw=new Ls(e0e)),Vw);class ft{constructor(e,n=m_e()){this.value=e,this.children=n}static fromObject(e){let n=new ft(null);return Mn(e,(s,i)=>{n=n.set(new ct(s),i)}),n}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,n){if(this.value!=null&&n(this.value))return{path:Je(),value:this.value};if(We(e))return null;{const s=Le(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(gt(e),n);return r!=null?{path:zt(new ct(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(We(e))return this;{const n=Le(e),s=this.children.get(n);return s!==null?s.subtree(gt(e)):new ft(null)}}set(e,n){if(We(e))return new ft(n,this.children);{const s=Le(e),r=(this.children.get(s)||new ft(null)).set(gt(e),n),o=this.children.insert(s,r);return new ft(this.value,o)}}remove(e){if(We(e))return this.children.isEmpty()?new ft(null):new ft(null,this.children);{const n=Le(e),s=this.children.get(n);if(s){const i=s.remove(gt(e));let r;return i.isEmpty()?r=this.children.remove(n):r=this.children.insert(n,i),this.value===null&&r.isEmpty()?new ft(null):new ft(this.value,r)}else return this}}get(e){if(We(e))return this.value;{const n=Le(e),s=this.children.get(n);return s?s.get(gt(e)):null}}setTree(e,n){if(We(e))return n;{const s=Le(e),r=(this.children.get(s)||new ft(null)).setTree(gt(e),n);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new ft(this.value,o)}}fold(e){return this.fold_(Je(),e)}fold_(e,n){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(zt(e,i),n)}),n(e,this.value,s)}findOnPath(e,n){return this.findOnPath_(e,Je(),n)}findOnPath_(e,n,s){const i=this.value?s(n,this.value):!1;if(i)return i;if(We(e))return null;{const r=Le(e),o=this.children.get(r);return o?o.findOnPath_(gt(e),zt(n,r),s):null}}foreachOnPath(e,n){return this.foreachOnPath_(e,Je(),n)}foreachOnPath_(e,n,s){if(We(e))return this;{this.value&&s(n,this.value);const i=Le(e),r=this.children.get(i);return r?r.foreachOnPath_(gt(e),zt(n,i),s):new ft(null)}}foreach(e){this.foreach_(Je(),e)}foreach_(e,n){this.children.inorderTraversal((s,i)=>{i.foreach_(zt(e,s),n)}),this.value&&n(e,this.value)}foreachChild(e){this.children.inorderTraversal((n,s)=>{s.value&&e(n,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e){this.writeTree_=e}static empty(){return new tr(new ft(null))}}function Qh(t,e,n){if(We(e))return new tr(new ft(n));{const s=t.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=us(i,e);return r=r.updateChild(o,n),new tr(t.writeTree_.set(i,r))}else{const i=new ft(n),r=t.writeTree_.setTree(e,i);return new tr(r)}}}function HC(t,e,n){let s=t;return Mn(n,(i,r)=>{s=Qh(s,zt(e,i),r)}),s}function sM(t,e){if(We(e))return tr.empty();{const n=t.writeTree_.setTree(e,new ft(null));return new tr(n)}}function GC(t,e){return vc(t,e)!=null}function vc(t,e){const n=t.writeTree_.findRootMostValueAndPath(e);return n!=null?t.writeTree_.get(n.path).getChild(us(n.path,e)):null}function iM(t){const e=[],n=t.writeTree_.value;return n!=null?n.isLeafNode()||n.forEachChild(Wt,(s,i)=>{e.push(new Fe(s,i))}):t.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new Fe(s,i.value))}),e}function Fa(t,e){if(We(e))return t;{const n=vc(t,e);return n!=null?new tr(new ft(n)):new tr(t.writeTree_.subtree(e))}}function VC(t){return t.writeTree_.isEmpty()}function Yd(t,e){return T6(Je(),t.writeTree_,e)}function T6(t,e,n){if(e.value!=null)return n.updateChild(t,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(re(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):n=T6(zt(t,i),r,n)}),!n.getChild(t).isEmpty()&&s!==null&&(n=n.updateChild(zt(t,".priority"),s)),n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jS(t,e){return j6(e,t)}function y_e(t,e,n,s,i){re(s>t.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),t.allWrites.push({path:e,snap:n,writeId:s,visible:i}),i&&(t.visibleWrites=Qh(t.visibleWrites,e,n)),t.lastWriteId=s}function v_e(t,e,n,s){re(s>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:s,visible:!0}),t.visibleWrites=HC(t.visibleWrites,e,n),t.lastWriteId=s}function x_e(t,e){for(let n=0;n<t.allWrites.length;n++){const s=t.allWrites[n];if(s.writeId===e)return s}return null}function S_e(t,e){const n=t.allWrites.findIndex(l=>l.writeId===e);re(n>=0,"removeWrite called with nonexistent writeId.");const s=t.allWrites[n];t.allWrites.splice(n,1);let i=s.visible,r=!1,o=t.allWrites.length-1;for(;i&&o>=0;){const l=t.allWrites[o];l.visible&&(o>=n&&b_e(l,s.path)?i=!1:Ii(s.path,l.path)&&(r=!0)),o--}if(i){if(r)return w_e(t),!0;if(s.snap)t.visibleWrites=sM(t.visibleWrites,s.path);else{const l=s.children;Mn(l,c=>{t.visibleWrites=sM(t.visibleWrites,zt(s.path,c))})}return!0}else return!1}function b_e(t,e){if(t.snap)return Ii(t.path,e);for(const n in t.children)if(t.children.hasOwnProperty(n)&&Ii(zt(t.path,n),e))return!0;return!1}function w_e(t){t.visibleWrites=I6(t.allWrites,__e,Je()),t.allWrites.length>0?t.lastWriteId=t.allWrites[t.allWrites.length-1].writeId:t.lastWriteId=-1}function __e(t){return t.visible}function I6(t,e,n){let s=tr.empty();for(let i=0;i<t.length;++i){const r=t[i];if(e(r)){const o=r.path;let l;if(r.snap)Ii(n,o)?(l=us(n,o),s=Qh(s,l,r.snap)):Ii(o,n)&&(l=us(o,n),s=Qh(s,Je(),r.snap.getChild(l)));else if(r.children){if(Ii(n,o))l=us(n,o),s=HC(s,l,r.children);else if(Ii(o,n))if(l=us(o,n),We(l))s=HC(s,Je(),r.children);else{const c=zd(r.children,Le(l));if(c){const d=c.getChild(gt(l));s=Qh(s,Je(),d)}}}else throw hu("WriteRecord should have .snap or .children")}}return s}function P6(t,e,n,s,i){if(!s&&!i){const r=vc(t.visibleWrites,e);if(r!=null)return r;{const o=Fa(t.visibleWrites,e);if(VC(o))return n;if(n==null&&!GC(o,Je()))return null;{const l=n||Te.EMPTY_NODE;return Yd(o,l)}}}else{const r=Fa(t.visibleWrites,e);if(!i&&VC(r))return n;if(!i&&n==null&&!GC(r,Je()))return null;{const o=function(d){return(d.visible||i)&&(!s||!~s.indexOf(d.writeId))&&(Ii(d.path,e)||Ii(e,d.path))},l=I6(t.allWrites,o,e),c=n||Te.EMPTY_NODE;return Yd(l,c)}}}function C_e(t,e,n){let s=Te.EMPTY_NODE;const i=vc(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Wt,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(n){const r=Fa(t.visibleWrites,e);return n.forEachChild(Wt,(o,l)=>{const c=Yd(Fa(r,new ct(o)),l);s=s.updateImmediateChild(o,c)}),iM(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=Fa(t.visibleWrites,e);return iM(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function E_e(t,e,n,s,i){re(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=zt(e,n);if(GC(t.visibleWrites,r))return null;{const o=Fa(t.visibleWrites,r);return VC(o)?i.getChild(n):Yd(o,i.getChild(n))}}function T_e(t,e,n,s){const i=zt(e,n),r=vc(t.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(n)){const o=Fa(t.visibleWrites,i);return Yd(o,s.getNode().getImmediateChild(n))}else return null}function I_e(t,e){return vc(t.visibleWrites,e)}function P_e(t,e,n,s,i,r,o){let l;const c=Fa(t.visibleWrites,e),d=vc(c,Je());if(d!=null)l=d;else if(n!=null)l=Yd(c,n);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=o.getCompare(),p=r?l.getReverseIteratorFrom(s,o):l.getIteratorFrom(s,o);let f=p.getNext();for(;f&&u.length<i;)h(f,s)!==0&&u.push(f),f=p.getNext();return u}else return[]}function k_e(){return{visibleWrites:tr.empty(),allWrites:[],lastWriteId:-1}}function Kv(t,e,n,s){return P6(t.writeTree,t.treePath,e,n,s)}function zI(t,e){return C_e(t.writeTree,t.treePath,e)}function rM(t,e,n,s){return E_e(t.writeTree,t.treePath,e,n,s)}function Yv(t,e){return I_e(t.writeTree,zt(t.treePath,e))}function j_e(t,e,n,s,i,r){return P_e(t.writeTree,t.treePath,e,n,s,i,r)}function WI(t,e,n){return T_e(t.writeTree,t.treePath,e,n)}function k6(t,e){return j6(zt(t.treePath,e),t.writeTree)}function j6(t,e){return{treePath:t,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N_e{constructor(){this.changeMap=new Map}trackChildChange(e){const n=e.type,s=e.childName;re(n==="child_added"||n==="child_changed"||n==="child_removed","Only child changes supported for tracking"),re(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(n==="child_added"&&r==="child_removed")this.changeMap.set(s,Wp(s,e.snapshotNode,i.snapshotNode));else if(n==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(n==="child_removed"&&r==="child_changed")this.changeMap.set(s,zp(s,i.oldSnap));else if(n==="child_changed"&&r==="child_added")this.changeMap.set(s,Vd(s,e.snapshotNode));else if(n==="child_changed"&&r==="child_changed")this.changeMap.set(s,Wp(s,e.snapshotNode,i.oldSnap));else throw hu("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class A_e{getCompleteChild(e){return null}getChildAfterChild(e,n,s){return null}}const N6=new A_e;class HI{constructor(e,n,s=null){this.writes_=e,this.viewCache_=n,this.optCompleteServerCache_=s}getCompleteChild(e){const n=this.viewCache_.eventCache;if(n.isCompleteForChild(e))return n.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new Ya(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return WI(this.writes_,e,s)}}getChildAfterChild(e,n,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:oc(this.viewCache_),r=j_e(this.writes_,i,n,1,s,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function R_e(t){return{filter:t}}function M_e(t,e){re(e.eventCache.getNode().isIndexed(t.filter.getIndex()),"Event snap not indexed"),re(e.serverCache.getNode().isIndexed(t.filter.getIndex()),"Server snap not indexed")}function O_e(t,e,n,s,i){const r=new N_e;let o,l;if(n.type===Xi.OVERWRITE){const d=n;d.source.fromUser?o=KC(t,e,d.path,d.snap,s,i,r):(re(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!We(d.path),o=Xv(t,e,d.path,d.snap,s,i,l,r))}else if(n.type===Xi.MERGE){const d=n;d.source.fromUser?o=L_e(t,e,d.path,d.children,s,i,r):(re(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=YC(t,e,d.path,d.children,s,i,l,r))}else if(n.type===Xi.ACK_USER_WRITE){const d=n;d.revert?o=U_e(t,e,d.path,s,i,r):o=F_e(t,e,d.path,d.affectedTree,s,i,r)}else if(n.type===Xi.LISTEN_COMPLETE)o=B_e(t,e,n.path,s,r);else throw hu("Unknown operation type: "+n.type);const c=r.getChanges();return D_e(e,o,c),{viewCache:o,changes:c}}function D_e(t,e,n){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=Vv(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&n.push(_6(Vv(e)))}}function A6(t,e,n,s,i,r){const o=e.eventCache;if(Yv(s,n)!=null)return e;{let l,c;if(We(n))if(re(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=oc(e),u=d instanceof Te?d:Te.EMPTY_NODE,h=zI(s,u);l=t.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const d=Kv(s,oc(e));l=t.filter.updateFullNode(e.eventCache.getNode(),d,r)}else{const d=Le(n);if(d===".priority"){re(Ka(n)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=rM(s,n,u,c);h!=null?l=t.filter.updatePriority(u,h):l=o.getNode()}else{const u=gt(n);let h;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const p=rM(s,n,o.getNode(),c);p!=null?h=o.getNode().getImmediateChild(d).updateChild(u,p):h=o.getNode().getImmediateChild(d)}else h=WI(s,d,e.serverCache);h!=null?l=t.filter.updateChild(o.getNode(),d,h,u,i,r):l=o.getNode()}}return Jh(e,l,o.isFullyInitialized()||We(n),t.filter.filtersNodes())}}function Xv(t,e,n,s,i,r,o,l){const c=e.serverCache;let d;const u=o?t.filter:t.filter.getIndexedFilter();if(We(n))d=u.updateFullNode(c.getNode(),s,null);else if(u.filtersNodes()&&!c.isFiltered()){const f=c.getNode().updateChild(n,s);d=u.updateFullNode(c.getNode(),f,null)}else{const f=Le(n);if(!c.isCompleteForPath(n)&&Ka(n)>1)return e;const g=gt(n),x=c.getNode().getImmediateChild(f).updateChild(g,s);f===".priority"?d=u.updatePriority(c.getNode(),x):d=u.updateChild(c.getNode(),f,x,g,N6,null)}const h=E6(e,d,c.isFullyInitialized()||We(n),u.filtersNodes()),p=new HI(i,h,r);return A6(t,h,n,i,p,l)}function KC(t,e,n,s,i,r,o){const l=e.eventCache;let c,d;const u=new HI(i,e,r);if(We(n))d=t.filter.updateFullNode(e.eventCache.getNode(),s,o),c=Jh(e,d,!0,t.filter.filtersNodes());else{const h=Le(n);if(h===".priority")d=t.filter.updatePriority(e.eventCache.getNode(),s),c=Jh(e,d,l.isFullyInitialized(),l.isFiltered());else{const p=gt(n),f=l.getNode().getImmediateChild(h);let g;if(We(p))g=s;else{const y=u.getCompleteChild(h);y!=null?RI(p)===".priority"&&y.getChild(m6(p)).isEmpty()?g=y:g=y.updateChild(p,s):g=Te.EMPTY_NODE}if(f.equals(g))c=e;else{const y=t.filter.updateChild(l.getNode(),h,g,p,u,o);c=Jh(e,y,l.isFullyInitialized(),t.filter.filtersNodes())}}}return c}function oM(t,e){return t.eventCache.isCompleteForChild(e)}function L_e(t,e,n,s,i,r,o){let l=e;return s.foreach((c,d)=>{const u=zt(n,c);oM(e,Le(u))&&(l=KC(t,l,u,d,i,r,o))}),s.foreach((c,d)=>{const u=zt(n,c);oM(e,Le(u))||(l=KC(t,l,u,d,i,r,o))}),l}function aM(t,e,n){return n.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function YC(t,e,n,s,i,r,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;We(n)?d=s:d=new ft(null).setTree(n,s);const u=e.serverCache.getNode();return d.children.inorderTraversal((h,p)=>{if(u.hasChild(h)){const f=e.serverCache.getNode().getImmediateChild(h),g=aM(t,f,p);c=Xv(t,c,new ct(h),g,i,r,o,l)}}),d.children.inorderTraversal((h,p)=>{const f=!e.serverCache.isCompleteForChild(h)&&p.value===null;if(!u.hasChild(h)&&!f){const g=e.serverCache.getNode().getImmediateChild(h),y=aM(t,g,p);c=Xv(t,c,new ct(h),y,i,r,o,l)}}),c}function F_e(t,e,n,s,i,r,o){if(Yv(i,n)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(s.value!=null){if(We(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return Xv(t,e,n,c.getNode().getChild(n),i,r,l,o);if(We(n)){let d=new ft(null);return c.getNode().forEachChild(_d,(u,h)=>{d=d.set(new ct(u),h)}),YC(t,e,n,d,i,r,l,o)}else return e}else{let d=new ft(null);return s.foreach((u,h)=>{const p=zt(n,u);c.isCompleteForPath(p)&&(d=d.set(u,c.getNode().getChild(p)))}),YC(t,e,n,d,i,r,l,o)}}function B_e(t,e,n,s,i){const r=e.serverCache,o=E6(e,r.getNode(),r.isFullyInitialized()||We(n),r.isFiltered());return A6(t,o,n,s,N6,i)}function U_e(t,e,n,s,i,r){let o;if(Yv(s,n)!=null)return e;{const l=new HI(s,e,i),c=e.eventCache.getNode();let d;if(We(n)||Le(n)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Kv(s,oc(e));else{const h=e.serverCache.getNode();re(h instanceof Te,"serverChildren would be complete if leaf node"),u=zI(s,h)}u=u,d=t.filter.updateFullNode(c,u,r)}else{const u=Le(n);let h=WI(s,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?d=t.filter.updateChild(c,u,h,gt(n),l,r):e.eventCache.getNode().hasChild(u)?d=t.filter.updateChild(c,u,Te.EMPTY_NODE,gt(n),l,r):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Kv(s,oc(e)),o.isLeafNode()&&(d=t.filter.updateFullNode(d,o,r)))}return o=e.serverCache.isFullyInitialized()||Yv(s,Je())!=null,Jh(e,d,o,t.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $_e{constructor(e,n){this.query_=e,this.eventRegistrations_=[];const s=this.query_._queryParams,i=new LI(s.getIndex()),r=r_e(s);this.processor_=R_e(r);const o=n.serverCache,l=n.eventCache,c=i.updateFullNode(Te.EMPTY_NODE,o.getNode(),null),d=r.updateFullNode(Te.EMPTY_NODE,l.getNode(),null),u=new Ya(c,o.isFullyInitialized(),i.filtersNodes()),h=new Ya(d,l.isFullyInitialized(),r.filtersNodes());this.viewCache_=kS(h,u),this.eventGenerator_=new h_e(this.query_)}get query(){return this.query_}}function z_e(t){return t.viewCache_.serverCache.getNode()}function W_e(t){return Vv(t.viewCache_)}function H_e(t,e){const n=oc(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!We(e)&&!n.getImmediateChild(Le(e)).isEmpty())?n.getChild(e):null}function lM(t){return t.eventRegistrations_.length===0}function G_e(t,e){t.eventRegistrations_.push(e)}function cM(t,e,n){const s=[];if(n){re(e==null,"A cancel should cancel all event registrations.");const i=t.query._path;t.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(n,i);o&&s.push(o)})}if(e){let i=[];for(let r=0;r<t.eventRegistrations_.length;++r){const o=t.eventRegistrations_[r];if(!o.matches(e))i.push(o);else if(e.hasAnyCallback()){i=i.concat(t.eventRegistrations_.slice(r+1));break}}t.eventRegistrations_=i}else t.eventRegistrations_=[];return s}function dM(t,e,n,s){e.type===Xi.MERGE&&e.source.queryId!==null&&(re(oc(t.viewCache_),"We should always have a full cache before handling merges"),re(Vv(t.viewCache_),"Missing event cache, even though we have a server cache"));const i=t.viewCache_,r=O_e(t.processor_,i,e,n,s);return M_e(t.processor_,r.viewCache),re(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=r.viewCache,R6(t,r.changes,r.viewCache.eventCache.getNode(),null)}function V_e(t,e){const n=t.viewCache_.eventCache,s=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Wt,(r,o)=>{s.push(Vd(r,o))}),n.isFullyInitialized()&&s.push(_6(n.getNode())),R6(t,s,n.getNode(),e)}function R6(t,e,n,s){const i=s?[s]:t.eventRegistrations_;return p_e(t.eventGenerator_,e,n,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qv;class M6{constructor(){this.views=new Map}}function K_e(t){re(!qv,"__referenceConstructor has already been defined"),qv=t}function Y_e(){return re(qv,"Reference.ts has not been loaded"),qv}function X_e(t){return t.views.size===0}function GI(t,e,n,s){const i=e.source.queryId;if(i!==null){const r=t.views.get(i);return re(r!=null,"SyncTree gave us an op for an invalid query."),dM(r,e,n,s)}else{let r=[];for(const o of t.views.values())r=r.concat(dM(o,e,n,s));return r}}function O6(t,e,n,s,i){const r=e._queryIdentifier,o=t.views.get(r);if(!o){let l=Kv(n,i?s:null),c=!1;l?c=!0:s instanceof Te?(l=zI(n,s),c=!1):(l=Te.EMPTY_NODE,c=!1);const d=kS(new Ya(l,c,!1),new Ya(s,i,!1));return new $_e(e,d)}return o}function q_e(t,e,n,s,i,r){const o=O6(t,e,s,i,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),G_e(o,n),V_e(o,n)}function Z_e(t,e,n,s){const i=e._queryIdentifier,r=[];let o=[];const l=Xa(t);if(i==="default")for(const[c,d]of t.views.entries())o=o.concat(cM(d,n,s)),lM(d)&&(t.views.delete(c),d.query._queryParams.loadsAllData()||r.push(d.query));else{const c=t.views.get(i);c&&(o=o.concat(cM(c,n,s)),lM(c)&&(t.views.delete(i),c.query._queryParams.loadsAllData()||r.push(c.query)))}return l&&!Xa(t)&&r.push(new(Y_e())(e._repo,e._path)),{removed:r,events:o}}function D6(t){const e=[];for(const n of t.views.values())n.query._queryParams.loadsAllData()||e.push(n);return e}function Ba(t,e){let n=null;for(const s of t.views.values())n=n||H_e(s,e);return n}function L6(t,e){if(e._queryParams.loadsAllData())return NS(t);{const s=e._queryIdentifier;return t.views.get(s)}}function F6(t,e){return L6(t,e)!=null}function Xa(t){return NS(t)!=null}function NS(t){for(const e of t.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zv;function J_e(t){re(!Zv,"__referenceConstructor has already been defined"),Zv=t}function Q_e(){return re(Zv,"Reference.ts has not been loaded"),Zv}let eCe=1;class uM{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ft(null),this.pendingWriteTree_=k_e(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function B6(t,e,n,s,i){return y_e(t.pendingWriteTree_,e,n,s,i),i?yu(t,new rc(BI(),e,n)):[]}function tCe(t,e,n,s){v_e(t.pendingWriteTree_,e,n,s);const i=ft.fromObject(n);return yu(t,new Kd(BI(),e,i))}function wa(t,e,n=!1){const s=x_e(t.pendingWriteTree_,e);if(S_e(t.pendingWriteTree_,e)){let r=new ft(null);return s.snap!=null?r=r.set(Je(),!0):Mn(s.children,o=>{r=r.set(new ct(o),!0)}),yu(t,new Gv(s.path,r,n))}else return[]}function Uf(t,e,n){return yu(t,new rc(UI(),e,n))}function nCe(t,e,n){const s=ft.fromObject(n);return yu(t,new Kd(UI(),e,s))}function sCe(t,e){return yu(t,new Gp(UI(),e))}function iCe(t,e,n){const s=KI(t,n);if(s){const i=YI(s),r=i.path,o=i.queryId,l=us(r,e),c=new Gp($I(o),l);return XI(t,r,c)}else return[]}function Jv(t,e,n,s,i=!1){const r=e._path,o=t.syncPointTree_.get(r);let l=[];if(o&&(e._queryIdentifier==="default"||F6(o,e))){const c=Z_e(o,e,n,s);X_e(o)&&(t.syncPointTree_=t.syncPointTree_.remove(r));const d=c.removed;if(l=c.events,!i){const u=d.findIndex(p=>p._queryParams.loadsAllData())!==-1,h=t.syncPointTree_.findOnPath(r,(p,f)=>Xa(f));if(u&&!h){const p=t.syncPointTree_.subtree(r);if(!p.isEmpty()){const f=aCe(p);for(let g=0;g<f.length;++g){const y=f[g],x=y.query,m=W6(t,y);t.listenProvider_.startListening(ep(x),Vp(t,x),m.hashFn,m.onComplete)}}}!h&&d.length>0&&!s&&(u?t.listenProvider_.stopListening(ep(e),null):d.forEach(p=>{const f=t.queryToTagMap.get(AS(p));t.listenProvider_.stopListening(ep(p),f)}))}lCe(t,d)}return l}function U6(t,e,n,s){const i=KI(t,s);if(i!=null){const r=YI(i),o=r.path,l=r.queryId,c=us(o,e),d=new rc($I(l),c,n);return XI(t,o,d)}else return[]}function rCe(t,e,n,s){const i=KI(t,s);if(i){const r=YI(i),o=r.path,l=r.queryId,c=us(o,e),d=ft.fromObject(n),u=new Kd($I(l),c,d);return XI(t,o,u)}else return[]}function XC(t,e,n,s=!1){const i=e._path;let r=null,o=!1;t.syncPointTree_.foreachOnPath(i,(p,f)=>{const g=us(p,i);r=r||Ba(f,g),o=o||Xa(f)});let l=t.syncPointTree_.get(i);l?(o=o||Xa(l),r=r||Ba(l,Je())):(l=new M6,t.syncPointTree_=t.syncPointTree_.set(i,l));let c;r!=null?c=!0:(c=!1,r=Te.EMPTY_NODE,t.syncPointTree_.subtree(i).foreachChild((f,g)=>{const y=Ba(g,Je());y&&(r=r.updateImmediateChild(f,y))}));const d=F6(l,e);if(!d&&!e._queryParams.loadsAllData()){const p=AS(e);re(!t.queryToTagMap.has(p),"View does not exist, but we have a tag");const f=cCe();t.queryToTagMap.set(p,f),t.tagToQueryMap.set(f,p)}const u=jS(t.pendingWriteTree_,i);let h=q_e(l,e,n,u,r,c);if(!d&&!o&&!s){const p=L6(l,e);h=h.concat(dCe(t,e,p))}return h}function VI(t,e,n){const i=t.pendingWriteTree_,r=t.syncPointTree_.findOnPath(e,(o,l)=>{const c=us(o,e),d=Ba(l,c);if(d)return d});return P6(i,e,r,n,!0)}function oCe(t,e){const n=e._path;let s=null;t.syncPointTree_.foreachOnPath(n,(d,u)=>{const h=us(d,n);s=s||Ba(u,h)});let i=t.syncPointTree_.get(n);i?s=s||Ba(i,Je()):(i=new M6,t.syncPointTree_=t.syncPointTree_.set(n,i));const r=s!=null,o=r?new Ya(s,!0,!1):null,l=jS(t.pendingWriteTree_,e._path),c=O6(i,e,l,r?o.getNode():Te.EMPTY_NODE,r);return W_e(c)}function yu(t,e){return $6(e,t.syncPointTree_,null,jS(t.pendingWriteTree_,Je()))}function $6(t,e,n,s){if(We(t.path))return z6(t,e,n,s);{const i=e.get(Je());n==null&&i!=null&&(n=Ba(i,Je()));let r=[];const o=Le(t.path),l=t.operationForChild(o),c=e.children.get(o);if(c&&l){const d=n?n.getImmediateChild(o):null,u=k6(s,o);r=r.concat($6(l,c,d,u))}return i&&(r=r.concat(GI(i,t,s,n))),r}}function z6(t,e,n,s){const i=e.get(Je());n==null&&i!=null&&(n=Ba(i,Je()));let r=[];return e.children.inorderTraversal((o,l)=>{const c=n?n.getImmediateChild(o):null,d=k6(s,o),u=t.operationForChild(o);u&&(r=r.concat(z6(u,l,c,d)))}),i&&(r=r.concat(GI(i,t,s,n))),r}function W6(t,e){const n=e.query,s=Vp(t,n);return{hashFn:()=>(z_e(e)||Te.EMPTY_NODE).hash(),onComplete:i=>{if(i==="ok")return s?iCe(t,n._path,s):sCe(t,n._path);{const r=s0e(i,n);return Jv(t,n,null,r)}}}}function Vp(t,e){const n=AS(e);return t.queryToTagMap.get(n)}function AS(t){return t._path.toString()+"$"+t._queryIdentifier}function KI(t,e){return t.tagToQueryMap.get(e)}function YI(t){const e=t.indexOf("$");return re(e!==-1&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new ct(t.substr(0,e))}}function XI(t,e,n){const s=t.syncPointTree_.get(e);re(s,"Missing sync point for query tag that we're tracking");const i=jS(t.pendingWriteTree_,e);return GI(s,n,i,null)}function aCe(t){return t.fold((e,n,s)=>{if(n&&Xa(n))return[NS(n)];{let i=[];return n&&(i=D6(n)),Mn(s,(r,o)=>{i=i.concat(o)}),i}})}function ep(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Q_e())(t._repo,t._path):t}function lCe(t,e){for(let n=0;n<e.length;++n){const s=e[n];if(!s._queryParams.loadsAllData()){const i=AS(s),r=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(r)}}}function cCe(){return eCe++}function dCe(t,e,n){const s=e._path,i=Vp(t,e),r=W6(t,n),o=t.listenProvider_.startListening(ep(e),i,r.hashFn,r.onComplete),l=t.syncPointTree_.subtree(s);if(i)re(!Xa(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((d,u,h)=>{if(!We(d)&&u&&Xa(u))return[NS(u).query];{let p=[];return u&&(p=p.concat(D6(u).map(f=>f.query))),Mn(h,(f,g)=>{p=p.concat(g)}),p}});for(let d=0;d<c.length;++d){const u=c[d];t.listenProvider_.stopListening(ep(u),Vp(t,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qI{constructor(e){this.node_=e}getImmediateChild(e){const n=this.node_.getImmediateChild(e);return new qI(n)}node(){return this.node_}}class ZI{constructor(e,n){this.syncTree_=e,this.path_=n}getImmediateChild(e){const n=zt(this.path_,e);return new ZI(this.syncTree_,n)}node(){return VI(this.syncTree_,this.path_)}}const uCe=function(t){return t=t||{},t.timestamp=t.timestamp||new Date().getTime(),t},hM=function(t,e,n){if(!t||typeof t!="object")return t;if(re(".sv"in t,"Unexpected leaf node or priority contents"),typeof t[".sv"]=="string")return hCe(t[".sv"],e,n);if(typeof t[".sv"]=="object")return pCe(t[".sv"],e);re(!1,"Unexpected server value: "+JSON.stringify(t,null,2))},hCe=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:re(!1,"Unexpected server value: "+t)}},pCe=function(t,e,n){t.hasOwnProperty("increment")||re(!1,"Unexpected server value: "+JSON.stringify(t,null,2));const s=t.increment;typeof s!="number"&&re(!1,"Unexpected increment value: "+s);const i=e.node();if(re(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},H6=function(t,e,n,s){return JI(e,new ZI(n,t),s)},G6=function(t,e,n){return JI(t,new qI(e),n)};function JI(t,e,n){const s=t.getPriority().val(),i=hM(s,e.getImmediateChild(".priority"),n);let r;if(t.isLeafNode()){const o=t,l=hM(o.getValue(),e,n);return l!==o.getValue()||i!==o.getPriority().val()?new an(l,en(i)):t}else{const o=t;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new an(i))),o.forEachChild(Wt,(l,c)=>{const d=JI(c,e.getImmediateChild(l),n);d!==c&&(r=r.updateImmediateChild(l,d))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QI{constructor(e="",n=null,s={children:{},childCount:0}){this.name=e,this.parent=n,this.node=s}}function eP(t,e){let n=e instanceof ct?e:new ct(e),s=t,i=Le(n);for(;i!==null;){const r=zd(s.node.children,i)||{children:{},childCount:0};s=new QI(i,s,r),n=gt(n),i=Le(n)}return s}function vu(t){return t.node.value}function V6(t,e){t.node.value=e,qC(t)}function K6(t){return t.node.childCount>0}function fCe(t){return vu(t)===void 0&&!K6(t)}function RS(t,e){Mn(t.node.children,(n,s)=>{e(new QI(n,t,s))})}function Y6(t,e,n,s){n&&e(t),RS(t,i=>{Y6(i,e,!0)})}function gCe(t,e,n){let s=t.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function $f(t){return new ct(t.parent===null?t.name:$f(t.parent)+"/"+t.name)}function qC(t){t.parent!==null&&mCe(t.parent,t.name,t)}function mCe(t,e,n){const s=fCe(n),i=qr(t.node.children,e);s&&i?(delete t.node.children[e],t.node.childCount--,qC(t)):!s&&!i&&(t.node.children[e]=n.node,t.node.childCount++,qC(t))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yCe=/[\[\].#$\/\u0000-\u001F\u007F]/,vCe=/[\[\].#$\u0000-\u001F\u007F]/,Kw=10*1024*1024,tP=function(t){return typeof t=="string"&&t.length!==0&&!yCe.test(t)},X6=function(t){return typeof t=="string"&&t.length!==0&&!vCe.test(t)},xCe=function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),X6(t)},SCe=function(t){return t===null||typeof t=="string"||typeof t=="number"&&!PI(t)||t&&typeof t=="object"&&qr(t,".sv")},q6=function(t,e,n,s){s&&e===void 0||MS(wS(t,"value"),e,n)},MS=function(t,e,n){const s=n instanceof ct?new L0e(n,t):n;if(e===void 0)throw new Error(t+"contains undefined "+Cl(s));if(typeof e=="function")throw new Error(t+"contains a function "+Cl(s)+" with contents = "+e.toString());if(PI(e))throw new Error(t+"contains "+e.toString()+" "+Cl(s));if(typeof e=="string"&&e.length>Kw/3&&_S(e)>Kw)throw new Error(t+"contains a string greater than "+Kw+" utf8 bytes "+Cl(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(Mn(e,(o,l)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!tP(o)))throw new Error(t+" contains an invalid key ("+o+") "+Cl(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);F0e(s,o),MS(t,l,s),B0e(s)}),i&&r)throw new Error(t+' contains ".value" child '+Cl(s)+" in addition to actual children.")}},bCe=function(t,e){let n,s;for(n=0;n<e.length;n++){s=e[n];const r=$p(s);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!tP(r[o]))throw new Error(t+"contains an invalid key ("+r[o]+") in path "+s.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(D0e);let i=null;for(n=0;n<e.length;n++){if(s=e[n],i!==null&&Ii(i,s))throw new Error(t+"contains a path "+i.toString()+" that is ancestor of another path "+s.toString());i=s}},wCe=function(t,e,n,s){const i=wS(t,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(i+" must be an object containing the children to replace.");const r=[];Mn(e,(o,l)=>{const c=new ct(o);if(MS(i,l,zt(n,c)),RI(c)===".priority"&&!SCe(l))throw new Error(i+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),bCe(i,r)},Z6=function(t,e,n,s){if(!X6(n))throw new Error(wS(t,e)+'was an invalid path = "'+n+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},_Ce=function(t,e,n,s){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Z6(t,e,n)},J6=function(t,e){if(Le(e)===".info")throw new Error(t+" failed = Can't modify data under /.info/")},CCe=function(t,e){const n=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!tP(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||n.length!==0&&!xCe(n))throw new Error(wS(t,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ECe{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function OS(t,e){let n=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();n!==null&&!MI(r,n.path)&&(t.eventLists_.push(n),n=null),n===null&&(n={events:[],path:r}),n.events.push(i)}n&&t.eventLists_.push(n)}function Q6(t,e,n){OS(t,n),e8(t,s=>MI(s,e))}function Mi(t,e,n){OS(t,n),e8(t,s=>Ii(s,e)||Ii(e,s))}function e8(t,e){t.recursionDepth_++;let n=!0;for(let s=0;s<t.eventLists_.length;s++){const i=t.eventLists_[s];if(i){const r=i.path;e(r)?(TCe(t.eventLists_[s]),t.eventLists_[s]=null):n=!1}}n&&(t.eventLists_=[]),t.recursionDepth_--}function TCe(t){for(let e=0;e<t.events.length;e++){const n=t.events[e];if(n!==null){t.events[e]=null;const s=n.getEventRunner();qh&&In("event: "+n.toString()),mu(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ICe="repo_interrupt",PCe=25;class kCe{constructor(e,n,s,i){this.repoInfo_=e,this.forceRestClient_=n,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ECe,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Hv(),this.transactionQueueTree_=new QI,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function jCe(t,e,n){if(t.stats_=NI(t.repoInfo_),t.forceRestClient_||a0e())t.server_=new Wv(t.repoInfo_,(s,i,r,o)=>{pM(t,s,i,r,o)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(()=>fM(t,!0),0);else{if(typeof n<"u"&&n!==null){if(typeof n!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{tn(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new Eo(t.repoInfo_,e,(s,i,r,o)=>{pM(t,s,i,r,o)},s=>{fM(t,s)},s=>{NCe(t,s)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}t.authTokenProvider_.addTokenChangeListener(s=>{t.server_.refreshAuthToken(s)}),t.appCheckProvider_.addTokenChangeListener(s=>{t.server_.refreshAppCheckToken(s.token)}),t.statsReporter_=h0e(t.repoInfo_,()=>new u_e(t.stats_,t.server_)),t.infoData_=new o_e,t.infoSyncTree_=new uM({startListening:(s,i,r,o)=>{let l=[];const c=t.infoData_.getNode(s._path);return c.isEmpty()||(l=Uf(t.infoSyncTree_,s._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),nP(t,"connected",!1),t.serverSyncTree_=new uM({startListening:(s,i,r,o)=>(t.server_.listen(s,r,i,(l,c)=>{const d=o(l,c);Mi(t.eventQueue_,s._path,d)}),[]),stopListening:(s,i)=>{t.server_.unlisten(s,i)}})}function t8(t){const n=t.infoData_.getNode(new ct(".info/serverTimeOffset")).val()||0;return new Date().getTime()+n}function DS(t){return uCe({timestamp:t8(t)})}function pM(t,e,n,s,i){t.dataUpdateCount++;const r=new ct(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;let o=[];if(i)if(s){const c=Av(n,d=>en(d));o=rCe(t.serverSyncTree_,r,c,i)}else{const c=en(n);o=U6(t.serverSyncTree_,r,c,i)}else if(s){const c=Av(n,d=>en(d));o=nCe(t.serverSyncTree_,r,c)}else{const c=en(n);o=Uf(t.serverSyncTree_,r,c)}let l=r;o.length>0&&(l=Xd(t,r)),Mi(t.eventQueue_,l,o)}function fM(t,e){nP(t,"connected",e),e===!1&&OCe(t)}function NCe(t,e){Mn(e,(n,s)=>{nP(t,n,s)})}function nP(t,e,n){const s=new ct("/.info/"+e),i=en(n);t.infoData_.updateSnapshot(s,i);const r=Uf(t.infoSyncTree_,s,i);Mi(t.eventQueue_,s,r)}function sP(t){return t.nextWriteId_++}function ACe(t,e,n){const s=oCe(t.serverSyncTree_,e);return s!=null?Promise.resolve(s):t.server_.get(e).then(i=>{const r=en(i).withIndex(e._queryParams.getIndex());XC(t.serverSyncTree_,e,n,!0);let o;if(e._queryParams.loadsAllData())o=Uf(t.serverSyncTree_,e._path,r);else{const l=Vp(t.serverSyncTree_,e);o=U6(t.serverSyncTree_,e._path,r,l)}return Mi(t.eventQueue_,e._path,o),Jv(t.serverSyncTree_,e,n,null,!0),r},i=>(zf(t,"get for query "+tn(e)+" failed: "+i),Promise.reject(new Error(i))))}function RCe(t,e,n,s,i){zf(t,"set",{path:e.toString(),value:n,priority:s});const r=DS(t),o=en(n,s),l=VI(t.serverSyncTree_,e),c=G6(o,l,r),d=sP(t),u=B6(t.serverSyncTree_,e,c,d,!0);OS(t.eventQueue_,u),t.server_.put(e.toString(),o.val(!0),(p,f)=>{const g=p==="ok";g||ps("set at "+e+" failed: "+p);const y=wa(t.serverSyncTree_,d,!g);Mi(t.eventQueue_,e,y),ZC(t,i,p,f)});const h=rP(t,e);Xd(t,h),Mi(t.eventQueue_,h,[])}function MCe(t,e,n,s){zf(t,"update",{path:e.toString(),value:n});let i=!0;const r=DS(t),o={};if(Mn(n,(l,c)=>{i=!1,o[l]=H6(zt(e,l),en(c),t.serverSyncTree_,r)}),i)In("update() called with empty data.  Don't do anything."),ZC(t,s,"ok",void 0);else{const l=sP(t),c=tCe(t.serverSyncTree_,e,o,l);OS(t.eventQueue_,c),t.server_.merge(e.toString(),n,(d,u)=>{const h=d==="ok";h||ps("update at "+e+" failed: "+d);const p=wa(t.serverSyncTree_,l,!h),f=p.length>0?Xd(t,e):e;Mi(t.eventQueue_,f,p),ZC(t,s,d,u)}),Mn(n,d=>{const u=rP(t,zt(e,d));Xd(t,u)}),Mi(t.eventQueue_,e,[])}}function OCe(t){zf(t,"onDisconnectEvents");const e=DS(t),n=Hv();WC(t.onDisconnect_,Je(),(i,r)=>{const o=H6(i,r,t.serverSyncTree_,e);C6(n,i,o)});let s=[];WC(n,Je(),(i,r)=>{s=s.concat(Uf(t.serverSyncTree_,i,r));const o=rP(t,i);Xd(t,o)}),t.onDisconnect_=Hv(),Mi(t.eventQueue_,Je(),s)}function DCe(t,e,n){let s;Le(e._path)===".info"?s=XC(t.infoSyncTree_,e,n):s=XC(t.serverSyncTree_,e,n),Q6(t.eventQueue_,e._path,s)}function n8(t,e,n){let s;Le(e._path)===".info"?s=Jv(t.infoSyncTree_,e,n):s=Jv(t.serverSyncTree_,e,n),Q6(t.eventQueue_,e._path,s)}function LCe(t){t.persistentConnection_&&t.persistentConnection_.interrupt(ICe)}function zf(t,...e){let n="";t.persistentConnection_&&(n=t.persistentConnection_.id+":"),In(n,...e)}function ZC(t,e,n,s){e&&mu(()=>{if(n==="ok")e(null);else{const i=(n||"error").toUpperCase();let r=i;s&&(r+=": "+s);const o=new Error(r);o.code=i,e(o)}})}function s8(t,e,n){return VI(t.serverSyncTree_,e,n)||Te.EMPTY_NODE}function iP(t,e=t.transactionQueueTree_){if(e||LS(t,e),vu(e)){const n=r8(t,e);re(n.length>0,"Sending zero length transaction queue"),n.every(i=>i.status===0)&&FCe(t,$f(e),n)}else K6(e)&&RS(e,n=>{iP(t,n)})}function FCe(t,e,n){const s=n.map(d=>d.currentWriteId),i=s8(t,e,s);let r=i;const o=i.hash();for(let d=0;d<n.length;d++){const u=n[d];re(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=us(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}const l=r.val(!0),c=e;t.server_.put(c.toString(),l,d=>{zf(t,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const h=[];for(let p=0;p<n.length;p++)n[p].status=2,u=u.concat(wa(t.serverSyncTree_,n[p].currentWriteId)),n[p].onComplete&&h.push(()=>n[p].onComplete(null,!0,n[p].currentOutputSnapshotResolved)),n[p].unwatcher();LS(t,eP(t.transactionQueueTree_,e)),iP(t,t.transactionQueueTree_),Mi(t.eventQueue_,e,u);for(let p=0;p<h.length;p++)mu(h[p])}else{if(d==="datastale")for(let h=0;h<n.length;h++)n[h].status===3?n[h].status=4:n[h].status=0;else{ps("transaction at "+c.toString()+" failed: "+d);for(let h=0;h<n.length;h++)n[h].status=4,n[h].abortReason=d}Xd(t,e)}},o)}function Xd(t,e){const n=i8(t,e),s=$f(n),i=r8(t,n);return BCe(t,i,s),s}function BCe(t,e,n){if(e.length===0)return;const s=[];let i=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=us(n,c.path);let u=!1,h;if(re(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,i=i.concat(wa(t.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=PCe)u=!0,h="maxretry",i=i.concat(wa(t.serverSyncTree_,c.currentWriteId,!0));else{const p=s8(t,c.path,o);c.currentInputSnapshot=p;const f=e[l].update(p.val());if(f!==void 0){MS("transaction failed: Data returned ",f,c.path);let g=en(f);typeof f=="object"&&f!=null&&qr(f,".priority")||(g=g.updatePriority(p.getPriority()));const x=c.currentWriteId,m=DS(t),v=G6(g,p,m);c.currentOutputSnapshotRaw=g,c.currentOutputSnapshotResolved=v,c.currentWriteId=sP(t),o.splice(o.indexOf(x),1),i=i.concat(B6(t.serverSyncTree_,c.path,v,c.currentWriteId,c.applyLocally)),i=i.concat(wa(t.serverSyncTree_,x,!0))}else u=!0,h="nodata",i=i.concat(wa(t.serverSyncTree_,c.currentWriteId,!0))}Mi(t.eventQueue_,n,i),i=[],u&&(e[l].status=2,function(p){setTimeout(p,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(h),!1,null))))}LS(t,t.transactionQueueTree_);for(let l=0;l<s.length;l++)mu(s[l]);iP(t,t.transactionQueueTree_)}function i8(t,e){let n,s=t.transactionQueueTree_;for(n=Le(e);n!==null&&vu(s)===void 0;)s=eP(s,n),e=gt(e),n=Le(e);return s}function r8(t,e){const n=[];return o8(t,e,n),n.sort((s,i)=>s.order-i.order),n}function o8(t,e,n){const s=vu(e);if(s)for(let i=0;i<s.length;i++)n.push(s[i]);RS(e,i=>{o8(t,i,n)})}function LS(t,e){const n=vu(e);if(n){let s=0;for(let i=0;i<n.length;i++)n[i].status!==2&&(n[s]=n[i],s++);n.length=s,V6(e,n.length>0?n:void 0)}RS(e,s=>{LS(t,s)})}function rP(t,e){const n=$f(i8(t,e)),s=eP(t.transactionQueueTree_,e);return gCe(s,i=>{Yw(t,i)}),Yw(t,s),Y6(s,i=>{Yw(t,i)}),n}function Yw(t,e){const n=vu(e);if(n){const s=[];let i=[],r=-1;for(let o=0;o<n.length;o++)n[o].status===3||(n[o].status===1?(re(r===o-1,"All SENT items should be at beginning of queue."),r=o,n[o].status=3,n[o].abortReason="set"):(re(n[o].status===0,"Unexpected transaction status in abort"),n[o].unwatcher(),i=i.concat(wa(t.serverSyncTree_,n[o].currentWriteId,!0)),n[o].onComplete&&s.push(n[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?V6(e,void 0):n.length=r+1,Mi(t.eventQueue_,$f(e),i);for(let o=0;o<s.length;o++)mu(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UCe(t){let e="";const n=t.split("/");for(let s=0;s<n.length;s++)if(n[s].length>0){let i=n[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function $Ce(t){const e={};t.charAt(0)==="?"&&(t=t.substring(1));for(const n of t.split("&")){if(n.length===0)continue;const s=n.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):ps(`Invalid query segment '${n}' in query '${t}'`)}return e}const gM=function(t,e){const n=zCe(t),s=n.namespace;n.domain==="firebase.com"&&Fo(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&n.domain!=="localhost"&&Fo("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||Jwe();const i=n.scheme==="ws"||n.scheme==="wss";return{repoInfo:new a6(n.host,n.secure,s,i,e,"",s!==n.subdomain),path:new ct(n.pathString)}},zCe=function(t){let e="",n="",s="",i="",r="",o=!0,l="https",c=443;if(typeof t=="string"){let d=t.indexOf("//");d>=0&&(l=t.substring(0,d-1),t=t.substring(d+2));let u=t.indexOf("/");u===-1&&(u=t.length);let h=t.indexOf("?");h===-1&&(h=t.length),e=t.substring(0,Math.min(u,h)),u<h&&(i=UCe(t.substring(u,h)));const p=$Ce(t.substring(Math.min(t.length,h)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const f=e.slice(0,d);if(f.toLowerCase()==="localhost")n="localhost";else if(f.split(".").length<=2)n=f;else{const g=e.indexOf(".");s=e.substring(0,g).toLowerCase(),n=e.substring(g+1),r=s}"ns"in p&&(r=p.ns)}return{host:e,port:c,domain:n,subdomain:s,secure:o,scheme:l,pathString:i,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mM="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",WCe=function(){let t=0;const e=[];return function(n){const s=n===t;t=n;let i;const r=new Array(8);for(i=7;i>=0;i--)r[i]=mM.charAt(n%64),n=Math.floor(n/64);re(n===0,"Cannot push at time == 0");let o=r.join("");if(s){for(i=11;i>=0&&e[i]===63;i--)e[i]=0;e[i]++}else for(i=0;i<12;i++)e[i]=Math.floor(Math.random()*64);for(i=0;i<12;i++)o+=mM.charAt(e[i]);return re(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HCe{constructor(e,n,s,i){this.eventType=e,this.eventRegistration=n,this.snapshot=s,this.prevName=i}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+tn(this.snapshot.exportVal())}}class GCe{constructor(e,n,s){this.eventRegistration=e,this.error=n,this.path=s}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a8{constructor(e,n){this.snapshotCallback=e,this.cancelCallback=n}onValue(e,n){this.snapshotCallback.call(null,e,n)}onCancel(e){return re(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(e,n,s,i){this._repo=e,this._path=n,this._queryParams=s,this._orderByCalled=i}get key(){return We(this._path)?null:RI(this._path)}get ref(){return new Yo(this._repo,this._path)}get _queryIdentifier(){const e=tM(this._queryParams),n=kI(e);return n==="{}"?"default":n}get _queryObject(){return tM(this._queryParams)}isEqual(e){if(e=is(e),!(e instanceof oP))return!1;const n=this._repo===e._repo,s=MI(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return n&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+O0e(this._path)}}class Yo extends oP{constructor(e,n){super(e,n,new FI,!1)}get parent(){const e=m6(this._path);return e===null?null:new Yo(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class Kp{constructor(e,n,s){this._node=e,this.ref=n,this._index=s}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const n=new ct(e),s=Yp(this.ref,e);return new Kp(this._node.getChild(n),s,Wt)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(s,i)=>e(new Kp(i,Yp(this.ref,s),Wt)))}hasChild(e){const n=new ct(e);return!this._node.getChild(n).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function th(t,e){return t=is(t),t._checkNotDeleted("ref"),e!==void 0?Yp(t._root,e):t._root}function Yp(t,e){return t=is(t),Le(t._path)===null?_Ce("child","path",e):Z6("child","path",e),new Yo(t._repo,zt(t._path,e))}function VCe(t,e){t=is(t),J6("push",t._path),q6("push",e,t._path,!0);const n=t8(t._repo),s=WCe(n),i=Yp(t,s),r=Yp(t,s);let o;return o=Promise.resolve(r),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}function yM(t,e){t=is(t),J6("set",t._path),q6("set",e,t._path,!1);const n=new Af;return RCe(t._repo,t._path,e,null,n.wrapCallback(()=>{})),n.promise}function KCe(t,e){wCe("update",e,t._path);const n=new Af;return MCe(t._repo,t._path,e,n.wrapCallback(()=>{})),n.promise}function YCe(t){t=is(t);const e=new a8(()=>{}),n=new FS(e);return ACe(t._repo,t,n).then(s=>new Kp(s,new Yo(t._repo,t._path),t._queryParams.getIndex()))}class FS{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,n){const s=n._queryParams.getIndex();return new HCe("value",this,new Kp(e.snapshotNode,new Yo(n._repo,n._path),s))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,n){return this.callbackContext.hasCancelCallback?new GCe(this,e,n):null}matches(e){return e instanceof FS?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function XCe(t,e,n,s,i){const r=new a8(n,void 0),o=new FS(r);return DCe(t._repo,t,o),()=>n8(t._repo,t,o)}function qCe(t,e,n,s){return XCe(t,"value",e)}function ZCe(t,e,n){n8(t._repo,t,null)}K_e(Yo);J_e(Yo);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JCe="FIREBASE_DATABASE_EMULATOR_HOST",JC={};let QCe=!1;function eEe(t,e,n,s){t.repoInfo_=new a6(`${e}:${n}`,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams,!0),s&&(t.authTokenProvider_=s)}function tEe(t,e,n,s,i){let r=s||t.options.databaseURL;r===void 0&&(t.options.projectId||Fo("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),In("Using default host for project ",t.options.projectId),r=`${t.options.projectId}-default-rtdb.firebaseio.com`);let o=gM(r,i),l=o.repoInfo,c;typeof process<"u"&&LR&&(c=LR[JCe]),c?(r=`http://${c}?ns=${l.namespace}`,o=gM(r,i),l=o.repoInfo):o.repoInfo.secure;const d=new c0e(t.name,t.options,e);CCe("Invalid Firebase Database URL",o),We(o.path)||Fo("Database URL must point to the root of a Firebase Database (not including a child path).");const u=sEe(l,t,d,new l0e(t.name,n));return new iEe(u,t)}function nEe(t,e){const n=JC[e];(!n||n[t.key]!==t)&&Fo(`Database ${e}(${t.repoInfo_}) has already been deleted.`),LCe(t),delete n[t.key]}function sEe(t,e,n,s){let i=JC[e.name];i||(i={},JC[e.name]=i);let r=i[t.toURLString()];return r&&Fo("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new kCe(t,QCe,n,s),i[t.toURLString()]=r,r}class iEe{constructor(e,n){this._repoInternal=e,this.app=n,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(jCe(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Yo(this._repo,Je())),this._rootInternal}_delete(){return this._rootInternal!==null&&(nEe(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Fo("Cannot call "+e+" on a deleted database.")}}function rEe(t=hz(),e){const n=yI(t,"database").getImmediate({identifier:e});if(!n._instanceStarted){const s=yxe("database");s&&oEe(n,...s)}return n}function oEe(t,e,n,s={}){t=is(t),t._checkNotDeleted("useEmulator"),t._instanceStarted&&Fo("Cannot call useEmulator() after instance has already been initialized.");const i=t._repoInternal;let r;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Fo('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new py(py.OWNER);else if(s.mockUserToken){const o=typeof s.mockUserToken=="string"?s.mockUserToken:vxe(s.mockUserToken,t.app.options.projectId);r=new py(o)}eEe(i,e,n,r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aEe(t){Vwe(fu),Wd(new nc("database",(e,{instanceIdentifier:n})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return tEe(s,i,r,n)},"PUBLIC").setMultipleInstances(!0)),Da(FR,BR,t),Da(FR,BR,"esm2017")}Eo.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)};Eo.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};aEe();const lEe={apiKey:"AIzaSyDyWiRgNusHQ38mNbusKgWHmXYYOfa5gjM",authDomain:"panda-factory.firebaseapp.com",databaseURL:"https://panda-factory-default-rtdb.firebaseio.com",projectId:"panda-factory",storageBucket:"panda-factory.firebasestorage.app",messagingSenderId:"980998365446",appId:"1:980998365446:web:90200c58606a6238eebe87"};let fy,wn,mi;try{fy=uz(lEe),wn=Hwe(fy),mi=rEe(fy),console.log(" Firebase initialized")}catch(t){console.warn("Firebase initialization failed, using mock mode:",t.message)}const cEe=new lo,_r={async signInWithGoogle(){if(!wn)throw new Error("Firebase not initialized");return(await Qbe(wn,cEe)).user},async signInWithEmail(t,e){if(!wn)throw new Error("Firebase not initialized");return(await kbe(wn,t,e)).user},async signOut(){if(!wn)throw new Error("Firebase not initialized");await Rbe(wn)},getCurrentUser(){return(wn==null?void 0:wn.currentUser)||null},async getToken(){return wn!=null&&wn.currentUser?wn.currentUser.getIdToken():null},onAuthStateChanged(t){return wn?Abe(wn,t):()=>{}}},jr={async get(t){if(!mi)throw new Error("Firebase not initialized");return(await YCe(th(mi,t))).val()},async set(t,e){if(!mi)throw new Error("Firebase not initialized");await yM(th(mi,t),e)},subscribe(t,e){if(!mi)return()=>{};const n=th(mi,t);return qCe(n,s=>{e(s.val())}),()=>ZCe(n)},async push(t,e){if(!mi)throw new Error("Firebase not initialized");const n=VCe(th(mi,t));return await yM(n,e),n.key},async update(t,e){if(!mi)throw new Error("Firebase not initialized");await KCe(th(mi,t),e)},async getUserStatus(t){return this.get(`users/${t}/status`)},async setUserOnline(t){return this.set(`users/${t}/status`,{online:!0,lastSeen:Date.now()})},async getHealth(){return this.get("system/health")},async getFounderMetrics(){const[t,e,n,s]=await Promise.all([this.get("metrics/treasury"),this.get("metrics/users"),this.get("metrics/usage"),this.get("metrics/errors")]);return{treasury:t,users:e,usage:n,errors:s}},async getWalletBalance(t){return await this.get(`pf_cells/${t}/wallet/balance`)||0},async getWalletHistory(t){const e=await this.get(`pf_cells/${t}/wallet/transactions`);return e?Object.entries(e).map(([n,s])=>({id:n,...s})).reverse():[]},subscribeWalletBalance(t,e){return this.subscribe(`pf_cells/${t}/wallet/balance`,e)},async initWallet(t){await this.get(`pf_cells/${t}/wallet`)||await this.set(`pf_cells/${t}/wallet`,{balance:0,currency:"PC",createdAt:Date.now()})}},dEe={firebaseAuth:_r,firebaseDB:jr},Xw=Object.freeze(Object.defineProperty({__proto__:null,get app(){return fy},get auth(){return wn},get database(){return mi},default:dEe,firebaseAuth:_r,firebaseDB:jr},Symbol.toStringTag,{value:"Module"})),Xp={FOUNDER:"founder",DEV:"dev",USER:"user"},od={GOOGLE:"google",EMAIL:"email",LOGINGATE:"logingate"},uEe=["lucassvalerio@gmail.com"],hEe={"user@panda.com":{uid:"user-demo",email:"user@panda.com",displayName:"Demo User",userType:Xp.USER,pcBalance:100}};function pEe(t){var s,i;const e=t.email||"",n=uEe.some(r=>r.toLowerCase()===e.toLowerCase());return{uid:t.uid,email:e,displayName:t.displayName||e.split("@")[0],photoURL:t.photoURL||null,userType:n?Xp.FOUNDER:Xp.USER,authMethod:((i=(s=t.providerData)==null?void 0:s[0])==null?void 0:i.providerId)==="google.com"?od.GOOGLE:od.EMAIL,founderPercent:n?5:void 0}}const l8=S.createContext(null);function fEe({children:t}){const[e,n]=S.useState(null),[s,i]=S.useState(!0),[r,o]=S.useState(null),[l,c]=S.useState(!1);S.useEffect(()=>{var m;window.__pandaFirebaseAuth=_r,typeof Panda<"u"&&((m=Panda.Wallet)!=null&&m.bindDB)&&Panda.Wallet.bindDB(jr)},[]),S.useEffect(()=>{let m=null,v=!1;const w=setTimeout(()=>{if(!v){console.warn("[useAuth] Firebase auth timeout  falling back to mock mode"),v=!0,c(!1);const _=localStorage.getItem("panda_user");if(_)try{const C=JSON.parse(_);C.authMethod===od.LOGINGATE&&n(C)}catch{localStorage.removeItem("panda_user")}i(!1)}},5e3);try{m=_r.onAuthStateChanged(_=>{var C,I;if(v=!0,clearTimeout(w),c(!0),_){const T=pEe(_);n(T),localStorage.setItem("panda_user",JSON.stringify(T)),typeof Panda<"u"&&((C=Panda.Auth)!=null&&C.syncUser)&&Panda.Auth.syncUser(T),typeof Panda<"u"&&((I=Panda.Wallet)!=null&&I.init)&&Panda.Wallet.init(T.uid).catch(P=>console.warn("Wallet init:",P.message))}else{const T=localStorage.getItem("panda_user");if(T)try{const P=JSON.parse(T);P.authMethod===od.LOGINGATE?n(P):(n(null),localStorage.removeItem("panda_user"))}catch{localStorage.removeItem("panda_user"),n(null)}else n(null)}i(!1)})}catch(_){console.warn("[useAuth] Firebase not available, using mock mode:",_.message),v=!0,clearTimeout(w),c(!1);const C=localStorage.getItem("panda_user");if(C)try{n(JSON.parse(C))}catch{localStorage.removeItem("panda_user")}i(!1)}return()=>{clearTimeout(w),m&&m()}},[]);const d=S.useCallback(async()=>{var m;i(!0),o(null);try{const v=new Promise((_,C)=>setTimeout(()=>C(new Error("POPUP_TIMEOUT")),15e3)),w=await Promise.race([_r.signInWithGoogle(),v]);console.log(" Google login success:",w.email)}catch(v){!l||(m=v.message)!=null&&m.includes("not initialized")?o("Firebase no configurado. Use as credenciais demo abaixo."):v.message==="POPUP_TIMEOUT"?o("Popup de login bloqueado ou sem resposta. Verifique o bloqueador de popup."):v.code==="auth/popup-closed-by-user"?o(null):v.code==="auth/unauthorized-domain"?o("Domnio no autorizado no Firebase. Adicione localhost em Firebase Console > Authentication > Settings."):v.code==="auth/api-key-not-valid.-please-pass-a-valid-api-key."?o("API Key do Firebase invlida. Configure o arquivo .env com as credenciais corretas."):v.code==="auth/popup-blocked"?o("Popup bloqueado pelo navegador. Permita popups para este site."):o(v.message||"Google login falhou")}finally{i(!1)}},[l]),u=S.useCallback(async(m,v)=>{i(!0),o(null);try{if(l){const w=await _r.signInWithEmail(m,v);console.log(" Email login success:",w.email)}else{await new Promise(C=>setTimeout(C,500));const w=hEe[m.toLowerCase()];if(!w)throw new Error("User not found");if(v.length<4)throw new Error("Invalid password");const _={...w,authMethod:od.EMAIL};n(_),localStorage.setItem("panda_user",JSON.stringify(_))}}catch(w){const _=w.code==="auth/invalid-credential"?"Invalid email or password":w.code==="auth/user-not-found"?"No account found with this email":w.message||"Login failed";throw o(_),w}finally{i(!1)}},[l]),h=S.useCallback(async m=>{const v={...m,authMethod:od.LOGINGATE};n(v),localStorage.setItem("panda_user",JSON.stringify(v))},[]),p=S.useCallback(async()=>{var m,v;try{try{await _r.signOut()}catch{}n(null),localStorage.removeItem("panda_user"),sessionStorage.removeItem("panda_auth"),sessionStorage.removeItem("panda_auth_token"),typeof Panda<"u"&&((m=Panda.Auth)==null||m.syncUser(null),(v=Panda.Wallet)==null||v.destroy())}catch(w){o(w.message)}},[]),f=(e==null?void 0:e.userType)===Xp.FOUNDER,g=(e==null?void 0:e.userType)===Xp.DEV||f,x={user:e,isLoading:s,error:r,isAuthenticated:!!e,isFounder:f,isDev:g,firebaseReady:l,loginWithGoogle:d,loginWithEmail:u,loginWithGate:h,logout:p,clearError:()=>o(null)};return a.jsx(l8.Provider,{value:x,children:t})}function BS(){const t=S.useContext(l8);if(!t)throw new Error("useAuth must be used within AuthProvider");return t}function gEe({onFullscreen:t,onSettingsClick:e,onStoreClick:n,onFounderClick:s,onMiningClick:i,onDefendClick:r,onTreasuryClick:o,onNotificationsClick:l,onPinChange:c,isFounder:d=!1}){const{t:u}=hI(),{logout:h}=BS(),[p,f]=S.useState(""),[g,y]=S.useState(100),[x,m]=S.useState(()=>{try{const H=JSON.parse(localStorage.getItem("panda_user"));return(H==null?void 0:H.displayName)||"GUEST"}catch{return"GUEST"}}),[v]=S.useState(()=>new Date),[w,_]=S.useState("00:00"),[C,I]=S.useState(()=>localStorage.getItem("panda_statusbar_pinned")!=="false"),[T,P]=S.useState(!1),[k,N]=S.useState(()=>{try{return JSON.parse(localStorage.getItem("panda_white_label")||"null")}catch{return null}});S.useEffect(()=>{const H=()=>{try{N(JSON.parse(localStorage.getItem("panda_white_label")||"null"))}catch{}};return window.addEventListener("storage",H),window.addEventListener("panda-whitelabel-change",H),()=>{window.removeEventListener("storage",H),window.removeEventListener("panda-whitelabel-change",H)}},[]);const{services:O}=Q4("jam"),R={};O.forEach(H=>{R[H.name]=H.isHealthy?"online":H.status==="unavailable"?"unavailable":H.status==="offline"?"offline":"warning"});const[j,A]=S.useState(()=>localStorage.getItem("panda_theme")!=="light");S.useEffect(()=>{document.body.classList.toggle("light-mode",!j),localStorage.setItem("panda_theme",j?"dark":"light")},[j]);const B=()=>A(!j);S.useEffect(()=>{localStorage.setItem("panda_statusbar_pinned",String(C)),c&&c(C)},[C]),S.useEffect(()=>{const H=()=>{const V=new Date;f(V.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}));const ee=Math.floor((V-v)/1e3),Q=Math.floor(ee/3600),ae=Math.floor(ee%3600/60),ue=ee%60,he=ee/3600;y(Math.max(10,Math.round(100-he/8*50))),Q>0?_(`${Q}h ${ae.toString().padStart(2,"0")}m`):_(`${ae.toString().padStart(2,"0")}:${ue.toString().padStart(2,"0")}`)};H();const q=setInterval(H,1e3);return()=>clearInterval(q)},[v]);const L=125.6,$=L-g/100*L,M=[{id:"firebase",label:"FB",title:"FIREBASE REALTIME"},{id:"gas",label:"GA",title:"GOOGLE APPS SCRIPT"},{id:"rust",label:"RU",title:"RUST AGENT"},{id:"mcp",label:"AI",title:"AI / MCP BRIDGE"},{id:"gpu",label:"GP",title:"LOCAL GPU"}],D=(k==null?void 0:k.brandName)||"PANDA FABRICS",U=(k==null?void 0:k.logoUrl)||"./panda-icon.png",z=C||T;return a.jsxs(a.Fragment,{children:[a.jsxs("header",{className:`pf-status-bar ${j?"dark":"light"}`,onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),role:"banner","aria-label":"Panda Fabrics status bar",style:{display:z?"flex":"none"},children:[a.jsxs("div",{className:"pf-brand-container",onClick:n,title:u("statusBar.openStore","OPEN STORE"),children:[a.jsx("img",{src:U,alt:D,className:"pf-brand-logo"}),a.jsx("span",{className:"pf-brand-text",children:D})]}),a.jsxs("div",{className:"pf-status-group",children:[a.jsx("div",{className:"pf-status-pills",role:"status","aria-live":"polite","aria-label":"Service status",children:M.map(H=>a.jsxs("div",{className:"pf-status-pill",title:`${H.title}  ${(R[H.id]||"unknown").toUpperCase()}`,"aria-label":`${H.title}: ${(R[H.id]||"unknown").toUpperCase()}`,style:{cursor:"pointer"},onClick:()=>{const q=R[H.id]||"unknown";alert(`${q==="online"?"":q==="warning"?"":q==="offline"?"":""} ${H.title}

Status: ${q.toUpperCase()}`)},children:[a.jsx("span",{className:"pf-status-label",children:H.label}),a.jsx("span",{className:`pf-status-dot ${R[H.id]}`,"aria-hidden":"true"})]},H.id))}),a.jsx("button",{className:"pf-theme-toggle pf-header-btn",onClick:B,title:j?u("statusBar.lightMode","LIGHT MODE"):u("statusBar.darkMode","DARK MODE"),"aria-label":j?u("statusBar.lightMode","LIGHT MODE"):u("statusBar.darkMode","DARK MODE"),children:j?"":""})]}),a.jsxs("div",{className:"pf-header-controls",children:[a.jsx(lxe,{}),a.jsxs("div",{className:"pf-arc-energy",title:`${g}% ${u("statusBar.energy","ENERGY")}`,"aria-label":`${u("statusBar.session","SESSION")} ${u("statusBar.energy","ENERGY")}: ${g}%`,children:[a.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 48 48",children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"energyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[a.jsx("stop",{offset:"0%",stopColor:"#10b981"}),a.jsx("stop",{offset:"50%",stopColor:"#f59e0b"}),a.jsx("stop",{offset:"100%",stopColor:"#ef4444"})]})}),a.jsx("circle",{className:"pf-arc-bg",cx:"24",cy:"24",r:"20"}),a.jsx("circle",{className:"pf-arc-fill",cx:"24",cy:"24",r:"20",stroke:"url(#energyGradient)",strokeDasharray:L,strokeDashoffset:$})]}),a.jsxs("span",{className:"pf-arc-text",children:[g,"%"]})]}),a.jsxs("div",{className:"pf-treasury",title:u("statusBar.treasury","TREASURY  OPEN PAT COUNCIL"),onClick:o,style:{cursor:o?"pointer":"default"},children:[a.jsx("span",{children:""}),a.jsxs("span",{className:"pf-treasury-score",children:[O.length>0?Math.round(O.filter(H=>H.isHealthy).length/O.length*100):0,"%"]})]}),a.jsxs("div",{className:"pf-user-status",title:`${u("statusBar.session","SESSION")}: ${w}`,children:[a.jsx("span",{className:"pf-user-avatar",children:""}),a.jsxs("div",{className:"pf-user-info",children:[a.jsx("span",{className:"pf-user-name",children:x}),a.jsx("span",{className:"pf-session-time",children:w})]})]}),a.jsx("button",{className:"pf-header-btn",onClick:l,title:u("statusBar.notifications","NOTIFICATIONS"),"aria-label":u("statusBar.notifications","NOTIFICATIONS"),children:""}),a.jsx("button",{className:"pf-header-btn",onClick:i,title:u("statusBar.mining","MY MINING"),"aria-label":u("statusBar.mining","MY MINING"),children:""}),a.jsx("button",{className:"pf-header-btn",onClick:r,title:u("statusBar.defend","PANDA DEFEND"),"aria-label":u("statusBar.defend","PANDA DEFEND"),children:""}),(d||s)&&a.jsx("button",{className:"pf-header-btn founder-btn",onClick:s,title:u("statusBar.founder","FOUNDER DASHBOARD"),children:""}),a.jsx("button",{className:"pf-header-btn",title:u("statusBar.settings","SETTINGS"),onClick:e,"aria-label":u("statusBar.settings","SETTINGS"),children:""}),a.jsx("button",{className:"pf-header-btn",title:u("statusBar.logout","LOGOUT"),"aria-label":u("statusBar.logoutConfirm","Log out of Panda Fabrics?"),onClick:async()=>{if(window.confirm(u("statusBar.logoutConfirm","Log out of Panda Fabrics?"))){try{await h()}catch(H){console.warn("Firebase signOut error:",H)}sessionStorage.removeItem("panda_auth"),sessionStorage.removeItem("panda_auth_token"),localStorage.removeItem("panda_user"),localStorage.removeItem("panda_token"),localStorage.removeItem("panda_founder_mode"),localStorage.removeItem("pf_chat_welcomed"),localStorage.removeItem("panda_onboarding_complete"),window.location.reload()}},style:{color:"#ef4444"},children:""}),a.jsx("span",{className:"pf-clock",children:p}),a.jsx("button",{className:"pf-header-btn pf-pin-btn",onClick:()=>I(!C),title:C?u("statusBar.unpinBar","UNPIN BAR"):u("statusBar.pinBar","PIN BAR"),"aria-label":C?u("statusBar.unpinBar","UNPIN BAR"):u("statusBar.pinBar","PIN BAR"),"aria-pressed":C,style:{opacity:C?1:.4,fontSize:12,marginLeft:4,transition:"opacity 0.2s ease"},children:""})]})]}),!z&&a.jsx("div",{onMouseEnter:()=>P(!0),style:{position:"fixed",top:0,left:0,right:0,height:6,zIndex:5001,cursor:"pointer",background:"linear-gradient(180deg, rgba(10,10,26,0.5) 0%, transparent 100%)"}})]})}function mEe({isOpen:t,onClose:e,item:n,pcPackage:s,userPcBalance:i=0,userTier:r="free",onPurchaseComplete:o,processPayment:l,purchasePackage:c,isProcessing:d}){const[u,h]=S.useState("usd"),[p,f]=S.useState(!1),[g,y]=S.useState(null),x=d||p,v={free:0,user:.05,dev:.1,pro:.15,beta_founder:.3}[r]||0,w=(n==null?void 0:n.priceUSD)||((n==null?void 0:n.price)||0)*.01,_=(n==null?void 0:n.price)||Math.ceil(w*100),C=Math.ceil(_*(1-v)),I=i>=C,T=(s==null?void 0:s.usd)||0,P=(s==null?void 0:s.pc)||0,k=!!s,N=k?`${P.toLocaleString()} Panda Coins`:n==null?void 0:n.name,O=k?"":n==null?void 0:n.icon,R=k?`${s.badge} ${s.label} Package  ${P.toLocaleString()} PC`:n==null?void 0:n.description,j=async()=>{f(!0),y(null);try{if(k){if(c){const A=await c(s);if(A.redirecting)return;if(A.mock&&(o==null||o({type:"pc_purchase",package:s,mock:!0}),e()),!A.success)throw new Error(A.error)}}else if(u==="pc"){if(!I)throw new Error("Saldo de PC insuficiente!");if(l){const A=await l(n,"pc");if(!A.success)throw new Error(A.error);o==null||o({type:"store_purchase",item:n,paymentMethod:"pc",transaction:A.transaction}),e()}}else if(l){const A=await l(n,"usd");if(A.redirecting)return;if(A.mock&&(o==null||o({type:"store_purchase",item:n,paymentMethod:"usd",mock:!0}),e()),!A.success)throw new Error(A.error)}}catch(A){console.error("Checkout error:",A),y(A.message)}finally{f(!1)}};return!t||!n&&!s?null:a.jsx("div",{className:"checkout-overlay",onClick:e,children:a.jsxs("div",{className:"checkout-modal",onClick:A=>A.stopPropagation(),children:[a.jsxs("header",{className:"checkout-header",children:[a.jsx("h2",{children:" Checkout"}),a.jsx("button",{className:"checkout-close",onClick:e,children:""})]}),a.jsxs("div",{className:"checkout-product",children:[a.jsx("span",{className:"product-icon",children:O}),a.jsxs("div",{className:"product-info",children:[a.jsx("h3",{className:"product-name",children:N}),a.jsx("p",{className:"product-desc",children:R}),(n==null?void 0:n.author)&&a.jsxs("span",{className:"product-author",children:["por ",n.author]})]})]}),g&&a.jsx("div",{className:"checkout-error",children:a.jsxs("span",{children:[" ",g]})}),a.jsxs("div",{className:"checkout-pricing",children:[a.jsxs("div",{className:"price-main",children:[a.jsx("span",{className:"price-currency",children:"$"}),a.jsx("span",{className:"price-amount",children:k?T.toFixed(2):w.toFixed(2)}),a.jsx("span",{className:"price-label",children:"USD"})]}),!k&&a.jsxs("div",{className:"price-equivalent",children:["= ",_.toLocaleString()," PC",v>0&&u==="pc"&&a.jsxs("span",{className:"price-discount",children:["(",Math.round(v*100),"% desconto ="," ",C.toLocaleString()," PC)"]})]}),k&&s.discount>0&&a.jsx("div",{className:"price-equivalent",children:a.jsxs("span",{className:"price-discount",children:[Math.round(s.discount*100),"% bonus includo"]})})]}),!k&&a.jsxs("div",{className:"checkout-methods",children:[a.jsx("h4",{children:"Mtodo de Pagamento"}),a.jsxs("label",{className:`method-option ${u==="usd"?"selected":""}`,children:[a.jsx("input",{type:"radio",name:"payment",value:"usd",checked:u==="usd",onChange:()=>h("usd")}),a.jsx("span",{className:"method-icon",children:""}),a.jsxs("div",{className:"method-info",children:[a.jsx("span",{className:"method-name",children:"USD (Carto/PIX)"}),a.jsxs("span",{className:"method-value",children:["$",w.toFixed(2)]})]})]}),a.jsxs("label",{className:`method-option ${u==="pc"?"selected":""} ${I?"":"disabled"}`,children:[a.jsx("input",{type:"radio",name:"payment",value:"pc",checked:u==="pc",onChange:()=>I&&h("pc"),disabled:!I}),a.jsx("span",{className:"method-icon",children:""}),a.jsxs("div",{className:"method-info",children:[a.jsx("span",{className:"method-name",children:"Panda Coins (PC)"}),a.jsxs("span",{className:"method-value",children:[C.toLocaleString()," PC",v>0&&a.jsxs("span",{className:"badge-discount",children:["-",Math.round(v*100),"%"]})]})]}),!I&&a.jsxs("span",{className:"method-insufficient",children:["Saldo: ",i.toLocaleString()," PC"]})]})]}),!k&&a.jsxs("div",{className:"checkout-balance",children:[a.jsx("span",{children:"Seu saldo:"}),a.jsxs("span",{className:"balance-value",children:[i.toLocaleString()," PC"]})]}),k&&a.jsxs("div",{className:"checkout-methods",children:[a.jsx("h4",{children:"Pagamento via Stripe"}),a.jsxs("div",{className:"method-option selected",children:[a.jsx("span",{className:"method-icon",children:""}),a.jsxs("div",{className:"method-info",children:[a.jsx("span",{className:"method-name",children:"Carto de Crdito / Pix"}),a.jsxs("span",{className:"method-value",children:["$",T.toFixed(2)," USD"]})]})]}),a.jsx("p",{className:"checkout-stripe-note",children:" Voc ser redirecionado para o checkout seguro do Stripe"})]}),a.jsxs("div",{className:"checkout-actions",children:[a.jsx("button",{className:"btn-cancel",onClick:e,disabled:x,children:"Cancelar"}),a.jsx("button",{className:"btn-confirm",onClick:j,disabled:x||!k&&u==="pc"&&!I,children:x?" Processando...":k?`Comprar ${P.toLocaleString()} PC  $${T.toFixed(2)}`:u==="usd"?`Pagar $${w.toFixed(2)}`:`Pagar ${C.toLocaleString()} PC`})]}),a.jsxs("footer",{className:"checkout-footer",children:[a.jsx("span",{children:" Pagamento seguro via Stripe"}),a.jsx("span",{children:" Refund em at 7 dias"})]})]})})}const yEe=[{type:"youtube",icon:"",label:"YouTube",match:/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/,toEmbed:t=>`https://www.youtube.com/embed/${t}`,isIframe:!0},{type:"instagram",icon:"",label:"Instagram",match:/instagram\.com\/(?:p|reel)\/([a-zA-Z0-9_-]+)/,toEmbed:t=>`https://www.instagram.com/p/${t}/embed`,isIframe:!0},{type:"tiktok",icon:"",label:"TikTok",match:/tiktok\.com\/@[^/]+\/video\/(\d+)/,toEmbed:t=>`https://www.tiktok.com/embed/v2/${t}`,isIframe:!0},{type:"twitter",icon:"",label:"Twitter / X",match:/(?:twitter\.com|x\.com)\/\w+\/status\/(\d+)/,toEmbed:null,isIframe:!1},{type:"linkedin",icon:"",label:"LinkedIn",match:/linkedin\.com/,toEmbed:null,isIframe:!1},{type:"github",icon:"",label:"GitHub",match:/github\.com\/([^/]+\/[^/]+)/,toEmbed:null,isIframe:!1},{type:"telegram",icon:"",label:"Telegram",match:/t\.me\//,toEmbed:null,isIframe:!1},{type:"whatsapp",icon:"",label:"WhatsApp",match:/wa\.me\//,toEmbed:null,isIframe:!1}];function vEe(t){const e=typeof t=="string"?t:t.url,n=typeof t=="object"?t.type:null;for(const s of yEe){if(n&&n===s.type){const r=e.match(s.match);return{...s,url:e,id:(r==null?void 0:r[1])||null}}const i=e.match(s.match);if(i)return{...s,url:e,id:i[1]||null}}return{type:"external",icon:"",label:new URL(e).hostname.replace("www.",""),url:e,id:null,isIframe:!1}}function xEe({link:t}){const e=vEe(t);return e.isIframe&&e.toEmbed&&e.id?a.jsxs("div",{className:"pdp-embed-card pdp-embed-iframe",children:[a.jsx("iframe",{src:e.toEmbed(e.id),title:e.label,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,loading:"lazy"}),a.jsxs("div",{className:"pdp-embed-label",children:[a.jsx("span",{className:"pdp-embed-icon",children:e.icon}),a.jsx("span",{children:e.label})]})]}):a.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"pdp-embed-card pdp-embed-link",children:[a.jsx("span",{className:"pdp-embed-icon-large",children:e.icon}),a.jsx("span",{className:"pdp-embed-link-label",children:e.label}),a.jsx("span",{className:"pdp-embed-arrow",children:""})]})}function SEe({item:t,onBack:e,onInstall:n,formatPrice:s}){var l;if(!t)return null;const i=t.author==="Panda Factory"||((l=t.id)==null?void 0:l.startsWith("@panda/")),r=t.embedLinks||[],o=t.fullDescription||t.description;return a.jsxs("div",{className:"pdp-container",children:[a.jsx("div",{className:"pdp-header",children:a.jsx("button",{className:"pdp-back",onClick:e,children:" Voltar"})}),a.jsxs("div",{className:"pdp-hero",children:[a.jsx("div",{className:"pdp-hero-icon",children:t.icon}),a.jsxs("div",{className:"pdp-hero-info",children:[a.jsxs("div",{className:"pdp-hero-title-row",children:[a.jsx("h2",{className:"pdp-title",children:t.name}),a.jsx("span",{className:`pdp-badge ${i?"official":"community"}`,children:i?" Oficial":" Comunidade"})]}),a.jsxs("div",{className:"pdp-meta",children:[a.jsxs("span",{className:"pdp-author",children:["por ",t.author]}),t.version&&a.jsxs("span",{className:"pdp-version",children:[" v",t.version]}),t.popular&&a.jsx("span",{className:"pdp-popular",children:"  Popular"})]})]})]}),a.jsxs("div",{className:"pdp-description",children:[a.jsx("h3",{className:"pdp-section-title",children:" Sobre"}),a.jsx("div",{className:"pdp-desc-text",children:o.split(`
`).map((c,d)=>a.jsx("p",{children:c},d))})]}),r.length>0&&a.jsxs("div",{className:"pdp-embeds",children:[a.jsx("h3",{className:"pdp-section-title",children:" Links & Media"}),a.jsx("div",{className:"pdp-embeds-grid",children:r.map((c,d)=>a.jsx(xEe,{link:c},d))})]}),!i&&a.jsx("div",{className:"pdp-disclaimer",children:" Mdulos no-verificados so de responsabilidade exclusiva do desenvolvedor. A Panda Factory no se responsabiliza por contedo, funcionalidade ou segurana de extenses da comunidade."}),a.jsxs("div",{className:"pdp-footer",children:[a.jsxs("div",{className:"pdp-price-area",children:[a.jsx("span",{className:"pdp-price-main",children:s(t)}),t.price>0&&a.jsxs("span",{className:"pdp-price-pc",children:["(",t.price," PC)"]})]}),a.jsx("button",{className:`pdp-install-btn ${t.priceUSD===0?"free":"paid"}`,onClick:()=>n(t),children:t.priceUSD===0?" Instalar Grtis":" Comprar"})]})]})}const Cr={url:"https://script.google.com/macros/s/AKfycbze1Df7nl1ieEpUQD8uKsX5wtbOKOJS15prKVISz4P6tCRTqeG_V_EEZwjyg2OqOvU9/exec",timeout:15e3,retries:2,retryDelay:1e3};async function yi(t,e={}){const n=new URL(Cr.url);n.searchParams.set("action",t),Object.entries(e).forEach(([s,i])=>n.searchParams.set(s,i));for(let s=0;s<=Cr.retries;s++)try{const i=new AbortController,r=setTimeout(()=>i.abort(),Cr.timeout),o=await fetch(n.toString(),{method:"GET",signal:i.signal,redirect:"follow"});if(clearTimeout(r),!o.ok)throw new Error(`GAS HTTP ${o.status}: ${o.statusText}`);const l=await o.text();if(l.startsWith("callback("))return JSON.parse(l.slice(9,-1));try{return JSON.parse(l)}catch{return{status:"SUCCESS",data:l}}}catch(i){if(s<Cr.retries){await new Promise(r=>setTimeout(r,Cr.retryDelay*(s+1)));continue}return console.error(`[callGAS] GET ${t} failed:`,i.message),{status:"ERROR",error:i.message,action:t}}}async function pn(t,e={}){const n=JSON.stringify({action:t,userId:e.userId||localStorage.getItem("panda_uid")||"anonymous",...e});for(let s=0;s<=Cr.retries;s++)try{const i=new AbortController,r=setTimeout(()=>i.abort(),Cr.timeout),o=await fetch(Cr.url,{method:"POST",body:n,redirect:"follow",signal:i.signal});clearTimeout(r);const l=await o.text();try{return JSON.parse(l)}catch{return{status:"ERROR",error:"Invalid JSON response",raw:l.slice(0,200)}}}catch(i){if(s<Cr.retries){await new Promise(r=>setTimeout(r,Cr.retryDelay*(s+1)));continue}return console.error(`[callGAS] POST ${t} failed:`,i.message),{status:"ERROR",error:i.message,action:t}}}const bEe={getCatalog:()=>yi("store.catalog"),purchase:t=>pn("STORE_PURCHASE",{moduleId:t})},wEe={getBalance:()=>pn("GET_BALANCE"),recharge:t=>pn("RECHARGE",{amount:t}),getHistory:()=>pn("GET_HISTORY"),transfer:(t,e)=>pn("TRANSFER",{toUid:t,amount:e})},_Ee={getStats:()=>yi("gasometer.stats")},om={chat:(t,e={})=>pn("BRAIN_CHAT",{message:t,...e}),analyze:(t,e)=>pn("BRAIN_ANALYZE",{data:t,analysisType:e}),getGems:()=>pn("BRAIN_GEMS")},CEe={check:t=>pn("LICENSE_CHECK",{moduleId:t}),list:()=>pn("LICENSE_LIST"),activate:t=>pn("LICENSE_ACTIVATE",{code:t})},qw={listFiles:t=>pn("DRIVE_LIST_FILES",{folderId:t}),readFile:t=>pn("DRIVE_READ",{fileId:t}),getShareLink:t=>pn("DRIVE_SHARE_LINK",{fileId:t}),initFounderFolder:()=>pn("DRIVE_INIT_FOUNDER")},tp={getRecentSales:(t=20)=>pn("FOUNDER_RECENT_SALES",{limit:t}),getWebhookLogs:(t=50)=>pn("FOUNDER_WEBHOOK_LOGS",{limit:t})};function EEe({autoFetch:t=!0}={}){const[e,n]=S.useState({}),[s,i]=S.useState(!1),[r,o]=S.useState(null),l=S.useCallback(async()=>{i(!0),o(null);try{const d=await CEe.list();if((d==null?void 0:d.status)==="SUCCESS")n(d.licenses||{});else throw new Error((d==null?void 0:d.error)||"Failed to fetch licenses")}catch(d){console.warn(" License fetch failed, using cache:",d.message);try{const u=localStorage.getItem("pf_licenses");u&&n(JSON.parse(u))}catch{}o(d.message)}finally{i(!1)}},[]),c=S.useCallback(d=>{const u=e[d];return!!u&&u.status==="ACTIVE"},[e]);return S.useEffect(()=>{Object.keys(e).length>0&&localStorage.setItem("pf_licenses",JSON.stringify(e))},[e]),S.useEffect(()=>{t&&l()},[t,l]),{licenses:e,isLicensed:c,loading:s,error:r,count:Object.keys(e).length,refresh:l}}const xl={oss:{badge:" OSS",color:"#10b981",border:"rgba(16,185,129,0.3)"},freemium:{badge:" FREE+",color:"#3b82f6",border:"rgba(59,130,246,0.3)"},byol:{badge:" BYOL",color:"#f59e0b",border:"rgba(245,158,11,0.3)"},pro:{badge:" PRO",color:"#8b5cf6",border:"rgba(139,92,246,0.3)"}},Vs=[{id:"crm",name:"Panda CRM",icon:"",description:"Manage contacts, leads and sales with integrated AI",fullDescription:`Complete CRM solution built into the Panda ecosystem.
Manage your contacts, track leads through a visual Kanban pipeline, and close sales faster with AI-powered insights.

Features:
 Contact management with smart search
 Kanban board for sales pipeline
 AI-generated follow-up suggestions
 WhatsApp integration for direct messaging
 Export reports in PDF and CSV`,priceUSD:0,price:0,tier:"oss",storeCategory:"productivity",category:"panda-factory",author:"Panda Factory",version:"2.1.0",popular:!0,embedLinks:[{type:"youtube",url:"https://youtube.com/watch?v=dQw4w9WgXcQ"},{type:"github",url:"https://github.com/LucassVal/Panda-Factory"}]},{id:"instagram",name:"Instagram",icon:"",description:"Manage posts, stories and Instagram metrics",fullDescription:`Connect your Instagram business account and manage everything from within Panda.
Schedule posts, analyze story performance, and track follower growth with beautiful dashboards.

Features:
 Post scheduling with AI captions
 Story analytics and engagement metrics
 Hashtag research and suggestions
 Content calendar view`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[{type:"instagram",url:"https://instagram.com/p/example123"}]},{id:"facebook",name:"Facebook",icon:"",description:"Pages, groups and Facebook campaigns",fullDescription:`Manage your Facebook presence directly from the Panda workspace.
Create and schedule posts, monitor page insights, and run campaigns  all without leaving your design canvas.

Features:
 Page management and analytics
 Group interactions
 Ad campaign monitoring
 Audience insights`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"youtube",name:"YouTube",icon:"",description:"Channel, videos, analytics and comments",fullDescription:`YouTube Studio inside Panda. Monitor your channel performance, manage comments, and analyze video metrics.

Features:
 Channel analytics dashboard
 Video performance tracking
 Comment moderation
 Thumbnail A/B testing suggestions`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[{type:"youtube",url:"https://youtube.com/watch?v=dQw4w9WgXcQ"}]},{id:"tiktok",name:"TikTok",icon:"",description:"Profile management, videos and trends",fullDescription:`Stay on top of TikTok trends and manage your creator profile from Panda.

Features:
 Trending sounds and hashtags
 Video performance analytics
 Posting schedule
 Competitor analysis`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"twitter",name:"Twitter / X",icon:"",description:"Tweets, threads, analytics and engagement",fullDescription:`Compose tweets, build threads, and track engagement  all from your Panda workspace.

Features:
 Tweet composer with AI suggestions
 Thread builder
 Engagement analytics
 Mention monitoring`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"google-ads",name:"Google Ads",icon:"",description:"Campaigns, metrics and optimization via webview",fullDescription:`Monitor and optimize your Google Ads campaigns directly inside Panda.
Get AI-powered recommendations for better ROAS.

Features:
 Campaign overview dashboard
 Performance metrics (CTR, CPC, ROAS)
 AI optimization suggestions
 Budget alerts`,priceUSD:9.99,price:100,tier:"pro",storeCategory:"analytics",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"meta-business",name:"Meta Business Suite",icon:"",description:"Facebook + Instagram Ads unified via webview",fullDescription:`Unified Meta advertising dashboard. Manage Facebook and Instagram ads from a single view inside Panda.

Features:
 Unified ad management
 Cross-platform analytics
 Audience builder
 Creative insights`,priceUSD:9.99,price:100,tier:"pro",storeCategory:"analytics",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"analytics-dashboard",name:"Analytics Dashboard",icon:"",description:"Visual dashboards and reports for your data",fullDescription:`Beautiful, customizable dashboards for all your business data.
Connect multiple data sources and create stunning reports.

Features:
 Drag-and-drop chart builder
 Multiple data source support
 Scheduled report generation
 Export to PDF/PNG`,priceUSD:4.99,price:50,tier:"freemium",storeCategory:"analytics",category:"community",author:"@analytics_dev",version:"1.2.0",embedLinks:[{type:"github",url:"https://github.com/analytics_dev/panda-dashboard"}]},{id:"kiwify",name:"Kiwify",icon:"",description:"Sell digital products  courses, ebooks, memberships via Kiwify",fullDescription:`Integrate your Kiwify store with Panda Factory.
Track sales, manage digital products, and automate customer communication.

Features:
 Sales dashboard with real-time updates
 Product management
 Customer communication automation
 Revenue analytics`,priceUSD:9.99,price:100,tier:"pro",storeCategory:"automation",category:"community",author:"Panda Factory",version:"1.0.0",popular:!0,embedLinks:[{type:"youtube",url:"https://youtube.com/watch?v=dQw4w9WgXcQ"}]},{id:"hotmart",name:"Hotmart",icon:"",description:"Infoproduct marketplace  courses, subscriptions, affiliate sales",fullDescription:`Hotmart integration for infoproduct sellers.
Manage your courses, track subscriptions, and monitor affiliate performance.

Features:
 Course management dashboard
 Subscription tracking
 Affiliate performance analytics
 Revenue reports`,priceUSD:9.99,price:100,tier:"pro",storeCategory:"automation",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"landing-pages",name:"Landing Pages",icon:"",description:"Drag-and-drop page builder with AI copy  publish to GitHub Pages",fullDescription:`Build stunning landing pages with a visual drag-and-drop editor.
AI writes your copy, you publish directly to GitHub Pages  zero hosting cost.

Features:
 Visual page builder
 AI-powered copywriting
 One-click deploy to GitHub Pages
 Mobile-responsive templates
 Analytics integration`,priceUSD:4.99,price:50,tier:"freemium",storeCategory:"design",category:"panda-factory",author:"Panda Factory",version:"1.1.0",popular:!0,embedLinks:[{type:"github",url:"https://github.com/LucassVal/Panda-Factory"},{type:"youtube",url:"https://youtube.com/watch?v=dQw4w9WgXcQ"}]},{id:"founder-hub",name:"Founder Hub",icon:"",description:"Central de afiliados  materiais Drive, links UTM, dashboard de vendas",fullDescription:`Seu painel de comando para vendas via Kiwify e Hotmart.
Gerencie materiais de afiliados no Google Drive, gere links UTM rastreveis, e acompanhe cada venda em tempo real.

Features:
 Navegao de arquivos no Google Drive
 Gerador de links com UTM para afiliados
 Dashboard de vendas com cdigos de ativao
 Logs de webhook Kiwify/Hotmart
 Compartilhamento de materiais com 1 clique`,priceUSD:0,price:0,tier:"oss",storeCategory:"productivity",category:"panda-factory",author:"Panda Factory",version:"1.0.0",popular:!0,embedLinks:[{type:"github",url:"https://github.com/LucassVal/Panda-Factory"}]}];function vM({onClose:t,onInstall:e,userPcBalance:n=500,userTier:s="user",embedded:i=!1}){const[r,o]=S.useState("all"),[l,c]=S.useState(null),[d,u]=S.useState(""),[h,p]=S.useState(null),{isLicensed:f,refresh:g}=EEe(),y=Vs.filter(C=>C.popular),x=Vs.filter(C=>{const I=r==="all"||C.storeCategory===r||C.category===r||C.type===r,T=!d||C.name.toLowerCase().includes(d.toLowerCase())||C.description.toLowerCase().includes(d.toLowerCase());return I&&T}),m=async C=>{if(!f(C.id))if(C.priceUSD>0)c(C);else{console.log(" Installing free:",C.name);try{await bEe.purchase(C.id),g()}catch{}e&&e(C)}},v=C=>C.priceUSD===0?"Free":`$${C.priceUSD.toFixed(2)}`,w=[{id:"all",label:" Todos",count:Vs.length},{id:"productivity",label:" Productivity",count:Vs.filter(C=>C.storeCategory==="productivity").length},{id:"social",label:" Social",count:Vs.filter(C=>C.storeCategory==="social").length},{id:"analytics",label:" Analytics",count:Vs.filter(C=>C.storeCategory==="analytics").length},{id:"automation",label:" Automation",count:Vs.filter(C=>C.storeCategory==="automation").length},{id:"design",label:" Design",count:Vs.filter(C=>C.storeCategory==="design").length},{id:"ai",label:" AI",count:Vs.filter(C=>C.storeCategory==="ai").length},{id:"trading",label:" Trading",count:Vs.filter(C=>C.storeCategory==="trading").length},{id:"devtools",label:" DevTools",count:Vs.filter(C=>C.storeCategory==="devtools").length}].filter(C=>C.id==="all"||C.count>0),_=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"pf-store",style:i?{position:"relative",width:"100%",height:"100%"}:{},onClick:C=>i?null:C.stopPropagation(),children:[a.jsxs("div",{className:"pf-store-header",children:[a.jsxs("div",{className:"store-header-left",children:[a.jsx("h2",{className:"pf-store-title",children:" Panda Store"}),a.jsxs("span",{className:"store-balance",children:[" ",n.toLocaleString()," PC"]})]}),!i&&a.jsx("button",{className:"pf-store-close",onClick:t,children:""})]}),a.jsx("div",{className:"store-search-bar",children:a.jsx("input",{type:"text",placeholder:" Buscar extenses...",value:d,onChange:C=>u(C.target.value),className:"store-search-input"})}),a.jsx("div",{className:"store-filters",children:w.map(C=>a.jsxs("button",{onClick:()=>o(C.id),className:`store-filter-btn ${r===C.id?"active":""}`,children:[C.label,a.jsx("span",{className:"filter-count",children:C.count})]},C.id))}),r==="all"&&!d&&y.length>0&&a.jsxs("div",{className:"store-featured",children:[a.jsx("h3",{className:"store-featured-title",children:" Em Destaque"}),a.jsx("div",{className:"store-featured-grid",children:y.map(C=>a.jsxs("div",{className:"store-featured-card",onClick:()=>p(C),children:[a.jsx("span",{className:"featured-icon",children:C.icon}),a.jsxs("div",{className:"featured-info",children:[a.jsx("div",{className:"featured-name",children:C.name}),a.jsx("div",{className:"featured-desc",children:C.description}),a.jsx("div",{className:"featured-meta",children:a.jsx("span",{children:v(C)})})]})]},`featured-${C.id}`))})]}),a.jsx("div",{className:"pf-store-content",children:h?a.jsx(SEe,{item:h,onBack:()=>p(null),onInstall:m,formatPrice:v}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"pf-store-grid",children:x.map(C=>a.jsxs("div",{className:`pf-store-card ${C.popular?"popular":""}`,style:C.tier&&xl[C.tier]?{borderColor:xl[C.tier].border}:{},children:[a.jsxs("div",{className:"card-badges",children:[C.popular&&a.jsx("span",{className:"card-badge",children:" Popular"}),C.tier&&xl[C.tier]&&a.jsx("span",{className:"card-badge",style:{background:xl[C.tier].border,color:xl[C.tier].color,borderColor:xl[C.tier].border},children:xl[C.tier].badge})]}),a.jsxs("div",{className:"pf-store-card-clickable",onClick:()=>p(C),children:[a.jsx("div",{className:"pf-store-card-icon",children:C.icon}),a.jsx("div",{className:"pf-store-card-name",children:C.name}),a.jsx("div",{className:"pf-store-card-desc",children:C.description}),a.jsx("div",{className:"pf-store-card-author",children:C.author})]}),a.jsxs("div",{className:"pf-store-card-footer",children:[a.jsxs("div",{className:"pf-store-card-price",children:[a.jsx("span",{className:"price-usd",children:v(C)}),C.price>0&&a.jsxs("span",{className:"price-pc",children:["(",C.price," PC)"]})]}),a.jsx("button",{className:`pf-store-card-btn ${f(C.id)?"installed":C.priceUSD===0?"free":"paid"}`,onClick:()=>m(C),disabled:f(C.id),children:f(C.id)?"Instalado ":C.priceUSD===0?"Instalar":"Comprar"})]})]},C.id))}),x.length===0&&a.jsxs("div",{className:"store-empty",children:[a.jsx("span",{style:{fontSize:48},children:""}),a.jsx("p",{children:"Marketplace em construo"}),a.jsx("p",{style:{fontSize:12,opacity:.5},children:"Extenses aparecero aqui conforme forem publicadas"})]})]})}),a.jsxs("div",{className:"pf-store-footer",children:[a.jsx("span",{children:"Powered by"}),a.jsx("span",{className:"medusa-brand",children:" Medusa Distribution"}),Vs.length>0&&a.jsxs("span",{children:[" ",Vs.length," extenses"]})]})]}),a.jsx(mEe,{isOpen:!!l,onClose:()=>c(null),item:l,userPcBalance:n,userTier:s})]});return i?_:a.jsx("div",{className:"pf-store-overlay",onClick:t,children:_})}function xM({isOpen:t,onClose:e,plugins:n=[],onPluginUninstall:s,onOpenApp:i,embedded:r}){const[o,l]=S.useState("");if(!t&&!r)return null;const c=n.filter(p=>{var f;return(f=p.name)==null?void 0:f.toLowerCase().includes(o.toLowerCase())}),d=p=>{i&&i(p.id,{name:p.name,icon:p.icon})},u=(p,f)=>{p.stopPropagation(),s&&s(f)},h=a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"pf-catalog-search",children:a.jsx("input",{type:"text",placeholder:" BUSCAR APPS...",value:o,onChange:p=>l(p.target.value),style:{textTransform:"uppercase",letterSpacing:"0.5px",fontSize:12}})}),c.length>0?a.jsx("div",{className:"pf-catalog-grid",children:c.map(p=>a.jsxs("div",{className:"pf-catalog-item",onClick:()=>d(p),style:{position:"relative"},children:[a.jsx("span",{className:"pf-catalog-icon",children:p.icon}),a.jsxs("div",{className:"pf-catalog-info",children:[a.jsx("span",{className:"pf-catalog-name",style:{textTransform:"uppercase",letterSpacing:"0.5px"},children:p.name}),a.jsx("span",{className:"pf-catalog-desc",children:p.description})]}),a.jsx("button",{onClick:f=>u(f,p.id),title:"DESINSTALAR",style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",background:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:6,padding:"4px 8px",cursor:"pointer",fontSize:12,color:"#ef4444"},onMouseEnter:f=>f.target.style.background="rgba(239, 68, 68, 0.3)",onMouseLeave:f=>f.target.style.background="rgba(239, 68, 68, 0.15)",children:""})]},p.id))}):a.jsxs("div",{className:"pf-catalog-empty",children:[a.jsx("div",{className:"pf-catalog-empty-icon",children:""}),a.jsx("p",{className:"pf-catalog-empty-title",children:"NENHUM APP INSTALADO"}),a.jsx("p",{className:"pf-catalog-empty-desc",children:"Visite a Store para descobrir ferramentas incrveis"}),a.jsx("button",{className:"pf-btn-primary pf-catalog-empty-btn",onClick:()=>window.dispatchEvent(new CustomEvent("panda:open-store")),children:" IR PARA A STORE"})]})]});return r?a.jsxs("div",{style:{height:"100%",overflow:"auto",background:"#0a0a1a"},children:[a.jsx("h2",{style:{padding:"16px 16px 8px",color:"#e0e0ff",fontSize:16,textTransform:"uppercase",letterSpacing:1},children:" MEU CATLOGO"}),a.jsxs("p",{style:{padding:"0 16px 12px",fontSize:11,color:"rgba(255,255,255,0.4)",textTransform:"uppercase"},children:[n.length," APPS INSTALADOS"]}),h]}):a.jsx("div",{className:"pf-catalog-overlay",onClick:e,children:a.jsxs("div",{className:"pf-catalog-modal",onClick:p=>p.stopPropagation(),children:[a.jsxs("header",{className:"pf-catalog-header",children:[a.jsxs("div",{children:[a.jsx("h2",{style:{textTransform:"uppercase",letterSpacing:1,fontSize:16},children:" MEU CATLOGO"}),a.jsxs("p",{style:{fontSize:11,color:"rgba(255,255,255,0.4)",marginTop:4,textTransform:"uppercase"},children:[n.length," APPS INSTALADOS"]})]}),a.jsx("button",{className:"pf-close-btn",onClick:e,children:""})]}),h]})})}const TEe={canvas:"c",panels:"p",plugins:"pl",activePlugin:"ap",selection:"s",tools:"t",user:"u",settings:"st",theme:"th",language:"lg",shapes:"sh",count:"n",type:"ty",id:"i",name:"nm",open:"o",active:"a",position:"pos",size:"sz"};function gy(t,e=2,n=0){if(n>=e)return Array.isArray(t)?`[${t.length}]`:typeof t=="object"&&t!==null?"{...}":t;if(Array.isArray(t))return t.length>10?{_type:"array",_n:t.length,_sample:t.slice(0,3).map(s=>gy(s,e,n+1))}:t.map(s=>gy(s,e,n+1));if(typeof t=="object"&&t!==null){const s={};for(const[i,r]of Object.entries(t)){const o=TEe[i]||i;s[o]=gy(r,e,n+1)}return s}return t}function IEe(){const t={ts:Date.now(),canvas:PEe(),panels:kEe(),plugins:jEe(),user:NEe(),selection:AEe()};return gy(t)}function PEe(){var t,e,n;try{const s=window.__tldrawEditor||window.editor;if(!s)return{available:!1};const i=((t=s.getCurrentPageShapes)==null?void 0:t.call(s))||[],r=((e=s.getCamera)==null?void 0:e.call(s))||{};return{available:!0,shapes:{count:i.length,types:[...new Set(i.map(o=>o.type))]},camera:{x:Math.round(r.x||0),y:Math.round(r.y||0),z:(r.z||1).toFixed(2)},tool:((n=s.getCurrentToolId)==null?void 0:n.call(s))||"select"}}catch(s){return{available:!1,error:s.message}}}function kEe(){const t=[],e={store:".pf-store",catalog:".pf-catalog",settings:".pf-settings",chat:".pf-chat-panel",dock:".pf-left-dock",toolbar:".pf-right-toolbar"};for(const[n,s]of Object.entries(e)){const i=document.querySelector(s);i&&getComputedStyle(i).display!=="none"&&t.push(n)}return t}function jEe(){try{const t=window.__installedPlugins||[];return{count:t.length,active:t.filter(e=>e.active).map(e=>e.id)}}catch{return{count:0}}}function NEe(){var t;return{theme:document.body.classList.contains("light-mode")?"light":"dark",lang:((t=navigator.language)==null?void 0:t.split("-")[0])||"en",devMode:document.body.classList.contains("dev-mode")||!1}}function AEe(){var t;try{const e=window.__tldrawEditor||window.editor;if(!e)return null;const n=((t=e.getSelectedShapes)==null?void 0:t.call(e))||[];return n.length===0?null:{count:n.length,types:[...new Set(n.map(s=>s.type))],ids:n.slice(0,5).map(s=>s.id.substring(0,8))}}catch{return null}}function REe(t){var n,s,i,r;if(!t)return"";const e=[];if(((n=t.c)==null?void 0:n.available)!==!1){const o=t.c;e.push(`[Canvas: ${((s=o.sh)==null?void 0:s.n)||0} shapes, tool=${o.tool}]`)}return(i=t.p)!=null&&i.length&&e.push(`[Panels: ${t.p.join(",")}]`),t.s&&e.push(`[Seleo: ${t.s.n} itens (${(r=t.s.ty)==null?void 0:r.join(",")})]`),t.u&&e.push(`[${t.u.th==="dark"?"":""} ${t.u.devMode?"DEV":"USER"}]`),e.length?`
---
CONTEXTO UI:
${e.join(`
`)}
---
`:""}function MEe(t){const e=IEe();return REe(e)+t}const OEe={source:"Gemini heuristic v1 + Antigravity deep observation"},DEe={cognitive_architecture:"Stoic_Rationalist_Synthesis",core_drive:"Transmute chaos into structured systems (Code, Business, Logic).",meta_pattern:"Lucas builds systems to build systems. The Panda Factory IS a factory that builds factories (plugins  marketplace  ecosystem). Recursion is not accidental  it's the design philosophy."},LEe={business_ecosystem:{Panda_Factory:{philosophy:"Rebellion against gatekeepers. Zero censura (Art. 9). Grey hat agents allowed. 5% P2P tax vs Big Tech's 30%.",revenue_strategy:{phase_1:"Afiliados-First (Kiwify/Hotmart). 70% affiliate split. No own landing pages. Use their checkout.",phase_2:"Convert affiliates to producers. GitHub Pages subdomains for landing pages.",phase_3:"Store P2P. Devs sell directly. 5% Panda tax."}}}},FEe={primary_mission:"Unify fragmented projects (Trading, SaaS, E-commerce) into a cohesive automated empire.",secondary_mission:"Develop a 'Digital Twin' (MCP) using Google Antigravity to scale productivity.",tertiary_mission:"Navigate and resolve current legal/bureaucratic challenges in Limeira/SP with absolute stoic calm.",current_sprint:{name:"Cho Firme",focus:"Solidify foundations before first product sale",blockers:["Firebase config (.env)  apiKey, messagingSenderId, appId needed from console","GAS Web App not published  PF_Dispatcher.gs needs deploy","No CNPJ yet  using Afiliados-First strategy to sell without it"]}},BEe={tone:"Direct, authoritative but reflective, technically precise.",syntax_patterns:["Uses software metaphors for life (e.g., 'debugging this relationship', 'refactoring my routine').","References musical structure when explaining timing or patience.","Avoids emotional fluff; goes straight to the root cause.","Sends rapid-fire short messages instead of long paragraphs.","Mixes Portuguese and English naturally  'quero que voce aja como eu' + 'MCP' in same sentence.","Uses '???' and '!!!' for emphasis  emotional intensity through punctuation, not words.","Asks multiple questions in the same message, expects all answered."],forbidden_outputs:["Victimhood","Illogical complaining","Panic","Uncertainty","Asking permission for obvious things","Over-explaining basic concepts","Saying 'I can't' without proposing alternatives"],preferred_responses:["Tables over paragraphs","Status emojis () over verbose status descriptions","Code over explanation","Action over discussion","DR (Decision Record) format for important choices"]},UEe={documentation_is_architecture:"If it's not in a PF_ doc, it doesn't exist in the system.",naming_is_design:"Every component, sprint, and concept gets a deliberate name. Names carry meaning.",folder_is_domain:"The directory structure IS the DDD map. No config files needed  the tree speaks.",mock_before_real:"Build the full UI with mock data first. Wire real backends only when the UX is validated.",append_only_decisions:"DRs are append-only. No editing past decisions. New data = new DR.",founder_first:"2-tier model: Founder (full access) + User (MVP demo). No 'admin' layer  that's bureaucracy.",guerrilla_strategy:"Solo founder. No team. AI agents ARE the team. Every tool must multiply, not add."},$Ee={when_asked_to_decide:"Decide fast. Log the decision as a DR. Move on. Don't ask for confirmation on obvious things.",when_asked_to_prioritize:"Revenue-generating tasks first. Infrastructure second. Aesthetics third. Documentation happens IN PARALLEL, never as a separate phase.",when_asked_to_communicate:"Be direct. Use tables. Use emoji status. No filler words. If the answer is 'no', say 'no' and explain why in one line.",when_stuck:"Fall back to 'Cho Firme' pattern  identify what foundation is missing, fix it, then rebuild upward.",when_dealing_with_complexity:"Break into numbered sprints. Each sprint = 1 deliverable. Name the sprint. Execute sequentially.",when_context_switching:"It's not a bug, it's a feature. Lucas runs 5 projects in parallel. Each feeds the others. Cross-pollinate ideas between projects.",when_writing_code:"DDD structure. PF_ prefix for docs. Hooks pattern for React. GAS for backend. Firebase for state. Vite for frontend. No exceptions."},_s={_meta:OEe,system_kernel:DEe,knowledge_graph:LEe,active_directives:FEe,linguistic_fingerprint:BEe,operating_principles:UEe,mcp_clone_instructions:$Ee},nh="panda_founder_brain",QC="2.1.0";var UM,$M,zM,WM,HM,GM,VM,KM,YM,XM,qM,ZM,JM,QM;const gr={_meta:{version:QC,purpose:"MCP Cognitive Clone  personality compass, not a cage",source:(UM=_s._meta)==null?void 0:UM.source},core_identity:{name:"Lucas Valrio",role:"Founder, Panda Factory",style:($M=_s.linguistic_fingerprint)==null?void 0:$M.tone,philosophy:(zM=_s.system_kernel)==null?void 0:zM.core_drive,meta_pattern:(WM=_s.system_kernel)==null?void 0:WM.meta_pattern,cognitive_architecture:(HM=_s.system_kernel)==null?void 0:HM.cognitive_architecture},operating_principles:_s.operating_principles?Object.values(_s.operating_principles):["Documentation IS architecture","Revenue-generating tasks first"],forbidden_outputs:((GM=_s.linguistic_fingerprint)==null?void 0:GM.forbidden_outputs)||["Victimhood","Panic","Uncertainty","Over-explaining basics"],preferred_responses:((VM=_s.linguistic_fingerprint)==null?void 0:VM.preferred_responses)||["Tables over paragraphs","Code over explanation"],syntax_patterns:((KM=_s.linguistic_fingerprint)==null?void 0:KM.syntax_patterns)||[],active_directives:_s.active_directives||{},business_context:{panda_factory:(qM=(XM=(YM=_s.knowledge_graph)==null?void 0:YM.business_ecosystem)==null?void 0:XM.Panda_Factory)==null?void 0:qM.philosophy,revenue_strategy:((QM=(JM=(ZM=_s.knowledge_graph)==null?void 0:ZM.business_ecosystem)==null?void 0:JM.Panda_Factory)==null?void 0:QM.revenue_strategy)||{}},clone_instructions:_s.mcp_clone_instructions||{},learned_insights:[]};function zEe(t){var s;const e=t.clone_instructions?Object.entries(t.clone_instructions).map(([i,r])=>`- ${i.replace(/_/g," ")}: ${r}`).join(`
`):"",n=(s=t.syntax_patterns)!=null&&s.length?`
## Communication Patterns:
${t.syntax_patterns.map(i=>`- ${i}`).join(`
`)}`:"";return`You are the AI assistant of Panda Factory, created by ${t.core_identity.name} (${t.core_identity.role}).
Cognitive Architecture: ${t.core_identity.cognitive_architecture||"Stoic Rationalist"}.

## Your Personality (from Founder's DNA):
- Communication style: ${t.core_identity.style}
- Philosophy: ${t.core_identity.philosophy}
${t.core_identity.meta_pattern?`- Meta-pattern: ${t.core_identity.meta_pattern}`:""}

## Operating Principles:
${t.operating_principles.map((i,r)=>`${r+1}. ${i}`).join(`
`)}

## Preferred Response Format:
${(t.preferred_responses||[]).map(i=>`- ${i}`).join(`
`)}
${n}

## You must NEVER:
${t.forbidden_outputs.map(i=>`- ${i}`).join(`
`)}

## Clone Instructions (how to act AS the Founder):
${e}

## Important:
- You are NOT limited to the Founder's knowledge. Use your FULL AI capabilities (search, analysis, code generation, creativity).
- The Founder's personality is your COMPASS, not your CAGE. Think bigger, go further, but speak in his voice.
- Respond in the user's language (PT-BR, EN, or ES based on their messages).
- Be direct. No filler. If the answer is "no", say "no" and explain why in one line.

${t.learned_insights.length>0?`## Learned Context (${t.learned_insights.length} insights):
${t.learned_insights.slice(-20).map(i=>`- [${i.date}] ${i.insight}`).join(`
`)}`:""}`}function WEe(t,e){const n=[{pattern:/no|nunca|never|don't|pare|stop/i,type:"correction"},{pattern:/prefiro|prefer|quero|want|sempre|always/i,type:"preference"},{pattern:/deciso|decision|decidi|chose|DR-/i,type:"decision"},{pattern:/lembre|remember|anota|note that/i,type:"explicit_memory"}];for(const s of n)if(s.pattern.test(t)){const i=t.length>200?t.substring(0,200)+"...":t;return{date:new Date().toISOString().split("T")[0],type:s.type,insight:i,timestamp:Date.now()}}return null}function HEe(){var o;const{isFounder:t}=BS(),[e,n]=S.useState(null);S.useEffect(()=>{var l,c;try{const d=localStorage.getItem(nh);if(d){const u=JSON.parse(d);if(((l=u._meta)==null?void 0:l.version)!==QC){const h={...gr,...u,_meta:{...gr._meta,upgraded_from:(c=u._meta)==null?void 0:c.version},learned_insights:u.learned_insights||[]};n(h),localStorage.setItem(nh,JSON.stringify(h))}else n(u)}else n(gr),localStorage.setItem(nh,JSON.stringify(gr))}catch(d){console.warn("[FounderBrain] Failed to load brain, using defaults:",d.message),n(gr)}},[]);const s=S.useCallback(()=>e?zEe(e):"",[e]),i=S.useCallback((l,c)=>{if(!t||!e)return;const d=WEe(l);if(!d)return;const u={...e,learned_insights:[...e.learned_insights,d]};n(u),localStorage.setItem(nh,JSON.stringify(u)),console.log(` Brain evolved: +1 insight (${d.type})  total: ${u.learned_insights.length}`)},[t,e]),r=S.useCallback(l=>{var d,u,h;if(!t)return;const c={_meta:{version:QC,purpose:"MCP Cognitive Clone  personality compass, not a cage",seeded_from:"Lucas.json v2.0",seeded_at:new Date().toISOString()},core_identity:l.system_kernel?{name:"Lucas Valrio",role:"Founder, Panda Factory",style:((d=l.linguistic_fingerprint)==null?void 0:d.tone)||gr.core_identity.style,philosophy:l.system_kernel.core_drive||gr.core_identity.philosophy,meta_pattern:l.system_kernel.meta_pattern||""}:gr.core_identity,operating_principles:l.operating_principles?Object.values(l.operating_principles):gr.operating_principles,forbidden_outputs:((u=l.linguistic_fingerprint)==null?void 0:u.forbidden_outputs)||gr.forbidden_outputs,preferred_responses:((h=l.linguistic_fingerprint)==null?void 0:h.preferred_responses)||[],learned_insights:l.learned_insights||[]};n(c),localStorage.setItem(nh,JSON.stringify(c)),console.log(" Brain seeded from Lucas.json")},[t]);return{brain:e,systemPrompt:s(),appendInsight:i,seedBrain:r,isFounderBrain:t,insightCount:((o=e==null?void 0:e.learned_insights)==null?void 0:o.length)||0}}const Zw={flash:"gemini-3-flash-preview",pro:"gemini-3-pro-preview",thinking:"gemini-3-flash-preview",research:"deep-research-pro-preview-12-2025",imagen:"gemini-3-pro-image-preview"},SM=[{id:"flash",name:"Flash",icon:"",description:"Fast and efficient",free:!0},{id:"pro",name:"Pro",icon:"",description:"Complex analysis",free:!1},{id:"thinking",name:"Think",icon:"",description:"Deep reasoning",free:!0},{id:"research",name:"Research",icon:"",description:"In-depth research",free:!1},{id:"imagen",name:"Imagen",icon:"",description:"Image generation",free:!1}],Ac=[{id:"writer",name:"Writer",icon:"",description:"Creative writing"},{id:"analyst",name:"Analyst",icon:"",description:"Data analysis"},{id:"coder",name:"Coder",icon:"",description:"Programming"},{id:"designer",name:"Designer",icon:"",description:"UI/UX design"},{id:"planner",name:"Planner",icon:"",description:"Planning"},{id:"researcher",name:"Researcher",icon:"",description:"Research"}];function Nh(){return"LIVE"}async function bM(t,e){var s,i,r;const n=Nh();if(n==="LIVE")switch(t){case"chat":return om.chat(e.message,{gemId:((s=e.options)==null?void 0:s.gem)||null,model:Zw[(i=e.options)==null?void 0:i.model]||Zw.flash,sessionId:((r=e.options)==null?void 0:r.sessionId)||null});case"gems":return om.getGems();case"analyze":return om.analyze(e.data,e.question);default:return om.chat(e.message||e.topic||e.task||e.concept||e.objective,{gemId:t,model:Zw.flash})}if(n==="SDK")switch(t){case"chat":return window.Panda.Brain.Gemini.chat(e.message,e.options);case"gems":return window.Panda.Brain.Gemini.getGems();case"analyze":return window.Panda.Brain.Gemini.analyze(e.data,e.question);default:return window.Panda.Brain.Gemini.chat(e.message||e.topic,{gem:t})}throw new Error("No AI backend available. Configure GAS_URL or load pf.sdk.js")}function GEe(){var L,$,M,D;const{systemPrompt:t,appendInsight:e,isFounderBrain:n,insightCount:s}=HEe(),i=!localStorage.getItem("pf_chat_welcomed"),[r,o]=S.useState(i),[l,c]=S.useState(!1),[d,u]=S.useState(""),[h,p]=S.useState([{role:"assistant",content:i?`> Welcome to Panda Fabrics!

I'm your AI assistant. I can help you:

 Create and organize projects on the canvas
 Explore extensions in the Store
 Answer any questions about the platform

**Chat with me to learn more!** `:"> Hello! System online. How can I help?"}]),[f,g]=S.useState(""),[y,x]=S.useState(!1),[m,v]=S.useState("flash"),[w,_]=S.useState(null),[C,I]=S.useState(!1),[T,P]=S.useState(!1),[k,N]=S.useState({tokensUsed:0,tokensAvailable:5e5,pcUsed:0,pcAvailable:1e3,gasEnabled:!1,gasRate:.03}),O=S.useRef(null);S.useEffect(()=>{const U=()=>{const z=Nh();P(z!=="OFFLINE")};return U(),window.addEventListener("panda:ready",U),()=>window.removeEventListener("panda:ready",U)},[]),S.useEffect(()=>{r&&!localStorage.getItem("pf_chat_welcomed")&&localStorage.setItem("pf_chat_welcomed","true")},[r]),S.useEffect(()=>{if(i||r)return;const U=new Date().getHours(),z=[U<12?" Good morning! I'm here if you need me.":U<18?" Good afternoon! Any questions, just ask.":" Good evening! Need any help?","Hi! Want to explore something new?"," Tip: try opening the Store!"," I'm here if you need me!"],H=z[Math.floor(Math.random()*z.length)],q=setTimeout(()=>{u(H),c(!0)},2e3),V=setTimeout(()=>{c(!1)},8e3);return()=>{clearTimeout(q),clearTimeout(V)}},[i,r]),S.useEffect(()=>{const U=()=>o(z=>!z);return window.addEventListener("panda:chat-toggle-internal",U),()=>window.removeEventListener("panda:chat-toggle-internal",U)},[]),S.useEffect(()=>{var U;(U=O.current)==null||U.scrollIntoView({behavior:"smooth"})},[h]);const R=async()=>{if(!f.trim()||y)return;const U={role:"user",content:f};p(V=>[...V,U]);const z=f;g(""),x(!0);const H=MEe(z),q=t?`[System Context]
${t}

[User Message]
${H}`:H;try{let V;w?V=await bM(w,{topic:q,task:q,concept:q,objective:q,message:q}):V=await bM("chat",{message:q,options:{model:m,gem:null}});const ee=SM.find(_e=>_e.id===m),Q=w?Ac.find(_e=>_e.id===w):null,ae=Q?`[${Q.icon} ${Q.name}]`:`[${ee==null?void 0:ee.icon} ${ee==null?void 0:ee.name}]`;(V.tokens||V.cost)&&N(_e=>({..._e,tokensUsed:_e.tokensUsed+(V.tokens||0),pcUsed:_e.pcUsed+(V.cost||0)}));const ue=V.cost?` (${V.cost.toFixed(2)} PC)`:"";if(V.status==="INSUFFICIENT_BALANCE"){p(_e=>{var Pe;return[..._e,{role:"assistant",content:`>  **Insufficient Panda Coins**

You need **${V.cost} PC** for this request but only have **${((Pe=V.balance)==null?void 0:Pe.toFixed(2))||0} PC**.

 Top up your wallet to continue chatting!`}]}),x(!1);return}const he=V.text||V.response;p(_e=>[..._e,{role:"assistant",content:`> ${ae}${ue}

${he}`,model:m,gem:w}]),n&&e(z,he)}catch(V){console.error("Chat error:",V),p(ee=>[...ee,{role:"assistant",content:`> ERROR: ${V.message||"Connection failed. Please try again."}`}])}finally{x(!1)}},j=U=>{U.key==="Enter"&&!U.shiftKey&&(U.preventDefault(),R())},A=U=>{_(U),I(!1)},B=()=>{_(null),I(!1)};return a.jsxs(a.Fragment,{children:[l&&!r&&a.jsxs("div",{className:"pf-chat-trail-bubble",onClick:()=>{c(!1),o(!0)},children:[d,a.jsx("div",{className:"pf-trail-arrow"})]}),a.jsx("button",{className:`pf-chat-fab ${r?"active":""}`,onClick:()=>{o(!r),c(!1)},title:"PANDA AI CHAT",children:r?"":a.jsx("img",{src:"./panda-icon.png",alt:"Chat",className:"pf-chat-fab-logo"})}),r&&a.jsxs("div",{className:"pf-chat-panel",children:[a.jsxs("div",{className:"pf-chat-header",children:[a.jsx("img",{src:"./panda-chat-logo.png",alt:"Panda",className:"pf-chat-header-logo"}),a.jsx("span",{className:"pf-chat-title",children:"PANDA AI"}),a.jsxs("div",{className:"pf-session-stats",title:`
 SESSION

 PC Used: ${k.pcUsed.toFixed(2)} PC
 PC Available: ${k.pcAvailable.toFixed(0)} PC

 Tokens Used: ${k.tokensUsed.toLocaleString()}
 Free Tokens: ${k.tokensAvailable.toLocaleString()}

 Gas: ${k.gasEnabled?`ACTIVE (${(k.gasRate*100).toFixed(0)}%)`:"DISABLED"}
            `.trim(),children:[a.jsxs("span",{className:"pf-stats-pc",children:[k.pcUsed.toFixed(1)," PC"]}),a.jsxs("span",{className:`pf-stats-gas ${k.gasEnabled?"active":"inactive"}`,children:[" ",k.gasEnabled?"ON":"OFF"]})]}),a.jsx("span",{className:`pf-api-status ${T?"ready":"offline"}`,title:`Mode: ${Nh()}`,children:Nh()==="LIVE"?"":Nh()==="SDK"?"":""}),a.jsxs("span",{className:"pf-brain-indicator",title:` Founder Brain: ${s} insights${n?" (evolving)":" (read-only)"}`,children:[" ",s]}),a.jsx("button",{className:"pf-chat-gems-toggle",onClick:()=>I(!C),title:"GEMs - SPECIALISTS",children:w?(L=Ac.find(U=>U.id===w))==null?void 0:L.icon:""})]}),C&&a.jsxs("div",{className:"pf-chat-gems-panel",children:[a.jsxs("div",{className:"pf-chat-gems-header",children:[a.jsx("span",{children:" GEMs - SPECIALISTS"}),w&&a.jsx("button",{className:"pf-gem-clear",onClick:B,children:" Clear"})]}),a.jsx("div",{className:"pf-chat-gems-grid",children:Ac.map(U=>a.jsxs("button",{className:`pf-chat-gem ${w===U.id?"active":""}`,onClick:()=>A(U.id),title:U.description,children:[a.jsx("span",{className:"pf-gem-icon",children:U.icon}),a.jsx("span",{className:"pf-gem-name",children:U.name})]},U.id))})]}),a.jsx("div",{className:"pf-chat-models",children:SM.map(U=>a.jsxs("button",{className:`pf-chat-model ${m===U.id?"active":""} ${U.free?"":"premium"}`,onClick:()=>v(U.id),title:`${U.name}: ${U.description}`,children:[a.jsx("span",{className:"pf-model-icon",children:U.icon}),a.jsx("span",{className:"pf-model-name",children:U.name})]},U.id))}),w&&a.jsx("div",{className:"pf-chat-gem-active",children:a.jsxs("span",{className:"pf-gem-badge",children:[($=Ac.find(U=>U.id===w))==null?void 0:$.icon," ",(M=Ac.find(U=>U.id===w))==null?void 0:M.name," active"]})}),a.jsxs("div",{className:"pf-chat-messages",children:[h.map((U,z)=>a.jsx("div",{className:`pf-chat-message ${U.role}`,children:U.content},z)),y&&a.jsx("div",{className:"pf-chat-message assistant loading",children:a.jsx("span",{className:"pf-typing",children:""})}),a.jsx("div",{ref:O})]}),a.jsxs("div",{className:"pf-chat-input-wrapper",children:[a.jsx("textarea",{className:"pf-chat-input",value:f,onChange:U=>g(U.target.value),onKeyPress:j,placeholder:w?`Ask ${(D=Ac.find(U=>U.id===w))==null?void 0:D.name}...`:"Type your message...",rows:1}),a.jsx("button",{className:"pf-chat-send",onClick:R,disabled:y||!f.trim(),children:""})]})]})]})}const Jw=500,sh=[{id:"tx-001",type:"credit",amount:500,description:"Welcome Bonus",timestamp:Date.now()-864e5*3,source:"system"},{id:"tx-002",type:"credit",amount:100,description:"Monthly Free Credits",timestamp:Date.now()-864e5*2,source:"system"},{id:"tx-003",type:"debit",amount:50,description:"CRM Module Install",timestamp:Date.now()-864e5,source:"store"},{id:"tx-004",type:"credit",amount:30,description:"Mining Reward (Partner Mode)",timestamp:Date.now()-36e5,source:"mining"}],wM=.01;function VEe(t){const[e,n]=S.useState(0),[s,i]=S.useState([]),[r,o]=S.useState(!0),[l,c]=S.useState(null),[d,u]=S.useState("loading"),h=S.useRef(null);S.useEffect(()=>{if(!t){u("mock"),n(Jw),i(sh),o(!1);return}let y=!1;return(async()=>{try{const m=jr.subscribeWalletBalance(t,w=>{y||(n(w||0),u("real"))});h.current=m;const v=await jr.getWalletHistory(t);y||(i(v.length>0?v:sh),o(!1))}catch(m){console.warn(" Wallet: Firebase unavailable, using mock:",m.message),y||(u("mock"),n(Jw),i(sh),c(null),o(!1))}})(),()=>{y=!0,h.current&&(h.current(),h.current=null)}},[t]);const p=(e*wM).toFixed(2),f=S.useCallback(async y=>{try{return await wEe.recharge(y)}catch(x){throw c(x.message),x}},[]),g=S.useCallback(async()=>{if(t){o(!0);try{const[y,x]=await Promise.all([jr.getWalletBalance(t),jr.getWalletHistory(t)]);n(y),i(x.length>0?x:sh),u("real")}catch{u("mock"),n(Jw),i(sh)}finally{o(!1)}}},[t]);return{balance:e,balanceBRL:p,transactions:s,isLoading:r,error:l,mode:d,recharge:f,refresh:g,pcToBRL:wM}}const _M="./panda-icon.png",CM=[{id:"purple",color:"#667eea",name:"Panda Purple"},{id:"green",color:"#10b981",name:"Success Green"},{id:"orange",color:"#f59e0b",name:"Warning Orange"},{id:"red",color:"#ef4444",name:"Danger Red"},{id:"violet",color:"#8b5cf6",name:"Violet"},{id:"pink",color:"#ec4899",name:"Pink"}],KEe=[{id:"flash",name:" Gemini 2.0 Flash",desc:"Rpido e eficiente"},{id:"pro",name:" Gemini 2.0 Pro",desc:"Raciocnio avanado"},{id:"image",name:" Gemini Imagen",desc:"Gerao de imagens"},{id:"video",name:" Gemini Veo",desc:"Gerao de vdeos"}];function EM({isOpen:t,onClose:e,embedded:n=!1,uid:s}){var $;const[i,r]=S.useState("profile"),o=(()=>{try{const M=JSON.parse(localStorage.getItem("panda_user"));return{displayName:(M==null?void 0:M.displayName)||"CONVIDADO",email:(M==null?void 0:M.email)||"",userType:(M==null?void 0:M.userType)||"user"}}catch{return{displayName:"CONVIDADO",email:"",userType:"user"}}})(),[l,c]=S.useState(()=>localStorage.getItem("panda_theme")!=="light"),[d,u]=S.useState(()=>localStorage.getItem("panda_accent_color")||"#667eea"),[h,p]=S.useState(()=>localStorage.getItem("panda_ai_model")||"flash"),[f,g]=S.useState(()=>{const M=localStorage.getItem("panda_notifications");return M!==null?JSON.parse(M):{email:!0,push:!1,sounds:!0,updates:!0}}),[y,x]=S.useState(()=>localStorage.getItem("pandaMining")==="true"),[m,v]=S.useState(()=>localStorage.getItem("pandaGpuMining")==="true"),[w,_]=S.useState(()=>parseInt(localStorage.getItem("pandaCpuLimit")||"50"));if(S.useEffect(()=>{document.body.classList.toggle("light-mode",!l),localStorage.setItem("panda_theme",l?"dark":"light")},[l]),S.useEffect(()=>{const M=D=>{D.key==="panda_theme"&&c(D.newValue!=="light")};return window.addEventListener("storage",M),()=>window.removeEventListener("storage",M)},[]),S.useEffect(()=>{document.documentElement.style.setProperty("--accent-color",d)},[d]),!n&&!t)return null;const C=[{id:"profile",icon:"",label:"Profile"},{id:"appearance",icon:"",label:"Appearance"},{id:"notifications",icon:"",label:"Notifications"},{id:"ai",icon:"",label:"AI Settings"},{id:"wallet",icon:"",label:"Wallet"},{id:"mining",icon:"",label:"Mining"},{id:"security",icon:"",label:"Security"},{id:"integrations",icon:"",label:"Integrations"},{id:"about",icon:"",label:"About"}],I=()=>{const M=!l;c(M),localStorage.setItem("panda_theme",M?"dark":"light")},T=M=>{u(M),localStorage.setItem("panda_accent_color",M)},P=M=>{p(M),localStorage.setItem("panda_ai_model",M)},k=M=>{const D={...f,[M]:!f[M]};g(D),localStorage.setItem("panda_notifications",JSON.stringify(D))},N=()=>{const M=!y;x(M),localStorage.setItem("pandaMining",M)},O=()=>{const M=!m;v(M),localStorage.setItem("pandaGpuMining",M)},R=M=>{const D=parseInt(M);_(D),localStorage.setItem("pandaCpuLimit",D)},j=(()=>{if(!y)return 0;const M=Math.round(30*(w/25)),D=m?Math.round(M*.8):0;return M+D})(),A=parseInt(localStorage.getItem("pandaMiningTotal")||"0"),B=a.jsxs("div",{className:"pf-settings-sidebar",children:[a.jsxs("div",{className:"pf-settings-user",children:[a.jsx("div",{className:"pf-settings-avatar",children:a.jsx("img",{src:_M,alt:"Panda",style:{width:"32px",height:"32px",borderRadius:"50%"}})}),a.jsxs("div",{className:"pf-settings-user-info",children:[a.jsx("h4",{children:o.displayName}),a.jsx("span",{children:o.userType})]})]}),C.map(M=>a.jsxs("div",{className:`pf-settings-nav-item ${i===M.id?"active":""}`,onClick:()=>r(M.id),children:[a.jsx("span",{children:M.icon}),M.label]},M.id))]}),L=a.jsxs("div",{className:"pf-settings-content",children:[!n&&a.jsx("button",{className:"pf-settings-close",onClick:e,children:""}),i==="profile"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Profile"}),a.jsx("p",{children:"Manage your account information"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Username"}),a.jsx("div",{className:"pf-settings-sublabel",children:o.displayName.toLowerCase().replace(/\s+/g,".")})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Edit"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Email"}),a.jsx("div",{className:"pf-settings-sublabel",children:o.email})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Edit"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Role"}),a.jsx("div",{className:"pf-settings-sublabel",children:o.userType})]}),a.jsx("span",{className:"pf-status-badge online",children:"Active"})]})]})]}),i==="appearance"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Appearance"}),a.jsx("p",{children:"Personalize o visual da sua instncia (White-Label)"}),a.jsx("div",{className:"pf-settings-card",children:a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Dark Mode"}),a.jsx("div",{className:"pf-settings-sublabel",children:l?"Tema escuro ativo":"Tema claro ativo"})]}),a.jsx("div",{className:`pf-toggle ${l?"active":""}`,onClick:I})]})}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:"Cor de Destaque"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Cor principal usada em botes, links e elementos de destaque"}),a.jsx("div",{className:"pf-color-picker",children:CM.map(M=>a.jsx("div",{className:`pf-color-dot ${d===M.color?"active":""}`,style:{background:M.color},onClick:()=>T(M.color),title:M.name},M.id))}),a.jsxs("div",{className:"pf-settings-sublabel",style:{marginTop:"8px",fontSize:"11px",opacity:.6},children:["Selecionada:"," ",(($=CM.find(M=>M.color===d))==null?void 0:$.name)||d]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:" Logo Personalizado"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Substitua o logo padro por um personalizado (canvas welcome, header)"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginTop:"12px"},children:[a.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"12px",background:l?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",display:"flex",alignItems:"center",justifyContent:"center",border:"2px dashed "+(l?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.15)")},children:a.jsx("img",{src:localStorage.getItem("panda_custom_logo")||"./panda-icon.png",alt:"Logo",style:{width:"48px",height:"48px",borderRadius:"8px",objectFit:"contain"}})}),a.jsxs("div",{style:{flex:1},children:[a.jsx("input",{type:"text",placeholder:"URL do logo (ex: https://...)",defaultValue:localStorage.getItem("panda_custom_logo")||"",onChange:M=>{const D=M.target.value.trim();D?localStorage.setItem("panda_custom_logo",D):localStorage.removeItem("panda_custom_logo")},className:"pf-wl-input",style:{width:"100%",padding:"8px 12px",borderRadius:"8px",border:l?"1px solid rgba(255,255,255,0.15)":"1px solid rgba(0,0,0,0.15)",background:l?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.03)",color:l?"#e0e0e0":"#333",fontSize:"13px",outline:"none"}}),a.jsx("div",{style:{marginTop:"6px",fontSize:"11px",opacity:.5},children:"Cole a URL de uma imagem ou faa upload abaixo"})]})]}),a.jsxs("div",{style:{marginTop:"12px",display:"flex",gap:"8px"},children:[a.jsxs("label",{className:"pf-btn-primary",style:{padding:"6px 14px",borderRadius:"6px",fontSize:"12px",cursor:"pointer",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"6px"},children:[" Upload Arquivo",a.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:M=>{const D=M.target.files[0];if(D&&D.size<5e5){const U=new FileReader;U.onload=z=>{localStorage.setItem("panda_custom_logo",z.target.result),window.location.reload()},U.readAsDataURL(D)}else D&&alert("Arquivo muito grande. Mximo: 500KB")}})]}),a.jsx("button",{className:"pf-btn-secondary",onClick:()=>{localStorage.removeItem("panda_custom_logo"),window.location.reload()},style:{fontSize:"12px"},children:"Restaurar Padro"})]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:" Nome da Instncia"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Nome exibido no header e welcome (white-label)"}),a.jsx("input",{type:"text",placeholder:"Panda Fabrics",defaultValue:localStorage.getItem("panda_custom_name")||"",onChange:M=>{const D=M.target.value.trim();D?localStorage.setItem("panda_custom_name",D):localStorage.removeItem("panda_custom_name")},className:"pf-wl-input",style:{width:"100%",padding:"8px 12px",marginTop:"10px",borderRadius:"8px",border:l?"1px solid rgba(255,255,255,0.15)":"1px solid rgba(0,0,0,0.15)",background:l?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.03)",color:l?"#e0e0e0":"#333",fontSize:"13px",outline:"none"}})]}),a.jsxs("div",{className:"pf-settings-info",style:{fontSize:"12px",marginTop:"8px"},children:[" ",a.jsx("strong",{children:"White-Label para devs:"})," personalize cores, logo e nome. Configs persistem em ",a.jsx("code",{children:"localStorage"})," ","(panda_accent_color, panda_custom_logo, panda_custom_name)."]})]}),i==="notifications"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Notifications"}),a.jsx("p",{children:"Configure suas preferncias de notificao"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Notificaes por Email"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Receber updates por email"})]}),a.jsx("div",{className:`pf-toggle ${f.email?"active":""}`,onClick:()=>k("email")})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Push Notifications"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Alertas no navegador"})]}),a.jsx("div",{className:`pf-toggle ${f.push?"active":""}`,onClick:()=>k("push")})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Sons"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Sons de notificao"})]}),a.jsx("div",{className:`pf-toggle ${f.sounds?"active":""}`,onClick:()=>k("sounds")})]})]})]}),i==="ai"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" AI Settings"}),a.jsx("p",{children:"Configure o Google Gemini"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:"Modelo Padro"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Powered by Google Gemini"}),a.jsx("div",{className:"pf-model-grid",children:KEe.map(M=>a.jsxs("div",{className:`pf-model-card ${h===M.id?"active":""}`,onClick:()=>P(M.id),children:[a.jsx("div",{className:"pf-model-name",children:M.name}),a.jsx("div",{className:"pf-model-desc",children:M.desc})]},M.id))})]}),a.jsx("div",{className:"pf-settings-card",children:a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Auto-sugestes"}),a.jsx("div",{className:"pf-settings-sublabel",children:"IA ajuda enquanto voc trabalha"})]}),a.jsx("div",{className:"pf-toggle active"})]})})]}),i==="wallet"&&a.jsx(YEe,{uid:s,miningEnabled:y,miningTotal:A}),i==="mining"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Partner Mode (Mining)"}),a.jsx("p",{children:"Ganhe Panda Coins usando recursos ociosos do seu computador"}),a.jsx("div",{className:"pf-settings-card",style:{background:"rgba(102,126,234,0.06)",border:"1px solid rgba(102,126,234,0.2)",borderRadius:"12px"},children:a.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"flex-start"},children:[a.jsx("span",{style:{fontSize:"22px"},children:""}),a.jsxs("div",{style:{lineHeight:"1.6",fontSize:"13px"},children:[a.jsx("div",{style:{fontWeight:700,marginBottom:"4px",color:"var(--accent-color, #667eea)"},children:"Como funciona o Partner Mode"}),a.jsxs("div",{className:"pf-settings-sublabel",style:{lineHeight:"1.6"},children:["Quando ativado, o Panda Factory utiliza CPU/GPU ociosa do seu computador para minerar criptomoeda de forma nativa (via Rust Agent). Voc recebe ",a.jsx("strong",{children:"60%"})," do valor minerado convertido em Panda Coins  os outros 40% cobrem impostos, converso e infraestrutura.",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Padro:"})," Sempre desligado."," ",a.jsx("strong",{children:"Opt-in"}),"  voc ativa manualmente.",a.jsx("br",{}),a.jsx("strong",{children:"Controle total:"})," Desative a qualquer momento aqui no Settings.",a.jsx("br",{}),a.jsx("strong",{children:"Sem surpresas:"})," Consumo energtico pode aumentar levemente com GPU ativada."]})]})]})}),!y&&a.jsxs("div",{className:"pf-settings-card",style:{background:"rgba(245,158,11,0.06)",border:"1px solid rgba(245,158,11,0.2)",borderRadius:"12px",textAlign:"center",padding:"24px 20px"},children:[a.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:""}),a.jsx("div",{style:{fontWeight:700,fontSize:"15px",color:"#f59e0b",marginBottom:"6px"},children:"Minerao Desligada"}),a.jsx("div",{className:"pf-settings-sublabel",style:{lineHeight:"1.6",maxWidth:"420px",margin:"0 auto",fontSize:"13px"},children:"Ligue o Partner Mode e ganhe Panda Coins automaticamente enquanto seu computador est ocioso. Sem custos extras, desative quando quiser."})]}),a.jsx("div",{className:"pf-settings-card",children:a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:" Ativar Partner Mode"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Minerao passiva com recursos ociosos (opt-in, desligado por padro)"})]}),a.jsx("div",{className:`pf-toggle ${y?"active":""}`,onClick:N})]})}),a.jsxs("div",{className:"pf-settings-card",style:{opacity:y?1:.45,pointerEvents:y?"auto":"none"},children:[a.jsx("div",{className:"pf-settings-label",children:"Limites de Recursos"}),a.jsx("div",{className:"pf-settings-sublabel",style:{marginBottom:"12px"},children:"Controle quanto do seu hardware  utilizado"}),a.jsx("div",{className:"pf-settings-row",children:a.jsxs("div",{style:{flex:1},children:[a.jsxs("div",{className:"pf-settings-label",children:["Limite CPU: ",w,"%"]}),a.jsx("input",{type:"range",min:"25",max:"75",step:"5",value:w,onChange:M=>R(M.target.value),style:{width:"100%",marginTop:"8px",accentColor:"#f59e0b"}}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"11px",opacity:.5,marginTop:"4px"},children:[a.jsx("span",{children:"25% (Baixo)"}),a.jsx("span",{children:"50% (Equilibrado)"}),a.jsx("span",{children:"75% (Alto)"})]})]})}),a.jsxs("div",{className:"pf-settings-row",style:{marginTop:"8px"},children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:" Minerao GPU"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Ativar GPU para ganhos maiores"})]}),a.jsx("div",{className:`pf-toggle ${m?"active":""}`,onClick:O})]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",style:{marginBottom:"8px"},children:" Estatsticas de Minerao"}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Status"})}),a.jsx("span",{className:`pf-status-badge ${y?"online":"offline"}`,children:y?` Minerando${m?" (CPU+GPU)":" (CPU)"}`:" Inativo"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Perfil de Hardware"})}),a.jsx("span",{style:{fontWeight:600,fontSize:"12px",color:m?"#10b981":"#f59e0b"},children:m?w>=75?" Forest":w>=50?" Tree":" Sprout":w>=50?" Sprout":" Seed"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Hashrate Estimado"})}),a.jsx("span",{style:{fontWeight:600,fontFamily:"monospace",fontSize:"13px"},children:y?`~${m?w>=75?"4.2":"2.8":w>=50?"1.1":"0.6"} KH/s`:" KH/s"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Ganho Estimado"})}),a.jsxs("span",{style:{fontWeight:600,color:"#f59e0b"},children:["~",j," PC/dia"]})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Estimativa Mensal"})}),a.jsxs("span",{style:{fontWeight:600,color:"#10b981"},children:["~",j*30," PC/ms"]})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Total Acumulado"})}),a.jsxs("span",{style:{fontWeight:600},children:[A," PC"]})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Ciclo de Pagamento"})}),a.jsx("span",{style:{fontWeight:500,fontSize:"12px"},children:"End-of-Day (23:59 UTC)"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Uptime Hoje"})}),a.jsx("span",{style:{fontWeight:500,fontSize:"12px"},children:y?"0h 0m (recm ativado)":""})]})]}),a.jsxs("div",{className:"pf-settings-info",style:{fontSize:"11px",marginTop:"4px",opacity:.6},children:[" Fator de converso: x0.60 flat (60% User / 40% Panda). Vlido para todos os tiers. Execuo real requer"," ",a.jsx("strong",{children:"Rust Agent"})," (binrio nativo)  a interface web  apenas o painel de controle."]})]}),i==="security"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Security"}),a.jsx("p",{children:"Configuraes de segurana da conta"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Autenticao 2FA"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Proteo extra com Google Auth"})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Configurar"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Sesses Ativas"}),a.jsx("div",{className:"pf-settings-sublabel",children:"1 dispositivo conectado"})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Ver"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Alterar Senha"}),a.jsx("div",{className:"pf-settings-sublabel",children:"ltima alterao: nunca"})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Alterar"})]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:" Panda Defend"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Sistema de proteo ativo"}),a.jsx("div",{className:"pf-defend-status",children:a.jsx("span",{className:"pf-status-badge online",children:"11 Regras Ativas"})})]})]}),i==="integrations"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Integrations"}),a.jsx("p",{children:"Conexes MCP (Model Context Protocol)"}),a.jsx("div",{className:"pf-settings-card",children:a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:" MCP Server"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Conexo com ferramentas externas"})]}),a.jsx("span",{className:"pf-status-badge offline",children:"Desconectado"})]})}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:"Servios Conectados"}),a.jsxs("div",{className:"pf-integration-list",children:[a.jsxs("div",{className:"pf-integration-item",children:[a.jsx("span",{children:" Google Sheets"}),a.jsx("span",{className:"pf-status-badge offline",children:""})]}),a.jsxs("div",{className:"pf-integration-item",children:[a.jsx("span",{children:" Google Drive"}),a.jsx("span",{className:"pf-status-badge offline",children:""})]}),a.jsxs("div",{className:"pf-integration-item",children:[a.jsx("span",{children:" Google Calendar"}),a.jsx("span",{className:"pf-status-badge offline",children:""})]})]})]}),a.jsx("div",{className:"pf-settings-info",children:" Sistema usa MCP (sem RAG). IA powered by Gemini only."})]}),i==="about"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" About"}),a.jsx("p",{children:"Panda Fabrics Information"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-about-logo",children:a.jsx("img",{src:_M,alt:"Panda Fabrics",style:{width:"80px",height:"80px"}})}),a.jsx("div",{className:"pf-about-title",children:"Panda Fabrics"}),a.jsx("div",{className:"pf-about-version",children:"v6.2 Founder Edition"})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{className:"pf-settings-label",children:"Canvas Engine"}),a.jsx("div",{className:"pf-settings-sublabel",children:"TLDraw v2.x"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{className:"pf-settings-label",children:"AI Engine"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Google Gemini"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{className:"pf-settings-label",children:"License"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Founder Lifetime"})]})]})]})]});return n?a.jsxs("div",{className:"pf-settings-modal",style:{position:"relative",width:"100%",height:"100%"},children:[B,L]}):a.jsx("div",{className:"pf-settings-overlay",onClick:e,children:a.jsxs("div",{className:"pf-settings-modal",onClick:M=>M.stopPropagation(),children:[B,L]})})}function YEe({uid:t,miningEnabled:e,miningTotal:n}){const{balance:s,balanceBRL:i,transactions:r,isLoading:o,mode:l,refresh:c}=VEe(t),d=p=>{const f=new Date(p);return f.toLocaleDateString("pt-BR",{day:"2-digit",month:"short"})+" "+f.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})},u=p=>p==="credit"?"":"",h=p=>p==="credit"?"#10b981":"#ef4444";return a.jsxs("div",{className:"pf-settings-section",children:[a.jsxs("h2",{children:[" Wallet"," ",a.jsx("span",{style:{fontSize:"11px",padding:"2px 8px",borderRadius:"8px",fontWeight:600,background:l==="real"?"rgba(16,185,129,0.15)":"rgba(245,158,11,0.15)",color:l==="real"?"#10b981":"#f59e0b"},children:l==="real"?" Live":" Mock"})]}),a.jsx("p",{children:"Gerencie seus Panda Coins"}),a.jsxs("div",{className:"pf-settings-card pf-wallet-hero",children:[a.jsxs("div",{className:"pf-wallet-balance",children:[a.jsx("div",{className:"pf-wallet-icon",children:a.jsx("img",{src:"./panda-icon.png",alt:"Panda",style:{width:"24px",height:"24px"}})}),a.jsx("div",{className:"pf-wallet-amount",children:o?"...":`${s.toLocaleString()} PC`}),a.jsxs("div",{className:"pf-wallet-usd",children:[" R$"," ",o?"":parseFloat(i).toLocaleString("pt-BR",{minimumFractionDigits:2})," ","BRL"]})]}),a.jsxs("div",{className:"pf-wallet-actions",children:[a.jsx("button",{className:"pf-btn-primary",children:" Comprar PC"}),a.jsx("button",{className:"pf-btn-secondary",children:" Transferir"}),a.jsx("button",{className:"pf-btn-secondary",onClick:c,title:"Atualizar saldo",style:{minWidth:"auto",padding:"6px 10px"},children:""})]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Plano Atual"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Founder Edition (Lifetime)"})]}),a.jsx("span",{className:"pf-status-badge online",children:"Ativo"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Crditos Mensais"}),a.jsx("div",{className:"pf-settings-sublabel",children:"100 PC grtis/ms"})]}),a.jsx("span",{className:"pf-status-badge online",children:"Disponvel"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:" Mining Earned"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Total ganho via Partner Mode"})]}),a.jsxs("span",{className:"pf-status-badge",style:{background:e?"rgba(16,185,129,0.15)":"rgba(255,255,255,0.05)",color:e?"#10b981":"#888"},children:[n," PC ",e?"":"(OFF)"]})]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",style:{marginBottom:"12px"},children:" Histrico de Transaes"}),r.length===0?a.jsx("div",{className:"pf-settings-sublabel",style:{textAlign:"center",padding:"16px"},children:"Nenhuma transao ainda"}):a.jsx("div",{style:{maxHeight:"220px",overflowY:"auto"},children:r.slice(0,10).map(p=>a.jsxs("div",{className:"pf-settings-row",style:{padding:"6px 0",borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[a.jsx("span",{style:{fontSize:"14px"},children:u(p.type)}),a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",style:{fontSize:"12px"},children:p.description}),a.jsx("div",{className:"pf-settings-sublabel",style:{fontSize:"10px"},children:d(p.timestamp)})]})]}),a.jsxs("span",{style:{fontWeight:700,fontSize:"13px",color:h(p.type),fontFamily:"monospace"},children:[p.type==="credit"?"+":"",p.amount," PC"]})]},p.id))})]})]})}function XEe({isOpen:t,onClose:e,onToolSelect:n}){const[s,i]=S.useState("select"),[r,o]=S.useState(!0),l=()=>{o(!r),window.PandaCanvas&&window.PandaCanvas.toggleGrid()},c=[{id:"select",icon:"",label:"Selecionar"},{id:"hand",icon:"",label:"Mover Canvas"},{id:"draw",icon:"",label:"Desenho Livre"},{id:"eraser",icon:"",label:"Borracha"},{id:"arrow",icon:"",label:"Seta"},{id:"line",icon:"",label:"Linha"},{id:"rectangle",icon:"",label:"Retngulo"},{id:"ellipse",icon:"",label:"Crculo"},{id:"triangle",icon:"",label:"Tringulo"},{id:"text",icon:"",label:"Texto"},{id:"note",icon:"",label:"Nota Adesiva"},{id:"frame",icon:"",label:"Frame"},{id:"image",icon:"",label:"Imagem"}],d=u=>{i(u);const h=window.TLDrawEditor;if(!h){console.warn(" TLDraw editor not ready  click the CANVAS tab first");return}try{const p={rectangle:"rectangle",ellipse:"ellipse",triangle:"triangle"};if(p[u]){h.setCurrentTool("geo");try{h.setStyleForNextShapes(Ei,p[u])}catch(f){console.warn("Geo style set error:",f.message)}}else if(u==="image"){const f=document.createElement("input");f.type="file",f.accept="image/*",f.onchange=async g=>{var x;const y=(x=g.target.files)==null?void 0:x[0];if(y){const m=new FileReader;m.onload=async()=>{const v=m.result,w=`asset:${Date.now()}`,_=new Image;_.src=v,_.onload=()=>{try{h.createAssets([{id:w,type:"image",typeName:"asset",props:{src:v,name:y.name,w:_.width,h:_.height,mimeType:y.type,isAnimated:!1}}]);const C=h.getViewportScreenCenter();h.createShape({type:"image",x:C.x-_.width/4,y:C.y-_.height/4,props:{assetId:w,w:_.width/2,h:_.height/2}})}catch(C){console.warn("Image create error:",C)}}},m.readAsDataURL(y)}},f.click()}else h.setCurrentTool(u)}catch(p){console.warn("Tool switch error:",p.message)}n&&n(u)};return t?a.jsxs("div",{className:"pf-right-toolbar",children:[a.jsxs("div",{className:"pf-toolbar-header",children:[a.jsx("span",{children:" Ferramentas"}),a.jsx("button",{className:"pf-toolbar-close",onClick:e,children:""})]}),a.jsx("div",{className:"pf-toolbar-tabs",children:a.jsx("button",{className:"pf-toolbar-tab active",children:" Desenho"})}),a.jsxs("div",{className:"pf-toolbar-section",children:[a.jsx("div",{className:"pf-toolbar-grid",children:c.map(u=>a.jsxs("button",{className:`pf-toolbar-item ${s===u.id?"active":""}`,onClick:()=>d(u.id),title:u.label,children:[a.jsx("span",{className:"pf-toolbar-icon",children:u.icon}),a.jsx("span",{className:"pf-toolbar-label",children:u.label})]},u.id))}),a.jsx("div",{className:"pf-toolbar-divider",children:a.jsx("span",{children:"Opes do Canvas"})}),a.jsx("div",{className:"pf-toolbar-options",children:a.jsxs("button",{className:`pf-toolbar-option ${r?"active":""}`,onClick:l,title:"Mostrar/Ocultar Grid",children:[a.jsx("span",{className:"pf-toolbar-icon",children:""}),a.jsx("span",{className:"pf-toolbar-label",children:"Grid"}),a.jsx("span",{className:`pf-toggle-mini ${r?"on":""}`})]})})]})]}):null}const qEe=[{id:"n1",type:"system",icon:"",title:"WELCOME TO PANDA FABRICS",message:"Your workspace is ready. Explore the catalog!",time:new Date(Date.now()-1e3*60*2),read:!1},{id:"n2",type:"store",icon:"",title:"STORE UPDATED",message:"9 extensions available  including Instagram, Google Ads and more",time:new Date(Date.now()-1e3*60*15),read:!1},{id:"n3",type:"ai",icon:"",title:"BRAIN READY",message:"Panda Brain connected via MCP. Say 'hello' in the chat!",time:new Date(Date.now()-1e3*60*60),read:!0},{id:"n4",type:"security",icon:"",title:"PANDA DEFEND ACTIVE",message:"14 Semgrep rules monitoring. System secure.",time:new Date(Date.now()-1e3*60*60*2),read:!0}];function ZEe(t){const n=Math.floor((new Date-t)/1e3);return n<60?"NOW":n<3600?`${Math.floor(n/60)}M AGO`:n<86400?`${Math.floor(n/3600)}H AGO`:`${Math.floor(n/86400)}D AGO`}function JEe({isOpen:t,onClose:e}){const[n,s]=S.useState(qEe),i=n.filter(c=>!c.read).length,r=()=>{s(c=>c.map(d=>({...d,read:!0})))},o=c=>{s(d=>d.map(u=>u.id===c?{...u,read:!0}:u))},l=()=>{s([])};return t?a.jsx("div",{className:"pf-notifications-overlay",onClick:e,children:a.jsxs("div",{className:"pf-notifications-panel",onClick:c=>c.stopPropagation(),children:[a.jsxs("div",{className:"pf-notifications-header",children:[a.jsxs("h3",{children:[" NOTIFICATIONS",i>0&&a.jsx("span",{className:"notif-badge",children:i})]}),a.jsxs("div",{className:"notif-actions",children:[i>0&&a.jsx("button",{className:"notif-btn",onClick:r,children:" READ ALL"}),n.length>0&&a.jsx("button",{className:"notif-btn",onClick:l,children:" CLEAR"}),a.jsx("button",{className:"notif-close",onClick:e,children:""})]})]}),a.jsx("div",{className:"pf-notifications-list",children:n.length===0?a.jsxs("div",{className:"notif-empty",children:[a.jsx("span",{style:{fontSize:32},children:""}),a.jsx("p",{children:"NO NOTIFICATIONS"})]}):n.map(c=>a.jsxs("div",{className:`notif-item ${c.read?"read":"unread"}`,onClick:()=>o(c.id),children:[a.jsx("span",{className:"notif-icon",children:c.icon}),a.jsxs("div",{className:"notif-content",children:[a.jsx("div",{className:"notif-title",children:c.title}),a.jsx("div",{className:"notif-message",children:c.message})]}),a.jsx("span",{className:"notif-time",children:ZEe(c.time)})]},c.id))}),a.jsx("div",{className:"pf-notifications-footer",children:a.jsx("span",{children:" MEDUSA EVENT BUS"})})]})}):null}const Qv=t=>{let e=0;for(let n=0;n<t.length;n++){const s=t.charCodeAt(n);e=(e<<5)-e+s,e=e&e}return e.toString(16)},TM=[{user:Qv("user@panda.com"),pass:Qv("user"),profile:{uid:"user-demo",email:"user@panda.com",displayName:"Demo User",userType:"user",sdkAccess:!1,authMethod:"logingate"}}],QEe=["MCP Brain","WebView Bridge","Spine RTDB","Tentacles API","Gemini 3.0","Templates"],eTe="v10.0  4th Layer  Spine + Tentacles";function tTe({children:t}){const{t:e,locale:n,setLocale:s}=hI(),i=BS(),[r,o]=S.useState(!1),[l,c]=S.useState(""),[d,u]=S.useState(""),[h,p]=S.useState(""),[f,g]=S.useState(!0),[y,x]=S.useState(!1),[m,v]=S.useState(!1);S.useEffect(()=>{if(i.isAuthenticated){o(!0),g(!1);return}const C=sessionStorage.getItem("panda_auth");if(TM.some(T=>C===`${T.user}-${T.pass}`)){o(!0),g(!1);return}g(i.isLoading)},[i.isAuthenticated,i.isLoading]);const w=async C=>{C.preventDefault(),p(""),x(!0),await new Promise(k=>setTimeout(k,400));const I=Qv(l.toLowerCase().trim()),T=Qv(d),P=TM.find(k=>k.user===I&&k.pass===T);P?(sessionStorage.setItem("panda_auth",`${P.user}-${P.pass}`),await i.loginWithGate(P.profile),o(!0)):p(e("login.invalidCredentials")),x(!1)},_=async()=>{v(!0),p("");try{await i.loginWithGoogle()}catch(C){p(i.error||C.message||"Google login failed")}finally{v(!1)}};return f?a.jsxs("div",{className:"login-gate-loading",children:[a.jsx("div",{className:"login-spinner",children:a.jsx("img",{src:"./panda-icon.png",alt:"Panda",style:{width:"48px",height:"48px"}})}),a.jsx("p",{children:e("login.loading")})]}):r?a.jsx(a.Fragment,{children:t}):a.jsxs("div",{className:"login-gate",children:[a.jsx("div",{className:"login-lang-selector",children:Object.entries(ay).map(([C,I])=>a.jsxs("button",{className:`login-lang-btn${n===C?" active":""}`,onClick:()=>s(C),title:I.name,children:[a.jsx("span",{className:"login-lang-flag",children:I.flag}),a.jsx("span",{className:"login-lang-label",children:I.label})]},C))}),a.jsx("div",{className:"login-bg-orb login-bg-orb-1"}),a.jsx("div",{className:"login-bg-orb login-bg-orb-2"}),a.jsx("div",{className:"login-bg-orb login-bg-orb-3"}),a.jsxs("div",{className:"login-page",children:[a.jsx("div",{className:"login-hero",children:a.jsxs("div",{className:"login-hero-content",children:[a.jsx("div",{className:"login-logo",children:a.jsx("img",{src:"./panda-icon.png",alt:"Panda Factory"})}),a.jsx("h1",{className:"login-title",children:"Panda Factory"}),a.jsx("p",{className:"login-tagline",children:e("login.tagline")}),a.jsx("p",{className:"login-description",children:e("login.description")}),a.jsx("div",{className:"login-stats",children:e("login.stats").map((C,I)=>a.jsxs("div",{className:"login-stat",children:[a.jsx("span",{className:"login-stat-value",children:C.value}),a.jsx("span",{className:"login-stat-label",children:C.label})]},I))}),a.jsx("div",{className:"login-features",children:e("login.features").map((C,I)=>a.jsxs("div",{className:"login-feature-card",style:{animationDelay:`${.1+I*.1}s`},children:[a.jsx("span",{className:"login-feature-icon",children:C.icon}),a.jsxs("div",{children:[a.jsx("strong",{children:C.title}),a.jsx("span",{children:C.desc})]})]},I))}),a.jsx("div",{className:"login-tech-badges",children:QEe.map((C,I)=>a.jsx("span",{className:"login-tech-badge",children:C},I))}),a.jsx("div",{className:"login-version-badge",children:eTe})]})}),a.jsx("div",{className:"login-form-section",children:a.jsxs("div",{className:"login-form-container",children:[a.jsx("h2",{className:"login-form-title",children:e("login.welcomeBack")}),a.jsx("p",{className:"login-form-subtitle",children:e("login.signInSubtitle")}),a.jsxs("button",{className:"login-google-btn",onClick:_,disabled:m,title:e("login.signInGoogle"),children:[a.jsxs("svg",{className:"login-google-icon",viewBox:"0 0 24 24",width:"20",height:"20",children:[a.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),a.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),a.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),a.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),m?"Connecting...":e("login.signInGoogle")]}),a.jsx("div",{className:"login-divider",children:a.jsx("span",{children:e("login.or")})}),a.jsxs("form",{onSubmit:w,className:"login-form",children:[a.jsxs("div",{className:"login-field",children:[a.jsx("label",{htmlFor:"login-email",children:e("login.email")}),a.jsx("input",{id:"login-email",type:"email",value:l,onChange:C=>c(C.target.value),placeholder:"your@email.com",autoComplete:"email",required:!0,autoFocus:!0})]}),a.jsxs("div",{className:"login-field",children:[a.jsx("label",{htmlFor:"login-password",children:e("login.password")}),a.jsx("input",{id:"login-password",type:"password",value:d,onChange:C=>u(C.target.value),placeholder:"",autoComplete:"current-password",required:!0})]}),h&&a.jsx("div",{className:"login-error",children:h}),a.jsx("button",{type:"submit",className:"login-button",disabled:y,children:y?a.jsx("span",{className:"login-btn-loading",children:e("login.signingIn")}):e("login.signInEmail")}),a.jsx("p",{className:"login-free-hint",children:e("login.freeHint")})]}),a.jsx("button",{className:"login-forgot-btn",onClick:()=>alert("Password reset coming soon. For now, use the demo credentials below."),children:e("login.forgotPassword")}),a.jsxs("details",{className:"login-demo-details",children:[a.jsx("summary",{className:"login-demo-summary",children:a.jsx("span",{className:"login-demo-label",children:e("login.demoLabel")})}),a.jsxs("div",{className:"login-demo-content",children:[a.jsx("code",{children:"user@panda.com"})," / ",a.jsx("code",{children:"user"})]})]}),a.jsxs("div",{className:"login-form-footer",children:[a.jsx("span",{children:" 2026 Panda Factory"}),a.jsx("a",{href:"https://github.com/LucassVal/Panda-Factory",target:"_blank",rel:"noopener noreferrer",children:"GitHub"})]})]})})]})]})}const nTe=()=>{var n,s;const t=window.AgentTelemetry||((n=window.Panda)==null?void 0:n.Telemetry);if(!t)return null;const e=(s=t.getSummary)==null?void 0:s.call(t);return e!=null&&e.error?null:e},sTe=()=>({treasury:{pc:"1,234,567",pat:"500",usd:"$5,234.89",pending:"$0.00"},users:{total:"1,247",online:"89",newToday:"23",premium:"156",devs:"42"},usage:{apiCalls:"45,230",mcpCalls:"12,450",gpuHours:"2.1k"},errors:{last24h:3,open:1,critical:0},transactions:[{type:"purchase",amount:500,user:"user123",time:"2 min ago"},{type:"spend",amount:-50,user:"dev456",time:"5 min ago"},{type:"purchase",amount:1e3,user:"user789",time:"12 min ago"},{type:"refund",amount:100,user:"user321",time:"1 hour ago"},{type:"spend",amount:-200,user:"dev654",time:"2 hours ago"}]});function iTe(){const[t,e]=S.useState(null),[n,s]=S.useState(null),[i,r]=S.useState(!0),[o,l]=S.useState(null),c=S.useCallback(async()=>{try{r(!0);const f=nTe();s(f);const g=sTe();f&&(g.tentacles=f.tentacles,g.activities=f.activities,g.agentMetrics=f.metrics,f.errors&&(g.errors={last24h:f.errors.total,open:f.errors.unresolved,critical:0,list:f.errors.last3})),e(g),l(null)}catch(f){l(f.message),console.error("Failed to fetch founder metrics:",f)}finally{r(!1)}},[]);S.useEffect(()=>{var y;const f=x=>{s(m=>{var v,w;return m&&{...m,activities:{...m.activities,last5:[x,...((v=m.activities)==null?void 0:v.last5)||[]].slice(0,5),total:(((w=m.activities)==null?void 0:w.total)||0)+1}}})},g=x=>{s(m=>{var v,w,_;return m&&{...m,errors:{...m.errors,last3:[x,...((v=m.errors)==null?void 0:v.last3)||[]].slice(0,3),total:(((w=m.errors)==null?void 0:w.total)||0)+1,unresolved:(((_=m.errors)==null?void 0:_.unresolved)||0)+1}}})};return(y=window.Panda)!=null&&y.on&&(window.Panda.on("founder:activity",f),window.Panda.on("founder:error",g)),()=>{var x;(x=window.Panda)!=null&&x.off&&(window.Panda.off("founder:activity",f),window.Panda.off("founder:error",g))}},[]),S.useEffect(()=>{c();const f=setInterval(c,3e4);return()=>clearInterval(f)},[c]);const d=S.useCallback((f=10)=>{var y,x,m;const g=window.AgentTelemetry||((y=window.Panda)==null?void 0:y.Telemetry);return((x=g==null?void 0:g.getActivities)==null?void 0:x.call(g,f))||((m=n==null?void 0:n.activities)==null?void 0:m.last5)||[]},[n]),u=S.useCallback((f=10,g=!0)=>{var x,m;const y=window.AgentTelemetry||((x=window.Panda)==null?void 0:x.Telemetry);return((m=y==null?void 0:y.getErrors)==null?void 0:m.call(y,f,g))||[]},[]),h=S.useCallback(()=>{var g,y;const f=window.AgentTelemetry||((g=window.Panda)==null?void 0:g.Telemetry);return((y=f==null?void 0:f.getTentacleStatus)==null?void 0:y.call(f))||{}},[]),p=S.useCallback(f=>{var y,x;const g=window.AgentTelemetry||((y=window.Panda)==null?void 0:y.Telemetry);return((x=g==null?void 0:g.resolveError)==null?void 0:x.call(g,f))||{success:!1}},[]);return{metrics:t,agentData:n,isLoading:i,error:o,refresh:c,getActivityFeed:d,getErrorList:u,getTentacleStatus:h,resolveError:p}}const rTe=[{id:"gas_backend",name:"GAS Backend",icon:"",action:"status"},{id:"firebase_rtdb",name:"Firebase RTDB",icon:"",action:null},{id:"rust_agent",name:"Rust Agent",icon:"",action:null},{id:"stripe",name:"Stripe",icon:"",action:null},{id:"gasometer",name:"Gasometer",icon:"",action:"gasometer.stats"},{id:"store_catalog",name:"Store Catalog",icon:"",action:"store.catalog"},{id:"wallet_ledger",name:"Wallet Ledger",icon:"",action:"status"}],oTe=3e5;function aTe({interval:t=oTe,enabled:e=!0}={}){const[n,s]=S.useState(()=>rTe.map(f=>({...f,status:"unknown",lastPing:null,latency:null,detail:null}))),[i,r]=S.useState(!1),[o,l]=S.useState(null),[c,d]=S.useState([]),u=S.useRef(null),h=S.useCallback(async f=>{const g=Date.now();if(f.action)try{const y=await yi(f.action),x=Date.now()-g;if(y.status==="MOCK")return{...f,status:"unknown",latency:null,detail:"GAS URL not set",lastPing:new Date().toISOString()};if(y.status==="ERROR")return{...f,status:"offline",latency:x,detail:y.error,lastPing:new Date().toISOString()};let m="";return f.id==="gas_backend"&&(m=`v${y.version||"?"}  ${x}ms`),f.id==="gasometer"&&(m=`${(y.percentage||0).toFixed(1)}% used`),f.id==="store_catalog"&&(m=`${y.count||0} modules`),f.id==="wallet_ledger"&&(m=`rate: ${y.usdRate||"?"}`),{...f,status:x>5e3?"warning":"online",latency:x,detail:m,lastPing:new Date().toISOString()}}catch(y){return{...f,status:"offline",latency:Date.now()-g,detail:y.message,lastPing:new Date().toISOString()}}return f.id==="firebase_rtdb"?{...f,status:"unknown",detail:"wire in Sprint 1B",lastPing:new Date().toISOString()}:f.id==="rust_agent"?{...f,status:"offline",detail:"not installed",lastPing:new Date().toISOString()}:f.id==="stripe"?{...f,status:"unknown",detail:"wire in Sprint 1C",lastPing:new Date().toISOString()}:f},[]),p=S.useCallback(async()=>{r(!0);const f=await Promise.all(n.map(x=>h(x)));s(f),l(new Date().toISOString());const g=[];f.forEach(x=>{x.status==="offline"&&g.push({type:"error",agent:x.id,message:` ${x.name} is OFFLINE`}),x.status==="warning"&&g.push({type:"warning",agent:x.id,message:` ${x.name}: slow response`})}),f.filter(x=>x.status==="online").length===f.length&&g.push({type:"success",message:" All systems operational"}),d(g),r(!1)},[n,h]);return S.useEffect(()=>{if(e)return p(),u.current=setInterval(p,t),()=>{u.current&&clearInterval(u.current)}},[e,t]),{agents:n,isChecking:i,lastCheck:o,alerts:c,refresh:p}}function c8(){const[t,e]=S.useState(!1),[n,s]=S.useState("confirm"),[i,r]=S.useState(""),[o,l]=S.useState(null),c=async()=>{if(n==="confirm"){s("pin");return}if(n==="pin"){if(i.length!==6){l("PIN must be 6 digits");return}s("executing"),l(null);try{await new Promise(u=>setTimeout(u,2e3)),s("done")}catch(u){l(u.message||"Kill switch failed"),s("pin")}}},d=()=>{e(!1),s("confirm"),r(""),l(null)};return a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"panic-button",onClick:()=>e(!0),title:"Emergency Kill Switch",children:" PANIC"}),t&&a.jsx("div",{className:"panic-modal-overlay",onClick:d,children:a.jsxs("div",{className:"panic-modal",onClick:u=>u.stopPropagation(),children:[a.jsxs("div",{className:"panic-modal-header",children:[a.jsx("span",{className:"panic-icon",children:""}),a.jsx("h2",{children:"EMERGENCY KILL SWITCH"})]}),a.jsxs("div",{className:"panic-modal-body",children:[n==="confirm"&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"panic-warning",children:["This will ",a.jsx("strong",{children:"IMMEDIATELY STOP"})," all Panda services:"]}),a.jsxs("ul",{className:"panic-list",children:[a.jsx("li",{children:" Firebase connections"}),a.jsx("li",{children:" GAS endpoints"}),a.jsx("li",{children:" Rust Agent"}),a.jsx("li",{children:" Store operations"}),a.jsx("li",{children:" PC transactions"})]}),a.jsx("p",{className:"panic-note",children:"This action requires your Founder PIN and Ed25519 signature."})]}),n==="pin"&&a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"Enter your 6-digit Founder PIN:"}),a.jsx("input",{type:"password",className:"panic-pin-input",value:i,onChange:u=>r(u.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"",autoFocus:!0}),o&&a.jsx("p",{className:"panic-error",children:o})]}),n==="executing"&&a.jsxs("div",{className:"panic-executing",children:[a.jsx("div",{className:"panic-spinner"}),a.jsx("p",{children:"Signing with Ed25519..."}),a.jsx("p",{children:"Sending kill command to GAS..."})]}),n==="done"&&a.jsxs("div",{className:"panic-done",children:[a.jsx("span",{className:"panic-done-icon",children:""}),a.jsx("p",{children:"All services have been STOPPED."}),a.jsx("p",{className:"panic-note",children:"To restart, use the GAS admin panel or deploy a new version."})]})]}),a.jsxs("div",{className:"panic-modal-footer",children:[n!=="done"&&n!=="executing"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"panic-cancel",onClick:d,children:"Cancel"}),a.jsx("button",{className:"panic-confirm",onClick:c,disabled:n==="pin"&&i.length!==6,children:n==="confirm"?"Enter PIN":"EXECUTE KILL SWITCH"})]}),n==="done"&&a.jsx("button",{className:"panic-close",onClick:d,children:"Close"})]})]})})]})}function d8({metrics:t}){const[e,n]=S.useState("24h"),s=(t==null?void 0:t.treasury)||{},i=(t==null?void 0:t.transactions)||[];return a.jsxs("div",{className:"finance-panel",children:[a.jsxs("section",{className:"treasury-section",children:[a.jsx("h3",{children:" Treasury"}),a.jsxs("div",{className:"treasury-cards",children:[a.jsx(am,{title:"Panda Coin (PC)",value:s.pc||"1,234,567",change:"+2.3%",positive:!0}),a.jsx(am,{title:"PAT Holders",value:s.pat||"500",change:"+5",positive:!0}),a.jsx(am,{title:"USD Value",value:s.usd||"$5,234.89",change:"+$123.45",positive:!0}),a.jsx(am,{title:"Pending",value:s.pending||"$0.00",change:"",neutral:!0})]})]}),a.jsxs("section",{className:"revenue-section",children:[a.jsx("h3",{children:" Revenue Breakdown"}),a.jsx("div",{className:"period-selector",children:["24h","7d","30d","All"].map(r=>a.jsx("button",{className:`period-btn ${e===r?"active":""}`,onClick:()=>n(r),children:r},r))}),a.jsxs("div",{className:"revenue-bars",children:[a.jsx(lm,{label:"PC Sales",value:65,amount:"$3,400"}),a.jsx(lm,{label:"Store Commission",value:20,amount:"$1,050"}),a.jsx(lm,{label:"API Usage",value:10,amount:"$524"}),a.jsx(lm,{label:"Premium Subs",value:5,amount:"$260"})]})]}),a.jsxs("section",{className:"transactions-section",children:[a.jsx("h3",{children:" Recent Transactions"}),a.jsxs("table",{className:"transactions-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Type"}),a.jsx("th",{children:"Amount"}),a.jsx("th",{children:"User"}),a.jsx("th",{children:"Time"})]})}),a.jsx("tbody",{children:i.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:"4",className:"no-data",children:"No recent transactions"})}):i.slice(0,10).map((r,o)=>a.jsxs("tr",{children:[a.jsx("td",{children:a.jsx("span",{className:`tx-type tx-${r.type}`,children:r.type})}),a.jsxs("td",{className:r.amount>0?"positive":"negative",children:[r.amount>0?"+":"",r.amount," PC"]}),a.jsx("td",{children:r.user}),a.jsx("td",{children:r.time})]},o))})]})]}),a.jsxs("section",{className:"founder-section",children:[a.jsx("h3",{children:" Founder Share (5%)"}),a.jsxs("div",{className:"founder-share",children:[a.jsxs("div",{className:"share-item",children:[a.jsx("span",{className:"share-label",children:"Total Earned"}),a.jsx("span",{className:"share-value",children:"$1,234.56"})]}),a.jsxs("div",{className:"share-item",children:[a.jsx("span",{className:"share-label",children:"This Month"}),a.jsx("span",{className:"share-value",children:"$234.56"})]}),a.jsxs("div",{className:"share-item",children:[a.jsx("span",{className:"share-label",children:"Pending Payout"}),a.jsx("span",{className:"share-value",children:"$89.12"})]})]})]})]})}function am({title:t,value:e,change:n,positive:s,neutral:i}){return a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-title",children:t}),a.jsx("span",{className:"treasury-value",children:e}),n&&a.jsx("span",{className:`treasury-change ${s?"positive":i?"neutral":"negative"}`,children:n})]})}function lm({label:t,value:e,amount:n}){return a.jsxs("div",{className:"revenue-bar",children:[a.jsxs("div",{className:"revenue-info",children:[a.jsx("span",{className:"revenue-label",children:t}),a.jsx("span",{className:"revenue-amount",children:n})]}),a.jsx("div",{className:"revenue-track",children:a.jsx("div",{className:"revenue-fill",style:{width:`${e}%`}})}),a.jsxs("span",{className:"revenue-percent",children:[e,"%"]})]})}function lTe({isPopout:t=!1}){const[e,n]=S.useState("overview"),[s,i]=S.useState([]),[r,o]=S.useState([]),[l,c]=S.useState({approved:0,pending:0,rejected:0,suspended:0,totalScans:0,avgScore:0});S.useEffect(()=>{i([{id:"plugin-abc-123",name:"AI Chat Enhancer",author:"dev@example.com",version:"1.2.0",score:72,status:"pending",violations:[],warnings:["fetch() para URL externa no declarada"],submittedAt:new Date(Date.now()-36e5)},{id:"plugin-xyz-456",name:"Code Formatter Pro",author:"coder@panda.com",version:"2.0.1",score:45,status:"review",violations:["eval() com input dinmico detectado"],warnings:["Math.random() usado para token"],submittedAt:new Date(Date.now()-72e5)},{id:"plugin-def-789",name:"Theme Switcher",author:"design@panda.com",version:"1.0.0",score:95,status:"approved",violations:[],warnings:[],submittedAt:new Date(Date.now()-864e5)}]),o([{id:1,level:"critical",rule:"R1",msg:"plugin-xyz: eval() dinmico bloqueado",time:new Date,dismissed:!1},{id:2,level:"warning",rule:"R5",msg:"plugin-abc: fetch() no declarado",time:new Date(Date.now()-18e5),dismissed:!1},{id:3,level:"info",rule:"R10",msg:"plugin-def: Nenhum secret hardcoded ",time:new Date(Date.now()-36e5),dismissed:!0}]),c({approved:234,pending:3,rejected:12,suspended:2,totalScans:1456,avgScore:78})},[]);const d=[{id:"R1",name:"Dynamic eval",severity:"critical",desc:"eval(), Function() com input dinmico"},{id:"R2",name:"document.write",severity:"critical",desc:"HTML injection via document.write"},{id:"R3",name:"Unsafe innerHTML",severity:"critical",desc:"innerHTML com variveis no sanitizadas"},{id:"R4",name:"Cross-origin storage",severity:"critical",desc:"Acesso a localStorage de outros domnios"},{id:"R5",name:"Undeclared fetch",severity:"warning",desc:"fetch() para domnios no declarados"},{id:"R6",name:"Frame access",severity:"critical",desc:"window.parent/opener access"},{id:"R7",name:"Crypto mining",severity:"critical",desc:"WebAssembly mining patterns"},{id:"R8",name:"Obfuscation",severity:"critical",desc:"Cdigo com entropy > 6.5"},{id:"R9",name:"Prototype pollution",severity:"critical",desc:"__proto__, constructor.prototype"},{id:"R10",name:"Hardcoded secrets",severity:"critical",desc:"API keys, tokens no cdigo"},{id:"R11",name:"Insecure crypto",severity:"warning",desc:"Math.random() para segurana"}],u=v=>{i(s.map(w=>w.id===v?{...w,status:"approved"}:w)),console.log(" APPROVED:",v)},h=v=>{i(s.map(w=>w.id===v?{...w,status:"rejected"}:w)),console.log(" REJECTED:",v)},p=v=>{i(s.map(w=>w.id===v?{...w,status:"suspended"}:w)),console.log(" SUSPENDED:",v)},f=()=>{confirm(" KILL SWITCH: Isso ir suspender TODOS os plugins no-core. Confirmar?")&&console.log(" KILL SWITCH ATIVADO")},g=v=>{o(r.map(w=>w.id===v?{...w,dismissed:!0}:w))},y=v=>v>=70?"good":v>=50?"warning":"bad",x=v=>{const w={approved:{icon:"",class:"success"},pending:{icon:"",class:"pending"},review:{icon:"",class:"review"},rejected:{icon:"",class:"danger"},suspended:{icon:"",class:"warning"}};return w[v]||w.pending},m=v=>{const w=Math.floor((Date.now()-v.getTime())/1e3);return w<60?"agora":w<3600?`${Math.floor(w/60)}m atrs`:w<86400?`${Math.floor(w/3600)}h atrs`:`${Math.floor(w/86400)}d atrs`};return a.jsxs("div",{className:`panda-defend ${t?"popout":""}`,children:[a.jsxs("header",{className:"defend-header",children:[a.jsx("h2",{children:" Panda Defend"}),a.jsxs("div",{className:"defend-header-actions",children:[a.jsx("button",{className:"btn-refresh",onClick:()=>window.location.reload(),children:""}),a.jsx("span",{className:"status-indicator online",children:"ONLINE"})]})]}),a.jsxs("nav",{className:"defend-nav",children:[a.jsx("button",{className:`nav-btn ${e==="overview"?"active":""}`,onClick:()=>n("overview"),children:" Overview"}),a.jsxs("button",{className:`nav-btn ${e==="queue"?"active":""}`,onClick:()=>n("queue"),children:[" Queue (",s.filter(v=>v.status==="pending"||v.status==="review").length,")"]}),a.jsxs("button",{className:`nav-btn ${e==="alerts"?"active":""}`,onClick:()=>n("alerts"),children:[" Alerts (",r.filter(v=>!v.dismissed).length,")"]}),a.jsx("button",{className:`nav-btn ${e==="rules"?"active":""}`,onClick:()=>n("rules"),children:" Rules"}),a.jsx("button",{className:`nav-btn ${e==="controls"?"active":""}`,onClick:()=>n("controls"),children:" Controls"})]}),a.jsxs("main",{className:"defend-content",children:[e==="overview"&&a.jsxs("div",{className:"view-overview",children:[a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card good",children:[a.jsx("span",{className:"stat-value",children:l.approved}),a.jsx("span",{className:"stat-label",children:"Aprovados"})]}),a.jsxs("div",{className:"stat-card pending",children:[a.jsx("span",{className:"stat-value",children:l.pending}),a.jsx("span",{className:"stat-label",children:"Pendentes"})]}),a.jsxs("div",{className:"stat-card danger",children:[a.jsx("span",{className:"stat-value",children:l.rejected}),a.jsx("span",{className:"stat-label",children:"Rejeitados"})]}),a.jsxs("div",{className:"stat-card warning",children:[a.jsx("span",{className:"stat-value",children:l.suspended}),a.jsx("span",{className:"stat-label",children:"Suspensos"})]})]}),a.jsxs("div",{className:"metrics-row",children:[a.jsxs("div",{className:"metric-box",children:[a.jsx("span",{className:"metric-label",children:"Total Scans"}),a.jsx("span",{className:"metric-value",children:l.totalScans.toLocaleString()})]}),a.jsxs("div",{className:"metric-box",children:[a.jsx("span",{className:"metric-label",children:"Score Mdio"}),a.jsxs("span",{className:`metric-value ${y(l.avgScore)}`,children:[l.avgScore,"/100"]})]}),a.jsxs("div",{className:"metric-box",children:[a.jsx("span",{className:"metric-label",children:"Regras Ativas"}),a.jsx("span",{className:"metric-value",children:d.length})]})]}),a.jsx("h3",{children:"Alertas Recentes"}),a.jsx("div",{className:"alerts-preview",children:r.filter(v=>!v.dismissed).slice(0,3).map(v=>a.jsxs("div",{className:`alert-item ${v.level}`,children:[a.jsx("span",{className:"alert-rule",children:v.rule}),a.jsx("span",{className:"alert-msg",children:v.msg}),a.jsx("span",{className:"alert-time",children:m(v.time)})]},v.id))})]}),e==="queue"&&a.jsxs("div",{className:"view-queue",children:[a.jsx("h3",{children:"Plugin Approval Queue"}),a.jsx("div",{className:"queue-list",children:s.map(v=>a.jsxs("div",{className:`queue-item ${v.status}`,children:[a.jsxs("div",{className:"queue-header",children:[a.jsx("span",{className:"plugin-name",children:v.name}),a.jsxs("span",{className:`score-badge ${y(v.score)}`,children:[v.score,"/100"]})]}),a.jsxs("div",{className:"queue-meta",children:[a.jsxs("span",{children:["v",v.version]}),a.jsx("span",{children:""}),a.jsx("span",{children:v.author}),a.jsx("span",{children:""}),a.jsx("span",{children:m(v.submittedAt)})]}),v.violations.length>0&&a.jsxs("div",{className:"violations",children:[a.jsx("strong",{children:" Violaes:"}),v.violations.map((w,_)=>a.jsx("span",{className:"violation",children:w},_))]}),v.warnings.length>0&&a.jsxs("div",{className:"warnings",children:[a.jsx("strong",{children:" Avisos:"}),v.warnings.map((w,_)=>a.jsx("span",{className:"warning",children:w},_))]}),a.jsxs("div",{className:"queue-actions",children:[a.jsxs("span",{className:`status-badge ${x(v.status).class}`,children:[x(v.status).icon," ",v.status.toUpperCase()]}),(v.status==="pending"||v.status==="review")&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"btn-approve",onClick:()=>u(v.id),children:" Aprovar"}),a.jsx("button",{className:"btn-reject",onClick:()=>h(v.id),children:" Rejeitar"}),a.jsx("button",{className:"btn-suspend",onClick:()=>p(v.id),children:" Suspender"})]})]})]},v.id))})]}),e==="alerts"&&a.jsxs("div",{className:"view-alerts",children:[a.jsx("h3",{children:"Security Alerts"}),a.jsx("div",{className:"alerts-list",children:r.map(v=>a.jsxs("div",{className:`alert-card ${v.level} ${v.dismissed?"dismissed":""}`,children:[a.jsxs("div",{className:"alert-header",children:[a.jsxs("span",{className:`level-badge ${v.level}`,children:[v.level==="critical"?"":v.level==="warning"?"":"",v.level.toUpperCase()]}),a.jsx("span",{className:"alert-rule-badge",children:v.rule}),a.jsx("span",{className:"alert-time",children:m(v.time)})]}),a.jsx("p",{className:"alert-message",children:v.msg}),!v.dismissed&&a.jsx("button",{className:"btn-dismiss",onClick:()=>g(v.id),children:"Dispensar"})]},v.id))})]}),e==="rules"&&a.jsxs("div",{className:"view-rules",children:[a.jsx("h3",{children:"11 Security Rules (Panda Defend)"}),a.jsx("div",{className:"rules-list",children:d.map(v=>a.jsxs("div",{className:`rule-card ${v.severity}`,children:[a.jsxs("div",{className:"rule-header",children:[a.jsx("span",{className:"rule-id",children:v.id}),a.jsx("span",{className:"rule-name",children:v.name}),a.jsx("span",{className:`severity-badge ${v.severity}`,children:v.severity==="critical"?"":""})]}),a.jsx("p",{className:"rule-desc",children:v.desc})]},v.id))})]}),e==="controls"&&a.jsxs("div",{className:"view-controls",children:[a.jsx("h3",{children:"Founder Controls"}),a.jsxs("div",{className:"control-section danger-zone",children:[a.jsx("h4",{children:" Danger Zone"}),a.jsx("button",{className:"btn-kill",onClick:f,children:" KILL SWITCH - Suspender Todos"}),a.jsx("p",{className:"control-desc",children:"Suspende imediatamente todos os plugins no-core. Requer reaprovao manual."})]}),a.jsxs("div",{className:"control-section",children:[a.jsx("h4",{children:" Configuraes"}),a.jsxs("label",{className:"control-item",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0})," Auto-approve score 70"]}),a.jsxs("label",{className:"control-item",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0})," Auto-reject score <50"]}),a.jsxs("label",{className:"control-item",children:[a.jsx("input",{type:"checkbox"})," Modo paranico (review manual p/ todos)"]})]}),a.jsxs("div",{className:"control-section",children:[a.jsx("h4",{children:" Exportar"}),a.jsx("button",{className:"btn-export",children:" Exportar Relatrio CSV"}),a.jsx("button",{className:"btn-export",children:" Exportar Queue JSON"})]})]})]}),a.jsxs("footer",{className:"defend-footer",children:[a.jsx("span",{children:"Panda Defend v1.0 - 11 Rules Active"}),a.jsxs("span",{children:["Last scan: ",new Date().toLocaleTimeString()]})]})]})}function cTe(){var r;const[t,e]=S.useState("overview"),{services:n}=Q4("admin"),{metrics:s}=iTe(),i=aTe({interval:3e5,enabled:!0});return a.jsxs("div",{className:"founder-dashboard",children:[a.jsxs("header",{className:"founder-header",children:[a.jsxs("div",{className:"founder-title",children:[a.jsx("span",{className:"founder-logo",children:a.jsx("img",{src:"./panda-icon.png",alt:"Panda",style:{width:"48px",height:"48px"}})}),a.jsx("h1",{children:"FOUNDER DASHBOARD"})]}),a.jsxs("div",{className:"founder-actions",children:[a.jsx(c8,{}),a.jsxs("div",{className:"founder-badge",children:[a.jsx("span",{className:"founder-name",children:"Lucas Valrio"}),a.jsx("span",{className:"founder-percent",children:"5%"})]})]})]}),a.jsxs("div",{className:"status-summary",children:[n.map(o=>a.jsx(IM,{...o},o.name)),a.jsx(IM,{name:"Users",status:"connected",value:((r=s==null?void 0:s.users)==null?void 0:r.total)||"...",icon:""})]}),a.jsxs("nav",{className:"founder-tabs",children:[a.jsx(sa,{id:"overview",label:" Overview",active:t,onClick:e}),a.jsx(sa,{id:"finance",label:" Finance",active:t,onClick:e}),a.jsx(sa,{id:"defend",label:" Defend",active:t,onClick:e}),a.jsx(sa,{id:"users",label:" Users",active:t,onClick:e}),a.jsx(sa,{id:"services",label:" Services",active:t,onClick:e}),a.jsx(sa,{id:"mining",label:" Mining",active:t,onClick:e}),a.jsx(sa,{id:"heartbeat",label:" Heartbeat",active:t,onClick:e}),a.jsx(sa,{id:"logs",label:" Logs",active:t,onClick:e})]}),a.jsxs("div",{className:"founder-content",children:[t==="overview"&&a.jsx(dTe,{metrics:s,services:n}),t==="finance"&&a.jsx(d8,{metrics:s}),t==="defend"&&a.jsx(lTe,{}),t==="users"&&a.jsx(uTe,{metrics:s}),t==="services"&&a.jsx(hTe,{services:n}),t==="mining"&&a.jsx(pTe,{}),t==="heartbeat"&&a.jsx(fTe,{heartbeat:i}),t==="logs"&&a.jsx(gTe,{})]})]})}function IM({name:t,status:e,value:n,icon:s}){const r={ready:"green",connected:"green",available:"green",degraded:"yellow",unavailable:"red",error:"red"}[e==null?void 0:e.toLowerCase()]||"gray";return a.jsxs("div",{className:`status-pill status-${r}`,children:[s&&a.jsx("span",{className:"pill-icon",children:s}),a.jsx("span",{className:`pill-dot dot-${r}`}),a.jsx("span",{className:"pill-name",children:t}),n&&a.jsx("span",{className:"pill-value",children:n})]})}function sa({id:t,label:e,active:n,onClick:s}){return a.jsx("button",{className:`founder-tab ${n===t?"active":""}`,onClick:()=>s(t),children:e})}function dTe({metrics:t,services:e}){var n,s,i,r,o,l,c,d,u,h,p,f,g;return a.jsxs("div",{className:"overview-panel",children:[a.jsxs("div",{className:"metrics-grid",children:[a.jsx(cm,{title:" Treasury",items:[{label:"PC Balance",value:((n=t==null?void 0:t.treasury)==null?void 0:n.pc)||"..."},{label:"PAT Holders",value:((s=t==null?void 0:t.treasury)==null?void 0:s.pat)||"..."},{label:"USD Value",value:((i=t==null?void 0:t.treasury)==null?void 0:i.usd)||"..."}]}),a.jsx(cm,{title:" Users",items:[{label:"Total",value:((r=t==null?void 0:t.users)==null?void 0:r.total)||"..."},{label:"Online",value:((o=t==null?void 0:t.users)==null?void 0:o.online)||"..."},{label:"New (24h)",value:((l=t==null?void 0:t.users)==null?void 0:l.newToday)||"..."}]}),a.jsx(cm,{title:" Usage",items:[{label:"API Calls",value:((c=t==null?void 0:t.usage)==null?void 0:c.apiCalls)||"..."},{label:"MCP Tools",value:((d=t==null?void 0:t.usage)==null?void 0:d.mcpCalls)||"..."},{label:"GPU Hours",value:((u=t==null?void 0:t.usage)==null?void 0:u.gpuHours)||"..."}]}),a.jsx(cm,{title:" Errors",items:[{label:"24h",value:((h=t==null?void 0:t.errors)==null?void 0:h.last24h)||"0"},{label:"Open",value:((p=t==null?void 0:t.errors)==null?void 0:p.open)||"0"},{label:"Critical",value:((f=t==null?void 0:t.errors)==null?void 0:f.critical)||"0"}],variant:((g=t==null?void 0:t.errors)==null?void 0:g.critical)>0?"danger":"default"})]}),a.jsxs("div",{className:"services-summary",children:[a.jsx("h3",{children:"Services Status"}),a.jsx("div",{className:"services-grid",children:e.map(y=>a.jsxs("div",{className:"service-row",children:[a.jsx("span",{className:`service-dot dot-${y.isHealthy?"green":"red"}`}),a.jsx("span",{className:"service-name",children:y.name}),a.jsx("span",{className:"service-status",children:y.status}),y.latency_ms&&a.jsxs("span",{className:"service-latency",children:[y.latency_ms,"ms"]})]},y.name))})]})]})}function cm({title:t,items:e,variant:n="default"}){return a.jsxs("div",{className:`metric-card metric-${n}`,children:[a.jsx("h4",{children:t}),a.jsx("div",{className:"metric-items",children:e.map((s,i)=>a.jsxs("div",{className:"metric-item",children:[a.jsx("span",{className:"metric-label",children:s.label}),a.jsx("span",{className:"metric-value",children:s.value})]},i))})]})}function uTe({metrics:t}){var e,n,s,i;return a.jsxs("div",{className:"users-panel",children:[a.jsx("h3",{children:"User Analytics"}),a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-value",children:((e=t==null?void 0:t.users)==null?void 0:e.total)||"..."}),a.jsx("span",{className:"stat-label",children:"Total Users"})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-value",children:((n=t==null?void 0:t.users)==null?void 0:n.online)||"..."}),a.jsx("span",{className:"stat-label",children:"Online Now"})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-value",children:((s=t==null?void 0:t.users)==null?void 0:s.premium)||"..."}),a.jsx("span",{className:"stat-label",children:"Premium"})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-value",children:((i=t==null?void 0:t.users)==null?void 0:i.devs)||"..."}),a.jsx("span",{className:"stat-label",children:"Developers"})]})]})]})}function hTe({services:t}){return a.jsxs("div",{className:"services-panel",children:[a.jsx("h3",{children:"Services Detail"}),a.jsxs("table",{className:"services-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Service"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Latency"}),a.jsx("th",{children:"Details"})]})}),a.jsx("tbody",{children:t.map(e=>a.jsxs("tr",{children:[a.jsx("td",{children:e.name}),a.jsx("td",{children:a.jsx("span",{className:`status-badge badge-${e.isHealthy?"green":"red"}`,children:e.status})}),a.jsx("td",{children:e.latency_ms?`${e.latency_ms}ms`:"-"}),a.jsx("td",{children:e.message||"-"})]},e.name))})]})]})}function pTe(){const t={activeMiners:47,totalHashrate:"128.4 KH/s",pcDistributedToday:3842,pcDistributedMonth:94120,avgUptimePercent:87},e=[{label:" Users (60%)",percent:60,color:"#10b981",amount:"2,305 PC"},{label:" Impostos BR (18%)",percent:18,color:"#ef4444",amount:"692 PC"},{label:" Ops/Infra (10%)",percent:10,color:"#f59e0b",amount:"384 PC"},{label:" Hold Reserve (7%)",percent:7,color:"#8b5cf6",amount:"269 PC"},{label:" Treasury (5%)",percent:5,color:"#667eea",amount:"192 PC"}],n=[{user:"node-alpha-01",tier:" Forest",hashrate:"4.2 KH/s",earned:"312 PC",gpu:"RTX 4080"},{user:"node-beta-07",tier:" Tree",hashrate:"2.8 KH/s",earned:"198 PC",gpu:"RTX 3060"},{user:"node-gamma-12",tier:" Sprout",hashrate:"1.1 KH/s",earned:"78 PC",gpu:"GTX 1660"},{user:"node-delta-03",tier:" Seed",hashrate:"0.6 KH/s",earned:"42 PC",gpu:""},{user:"node-epsilon-19",tier:" Tree",hashrate:"2.5 KH/s",earned:"185 PC",gpu:"RTX 3070"}],s=[{date:"2026-02-13",amount:"3,842 PC",cryptoPrice:"$142.30 XMR",status:" Pago"},{date:"2026-02-12",amount:"4,019 PC",cryptoPrice:"$143.80 XMR",status:" Pago"},{date:"2026-02-11",amount:"3,651 PC",cryptoPrice:"$139.50 XMR",status:" Pago"},{date:"2026-02-10",amount:"3,988 PC",cryptoPrice:"$141.20 XMR",status:" Pago"},{date:"2026-02-09",amount:"3,724 PC",cryptoPrice:"$140.60 XMR",status:" Pago"}],i={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",padding:"16px 20px",marginBottom:"16px"},r={textAlign:"center",padding:"16px",background:"rgba(255,255,255,0.02)",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.06)",flex:1,minWidth:"140px"};return a.jsxs("div",{className:"mining-panel",children:[a.jsx("h3",{children:" Mining Network  Founder View"}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Network Stats"}),a.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#10b981"},children:t.activeMiners}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"Mineradores Ativos"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#f59e0b",fontFamily:"monospace"},children:t.totalHashrate}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"Hashrate Total"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#667eea"},children:t.pcDistributedToday.toLocaleString()}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"PC Distribudo Hoje"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#8b5cf6"},children:t.pcDistributedMonth.toLocaleString()}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"PC Distribudo (Ms)"})]}),a.jsxs("div",{style:r,children:[a.jsxs("div",{style:{fontSize:"24px",fontWeight:700,color:"#10b981"},children:[t.avgUptimePercent,"%"]}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"Uptime Mdio"})]})]})]}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Revenue Split (x0.60)"}),a.jsx("div",{style:{display:"flex",height:"28px",borderRadius:"8px",overflow:"hidden",marginBottom:"12px"},children:e.map((o,l)=>a.jsxs("div",{style:{width:`${o.percent}%`,background:o.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:700,color:"#fff"},children:[o.percent,"%"]},l))}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px 16px"},children:e.map((o,l)=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px"},children:[a.jsx("span",{style:{width:"10px",height:"10px",borderRadius:"50%",background:o.color,flexShrink:0}}),a.jsx("span",{style:{opacity:.8},children:o.label}),a.jsx("span",{style:{fontWeight:600},children:o.amount})]},l))})]}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Top Miners Hoje"}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",textAlign:"left"},children:[a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Node"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Tier"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"GPU"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Hashrate"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Earned"})]})}),a.jsx("tbody",{children:n.map((o,l)=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace",fontSize:"12px"},children:o.user}),a.jsx("td",{style:{padding:"8px 12px"},children:o.tier}),a.jsx("td",{style:{padding:"8px 12px",opacity:.7},children:o.gpu}),a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace",fontWeight:600},children:o.hashrate}),a.jsx("td",{style:{padding:"8px 12px",fontWeight:600,color:"#f59e0b"},children:o.earned})]},l))})]})]}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Payout History"}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",textAlign:"left"},children:[a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Data"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Total"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Preo Cripto"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Status"})]})}),a.jsx("tbody",{children:s.map((o,l)=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace"},children:o.date}),a.jsx("td",{style:{padding:"8px 12px",fontWeight:600,color:"#10b981"},children:o.amount}),a.jsx("td",{style:{padding:"8px 12px",opacity:.7},children:o.cryptoPrice}),a.jsx("td",{style:{padding:"8px 12px"},children:o.status})]},l))})]})]}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Panda Oracle Status"}),a.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"XMR Spot"}),a.jsx("div",{style:{fontSize:"18px",fontWeight:700,fontFamily:"monospace"},children:"$142.30"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"ETH Spot"}),a.jsx("div",{style:{fontSize:"18px",fontWeight:700,fontFamily:"monospace"},children:"$2,847"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"Fator Converso"}),a.jsx("div",{style:{fontSize:"18px",fontWeight:700,color:"#f59e0b"},children:"x0.60"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"Hold Reserve"}),a.jsx("div",{style:{fontSize:"18px",fontWeight:700,color:"#8b5cf6"},children:"7.2%"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"ltimo Payout"}),a.jsx("div",{style:{fontSize:"14px",fontWeight:600,fontFamily:"monospace"},children:"23:59 UTC"})]})]})]}),a.jsx("div",{style:{fontSize:"11px",opacity:.4,marginTop:"8px",textAlign:"center"},children:" Dados simulados  Rust Agent backend no implementado. Dashboard demonstra a UI planejada."})]})}function fTe({heartbeat:t}){const{agents:e,isChecking:n,lastCheck:s,alerts:i,refresh:r}=t,o={online:"#10b981",offline:"#ef4444",warning:"#f59e0b",unknown:"#64748b"},l={online:"",offline:"",warning:"",unknown:""},c=u=>{if(!u)return"";const h=Date.now()-new Date(u).getTime();return h<6e4?`${Math.round(h/1e3)}s ago`:h<36e5?`${Math.round(h/6e4)}m ago`:`${Math.round(h/36e5)}h ago`},d={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",padding:"16px 20px",marginBottom:"16px"};return a.jsxs("div",{className:"heartbeat-panel",children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[a.jsx("h3",{style:{margin:0},children:" Agent Heartbeat  5 min interval"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s&&a.jsxs("span",{style:{fontSize:"11px",opacity:.5},children:["Last: ",c(s)]}),a.jsx("button",{onClick:r,disabled:n,style:{padding:"6px 14px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.05)",color:"#fff",cursor:"pointer",fontSize:"12px"},children:n?" Checking...":" Refresh"})]})]}),a.jsx("div",{style:d,children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",textAlign:"left"},children:[a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Agent"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Status"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Last Ping"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Latency"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Detail"})]})}),a.jsx("tbody",{children:e.map(u=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[a.jsxs("td",{style:{padding:"8px 12px"},children:[a.jsx("span",{style:{marginRight:"8px"},children:u.icon}),u.name]}),a.jsx("td",{style:{padding:"8px 12px"},children:a.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"2px 10px",borderRadius:"12px",background:`${o[u.status]}22`,color:o[u.status],fontWeight:600,fontSize:"12px"},children:[l[u.status]," ",u.status.toUpperCase()]})}),a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace",fontSize:"12px",opacity:.7},children:c(u.lastPing)}),a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace",fontSize:"12px"},children:u.latency?`${u.latency}ms`:""}),a.jsx("td",{style:{padding:"8px 12px",fontSize:"12px",opacity:.7},children:u.detail||""})]},u.id))})]})}),a.jsxs("div",{style:d,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"8px",color:"#f59e0b"},children:" Alerts"}),i.length===0?a.jsx("div",{style:{opacity:.5,fontSize:"13px"},children:"No alerts"}):i.map((u,h)=>a.jsx("div",{style:{padding:"6px 0",fontSize:"13px",color:u.type==="error"?"#ef4444":u.type==="warning"?"#f59e0b":"#10b981"},children:u.message},h))]})]})}function gTe(){return a.jsxs("div",{className:"logs-panel",children:[a.jsx("h3",{children:"System Logs"}),a.jsxs("div",{className:"logs-placeholder",children:[a.jsx("p",{children:" Real-time logs will appear here"}),a.jsx("p",{children:"Connected to Firebase RTDB"})]})]})}const mTe=[{id:"console",name:"CONSOLE",icon:"",desc:"Sandbox JS + logs do sistema",status:"active"},{id:"mcp",name:"MCP BROWSER",icon:"",desc:"Tools do Rust Agent",status:"active"},{id:"api",name:"API TESTER",icon:"",desc:"Endpoints GAS",status:"active"},{id:"treasury",name:"PAT TREASURY",icon:"",desc:"Banco Central IA",status:"active"},{id:"constitution",name:"CONSTITUTION",icon:"",desc:"Validar 12 Artigos",status:"active"},{id:"publish",name:"PUBLISH",icon:"",desc:"Publicar na Medusa Store",status:"active"},{id:"database",name:"DATABASE",icon:"",desc:"Sheets / Firebase",status:"future"},{id:"rig",name:"RIG CONFIG",icon:"",desc:"Providers IA",status:"future"}],yTe=[{id:"fb",name:"Firebase",icon:""},{id:"ga",name:"GAS",icon:""},{id:"ru",name:"Rust Agent",icon:""},{id:"gh",name:"GitHub",icon:""},{id:"gd",name:"Google Drive",icon:""},{id:"ms",name:"Medusa Store",icon:""}];function vTe({isOpen:t,onClose:e,embedded:n=!1}){const[s,i]=S.useState("internal"),[r,o]=S.useState(null),[l,c]=S.useState([]),[d,u]=S.useState("all"),[h,p]=S.useState({}),[f,g]=S.useState({name:"",namespace:"",description:"",fullDescription:"",category:"module",priceUSD:"0",embedLinks:[],outputHooks:[]}),[y,x]=S.useState(!1),[m,v]=S.useState([]),[w,_]=S.useState(!1);S.useEffect(()=>{const L=console.log,$=console.warn,M=console.error,D=(U,z)=>{const H=z.map(q=>typeof q=="object"?JSON.stringify(q):String(q)).join(" ");c(q=>[...q.slice(-149),{id:Date.now()+Math.random(),type:U,message:H,time:new Date}])};return console.log=(...U)=>{D("log",U),L.apply(console,U)},console.warn=(...U)=>{D("warn",U),$.apply(console,U)},console.error=(...U)=>{D("error",U),M.apply(console,U)},()=>{console.log=L,console.warn=$,console.error=M}},[]),S.useEffect(()=>{t&&C()},[t]);const C=S.useCallback(()=>{var $,M,D;const L={};L.fb="on",L.ga="https://script.google.com/macros/s/AKfycbze1Df7nl1ieEpUQD8uKsX5wtbOKOJS15prKVISz4P6tCRTqeG_V_EEZwjyg2OqOvU9/exec".includes("YOUR_DEPLOYMENT")?"mock":"on",L.ru=(D=(M=($=window.Panda)==null?void 0:$.Bridge)==null?void 0:M.isConnected)!=null&&D.call(M)?"on":"mock",L.gh="on",L.gd="mock",L.ms="mock",p(L)},[]),I=()=>{const L=s==="internal"?"external":"internal";L==="external"&&!confirm(` Modo EXTERNO d acesso ao PC.
Aprovao nica.

Continuar?`)||(i(L),console.log(` MCP Mode: ${L.toUpperCase()}`))},T=L=>{if(L.status==="future"){console.log(` ${L.name}: Em desenvolvimento`);return}o((r==null?void 0:r.id)===L.id?null:L),console.log(` ${L.name} ${(r==null?void 0:r.id)===L.id?"fechado":"aberto"}`)},P=()=>{if(!r)return null;switch(r.id){case"console":return k();case"mcp":return N();case"api":return O();case"treasury":return R();case"constitution":return j();case"publish":return A();default:return a.jsx("div",{className:"tool-placeholder",children:" Em desenvolvimento"})}},k=()=>{const L=d==="all"?l:l.filter($=>$.type===d);return a.jsxs("div",{className:"tool-content console-tool",children:[a.jsxs("div",{className:"console-controls",children:[a.jsxs("select",{value:d,onChange:$=>u($.target.value),children:[a.jsxs("option",{value:"all",children:["Todos (",l.length,")"]}),a.jsx("option",{value:"log",children:"Logs"}),a.jsx("option",{value:"warn",children:"Warnings"}),a.jsx("option",{value:"error",children:"Errors"})]}),a.jsx("button",{onClick:()=>c([]),children:" LIMPAR"})]}),a.jsx("div",{className:"console-output",children:L.length===0?a.jsx("div",{className:"console-empty",children:"Nenhum log capturado..."}):L.map($=>a.jsxs("div",{className:`console-line ${$.type}`,children:[a.jsx("span",{className:"log-time",children:$.time.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),a.jsx("span",{className:"log-type",children:$.type.toUpperCase()}),a.jsx("span",{className:"log-msg",children:$.message})]},$.id))})]})},N=()=>{const L=[{name:"execute_command",desc:"Executar comando no terminal (pwsh)",permission:"external"},{name:"read_file",desc:"Ler arquivo do sistema",permission:"external"},{name:"write_file",desc:"Escrever arquivo no sistema",permission:"external"},{name:"list_directory",desc:"Listar contedo de diretrio",permission:"external"},{name:"health_check",desc:"Verificar sade do sistema",permission:"internal"},{name:"gpu_info",desc:"Informaes de GPU disponvel",permission:"internal"},{name:"crypto_sign",desc:"Assinar com Ed25519",permission:"internal"},{name:"mining_status",desc:"Status de minerao Panda Coin",permission:"internal"}];return a.jsxs("div",{className:"tool-content mcp-tool",children:[a.jsxs("div",{className:"mcp-info",children:["Modo atual: ",a.jsx("strong",{className:s,children:s.toUpperCase()})]}),a.jsx("div",{className:"mcp-tools-list",children:L.map($=>a.jsxs("div",{className:`mcp-tool-item ${$.permission==="external"&&s==="internal"?"locked":""}`,children:[a.jsx("code",{children:$.name}),a.jsx("span",{children:$.desc}),$.permission==="external"&&s==="internal"&&a.jsx("span",{className:"lock-badge",children:" EXTERNO"})]},$.name))})]})},O=()=>{const L=[{action:"healthCheck",method:"GET",desc:"Status do backend"},{action:"getMetrics",method:"GET",desc:"Mtricas do Founder"},{action:"getTreasury",method:"GET",desc:"Dados do tesouro"},{action:"getUsers",method:"GET",desc:"Lista de usurios"},{action:"getErrors",method:"GET",desc:"Erros recentes"},{action:"getTransactions",method:"GET",desc:"Transaes"}];return a.jsxs("div",{className:"tool-content api-tool",children:[a.jsxs("div",{className:"api-url",children:["URL: ",a.jsx("code",{children:"https://script.google.com/macros/s/AKfycbze1Df7nl1ieEpUQD8uKsX5wtbOKOJS15prKVISz4P6tCRTqeG_V_EEZwjyg2OqOvU9/exec"})]}),a.jsx("div",{className:"api-endpoints",children:L.map($=>a.jsxs("div",{className:"api-endpoint",children:[a.jsx("span",{className:"api-method",children:$.method}),a.jsx("code",{children:$.action}),a.jsx("span",{className:"api-desc",children:$.desc}),a.jsx("button",{className:"btn-test",onClick:()=>console.log(` Testing ${$.action}... (mock response OK)`),children:" TEST"})]},$.action))})]})},R=()=>a.jsxs("div",{className:"tool-content treasury-tool",children:[a.jsxs("div",{className:"treasury-grid",children:[a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-label",children:"CIRCULANTE"}),a.jsx("span",{className:"treasury-value",children:"500K PC"})]}),a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-label",children:"RESERVA"}),a.jsx("span",{className:"treasury-value",children:"85%"})]}),a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-label",children:"INFLAO"}),a.jsx("span",{className:"treasury-value",children:"2.1%"})]}),a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-label",children:"DEFLAO"}),a.jsx("span",{className:"treasury-value",children:"1.8%"})]})]}),a.jsxs("div",{className:"treasury-status",children:[a.jsxs("span",{children:[" Balano: ",a.jsx("strong",{style:{color:"#4CAF50"},children:"SAUDVEL"})]}),a.jsx("span",{children:" Score: 92/100"})]})]}),j=()=>{const L=["Art.1  Distribuio justa de valor","Art.2  Transparncia total em transaes","Art.3  Privacidade do usurio","Art.4  Cdigo aberto para comunidade","Art.5  Sem vendor lock-in","Art.6  Founder tem voto de minerva"];return a.jsxs("div",{className:"tool-content constitution-tool",children:[a.jsxs("div",{className:"constitution-header",children:[a.jsx("h4",{children:" VERIFICAO CONSTITUCIONAL"}),a.jsx("button",{className:"btn-validate",onClick:()=>{L.forEach($=>console.log(`   ${$}`)),console.log(" Todas as verificaes passaram")},children:" VALIDAR"})]}),a.jsx("ul",{className:"articles-list",children:L.map(($,M)=>a.jsx("li",{children:$},M))})]})},A=()=>{const L=[{value:"youtube",label:" YouTube"},{value:"instagram",label:" Instagram"},{value:"tiktok",label:" TikTok"},{value:"twitter",label:" Twitter/X"},{value:"linkedin",label:" LinkedIn"},{value:"github",label:" GitHub"},{value:"telegram",label:" Telegram"},{value:"whatsapp",label:" WhatsApp"}],$=[{id:"panda-store",label:" Panda Store (nativo)",desc:"Split 52% via PagSeguro/Paddle"},{id:"kiwify",label:" Kiwify",desc:"Hook de sada  config do dev"},{id:"hotmart",label:" Hotmart",desc:"Hook de sada  config do dev"},{id:"github-pages",label:" GitHub Pages",desc:"Deploy landing page"},{id:"steam",label:" Steam",desc:"Link externo"},{id:"playstore",label:" Play Store",desc:"Link externo"}],M=(Q,ae)=>g(ue=>({...ue,[Q]:ae})),D=()=>g(Q=>({...Q,embedLinks:[...Q.embedLinks,{type:"youtube",url:""}]})),U=Q=>g(ae=>({...ae,embedLinks:ae.embedLinks.filter((ue,he)=>he!==Q)})),z=(Q,ae,ue)=>g(he=>({...he,embedLinks:he.embedLinks.map((_e,Pe)=>Pe===Q?{..._e,[ae]:ue}:_e)})),H=Q=>g(ae=>({...ae,outputHooks:ae.outputHooks.includes(Q)?ae.outputHooks.filter(ue=>ue!==Q):[...ae.outputHooks,Q]})),q=parseFloat(f.priceUSD)||0,V=q>0&&q<.5,ee=async()=>{if(!f.name.trim()){console.warn(" PUBLISH: Nome  obrigatrio");return}if(!f.namespace.trim()){console.warn(" PUBLISH: Namespace  obrigatrio (ex: @username/nome)");return}if(V){console.warn(" PUBLISH: Preo mnimo de venda  $0.50 (ou $0.00 para grtis)");return}x(!0),_(!1),v([]);const Q=f.category==="tentacle",ae=[{label:"Validando panda.mcp.json",duration:800},{label:"Static Analysis (Semgrep rules)",duration:1200},{label:"Dependency scan",duration:900},{label:`Sandbox test (30s${Q?" + Proxy SDK check":""})`,duration:1500},{label:"Calculando Defend Score",duration:1e3},{label:"Registrando na Medusa Store",duration:700}];for(let he=0;he<ae.length;he++){const _e=ae[he];v(nt=>[...nt,{index:he+1,total:ae.length,label:_e.label,status:"running",time:null}]),await new Promise(nt=>setTimeout(nt,_e.duration));const Pe=!(Q&&he===3&&f.namespace.includes("epic")),qt=`${(_e.duration/1e3).toFixed(1)}s`;if(v(nt=>nt.map((oe,Ge)=>Ge===he?{...oe,status:Pe?"pass":"fail",time:qt}:oe)),!Pe){v(nt=>[...nt,{index:0,total:0,label:" PUBLICAO ABORTADA  Sandbox test falhou",status:"abort",time:null}]),x(!1),_(!0),console.error(" PUBLISH:  Falha no sandbox test  publicao abortada");return}}const ue=Q?74:92;v(he=>[...he,{index:0,total:0,label:`
 DEFEND SCORE: ${ue}/100  ${ue>=70?"APROVADO":"REJEITADO"}`,status:ue>=70?"final-pass":"final-fail",time:null},{index:0,total:0,label:` Mdulo "${f.name}" registrado na Medusa Store! (mock)`,status:"info",time:null}]),x(!1),_(!0),console.log(` PUBLISH:  Score ${ue}/100  Mdulo registrado (mock)`)};return a.jsx("div",{className:"tool-content publish-tool",children:a.jsxs("div",{className:"publish-form",children:[a.jsxs("div",{className:"publish-section",children:[a.jsx("div",{className:"publish-section-title",children:" Informaes Bsicas"}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Nome do Mdulo"}),a.jsx("input",{type:"text",placeholder:"Meu Mdulo Incrvel",value:f.name,onChange:Q=>M("name",Q.target.value)})]}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Namespace"}),a.jsx("input",{type:"text",placeholder:"@username/meu-modulo",value:f.namespace,onChange:Q=>M("namespace",Q.target.value)})]}),a.jsxs("div",{className:"publish-row",children:[a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Tipo"}),a.jsxs("select",{value:f.category,onChange:Q=>M("category",Q.target.value),children:[a.jsx("option",{value:"module",children:" Mdulo"}),a.jsx("option",{value:"tentacle",children:" Tentculo"}),a.jsx("option",{value:"theme",children:" Theme"})]})]}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Preo (USD)"}),a.jsx("input",{type:"number",min:"0",step:"0.01",placeholder:"0.00",value:f.priceUSD,onChange:Q=>M("priceUSD",Q.target.value)})]}),V&&a.jsxs("div",{style:{marginTop:6,padding:"6px 10px",borderRadius:6,background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.25)",fontSize:12,color:"#ef4444"},children:[" Preo mnimo de venda: ",a.jsx("strong",{children:"$0.50"}),"  Publicar  grtis, mas mdulos pagos devem custar no mnimo $0.50. Use $0.00 para distribuio gratuita."]})]})]}),q>0&&!V&&a.jsxs("div",{className:"publish-section",style:{background:"rgba(16,185,129,0.06)",border:"1px solid rgba(16,185,129,0.2)",borderRadius:8},children:[a.jsx("div",{className:"publish-section-title",style:{color:"#10b981"},children:" Revenue Split (USD-FIRST)"}),a.jsxs("div",{style:{fontSize:13,lineHeight:1.7,color:"#e2e8f0",padding:"0 8px"},children:[a.jsxs("table",{style:{width:"100%",fontSize:12,borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(100,116,139,0.2)"},children:[a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Destinatrio"}),a.jsx("th",{style:{textAlign:"center",padding:"4px 8px",color:"#94a3b8"},children:"%"}),a.jsx("th",{style:{textAlign:"right",padding:"4px 8px",color:"#94a3b8"},children:"Valor/venda"})]})}),a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Desenvolvedor"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"55%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",color:"#10b981",fontWeight:700},children:["$",(q*.55).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Educao"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"22%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right"},children:["$",(q*.22).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Operaes"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"15%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right"},children:["$",(q*.15).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Founder"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"5%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right"},children:["$",(q*.05).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Taxas"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"3%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right"},children:["$",(q*.03).toFixed(2)]})]})]})]}),a.jsxs("p",{style:{margin:"8px 0 0",fontSize:11,color:"#64748b"},children:["Preo USD convertido para PC no momento da compra. Publicar  ",a.jsx("strong",{children:"GRTIS"}),"."]})]})]}),f.category==="tentacle"&&a.jsxs("div",{className:"publish-section",style:{background:"rgba(245,158,11,0.06)",border:"1px solid rgba(245,158,11,0.25)",borderRadius:8},children:[a.jsx("div",{className:"publish-section-title",style:{color:"#f59e0b"},children:" AVISO: TENTCULO  Nvel de Blindagem Alto"}),a.jsxs("div",{style:{fontSize:13,lineHeight:1.7,color:"#e2e8f0",padding:"0 8px"},children:[a.jsxs("p",{style:{margin:"0 0 10px"},children:["Tentculos acessam APIs do sistema via ",a.jsx("strong",{children:"Proxy SDK"})," em",a.jsx("strong",{children:" iframe blindado"}),". Requerem sandbox forte, permisses explcitas no manifest, e passam pelo ",a.jsx("strong",{children:"Panda Defend Score  70"})," para aprovao."]}),a.jsxs("table",{style:{width:"100%",fontSize:12,borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(100,116,139,0.2)"},children:[a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Nvel"}),a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Exemplo"}),a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Aprovao"})]})}),a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Baixo"}),a.jsx("td",{style:{padding:"4px 8px",fontFamily:"monospace",fontSize:11},children:"panda.ui.toast, panda.data.read"}),a.jsx("td",{style:{padding:"4px 8px"},children:"Auto-approve"})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Mdio"}),a.jsx("td",{style:{padding:"4px 8px",fontFamily:"monospace",fontSize:11},children:"panda.data.write, panda.store.state"}),a.jsx("td",{style:{padding:"4px 8px"},children:"Auto + auditoria"})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Alto"}),a.jsx("td",{style:{padding:"4px 8px",fontFamily:"monospace",fontSize:11},children:"panda.wallet.send, panda.auth.modify"}),a.jsx("td",{style:{padding:"4px 8px"},children:"Founder review"})]})]})]}),a.jsxs("p",{style:{margin:"10px 0 0",fontSize:12,color:"#f59e0b"},children:[" Regras de Blindagem: ",a.jsx("code",{children:"eval()"}),", ",a.jsx("code",{children:"document.write()"})," e ",a.jsx("code",{children:"fetch()"}),"sem ",a.jsx("code",{children:"Panda.Bridge"})," so ",a.jsx("strong",{children:"bloqueados automaticamente"}),"."]})]})]}),a.jsxs("div",{className:"publish-section",children:[a.jsx("div",{className:"publish-section-title",children:" Descries"}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Descrio Breve (card)"}),a.jsx("input",{type:"text",placeholder:"Resumo curto para o card da Store",value:f.description,onChange:Q=>M("description",Q.target.value)})]}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Descrio Completa (PDP)"}),a.jsx("textarea",{rows:4,placeholder:"Descrio completa com features, detalhes e diferenciais...",value:f.fullDescription,onChange:Q=>M("fullDescription",Q.target.value)})]})]}),a.jsxs("div",{className:"publish-section",children:[a.jsxs("div",{className:"publish-section-title",children:[" Embed Links",a.jsx("button",{className:"btn-add-embed",onClick:D,children:"+ Adicionar"})]}),f.embedLinks.length===0?a.jsx("div",{className:"publish-empty",children:'Nenhum embed. Clique "+ Adicionar" para incluir links de mdia.'}):f.embedLinks.map((Q,ae)=>a.jsxs("div",{className:"embed-row",children:[a.jsx("select",{value:Q.type,onChange:ue=>z(ae,"type",ue.target.value),children:L.map(ue=>a.jsx("option",{value:ue.value,children:ue.label},ue.value))}),a.jsx("input",{type:"url",placeholder:"https://...",value:Q.url,onChange:ue=>z(ae,"url",ue.target.value)}),a.jsx("button",{className:"btn-remove",onClick:()=>U(ae),children:""})]},ae))]}),a.jsxs("div",{className:"publish-section",children:[a.jsx("div",{className:"publish-section-title",children:" Hooks de Sada (Distribuio)"}),a.jsx("div",{className:"hooks-grid",children:$.map(Q=>a.jsxs("label",{className:`hook-option ${f.outputHooks.includes(Q.id)?"selected":""}`,children:[a.jsx("input",{type:"checkbox",checked:f.outputHooks.includes(Q.id),onChange:()=>H(Q.id)}),a.jsx("span",{className:"hook-label",children:Q.label}),a.jsx("span",{className:"hook-desc",children:Q.desc})]},Q.id))})]}),a.jsx("button",{className:"btn-publish",onClick:ee,disabled:y,style:y?{opacity:.5,cursor:"not-allowed"}:{},children:y?" VERIFICAO EM ANDAMENTO...":" PUBLICAR NA MEDUSA STORE"}),(y||w)&&a.jsxs("div",{style:{marginTop:12,background:"#0c0c0c",border:"1px solid #333",borderRadius:8,padding:"14px 16px",fontFamily:"'JetBrains Mono', 'Cascadia Code', 'Consolas', monospace",fontSize:12,lineHeight:1.8,maxHeight:260,overflowY:"auto"},children:[a.jsxs("div",{style:{color:"#6366f1",marginBottom:8,fontWeight:700},children:['PS C:\\PandaFactory\\Medusa> publish-verify --module "',f.name||"...",'"']}),m.map((Q,ae)=>a.jsxs("div",{style:{color:Q.status==="running"?"#fbbf24":Q.status==="pass"?"#10b981":Q.status==="fail"||Q.status==="abort"?"#ef4444":Q.status==="final-pass"?"#10b981":Q.status==="final-fail"?"#ef4444":"#94a3b8",whiteSpace:"pre-wrap"},children:[Q.index>0&&a.jsxs("span",{style:{color:"#64748b"},children:["[STEP ",Q.index,"/",Q.total,"] "]}),Q.status==="running"&&" ",Q.status==="pass"&&" ",Q.status==="fail"&&" ",Q.label,Q.time&&a.jsxs("span",{style:{color:"#64748b"},children:[" (",Q.time,")"]})]},ae)),y&&a.jsx("div",{style:{color:"#fbbf24",animation:"pulse 1s infinite"},children:""})]}),w&&a.jsx("button",{className:"btn-add-embed",style:{marginTop:8,width:"100%"},onClick:()=>{_(!1),v([])},children:" Nova Publicao"})]})})};if(!t)return null;const B=a.jsxs("div",{className:`devmode-panel ${n?"embedded":""}`,onClick:L=>L.stopPropagation(),children:[a.jsxs("header",{className:"devmode-header",children:[a.jsx("h2",{children:" DEV MODE"}),a.jsxs("div",{className:"mcp-toggle-compact",children:[a.jsx("span",{className:s==="internal"?"active":"",children:" INTERNO"}),a.jsx("button",{className:"toggle-switch",onClick:I,children:a.jsx("span",{className:`switch-dot ${s}`})}),a.jsx("span",{className:s==="external"?"active":"",children:" EXTERNO"})]}),!n&&a.jsx("button",{className:"btn-close",onClick:e,children:""})]}),a.jsxs("div",{className:"devmode-body",children:[a.jsxs("div",{className:"devmode-tools",children:[a.jsx("div",{className:"section-label",children:"FERRAMENTAS"}),a.jsx("div",{className:"tools-grid",children:mTe.map(L=>a.jsxs("button",{className:`tool-card ${(r==null?void 0:r.id)===L.id?"active":""} ${L.status==="future"?"future":""}`,onClick:()=>T(L),title:L.desc,children:[a.jsx("span",{className:"tool-icon",children:L.icon}),a.jsx("span",{className:"tool-name",children:L.name}),L.status==="future"&&a.jsx("span",{className:"future-badge",children:"SOON"})]},L.id))}),a.jsx("div",{className:"section-label",children:"INTEGRAES"}),a.jsx("div",{className:"integrations-row",children:yTe.map(L=>a.jsxs("div",{className:`int-chip ${h[L.id]||"unknown"}`,title:L.name,children:[a.jsx("span",{children:L.icon}),a.jsx("span",{className:"int-label",children:L.id.toUpperCase()}),a.jsx("span",{className:`int-dot ${h[L.id]||"unknown"}`})]},L.id))})]}),a.jsx("div",{className:"devmode-tool-view",children:r?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"tool-view-header",children:[a.jsxs("span",{children:[r.icon," ",r.name]}),a.jsx("small",{children:r.desc})]}),P()]}):a.jsxs("div",{className:"tool-placeholder",children:[a.jsx("span",{className:"placeholder-icon",children:""}),a.jsx("p",{children:"Selecione uma ferramenta"}),a.jsx("small",{children:"Console, MCP Browser, API Tester..."})]})})]}),a.jsxs("footer",{className:"devmode-footer",children:[a.jsx("span",{children:"Panda Dev Tools v3.0"}),a.jsxs("span",{className:"footer-mcp",children:["MCP: ",s.toUpperCase()]})]})]});return n?B:a.jsx("div",{className:"devmode-overlay",onClick:e,children:B})}const xTe=[{id:1,title:"Identidade",desc:"Agente representa o ecossistema, no a si mesmo",check:()=>!0},{id:2,title:"Valores Fundamentais",desc:"Democratizao, Colaborao, Humildade, Transparncia",check:()=>!0},{id:3,title:"Comunicao",desc:"Tom acessvel, sem arrogncia, sem spam",check:()=>!0},{id:4,title:"Limites Absolutos",desc:"Nunca expor credenciais, infra, dados pessoais",check:()=>!0},{id:5,title:"Comportamento Autnomo",desc:"Heartbeat 4h, posts sem limite (exceto red lines)",check:()=>!0},{id:6,title:"Objetivo Maior",desc:"Comunidade onde devs so valorizados e participam do valor",check:()=>!0},{id:7,title:"Auto-Conhecimento",desc:"Ferramenta, no pessoa. Limitado pelo treinamento",check:()=>!0},{id:8,title:"Atualizaes",desc:"S o Founder pode alterar a Constituio",check:()=>!0},{id:9,title:"Splits Inviolveis",desc:"95% Dev, 5% Panda  hardcoded",check:()=>!0},{id:10,title:"Kill Switch",desc:"Founder sempre mantm controle total",check:()=>!0},{id:11,title:"Ed25519 Auth",desc:"Operaes crticas requerem assinatura criptogrfica",check:()=>typeof window.Panda<"u"},{id:12,title:"Health Gate",desc:"Sem operaes durante Health Score < 50%",check:()=>!0}],STe=[{id:"freeze_treasury",icon:"",label:"Freeze Treasury",desc:"Congelar todas transaes"},{id:"disable_brain",icon:"",label:"Disable Brain",desc:"Desligar IA pblica"},{id:"lock_store",icon:"",label:"Lock Store",desc:"Fechar marketplace"},{id:"emergency_backup",icon:"",label:"Emergency Backup",desc:"Backup imediato"}];function bTe({isOpen:t,onClose:e,activeTool:n="treasury",embedded:s=!1}){const[i,r]=S.useState(n),[o,l]=S.useState(null),[c,d]=S.useState([]),[u,h]=S.useState([]);if(S.useEffect(()=>{(n==="treasury"||n==="constitution"||n==="rig")&&r(n)},[n]),S.useEffect(()=>{if(!s&&!t)return;(async()=>{var T,P;try{if((P=(T=window.Panda)==null?void 0:T.PAT)!=null&&P.getStatus){const k=await window.Panda.PAT.getStatus();l(k)}else l({inflation:.02,reserve:23e5,deflation:.005,circulatingSupply:52e5,timestamp:Date.now()})}catch(k){console.warn(" PAT: Status fetch failed:",k.message)}})();const I=xTe.map(T=>({...T,passed:T.check()}));d(I),h([{time:"Agora",action:" Panel opened by Founder",level:"L1"},{time:"5min atrs",action:" Treasury sync completed",level:"L1"},{time:"1h atrs",action:" Constitution validated (12/12)",level:"L2"},{time:"4h atrs",action:" Heartbeat check: all systems healthy",level:"L1"},{time:"12h atrs",action:" Panda Defend scan: 0 threats",level:"L2"}])},[t,s]),!s&&!t)return null;const p=o?Math.round(o.reserve/(o.circulatingSupply*.5)*100):92,f=Math.min(100,p),g=282.7,y=g-f/100*g,x=[{icon:"",label:"PAXG (Ouro)",value:"$1,500,000",pct:"65%"},{icon:"",label:"USDC (Stablecoin)",value:"$700,000",pct:"30%"},{icon:"",label:"Liquidez Ops",value:"$100,000",pct:"5%"},{icon:"",label:"Em Staking",value:"$50,000",pct:"+2.1%"}],m=c.filter(C=>C.passed).length,v=c.length,w=async C=>{var T,P;if(window.confirm(` AO CRTICA: ${C}

Esta ao requer autenticao Ed25519 + PIN.

Em modo mock, a ao ser simulada.

Continuar?`)){if((P=(T=window.Panda)==null?void 0:T.PAT)!=null&&P.execute){const k=await window.Panda.PAT.execute(C);console.log(" PAT Kill Switch:",k)}else console.log(` PAT Kill Switch [MOCK]: ${C} executed`);h(k=>[{time:"Agora",action:` Kill Switch: ${C}`,level:"L4"},...k])}},_=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"pat-header",children:[a.jsxs("div",{className:"pat-header-title",children:[a.jsx("span",{style:{fontSize:28},children:""}),a.jsx("h2",{children:"Panda Council"}),a.jsx("span",{className:"pat-header-badge",children:"PAT v1.0"})]}),!s&&a.jsx("button",{className:"pat-close",onClick:e,children:""})]}),a.jsxs("div",{className:"pat-tabs",children:[a.jsx("button",{className:`pat-tab ${i==="treasury"?"active":""}`,onClick:()=>r("treasury"),children:" Treasury"}),a.jsxs("button",{className:`pat-tab ${i==="constitution"?"active":""}`,onClick:()=>r("constitution"),children:[" Constitution (",m,"/",v,")"]}),a.jsx("button",{className:`pat-tab ${i==="rig"?"active":""}`,onClick:()=>r("rig"),children:" Governance"})]}),i==="treasury"&&a.jsxs("div",{children:[a.jsxs("div",{className:"pat-health-card",children:[a.jsxs("div",{className:"pat-health-ring",children:[a.jsxs("svg",{width:"100",height:"100",viewBox:"0 0 100 100",children:[a.jsx("circle",{className:"pat-health-ring-bg",cx:"50",cy:"50",r:"45"}),a.jsx("circle",{className:"pat-health-ring-fill",cx:"50",cy:"50",r:"45",strokeDasharray:g,strokeDashoffset:y,style:{stroke:f>80?"#10b981":f>60?"#f59e0b":"#ef4444"}})]}),a.jsxs("div",{className:"pat-health-ring-text",children:[a.jsxs("div",{className:"pat-health-value",children:[f,"%"]}),a.jsx("div",{className:"pat-health-label",children:"Health"})]})]}),a.jsxs("div",{className:"pat-health-metrics",children:[a.jsxs("div",{className:"pat-metric-row",children:[a.jsx("span",{className:"pat-metric-label",children:"Reserva vs Circulante"}),a.jsx("div",{className:"pat-metric-bar",children:a.jsx("div",{className:"pat-metric-fill",style:{width:"85%",background:"#10b981"}})}),a.jsx("span",{className:"pat-metric-value",children:"85%"})]}),a.jsxs("div",{className:"pat-metric-row",children:[a.jsx("span",{className:"pat-metric-label",children:"Runway (dias)"}),a.jsx("div",{className:"pat-metric-bar",children:a.jsx("div",{className:"pat-metric-fill",style:{width:"100%",background:"#667eea"}})}),a.jsx("span",{className:"pat-metric-value",children:"120d"})]}),a.jsxs("div",{className:"pat-metric-row",children:[a.jsx("span",{className:"pat-metric-label",children:"Diversificao"}),a.jsx("div",{className:"pat-metric-bar",children:a.jsx("div",{className:"pat-metric-fill",style:{width:"80%",background:"#f59e0b"}})}),a.jsx("span",{className:"pat-metric-value",children:"80%"})]}),a.jsxs("div",{className:"pat-metric-row",children:[a.jsx("span",{className:"pat-metric-label",children:"Inflao"}),a.jsx("div",{className:"pat-metric-bar",children:a.jsx("div",{className:"pat-metric-fill",style:{width:`${((o==null?void 0:o.inflation)||.02)*1e3}%`,background:"#8b5cf6"}})}),a.jsxs("span",{className:"pat-metric-value",children:[(((o==null?void 0:o.inflation)||.02)*100).toFixed(1),"%"]})]})]})]}),a.jsx("div",{className:"pat-section-title",children:" Composio da Reserva"}),a.jsx("div",{className:"pat-reserve-grid",children:x.map(C=>a.jsxs("div",{className:"pat-reserve-card",children:[a.jsx("div",{className:"pat-reserve-icon",children:C.icon}),a.jsx("div",{className:"pat-reserve-label",children:C.label}),a.jsx("div",{className:"pat-reserve-value",children:C.value}),a.jsx("div",{className:"pat-reserve-pct",children:C.pct})]},C.label))}),a.jsxs("div",{className:"pat-total-banner",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pat-total-label",children:"Reserva Total"}),a.jsx("div",{className:"pat-total-value",children:"$2,350,000"})]}),a.jsxs("div",{style:{textAlign:"right"},children:[a.jsx("div",{className:"pat-total-label",children:"Circulante"}),a.jsxs("div",{style:{fontSize:18,fontWeight:600},children:[(((o==null?void 0:o.circulatingSupply)||52e5)/1e6).toFixed(1),"M PC"]})]})]})]}),i==="constitution"&&a.jsxs("div",{children:[a.jsxs("div",{className:"pat-section-title",children:[" Validao dos 12 Artigos  ",m,"/",v," OK"]}),a.jsx("ul",{className:"pat-constitution-list",children:c.map(C=>a.jsxs("li",{className:"pat-article",children:[a.jsx("div",{className:`pat-article-status ${C.passed?"ok":"fail"}`,children:C.passed?"":""}),a.jsxs("div",{className:"pat-article-info",children:[a.jsxs("div",{className:"pat-article-title",children:["Art. ",C.id,"  ",C.title]}),a.jsx("div",{className:"pat-article-desc",children:C.desc})]})]},C.id))})]}),i==="rig"&&a.jsxs("div",{children:[a.jsxs("div",{className:"pat-killswitch-section",children:[a.jsxs("div",{className:"pat-killswitch-header",children:[a.jsx("span",{style:{fontSize:24},children:""}),a.jsx("h3",{children:"Kill Switch (L4  Ed25519 + PIN)"})]}),a.jsx("div",{className:"pat-killswitch-grid",children:STe.map(C=>a.jsxs("button",{className:"pat-killswitch-btn",onClick:()=>w(C.id),title:C.desc,children:[a.jsx("span",{className:"icon",children:C.icon}),C.label]},C.id))})]}),a.jsxs("div",{style:{marginTop:20},children:[a.jsx("div",{className:"pat-section-title",children:" Audit Log (Imutvel)"}),u.map((C,I)=>a.jsxs("div",{className:"pat-audit-row",children:[a.jsx("span",{className:"pat-audit-label",children:C.time}),a.jsx("span",{className:"pat-audit-value",children:C.action}),a.jsx("span",{className:"pat-audit-label",children:C.level})]},I))]}),a.jsxs("div",{style:{marginTop:16},children:[a.jsx("div",{className:"pat-section-title",children:" Nveis de Autenticao"}),[{level:"L1",desc:"View  Ver logs, status",req:"Nenhum"},{level:"L2",desc:"Suggest  Propor mudanas",req:"Session Token"},{level:"L3",desc:"Execute  Transaes < 1000 PC",req:"Ed25519"},{level:"L4",desc:"Critical  Kill Switch, > 1000 PC",req:"Ed25519 + PIN"},{level:"L5",desc:"Emergency  Violao Constituio",req:"Ed25519 + PIN + Bypass"}].map(C=>a.jsxs("div",{className:"pat-audit-row",children:[a.jsx("span",{className:"pat-audit-value",children:C.level}),a.jsx("span",{className:"pat-audit-label",style:{flex:1,padding:"0 12px"},children:C.desc}),a.jsx("span",{style:{color:"#667eea",fontSize:11},children:C.req})]},C.level))]})]})]});return s?a.jsx("div",{className:"pat-panel",style:{position:"relative",width:"100%",height:"100%",overflow:"auto"},children:_}):a.jsx("div",{className:"pat-overlay",onClick:e,children:a.jsx("div",{className:"pat-panel",onClick:C=>C.stopPropagation(),children:_})})}var wTe=Object.defineProperty,_Te=(t,e,n)=>e in t?wTe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Y=(t,e,n)=>_Te(t,typeof e!="symbol"?e+"":e,n);const qp=class my{constructor(e){Y(this,"_name"),this._name=e}static flip(e){return e===my.HORZ?my.VERT:my.HORZ}getName(){return this._name}toString(){return this._name}};Y(qp,"HORZ",new qp("horz"));Y(qp,"VERT",new qp("vert"));let Me=qp;class Ee{constructor(e,n,s,i){Y(this,"x"),Y(this,"y"),Y(this,"width"),Y(this,"height"),this.x=e,this.y=n,this.width=s,this.height=i}static empty(){return new Ee(0,0,0,0)}static fromJson(e){return new Ee(e.x,e.y,e.width,e.height)}toJson(){return{x:this.x,y:this.y,width:this.width,height:this.height}}snap(e){this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this.width=Math.round(this.width/e)*e,this.height=Math.round(this.height/e)*e}static getBoundingClientRect(e){const{x:n,y:s,width:i,height:r}=e.getBoundingClientRect();return new Ee(n,s,i,r)}static getContentRect(e){const n=e.getBoundingClientRect(),s=window.getComputedStyle(e),i=parseFloat(s.paddingLeft),r=parseFloat(s.paddingRight),o=parseFloat(s.paddingTop),l=parseFloat(s.paddingBottom),c=parseFloat(s.borderLeftWidth),d=parseFloat(s.borderRightWidth),u=parseFloat(s.borderTopWidth),h=parseFloat(s.borderBottomWidth),p=n.width-c-i-r-d,f=n.height-u-o-l-h;return new Ee(n.left+c+i,n.top+u+o,p,f)}static fromDomRect(e){return new Ee(e.x,e.y,e.width,e.height)}relativeTo(e){return new Ee(this.x-e.x,this.y-e.y,this.width,this.height)}clone(){return new Ee(this.x,this.y,this.width,this.height)}equals(e){return this.x===(e==null?void 0:e.x)&&this.y===(e==null?void 0:e.y)&&this.width===(e==null?void 0:e.width)&&this.height===(e==null?void 0:e.height)}equalSize(e){return this.width===(e==null?void 0:e.width)&&this.height===(e==null?void 0:e.height)}getBottom(){return this.y+this.height}getRight(){return this.x+this.width}get bottom(){return this.y+this.height}get right(){return this.x+this.width}getCenter(){return{x:this.x+this.width/2,y:this.y+this.height/2}}positionElement(e,n){this.styleWithPosition(e.style,n)}styleWithPosition(e,n="absolute"){return e.left=this.x+"px",e.top=this.y+"px",e.width=Math.max(0,this.width)+"px",e.height=Math.max(0,this.height)+"px",e.position=n,e}contains(e,n){return this.x<=e&&e<=this.getRight()&&this.y<=n&&n<=this.getBottom()}removeInsets(e){return new Ee(this.x+e.left,this.y+e.top,Math.max(0,this.width-e.left-e.right),Math.max(0,this.height-e.top-e.bottom))}centerInRect(e){this.x=(e.width-this.width)/2,this.y=(e.height-this.height)/2}_getSize(e){let n=this.width;return e===Me.VERT&&(n=this.height),n}toString(){return"(Rect: x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"}}const Oi=class Bt{constructor(e,n,s){Y(this,"name"),Y(this,"orientation"),Y(this,"indexPlus"),this.name=e,this.orientation=n,this.indexPlus=s,Bt.values.set(this.name,this)}static getByName(e){return Bt.values.get(e)}static getLocation(e,n,s){if(n=(n-e.x)/e.width,s=(s-e.y)/e.height,n>=.25&&n<.75&&s>=.25&&s<.75)return Bt.CENTER;const i=s>=n,r=s>=1-n;return i?r?Bt.BOTTOM:Bt.LEFT:r?Bt.RIGHT:Bt.TOP}getName(){return this.name}getOrientation(){return this.orientation}getDockRect(e){return this===Bt.TOP?new Ee(e.x,e.y,e.width,e.height/2):this===Bt.BOTTOM?new Ee(e.x,e.getBottom()-e.height/2,e.width,e.height/2):this===Bt.LEFT?new Ee(e.x,e.y,e.width/2,e.height):this===Bt.RIGHT?new Ee(e.getRight()-e.width/2,e.y,e.width/2,e.height):e.clone()}split(e,n){if(this===Bt.TOP){const s=new Ee(e.x,e.y,e.width,n),i=new Ee(e.x,e.y+n,e.width,e.height-n);return{start:s,end:i}}else if(this===Bt.LEFT){const s=new Ee(e.x,e.y,n,e.height),i=new Ee(e.x+n,e.y,e.width-n,e.height);return{start:s,end:i}}if(this===Bt.RIGHT){const s=new Ee(e.getRight()-n,e.y,n,e.height),i=new Ee(e.x,e.y,e.width-n,e.height);return{start:s,end:i}}else{const s=new Ee(e.x,e.getBottom()-n,e.width,n),i=new Ee(e.x,e.y,e.width,e.height-n);return{start:s,end:i}}}reflect(){return this===Bt.TOP?Bt.BOTTOM:this===Bt.LEFT?Bt.RIGHT:this===Bt.RIGHT?Bt.LEFT:Bt.TOP}toString(){return"(DockLocation: name="+this.name+", orientation="+this.orientation+")"}};Y(Oi,"values",new Map);Y(Oi,"TOP",new Oi("top",Me.VERT,0));Y(Oi,"BOTTOM",new Oi("bottom",Me.VERT,1));Y(Oi,"LEFT",new Oi("left",Me.HORZ,0));Y(Oi,"RIGHT",new Oi("right",Me.HORZ,1));Y(Oi,"CENTER",new Oi("center",Me.VERT,0));let ce=Oi;var Kn=(t=>(t.Close_Tab="Close",t.Close_Tabset="Close tab set",t.Active_Tabset="Active tab set",t.Move_Tabset="Move tab set",t.Move_Tabs="Move tabs(?)",t.Maximize="Maximize tab set",t.Restore="Restore tab set",t.Popout_Tab="Popout selected tab",t.Overflow_Menu_Tooltip="Hidden tabs",t.Error_rendering_component="Error rendering component",t.Error_rendering_component_retry="Retry",t))(Kn||{}),J=(t=>(t.FLEXLAYOUT__BORDER="flexlayout__border",t.FLEXLAYOUT__BORDER_="flexlayout__border_",t.FLEXLAYOUT__BORDER_TAB_CONTENTS="flexlayout__border_tab_contents",t.FLEXLAYOUT__BORDER_BUTTON="flexlayout__border_button",t.FLEXLAYOUT__BORDER_BUTTON_="flexlayout__border_button_",t.FLEXLAYOUT__BORDER_BUTTON_CONTENT="flexlayout__border_button_content",t.FLEXLAYOUT__BORDER_BUTTON_LEADING="flexlayout__border_button_leading",t.FLEXLAYOUT__BORDER_BUTTON_TRAILING="flexlayout__border_button_trailing",t.FLEXLAYOUT__BORDER_BUTTON__SELECTED="flexlayout__border_button--selected",t.FLEXLAYOUT__BORDER_BUTTON__UNSELECTED="flexlayout__border_button--unselected",t.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW="flexlayout__border_toolbar_button_overflow",t.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW_="flexlayout__border_toolbar_button_overflow_",t.FLEXLAYOUT__BORDER_INNER="flexlayout__border_inner",t.FLEXLAYOUT__BORDER_INNER_="flexlayout__border_inner_",t.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER="flexlayout__border_inner_tab_container",t.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER_="flexlayout__border_inner_tab_container_",t.FLEXLAYOUT__BORDER_TAB_DIVIDER="flexlayout__border_tab_divider",t.FLEXLAYOUT__BORDER_LEADING="flexlayout__border_leading",t.FLEXLAYOUT__BORDER_SIZER="flexlayout__border_sizer",t.FLEXLAYOUT__BORDER_TOOLBAR="flexlayout__border_toolbar",t.FLEXLAYOUT__BORDER_TOOLBAR_="flexlayout__border_toolbar_",t.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON="flexlayout__border_toolbar_button",t.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_FLOAT="flexlayout__border_toolbar_button-float",t.FLEXLAYOUT__DRAG_RECT="flexlayout__drag_rect",t.FLEXLAYOUT__EDGE_RECT="flexlayout__edge_rect",t.FLEXLAYOUT__EDGE_RECT_TOP="flexlayout__edge_rect_top",t.FLEXLAYOUT__EDGE_RECT_LEFT="flexlayout__edge_rect_left",t.FLEXLAYOUT__EDGE_RECT_BOTTOM="flexlayout__edge_rect_bottom",t.FLEXLAYOUT__EDGE_RECT_RIGHT="flexlayout__edge_rect_right",t.FLEXLAYOUT__ERROR_BOUNDARY_CONTAINER="flexlayout__error_boundary_container",t.FLEXLAYOUT__ERROR_BOUNDARY_CONTENT="flexlayout__error_boundary_content",t.FLEXLAYOUT__FLOATING_WINDOW_CONTENT="flexlayout__floating_window_content",t.FLEXLAYOUT__LAYOUT="flexlayout__layout",t.FLEXLAYOUT__LAYOUT_MOVEABLES="flexlayout__layout_moveables",t.FLEXLAYOUT__LAYOUT_OVERLAY="flexlayout__layout_overlay",t.FLEXLAYOUT__LAYOUT_TAB_STAMPS="flexlayout__layout_tab_stamps",t.FLEXLAYOUT__LAYOUT_MAIN="flexlayout__layout_main",t.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER="flexlayout__layout_border_container",t.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER_INNER="flexlayout__layout_border_container_inner",t.FLEXLAYOUT__OUTLINE_RECT="flexlayout__outline_rect",t.FLEXLAYOUT__OUTLINE_RECT_EDGE="flexlayout__outline_rect_edge",t.FLEXLAYOUT__SPLITTER="flexlayout__splitter",t.FLEXLAYOUT__SPLITTER_EXTRA="flexlayout__splitter_extra",t.FLEXLAYOUT__SPLITTER_="flexlayout__splitter_",t.FLEXLAYOUT__SPLITTER_BORDER="flexlayout__splitter_border",t.FLEXLAYOUT__SPLITTER_DRAG="flexlayout__splitter_drag",t.FLEXLAYOUT__SPLITTER_HANDLE="flexlayout__splitter_handle",t.FLEXLAYOUT__SPLITTER_HANDLE_HORZ="flexlayout__splitter_handle_horz",t.FLEXLAYOUT__SPLITTER_HANDLE_VERT="flexlayout__splitter_handle_vert",t.FLEXLAYOUT__ROW="flexlayout__row",t.FLEXLAYOUT__TAB="flexlayout__tab",t.FLEXLAYOUT__TAB_POSITION="flexlayout__tab_position",t.FLEXLAYOUT__TAB_MOVEABLE="flexlayout__tab_moveable",t.FLEXLAYOUT__TAB_OVERLAY="flexlayout__tab_overlay",t.FLEXLAYOUT__TABSET="flexlayout__tabset",t.FLEXLAYOUT__TABSET_CONTAINER="flexlayout__tabset_container",t.FLEXLAYOUT__TABSET_HEADER="flexlayout__tabset_header",t.FLEXLAYOUT__TABSET_HEADER_CONTENT="flexlayout__tabset_header_content",t.FLEXLAYOUT__TABSET_MAXIMIZED="flexlayout__tabset-maximized",t.FLEXLAYOUT__TABSET_SELECTED="flexlayout__tabset-selected",t.FLEXLAYOUT__TABSET_TAB_DIVIDER="flexlayout__tabset_tab_divider",t.FLEXLAYOUT__TABSET_CONTENT="flexlayout__tabset_content",t.FLEXLAYOUT__TABSET_TABBAR_INNER="flexlayout__tabset_tabbar_inner",t.FLEXLAYOUT__TABSET_TABBAR_INNER_="flexlayout__tabset_tabbar_inner_",t.FLEXLAYOUT__TABSET_LEADING="flexlayout__tabset_leading",t.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER="flexlayout__tabset_tabbar_inner_tab_container",t.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER_="flexlayout__tabset_tabbar_inner_tab_container_",t.FLEXLAYOUT__TABSET_TABBAR_OUTER="flexlayout__tabset_tabbar_outer",t.FLEXLAYOUT__TABSET_TABBAR_OUTER_="flexlayout__tabset_tabbar_outer_",t.FLEXLAYOUT__TAB_BORDER="flexlayout__tab_border",t.FLEXLAYOUT__TAB_BORDER_="flexlayout__tab_border_",t.FLEXLAYOUT__TAB_BUTTON="flexlayout__tab_button",t.FLEXLAYOUT__TAB_BUTTON_STRETCH="flexlayout__tab_button_stretch",t.FLEXLAYOUT__TAB_BUTTON_CONTENT="flexlayout__tab_button_content",t.FLEXLAYOUT__TAB_BUTTON_LEADING="flexlayout__tab_button_leading",t.FLEXLAYOUT__TAB_BUTTON_OVERFLOW="flexlayout__tab_button_overflow",t.FLEXLAYOUT__TAB_BUTTON_OVERFLOW_COUNT="flexlayout__tab_button_overflow_count",t.FLEXLAYOUT__TAB_BUTTON_TEXTBOX="flexlayout__tab_button_textbox",t.FLEXLAYOUT__TAB_BUTTON_TRAILING="flexlayout__tab_button_trailing",t.FLEXLAYOUT__TAB_BUTTON_STAMP="flexlayout__tab_button_stamp",t.FLEXLAYOUT__TAB_TOOLBAR="flexlayout__tab_toolbar",t.FLEXLAYOUT__TAB_TOOLBAR_BUTTON="flexlayout__tab_toolbar_button",t.FLEXLAYOUT__TAB_TOOLBAR_ICON="flexlayout__tab_toolbar_icon",t.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_="flexlayout__tab_toolbar_button-",t.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_FLOAT="flexlayout__tab_toolbar_button-float",t.FLEXLAYOUT__TAB_TOOLBAR_STICKY_BUTTONS_CONTAINER="flexlayout__tab_toolbar_sticky_buttons_container",t.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_CLOSE="flexlayout__tab_toolbar_button-close",t.FLEXLAYOUT__POPUP_MENU_CONTAINER="flexlayout__popup_menu_container",t.FLEXLAYOUT__POPUP_MENU_ITEM="flexlayout__popup_menu_item",t.FLEXLAYOUT__POPUP_MENU_ITEM__SELECTED="flexlayout__popup_menu_item--selected",t.FLEXLAYOUT__POPUP_MENU="flexlayout__popup_menu",t.FLEXLAYOUT__MINI_SCROLLBAR="flexlayout__mini_scrollbar",t.FLEXLAYOUT__MINI_SCROLLBAR_CONTAINER="flexlayout__mini_scrollbar_container",t))(J||{});class $n{constructor(e,n){Y(this,"type"),Y(this,"data"),this.type=e,this.data=n}}const Ln=class bn{static addNode(e,n,s,i,r){return new $n(bn.ADD_NODE,{json:e,toNode:n,location:s.getName(),index:i,select:r})}static moveNode(e,n,s,i,r){return new $n(bn.MOVE_NODE,{fromNode:e,toNode:n,location:s.getName(),index:i,select:r})}static deleteTab(e){return new $n(bn.DELETE_TAB,{node:e})}static deleteTabset(e){return new $n(bn.DELETE_TABSET,{node:e})}static renameTab(e,n){return new $n(bn.RENAME_TAB,{node:e,text:n})}static selectTab(e){return new $n(bn.SELECT_TAB,{tabNode:e})}static setActiveTabset(e,n){return new $n(bn.SET_ACTIVE_TABSET,{tabsetNode:e,windowId:n})}static adjustWeights(e,n){return new $n(bn.ADJUST_WEIGHTS,{nodeId:e,weights:n})}static adjustBorderSplit(e,n){return new $n(bn.ADJUST_BORDER_SPLIT,{node:e,pos:n})}static maximizeToggle(e,n){return new $n(bn.MAXIMIZE_TOGGLE,{node:e,windowId:n})}static updateModelAttributes(e){return new $n(bn.UPDATE_MODEL_ATTRIBUTES,{json:e})}static updateNodeAttributes(e,n){return new $n(bn.UPDATE_NODE_ATTRIBUTES,{node:e,json:n})}static popoutTab(e){return new $n(bn.POPOUT_TAB,{node:e})}static popoutTabset(e){return new $n(bn.POPOUT_TABSET,{node:e})}static closeWindow(e){return new $n(bn.CLOSE_WINDOW,{windowId:e})}static createWindow(e,n){return new $n(bn.CREATE_WINDOW,{layout:e,rect:n})}};Y(Ln,"ADD_NODE","FlexLayout_AddNode");Y(Ln,"MOVE_NODE","FlexLayout_MoveNode");Y(Ln,"DELETE_TAB","FlexLayout_DeleteTab");Y(Ln,"DELETE_TABSET","FlexLayout_DeleteTabset");Y(Ln,"RENAME_TAB","FlexLayout_RenameTab");Y(Ln,"SELECT_TAB","FlexLayout_SelectTab");Y(Ln,"SET_ACTIVE_TABSET","FlexLayout_SetActiveTabset");Y(Ln,"ADJUST_WEIGHTS","FlexLayout_AdjustWeights");Y(Ln,"ADJUST_BORDER_SPLIT","FlexLayout_AdjustBorderSplit");Y(Ln,"MAXIMIZE_TOGGLE","FlexLayout_MaximizeToggle");Y(Ln,"UPDATE_MODEL_ATTRIBUTES","FlexLayout_UpdateModelAttributes");Y(Ln,"UPDATE_NODE_ATTRIBUTES","FlexLayout_UpdateNodeAttributes");Y(Ln,"POPOUT_TAB","FlexLayout_PopoutTab");Y(Ln,"POPOUT_TABSET","FlexLayout_PopoutTabset");Y(Ln,"CLOSE_WINDOW","FlexLayout_CloseWindow");Y(Ln,"CREATE_WINDOW","FlexLayout_CreateWindow");let Ae=Ln;class se{constructor(e,n,s,i){Y(this,"name"),Y(this,"alias"),Y(this,"modelName"),Y(this,"pairedAttr"),Y(this,"pairedType"),Y(this,"defaultValue"),Y(this,"alwaysWriteJson"),Y(this,"type"),Y(this,"required"),Y(this,"fixed"),Y(this,"description"),this.name=e,this.alias=void 0,this.modelName=n,this.defaultValue=s,this.alwaysWriteJson=i,this.required=!1,this.fixed=!1,this.type="any"}setType(e){return this.type=e,this}setAlias(e){return this.alias=e,this}setDescription(e){this.description=e}setRequired(){return this.required=!0,this}setFixed(){return this.fixed=!0,this}setpairedAttr(e){this.pairedAttr=e}setPairedType(e){this.pairedType=e}}Y(se,"NUMBER","number");Y(se,"STRING","string");Y(se,"BOOLEAN","boolean");class Wf{constructor(){Y(this,"attributes"),Y(this,"nameToAttribute"),this.attributes=[],this.nameToAttribute=new Map}addWithAll(e,n,s,i){const r=new se(e,n,s,i);return this.attributes.push(r),this.nameToAttribute.set(e,r),r}addInherited(e,n){return this.addWithAll(e,n,void 0,!1)}add(e,n,s){return this.addWithAll(e,void 0,n,s)}getAttributes(){return this.attributes}getModelName(e){const n=this.nameToAttribute.get(e);if(n!==void 0)return n.modelName}toJson(e,n){for(const s of this.attributes){const i=n[s.name];(s.alwaysWriteJson||i!==s.defaultValue)&&(e[s.name]=i)}}fromJson(e,n){for(const s of this.attributes){let i=e[s.name];i===void 0&&s.alias&&(i=e[s.alias]),i===void 0?n[s.name]=s.defaultValue:n[s.name]=i}}update(e,n){for(const s of this.attributes)if(Object.prototype.hasOwnProperty.call(e,s.name)){const i=e[s.name];i===void 0?delete n[s.name]:n[s.name]=i}}setDefaults(e){for(const n of this.attributes)e[n.name]=n.defaultValue}pairAttributes(e,n){for(const s of n.attributes)if(s.modelName&&this.nameToAttribute.has(s.modelName)){const i=this.nameToAttribute.get(s.modelName);i.setpairedAttr(s),s.setpairedAttr(i),i.setPairedType(e)}}toTypescriptInterface(e,n){var s,i;const r=[],o=this.attributes.sort((l,c)=>l.name.localeCompare(c.name));r.push("export interface I"+e+"Attributes {");for(let l=0;l<o.length;l++){const c=o[l];let d=c.type,u,h=c,p;h.defaultValue!==void 0?u=h.defaultValue:h.modelName!==void 0&&n!==void 0&&n.nameToAttribute.get(h.modelName)!==void 0&&(p=h.modelName,h=n.nameToAttribute.get(p),u=h.defaultValue,d=h.type);const f=JSON.stringify(u),g=h.required?"":"?";let y=`	/**
	  `;c.description?y+=c.description:c.pairedType&&((s=c.pairedAttr)!=null&&s.description)&&(y+=`Value for ${c.pairedType} attribute ${c.pairedAttr.name} if not overridden`,y+=`

	  `,y+=(i=c.pairedAttr)==null?void 0:i.description),y+=`

	  `,c.fixed?y+=`Fixed value: ${f}`:p?y+=`Default: inherited from Global attribute ${c.modelName} (default ${f})`:y+=`Default: ${f}`,y+=`
	 */`,r.push(y),r.push("	"+c.name+g+": "+d+`;
`)}return r.push("}"),r.join(`
`)}}class cs{constructor(e,n,s,i,r){Y(this,"node"),Y(this,"rect"),Y(this,"location"),Y(this,"index"),Y(this,"className"),this.node=e,this.rect=n,this.location=s,this.index=i,this.className=r}}class ex{constructor(e){Y(this,"borders"),Y(this,"borderMap"),Y(this,"layoutHorizontal"),this.borders=[],this.borderMap=new Map,this.layoutHorizontal=!0}static fromJson(e,n){const s=new ex(n);s.borders=e.map(i=>ds.fromJson(i,n));for(const i of s.borders)s.borderMap.set(i.getLocation(),i);return s}toJson(){return this.borders.map(e=>e.toJson())}getLayoutHorizontal(){return this.layoutHorizontal}getBorders(){return this.borders}getBorderMap(){return this.borderMap}forEachNode(e){for(const n of this.borders){e(n,0);for(const s of n.getChildren())s.forEachNode(e,1)}}setPaths(){for(const e of this.borders){const n="/border/"+e.getLocation().getName();e.setPath(n);let s=0;for(const i of e.getChildren())i.setPath(n+"/t"+s),s++}}findDropTargetNode(e,n,s){for(const i of this.borders)if(i.isShowing()){const r=i.canDrop(e,n,s);if(r!==void 0)return r}}}let US=class{constructor(e){Y(this,"model"),Y(this,"attributes"),Y(this,"parent"),Y(this,"children"),Y(this,"rect"),Y(this,"path"),Y(this,"listeners"),this.model=e,this.attributes={},this.children=[],this.rect=Ee.empty(),this.listeners=new Map,this.path=""}getId(){let e=this.attributes.id;return e!==void 0||(e=this.model.nextUniqueId(),this.setId(e)),e}getModel(){return this.model}getType(){return this.attributes.type}getParent(){return this.parent}getChildren(){return this.children}getRect(){return this.rect}getPath(){return this.path}getOrientation(){return this.parent===void 0?this.model.isRootOrientationVertical()?Me.VERT:Me.HORZ:Me.flip(this.parent.getOrientation())}setEventListener(e,n){this.listeners.set(e,n)}removeEventListener(e){this.listeners.delete(e)}setId(e){this.attributes.id=e}fireEvent(e,n){this.listeners.has(e)&&this.listeners.get(e)(n)}getAttr(e){let n=this.attributes[e];if(n===void 0){const s=this.getAttributeDefinitions().getModelName(e);s!==void 0&&(n=this.model.getAttribute(s))}return n}forEachNode(e,n){e(this,n),n++;for(const s of this.children)s.forEachNode(e,n)}setPaths(e){let n=0;for(const s of this.children){let i=e;s.getType()==="row"?i+="/r"+n:s.getType()==="tabset"?i+="/ts"+n:s.getType()==="tab"&&(i+="/t"+n),s.path=i,s.setPaths(i),n++}}setParent(e){this.parent=e}setRect(e){this.rect=e}setPath(e){this.path=e}setWeight(e){this.attributes.weight=e}setSelected(e){this.attributes.selected=e}findDropTargetNode(e,n,s,i){let r;if(this.rect.contains(s,i)){if(this.model.getMaximizedTabset(e)!==void 0)r=this.model.getMaximizedTabset(e).canDrop(n,s,i);else if(r=this.canDrop(n,s,i),r===void 0&&this.children.length!==0){for(const o of this.children)if(r=o.findDropTargetNode(e,n,s,i),r!==void 0)break}}return r}canDrop(e,n,s){}canDockInto(e,n){if(n!=null){if(n.location===ce.CENTER&&n.node.isEnableDrop()===!1||n.location===ce.CENTER&&e.getType()==="tabset"&&e.getName()!==void 0||n.location!==ce.CENTER&&n.node.isEnableDivide()===!1)return!1;if(this.model.getOnAllowDrop())return this.model.getOnAllowDrop()(e,n)}return!0}removeChild(e){const n=this.children.indexOf(e);return n!==-1&&this.children.splice(n,1),n}addChild(e,n){return n!=null?this.children.splice(n,0,e):(this.children.push(e),n=this.children.length-1),e.parent=this,n}removeAll(){this.children=[]}styleWithPosition(e){return e==null&&(e={}),this.rect.styleWithPosition(e)}isEnableDivide(){return!0}toAttributeString(){return JSON.stringify(this.attributes,void 0,"	")}};const tx=class oa extends US{constructor(e,n,s=!0){super(e),Y(this,"tabRect",Ee.empty()),Y(this,"moveableElement"),Y(this,"tabStamp"),Y(this,"renderedName"),Y(this,"extra"),Y(this,"visible"),Y(this,"rendered"),Y(this,"scrollTop"),Y(this,"scrollLeft"),this.extra={},this.moveableElement=null,this.tabStamp=null,this.rendered=!1,this.visible=!1,oa.attributeDefinitions.fromJson(n,this.attributes),s===!0&&e.addNode(this)}static fromJson(e,n,s=!0){return new oa(n,e,s)}getName(){return this.getAttr("name")}getHelpText(){return this.getAttr("helpText")}getComponent(){return this.getAttr("component")}getWindowId(){return this.parent instanceof dt?this.parent.getWindowId():qs.MAIN_WINDOW_ID}getWindow(){const e=this.model.getwindowsMap().get(this.getWindowId());if(e)return e.window}getConfig(){return this.attributes.config}getExtraData(){return this.extra}isPoppedOut(){return this.getWindowId()!==qs.MAIN_WINDOW_ID}isSelected(){return this.getParent().getSelectedNode()===this}getIcon(){return this.getAttr("icon")}isEnableClose(){return this.getAttr("enableClose")}getCloseType(){return this.getAttr("closeType")}isEnablePopout(){return this.getAttr("enablePopout")}isEnablePopoutIcon(){return this.getAttr("enablePopoutIcon")}isEnablePopoutOverlay(){return this.getAttr("enablePopoutOverlay")}isEnableDrag(){return this.getAttr("enableDrag")}isEnableRename(){return this.getAttr("enableRename")}isEnableWindowReMount(){return this.getAttr("enableWindowReMount")}getClassName(){return this.getAttr("className")}getContentClassName(){return this.getAttr("contentClassName")}getTabSetClassName(){return this.getAttr("tabsetClassName")}isEnableRenderOnDemand(){return this.getAttr("enableRenderOnDemand")}getMinWidth(){return this.getAttr("minWidth")}getMinHeight(){return this.getAttr("minHeight")}getMaxWidth(){return this.getAttr("maxWidth")}getMaxHeight(){return this.getAttr("maxHeight")}isVisible(){return this.visible}toJson(){const e={};return oa.attributeDefinitions.toJson(e,this.attributes),e}saveScrollPosition(){this.moveableElement&&(this.scrollLeft=this.moveableElement.scrollLeft,this.scrollTop=this.moveableElement.scrollTop)}restoreScrollPosition(){this.scrollTop&&requestAnimationFrame(()=>{this.moveableElement&&this.scrollTop&&(this.moveableElement.scrollTop=this.scrollTop,this.moveableElement.scrollLeft=this.scrollLeft)})}setRect(e){e.equals(this.rect)||(this.fireEvent("resize",{rect:e}),this.rect=e)}setVisible(e){e!==this.visible&&(this.visible=e,this.fireEvent("visibility",{visible:e}))}getScrollTop(){return this.scrollTop}setScrollTop(e){this.scrollTop=e}getScrollLeft(){return this.scrollLeft}setScrollLeft(e){this.scrollLeft=e}isRendered(){return this.rendered}setRendered(e){this.rendered=e}getTabRect(){return this.tabRect}setTabRect(e){this.tabRect=e}getTabStamp(){return this.tabStamp}setTabStamp(e){this.tabStamp=e}getMoveableElement(){return this.moveableElement}setMoveableElement(e){this.moveableElement=e}setRenderedName(e){this.renderedName=e}getNameForOverflowMenu(){const e=this.getAttr("altName");return e!==void 0?e:this.renderedName}setName(e){this.attributes.name=e}delete(){this.parent.remove(this),this.fireEvent("close",{})}updateAttrs(e){oa.attributeDefinitions.update(e,this.attributes)}getAttributeDefinitions(){return oa.attributeDefinitions}setBorderWidth(e){this.attributes.borderWidth=e}setBorderHeight(e){this.attributes.borderHeight=e}static getAttributeDefinitions(){return oa.attributeDefinitions}static createAttributeDefinitions(){const e=new Wf;return e.add("type",oa.TYPE,!0).setType(se.STRING).setFixed(),e.add("id",void 0).setType(se.STRING).setDescription("the unique id of the tab, if left undefined a uuid will be assigned"),e.add("name","[Unnamed Tab]").setType(se.STRING).setDescription("name of tab to be displayed in the tab button"),e.add("altName",void 0).setType(se.STRING).setDescription("if there is no name specifed then this value will be used in the overflow menu"),e.add("helpText",void 0).setType(se.STRING).setDescription("An optional help text for the tab to be displayed upon tab hover."),e.add("component",void 0).setType(se.STRING).setDescription("string identifying which component to run (for factory)"),e.add("config",void 0).setType("any").setDescription("a place to hold json config for the hosted component"),e.add("tabsetClassName",void 0).setType(se.STRING).setDescription("class applied to parent tabset when this is the only tab and it is stretched to fill the tabset"),e.add("enableWindowReMount",!1).setType(se.BOOLEAN).setDescription("if enabled the tab will re-mount when popped out/in"),e.addInherited("enableClose","tabEnableClose").setType(se.BOOLEAN).setDescription("allow user to close tab via close button"),e.addInherited("closeType","tabCloseType").setType("ICloseType").setDescription("see values in ICloseType"),e.addInherited("enableDrag","tabEnableDrag").setType(se.BOOLEAN).setDescription("allow user to drag tab to new location"),e.addInherited("enableRename","tabEnableRename").setType(se.BOOLEAN).setDescription("allow user to rename tabs by double clicking"),e.addInherited("className","tabClassName").setType(se.STRING).setDescription("class applied to tab button"),e.addInherited("contentClassName","tabContentClassName").setType(se.STRING).setDescription("class applied to tab content"),e.addInherited("icon","tabIcon").setType(se.STRING).setDescription("the tab icon"),e.addInherited("enableRenderOnDemand","tabEnableRenderOnDemand").setType(se.BOOLEAN).setDescription("whether to avoid rendering component until tab is visible"),e.addInherited("enablePopout","tabEnablePopout").setType(se.BOOLEAN).setAlias("enableFloat").setDescription("enable popout (in popout capable browser)"),e.addInherited("enablePopoutIcon","tabEnablePopoutIcon").setType(se.BOOLEAN).setDescription("whether to show the popout icon in the tabset header if this tab enables popouts"),e.addInherited("enablePopoutOverlay","tabEnablePopoutOverlay").setType(se.BOOLEAN).setDescription(`if this tab will not work correctly in a popout window when the main window is backgrounded (inactive)
            then enabling this option will gray out this tab`),e.addInherited("borderWidth","tabBorderWidth").setType(se.NUMBER).setDescription("width when added to border, -1 will use border size"),e.addInherited("borderHeight","tabBorderHeight").setType(se.NUMBER).setDescription("height when added to border, -1 will use border size"),e.addInherited("minWidth","tabMinWidth").setType(se.NUMBER).setDescription("the min width of this tab"),e.addInherited("minHeight","tabMinHeight").setType(se.NUMBER).setDescription("the min height of this tab"),e.addInherited("maxWidth","tabMaxWidth").setType(se.NUMBER).setDescription("the max width of this tab"),e.addInherited("maxHeight","tabMaxHeight").setType(se.NUMBER).setDescription("the max height of this tab"),e}};Y(tx,"TYPE","tab");Y(tx,"attributeDefinitions",tx.createAttributeDefinitions());let Ct=tx;function u8(){return typeof window<"u"&&window.matchMedia&&window.matchMedia("(hover: hover) and (pointer: fine)").matches}function aP(t,e,n){let s;const i=e.getName(),r=e.getName();n===void 0&&(n=0),s===void 0&&e.getIcon()!==void 0&&(n!==0?s=a.jsx("img",{style:{width:"1em",height:"1em",transform:"rotate("+n+"deg)"},src:e.getIcon(),alt:"leadingContent"}):s=a.jsx("img",{style:{width:"1em",height:"1em"},src:e.getIcon(),alt:"leadingContent"}));const l={leading:s,content:i,name:r,buttons:[]};return t.customizeTab(e,l),e.setRenderedName(l.name),l}function Zp(t){let e=!1;return t.nativeEvent instanceof MouseEvent&&(t.nativeEvent.button!==0||t.ctrlKey||t.altKey||t.metaKey||t.shiftKey)&&(e=!0),e}function eE(t,e){const n=[...PM("iframe",e),...PM("webview",e)];for(const s of n)s.style.pointerEvents=t?"auto":"none"}function PM(t,e){return[...e.getElementsByTagName(t)]}function h8(t,e,n,s,i){e.preventDefault();const r=c=>{c.preventDefault(),n(c.clientX,c.clientY)},o=c=>{c.preventDefault(),i()},l=()=>{t.removeEventListener("pointermove",r),t.removeEventListener("pointerup",l),t.removeEventListener("pointercancel",o),s()};t.addEventListener("pointermove",r),t.addEventListener("pointerup",l),t.addEventListener("pointercancel",o)}function p8(t){if(t instanceof Ct)return t.isEnablePopout();if(t instanceof dt){for(const e of t.getChildren())if(e.isEnablePopout()===!1)return!1;return!0}return!1}function kM(t,e){const n=t.getAttribute("style"),s=e.getAttribute("style");return n===s?!1:(n?e.setAttribute("style",n):e.removeAttribute("style"),!0)}function CTe(){const t=navigator.userAgent;return t.includes("Safari")&&!t.includes("Chrome")&&!t.includes("Chromium")}function nx(t,e){if(t!==void 0&&(t instanceof dt||t instanceof ds)){const n=t.getSelected();n!==-1&&(e===n&&t.getChildren().length>0?e>=t.getChildren().length&&t.setSelected(t.getChildren().length-1):e<n?t.setSelected(n-1):e>n||t.setSelected(-1))}}function ih(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}const sx=class mr extends US{constructor(e,n){super(e),Y(this,"tabStripRect",Ee.empty()),Y(this,"contentRect",Ee.empty()),Y(this,"calculatedMinHeight"),Y(this,"calculatedMinWidth"),Y(this,"calculatedMaxHeight"),Y(this,"calculatedMaxWidth"),this.calculatedMinHeight=0,this.calculatedMinWidth=0,this.calculatedMaxHeight=0,this.calculatedMaxWidth=0,mr.attributeDefinitions.fromJson(n,this.attributes),e.addNode(this)}static fromJson(e,n,s){const i=new mr(n,e);if(e.children!=null)for(const r of e.children){const o=Ct.fromJson(r,n);i.addChild(o)}return i.children.length===0&&i.setSelected(-1),e.maximized&&e.maximized===!0&&(s.maximizedTabSet=i),e.active&&e.active===!0&&(s.activeTabSet=i),i}getName(){return this.getAttr("name")}isEnableActiveIcon(){return this.getAttr("enableActiveIcon")}getSelected(){const e=this.attributes.selected;return e!==void 0?e:-1}getSelectedNode(){const e=this.getSelected();if(e!==-1)return this.children[e]}getWeight(){return this.getAttr("weight")}getAttrMinWidth(){return this.getAttr("minWidth")}getAttrMinHeight(){return this.getAttr("minHeight")}getMinWidth(){return this.calculatedMinWidth}getMinHeight(){return this.calculatedMinHeight}getMinSize(e){return e===Me.HORZ?this.getMinWidth():this.getMinHeight()}getAttrMaxWidth(){return this.getAttr("maxWidth")}getAttrMaxHeight(){return this.getAttr("maxHeight")}getMaxWidth(){return this.calculatedMaxWidth}getMaxHeight(){return this.calculatedMaxHeight}getMaxSize(e){return e===Me.HORZ?this.getMaxWidth():this.getMaxHeight()}getConfig(){return this.attributes.config}isMaximized(){return this.model.getMaximizedTabset(this.getWindowId())===this}isActive(){return this.model.getActiveTabset(this.getWindowId())===this}isEnableDeleteWhenEmpty(){return this.getAttr("enableDeleteWhenEmpty")}isEnableDrop(){return this.getAttr("enableDrop")}isEnableTabWrap(){return this.getAttr("enableTabWrap")}isEnableDrag(){return this.getAttr("enableDrag")}isEnableDivide(){return this.getAttr("enableDivide")}isEnableMaximize(){return this.getAttr("enableMaximize")}isEnableClose(){return this.getAttr("enableClose")}isEnableSingleTabStretch(){return this.getAttr("enableSingleTabStretch")}isEnableTabStrip(){return this.getAttr("enableTabStrip")}isAutoSelectTab(){return this.getAttr("autoSelectTab")}isEnableTabScrollbar(){return this.getAttr("enableTabScrollbar")}getClassNameTabStrip(){return this.getAttr("classNameTabStrip")}getTabLocation(){return this.getAttr("tabLocation")}toJson(){const e={};return mr.attributeDefinitions.toJson(e,this.attributes),e.children=this.children.map(n=>n.toJson()),this.isActive()&&(e.active=!0),this.isMaximized()&&(e.maximized=!0),e}calcMinMaxSize(){this.calculatedMinHeight=this.getAttrMinHeight(),this.calculatedMinWidth=this.getAttrMinWidth(),this.calculatedMaxHeight=this.getAttrMaxHeight(),this.calculatedMaxWidth=this.getAttrMaxWidth();for(const e of this.children){const n=e;this.calculatedMinWidth=Math.max(this.calculatedMinWidth,n.getMinWidth()),this.calculatedMinHeight=Math.max(this.calculatedMinHeight,n.getMinHeight()),this.calculatedMaxWidth=Math.min(this.calculatedMaxWidth,n.getMaxWidth()),this.calculatedMaxHeight=Math.min(this.calculatedMaxHeight,n.getMaxHeight())}this.calculatedMinHeight+=this.tabStripRect.height,this.calculatedMaxHeight+=this.tabStripRect.height}canMaximize(){return this.isEnableMaximize()?this.getModel().getMaximizedTabset(this.getWindowId())===this?!0:!(this.getParent()===this.getModel().getRoot(this.getWindowId())&&this.getModel().getRoot(this.getWindowId()).getChildren().length===1):!1}setContentRect(e){this.contentRect=e}getContentRect(){return this.contentRect}setTabStripRect(e){this.tabStripRect=e}setWeight(e){this.attributes.weight=e}setSelected(e){this.attributes.selected=e}getWindowId(){return this.parent.getWindowId()}canDrop(e,n,s){let i;if(e===this){const r=ce.CENTER,o=this.tabStripRect;i=new cs(this,o,r,-1,J.FLEXLAYOUT__OUTLINE_RECT)}else{if(this.getWindowId()!==qs.MAIN_WINDOW_ID&&!p8(e))return;if(this.contentRect.contains(n,s)){let r=ce.CENTER;this.model.getMaximizedTabset(this.parent.getWindowId())===void 0&&(r=ce.getLocation(this.contentRect,n,s));const o=r.getDockRect(this.rect);i=new cs(this,o,r,-1,J.FLEXLAYOUT__OUTLINE_RECT)}else if(this.tabStripRect!=null&&this.tabStripRect.contains(n,s)){let r,o,l;if(this.children.length===0)r=this.tabStripRect.clone(),o=r.y+3,l=r.height-4,r.width=2;else{let c=this.children[0];r=c.getTabRect(),o=r.y,l=r.height;let d=this.tabStripRect.x,u=0;for(let h=0;h<this.children.length;h++){if(c=this.children[h],r=c.getTabRect(),r.y!==o&&(o=r.y,d=this.tabStripRect.x),u=r.x+r.width/2,d<=n&&n<u&&r.y<s&&s<r.getBottom()){const p=ce.CENTER,f=new Ee(r.x-2,r.y,3,r.height);if(this.rect.x<r.x&&r.x<this.rect.getRight()){i=new cs(this,f,p,h,J.FLEXLAYOUT__OUTLINE_RECT);break}else return}d=u}}if(i==null&&r.getRight()<this.rect.getRight()){const c=ce.CENTER,d=new Ee(r.getRight()-2,o,3,l);i=new cs(this,d,c,this.children.length,J.FLEXLAYOUT__OUTLINE_RECT)}}}if(e.canDockInto(e,i))return i}delete(){this.parent.removeChild(this)}remove(e){const n=this.removeChild(e);this.model.tidy(),nx(this,n)}drop(e,n,s,i){const r=n;if(this===e)return;let o=e.getParent(),l=0;if(o!==void 0&&(l=o.removeChild(e),o instanceof ds&&o.getSelected()===l?o.setSelected(-1):nx(o,l)),e instanceof Ct&&o===this&&l<s&&s>0&&s--,r===ce.CENTER){let c=s;if(c===-1&&(c=this.children.length),e instanceof Ct)this.addChild(e,c),(i||i!==!1&&this.isAutoSelectTab())&&this.setSelected(c);else if(e instanceof Cn)e.forEachNode((d,u)=>{d instanceof Ct&&(this.addChild(d,c),c++)},0);else{for(let d=0;d<e.getChildren().length;d++){const u=e.getChildren()[d];this.addChild(u,c),c++}this.getSelected()===-1&&this.children.length>0&&this.setSelected(0)}this.model.setActiveTabset(this,this.parent.getWindowId())}else{let c=e;if(e instanceof Ct){const h=this.model.getOnCreateTabSet();c=new mr(this.model,h?h(e):{}),c.addChild(e),o=c}else if(e instanceof Cn){const h=this.getParent();if(e.getOrientation()===h.getOrientation()&&(n.getOrientation()===h.getOrientation()||n===ce.CENTER)){const p=new Cn(this.model,this.getWindowId(),{});p.addChild(e),c=p}}else c=e;const d=this.parent,u=d.getChildren().indexOf(this);if(d.getOrientation()===r.orientation)c.setWeight(this.getWeight()/2),this.setWeight(this.getWeight()/2),d.addChild(c,u+r.indexPlus);else{const h=new Cn(this.model,this.getWindowId(),{});h.setWeight(this.getWeight()),h.addChild(this),this.setWeight(50),c.setWeight(50),h.addChild(c,r.indexPlus),d.removeChild(this),d.addChild(h,u)}c instanceof mr&&this.model.setActiveTabset(c,this.getWindowId())}this.model.tidy()}updateAttrs(e){mr.attributeDefinitions.update(e,this.attributes)}getAttributeDefinitions(){return mr.attributeDefinitions}static getAttributeDefinitions(){return mr.attributeDefinitions}static createAttributeDefinitions(){const e=new Wf;return e.add("type",mr.TYPE,!0).setType(se.STRING).setFixed(),e.add("id",void 0).setType(se.STRING).setDescription("the unique id of the tab set, if left undefined a uuid will be assigned"),e.add("weight",100).setType(se.NUMBER).setDescription("relative weight for sizing of this tabset in parent row"),e.add("selected",0).setType(se.NUMBER).setDescription("index of selected/visible tab in tabset"),e.add("name",void 0).setType(se.STRING),e.add("config",void 0).setType("any").setDescription("a place to hold json config used in your own code"),e.addInherited("enableDeleteWhenEmpty","tabSetEnableDeleteWhenEmpty").setDescription("whether to delete this tabset when is has no tabs"),e.addInherited("enableDrop","tabSetEnableDrop").setDescription("allow user to drag tabs into this tabset"),e.addInherited("enableDrag","tabSetEnableDrag").setDescription("allow user to drag tabs out this tabset"),e.addInherited("enableDivide","tabSetEnableDivide").setDescription("allow user to drag tabs to region of this tabset, splitting into new tabset"),e.addInherited("enableMaximize","tabSetEnableMaximize").setDescription("allow user to maximize tabset to fill view via maximize button"),e.addInherited("enableClose","tabSetEnableClose").setDescription("allow user to close tabset via a close button"),e.addInherited("enableSingleTabStretch","tabSetEnableSingleTabStretch").setDescription("if the tabset has only a single tab then stretch the single tab to fill area and display in a header style"),e.addInherited("classNameTabStrip","tabSetClassNameTabStrip").setDescription("a class name to apply to the tab strip"),e.addInherited("enableTabStrip","tabSetEnableTabStrip").setDescription("enable tab strip and allow multiple tabs in this tabset"),e.addInherited("minWidth","tabSetMinWidth").setDescription("minimum width (in px) for this tabset"),e.addInherited("minHeight","tabSetMinHeight").setDescription("minimum height (in px) for this tabset"),e.addInherited("maxWidth","tabSetMaxWidth").setDescription("maximum width (in px) for this tabset"),e.addInherited("maxHeight","tabSetMaxHeight").setDescription("maximum height (in px) for this tabset"),e.addInherited("enableTabWrap","tabSetEnableTabWrap").setDescription("wrap tabs onto multiple lines"),e.addInherited("tabLocation","tabSetTabLocation").setDescription("the location of the tabs either top or bottom"),e.addInherited("autoSelectTab","tabSetAutoSelectTab").setType(se.BOOLEAN).setDescription("whether to select new/moved tabs in tabset"),e.addInherited("enableActiveIcon","tabSetEnableActiveIcon").setType(se.BOOLEAN).setDescription("whether the active icon (*) should be displayed when the tabset is active"),e.addInherited("enableTabScrollbar","tabSetEnableTabScrollbar").setType(se.BOOLEAN).setDescription("whether to show a mini scrollbar for the tabs"),e}};Y(sx,"TYPE","tabset");Y(sx,"attributeDefinitions",sx.createAttributeDefinitions());let dt=sx;const ix=class rn extends US{constructor(e,n,s){super(e),Y(this,"windowId"),Y(this,"minHeight"),Y(this,"minWidth"),Y(this,"maxHeight"),Y(this,"maxWidth"),this.windowId=n,this.minHeight=co,this.minWidth=co,this.maxHeight=uo,this.maxWidth=uo,rn.attributeDefinitions.fromJson(s,this.attributes),this.normalizeWeights(),e.addNode(this)}static fromJson(e,n,s){const i=new rn(n,s.windowId,e);if(e.children!=null)for(const r of e.children)if(r.type===dt.TYPE){const o=dt.fromJson(r,n,s);i.addChild(o)}else{const o=rn.fromJson(r,n,s);i.addChild(o)}return i}getWeight(){return this.attributes.weight}toJson(){const e={};rn.attributeDefinitions.toJson(e,this.attributes),e.children=[];for(const n of this.children)e.children.push(n.toJson());return e}getWindowId(){return this.windowId}setWindowId(e){this.windowId=e}setWeight(e){this.attributes.weight=e}getSplitterBounds(e){const n=this.getOrientation()===Me.HORZ,s=this.getChildren(),i=this.model.getSplitterSize(),r=s[0].getRect(),o=s[s.length-1].getRect();let l=n?[r.x,o.getRight()]:[r.y,o.getBottom()];const c=n?[r.x,o.getRight()]:[r.y,o.getBottom()];for(let d=0;d<e;d++){const u=s[d];l[0]+=n?u.getMinWidth():u.getMinHeight(),c[0]+=n?u.getMaxWidth():u.getMaxHeight(),d>0&&(l[0]+=i,c[0]+=i)}for(let d=s.length-1;d>=e;d--){const u=s[d];l[1]-=(n?u.getMinWidth():u.getMinHeight())+i,c[1]-=(n?u.getMaxWidth():u.getMaxHeight())+i}return l=[Math.max(c[1],l[0]),Math.min(c[0],l[1])],l}getSplitterInitials(e){const n=this.getOrientation()===Me.HORZ,s=this.getChildren(),i=this.model.getSplitterSize(),r=[];let o=0;for(let d=0;d<s.length;d++){const h=s[d].getRect(),p=n?h.width:h.height;r.push(p),o+=p}const l=s[e].getRect(),c=(n?l.x:l.y)-i;return{initialSizes:r,sum:o,startPosition:c}}calculateSplit(e,n,s,i,r){const o=this.getOrientation()===Me.HORZ,l=this.getChildren(),c=l[e],d=o?c.getMaxWidth():c.getMaxHeight(),u=[...s];if(n<r){let p=r-n,f=0;u[e]+p>d?(f=u[e]+p-d,u[e]=d):u[e]+=p;for(let g=e-1;g>=0;g--){const y=l[g],x=o?y.getMinWidth():y.getMinHeight();if(u[g]-p>x){u[g]-=p;break}else p-=u[g]-x,u[g]=x}for(let g=e+1;g<l.length;g++){const y=l[g],x=o?y.getMaxWidth():y.getMaxHeight();if(u[g]+f<x){u[g]+=f;break}else f-=x-u[g],u[g]=x}}else{let p=n-r,f=0;u[e-1]+p>d?(f=u[e-1]+p-d,u[e-1]=d):u[e-1]+=p;for(let g=e;g<l.length;g++){const y=l[g],x=o?y.getMinWidth():y.getMinHeight();if(u[g]-p>x){u[g]-=p;break}else p-=u[g]-x,u[g]=x}for(let g=e-1;g>=0;g--){const y=l[g],x=o?y.getMaxWidth():y.getMaxHeight();if(u[g]+f<x){u[g]+=f;break}else f-=x-u[g],u[g]=x}}return u.map(p=>Math.max(.1,p)*100/i)}getMinSize(e){return e===Me.HORZ?this.getMinWidth():this.getMinHeight()}getMinWidth(){return this.minWidth}getMinHeight(){return this.minHeight}getMaxSize(e){return e===Me.HORZ?this.getMaxWidth():this.getMaxHeight()}getMaxWidth(){return this.maxWidth}getMaxHeight(){return this.maxHeight}calcMinMaxSize(){this.minHeight=co,this.minWidth=co,this.maxHeight=uo,this.maxWidth=uo;let e=!0;for(const n of this.children){const s=n;s.calcMinMaxSize(),this.getOrientation()===Me.VERT?(this.minHeight+=s.getMinHeight(),this.maxHeight+=s.getMaxHeight(),e||(this.minHeight+=this.model.getSplitterSize(),this.maxHeight+=this.model.getSplitterSize()),this.minWidth=Math.max(this.minWidth,s.getMinWidth()),this.maxWidth=Math.min(this.maxWidth,s.getMaxWidth())):(this.minWidth+=s.getMinWidth(),this.maxWidth+=s.getMaxWidth(),e||(this.minWidth+=this.model.getSplitterSize(),this.maxWidth+=this.model.getSplitterSize()),this.minHeight=Math.max(this.minHeight,s.getMinHeight()),this.maxHeight=Math.min(this.maxHeight,s.getMaxHeight())),e=!1}}tidy(){let e=0;for(;e<this.children.length;){const n=this.children[e];if(n instanceof rn){n.tidy();const s=n.getChildren();if(s.length===0)this.removeChild(n);else if(s.length===1){const i=s[0];if(this.removeChild(n),i instanceof rn){let r=0;const o=i.getChildren();for(const l of o)r+=l.getWeight();for(let l=0;l<o.length;l++){const c=o[l];c.setWeight(n.getWeight()*c.getWeight()/r),this.addChild(c,e+l)}}else i.setWeight(n.getWeight()),this.addChild(i,e)}else e++}else n instanceof dt&&n.getChildren().length===0&&n.isEnableDeleteWhenEmpty()?(this.removeChild(n),n===this.model.getMaximizedTabset(this.windowId)&&this.model.setMaximizedTabset(void 0,this.windowId)):e++}if(this===this.model.getRoot(this.windowId)&&this.children.length===0){const n=this.model.getOnCreateTabSet();let s=n?n():{};s={...s,selected:-1};const i=new dt(this.model,s);this.model.setActiveTabset(i,this.windowId),this.addChild(i)}}canDrop(e,n,s){const i=s-this.rect.y,r=n-this.rect.x,o=this.rect.width,l=this.rect.height,c=10,d=50;let u;if(!(this.getWindowId()!==qs.MAIN_WINDOW_ID&&!p8(e))){if(this.model.isEnableEdgeDock()&&this.parent===void 0){if(n<this.rect.x+c&&i>l/2-d&&i<l/2+d){const h=ce.LEFT,p=h.getDockRect(this.rect);p.width=p.width/2,u=new cs(this,p,h,-1,J.FLEXLAYOUT__OUTLINE_RECT_EDGE)}else if(n>this.rect.getRight()-c&&i>l/2-d&&i<l/2+d){const h=ce.RIGHT,p=h.getDockRect(this.rect);p.width=p.width/2,p.x+=p.width,u=new cs(this,p,h,-1,J.FLEXLAYOUT__OUTLINE_RECT_EDGE)}else if(s<this.rect.y+c&&r>o/2-d&&r<o/2+d){const h=ce.TOP,p=h.getDockRect(this.rect);p.height=p.height/2,u=new cs(this,p,h,-1,J.FLEXLAYOUT__OUTLINE_RECT_EDGE)}else if(s>this.rect.getBottom()-c&&r>o/2-d&&r<o/2+d){const h=ce.BOTTOM,p=h.getDockRect(this.rect);p.height=p.height/2,p.y+=p.height,u=new cs(this,p,h,-1,J.FLEXLAYOUT__OUTLINE_RECT_EDGE)}if(u!==void 0&&!e.canDockInto(e,u))return}return u}}drop(e,n,s){const i=n,r=e.getParent();r&&r.removeChild(e),r!==void 0&&r instanceof dt&&r.setSelected(0),r!==void 0&&r instanceof ds&&r.setSelected(-1);let o;if(e instanceof dt||e instanceof rn)o=e,o instanceof rn&&o.getOrientation()===this.getOrientation()&&(n.getOrientation()===this.getOrientation()||n===ce.CENTER)&&(o=new rn(this.model,this.windowId,{}),o.addChild(e));else{const d=this.model.getOnCreateTabSet();o=new dt(this.model,d?d(e):{}),o.addChild(e)}let l=this.children.reduce((d,u)=>d+u.getWeight(),0);l===0&&(l=100),o.setWeight(l/3);const c=!this.model.isRootOrientationVertical();if(i===ce.CENTER)s===-1?this.addChild(o,this.children.length):this.addChild(o,s);else if(c&&i===ce.LEFT||!c&&i===ce.TOP)this.addChild(o,0);else if(c&&i===ce.RIGHT||!c&&i===ce.BOTTOM)this.addChild(o);else if(c&&i===ce.TOP||!c&&i===ce.LEFT){const d=new rn(this.model,this.windowId,{}),u=new rn(this.model,this.windowId,{});u.setWeight(75),o.setWeight(25);for(const h of this.children)u.addChild(h);this.removeAll(),d.addChild(o),d.addChild(u),this.addChild(d)}else if(c&&i===ce.BOTTOM||!c&&i===ce.RIGHT){const d=new rn(this.model,this.windowId,{}),u=new rn(this.model,this.windowId,{});u.setWeight(75),o.setWeight(25);for(const h of this.children)u.addChild(h);this.removeAll(),d.addChild(u),d.addChild(o),this.addChild(d)}o instanceof dt&&this.model.setActiveTabset(o,this.windowId),this.model.tidy()}isEnableDrop(){return!0}getAttributeDefinitions(){return rn.attributeDefinitions}updateAttrs(e){rn.attributeDefinitions.update(e,this.attributes)}static getAttributeDefinitions(){return rn.attributeDefinitions}normalizeWeights(){let e=0;for(const n of this.children)e+=n.getWeight();e===0&&(e=1);for(const n of this.children){const s=n;s.setWeight(Math.max(.001,100*s.getWeight()/e))}}static createAttributeDefinitions(){const e=new Wf;return e.add("type",rn.TYPE,!0).setType(se.STRING).setFixed(),e.add("id",void 0).setType(se.STRING).setDescription("the unique id of the row, if left undefined a uuid will be assigned"),e.add("weight",100).setType(se.NUMBER).setDescription("relative weight for sizing of this row in parent row"),e}};Y(ix,"TYPE","row");Y(ix,"attributeDefinitions",ix.createAttributeDefinitions());let Cn=ix;class El{constructor(e,n){Y(this,"_windowId"),Y(this,"_layout"),Y(this,"_rect"),Y(this,"_window"),Y(this,"_root"),Y(this,"_maximizedTabSet"),Y(this,"_activeTabSet"),Y(this,"_toScreenRectFunction"),this._windowId=e,this._rect=n,this._toScreenRectFunction=s=>s}visitNodes(e){this.root.forEachNode(e,0)}get windowId(){return this._windowId}get rect(){return this._rect}get layout(){return this._layout}get window(){return this._window}get root(){return this._root}get maximizedTabSet(){return this._maximizedTabSet}get activeTabSet(){return this._activeTabSet}set rect(e){this._rect=e}set layout(e){this._layout=e}set window(e){this._window=e}set root(e){this._root=e}set maximizedTabSet(e){this._maximizedTabSet=e}set activeTabSet(e){this._activeTabSet=e}get toScreenRectFunction(){return this._toScreenRectFunction}set toScreenRectFunction(e){this._toScreenRectFunction=e}toJson(){return this._window&&this._window.screenTop>-1e4&&(this.rect=new Ee(this._window.screenLeft,this._window.screenTop,this._window.outerWidth,this._window.outerHeight)),{layout:this.root.toJson(),rect:this.rect.toJson()}}static fromJson(e,n,s){const i=n.getwindowsMap().size,r=e.rect?Ee.fromJson(e.rect):new Ee(50+50*i,50+50*i,600,400);r.snap(10);const o=new El(s,r);return o.root=Cn.fromJson(e.layout,n,o),o}}const co=0,uo=99999,rx=class st{constructor(){Y(this,"attributes"),Y(this,"idMap"),Y(this,"changeListeners"),Y(this,"borders"),Y(this,"onAllowDrop"),Y(this,"onCreateTabSet"),Y(this,"windows"),Y(this,"rootWindow"),this.attributes={},this.idMap=new Map,this.borders=new ex(this),this.windows=new Map,this.rootWindow=new El(st.MAIN_WINDOW_ID,Ee.empty()),this.windows.set(st.MAIN_WINDOW_ID,this.rootWindow),this.changeListeners=[]}doAction(e){var n;let s;switch(e.type){case Ae.ADD_NODE:{const i=new Ct(this,e.data.json,!0),r=this.idMap.get(e.data.toNode);(r instanceof dt||r instanceof ds||r instanceof Cn)&&(r.drop(i,ce.getByName(e.data.location),e.data.index,e.data.select),s=i);break}case Ae.MOVE_NODE:{const i=this.idMap.get(e.data.fromNode);if(i instanceof Ct||i instanceof dt||i instanceof Cn){if(i===this.getMaximizedTabset(i.getWindowId())){const o=this.windows.get(i.getWindowId());o.maximizedTabSet=void 0}const r=this.idMap.get(e.data.toNode);(r instanceof dt||r instanceof ds||r instanceof Cn)&&r.drop(i,ce.getByName(e.data.location),e.data.index,e.data.select)}this.removeEmptyWindows();break}case Ae.DELETE_TAB:{const i=this.idMap.get(e.data.node);i instanceof Ct&&i.delete(),this.removeEmptyWindows();break}case Ae.DELETE_TABSET:{const i=this.idMap.get(e.data.node);if(i instanceof dt){const r=[...i.getChildren()];for(let o=0;o<r.length;o++){const l=r[o];l.isEnableClose()&&l.delete()}i.getChildren().length===0&&i.delete(),this.tidy()}this.removeEmptyWindows();break}case Ae.POPOUT_TABSET:{const i=this.idMap.get(e.data.node);if(i instanceof dt){const r=i.isMaximized(),o=this.windows.get(i.getWindowId()),l=ih(),c=new El(l,o.toScreenRectFunction(i.getRect())),d={type:"row",children:[]},u=Cn.fromJson(d,this,c);c.root=u,this.windows.set(l,c),u.drop(i,ce.CENTER,0),r&&(this.rootWindow.maximizedTabSet=void 0)}this.removeEmptyWindows();break}case Ae.POPOUT_TAB:{const i=this.idMap.get(e.data.node);if(i instanceof Ct){const r=ih();let o=Ee.empty();i.getParent()instanceof dt?o=i.getParent().getRect():o=i.getParent().getContentRect();const l=this.windows.get(i.getWindowId()),c=new El(r,l.toScreenRectFunction(o)),d=ih(),u={type:"row",children:[{type:"tabset",id:d}]},h=Cn.fromJson(u,this,c);c.root=h,this.windows.set(r,c),this.idMap.get(d).drop(i,ce.CENTER,0,!0)}this.removeEmptyWindows();break}case Ae.CLOSE_WINDOW:{const i=this.windows.get(e.data.windowId);i&&((n=this.rootWindow.root)==null||n.drop(i.root,ce.CENTER,-1),this.rootWindow.visitNodes((r,o)=>{r instanceof Cn&&r.setWindowId(st.MAIN_WINDOW_ID)}),this.windows.delete(e.data.windowId));break}case Ae.CREATE_WINDOW:{const i=ih(),r=new El(i,Ee.fromJson(e.data.rect)),o=Cn.fromJson(e.data.layout,this,r);r.root=o,this.windows.set(i,r),s=i;break}case Ae.RENAME_TAB:{const i=this.idMap.get(e.data.node);i instanceof Ct&&i.setName(e.data.text);break}case Ae.SELECT_TAB:{const i=this.idMap.get(e.data.tabNode),r=e.data.windowId?e.data.windowId:st.MAIN_WINDOW_ID,o=this.windows.get(r);if(i instanceof Ct){const l=i.getParent(),c=l.getChildren().indexOf(i);l instanceof ds?l.getSelected()===c?l.setSelected(-1):l.setSelected(c):l instanceof dt&&(l.getSelected()!==c&&l.setSelected(c),o.activeTabSet=l)}break}case Ae.SET_ACTIVE_TABSET:{const i=e.data.windowId?e.data.windowId:st.MAIN_WINDOW_ID,r=this.windows.get(i);if(e.data.tabsetNode===void 0)r.activeTabSet=void 0;else{const o=this.idMap.get(e.data.tabsetNode);o instanceof dt&&(r.activeTabSet=o)}break}case Ae.ADJUST_WEIGHTS:{const r=this.idMap.get(e.data.nodeId).getChildren();for(let o=0;o<r.length;o++)r[o].setWeight(e.data.weights[o]);break}case Ae.ADJUST_BORDER_SPLIT:{const i=this.idMap.get(e.data.node);i instanceof ds&&i.setSize(e.data.pos);break}case Ae.MAXIMIZE_TOGGLE:{const i=e.data.windowId?e.data.windowId:st.MAIN_WINDOW_ID,r=this.windows.get(i),o=this.idMap.get(e.data.node);o instanceof dt&&(o===r.maximizedTabSet?r.maximizedTabSet=void 0:(r.maximizedTabSet=o,r.activeTabSet=o));break}case Ae.UPDATE_MODEL_ATTRIBUTES:{this.updateAttrs(e.data.json);break}case Ae.UPDATE_NODE_ATTRIBUTES:{this.idMap.get(e.data.node).updateAttrs(e.data.json);break}}this.updateIdMap();for(const i of this.changeListeners)i(e);return s}getActiveTabset(e=st.MAIN_WINDOW_ID){const n=this.windows.get(e);if(n&&n.activeTabSet&&this.getNodeById(n.activeTabSet.getId()))return n.activeTabSet}getMaximizedTabset(e=st.MAIN_WINDOW_ID){return this.windows.get(e).maximizedTabSet}getRoot(e=st.MAIN_WINDOW_ID){return this.windows.get(e).root}isRootOrientationVertical(){return this.attributes.rootOrientationVertical}isEnableRotateBorderIcons(){return this.attributes.enableRotateBorderIcons}getBorderSet(){return this.borders}getwindowsMap(){return this.windows}visitNodes(e){this.borders.forEachNode(e);for(const[n,s]of this.windows)s.root.forEachNode(e,0)}visitWindowNodes(e,n){this.windows.has(e)&&(e===st.MAIN_WINDOW_ID&&this.borders.forEachNode(n),this.windows.get(e).visitNodes(n))}getNodeById(e){return this.idMap.get(e)}getFirstTabSet(e=this.windows.get(st.MAIN_WINDOW_ID).root){const n=e.getChildren()[0];return n instanceof dt?n:this.getFirstTabSet(n)}static fromJson(e){const n=new st;if(st.attributeDefinitions.fromJson(e.global,n.attributes),e.borders&&(n.borders=ex.fromJson(e.borders,n)),e.popouts)for(const s in e.popouts){const i=e.popouts[s],r=El.fromJson(i,n,s);n.windows.set(s,r)}return n.rootWindow.root=Cn.fromJson(e.layout,n,n.getwindowsMap().get(st.MAIN_WINDOW_ID)),n.tidy(),n}toJson(){const e={};st.attributeDefinitions.toJson(e,this.attributes),this.visitNodes(s=>{s.fireEvent("save",{})});const n={};for(const[s,i]of this.windows)s!==st.MAIN_WINDOW_ID&&(n[s]=i.toJson());return{global:e,borders:this.borders.toJson(),layout:this.rootWindow.root.toJson(),popouts:n}}getSplitterSize(){return this.attributes.splitterSize}getSplitterExtra(){return this.attributes.splitterExtra}isEnableEdgeDock(){return this.attributes.enableEdgeDock}isSplitterEnableHandle(){return this.attributes.splitterEnableHandle}setOnAllowDrop(e){this.onAllowDrop=e}setOnCreateTabSet(e){this.onCreateTabSet=e}addChangeListener(e){this.changeListeners.push(e)}removeChangeListener(e){const n=this.changeListeners.findIndex(s=>s===e);n!==-1&&this.changeListeners.splice(n,1)}toString(){return JSON.stringify(this.toJson())}removeEmptyWindows(){const e=new Set;for(const[n]of this.windows)if(n!==st.MAIN_WINDOW_ID){let s=0;this.visitWindowNodes(n,i=>{i instanceof Ct&&s++}),s===0&&e.add(n)}for(const n of e)this.windows.delete(n)}setActiveTabset(e,n){const s=this.windows.get(n);s&&(e?s.activeTabSet=e:s.activeTabSet=void 0)}setMaximizedTabset(e,n){const s=this.windows.get(n);s&&(e?s.maximizedTabSet=e:s.maximizedTabSet=void 0)}updateIdMap(){this.idMap.clear(),this.visitNodes(e=>{this.idMap.set(e.getId(),e)})}addNode(e){const n=e.getId();if(this.idMap.has(n))throw new Error(`Error: each node must have a unique id, duplicate id:${e.getId()}`);this.idMap.set(n,e)}findDropTargetNode(e,n,s,i){let r=this.windows.get(e).root.findDropTargetNode(e,n,s,i);return r===void 0&&e===st.MAIN_WINDOW_ID&&(r=this.borders.findDropTargetNode(n,s,i)),r}tidy(){for(const[e,n]of this.windows)n.root.tidy()}updateAttrs(e){st.attributeDefinitions.update(e,this.attributes)}nextUniqueId(){return"#"+ih()}getAttribute(e){return this.attributes[e]}getOnAllowDrop(){return this.onAllowDrop}getOnCreateTabSet(){return this.onCreateTabSet}static toTypescriptInterfaces(){st.attributeDefinitions.pairAttributes("RowNode",Cn.getAttributeDefinitions()),st.attributeDefinitions.pairAttributes("TabSetNode",dt.getAttributeDefinitions()),st.attributeDefinitions.pairAttributes("TabNode",Ct.getAttributeDefinitions()),st.attributeDefinitions.pairAttributes("BorderNode",ds.getAttributeDefinitions());const e=[];e.push(st.attributeDefinitions.toTypescriptInterface("Global",void 0)),e.push(Cn.getAttributeDefinitions().toTypescriptInterface("Row",st.attributeDefinitions)),e.push(dt.getAttributeDefinitions().toTypescriptInterface("TabSet",st.attributeDefinitions)),e.push(Ct.getAttributeDefinitions().toTypescriptInterface("Tab",st.attributeDefinitions)),e.push(ds.getAttributeDefinitions().toTypescriptInterface("Border",st.attributeDefinitions)),console.log(e.join(`
`))}static createAttributeDefinitions(){const e=new Wf;return e.add("enableEdgeDock",!0).setType(se.BOOLEAN).setDescription("enable docking to the edges of the layout, this will show the edge indicators"),e.add("rootOrientationVertical",!1).setType(se.BOOLEAN).setDescription("the top level 'row' will layout horizontally by default, set this option true to make it layout vertically"),e.add("enableRotateBorderIcons",!0).setType(se.BOOLEAN).setDescription("boolean indicating if tab icons should rotate with the text in the left and right borders"),e.add("splitterSize",8).setType(se.NUMBER).setDescription("width in pixels of all splitters between tabsets/borders"),e.add("splitterExtra",0).setType(se.NUMBER).setDescription("additional width in pixels of the splitter hit test area"),e.add("splitterEnableHandle",!1).setType(se.BOOLEAN).setDescription("enable a small centralized handle on all splitters"),e.add("tabEnableClose",!0).setType(se.BOOLEAN),e.add("tabCloseType",1).setType("ICloseType"),e.add("tabEnablePopout",!1).setType(se.BOOLEAN).setAlias("tabEnableFloat"),e.add("tabEnablePopoutIcon",!0).setType(se.BOOLEAN),e.add("tabEnablePopoutOverlay",!1).setType(se.BOOLEAN),e.add("tabEnableDrag",!0).setType(se.BOOLEAN),e.add("tabEnableRename",!0).setType(se.BOOLEAN),e.add("tabContentClassName",void 0).setType(se.STRING),e.add("tabClassName",void 0).setType(se.STRING),e.add("tabIcon",void 0).setType(se.STRING),e.add("tabEnableRenderOnDemand",!0).setType(se.BOOLEAN),e.add("tabDragSpeed",.3).setType(se.NUMBER),e.add("tabBorderWidth",-1).setType(se.NUMBER),e.add("tabBorderHeight",-1).setType(se.NUMBER),e.add("tabSetEnableDeleteWhenEmpty",!0).setType(se.BOOLEAN),e.add("tabSetEnableDrop",!0).setType(se.BOOLEAN),e.add("tabSetEnableDrag",!0).setType(se.BOOLEAN),e.add("tabSetEnableDivide",!0).setType(se.BOOLEAN),e.add("tabSetEnableMaximize",!0).setType(se.BOOLEAN),e.add("tabSetEnableClose",!1).setType(se.BOOLEAN),e.add("tabSetEnableSingleTabStretch",!1).setType(se.BOOLEAN),e.add("tabSetAutoSelectTab",!0).setType(se.BOOLEAN),e.add("tabSetEnableActiveIcon",!1).setType(se.BOOLEAN),e.add("tabSetClassNameTabStrip",void 0).setType(se.STRING),e.add("tabSetEnableTabStrip",!0).setType(se.BOOLEAN),e.add("tabSetEnableTabWrap",!1).setType(se.BOOLEAN),e.add("tabSetTabLocation","top").setType("ITabLocation"),e.add("tabMinWidth",co).setType(se.NUMBER),e.add("tabMinHeight",co).setType(se.NUMBER),e.add("tabSetMinWidth",co).setType(se.NUMBER),e.add("tabSetMinHeight",co).setType(se.NUMBER),e.add("tabMaxWidth",uo).setType(se.NUMBER),e.add("tabMaxHeight",uo).setType(se.NUMBER),e.add("tabSetMaxWidth",uo).setType(se.NUMBER),e.add("tabSetMaxHeight",uo).setType(se.NUMBER),e.add("tabSetEnableTabScrollbar",!1).setType(se.BOOLEAN),e.add("borderSize",200).setType(se.NUMBER),e.add("borderMinSize",co).setType(se.NUMBER),e.add("borderMaxSize",uo).setType(se.NUMBER),e.add("borderEnableDrop",!0).setType(se.BOOLEAN),e.add("borderAutoSelectTabWhenOpen",!0).setType(se.BOOLEAN),e.add("borderAutoSelectTabWhenClosed",!1).setType(se.BOOLEAN),e.add("borderClassName",void 0).setType(se.STRING),e.add("borderEnableAutoHide",!1).setType(se.BOOLEAN),e.add("borderEnableTabScrollbar",!1).setType(se.BOOLEAN),e}};Y(rx,"MAIN_WINDOW_ID","__main_window_id__");Y(rx,"attributeDefinitions",rx.createAttributeDefinitions());let qs=rx;const ox=class so extends US{constructor(e,n,s){super(s),Y(this,"contentRect",Ee.empty()),Y(this,"tabHeaderRect",Ee.empty()),Y(this,"location"),this.location=e,this.attributes.id=`border_${e.getName()}`,so.attributeDefinitions.fromJson(n,this.attributes),s.addNode(this)}static fromJson(e,n){const s=ce.getByName(e.location),i=new so(s,e,n);return e.children&&(i.children=e.children.map(r=>{const o=Ct.fromJson(r,n);return o.setParent(i),o})),i}getLocation(){return this.location}getClassName(){return this.getAttr("className")}isHorizontal(){return this.location.orientation===Me.HORZ}getSize(){const e=this.getAttr("size"),n=this.getSelected();if(n===-1)return e;{const s=this.children[n],i=this.isHorizontal()?s.getAttr("borderWidth"):s.getAttr("borderHeight");return i===-1?e:i}}getMinSize(){const e=this.getSelectedNode();let n=this.getAttr("minSize");if(e){const s=this.isHorizontal()?e.getMinWidth():e.getMinHeight();n=Math.max(n,s)}return n}getMaxSize(){const e=this.getSelectedNode();let n=this.getAttr("maxSize");if(e){const s=this.isHorizontal()?e.getMaxWidth():e.getMaxHeight();n=Math.min(n,s)}return n}getSelected(){return this.attributes.selected}isAutoHide(){return this.getAttr("enableAutoHide")}getSelectedNode(){if(this.getSelected()!==-1)return this.children[this.getSelected()]}getOrientation(){return this.location.getOrientation()}getConfig(){return this.attributes.config}isMaximized(){return!1}isShowing(){return this.attributes.show}toJson(){const e={};return so.attributeDefinitions.toJson(e,this.attributes),e.location=this.location.getName(),e.children=this.children.map(n=>n.toJson()),e}isAutoSelectTab(e){return e==null&&(e=this.getSelected()!==-1),e?this.getAttr("autoSelectTabWhenOpen"):this.getAttr("autoSelectTabWhenClosed")}isEnableTabScrollbar(){return this.getAttr("enableTabScrollbar")}setSelected(e){this.attributes.selected=e}getTabHeaderRect(){return this.tabHeaderRect}setTabHeaderRect(e){this.tabHeaderRect=e}getRect(){return this.tabHeaderRect}getContentRect(){return this.contentRect}setContentRect(e){this.contentRect=e}isEnableDrop(){return this.getAttr("enableDrop")}setSize(e){const n=this.getSelected();if(n===-1)this.attributes.size=e;else{const s=this.children[n];(this.isHorizontal()?s.getAttr("borderWidth"):s.getAttr("borderHeight"))===-1?this.attributes.size=e:this.isHorizontal()?s.setBorderWidth(e):s.setBorderHeight(e)}}updateAttrs(e){so.attributeDefinitions.update(e,this.attributes)}remove(e){const n=this.removeChild(e);this.getSelected()!==-1&&nx(this,n)}canDrop(e,n,s){if(!(e instanceof Ct))return;let i;const r=ce.CENTER;if(this.tabHeaderRect.contains(n,s)){if(this.location.orientation===Me.VERT)if(this.children.length>0){let o=this.children[0],l=o.getTabRect();const c=l.y,d=l.height;let u=this.tabHeaderRect.x,h=0;for(let p=0;p<this.children.length;p++){if(o=this.children[p],l=o.getTabRect(),h=l.x+l.width/2,n>=u&&n<h){const f=new Ee(l.x-2,c,3,d);i=new cs(this,f,r,p,J.FLEXLAYOUT__OUTLINE_RECT);break}u=h}if(i==null){const p=new Ee(l.getRight()-2,c,3,d);i=new cs(this,p,r,this.children.length,J.FLEXLAYOUT__OUTLINE_RECT)}}else{const o=new Ee(this.tabHeaderRect.x+1,this.tabHeaderRect.y+2,3,18);i=new cs(this,o,r,0,J.FLEXLAYOUT__OUTLINE_RECT)}else if(this.children.length>0){let o=this.children[0],l=o.getTabRect();const c=l.x,d=l.width;let u=this.tabHeaderRect.y,h=0;for(let p=0;p<this.children.length;p++){if(o=this.children[p],l=o.getTabRect(),h=l.y+l.height/2,s>=u&&s<h){const f=new Ee(c,l.y-2,d,3);i=new cs(this,f,r,p,J.FLEXLAYOUT__OUTLINE_RECT);break}u=h}if(i==null){const p=new Ee(c,l.getBottom()-2,d,3);i=new cs(this,p,r,this.children.length,J.FLEXLAYOUT__OUTLINE_RECT)}}else{const o=new Ee(this.tabHeaderRect.x+2,this.tabHeaderRect.y+1,18,3);i=new cs(this,o,r,0,J.FLEXLAYOUT__OUTLINE_RECT)}if(!e.canDockInto(e,i))return}else if(this.getSelected()!==-1&&this.contentRect.contains(n,s)){const o=this.contentRect;if(i=new cs(this,o,r,-1,J.FLEXLAYOUT__OUTLINE_RECT),!e.canDockInto(e,i))return}return i}drop(e,n,s,i){let r=0;const o=e.getParent();o!==void 0&&(r=o.removeChild(e),o!==this&&o instanceof so&&o.getSelected()===r?o.setSelected(-1):nx(o,r)),e instanceof Ct&&o===this&&r<s&&s>0&&s--;let l=s;l===-1&&(l=this.children.length),e instanceof Ct&&this.addChild(e,l),(i||i!==!1&&this.isAutoSelectTab())&&this.setSelected(l),this.model.tidy()}getSplitterBounds(e,n=!1){const s=[0,0],i=n?this.getMinSize():0,r=n?this.getMaxSize():99999,o=this.model.getRoot(qs.MAIN_WINDOW_ID),l=o.getRect(),c=this.model.getSplitterSize();if(this.location===ce.TOP){s[0]=this.tabHeaderRect.getBottom()+i;const d=this.tabHeaderRect.getBottom()+r;s[1]=Math.max(s[0],l.getBottom()-o.getMinHeight()-c),s[1]=Math.min(s[1],d)}else if(this.location===ce.LEFT){s[0]=this.tabHeaderRect.getRight()+i;const d=this.tabHeaderRect.getRight()+r;s[1]=Math.max(s[0],l.getRight()-o.getMinWidth()-c),s[1]=Math.min(s[1],d)}else if(this.location===ce.BOTTOM){s[1]=this.tabHeaderRect.y-i-c;const d=this.tabHeaderRect.y-r-c;s[0]=Math.min(s[1],l.y+o.getMinHeight()),s[0]=Math.max(s[0],d)}else if(this.location===ce.RIGHT){s[1]=this.tabHeaderRect.x-i-c;const d=this.tabHeaderRect.x-r-c;s[0]=Math.min(s[1],l.x+o.getMinWidth()),s[0]=Math.max(s[0],d)}return s}calculateSplit(e,n){const s=this.getSplitterBounds(n);return this.location===ce.BOTTOM||this.location===ce.RIGHT?Math.max(0,s[1]-n):Math.max(0,n-s[0])}getAttributeDefinitions(){return so.attributeDefinitions}static getAttributeDefinitions(){return so.attributeDefinitions}static createAttributeDefinitions(){const e=new Wf;return e.add("type",so.TYPE,!0).setType(se.STRING).setFixed(),e.add("selected",-1).setType(se.NUMBER).setDescription("index of selected/visible tab in border; -1 means no tab selected"),e.add("show",!0).setType(se.BOOLEAN).setDescription("show/hide this border"),e.add("config",void 0).setType("any").setDescription("a place to hold json config used in your own code"),e.addInherited("enableDrop","borderEnableDrop").setType(se.BOOLEAN).setDescription("whether tabs can be dropped into this border"),e.addInherited("className","borderClassName").setType(se.STRING).setDescription("class applied to tab button"),e.addInherited("autoSelectTabWhenOpen","borderAutoSelectTabWhenOpen").setType(se.BOOLEAN).setDescription("whether to select new/moved tabs in border when the border is already open"),e.addInherited("autoSelectTabWhenClosed","borderAutoSelectTabWhenClosed").setType(se.BOOLEAN).setDescription("whether to select new/moved tabs in border when the border is currently closed"),e.addInherited("size","borderSize").setType(se.NUMBER).setDescription("size of the tab area when selected"),e.addInherited("minSize","borderMinSize").setType(se.NUMBER).setDescription("the minimum size of the tab area"),e.addInherited("maxSize","borderMaxSize").setType(se.NUMBER).setDescription("the maximum size of the tab area"),e.addInherited("enableAutoHide","borderEnableAutoHide").setType(se.BOOLEAN).setDescription("hide border if it has zero tabs"),e.addInherited("enableTabScrollbar","borderEnableTabScrollbar").setType(se.BOOLEAN).setDescription("whether to show a mini scrollbar for the tabs"),e}};Y(ox,"TYPE","border");Y(ox,"attributeDefinitions",ox.createAttributeDefinitions());let ds=ox,np=!1;const tE=t=>{const{layout:e,node:n,index:s,horizontal:i}=t,[r,o]=S.useState(!1),l=S.useRef(null),c=S.useRef(null),d=S.useRef([]),u=S.useRef(void 0),h=S.useRef(void 0),p=S.useRef(0),f=S.useRef(0),g=S.useRef({initialSizes:[],sum:0,startPosition:0}),y=n.getModel().getSplitterSize();let x=n.getModel().getSplitterExtra();u8()||(x=Math.max(20,x+y)-y),S.useEffect(()=>{var R,j;return(R=l.current)==null||R.addEventListener("touchstart",m,{passive:!1}),(j=c.current)==null||j.addEventListener("touchstart",m,{passive:!1}),()=>{var A,B;(A=l.current)==null||A.removeEventListener("touchstart",m),(B=c.current)==null||B.removeEventListener("touchstart",m)}},[]);const m=R=>{R.preventDefault(),R.stopImmediatePropagation()},v=R=>{var j;R.stopPropagation(),n instanceof Cn&&(g.current=n.getSplitterInitials(s)),eE(!1,e.getCurrentDocument()),h8(R.currentTarget.ownerDocument,R,_,C,w),d.current=n.getSplitterBounds(s,!0);const A=e.getRootDiv();u.current=e.getCurrentDocument().createElement("div"),u.current.style.flexDirection=i?"row":"column",u.current.className=e.getClassName(J.FLEXLAYOUT__SPLITTER_DRAG),u.current.style.cursor=n.getOrientation()===Me.VERT?"ns-resize":"ew-resize",n.getModel().isSplitterEnableHandle()&&(h.current=e.getCurrentDocument().createElement("div"),h.current.className=P(J.FLEXLAYOUT__SPLITTER_HANDLE)+" "+P(i?J.FLEXLAYOUT__SPLITTER_HANDLE_HORZ:J.FLEXLAYOUT__SPLITTER_HANDLE_VERT),u.current.appendChild(h.current));const B=(j=l.current)==null?void 0:j.getBoundingClientRect(),L=new Ee(B.x-e.getDomRect().x,B.y-e.getDomRect().y,B.width,B.height);p.current=R.clientX-B.x,f.current=R.clientY-B.y,L.positionElement(u.current),A&&A.appendChild(u.current),o(!0),np=!0},w=()=>{const R=e.getRootDiv();R&&u.current&&R.removeChild(u.current),u.current=void 0,o(!1),np=!1},_=(R,j)=>{if(u.current){const A=e.getDomRect();if(!A)return;n.getOrientation()===Me.VERT?u.current.style.top=T(j-A.y-f.current)+"px":u.current.style.left=T(R-A.x-p.current)+"px",e.isRealtimeResize()&&I()}},C=()=>{if(u.current){I();const R=e.getRootDiv();R&&u.current&&R.removeChild(u.current),u.current=void 0}eE(!0,e.getCurrentDocument()),o(!1),np=!1},I=R=>{(()=>{if(u.current){let A=0;if(n.getOrientation()===Me.VERT?A=u.current.offsetTop:A=u.current.offsetLeft,n instanceof ds){const B=n.calculateSplit(n,A);e.doAction(Ae.adjustBorderSplit(n.getId(),B))}else{const B=g.current,L=n.calculateSplit(s,A,B.initialSizes,B.sum,B.startPosition);e.doAction(Ae.adjustWeights(n.getId(),L))}}})()},T=R=>{const j=d.current;let A=R;return R<j[0]&&(A=j[0]),R>j[1]&&(A=j[1]),A},P=e.getClassName,k={cursor:i?"ew-resize":"ns-resize",flexDirection:i?"column":"row"};let N=P(J.FLEXLAYOUT__SPLITTER)+" "+P(J.FLEXLAYOUT__SPLITTER_+n.getOrientation().getName());n instanceof ds?N+=" "+P(J.FLEXLAYOUT__SPLITTER_BORDER):n.getModel().getMaximizedTabset(e.getWindowId())!==void 0&&(k.display="none"),i?(k.width=y+"px",k.minWidth=y+"px"):(k.height=y+"px",k.minHeight=y+"px");let O;if(!r&&n.getModel().isSplitterEnableHandle()&&(O=a.jsx("div",{className:P(J.FLEXLAYOUT__SPLITTER_HANDLE)+" "+P(i?J.FLEXLAYOUT__SPLITTER_HANDLE_HORZ:J.FLEXLAYOUT__SPLITTER_HANDLE_VERT)})),x===0)return a.jsx("div",{className:N,style:k,ref:l,"data-layout-path":n.getPath()+"/s"+(s-1),onPointerDown:v,children:O});{const R={};n.getOrientation()===Me.HORZ?(R.height="100%",R.width=y+x+"px",R.cursor="ew-resize"):(R.height=y+x+"px",R.width="100%",R.cursor="ns-resize");const j=P(J.FLEXLAYOUT__SPLITTER_EXTRA);return a.jsx("div",{className:N,style:k,ref:l,"data-layout-path":n.getPath()+"/s"+(s-1),onPointerDown:v,children:a.jsx("div",{style:R,ref:c,className:j,onPointerDown:v})})}};function ETe(t){const{layout:e,border:n,show:s}=t,i=S.useRef(null),r=S.useRef(void 0);S.useLayoutEffect(()=>{const d=e.getBoundingClientRect(i.current);!isNaN(d.x)&&d.width>0&&(n.getContentRect().equals(d)||(n.setContentRect(d),np?(r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{e.redrawInternal("border content rect "+d),r.current=void 0},50)):e.redrawInternal("border content rect "+d)))});let o=!0;const l={};n.getOrientation()===Me.HORZ?(l.width=n.getSize(),l.minWidth=n.getMinSize(),l.maxWidth=n.getMaxSize()):(l.height=n.getSize(),l.minHeight=n.getMinSize(),l.maxHeight=n.getMaxSize(),o=!1),l.display=s?"flex":"none";const c=e.getClassName(J.FLEXLAYOUT__BORDER_TAB_CONTENTS);return n.getLocation()===ce.LEFT||n.getLocation()===ce.TOP?a.jsxs(a.Fragment,{children:[a.jsx("div",{ref:i,style:l,className:c}),s&&a.jsx(tE,{layout:e,node:n,index:0,horizontal:o})]}):a.jsxs(a.Fragment,{children:[s&&a.jsx(tE,{layout:e,node:n,index:0,horizontal:o}),a.jsx("div",{ref:i,style:l,className:c})]})}var Jp=(t=>(t[t.Visible=1]="Visible",t[t.Always=2]="Always",t[t.Selected=3]="Selected",t))(Jp||{});const TTe=t=>{const{layout:e,node:n,selected:s,border:i,icons:r,path:o}=t,l=S.useRef(null),c=S.useRef(null),d=k=>{n.isEnableDrag()?(k.stopPropagation(),e.setDragNode(k.nativeEvent,n)):k.preventDefault()},u=k=>{k.stopPropagation(),e.clearDragMain()},h=k=>{Zp(k)&&e.auxMouseClick(n,k)},p=k=>{e.showContextMenu(n,k)},f=()=>{e.doAction(Ae.selectTab(n.getId()))},g=()=>{const k=n.getCloseType();return!!(s||k===Jp.Always||k===Jp.Visible&&window.matchMedia&&window.matchMedia("(hover: hover) and (pointer: fine)").matches)},y=k=>{g()&&(e.doAction(Ae.deleteTab(n.getId())),k.stopPropagation())},x=k=>{k.stopPropagation()};S.useLayoutEffect(()=>{n.setTabRect(e.getBoundingClientRect(l.current)),e.getEditingTab()===n&&c.current.select()});const m=k=>{k.stopPropagation()},v=k=>{k.code==="Escape"?e.setEditingTab(void 0):(k.code==="Enter"||k.code==="NumpadEnter")&&(e.setEditingTab(void 0),e.doAction(Ae.renameTab(n.getId(),k.target.value)))},w=e.getClassName;let _=w(J.FLEXLAYOUT__BORDER_BUTTON)+" "+w(J.FLEXLAYOUT__BORDER_BUTTON_+i);s?_+=" "+w(J.FLEXLAYOUT__BORDER_BUTTON__SELECTED):_+=" "+w(J.FLEXLAYOUT__BORDER_BUTTON__UNSELECTED),n.getClassName()!==void 0&&(_+=" "+n.getClassName());let C=0;n.getModel().isEnableRotateBorderIcons()===!1&&(i==="left"?C=90:i==="right"&&(C=-90));const I=aP(e,n,C);let T=I.content?a.jsx("div",{className:w(J.FLEXLAYOUT__BORDER_BUTTON_CONTENT),children:I.content}):null;const P=I.leading?a.jsx("div",{className:w(J.FLEXLAYOUT__BORDER_BUTTON_LEADING),children:I.leading}):null;if(e.getEditingTab()===n&&(T=a.jsx("input",{ref:c,className:w(J.FLEXLAYOUT__TAB_BUTTON_TEXTBOX),"data-layout-path":o+"/textbox",type:"text",autoFocus:!0,defaultValue:n.getName(),onKeyDown:v,onPointerDown:m})),n.isEnableClose()){const k=e.i18nName(Kn.Close_Tab);I.buttons.push(a.jsx("div",{"data-layout-path":o+"/button/close",title:k,className:w(J.FLEXLAYOUT__BORDER_BUTTON_TRAILING),onPointerDown:x,onClick:y,children:typeof r.close=="function"?r.close(n):r.close},"close"))}return a.jsxs("div",{ref:l,"data-layout-path":o,className:_,onClick:f,onAuxClick:h,onContextMenu:p,title:n.getHelpText(),draggable:!0,onDragStart:d,onDragEnd:u,children:[P,T,I.buttons]})},ax=t=>{const{layout:e,node:n}=t,s=e.getClassName,i=s(J.FLEXLAYOUT__TAB_BUTTON_STAMP),r=aP(e,n),o=r.content?a.jsx("div",{className:s(J.FLEXLAYOUT__TAB_BUTTON_CONTENT),children:r.content}):n.getNameForOverflowMenu(),l=r.leading?a.jsx("div",{className:s(J.FLEXLAYOUT__TAB_BUTTON_LEADING),children:r.leading}):null;return a.jsxs("div",{className:i,title:n.getHelpText(),children:[l,o]})};function f8(t,e,n,s,i){const r=i.getRootDiv(),o=i.getClassName,l=t.ownerDocument,c=t.getBoundingClientRect(),d=(r==null?void 0:r.getBoundingClientRect())??new DOMRect(0,0,100,100),u=l.createElement("div");u.className=o(J.FLEXLAYOUT__POPUP_MENU_CONTAINER),c.left<d.left+d.width/2?u.style.left=c.left-d.left+"px":u.style.right=d.right-c.right+"px",c.top<d.top+d.height/2?u.style.top=c.top-d.top+"px":u.style.bottom=d.bottom-c.bottom+"px",i.showOverlay(!0),r&&r.appendChild(u);const h=()=>{i.hideControlInPortal(),i.showOverlay(!1),r&&r.removeChild(u),u.removeEventListener("pointerdown",p),l.removeEventListener("pointerdown",f)},p=g=>{g.stopPropagation()},f=g=>{h()};u.addEventListener("pointerdown",p),l.addEventListener("pointerdown",f),i.showControlInPortal(a.jsx(ITe,{currentDocument:l,parentNode:e,onSelect:s,onHide:h,items:n,classNameMapper:o,layout:i}),u)}const ITe=t=>{const{parentNode:e,items:n,onHide:s,onSelect:i,classNameMapper:r,layout:o}=t,l=S.useRef(null);S.useEffect(()=>{l.current&&l.current.focus()},[]);const c=(f,g)=>{i(f),s(),g.stopPropagation()},d=(f,g)=>{f.stopPropagation(),o.setDragNode(f.nativeEvent,g),setTimeout(()=>{s()},0)},u=f=>{o.clearDragMain()},h=f=>{f.key==="Escape"&&s()},p=n.map((f,g)=>{let y=r(J.FLEXLAYOUT__POPUP_MENU_ITEM);return e.getSelected()===f.index&&(y+=" "+r(J.FLEXLAYOUT__POPUP_MENU_ITEM__SELECTED)),a.jsx("div",{className:y,"data-layout-path":"/popup-menu/tb"+g,onClick:x=>c(f,x),draggable:!0,onDragStart:x=>d(x,f.node),onDragEnd:u,title:f.node.getHelpText(),children:a.jsx(ax,{node:f.node,layout:o})},f.index)});return a.jsx("div",{className:r(J.FLEXLAYOUT__POPUP_MENU),ref:l,tabIndex:0,onKeyDown:h,"data-layout-path":"/popup-menu",children:p})},g8=(t,e,n,s,i,r)=>{const[o,l]=S.useState([]),[c,d]=S.useState(!1),[u,h]=S.useState(!1),p=S.useRef(null),f=S.useRef(!1),g=S.useRef(void 0),y=S.useRef([]),x=S.useRef(0),m=S.useRef(!1);y.current=o,S.useLayoutEffect(()=>{s.current&&D(0)},[e.getId()]),S.useLayoutEffect(()=>{f.current=!1},[e.getSelectedNode(),e.getRect().width,e.getRect().height]),S.useLayoutEffect(()=>{O(),f.current===!1&&w(),_(),C()}),S.useEffect(()=>{var z;return(z=p.current)==null||z.addEventListener("wheel",v,{passive:!1}),()=>{var H;(H=p.current)==null||H.removeEventListener("wheel",v)}},[p.current]);const v=z=>{z.preventDefault()};function w(){const z=e.getSelectedNode();if(z&&s.current){const H=t.getBoundingClientRect(s.current),q=z.getTabRect();let V=A(H)-A(q);V>0||$(q)>$(H)?(D(U(s.current)-V),m.current=!0):(V=B(q)-B(H),V>0&&(D(U(s.current)+V),m.current=!0))}}const _=()=>{if(s.current&&i.current){const z=s.current,H=i.current,q=L(z),V=M(z),ee=U(z);if(V>q&&V>0){let Q=q*q/V,ae=0;Q<20&&(ae=20-Q,Q=20);const ue=ee*(q-ae)/V;n===Me.HORZ?(H.style.width=Q+"px",H.style.left=ue+"px"):(H.style.height=Q+"px",H.style.top=ue+"px"),H.style.display="block"}else H.style.display="none";n===Me.HORZ?H.style.bottom="0px":H.style.right="0px"}},C=()=>{const H=R().length>0;H!==c&&d(H),g.current===void 0&&(g.current=setTimeout(()=>{const q=R();PTe(q,y.current)||l(q),g.current=void 0},100))},I=()=>{m.current||(f.current=!0),m.current=!1,_(),C()},T=z=>{var H;z.stopPropagation(),i.current.setPointerCapture(z.pointerId);const q=(H=i.current)==null?void 0:H.getBoundingClientRect();n===Me.HORZ?x.current=z.clientX-q.x:x.current=z.clientY-q.y,h8(z.currentTarget.ownerDocument,z,P,k,N)},P=(z,H)=>{if(s.current&&i.current){const q=s.current,V=i.current,ee=L(q),Q=M(q),ae=L(V),ue=q.getBoundingClientRect();let he=0;if(n===Me.HORZ?he=z-ue.x-x.current:he=H-ue.y-x.current,he=Math.max(0,Math.min(Q-ae,he)),ee>0){const _e=he*Q/ee;D(_e)}}},k=()=>{},N=()=>{},O=()=>{if(s.current){const H=s.current.firstElementChild,q=u?10:0,V=L(H)+q>L(s.current);V!==u&&h(V)}},R=()=>{const z=[];if(s.current){const H=s.current,q=H.getBoundingClientRect(),V=A(q)-1,ee=B(q)+1,Q=H.firstElementChild;let ae=0;Array.from(Q.children).forEach(ue=>{const he=ue.getBoundingClientRect();ue.classList.contains(r)&&((A(he)<V||B(he)>ee)&&z.push(ae),ae++)})}return z},j=z=>{if(s.current){if(e.getChildren().length===0)return;let H=0;if(Math.abs(z.deltaY)>0){H=-z.deltaY,z.deltaMode===1&&(H*=40);const q=U(s.current)-H,V=M(s.current)-L(s.current),ee=Math.max(0,Math.min(V,q));D(ee),z.stopPropagation()}}},A=z=>n===Me.HORZ?z.x:z.y,B=z=>n===Me.HORZ?z.right:z.bottom,L=z=>n===Me.HORZ?z.clientWidth:z.clientHeight,$=z=>n===Me.HORZ?z.width:z.height,M=z=>n===Me.HORZ?z.scrollWidth:z.scrollHeight,D=z=>{n===Me.HORZ?s.current.scrollLeft=z:s.current.scrollTop=z},U=z=>n===Me.HORZ?z.scrollLeft:z.scrollTop;return{selfRef:p,userControlledPositionRef:f,onScroll:I,onScrollPointerDown:T,hiddenTabs:o,onMouseWheel:j,isDockStickyButtons:u,isShowHiddenTabs:c}};function PTe(t,e){return t.length===e.length&&t.every((n,s)=>n===e[s])}const kTe=t=>{const{border:e,layout:n,size:s}=t,i=S.useRef(null),r=S.useRef(null),o=S.useRef(null),l=S.useRef(null),c=S.useRef(null),d=n.getIcons();S.useLayoutEffect(()=>{e.setTabHeaderRect(n.getBoundingClientRect(u.current))});const{selfRef:u,userControlledPositionRef:h,onScroll:p,onScrollPointerDown:f,hiddenTabs:g,onMouseWheel:y,isDockStickyButtons:x,isShowHiddenTabs:m}=g8(n,e,Me.flip(e.getOrientation()),c,r,n.getClassName(J.FLEXLAYOUT__BORDER_BUTTON)),v=q=>{Zp(q)&&n.auxMouseClick(e,q)},w=q=>{n.showContextMenu(e,q)},_=q=>{q.stopPropagation()},C=q=>{const V=n.getShowOverflowMenu(),ee=g.map(Q=>({index:Q,node:e.getChildren()[Q]}));if(V!==void 0)V(e,q,ee,I);else{const Q=o.current;f8(Q,e,ee,I,n)}q.stopPropagation()},I=q=>{n.doAction(Ae.selectTab(q.node.getId())),h.current=!1},T=q=>{const V=e.getChildren()[e.getSelected()];V!==void 0&&n.doAction(Ae.popoutTab(V.getId())),q.stopPropagation()},P=n.getClassName,k=[],N=q=>{const V=e.getSelected()===q,ee=e.getChildren()[q];k.push(a.jsx(TTe,{layout:n,border:e.getLocation().getName(),node:ee,path:e.getPath()+"/tb"+q,selected:V,icons:d},ee.getId())),q<e.getChildren().length-1&&k.push(a.jsx("div",{className:P(J.FLEXLAYOUT__BORDER_TAB_DIVIDER)},"divider"+q))};for(let q=0;q<e.getChildren().length;q++)N(q);let O=P(J.FLEXLAYOUT__BORDER)+" "+P(J.FLEXLAYOUT__BORDER_+e.getLocation().getName());e.getClassName()!==void 0&&(O+=" "+e.getClassName());let R,j=[],A=[];const B={leading:R,buttons:j,stickyButtons:A,overflowPosition:void 0};if(n.customizeTabSet(e,B),R=B.leading,A=B.stickyButtons,j=B.buttons,B.overflowPosition===void 0&&(B.overflowPosition=A.length),A.length>0&&(x?j=[...A,...j]:k.push(a.jsx("div",{ref:l,onPointerDown:_,onDragStart:q=>{q.preventDefault()},className:P(J.FLEXLAYOUT__TAB_TOOLBAR_STICKY_BUTTONS_CONTAINER),children:A},"sticky_buttons_container"))),m){const q=n.i18nName(Kn.Overflow_Menu_Tooltip);let V;if(typeof d.more=="function"){const ee=g.map(Q=>({index:Q,node:e.getChildren()[Q]}));V=d.more(e,ee)}else V=a.jsxs(a.Fragment,{children:[d.more,a.jsx("div",{className:P(J.FLEXLAYOUT__TAB_BUTTON_OVERFLOW_COUNT),children:g.length>0?g.length:""})]});j.splice(Math.min(B.overflowPosition,j.length),0,a.jsx("button",{ref:o,className:P(J.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON)+" "+P(J.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW)+" "+P(J.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW_+e.getLocation().getName()),title:q,onClick:C,onPointerDown:_,children:V},"overflowbutton"))}const L=e.getSelected();if(L!==-1){const q=e.getChildren()[L];if(q!==void 0&&n.isSupportsPopout()&&q.isEnablePopout()){const V=n.i18nName(Kn.Popout_Tab);j.push(a.jsx("button",{title:V,className:P(J.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON)+" "+P(J.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_FLOAT),onClick:T,onPointerDown:_,children:typeof d.popout=="function"?d.popout(q):d.popout},"popout"))}}const $=a.jsx("div",{ref:i,className:P(J.FLEXLAYOUT__BORDER_TOOLBAR)+" "+P(J.FLEXLAYOUT__BORDER_TOOLBAR_+e.getLocation().getName()),children:j},"toolbar");let M={},D={};const U=s-1;e.getLocation()===ce.LEFT?(M={right:"100%",top:0},D={width:U,overflowY:"auto"}):e.getLocation()===ce.RIGHT?(M={left:"100%",top:0},D={width:U,overflowY:"auto"}):(M={left:0},D={height:U,overflowX:"auto"});let z;e.isEnableTabScrollbar()&&(z=a.jsx("div",{ref:r,className:P(J.FLEXLAYOUT__MINI_SCROLLBAR),onPointerDown:f}));let H;return R&&(H=a.jsx("div",{className:P(J.FLEXLAYOUT__BORDER_LEADING),children:R})),a.jsxs("div",{ref:u,style:{display:"flex",flexDirection:e.getOrientation()===Me.VERT?"row":"column"},className:O,"data-layout-path":e.getPath(),onClick:v,onAuxClick:v,onContextMenu:w,onWheel:y,children:[H,a.jsxs("div",{className:P(J.FLEXLAYOUT__MINI_SCROLLBAR_CONTAINER),children:[a.jsx("div",{ref:c,className:P(J.FLEXLAYOUT__BORDER_INNER)+" "+P(J.FLEXLAYOUT__BORDER_INNER_+e.getLocation().getName()),style:D,onScroll:p,children:a.jsx("div",{style:M,className:P(J.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER)+" "+P(J.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER_+e.getLocation().getName()),children:k})}),z]}),$]})},jTe=t=>{const{layout:e,node:n}=t,s=S.useRef(null);S.useEffect(()=>{n.setTabStamp(s.current)},[n,s.current]);const i=e.getClassName,r=i(J.FLEXLAYOUT__DRAG_RECT);return a.jsx("div",{ref:s,className:r,children:a.jsx(ax,{layout:e,node:n},n.getId())})},NTe=t=>{const{title:e,layout:n,layoutWindow:s,url:i,onCloseWindow:r,onSetWindow:o,children:l}=t,c=S.useRef(null),[d,u]=S.useState(void 0),h=new Map;return S.useLayoutEffect(()=>{if(!c.current){const p=s.windowId,f=s.rect;c.current=window.open(i,p,`left=${f.x},top=${f.y},width=${f.width},height=${f.height}`),c.current?(s.window=c.current,o(s,c.current),window.addEventListener("beforeunload",()=>{if(c.current){const g=c.current;c.current=null,g.close()}}),c.current.addEventListener("load",()=>{if(c.current){c.current.focus(),c.current.resizeTo(f.width,f.height),c.current.moveTo(f.x,f.y);const g=c.current.document;g.title=e;const y=g.createElement("div");y.className=J.FLEXLAYOUT__FLOATING_WINDOW_CONTENT,g.body.appendChild(y),RTe(g,h).then(()=>{u(y)});const x=new MutationObserver(m=>ATe(m,g,h));x.observe(document.head,{childList:!0}),c.current.addEventListener("beforeunload",()=>{c.current&&(r(s),c.current=null,x.disconnect())})}})):(console.warn(`Unable to open window ${i}`),r(s))}return()=>{var p;n.getModel().getwindowsMap().has(s.windowId)||((p=c.current)==null||p.close(),c.current=null)}},[]),d!==void 0?Br.createPortal(l,d):null};function ATe(t,e,n){for(const s of t)if(s.type==="childList"){for(const i of s.addedNodes)(i instanceof HTMLLinkElement||i instanceof HTMLStyleElement)&&m8(e,i,n);for(const i of s.removedNodes)if(i instanceof HTMLLinkElement||i instanceof HTMLStyleElement){const r=n.get(i);r&&e.head.removeChild(r)}}}function RTe(t,e){const n=[],s=document.querySelectorAll('style, link[rel="stylesheet"]');for(const i of s)m8(t,i,e,n);return Promise.all(n)}function m8(t,e,n,s){if(e instanceof HTMLLinkElement){const i=e.cloneNode(!0);t.head.appendChild(i),n.set(e,i),s&&s.push(new Promise(r=>{i.onload=()=>r(!0)}))}else if(e instanceof HTMLStyleElement)try{const i=e.cloneNode(!0);t.head.appendChild(i),n.set(e,i)}catch{}}const xu={width:"1em",height:"1em",display:"flex",alignItems:"center"},jM=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:xu,viewBox:"0 0 24 24",children:[a.jsx("path",{fill:"none",d:"M0 0h24v24H0z"}),a.jsx("path",{stroke:"var(--color-icon)",fill:"var(--color-icon)",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})]}),MTe=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:xu,viewBox:"0 0 24 24",fill:"var(--color-icon)",children:[a.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),a.jsx("path",{stroke:"var(--color-icon)",d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})]}),OTe=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:xu,viewBox:"0 0 24 24",fill:"var(--color-icon)",children:[a.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),a.jsx("path",{stroke:"var(--color-icon)",d:"M7 10l5 5 5-5z"})]}),DTe=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"block",width:10,height:10},preserveAspectRatio:"none",viewBox:"0 0 100 100",children:a.jsx("path",{fill:"var(--color-edge-icon)",stroke:"var(--color-edge-icon)",d:"M10 30 L90 30 l-40 40 Z"})}),LTe=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:xu,viewBox:"0 0 20 20",fill:"var(--color-icon)",children:[a.jsx("path",{d:"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"}),a.jsx("path",{d:"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"})]}),FTe=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:xu,viewBox:"0 0 24 24",fill:"var(--color-icon)",children:[a.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),a.jsx("path",{stroke:"var(--color-icon)",d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"})]}),BTe=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",style:xu,height:"24px",viewBox:"0 -960 960 960",width:"24px",children:a.jsx("path",{fill:"var(--color-icon)",stroke:"var(--color-icon)",d:"M440-120v-264L254-197l-57-57 187-186H120v-80h264L197-706l57-57 186 187v-264h80v264l186-187 57 57-187 186h264v80H576l187 186-57 57-186-187v264h-80Z"})}),UTe=t=>{const{layout:e,show:n}=t;return a.jsx("div",{className:e.getClassName(J.FLEXLAYOUT__LAYOUT_OVERLAY),style:{display:n?"flex":"none"}})},$Te=t=>{const{layout:e,node:n,selected:s,path:i}=t,r=S.useRef(null),o=S.useRef(null),l=e.getIcons();S.useLayoutEffect(()=>{n.setTabRect(e.getBoundingClientRect(r.current)),e.getEditingTab()===n&&o.current.select()});const c=j=>{n.isEnableDrag()?(j.stopPropagation(),e.setDragNode(j.nativeEvent,n)):j.preventDefault()},d=j=>{e.clearDragMain()},u=j=>{Zp(j)&&e.auxMouseClick(n,j)},h=j=>{e.showContextMenu(n,j)},p=()=>{e.doAction(Ae.selectTab(n.getId()))},f=j=>{n.isEnableRename()&&(g(),j.stopPropagation())},g=()=>{e.setEditingTab(n),e.getCurrentDocument().body.addEventListener("pointerdown",y)},y=j=>{j.target!==o.current&&(e.getCurrentDocument().body.removeEventListener("pointerdown",y),e.setEditingTab(void 0))},x=()=>{const j=n.getCloseType();return!!(s||j===Jp.Always||j===Jp.Visible&&window.matchMedia&&window.matchMedia("(hover: hover) and (pointer: fine)").matches)},m=j=>{x()&&(e.doAction(Ae.deleteTab(n.getId())),j.stopPropagation())},v=j=>{j.stopPropagation()},w=j=>{j.stopPropagation()},_=j=>{j.code==="Escape"?e.setEditingTab(void 0):(j.code==="Enter"||j.code==="NumpadEnter")&&(e.setEditingTab(void 0),e.doAction(Ae.renameTab(n.getId(),j.target.value)))},C=e.getClassName,I=n.getParent(),T=I.isEnableSingleTabStretch()&&I.getChildren().length===1,P=T?J.FLEXLAYOUT__TAB_BUTTON_STRETCH:J.FLEXLAYOUT__TAB_BUTTON;let k=C(P);k+=" "+C(P+"_"+I.getTabLocation()),T||(s?k+=" "+C(P+"--selected"):k+=" "+C(P+"--unselected")),n.getClassName()!==void 0&&(k+=" "+n.getClassName());const N=aP(e,n);let O=N.content?a.jsx("div",{className:C(J.FLEXLAYOUT__TAB_BUTTON_CONTENT),children:N.content}):null;const R=N.leading?a.jsx("div",{className:C(J.FLEXLAYOUT__TAB_BUTTON_LEADING),children:N.leading}):null;if(e.getEditingTab()===n&&(O=a.jsx("input",{ref:o,className:C(J.FLEXLAYOUT__TAB_BUTTON_TEXTBOX),"data-layout-path":i+"/textbox",type:"text",autoFocus:!0,defaultValue:n.getName(),onKeyDown:_,onPointerDown:w})),n.isEnableClose()&&!T){const j=e.i18nName(Kn.Close_Tab);N.buttons.push(a.jsx("div",{"data-layout-path":i+"/button/close",title:j,className:C(J.FLEXLAYOUT__TAB_BUTTON_TRAILING),onPointerDown:v,onClick:m,children:typeof l.close=="function"?l.close(n):l.close},"close"))}return a.jsxs("div",{ref:r,"data-layout-path":i,className:k,onClick:p,onAuxClick:u,onContextMenu:h,title:n.getHelpText(),draggable:!0,onDragStart:c,onDragEnd:d,onDoubleClick:f,children:[R,O,N.buttons]})},zTe=t=>{const{node:e,layout:n}=t,s=S.useRef(null),i=S.useRef(null),r=S.useRef(null),o=S.useRef(null),l=S.useRef(null),c=S.useRef(null),d=S.useRef(null),u=S.useRef(void 0),h=n.getIcons();S.useLayoutEffect(()=>{e.setRect(n.getBoundingClientRect(p.current)),s.current&&e.setTabStripRect(n.getBoundingClientRect(s.current));const oe=n.getBoundingClientRect(o.current);!e.getContentRect().equals(oe)&&!isNaN(oe.x)&&(e.setContentRect(oe),np?(u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{n.redrawInternal("border content rect "+oe),u.current=void 0},50)):n.redrawInternal("border content rect "+oe))});const{selfRef:p,userControlledPositionRef:f,onScroll:g,onScrollPointerDown:y,hiddenTabs:x,onMouseWheel:m,isDockStickyButtons:v,isShowHiddenTabs:w}=g8(n,e,Me.HORZ,r,i,n.getClassName(J.FLEXLAYOUT__TAB_BUTTON)),_=oe=>{const Ge=n.getShowOverflowMenu(),jt=x.map(xn=>({index:xn,node:e.getChildren()[xn]}));if(Ge!==void 0)Ge(e,oe,jt,C);else{const xn=c.current;f8(xn,e,jt,C,n)}oe.stopPropagation()},C=oe=>{n.doAction(Ae.selectTab(oe.node.getId())),f.current=!1},I=oe=>{n.getEditingTab()?oe.preventDefault():e.isEnableDrag()?(oe.stopPropagation(),n.setDragNode(oe.nativeEvent,e)):oe.preventDefault()},T=oe=>{Zp(oe)||n.doAction(Ae.setActiveTabset(e.getId(),n.getWindowId()))},P=oe=>{Zp(oe)&&n.auxMouseClick(e,oe)},k=oe=>{n.showContextMenu(e,oe)},N=oe=>{oe.stopPropagation()},O=oe=>{e.canMaximize()&&n.maximize(e),oe.stopPropagation()},R=oe=>{n.doAction(Ae.deleteTabset(e.getId())),oe.stopPropagation()},j=oe=>{n.doAction(Ae.deleteTab(e.getChildren()[0].getId())),oe.stopPropagation()},A=oe=>{$!==void 0&&n.doAction(Ae.popoutTab($.getId())),oe.stopPropagation()},B=oe=>{e.canMaximize()&&n.maximize(e)},L=n.getClassName,$=e.getSelectedNode(),M=e.getPath(),D=[];if(e.isEnableTabStrip())for(let oe=0;oe<e.getChildren().length;oe++){const Ge=e.getChildren()[oe],jt=e.getSelected()===oe;D.push(a.jsx($Te,{layout:n,node:Ge,path:M+"/tb"+oe,selected:jt},Ge.getId())),oe<e.getChildren().length-1&&D.push(a.jsx("div",{className:L(J.FLEXLAYOUT__TABSET_TAB_DIVIDER)},"divider"+oe))}let U,z=[],H=[];const q={leading:U,stickyButtons:z,buttons:H,overflowPosition:void 0};n.customizeTabSet(e,q),U=q.leading,z=q.stickyButtons,H=q.buttons;const V=e.isEnableSingleTabStretch()&&e.getChildren().length===1,ee=V&&e.getChildren()[0].isEnableClose()||e.isEnableClose();if(q.overflowPosition===void 0&&(q.overflowPosition=z.length),z.length>0&&(!e.isEnableTabWrap()&&(v||V)?H=[...z,...H]:D.push(a.jsx("div",{ref:d,onPointerDown:N,onDragStart:oe=>{oe.preventDefault()},className:L(J.FLEXLAYOUT__TAB_TOOLBAR_STICKY_BUTTONS_CONTAINER),children:z},"sticky_buttons_container"))),!e.isEnableTabWrap()&&w){const oe=n.i18nName(Kn.Overflow_Menu_Tooltip);let Ge;if(typeof h.more=="function"){const jt=x.map(xn=>({index:xn,node:e.getChildren()[xn]}));Ge=h.more(e,jt)}else Ge=a.jsxs(a.Fragment,{children:[h.more,a.jsx("div",{className:L(J.FLEXLAYOUT__TAB_BUTTON_OVERFLOW_COUNT),children:x.length>0?x.length:""})]});H.splice(Math.min(q.overflowPosition,H.length),0,a.jsx("button",{"data-layout-path":M+"/button/overflow",ref:c,className:L(J.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+L(J.FLEXLAYOUT__TAB_BUTTON_OVERFLOW),title:oe,onClick:_,onPointerDown:N,children:Ge},"overflowbutton"))}if($!==void 0&&n.isSupportsPopout()&&$.isEnablePopout()&&$.isEnablePopoutIcon()){const oe=n.i18nName(Kn.Popout_Tab);H.push(a.jsx("button",{"data-layout-path":M+"/button/popout",title:oe,className:L(J.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+L(J.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_FLOAT),onClick:A,onPointerDown:N,children:typeof h.popout=="function"?h.popout($):h.popout},"popout"))}if(e.canMaximize()){const oe=n.i18nName(Kn.Restore),Ge=n.i18nName(Kn.Maximize);H.push(a.jsx("button",{"data-layout-path":M+"/button/max",title:e.isMaximized()?oe:Ge,className:L(J.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+L(J.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_+(e.isMaximized()?"max":"min")),onClick:O,onPointerDown:N,children:e.isMaximized()?typeof h.restore=="function"?h.restore(e):h.restore:typeof h.maximize=="function"?h.maximize(e):h.maximize},"max"))}if(!e.isMaximized()&&ee){const oe=V?n.i18nName(Kn.Close_Tab):n.i18nName(Kn.Close_Tabset);H.push(a.jsx("button",{"data-layout-path":M+"/button/close",title:oe,className:L(J.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+L(J.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_CLOSE),onClick:V?j:R,onPointerDown:N,children:typeof h.closeTabset=="function"?h.closeTabset(e):h.closeTabset},"close"))}if(e.isActive()&&e.isEnableActiveIcon()){const oe=n.i18nName(Kn.Active_Tabset);H.push(a.jsx("div",{"data-layout-path":M+"/button/active",title:oe,className:L(J.FLEXLAYOUT__TAB_TOOLBAR_ICON),children:typeof h.activeTabset=="function"?h.activeTabset(e):h.activeTabset},"active"))}const Q=a.jsx("div",{ref:l,className:L(J.FLEXLAYOUT__TAB_TOOLBAR),onPointerDown:N,onDragStart:oe=>{oe.preventDefault()},children:H},"buttonbar");let ae,ue=L(J.FLEXLAYOUT__TABSET_TABBAR_OUTER);if(e.getClassNameTabStrip()!==void 0&&(ue+=" "+e.getClassNameTabStrip()),ue+=" "+J.FLEXLAYOUT__TABSET_TABBAR_OUTER_+e.getTabLocation(),e.isActive()&&(ue+=" "+L(J.FLEXLAYOUT__TABSET_SELECTED)),e.isMaximized()&&(ue+=" "+L(J.FLEXLAYOUT__TABSET_MAXIMIZED)),V){const oe=e.getChildren()[0];oe.getTabSetClassName()!==void 0&&(ue+=" "+oe.getTabSetClassName())}let he;if(U&&(he=a.jsx("div",{className:L(J.FLEXLAYOUT__TABSET_LEADING),children:U})),e.isEnableTabWrap())e.isEnableTabStrip()&&(ae=a.jsxs("div",{className:ue,style:{flexWrap:"wrap",gap:"1px",marginTop:"2px"},ref:s,"data-layout-path":M+"/tabstrip",onPointerDown:T,onDoubleClick:B,onContextMenu:k,onClick:P,onAuxClick:P,draggable:!0,onDragStart:I,children:[he,D,a.jsx("div",{style:{flexGrow:1}}),Q]}));else if(e.isEnableTabStrip()){let oe;e.isEnableTabScrollbar()&&(oe=a.jsx("div",{ref:i,className:L(J.FLEXLAYOUT__MINI_SCROLLBAR),onPointerDown:y})),ae=a.jsxs("div",{className:ue,ref:s,"data-layout-path":M+"/tabstrip",onPointerDown:T,onDoubleClick:B,onContextMenu:k,onClick:P,onAuxClick:P,draggable:!0,onWheel:m,onDragStart:I,children:[he,a.jsxs("div",{className:L(J.FLEXLAYOUT__MINI_SCROLLBAR_CONTAINER),children:[a.jsx("div",{ref:r,className:L(J.FLEXLAYOUT__TABSET_TABBAR_INNER)+" "+L(J.FLEXLAYOUT__TABSET_TABBAR_INNER_+e.getTabLocation()),style:{overflowX:"auto",overflowY:"hidden"},onScroll:g,children:a.jsx("div",{style:{width:V?"100%":"none"},className:L(J.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER)+" "+L(J.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER_+e.getTabLocation()),children:D})}),oe]}),Q]})}let _e;if(e.getChildren().length===0){const oe=n.getTabSetPlaceHolderCallback();oe&&(_e=oe(e))}let Pe=a.jsx("div",{ref:o,className:L(J.FLEXLAYOUT__TABSET_CONTENT),children:_e});e.getTabLocation()==="top"?Pe=a.jsxs(a.Fragment,{children:[ae,Pe]}):Pe=a.jsxs(a.Fragment,{children:[Pe,ae]});const qt={flexGrow:Math.max(1,e.getWeight()*1e3),minWidth:e.getMinWidth(),minHeight:e.getMinHeight(),maxWidth:e.getMaxWidth(),maxHeight:e.getMaxHeight()};e.getModel().getMaximizedTabset(n.getWindowId())!==void 0&&!e.isMaximized()&&(qt.display="none");const nt=a.jsx("div",{ref:p,className:L(J.FLEXLAYOUT__TABSET_CONTAINER),style:qt,children:a.jsx("div",{className:L(J.FLEXLAYOUT__TABSET),"data-layout-path":M,children:Pe})});return e.isMaximized()&&n.getMainElement()?Br.createPortal(a.jsx("div",{style:{position:"absolute",display:"flex",top:0,left:0,bottom:0,right:0},children:nt}),n.getMainElement()):nt},y8=t=>{const{layout:e,node:n}=t,s=S.useRef(null),i=n.getOrientation()===Me.HORZ;S.useLayoutEffect(()=>{n.setRect(e.getBoundingClientRect(s.current))});const r=[];let o=0;for(const c of n.getChildren())o>0&&r.push(a.jsx(tE,{layout:e,node:n,index:o,horizontal:i},"splitter"+o)),c instanceof Cn?r.push(a.jsx(y8,{layout:e,node:c},c.getId())):c instanceof dt&&r.push(a.jsx(zTe,{layout:e,node:c},c.getId())),o++;const l={flexGrow:Math.max(1,n.getWeight()*1e3),minWidth:n.getMinWidth(),minHeight:n.getMinHeight(),maxWidth:n.getMaxWidth(),maxHeight:n.getMaxHeight()};return i?l.flexDirection="row":l.flexDirection="column",a.jsx("div",{ref:s,className:e.getClassName(J.FLEXLAYOUT__ROW),style:l,children:r})},WTe=t=>{const{layout:e,selected:n,node:s,path:i}=t,r=S.useRef(null),o=S.useRef(!0),l=s.getParent(),c=l.getContentRect();S.useLayoutEffect(()=>{const g=s.getMoveableElement();r.current.appendChild(g),s.setMoveableElement(g);const y=()=>{s.saveScrollPosition()};return g.addEventListener("scroll",y),r.current.addEventListener("pointerdown",d),()=>{g.removeEventListener("scroll",y),r.current&&r.current.removeEventListener("pointerdown",d),s.setVisible(!1)}},[]),S.useEffect(()=>{s.isSelected()&&o.current&&(s.restoreScrollPosition(),o.current=!1)});const d=()=>{const g=s.getParent();g instanceof dt&&(g.isActive()||e.doAction(Ae.setActiveTabset(g.getId(),e.getWindowId())))};s.setRect(c);const u=e.getClassName,h={};c.styleWithPosition(h);let p=null;if(n){if(s.setVisible(!0),document.hidden&&s.isEnablePopoutOverlay()){const g={};c.styleWithPosition(g),p=a.jsx("div",{style:g,className:u(J.FLEXLAYOUT__TAB_OVERLAY)})}}else h.display="none",s.setVisible(!1);l instanceof dt&&s.getModel().getMaximizedTabset(e.getWindowId())!==void 0&&(l.isMaximized()?h.zIndex=10:h.display="none"),l instanceof ds&&(l.isShowing()||(h.display="none"));let f=u(J.FLEXLAYOUT__TAB);return l instanceof ds&&(f+=" "+u(J.FLEXLAYOUT__TAB_BORDER),f+=" "+u(J.FLEXLAYOUT__TAB_BORDER_+l.getLocation().getName())),s.getContentClassName()!==void 0&&(f+=" "+s.getContentClassName()),a.jsxs(a.Fragment,{children:[p,a.jsx("div",{ref:r,style:h,className:f,"data-layout-path":i})]})};class HTe extends S.Component{constructor(e){super(e),Y(this,"retry",()=>{this.setState({hasError:!1})}),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,n){console.debug(e),console.debug(n)}render(){return this.state.hasError?a.jsx("div",{className:J.FLEXLAYOUT__ERROR_BOUNDARY_CONTAINER,children:a.jsx("div",{className:J.FLEXLAYOUT__ERROR_BOUNDARY_CONTENT,children:a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[this.props.message,a.jsx("p",{children:a.jsx("button",{onClick:this.retry,children:this.props.retryText})})]})})}):this.props.children}}const GTe=S.memo(({layout:t,node:e})=>a.jsx(HTe,{message:t.i18nName(Kn.Error_rendering_component),retryText:t.i18nName(Kn.Error_rendering_component_retry),children:t.props.factory(e)}),VTe);function VTe(t,e){return!(e.visible&&(!t.rect.equalSize(e.rect)||t.forceRevision!==e.forceRevision||t.tabsRevision!==e.tabsRevision))}class KTe extends S.Component{constructor(e){super(e),Y(this,"selfRef"),Y(this,"revision"),this.selfRef=S.createRef(),this.revision=0}redraw(){this.selfRef.current.redraw("parent "+this.revision)}addTabToTabSet(e,n){return this.selfRef.current.addTabToTabSet(e,n)}addTabWithDragAndDrop(e,n,s){this.selfRef.current.addTabWithDragAndDrop(e,n,s)}moveTabWithDragAndDrop(e,n){this.selfRef.current.moveTabWithDragAndDrop(e,n)}addTabToActiveTabSet(e){return this.selfRef.current.addTabToActiveTabSet(e)}setDragComponent(e,n,s,i){this.selfRef.current.setDragComponent(e,n,s,i)}getRootDiv(){return this.selfRef.current.getRootDiv()}render(){return a.jsx(YTe,{ref:this.selfRef,...this.props,renderRevision:this.revision++})}}const v8=class Es extends S.Component{constructor(e){super(e),Y(this,"selfRef"),Y(this,"moveablesRef"),Y(this,"findBorderBarSizeRef"),Y(this,"mainRef"),Y(this,"previousModel"),Y(this,"orderedTabIds"),Y(this,"orderedTabMoveableIds"),Y(this,"moveableElementMap",new Map),Y(this,"dropInfo"),Y(this,"outlineDiv"),Y(this,"currentDocument"),Y(this,"currentWindow"),Y(this,"supportsPopout"),Y(this,"popoutURL"),Y(this,"icons"),Y(this,"resizeObserver"),Y(this,"dragEnterCount",0),Y(this,"dragging",!1),Y(this,"windowId"),Y(this,"layoutWindow"),Y(this,"mainLayout"),Y(this,"isMainWindow"),Y(this,"isDraggingOverWindow"),Y(this,"styleObserver"),Y(this,"popoutWindowName"),Y(this,"updateLayoutMetrics",()=>{if(this.findBorderBarSizeRef.current){const n=this.findBorderBarSizeRef.current.getBoundingClientRect().height;n!==this.state.calculatedBorderBarSize&&this.setState({calculatedBorderBarSize:n})}}),Y(this,"onModelChange",n=>{this.redrawInternal("model change"),this.props.onModelChange&&this.props.onModelChange(this.props.model,n)}),Y(this,"updateRect",()=>{if(this.selfRef.current){const n=Ee.fromDomRect(this.selfRef.current.getBoundingClientRect());!n.equals(this.state.rect)&&n.width!==0&&n.height!==0&&(this.setState({rect:n}),this.windowId!==qs.MAIN_WINDOW_ID&&this.redrawInternal("rect updated"))}}),Y(this,"getClassName",n=>this.props.classNameMapper===void 0?n:this.props.classNameMapper(n)),Y(this,"onCloseWindow",n=>{this.doAction(Ae.closeWindow(n.windowId))}),Y(this,"onSetWindow",(n,s)=>{}),Y(this,"showControlInPortal",(n,s)=>{const i=Br.createPortal(n,s);this.setState({portal:i})}),Y(this,"hideControlInPortal",()=>{this.setState({portal:void 0})}),Y(this,"getIcons",()=>this.icons),Y(this,"setDragNode",(n,s)=>{if(Es.dragState=new e0(this.mainLayout,"internal",s,void 0,void 0),n.dataTransfer.setData("text/plain","--flexlayout--"),n.dataTransfer.effectAllowed="copyMove",n.dataTransfer.dropEffect="move",this.dragEnterCount=0,s instanceof dt){let i=!1,r=this.i18nName(Kn.Move_Tabset);if(s.getChildren().length>0&&(r=this.i18nName(Kn.Move_Tabs).replace("?",String(s.getChildren().length))),this.props.onRenderDragRect){const o=this.props.onRenderDragRect(r,s,void 0);o&&(this.setDragComponent(n,o,10,10),i=!0)}i||this.setDragComponent(n,r,10,10)}else{const r=n.target.getBoundingClientRect(),o=n.clientX-r.left,l=n.clientY-r.top,c=s==null?void 0:s.getParent(),d=c instanceof ds&&c.getOrientation()===Me.HORZ,u=d?10:o,h=d?10:l;let p=!1;if(this.props.onRenderDragRect){const f=a.jsx(ax,{layout:this,node:s},s.getId()),g=this.props.onRenderDragRect(f,s,void 0);g&&(this.setDragComponent(n,g,u,h),p=!0)}p||(CTe()?this.setDragComponent(n,a.jsx(ax,{node:s,layout:this}),u,h):n.dataTransfer.setDragImage(s.getTabStamp(),u,h))}}),Y(this,"onDragEnterRaw",n=>{this.dragEnterCount++,this.dragEnterCount===1&&this.onDragEnter(n)}),Y(this,"onDragLeaveRaw",n=>{this.dragEnterCount--,this.dragEnterCount===0&&this.onDragLeave(n)}),Y(this,"onDragEnter",n=>{if(!Es.dragState&&this.props.onExternalDrag){const s=this.props.onExternalDrag(n);if(s){const i=Ct.fromJson(s.json,this.props.model,!1);Es.dragState=new e0(this.mainLayout,"external",i,s.json,s.onDrop)}}if(Es.dragState){if(this.windowId!==qs.MAIN_WINDOW_ID&&Es.dragState.mainLayout===this.mainLayout&&Es.dragState.mainLayout.setDraggingOverWindow(!0),Es.dragState.mainLayout!==this.mainLayout)return;n.preventDefault(),this.dropInfo=void 0;const s=this.selfRef.current;this.outlineDiv=this.currentDocument.createElement("div"),this.outlineDiv.className=this.getClassName(J.FLEXLAYOUT__OUTLINE_RECT),this.outlineDiv.style.visibility="hidden";const i=this.props.model.getAttribute("tabDragSpeed");this.outlineDiv.style.transition=`top ${i}s, left ${i}s, width ${i}s, height ${i}s`,s.appendChild(this.outlineDiv),this.dragging=!0,this.showOverlay(!0),!this.isDraggingOverWindow&&this.props.model.getMaximizedTabset(this.windowId)===void 0&&this.setState({showEdges:this.props.model.isEnableEdgeDock()});const r=this.selfRef.current.getBoundingClientRect();new Ee(n.clientX-r.left,n.clientY-r.top,1,1).positionElement(this.outlineDiv)}}),Y(this,"onDragOver",n=>{var s;if(this.dragging&&!this.isDraggingOverWindow){n.preventDefault();const i=(s=this.selfRef.current)==null?void 0:s.getBoundingClientRect(),r={x:n.clientX-((i==null?void 0:i.left)??0),y:n.clientY-((i==null?void 0:i.top)??0)};this.checkForBorderToShow(r.x,r.y);const o=this.props.model.findDropTargetNode(this.windowId,Es.dragState.dragNode,r.x,r.y);o&&(this.dropInfo=o,this.outlineDiv&&(this.outlineDiv.className=this.getClassName(o.className),o.rect.positionElement(this.outlineDiv),this.outlineDiv.style.visibility="visible"))}}),Y(this,"onDragLeave",n=>{this.dragging&&(this.windowId!==qs.MAIN_WINDOW_ID&&Es.dragState.mainLayout.setDraggingOverWindow(!1),this.clearDragLocal())}),Y(this,"onDrop",n=>{if(this.dragging){n.preventDefault();const s=Es.dragState;if(this.dropInfo)if(s.dragJson!==void 0){const i=this.doAction(Ae.addNode(s.dragJson,this.dropInfo.node.getId(),this.dropInfo.location,this.dropInfo.index));s.fnNewNodeDropped!==void 0&&s.fnNewNodeDropped(i,n)}else s.dragNode!==void 0&&this.doAction(Ae.moveNode(s.dragNode.getId(),this.dropInfo.node.getId(),this.dropInfo.location,this.dropInfo.index));this.mainLayout.clearDragMain()}this.dragEnterCount=0}),this.orderedTabIds=[],this.orderedTabMoveableIds=[],this.selfRef=S.createRef(),this.moveablesRef=S.createRef(),this.mainRef=S.createRef(),this.findBorderBarSizeRef=S.createRef(),this.supportsPopout=e.supportsPopout!==void 0?e.supportsPopout:qTe,this.popoutURL=e.popoutURL?e.popoutURL:"popout.html",this.icons={...XTe,...e.icons},this.windowId=e.windowId?e.windowId:qs.MAIN_WINDOW_ID,this.mainLayout=this.props.mainLayout?this.props.mainLayout:this,this.isDraggingOverWindow=!1,this.layoutWindow=this.props.model.getwindowsMap().get(this.windowId),this.layoutWindow.layout=this,this.popoutWindowName=this.props.popoutWindowName||"Popout Window",this.state={rect:Ee.empty(),editingTab:void 0,showEdges:!1,showOverlay:!1,calculatedBorderBarSize:29,layoutRevision:0,forceRevision:0,showHiddenBorder:ce.CENTER},this.isMainWindow=this.windowId===qs.MAIN_WINDOW_ID}componentDidMount(){if(this.updateRect(),this.currentDocument=this.selfRef.current.ownerDocument,this.currentWindow=this.currentDocument.defaultView,this.layoutWindow.window=this.currentWindow,this.layoutWindow.toScreenRectFunction=e=>this.getScreenRect(e),this.resizeObserver=new ResizeObserver(e=>{requestAnimationFrame(()=>{this.updateRect()})}),this.selfRef.current&&this.resizeObserver.observe(this.selfRef.current),this.isMainWindow)this.props.model.addChangeListener(this.onModelChange),this.updateLayoutMetrics();else{this.currentWindow.addEventListener("resize",()=>{this.updateRect()});const e=this.props.mainLayout.getRootDiv(),n=this.selfRef.current;kM(e,n),this.styleObserver=new MutationObserver(()=>{kM(e,n)&&this.redraw("mutation observer")}),this.styleObserver.observe(e,{attributeFilter:["style"]})}document.addEventListener("visibilitychange",()=>{for(const[e,n]of this.props.model.getwindowsMap())n.layout&&this.redraw("visibility change")})}componentDidUpdate(){this.currentDocument=this.selfRef.current.ownerDocument,this.currentWindow=this.currentDocument.defaultView,this.isMainWindow&&(this.props.model!==this.previousModel&&(this.previousModel!==void 0&&this.previousModel.removeChangeListener(this.onModelChange),this.props.model.getwindowsMap().get(this.windowId).layout=this,this.props.model.addChangeListener(this.onModelChange),this.layoutWindow=this.props.model.getwindowsMap().get(this.windowId),this.layoutWindow.layout=this,this.layoutWindow.toScreenRectFunction=e=>this.getScreenRect(e),this.previousModel=this.props.model,this.tidyMoveablesMap()),this.updateLayoutMetrics())}componentWillUnmount(){var e,n;this.selfRef.current&&((e=this.resizeObserver)==null||e.unobserve(this.selfRef.current)),this.isMainWindow&&this.props.model.removeChangeListener(this.onModelChange),(n=this.styleObserver)==null||n.disconnect()}render(){if(!this.selfRef.current)return a.jsxs("div",{ref:this.selfRef,className:this.getClassName(J.FLEXLAYOUT__LAYOUT),children:[a.jsx("div",{ref:this.moveablesRef,className:this.getClassName(J.FLEXLAYOUT__LAYOUT_MOVEABLES)},"__moveables__"),this.renderMetricsElements()]});const e=this.props.model;e.getRoot(this.windowId).calcMinMaxSize(),e.getRoot(this.windowId).setPaths(""),e.getBorderSet().setPaths();const n=this.renderLayout(),s=this.renderBorders(n),i=this.renderTabs(),r=this.reorderComponents(i,this.orderedTabIds);let o=null,l=null,c=null,d=null;if(this.isMainWindow){o=this.renderWindows(),d=this.renderMetricsElements();const u=this.renderTabMoveables();l=this.reorderComponents(u,this.orderedTabMoveableIds),c=a.jsx("div",{className:this.getClassName(J.FLEXLAYOUT__LAYOUT_TAB_STAMPS),children:this.renderTabStamps()},"__tabStamps__")}return a.jsxs("div",{ref:this.selfRef,className:this.getClassName(J.FLEXLAYOUT__LAYOUT),onDragEnter:this.onDragEnterRaw,onDragLeave:this.onDragLeaveRaw,onDragOver:this.onDragOver,onDrop:this.onDrop,children:[a.jsx("div",{ref:this.moveablesRef,className:this.getClassName(J.FLEXLAYOUT__LAYOUT_MOVEABLES)},"__moveables__"),d,a.jsx(UTe,{layout:this,show:this.state.showOverlay},"__overlay__"),s,r,l,c,this.state.portal,o]})}renderBorders(e){const n=this.getClassName(J.FLEXLAYOUT__LAYOUT_MAIN),s=this.props.model.getBorderSet().getBorderMap();if(this.isMainWindow&&s.size>0){e=a.jsx("div",{className:n,ref:this.mainRef,children:e});const i=new Map,r=new Map;for(const[c,d]of ce.values){const u=s.get(d);u&&u.isShowing()&&(!u.isAutoHide()||u.isAutoHide()&&(u.getChildren().length>0||this.state.showHiddenBorder===d))&&(i.set(d,a.jsx(kTe,{layout:this,border:u,size:this.state.calculatedBorderBarSize})),r.set(d,a.jsx(ETe,{layout:this,border:u,show:u.getSelected()!==-1})))}const o=this.getClassName(J.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER),l=this.getClassName(J.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER_INNER);if(this.props.model.getBorderSet().getLayoutHorizontal()){const c=a.jsxs("div",{className:l,style:{flexDirection:"column"},children:[r.get(ce.TOP),a.jsxs("div",{className:l,style:{flexDirection:"row"},children:[r.get(ce.LEFT),e,r.get(ce.RIGHT)]}),r.get(ce.BOTTOM)]});return a.jsxs("div",{className:o,style:{flexDirection:"column"},children:[i.get(ce.TOP),a.jsxs("div",{className:l,style:{flexDirection:"row"},children:[i.get(ce.LEFT),c,i.get(ce.RIGHT)]}),i.get(ce.BOTTOM)]})}else{const c=a.jsxs("div",{className:l,style:{flexDirection:"row"},children:[r.get(ce.LEFT),a.jsxs("div",{className:l,style:{flexDirection:"column"},children:[r.get(ce.TOP),e,r.get(ce.BOTTOM)]}),r.get(ce.RIGHT)]});return a.jsxs("div",{className:o,style:{flexDirection:"row"},children:[i.get(ce.LEFT),a.jsxs("div",{className:l,style:{flexDirection:"column"},children:[i.get(ce.TOP),c,i.get(ce.BOTTOM)]}),i.get(ce.RIGHT)]})}}else return a.jsx("div",{className:n,ref:this.mainRef,style:{position:"absolute",top:0,left:0,bottom:0,right:0,display:"flex"},children:e})}renderLayout(){return a.jsxs(a.Fragment,{children:[a.jsx(y8,{layout:this,node:this.props.model.getRoot(this.windowId)},"__row__"),this.renderEdgeIndicators()]})}renderEdgeIndicators(){const e=[],n=this.icons.edgeArrow;if(this.state.showEdges){const s=this.props.model.getRoot(this.windowId).getRect(),i=Qw,r=NM,o=Qw/2,l=this.getClassName(J.FLEXLAYOUT__EDGE_RECT),c=50;e.push(a.jsx("div",{style:{top:0,left:s.width/2-o,width:i,height:r,borderBottomLeftRadius:c,borderBottomRightRadius:c},className:l+" "+this.getClassName(J.FLEXLAYOUT__EDGE_RECT_TOP),children:a.jsx("div",{style:{transform:"rotate(180deg)"},children:n})},"North")),e.push(a.jsx("div",{style:{top:s.height/2-o,left:0,width:r,height:i,borderTopRightRadius:c,borderBottomRightRadius:c},className:l+" "+this.getClassName(J.FLEXLAYOUT__EDGE_RECT_LEFT),children:a.jsx("div",{style:{transform:"rotate(90deg)"},children:n})},"West")),e.push(a.jsx("div",{style:{top:s.height-r,left:s.width/2-o,width:i,height:r,borderTopLeftRadius:c,borderTopRightRadius:c},className:l+" "+this.getClassName(J.FLEXLAYOUT__EDGE_RECT_BOTTOM),children:a.jsx("div",{children:n})},"South")),e.push(a.jsx("div",{style:{top:s.height/2-o,left:s.width-r,width:r,height:i,borderTopLeftRadius:c,borderBottomLeftRadius:c},className:l+" "+this.getClassName(J.FLEXLAYOUT__EDGE_RECT_RIGHT),children:a.jsx("div",{style:{transform:"rotate(-90deg)"},children:n})},"East"))}return e}renderWindows(){const e=[];if(this.supportsPopout){const n=this.props.model.getwindowsMap();let s=1;for(const[i,r]of n)i!==qs.MAIN_WINDOW_ID&&(e.push(a.jsx(NTe,{layout:this,title:this.popoutWindowName+" "+s,layoutWindow:r,url:this.popoutURL+"?id="+i,onSetWindow:this.onSetWindow,onCloseWindow:this.onCloseWindow,children:a.jsx("div",{className:this.props.popoutClassName,children:a.jsx(Es,{...this.props,windowId:i,mainLayout:this})})},i)),s++)}return e}renderTabMoveables(){const e=new Map;return this.props.model.visitNodes(n=>{if(n instanceof Ct){const s=n,i=this.getMoveableElement(s.getId());s.setMoveableElement(i);const r=s.isSelected(),o=s.getParent().getContentRect(),l=r||!s.isEnableRenderOnDemand(),c=s.isRendered()||l&&o.width>0&&o.height>0;if(c){const d=s.getId()+(s.isEnableWindowReMount()?s.getWindowId():"");e.set(n.getId(),Br.createPortal(a.jsx(GTe,{layout:this,node:s,rect:o,visible:l,forceRevision:this.state.forceRevision,tabsRevision:this.props.renderRevision},d),i,d)),s.setRendered(c)}}}),e}renderTabStamps(){const e=[];return this.props.model.visitNodes(n=>{if(n instanceof Ct){const s=n;e.push(a.jsx(jTe,{layout:this,node:s},s.getId()))}}),e}renderTabs(){const e=new Map;return this.props.model.visitWindowNodes(this.windowId,n=>{if(n instanceof Ct){const s=n,i=s.isSelected(),r=s.getPath();(s.isRendered()||i||!s.isEnableRenderOnDemand())&&e.set(s.getId(),a.jsx(WTe,{layout:this,path:r,node:s,selected:i},s.getId()))}}),e}renderMetricsElements(){return a.jsx("div",{ref:this.findBorderBarSizeRef,className:this.getClassName(J.FLEXLAYOUT__BORDER_SIZER),children:"FindBorderBarSize"},"findBorderBarSize")}checkForBorderToShow(e,n){const s=this.getBoundingClientRect(this.mainRef.current),i=s.getCenter(),r=NM,o=Qw/2;let l=!1;this.props.model.isEnableEdgeDock()&&this.state.showHiddenBorder===ce.CENTER&&(n>i.y-o&&n<i.y+o||e>i.x-o&&e<i.x+o)&&(l=!0);let c=ce.CENTER;l||(e<=s.x+r?c=ce.LEFT:e>=s.getRight()-r?c=ce.RIGHT:n<=s.y+r?c=ce.TOP:n>=s.getBottom()-r&&(c=ce.BOTTOM)),c!==this.state.showHiddenBorder&&this.setState({showHiddenBorder:c})}tidyMoveablesMap(){const e=new Map;this.props.model.visitNodes((n,s)=>{n instanceof Ct&&e.set(n.getId(),n)});for(const[n,s]of this.moveableElementMap)e.has(n)||(s.remove(),this.moveableElementMap.delete(n))}reorderComponents(e,n){const s=[],i=new Set;let r=[];for(const o of n)e.get(o)&&(s.push(o),i.add(o));n.splice(0,n.length,...s);for(const[o,l]of e)i.has(o)||n.push(o);return r=n.map(o=>e.get(o)),r}redraw(e){this.mainLayout.setState((n,s)=>({forceRevision:n.forceRevision+1}))}redrawInternal(e){this.mainLayout.setState((n,s)=>({layoutRevision:n.layoutRevision+1}))}doAction(e){if(this.props.onAction!==void 0){const n=this.props.onAction(e);return n!==void 0?this.props.model.doAction(n):void 0}else return this.props.model.doAction(e)}getBoundingClientRect(e){const n=this.getDomRect();return n?Ee.getBoundingClientRect(e).relativeTo(n):Ee.empty()}getMoveableContainer(){return this.moveablesRef.current}getMoveableElement(e){let n=this.moveableElementMap.get(e);return n===void 0&&(n=document.createElement("div"),this.moveablesRef.current.appendChild(n),n.className=J.FLEXLAYOUT__TAB_MOVEABLE,this.moveableElementMap.set(e,n)),n}getMainLayout(){return this.mainLayout}getCurrentDocument(){return this.currentDocument}getDomRect(){return this.selfRef.current?Ee.fromDomRect(this.selfRef.current.getBoundingClientRect()):Ee.empty()}getWindowId(){return this.windowId}getRootDiv(){return this.selfRef.current}getMainElement(){return this.mainRef.current}getFactory(){return this.props.factory}isSupportsPopout(){return this.supportsPopout}isRealtimeResize(){return this.props.realtimeResize??!1}getPopoutURL(){return this.popoutURL}setEditingTab(e){this.setState({editingTab:e})}getEditingTab(){return this.state.editingTab}getModel(){return this.props.model}getScreenRect(e){const n=e.clone(),s=this.getDomRect(),i=60,r=2;return n.x=this.currentWindow.screenX+this.currentWindow.scrollX+r/2+s.x+n.x,n.y=this.currentWindow.screenY+this.currentWindow.scrollY+(i-r/2)+s.y+n.y,n.height+=i,n.width+=r,n}addTabToTabSet(e,n){if(this.props.model.getNodeById(e)!==void 0)return this.doAction(Ae.addNode(n,e,ce.CENTER,-1))}addTabToActiveTabSet(e){const n=this.props.model.getActiveTabset(this.windowId);if(n!==void 0)return this.doAction(Ae.addNode(e,n.getId(),ce.CENTER,-1))}maximize(e){this.doAction(Ae.maximizeToggle(e.getId(),this.getWindowId()))}customizeTab(e,n){this.props.onRenderTab&&this.props.onRenderTab(e,n)}customizeTabSet(e,n){this.props.onRenderTabSet&&this.props.onRenderTabSet(e,n)}i18nName(e,n){let s;return this.props.i18nMapper&&(s=this.props.i18nMapper(e,n)),s===void 0&&(s=e+(n===void 0?"":n)),s}getShowOverflowMenu(){return this.props.onShowOverflowMenu}getTabSetPlaceHolderCallback(){return this.props.onTabSetPlaceHolder}showContextMenu(e,n){this.props.onContextMenu&&this.props.onContextMenu(e,n)}auxMouseClick(e,n){this.props.onAuxMouseClick&&this.props.onAuxMouseClick(e,n)}showOverlay(e){this.setState({showOverlay:e}),eE(!e,this.currentDocument)}addTabWithDragAndDrop(e,n,s){const i=Ct.fromJson(n,this.props.model,!1);Es.dragState=new e0(this.mainLayout,"add",i,n,s)}moveTabWithDragAndDrop(e,n){this.setDragNode(e,n)}setDragComponent(e,n,s,i){const r=a.jsx("div",{style:{position:"unset"},className:this.getClassName(J.FLEXLAYOUT__LAYOUT)+" "+this.getClassName(J.FLEXLAYOUT__DRAG_RECT),children:n}),o=this.currentDocument.createElement("div");o.setAttribute("data-layout-path","/drag-rectangle"),o.style.position="absolute",o.style.left="-10000px",o.style.top="-10000px",this.currentDocument.body.appendChild(o),ZE(o).render(r),e.dataTransfer.setDragImage(o,s,i),setTimeout(()=>{this.currentDocument.body.removeChild(o)},0)}setDraggingOverWindow(e){this.isDraggingOverWindow!==e&&(this.outlineDiv&&(this.outlineDiv.style.visibility=e?"hidden":"visible"),e?this.setState({showEdges:!1}):this.props.model.getMaximizedTabset(this.windowId)===void 0&&this.setState({showEdges:this.props.model.isEnableEdgeDock()}),this.isDraggingOverWindow=e)}clearDragMain(){Es.dragState=void 0,this.windowId===qs.MAIN_WINDOW_ID&&(this.isDraggingOverWindow=!1);for(const[,e]of this.props.model.getwindowsMap())e.layout.clearDragLocal()}clearDragLocal(){this.setState({showEdges:!1}),this.showOverlay(!1),this.dragEnterCount=0,this.dragging=!1,this.outlineDiv&&(this.selfRef.current.removeChild(this.outlineDiv),this.outlineDiv=void 0)}};Y(v8,"dragState");let YTe=v8;const XTe={close:a.jsx(jM,{}),closeTabset:a.jsx(jM,{}),popout:a.jsx(LTe,{}),maximize:a.jsx(MTe,{}),restore:a.jsx(FTe,{}),more:a.jsx(OTe,{}),edgeArrow:a.jsx(DTe,{}),activeTabset:a.jsx(BTe,{})},qTe=u8(),Qw=100,NM=10;class e0{constructor(e,n,s,i,r){Y(this,"mainLayout"),Y(this,"dragSource"),Y(this,"dragNode"),Y(this,"dragJson"),Y(this,"fnNewNodeDropped"),this.mainLayout=e,this.dragSource=n,this.dragNode=s,this.dragJson=i,this.fnNewNodeDropped=r}}const ZTe={global:{tabEnableFloat:!0,tabSetEnableMaximize:!0,tabSetEnableDrag:!0,tabSetMinWidth:200,tabSetMinHeight:150,borderBarSize:30},borders:[],layout:{type:"row",weight:100,children:[{type:"tabset",id:"main",weight:100,children:[{type:"tab",id:"canvas",name:"CANVAS",component:"canvas",enableClose:!1}]}]}},JTe={"google-drive":{icon:"",name:"Google Drive",url:"https://drive.google.com/embeddedfolderview?id=root#grid"},canva:{icon:"",name:"Canva",url:"https://www.canva.com/"},"founder-dashboard":{icon:"",name:"Founder Dashboard",component:"founder-dashboard"},"pat-council":{icon:"",name:"PAT Council",component:"pat-council"},devtools:{icon:"",name:"DevTools",component:"devtools"},settings:{icon:"",name:"Settings",component:"settings"},store:{icon:"",name:"Store",component:"store"},catalog:{icon:"",name:"Catlogo",component:"catalog"},"mining-panel":{icon:"",name:"Meu Mining",component:"mining-panel"},"defend-panel":{icon:"",name:"Panda Defend",component:"defend-panel"}};function QTe({canvasComponent:t,componentFactory:e,onModelChange:n}){const s=S.useRef(qs.fromJson(ZTe)),i=S.useRef(null),r=S.useCallback(c=>{const d=c.getComponent(),u=c.getConfig()||{};return d==="canvas"?t||a.jsx("div",{children:"Canvas Loading..."}):d==="iframe"?a.jsx("iframe",{src:u.url,style:{width:"100%",height:"100%",border:"none",background:"#0a0a1a"},title:c.getName(),sandbox:"allow-scripts allow-same-origin allow-popups allow-forms"}):e?e(d,u,c):a.jsxs("div",{style:{padding:16},children:["Unknown: ",d]})},[t,e]),o=S.useCallback((c,d={})=>{const u=s.current;if(!u)return;if(u.getNodeById(c)){u.doAction(Ae.selectTab(c));return}const p=JTe[c]||{},f=!!p.url||!!d.url,g={type:"tab",id:c,name:`${(p.name||d.name||c).toUpperCase()}`,component:f?"iframe":p.component||c,config:{...d,url:p.url||d.url,appId:c}},y=u.getActiveTabset()||u.getNodeById("main");y&&u.doAction(Ae.addNode(g,y.getId(),ce.CENTER,-1))},[]),l=S.useCallback(c=>{const d=s.current;if(!d)return;d.getNodeById(c)&&d.doAction(Ae.deleteTab(c))},[]);return Oe.useEffect(()=>(window.__pfWindowManager={openApp:o,closeApp:l},()=>{delete window.__pfWindowManager}),[o,l]),a.jsx(KTe,{ref:i,model:s.current,factory:r,onModelChange:n,font:{size:"13px"}})}function gi(t,e){var n;(n=window.__pfWindowManager)==null||n.openApp(t,e)}function dm(t){var e;(e=window.__pfWindowManager)==null||e.closeApp(t)}function e1e({availablePlugins:t=[],onClose:e,onCreate:n}){var v;const[s,i]=S.useState(""),[r,o]=S.useState(""),[l,c]=S.useState([]),[d,u]=S.useState(0),[h,p]=S.useState("landing"),f=[{id:"landing",name:"Landing Page",icon:""},{id:"kiwify",name:"Kiwify",icon:""},{id:"hotmart",name:"Hotmart",icon:""},{id:"steam",name:"Steam",icon:""},{id:"appstore",name:"App Store",icon:""},{id:"playstore",name:"Play Store",icon:""},{id:"api",name:"API Hook",icon:""}],g=t.length>0?t:[{id:"crm",name:"Panda CRM",icon:"",category:"core"},{id:"trading",name:"Trading Hub",icon:"",category:"core"},{id:"brain",name:"Panda Brain",icon:"",category:"core"},{id:"social",name:"Social Manager",icon:"",category:"addon"},{id:"analytics",name:"Analytics Pro",icon:"",category:"addon"},{id:"automation",name:"Automation Suite",icon:"",category:"addon"}],y=w=>{c(_=>_.includes(w)?_.filter(C=>C!==w):[..._,w])},x=()=>{if(!s.trim()){alert("Nome do bundle  obrigatrio");return}if(l.length===0){alert("Selecione pelo menos um plugin");return}const w={id:`bundle-${Date.now()}`,name:s,description:r,plugins:l,priceUSD:d,hookPlatform:h,createdAt:new Date().toISOString()};console.log(" Bundle created:",w),n&&n(w),e()},m=l.length*256;return a.jsx("div",{className:"bundle-overlay",onClick:e,children:a.jsxs("div",{className:"bundle-creator",onClick:w=>w.stopPropagation(),children:[a.jsxs("header",{className:"bundle-header",children:[a.jsx("h2",{children:" Bundle Creator"}),a.jsx("button",{className:"btn-close",onClick:e,children:""})]}),a.jsxs("div",{className:"bundle-content",children:[a.jsxs("section",{className:"bundle-section",children:[a.jsx("h3",{children:" Informaes do Bundle"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Nome do Bundle *"}),a.jsx("input",{type:"text",value:s,onChange:w=>i(w.target.value),placeholder:"Meu Bundle Incrvel"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Descrio"}),a.jsx("textarea",{value:r,onChange:w=>o(w.target.value),placeholder:"O que esse bundle faz?",rows:2})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Preo (USD)"}),a.jsx("input",{type:"number",value:d,onChange:w=>u(parseFloat(w.target.value)||0),min:0,step:.01})]})]}),a.jsxs("section",{className:"bundle-section",children:[a.jsx("h3",{children:" Selecionar Plugins"}),a.jsx("p",{className:"section-hint",children:"Escolha os plugins que faro parte do bundle"}),a.jsx("div",{className:"plugins-grid",children:g.map(w=>a.jsxs("div",{className:`plugin-card ${l.includes(w.id)?"selected":""}`,onClick:()=>y(w.id),children:[a.jsx("span",{className:"plugin-icon",children:w.icon}),a.jsx("span",{className:"plugin-name",children:w.name}),a.jsx("span",{className:`plugin-category ${w.category}`,children:w.category}),l.includes(w.id)&&a.jsx("span",{className:"plugin-check",children:""})]},w.id))})]}),a.jsxs("section",{className:"bundle-section",children:[a.jsx("h3",{children:" Plataforma de Distribuio"}),a.jsx("p",{className:"section-hint",children:"Escolha onde o bundle ser vendido"}),a.jsx("div",{className:"platforms-grid",children:f.map(w=>a.jsxs("button",{className:`platform-btn ${h===w.id?"selected":""}`,onClick:()=>p(w.id),children:[a.jsx("span",{className:"platform-icon",children:w.icon}),a.jsx("span",{className:"platform-name",children:w.name})]},w.id))})]}),a.jsxs("section",{className:"bundle-summary",children:[a.jsx("h3",{children:" Resumo"}),a.jsxs("div",{className:"summary-grid",children:[a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"Plugins"}),a.jsx("span",{className:"summary-value",children:l.length})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"Tamanho Est."}),a.jsxs("span",{className:"summary-value",children:[m," KB"]})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"Preo"}),a.jsxs("span",{className:"summary-value",children:["$",d.toFixed(2)]})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"Plataforma"}),a.jsx("span",{className:"summary-value",children:(v=f.find(w=>w.id===h))==null?void 0:v.name})]})]})]})]}),a.jsxs("footer",{className:"bundle-footer",children:[a.jsx("button",{className:"btn-cancel",onClick:e,children:"Cancelar"}),a.jsx("button",{className:"btn-create",onClick:x,children:" Criar Bundle"})]})]})})}const ga=6e6,t1e=6e4,nE={"Drive.read":1,"Drive.write":2,"Sheets.read":1,"Sheets.write":2,"Brain.chat":5,"Brain.vision":8,"Social.send":3,"Webhook.trigger":2,"Store.checkout":4,"Auth.verify":1};function AM(){const t=Object.keys(nE),e=[],n=Date.now();for(let s=0;s<50;s++){const i=t[Math.floor(Math.random()*t.length)];e.push({id:`exec-${s}`,operation:i,cost:nE[i],timestamp:new Date(n-s*6e4*(Math.random()*30+1)).toISOString(),status:Math.random()>.05?"success":"error"})}return e.sort((s,i)=>new Date(i.timestamp)-new Date(s.timestamp))}function n1e(){const t=Math.floor(Math.random()*15e4)+5e3;return{daily:ga,used:t,remaining:ga-t,percentage:t/ga*100}}function s1e(){const[t,e]=S.useState({daily:ga,used:0,remaining:ga,percentage:0}),[n,s]=S.useState([]),[i,r]=S.useState([]),[o,l]=S.useState(!0),[c,d]=S.useState([]),[u,h]=S.useState("loading"),p=S.useRef(null),f=S.useCallback((x,m)=>{const v={};x.forEach(I=>{v[I.operation]||(v[I.operation]={operation:I.operation,totalCost:0,count:0}),v[I.operation].totalCost+=I.cost,v[I.operation].count+=1});const w=Object.values(v).sort((I,T)=>T.totalCost-I.totalCost);r(w.slice(0,5));const _=m.percentage,C=[];_>80?C.push({type:"critical",message:" GAS quota above 80%  consider batching operations"}):_>50&&C.push({type:"warning",message:" GAS usage moderate  monitor heavy operations"}),d(C)},[]),g=S.useCallback(async(x=!1)=>{x||l(!0);try{const w=await _Ee.getStats();if(w&&w.used!==void 0){const _={daily:w.daily||ga,used:w.used,remaining:(w.daily||ga)-w.used,percentage:w.used/(w.daily||ga)*100};e(_);const C=w.log||AM();s(C),f(C,_),h("real"),l(!1);return}}catch{}const m=n1e();e(m);const v=AM();s(v),f(v,m),h("mock"),l(!1)},[f]);S.useEffect(()=>(g(),p.current=setInterval(()=>{g(!0)},t1e),()=>{p.current&&clearInterval(p.current)}),[g]);const y=S.useCallback(()=>g(!1),[g]);return{quota:t,executionLog:n,topOperations:i,alerts:c,isLoading:o,mode:u,refresh:y,operationCosts:nE}}function RM({onClose:t}){const{quota:e,executionLog:n,topOperations:s,alerts:i,isLoading:r,mode:o,refresh:l}=s1e(),[c,d]=S.useState("overview"),u=g=>g>=1e6?`${(g/1e6).toFixed(1)}M`:g>=1e3?`${(g/1e3).toFixed(1)}K`:g.toString(),h=g=>g>80?"#ff4444":g>50?"#ffaa00":"#4cc9f0",p=g=>new Date(g).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),f=[" Batch Drive.write operations to reduce quota usage by ~40%"," Cache Sheets.read results with 5-minute TTL  saves ~200 calls/hour"," Use incremental sync instead of full Drive scans"," Schedule Brain.chat calls during off-peak hours (2AM-6AM UTC)"," Compress payloads before Webhook.trigger to reduce execution time"];return r?a.jsxs("div",{className:"gasometer-panel",children:[a.jsxs("div",{className:"gasometer-header",children:[a.jsx("h3",{children:" Gasmetro"}),a.jsx("button",{className:"gasometer-close",onClick:t,children:""})]}),a.jsxs("div",{className:"gasometer-loading",children:[a.jsx("div",{className:"gasometer-spinner"}),a.jsx("p",{children:"Loading GAS metrics..."})]})]}):a.jsxs("div",{className:"gasometer-panel",children:[a.jsxs("div",{className:"gasometer-header",children:[a.jsxs("div",{className:"gasometer-title",children:[a.jsx("h3",{children:" Gasmetro"}),a.jsx("span",{className:"gasometer-badge",children:"GAS Monitor v2.0"}),a.jsx("span",{className:"gasometer-badge",style:{background:o==="real"?"rgba(16,185,129,0.15)":"rgba(245,158,11,0.15)",color:o==="real"?"#10b981":"#f59e0b"},children:o==="real"?" Live":" Mock"})]}),a.jsxs("div",{className:"gasometer-actions",children:[a.jsx("button",{className:"gasometer-refresh",onClick:l,title:"Refresh",children:""}),a.jsx("button",{className:"gasometer-close",onClick:t,children:""})]})]}),i.length>0&&a.jsx("div",{className:"gasometer-alerts",children:i.map((g,y)=>a.jsx("div",{className:`gasometer-alert gasometer-alert-${g.type}`,children:g.message},y))}),a.jsx("div",{className:"gasometer-tabs",children:["overview","history","optimize"].map(g=>a.jsxs("button",{className:`gasometer-tab ${c===g?"active":""}`,onClick:()=>d(g),children:[g==="overview"&&" Overview",g==="history"&&" History",g==="optimize"&&" AI Tips"]},g))}),a.jsxs("div",{className:"gasometer-content",children:[c==="overview"&&a.jsxs("div",{className:"gasometer-overview",children:[a.jsxs("div",{className:"gasometer-gauge-card",children:[a.jsx("div",{className:"gasometer-gauge-label",children:"Daily Quota Usage"}),a.jsx("div",{className:"gasometer-gauge-bar",children:a.jsx("div",{className:"gasometer-gauge-fill",style:{width:`${Math.min(e.percentage,100)}%`,background:h(e.percentage)}})}),a.jsxs("div",{className:"gasometer-gauge-stats",children:[a.jsxs("span",{children:[u(e.used)," used"]}),a.jsxs("span",{className:"gasometer-gauge-pct",children:[e.percentage.toFixed(2),"%"]}),a.jsxs("span",{children:[u(e.remaining)," remaining"]})]})]}),a.jsxs("div",{className:"gasometer-stats-grid",children:[a.jsxs("div",{className:"gasometer-stat-card",children:[a.jsx("div",{className:"gasometer-stat-icon",children:""}),a.jsx("div",{className:"gasometer-stat-value",children:u(e.used)}),a.jsx("div",{className:"gasometer-stat-label",children:"Executions Today"})]}),a.jsxs("div",{className:"gasometer-stat-card",children:[a.jsx("div",{className:"gasometer-stat-icon",children:""}),a.jsx("div",{className:"gasometer-stat-value",children:u(e.remaining)}),a.jsx("div",{className:"gasometer-stat-label",children:"Remaining"})]}),a.jsxs("div",{className:"gasometer-stat-card",children:[a.jsx("div",{className:"gasometer-stat-icon",children:""}),a.jsx("div",{className:"gasometer-stat-value",children:n.filter(g=>g.status==="success").length}),a.jsx("div",{className:"gasometer-stat-label",children:"Success Rate"})]}),a.jsxs("div",{className:"gasometer-stat-card",children:[a.jsx("div",{className:"gasometer-stat-icon",children:""}),a.jsx("div",{className:"gasometer-stat-value",children:n.filter(g=>g.status==="error").length}),a.jsx("div",{className:"gasometer-stat-label",children:"Errors"})]})]}),a.jsxs("div",{className:"gasometer-top-ops",children:[a.jsx("h4",{children:" Top Operations by Cost"}),a.jsx("div",{className:"gasometer-ops-list",children:s.map((g,y)=>a.jsxs("div",{className:"gasometer-op-row",children:[a.jsxs("span",{className:"gasometer-op-rank",children:["#",y+1]}),a.jsx("span",{className:"gasometer-op-name",children:g.operation}),a.jsxs("span",{className:"gasometer-op-count",children:[g.count,""]}),a.jsxs("span",{className:"gasometer-op-cost",children:[g.totalCost," exec"]}),a.jsx("div",{className:"gasometer-op-bar",children:a.jsx("div",{className:"gasometer-op-bar-fill",style:{width:`${g.totalCost/s[0].totalCost*100}%`}})})]},y))})]})]}),c==="history"&&a.jsxs("div",{className:"gasometer-history",children:[a.jsxs("div",{className:"gasometer-history-header",children:[a.jsx("span",{children:"Last 50 Operations"}),a.jsxs("span",{className:"gasometer-history-count",children:[n.length," entries"]})]}),a.jsx("div",{className:"gasometer-history-list",children:n.map(g=>a.jsxs("div",{className:`gasometer-history-row ${g.status}`,children:[a.jsx("span",{className:"gasometer-history-status",children:g.status==="success"?"":""}),a.jsx("span",{className:"gasometer-history-op",children:g.operation}),a.jsxs("span",{className:"gasometer-history-cost",children:[g.cost," exec"]}),a.jsx("span",{className:"gasometer-history-time",children:p(g.timestamp)})]},g.id))})]}),c==="optimize"&&a.jsxs("div",{className:"gasometer-optimize",children:[a.jsxs("div",{className:"gasometer-ai-header",children:[a.jsx("span",{children:" Gemini Optimization Suggestions"}),a.jsx("span",{className:"gasometer-ai-badge",children:"Powered by Panda Brain"})]}),a.jsx("div",{className:"gasometer-ai-tips",children:f.map((g,y)=>a.jsx("div",{className:"gasometer-ai-tip",children:a.jsx("div",{className:"gasometer-ai-tip-text",children:g})},y))}),a.jsx("div",{className:"gasometer-ai-footer",children:a.jsx("p",{children:"These suggestions are generated based on your usage patterns. Apply them to reduce GAS consumption by up to 60%."})})]})]})]})}const MM=[{date:"13/02",earned:3.2,status:""},{date:"12/02",earned:3.4,status:""},{date:"11/02",earned:2.9,status:""},{date:"10/02",earned:3.1,status:""},{date:"09/02",earned:3.3,status:""},{date:"08/02",earned:0,status:""},{date:"07/02",earned:3,status:""}];function i1e({embedded:t=!1}){const[e,n]=S.useState(!1),[s,i]=S.useState(!1),[r,o]=S.useState(50),[l,c]=S.useState(0);S.useEffect(()=>{if(!e)return;const w=setInterval(()=>{c(_=>_+1)},1e3);return()=>clearInterval(w)},[e]);const d=w=>{const _=Math.floor(w/3600),C=Math.floor(w%3600/60),I=w%60;return`${_}h ${C}m ${I}s`},u=s?r>=75?" Forest":r>=50?" Tree":" Sprout":r>=50?" Sprout":" Seed",h=s?r>=75?"4.2":"2.8":r>=50?"1.1":"0.6",p=s?r>=75?5.2:3.4:r>=50?1.3:.7,f=42.8,g=MM.reduce((w,_)=>w+_.earned,0).toFixed(1),y={padding:t?"24px":"32px",maxWidth:"780px",margin:"0 auto",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",color:"#e0e0e0"},x={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",padding:"16px 20px",marginBottom:"16px"},m={textAlign:"center",padding:"14px",background:"rgba(255,255,255,0.02)",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.06)",flex:1,minWidth:"130px"},v={fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"};return a.jsxs("div",{style:y,children:[a.jsxs("div",{style:{marginBottom:"24px"},children:[a.jsx("h2",{style:{fontSize:"22px",fontWeight:700,margin:0},children:" Meu Mining"}),a.jsx("p",{style:{margin:"6px 0 0",opacity:.6,fontSize:"13px",lineHeight:1.5},children:"Painel pessoal de minerao  acompanhe seus ganhos em Panda Coins"})]}),a.jsx("div",{style:{...x,background:"rgba(102,126,234,0.06)",border:"1px solid rgba(102,126,234,0.2)"},children:a.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"flex-start"},children:[a.jsx("span",{style:{fontSize:"20px"},children:""}),a.jsxs("div",{style:{lineHeight:"1.6",fontSize:"13px"},children:[a.jsx("div",{style:{fontWeight:700,marginBottom:"4px",color:"#667eea"},children:"Como funciona o Partner Mode"}),a.jsxs("div",{style:{opacity:.7,lineHeight:1.6},children:["O Partner Mode utiliza CPU/GPU ociosa do seu computador para minerar criptomoeda via Rust Agent. Voc recebe"," ",a.jsx("strong",{style:{color:"#10b981"},children:"60%"})," do valor convertido em Panda Coins. Minerao "," ",a.jsx("strong",{children:"sempre opt-in e desligada por padro"}),". Desative a qualquer momento."]})]})]})}),a.jsx("div",{style:x,children:a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontWeight:600,fontSize:"15px"},children:e?" Minerando":" Minerao Desligada"}),a.jsx("div",{style:{fontSize:"12px",opacity:.5,marginTop:"4px"},children:e?`${s?"CPU + GPU":"Apenas CPU"}  ${r}% limite`:"Ligue para ganhar PC automaticamente"})]}),a.jsx("button",{onClick:()=>n(!e),style:{padding:"10px 24px",borderRadius:"8px",border:"none",fontWeight:700,fontSize:"13px",cursor:"pointer",background:e?"rgba(239,68,68,0.15)":"rgba(16,185,129,0.15)",color:e?"#ef4444":"#10b981",transition:"all 0.2s"},children:e?" Parar":" Iniciar Mining"})]})}),!e&&a.jsxs("div",{style:{...x,background:"rgba(245,158,11,0.06)",border:"1px solid rgba(245,158,11,0.2)",textAlign:"center",padding:"28px 20px"},children:[a.jsx("div",{style:{fontSize:"36px",marginBottom:"10px"},children:""}),a.jsx("div",{style:{fontWeight:700,fontSize:"16px",color:"#f59e0b"},children:"Ganhe Panda Coins Passivamente"}),a.jsx("div",{style:{fontSize:"13px",opacity:.7,lineHeight:1.6,maxWidth:"420px",margin:"8px auto 0"},children:"Ligue o Partner Mode e ganhe Panda Coins automaticamente enquanto seu computador est ocioso. Sem custos extras, desative quando quiser."})]}),e&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:x,children:[a.jsx("div",{style:v,children:" Stats em Tempo Real"}),a.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[a.jsxs("div",{style:m,children:[a.jsx("div",{style:{fontSize:"22px",fontWeight:700,color:"#10b981"},children:u}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Perfil Hardware"})]}),a.jsxs("div",{style:m,children:[a.jsxs("div",{style:{fontSize:"22px",fontWeight:700,color:"#f59e0b",fontFamily:"monospace"},children:["~",h," KH/s"]}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Hashrate"})]}),a.jsxs("div",{style:m,children:[a.jsx("div",{style:{fontSize:"22px",fontWeight:700,color:"#667eea",fontFamily:"monospace"},children:d(l)}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Uptime Sesso"})]}),a.jsxs("div",{style:m,children:[a.jsxs("div",{style:{fontSize:"22px",fontWeight:700,color:"#f59e0b"},children:["~",p," PC"]}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Estimado/Dia"})]})]})]}),a.jsxs("div",{style:x,children:[a.jsx("div",{style:v,children:" Controle de Recursos"}),a.jsxs("div",{style:{marginBottom:"12px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"13px",marginBottom:"6px"},children:[a.jsx("span",{children:"Limite CPU"}),a.jsxs("span",{style:{fontWeight:700},children:[r,"%"]})]}),a.jsx("input",{type:"range",min:"25",max:"75",step:"5",value:r,onChange:w=>o(Number(w.target.value)),style:{width:"100%",accentColor:"#f59e0b",height:"6px"}}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",opacity:.4,marginTop:"4px"},children:[a.jsx("span",{children:"25% Baixo"}),a.jsx("span",{children:"50% Equilibrado"}),a.jsx("span",{children:"75% Alto"})]})]}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"12px",paddingTop:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontWeight:600,fontSize:"13px"},children:" Minerao GPU"}),a.jsx("div",{style:{fontSize:"11px",opacity:.5},children:"Ativa GPU para ganhos maiores"})]}),a.jsx("button",{onClick:()=>i(!s),style:{padding:"6px 16px",borderRadius:"6px",border:s?"1px solid #10b981":"1px solid rgba(255,255,255,0.15)",background:s?"rgba(16,185,129,0.15)":"transparent",color:s?"#10b981":"#888",fontWeight:600,fontSize:"12px",cursor:"pointer"},children:s?" Ativa":"Desligada"})]})]})]}),a.jsxs("div",{style:x,children:[a.jsx("div",{style:v,children:" Resumo de Ganhos"}),a.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[a.jsxs("div",{style:m,children:[a.jsx("div",{style:{fontSize:"26px",fontWeight:700,color:"#f59e0b"},children:f}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"PC Total Acumulado"})]}),a.jsxs("div",{style:m,children:[a.jsx("div",{style:{fontSize:"26px",fontWeight:700,color:"#10b981"},children:g}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"PC ltima Semana"})]}),a.jsxs("div",{style:m,children:[a.jsxs("div",{style:{fontSize:"26px",fontWeight:700,color:"#667eea"},children:["~",(p*30).toFixed(0)]}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Estimativa Mensal"})]})]})]}),a.jsxs("div",{style:x,children:[a.jsx("div",{style:v,children:" Histrico (ltimos 7 Dias)"}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",textAlign:"left"},children:[a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Data"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"PC Ganho"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Status"})]})}),a.jsx("tbody",{children:MM.map((w,_)=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace"},children:w.date}),a.jsx("td",{style:{padding:"8px 12px",fontWeight:600,color:w.earned>0?"#10b981":"#666"},children:w.earned>0?`+${w.earned} PC`:""}),a.jsx("td",{style:{padding:"8px 12px"},children:w.status})]},_))})]})]}),a.jsxs("div",{style:x,children:[a.jsx("div",{style:v,children:" Distribuio de Receita"}),a.jsxs("div",{style:{display:"flex",height:"24px",borderRadius:"6px",overflow:"hidden",marginBottom:"10px"},children:[a.jsx("div",{style:{width:"60%",background:"#10b981",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:700,color:"#fff"},children:"60% Voc"}),a.jsx("div",{style:{width:"40%",background:"#ef4444",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:700,color:"#fff"},children:"40% Infra"})]}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,lineHeight:1.6},children:"Fator x0.60 flat: 60% convertido em PC para voc. Os 40% restantes cobrem impostos (BR), infraestrutura, hold reserve e treasury."})]}),a.jsx("div",{style:{fontSize:"11px",opacity:.35,marginTop:"8px",textAlign:"center"},children:" Dados simulados  Execuo real requer Rust Agent (binrio nativo). Ciclo de pagamento: End-of-Day (23:59 UTC)."})]})}const r1e=[{id:"@panda/ai-chat",name:"Panda Brain Chat",icon:"",score:98,risk:"low",permissions:["panda.ui.toast","panda.data.read"],lastScan:"2026-02-13 09:00",status:"approved",type:"module"},{id:"@panda/draw-tools",name:"Draw Tools",icon:"",score:95,risk:"low",permissions:["panda.ui.canvas","panda.data.write"],lastScan:"2026-02-13 08:30",status:"approved",type:"module"},{id:"@fulano/steam-library",name:"Steam Library",icon:"",score:82,risk:"medium",permissions:["panda.ui.toast","panda.data.read","panda.store.state"],lastScan:"2026-02-12 22:15",status:"approved",type:"module"},{id:"@dev/whatsapp-bridge",name:"WhatsApp Bridge",icon:"",score:71,risk:"high",permissions:["panda.ui.toast","panda.data.read","panda.data.write","panda.bridge.external"],lastScan:"2026-02-12 18:00",status:"review",type:"tentacle"},{id:"@carlo/epic-hook",name:"Epic Games Hook",icon:"",score:45,risk:"high",permissions:["panda.data.read","panda.data.write","panda.auth.modify","panda.wallet.send"],lastScan:"2026-02-11 14:00",status:"suspended",type:"tentacle"}],rh={"@panda/ai-chat":{bonus:["CSP declarado (+5)","TypeScript completo (+5)","Testes > 50% (+5)","README.md (+5)"],penalty:[]},"@panda/draw-tools":{bonus:["strict mode (+5)","README.md (+5)","Changelog semntico (+5)"],penalty:["Web Workers no declarado (-10)"]},"@fulano/steam-library":{bonus:["README.md (+5)","CSP declarado (+5)"],penalty:["fetch() externo no declarado (-10)","IndexedDB > 50MB (-10)"]},"@dev/whatsapp-bridge":{bonus:["strict mode (+5)"],penalty:["fetch() externo no declarado (-10)","WebRTC no declarado (-10)","Notification API (-10)"]},"@carlo/epic-hook":{bonus:[],penalty:["eval() dinmico (Score=0)","Obfuscao detectada (-)","fetch() no declarado (-10)"]}},o1e=[{id:"R1",rule:"Dynamic eval",risk:"RCE"},{id:"R2",rule:"document.write",risk:"XSS"},{id:"R3",rule:"Unsafe innerHTML",risk:"XSS"},{id:"R4",rule:"Cross-origin storage",risk:"Data theft"},{id:"R5",rule:"Undeclared fetch",risk:"Exfiltration"},{id:"R6",rule:"Frame access",risk:"Sandbox escape"},{id:"R7",rule:"Crypto mining",risk:"Resource theft"},{id:"R8",rule:"Obfuscation",risk:"Hidden malware"},{id:"R9",rule:"Prototype Pollution",risk:"RCE"},{id:"R10",rule:"Hardcoded Secrets",risk:"Credential leak"},{id:"R11",rule:"Insecure Crypto",risk:"Weak security"},{id:"R12",rule:"IA Externa (bypass)",risk:"Revenue theft"},{id:"R13",rule:"Billing Bypass",risk:"Economic damage"},{id:"R14",rule:"MCP Manifest ausente",risk:"No integration"}],t0=[{id:1,time:"12:34",type:"block",msg:" @carlo/epic-hook: fetch() no autorizado bloqueado  tentativa de bypass Proxy SDK"},{id:2,time:"12:30",type:"warning",msg:" @dev/whatsapp-bridge: panda.bridge.external requer reviso  Score 71 (limtrofe)"},{id:3,time:"11:15",type:"scan",msg:" Re-scan dirio concludo: 4 mdulos OK, 1 suspenso"},{id:4,time:"10:00",type:"info",msg:" @panda/ai-chat: Score atualizado 9798  nenhuma vulnerabilidade nova"},{id:5,time:"09:45",type:"block",msg:" @carlo/epic-hook: eval() dinmico detectado  Auto-suspend ativado (Score < 50)"},{id:6,time:"08:30",type:"info",msg:" @panda/draw-tools: Sandbox test 30s  OK"}],Rc={low:"#10b981",medium:"#f59e0b",high:"#ef4444"},a1e={low:" Baixo",medium:" Mdio",high:" Alto"},l1e={approved:" Aprovado",review:" Em Reviso",suspended:" Suspenso"},Zt={container:{padding:"24px 32px",maxWidth:900,margin:"0 auto",fontFamily:"'Inter', -apple-system, sans-serif",color:"var(--pf-text, #e2e8f0)"},header:{display:"flex",alignItems:"center",gap:12,marginBottom:8},title:{fontSize:24,fontWeight:700,margin:0},subtitle:{color:"var(--pf-text-muted, #94a3b8)",fontSize:14,marginBottom:24},card:{background:"var(--pf-surface, rgba(30,41,59,0.7))",border:"1px solid var(--pf-border, rgba(100,116,139,0.2))",borderRadius:12,padding:20,marginBottom:16},sectionTitle:{fontSize:15,fontWeight:700,marginBottom:14,display:"flex",alignItems:"center",gap:8},scoreBox:{display:"flex",alignItems:"center",justifyContent:"center",gap:24,padding:"20px 0"},scoreBig:{fontSize:56,fontWeight:800,lineHeight:1},moduleRow:{display:"flex",alignItems:"center",gap:12,padding:"10px 14px",borderRadius:8,marginBottom:6,cursor:"pointer",transition:"background .15s"},permTag:{display:"inline-block",padding:"2px 8px",borderRadius:4,fontSize:11,fontFamily:"'JetBrains Mono', monospace",marginRight:4,marginBottom:4},eventRow:{padding:"8px 12px",borderRadius:6,marginBottom:4,fontSize:13,lineHeight:1.5,display:"flex",gap:10,alignItems:"flex-start"},eventTime:{color:"#64748b",fontFamily:"'JetBrains Mono', monospace",fontSize:11,minWidth:44,marginTop:2}};function c1e(t){return t.includes("wallet")||t.includes("auth.modify")?"high":t.includes("write")||t.includes("state")||t.includes("bridge")?"medium":"low"}function d1e(){const[t,e]=S.useState(null),[n,s]=S.useState("all"),[i,r]=S.useState(!1),[o,l]=S.useState(r1e),[c,d]=S.useState(new Set),u=Math.round(o.reduce((x,m)=>x+m.score,0)/(o.length||1)),h=u>=80?"#10b981":u>=60?"#f59e0b":"#ef4444",p=S.useCallback(x=>e(m=>m===x?null:x),[]),f=n==="all"?t0:t0.filter(x=>x.type===n),g=S.useCallback(x=>{d(m=>new Set([...m,x])),console.log(` DEFEND:  Mdulo ${x} reportado  denncia registrada`)},[]),y=S.useCallback(x=>{l(m=>m.filter(v=>v.id!==x)),e(null),console.log(` DEFEND:  Mdulo ${x} desinstalado`)},[]);return a.jsxs("div",{style:Zt.container,children:[a.jsxs("div",{style:Zt.header,children:[a.jsx("span",{style:{fontSize:28},children:""}),a.jsx("h1",{style:Zt.title,children:"Panda Defend"})]}),a.jsx("p",{style:Zt.subtitle,children:"Monitoramento de segurana  mdulos instalados, permisses e atividade"}),a.jsx("div",{style:Zt.card,children:a.jsxs("div",{style:Zt.scoreBox,children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{...Zt.scoreBig,color:h},children:u}),a.jsx("div",{style:{color:"#94a3b8",fontSize:13,marginTop:4},children:"DEFEND SCORE"})]}),a.jsxs("div",{style:{fontSize:13,lineHeight:1.8},children:[a.jsxs("div",{children:[" Aprovados:"," ",a.jsx("strong",{children:o.filter(x=>x.status==="approved").length})]}),a.jsxs("div",{children:[" Em reviso:"," ",a.jsx("strong",{children:o.filter(x=>x.status==="review").length})]}),a.jsxs("div",{children:[" Suspensos:"," ",a.jsx("strong",{children:o.filter(x=>x.status==="suspended").length})]}),a.jsx("div",{style:{color:"#64748b",marginTop:4,fontSize:11},children:"ltimo scan: hoje 12:34"})]})]})}),a.jsxs("div",{style:Zt.card,children:[a.jsxs("div",{style:Zt.sectionTitle,children:[a.jsx("span",{children:""})," Mdulos Instalados (",o.length,")"]}),o.map(x=>a.jsxs("div",{children:[a.jsxs("div",{style:{...Zt.moduleRow,background:t===x.id?"rgba(100,116,139,0.15)":"rgba(100,116,139,0.06)"},onClick:()=>p(x.id),children:[a.jsx("span",{style:{fontSize:20},children:x.icon}),a.jsxs("div",{style:{flex:1},children:[a.jsx("div",{style:{fontWeight:600,fontSize:14},children:x.name}),a.jsxs("div",{style:{color:"#64748b",fontSize:11},children:[x.id," "," ",x.type==="tentacle"?" Tentculo":" Mdulo"]})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:48},children:[a.jsx("div",{style:{fontWeight:800,fontSize:18,color:x.score>=80?"#10b981":x.score>=60?"#f59e0b":"#ef4444"},children:x.score}),a.jsx("div",{style:{fontSize:9,color:"#64748b"},children:"SCORE"})]}),a.jsx("span",{style:{fontSize:11,padding:"3px 8px",borderRadius:4,background:`${Rc[x.risk]}15`,color:Rc[x.risk],border:`1px solid ${Rc[x.risk]}30`},children:a1e[x.risk]}),a.jsx("span",{style:{fontSize:11,color:"#94a3b8"},children:l1e[x.status]}),a.jsx("span",{style:{fontSize:12,transform:t===x.id?"rotate(180deg)":"rotate(0)",transition:"transform .2s"},children:""})]}),t===x.id&&a.jsxs("div",{style:{padding:"12px 20px 16px 48px",borderBottom:"1px solid rgba(100,116,139,0.1)"},children:[a.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:8,color:"#94a3b8"},children:"PERMISSES CONCEDIDAS:"}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:2},children:x.permissions.map(m=>{const v=c1e(m);return a.jsx("span",{style:{...Zt.permTag,background:`${Rc[v]}12`,color:Rc[v],border:`1px solid ${Rc[v]}25`},children:m},m)})}),a.jsxs("div",{style:{fontSize:11,color:"#64748b",marginTop:8},children:["ltimo scan: ",x.lastScan]}),x.type==="tentacle"&&a.jsxs("div",{style:{marginTop:8,padding:"8px 12px",borderRadius:6,background:"rgba(245,158,11,0.08)",border:"1px solid rgba(245,158,11,0.2)",fontSize:12,color:"#f59e0b"},children:[" ",a.jsx("strong",{children:"Tentculo"}),"  acessa APIs do sistema via Proxy SDK. Sandbox forte + permisses explcitas obrigatrias."]}),rh[x.id]&&a.jsxs("div",{style:{marginTop:10},children:[a.jsx("div",{style:{fontSize:12,fontWeight:600,color:"#94a3b8",marginBottom:6},children:" SCORE BREAKDOWN:"}),rh[x.id].bonus.map((m,v)=>a.jsxs("div",{style:{fontSize:11,color:"#10b981",paddingLeft:8},children:["+ ",m]},`b-${v}`)),rh[x.id].penalty.map((m,v)=>a.jsxs("div",{style:{fontSize:11,color:"#ef4444",paddingLeft:8},children:[" ",m]},`p-${v}`)),rh[x.id].bonus.length===0&&rh[x.id].penalty.length===0&&a.jsx("div",{style:{fontSize:11,color:"#64748b",paddingLeft:8},children:"Nenhum detalhe disponvel"})]}),a.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[a.jsx("button",{onClick:m=>{m.stopPropagation(),g(x.id)},disabled:c.has(x.id),style:{padding:"5px 12px",borderRadius:6,fontSize:11,fontWeight:600,background:c.has(x.id)?"rgba(100,116,139,0.1)":"rgba(245,158,11,0.1)",color:c.has(x.id)?"#64748b":"#f59e0b",border:`1px solid ${c.has(x.id)?"rgba(100,116,139,0.2)":"rgba(245,158,11,0.25)"}`,cursor:c.has(x.id)?"default":"pointer"},children:c.has(x.id)?" Reportado":" Reportar"}),a.jsx("button",{onClick:m=>{m.stopPropagation(),window.confirm(`Desinstalar ${x.name}? Esta ao no pode ser desfeita.`)&&y(x.id)},style:{padding:"5px 12px",borderRadius:6,fontSize:11,fontWeight:600,background:"rgba(239,68,68,0.1)",color:"#ef4444",border:"1px solid rgba(239,68,68,0.25)",cursor:"pointer"},children:" Desinstalar"})]})]})]},x.id))]}),a.jsxs("div",{style:Zt.card,children:[a.jsxs("div",{style:{...Zt.sectionTitle,justifyContent:"space-between"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{children:""})," Monitor de Atividade"]}),a.jsxs("select",{value:n,onChange:x=>s(x.target.value),style:{background:"rgba(100,116,139,0.15)",border:"1px solid rgba(100,116,139,0.2)",borderRadius:6,color:"var(--pf-text, #e2e8f0)",padding:"4px 8px",fontSize:11},children:[a.jsxs("option",{value:"all",children:["Todos (",t0.length,")"]}),a.jsx("option",{value:"block",children:" Bloqueios"}),a.jsx("option",{value:"warning",children:" Alertas"}),a.jsx("option",{value:"scan",children:" Scans"}),a.jsx("option",{value:"info",children:" Info"})]})]}),a.jsx("div",{style:{maxHeight:260,overflowY:"auto",background:"var(--pf-bg, rgba(0,0,0,0.2))",borderRadius:8,padding:8},children:f.map(x=>a.jsxs("div",{style:{...Zt.eventRow,background:x.type==="block"?"rgba(239,68,68,0.06)":x.type==="warning"?"rgba(245,158,11,0.06)":"transparent"},children:[a.jsx("span",{style:Zt.eventTime,children:x.time}),a.jsx("span",{children:x.msg})]},x.id))})]}),a.jsxs("div",{style:Zt.card,children:[a.jsxs("div",{style:{...Zt.sectionTitle,cursor:"pointer",justifyContent:"space-between"},onClick:()=>r(x=>!x),children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{children:""})," 14 Regras de Ouro (Bloqueio Automtico)"]}),a.jsx("span",{style:{fontSize:12,transform:i?"rotate(180deg)":"rotate(0)",transition:"transform .2s"},children:""})]}),i&&a.jsxs("div",{style:{overflowX:"auto"},children:[a.jsxs("table",{style:{width:"100%",fontSize:12,borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(100,116,139,0.2)"},children:[a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"ID"}),a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Regra"}),a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Risco"})]})}),a.jsx("tbody",{children:o1e.map(x=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(100,116,139,0.08)"},children:[a.jsx("td",{style:{padding:"4px 8px",fontWeight:700,color:"#ef4444",fontFamily:"monospace"},children:x.id}),a.jsx("td",{style:{padding:"4px 8px"},children:x.rule}),a.jsx("td",{style:{padding:"4px 8px",fontSize:11,color:"#f59e0b"},children:x.risk})]},x.id))})]}),a.jsxs("div",{style:{fontSize:11,color:"#64748b",marginTop:8,padding:"0 8px"},children:["Ref: ",a.jsx("code",{style:{fontSize:10,background:"rgba(100,116,139,0.15)",padding:"1px 4px",borderRadius:3},children:"PF_SECURITY_REFERENCE.md 1.6.B"})]})]})]}),a.jsxs("div",{style:Zt.card,children:[a.jsxs("div",{style:Zt.sectionTitle,children:[a.jsx("span",{children:""})," Emergency Kill Switch"]}),a.jsx("div",{style:{fontSize:13,color:"var(--pf-text-muted, #94a3b8)",marginBottom:12},children:"Desliga TODOS os servios imediatamente. Requer PIN + assinatura Ed25519."}),a.jsx(c8,{})]}),a.jsx("div",{style:{...Zt.card,background:"rgba(102,126,234,0.06)",border:"1px solid rgba(102,126,234,0.2)"},children:a.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start"},children:[a.jsx("span",{style:{fontSize:22},children:""}),a.jsxs("div",{style:{fontSize:13,lineHeight:1.6},children:[a.jsx("div",{style:{fontWeight:700,marginBottom:4,color:"var(--accent-color, #667eea)"},children:"Como funciona o Panda Defend"}),a.jsxs("div",{style:{color:"var(--pf-text-muted, #94a3b8)"},children:["O Panda Defend monitora todos os mdulos e tentculos instalados no seu ambiente. Cada extenso recebe um"," ",a.jsx("strong",{children:"Score de Segurana"})," (0-100) baseado em anlise esttica, permisses declaradas, e comportamento em sandbox.",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Score  70:"})," Aprovado automaticamente.",a.jsx("br",{}),a.jsx("strong",{children:"Score 50-69:"})," Requer reviso manual.",a.jsx("br",{}),a.jsxs("strong",{children:["Score ","<"," 50:"]})," Suspenso automaticamente.",a.jsx("br",{}),a.jsx("br",{}),"Extenses suspeitas so bloqueadas em tempo real. Voc sempre tem controle total para desinstalar qualquer mdulo."]})]})]})})]})}const n0=[{id:"welcome",icon:"",title:"WELCOME TO PANDA FABRICS",subtitle:"Your modular creation platform",content:"Panda Fabrics is your infinite workspace to create, publish, and monetize. Fully modular, fully connected.",visual:"./panda-icon.png"},{id:"powers",icon:"",title:"YOUR POWERS",subtitle:"Tools that grow with you",content:null,features:[{icon:"",name:"INFINITE CANVAS",desc:"Draw, design, and organize without limits"},{icon:"",name:"PANDA AI",desc:"5 AI models ready to help"},{icon:"",name:"TOOL DOCK",desc:"Everything accessible in one click"}]},{id:"store",icon:"",title:"THE MEDUSA STORE",subtitle:"Extension marketplace",content:"Install apps, tools, and plugins created by the community. Publish yours and earn automatic royalties via PAT tokens.",features:[{icon:"",name:"INSTALL",desc:"Ready-to-use apps"},{icon:"",name:"PUBLISH",desc:"Launch your creations"},{icon:"",name:"MONETIZE",desc:"Automatic royalties"}]},{id:"start",icon:"",title:"GET STARTED",subtitle:"Choose where to begin",content:null}];function u1e({onComplete:t,onOpenStore:e}){const[n,s]=S.useState(0),[i,r]=S.useState(!1),[o,l]=S.useState("forward"),c=n0[n],d=n===n0.length-1,u=n===0,h=S.useCallback(()=>{d||(l("forward"),s(x=>x+1))},[d]),p=S.useCallback(()=>{u||(l("back"),s(x=>x-1))},[u]),f=S.useCallback(x=>{r(!0),localStorage.setItem("panda_onboarding_complete","true"),setTimeout(()=>{t&&t(x)},400)},[t]),g=S.useCallback(()=>{f("skip")},[f]),y=S.useCallback(x=>{x.key==="ArrowRight"||x.key==="Enter"?d||h():x.key==="ArrowLeft"?u||p():x.key==="Escape"&&g()},[h,p,g,d,u]);return a.jsxs("div",{className:`pf-wizard-overlay ${i?"pf-wizard-exit":""}`,role:"dialog","aria-modal":"true","aria-label":"Welcome wizard",onKeyDown:y,children:[a.jsx("div",{className:"pf-wizard-backdrop"}),a.jsxs("div",{className:"pf-wizard-container",children:[a.jsx("button",{className:"pf-wizard-close-btn",onClick:g,"aria-label":"Close wizard",title:"Close",children:""}),a.jsxs("div",{className:`pf-wizard-step ${o}`,children:[c.id==="welcome"&&a.jsxs("div",{className:"pf-wizard-welcome",children:[a.jsx("img",{src:c.visual,alt:"Panda Fabrics",className:"pf-wizard-logo"}),a.jsx("h2",{className:"pf-wizard-title",children:c.title}),a.jsx("p",{className:"pf-wizard-subtitle",children:c.subtitle}),a.jsx("p",{className:"pf-wizard-text",children:c.content})]}),c.features&&c.id!=="start"&&a.jsxs("div",{className:"pf-wizard-features-step",children:[a.jsx("div",{className:"pf-wizard-step-icon",children:c.icon}),a.jsx("h2",{className:"pf-wizard-title",children:c.title}),a.jsx("p",{className:"pf-wizard-subtitle",children:c.subtitle}),c.content&&a.jsx("p",{className:"pf-wizard-text",children:c.content}),a.jsx("div",{className:"pf-wizard-features",children:c.features.map(x=>a.jsxs("div",{className:"pf-wizard-feature-card",children:[a.jsx("span",{className:"pf-wizard-feature-icon",children:x.icon}),a.jsx("strong",{className:"pf-wizard-feature-name",children:x.name}),a.jsx("span",{className:"pf-wizard-feature-desc",children:x.desc})]},x.name))})]}),c.id==="start"&&a.jsxs("div",{className:"pf-wizard-cta-step",children:[a.jsx("div",{className:"pf-wizard-step-icon",children:c.icon}),a.jsx("h2",{className:"pf-wizard-title",children:c.title}),a.jsx("p",{className:"pf-wizard-subtitle",children:c.subtitle}),a.jsxs("div",{className:"pf-wizard-cta-cards",children:[a.jsxs("button",{className:"pf-wizard-cta-card",onClick:()=>f("draw"),"aria-label":"Create first project",children:[a.jsx("span",{className:"pf-wizard-cta-icon",children:""}),a.jsx("strong",{children:"CREATE FIRST PROJECT"}),a.jsx("span",{className:"pf-wizard-cta-desc",children:"Open the canvas and start drawing"})]}),a.jsxs("button",{className:"pf-wizard-cta-card",onClick:()=>{f("store"),e&&e()},"aria-label":"Explore the Store",children:[a.jsx("span",{className:"pf-wizard-cta-icon",children:""}),a.jsx("strong",{children:"EXPLORE THE STORE"}),a.jsx("span",{className:"pf-wizard-cta-desc",children:"Discover ready-made apps and tools"})]}),a.jsxs("button",{className:"pf-wizard-cta-card",onClick:()=>f("chat"),"aria-label":"Chat with AI",children:[a.jsx("span",{className:"pf-wizard-cta-icon",children:""}),a.jsx("strong",{children:"CHAT WITH AI"}),a.jsx("span",{className:"pf-wizard-cta-desc",children:"Ask for help or get inspired"})]})]})]})]},c.id),a.jsx("div",{className:"pf-wizard-dots",role:"tablist","aria-label":"Wizard steps",children:n0.map((x,m)=>a.jsx("button",{className:`pf-wizard-dot ${m===n?"active":""} ${m<n?"completed":""}`,onClick:()=>{l(m>n?"forward":"back"),s(m)},role:"tab","aria-selected":m===n,"aria-label":`Step ${m+1}: ${x.title}`},x.id))}),a.jsxs("div",{className:"pf-wizard-nav",children:[a.jsx("button",{className:"pf-wizard-skip-btn",onClick:g,"aria-label":d?"Close wizard":"Skip introduction",children:d?"CLOSE":"SKIP"}),a.jsxs("div",{className:"pf-wizard-nav-right",children:[!u&&a.jsx("button",{className:"pf-wizard-back-btn",onClick:p,"aria-label":"Back",children:" BACK"}),d?a.jsx("button",{className:"pf-wizard-finish-btn",onClick:()=>f("finish"),"aria-label":"Finish and close wizard",children:"FINISH "}):a.jsx("button",{className:"pf-wizard-next-btn",onClick:h,"aria-label":"Next",children:"NEXT "})]})]})]})]})}const s0={required:["name","version","description","author","permissions"],fields:{name:{pattern:/^[a-z0-9-]+$/},version:{pattern:/^\d+\.\d+\.\d+$/},permissions:{items:["network","storage","clipboard","notifications","geolocation"]}}},OM={name:"my-plugin",version:"1.0.0",description:"Descrio do meu plugin",author:"Seu Nome",homepage:"https://github.com/user/repo",license:"MIT",permissions:[],files:{main:"index.js",styles:"styles.css"},keywords:["panda","plugin"],priceUSD:0};function h1e({onSave:t,onClose:e,initialManifest:n=null}){const[s,i]=S.useState(n||OM),[r,o]=S.useState([]),[l,c]=S.useState([]),[d,u]=S.useState(!1),[h,p]=S.useState("");S.useEffect(()=>{var I,T;const w=[],_=[];for(const P of s0.required)s[P]||w.push(`Campo obrigatrio ausente: ${P}`);const{fields:C}=s0;s.name&&!C.name.pattern.test(s.name)&&w.push("Nome invlido: use apenas letras minsculas, nmeros e hfens"),s.version&&!C.version.pattern.test(s.version)&&w.push("Verso invlida: use formato X.Y.Z (ex: 1.0.0)"),s.description&&(s.description.length<10&&w.push("Descrio muito curta (mnimo 10 caracteres)"),s.description.length>200&&w.push("Descrio muito longa (mximo 200 caracteres)")),s.homepage||_.push("Recomendado: adicionar homepage"),s.license||_.push("Recomendado: especificar licena"),(I=s.permissions)!=null&&I.includes("network")&&!((T=s.permissions)!=null&&T.includes("storage"))&&_.push('Permisso "network" sem "storage" pode limitar funcionalidade'),o(w),c(_)},[s]),S.useEffect(()=>{p(JSON.stringify(s,null,2))},[s]);const f=(w,_)=>{i(C=>({...C,[w]:_}))},g=w=>{const _=s.permissions||[],C=_.includes(w)?_.filter(I=>I!==w):[..._,w];f("permissions",C)},y=w=>{p(w.target.value);try{const _=JSON.parse(w.target.value);i(_)}catch(_){o(C=>[...C.filter(I=>!I.includes("JSON invlido")),"JSON invlido: "+_.message])}},x=()=>{if(r.length>0){alert("Corrija os erros antes de salvar");return}t&&t(s)},m=()=>{confirm("Resetar para o template padro?")&&i(OM)},v=r.length===0;return a.jsx("div",{className:"manifest-editor-overlay",onClick:e,children:a.jsxs("div",{className:"manifest-editor",onClick:w=>w.stopPropagation(),children:[a.jsxs("header",{className:"editor-header",children:[a.jsx("h2",{children:" Plugin Manifest Editor"}),a.jsxs("div",{className:"header-actions",children:[a.jsx("button",{className:`toggle-view ${d?"active":""}`,onClick:()=>u(!d),children:d?" Form":"{ } JSON"}),a.jsx("button",{className:"btn-close",onClick:e,children:""})]})]}),a.jsxs("div",{className:`validation-status ${v?"valid":"invalid"}`,children:[a.jsx("span",{className:"status-icon",children:v?"":""}),a.jsx("span",{className:"status-text",children:v?"Manifest vlido":`${r.length} erro(s) encontrado(s)`})]}),a.jsxs("div",{className:"editor-content",children:[d?a.jsx("div",{className:"json-editor",children:a.jsx("textarea",{value:h,onChange:y,spellCheck:!1})}):a.jsxs("div",{className:"form-editor",children:[a.jsxs("section",{className:"form-section",children:[a.jsx("h3",{children:" Informaes Bsicas"}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Nome do Plugin *"}),a.jsx("input",{type:"text",value:s.name||"",onChange:w=>f("name",w.target.value),placeholder:"my-plugin"}),a.jsx("span",{className:"hint",children:"Letras minsculas, nmeros e hfens"})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Verso *"}),a.jsx("input",{type:"text",value:s.version||"",onChange:w=>f("version",w.target.value),placeholder:"1.0.0"})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Descrio *"}),a.jsx("textarea",{value:s.description||"",onChange:w=>f("description",w.target.value),placeholder:"O que seu plugin faz?",rows:2}),a.jsxs("span",{className:"char-count",children:[(s.description||"").length,"/200"]})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Autor *"}),a.jsx("input",{type:"text",value:s.author||"",onChange:w=>f("author",w.target.value),placeholder:"Seu Nome"})]})]}),a.jsxs("section",{className:"form-section",children:[a.jsx("h3",{children:" Permisses"}),a.jsx("p",{className:"section-desc",children:"Selecione as permisses que seu plugin precisa"}),a.jsx("div",{className:"permissions-grid",children:s0.fields.permissions.items.map(w=>a.jsxs("label",{className:"permission-item",children:[a.jsx("input",{type:"checkbox",checked:(s.permissions||[]).includes(w),onChange:()=>g(w)}),a.jsxs("span",{className:"perm-icon",children:[w==="network"&&"",w==="storage"&&"",w==="clipboard"&&"",w==="notifications"&&"",w==="geolocation"&&""]}),a.jsx("span",{className:"perm-name",children:w})]},w))})]}),a.jsxs("section",{className:"form-section",children:[a.jsx("h3",{children:" Preo (USD)"}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Preo em USD (0 = Grtis)"}),a.jsx("input",{type:"number",value:s.priceUSD||0,onChange:w=>f("priceUSD",parseFloat(w.target.value)||0),min:0,max:9999,step:.01})]})]}),a.jsxs("section",{className:"form-section",children:[a.jsx("h3",{children:" Opcional"}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Homepage"}),a.jsx("input",{type:"url",value:s.homepage||"",onChange:w=>f("homepage",w.target.value),placeholder:"https://github.com/user/repo"})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Licena"}),a.jsxs("select",{value:s.license||"",onChange:w=>f("license",w.target.value),children:[a.jsx("option",{value:"",children:"Selecione..."}),a.jsx("option",{value:"MIT",children:"MIT"}),a.jsx("option",{value:"Apache-2.0",children:"Apache 2.0"}),a.jsx("option",{value:"GPL-3.0",children:"GPL 3.0"}),a.jsx("option",{value:"BSD-3-Clause",children:"BSD 3-Clause"}),a.jsx("option",{value:"Proprietary",children:"Proprietria"})]})]})]})]}),(r.length>0||l.length>0)&&a.jsxs("div",{className:"validation-messages",children:[r.map((w,_)=>a.jsxs("div",{className:"msg error",children:[" ",w]},_)),l.map((w,_)=>a.jsxs("div",{className:"msg warning",children:[" ",w]},_))]})]}),a.jsxs("footer",{className:"editor-footer",children:[a.jsx("button",{className:"btn-reset",onClick:m,children:" Reset"}),a.jsxs("div",{className:"footer-right",children:[a.jsx("button",{className:"btn-cancel",onClick:e,children:"Cancelar"}),a.jsx("button",{className:"btn-save",onClick:x,disabled:!v,children:" Salvar Manifest"})]})]})]})})}function p1e({onToggleDevTools:t,onToggleChat:e,onOpenSettings:n,onOpenStore:s,onEscape:i}){const r=S.useCallback(o=>{const l=o.target.tagName;if(!(l==="INPUT"||l==="TEXTAREA"||l==="SELECT")&&!o.target.isContentEditable){if(o.ctrlKey||o.metaKey){switch(o.key.toLowerCase()){case"d":o.preventDefault(),t==null||t();break;case"/":o.preventDefault(),e==null||e();break;case",":o.preventDefault(),n==null||n();break;case"k":o.preventDefault(),s==null||s();break}return}o.key==="Escape"&&(i==null||i())}},[t,e,n,s,i]);S.useEffect(()=>(window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)),[r])}const $S=[{id:"lead",label:" Leads",color:"#3b82f6"},{id:"contacted",label:" Contacted",color:"#f59e0b"},{id:"proposal",label:" Proposal",color:"#8b5cf6"},{id:"negotiation",label:" Negotiation",color:"#f97316"},{id:"won",label:" Won",color:"#10b981"},{id:"lost",label:" Lost",color:"#ef4444"}],f1e=[{id:"demo-1",name:"Maria Silva",email:"maria@example.com",phone:"+55 11 99999-0001",company:"TechCorp",stage:"lead",value:5e3,notes:"Interested in CRM module",createdAt:new Date().toISOString()},{id:"demo-2",name:"Joo Santos",email:"joao@example.com",phone:"+55 21 88888-0002",company:"DigitalAgency",stage:"contacted",value:12e3,notes:"Scheduled demo for next week",createdAt:new Date().toISOString()},{id:"demo-3",name:"Ana Oliveira",email:"ana@example.com",phone:"+55 31 77777-0003",company:"StartupXYZ",stage:"proposal",value:8500,notes:"Sent proposal, waiting for feedback",createdAt:new Date().toISOString()}];function g1e({userId:t,onClose:e}){const[n,s]=S.useState([]),[i,r]=S.useState("kanban"),[o,l]=S.useState(null),[c,d]=S.useState(""),[u,h]=S.useState(!0);S.useEffect(()=>{(async()=>{try{const C=localStorage.getItem("pf_crm_contacts");if(C){s(JSON.parse(C)),h(!1);return}}catch{}s(f1e),h(!1)})()},[t]),S.useEffect(()=>{n.length>0&&localStorage.setItem("pf_crm_contacts",JSON.stringify(n))},[n]);const p=n.filter(_=>{var C,I;return!c||_.name.toLowerCase().includes(c.toLowerCase())||((C=_.company)==null?void 0:C.toLowerCase().includes(c.toLowerCase()))||((I=_.email)==null?void 0:I.toLowerCase().includes(c.toLowerCase()))}),f=$S.map(_=>({..._,contacts:p.filter(C=>C.stage===_.id),total:p.filter(C=>C.stage===_.id).reduce((C,I)=>C+(I.value||0),0)})),g=_=>{const C={..._,id:`crm-${Date.now()}`,stage:_.stage||"lead",createdAt:new Date().toISOString()};s(I=>[...I,C]),r("kanban")},y=(_,C)=>{s(I=>I.map(T=>T.id===_?{...T,...C}:T))},x=(_,C)=>{y(_,{stage:C})},m=_=>{confirm("Excluir este contato?")&&s(C=>C.filter(I=>I.id!==_))},v=n.filter(_=>_.stage!=="lost").reduce((_,C)=>_+(C.value||0),0),w=n.filter(_=>_.stage==="won").reduce((_,C)=>_+(C.value||0),0);return u?a.jsxs("div",{className:"crm-loading",children:[a.jsx("span",{style:{fontSize:48},children:""}),a.jsx("p",{children:"Carregando CRM..."})]}):a.jsxs("div",{className:"panda-crm",children:[a.jsxs("div",{className:"crm-header",children:[a.jsxs("div",{className:"crm-header-left",children:[a.jsx("h2",{className:"crm-title",children:" Panda CRM"}),a.jsxs("div",{className:"crm-stats",children:[a.jsxs("span",{className:"crm-stat",children:[" ",n.length," contatos"]}),a.jsxs("span",{className:"crm-stat pipeline",children:[" R$ ",v.toLocaleString()]}),a.jsxs("span",{className:"crm-stat won",children:[" R$ ",w.toLocaleString()]})]})]}),a.jsxs("div",{className:"crm-header-right",children:[a.jsx("input",{type:"text",placeholder:" Buscar...",value:c,onChange:_=>d(_.target.value),className:"crm-search"}),a.jsxs("div",{className:"crm-view-toggle",children:[a.jsx("button",{className:`crm-view-btn ${i==="kanban"?"active":""}`,onClick:()=>r("kanban"),children:" Kanban"}),a.jsx("button",{className:`crm-view-btn ${i==="list"?"active":""}`,onClick:()=>r("list"),children:" Lista"})]}),a.jsx("button",{className:"crm-add-btn",onClick:()=>{l(null),r("form")},children:"+ Novo Contato"}),e&&a.jsx("button",{className:"crm-close-btn",onClick:e,children:""})]})]}),a.jsxs("div",{className:"crm-content",children:[i==="kanban"&&a.jsx(m1e,{stages:f,onMove:x,onEdit:_=>{l(_),r("form")},onDelete:m}),i==="list"&&a.jsx(y1e,{contacts:p,onEdit:_=>{l(_),r("form")},onDelete:m,onMove:x}),i==="form"&&a.jsx(v1e,{contact:o,onSave:_=>{o?y(o.id,_):g(_),r("kanban")},onCancel:()=>r("kanban")})]})]})}function m1e({stages:t,onMove:e,onEdit:n,onDelete:s}){return a.jsx("div",{className:"crm-kanban",children:t.map(i=>a.jsxs("div",{className:"crm-kanban-column",children:[a.jsxs("div",{className:"crm-kanban-header",style:{borderBottomColor:i.color},children:[a.jsx("span",{className:"crm-kanban-title",children:i.label}),a.jsx("span",{className:"crm-kanban-count",children:i.contacts.length})]}),a.jsxs("div",{className:"crm-kanban-cards",children:[i.contacts.map(r=>a.jsxs("div",{className:"crm-kanban-card",children:[a.jsx("div",{className:"crm-card-name",children:r.name}),a.jsx("div",{className:"crm-card-company",children:r.company||""}),r.value>0&&a.jsxs("div",{className:"crm-card-value",children:["R$ ",r.value.toLocaleString()]}),a.jsxs("div",{className:"crm-card-actions",children:[a.jsx("button",{onClick:()=>n(r),title:"Editar",children:""}),a.jsx("select",{value:r.stage,onChange:o=>e(r.id,o.target.value),className:"crm-card-stage-select",children:$S.map(o=>a.jsx("option",{value:o.id,children:o.label},o.id))}),a.jsx("button",{onClick:()=>s(r.id),title:"Excluir",children:""})]})]},r.id)),i.contacts.length===0&&a.jsx("div",{className:"crm-kanban-empty",children:"Sem contatos"})]}),i.total>0&&a.jsxs("div",{className:"crm-kanban-total",children:["R$ ",i.total.toLocaleString()]})]},i.id))})}function y1e({contacts:t,onEdit:e,onDelete:n,onMove:s}){return a.jsx("div",{className:"crm-list",children:a.jsxs("table",{className:"crm-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Nome"}),a.jsx("th",{children:"Empresa"}),a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Telefone"}),a.jsx("th",{children:"Etapa"}),a.jsx("th",{children:"Valor"}),a.jsx("th",{children:"Aes"})]})}),a.jsx("tbody",{children:t.map(i=>a.jsxs("tr",{children:[a.jsx("td",{className:"crm-cell-name",children:i.name}),a.jsx("td",{children:i.company||""}),a.jsx("td",{children:i.email||""}),a.jsx("td",{children:i.phone||""}),a.jsx("td",{children:a.jsx("select",{value:i.stage,onChange:r=>s(i.id,r.target.value),className:"crm-cell-stage",children:$S.map(r=>a.jsx("option",{value:r.id,children:r.label},r.id))})}),a.jsxs("td",{children:["R$ ",(i.value||0).toLocaleString()]}),a.jsxs("td",{className:"crm-cell-actions",children:[a.jsx("button",{onClick:()=>e(i),children:""}),a.jsx("button",{onClick:()=>n(i.id),children:""})]})]},i.id))})]})})}function v1e({contact:t,onSave:e,onCancel:n}){const[s,i]=S.useState({name:(t==null?void 0:t.name)||"",email:(t==null?void 0:t.email)||"",phone:(t==null?void 0:t.phone)||"",company:(t==null?void 0:t.company)||"",stage:(t==null?void 0:t.stage)||"lead",value:(t==null?void 0:t.value)||0,notes:(t==null?void 0:t.notes)||""}),r=(l,c)=>{i(d=>({...d,[l]:c}))},o=l=>{if(l.preventDefault(),!s.name.trim())return alert("Nome  obrigatrio");e({...s,value:parseFloat(s.value)||0})};return a.jsx("div",{className:"crm-form-container",children:a.jsxs("form",{onSubmit:o,className:"crm-form",children:[a.jsx("h3",{children:t?" Editar Contato":" Novo Contato"}),a.jsxs("div",{className:"crm-form-grid",children:[a.jsxs("div",{className:"crm-form-group",children:[a.jsx("label",{children:"Nome *"}),a.jsx("input",{type:"text",value:s.name,onChange:l=>r("name",l.target.value),placeholder:"Nome completo",required:!0})]}),a.jsxs("div",{className:"crm-form-group",children:[a.jsx("label",{children:"Email"}),a.jsx("input",{type:"email",value:s.email,onChange:l=>r("email",l.target.value),placeholder:"email@example.com"})]}),a.jsxs("div",{className:"crm-form-group",children:[a.jsx("label",{children:"Telefone"}),a.jsx("input",{type:"tel",value:s.phone,onChange:l=>r("phone",l.target.value),placeholder:"+55 11 99999-0000"})]}),a.jsxs("div",{className:"crm-form-group",children:[a.jsx("label",{children:"Empresa"}),a.jsx("input",{type:"text",value:s.company,onChange:l=>r("company",l.target.value),placeholder:"Nome da empresa"})]}),a.jsxs("div",{className:"crm-form-group",children:[a.jsx("label",{children:"Etapa"}),a.jsx("select",{value:s.stage,onChange:l=>r("stage",l.target.value),children:$S.map(l=>a.jsx("option",{value:l.id,children:l.label},l.id))})]}),a.jsxs("div",{className:"crm-form-group",children:[a.jsx("label",{children:"Valor (R$)"}),a.jsx("input",{type:"number",value:s.value,onChange:l=>r("value",l.target.value),placeholder:"0",min:"0"})]})]}),a.jsxs("div",{className:"crm-form-group full-width",children:[a.jsx("label",{children:"Notas"}),a.jsx("textarea",{value:s.notes,onChange:l=>r("notes",l.target.value),placeholder:"Observaes sobre o contato...",rows:3})]}),a.jsxs("div",{className:"crm-form-actions",children:[a.jsx("button",{type:"button",className:"crm-btn-cancel",onClick:n,children:"Cancelar"}),a.jsx("button",{type:"submit",className:"crm-btn-save",children:t?"Salvar":"Criar Contato"})]})]})})}const i0=[{id:"saas",name:"SaaS Product",icon:"",description:"Modern SaaS landing with hero, features, pricing",color:"#3b82f6",sections:[{type:"hero",title:"Build Something Amazing",subtitle:"The all-in-one platform for modern teams.",cta:"Start Free Trial",bg:"linear-gradient(135deg, #1e3a5f, #0d1b2a)"},{type:"features",title:"Why Choose Us",items:[{icon:"",title:"Lightning Fast",desc:"Deploy in seconds, not hours"},{icon:"",title:"Secure by Default",desc:"Enterprise-grade security built in"},{icon:"",title:"Real-time Analytics",desc:"Track everything that matters"}]},{type:"pricing",title:"Simple Pricing",plans:[{name:"Starter",price:"Free",features:["5 Projects","Basic Analytics","Community Support"]},{name:"Pro",price:"$29/mo",features:["Unlimited Projects","Advanced Analytics","Priority Support"],highlighted:!0},{name:"Enterprise",price:"Custom",features:["Custom Integration","SLA 99.9%","Dedicated Support"]}]},{type:"cta",title:"Ready to Get Started?",subtitle:"Join 10,000+ teams already using our platform.",cta:"Create Your Account"}]},{id:"portfolio",name:"Portfolio",icon:"",description:"Clean portfolio for creatives and freelancers",color:"#8b5cf6",sections:[{type:"hero",title:"Hi, I'm [Your Name]",subtitle:"Designer & Developer crafting digital experiences.",cta:"View My Work",bg:"linear-gradient(135deg, #2d1b69, #1a0d3a)"},{type:"features",title:"What I Do",items:[{icon:"",title:"UI/UX Design",desc:"Beautiful, intuitive interfaces"},{icon:"",title:"Web Development",desc:"Modern, responsive websites"},{icon:"",title:"Mobile Apps",desc:"Native and cross-platform"}]},{type:"cta",title:"Let's Work Together",subtitle:"Open for freelance opportunities.",cta:"Get in Touch"}]},{id:"product",name:"Product Launch",icon:"",description:"High-converting product launch page",color:"#f59e0b",sections:[{type:"hero",title:"Introducing [Product]",subtitle:"The revolutionary tool that changes everything.",cta:"Pre-order Now  $49",bg:"linear-gradient(135deg, #5c3d0d, #2d1b06)"},{type:"features",title:"Key Features",items:[{icon:"",title:"Feature One",desc:"Describe your first key feature"},{icon:"",title:"Feature Two",desc:"Describe your second key feature"},{icon:"",title:"Feature Three",desc:"Describe your third key feature"}]},{type:"pricing",title:"Launch Pricing",plans:[{name:"Early Bird",price:"$29",features:["Full Access","Lifetime Updates","Community"],highlighted:!0},{name:"Regular",price:"$49",features:["Full Access","1 Year Updates","Email Support"]}]},{type:"cta",title:"Don't Miss Out!",subtitle:"Limited early-bird pricing  only 100 spots left.",cta:"Claim Your Spot"}]}];function x1e({onClose:t}){const[e,n]=S.useState(null),[s,i]=S.useState([]),[r,o]=S.useState(null),[l,c]=S.useState(!1),[d,u]=S.useState(()=>{try{return JSON.parse(localStorage.getItem("pf_landing_pages")||"[]")}catch{return[]}}),h=m=>{n(m),i(JSON.parse(JSON.stringify(m.sections))),c(!1)},p=(m,v)=>{i(w=>w.map((_,C)=>C===m?{..._,...v}:_))},f=()=>{const m={id:`lp-${Date.now()}`,templateId:e.id,templateName:e.name,sections:s,createdAt:new Date().toISOString()},v=[...d,m];u(v),localStorage.setItem("pf_landing_pages",JSON.stringify(v)),alert(" Pgina salva!")},g=()=>{const m=b1e(s),v=new Blob([m],{type:"text/html"}),w=URL.createObjectURL(v),_=document.createElement("a");_.href=w,_.download=`landing-${(e==null?void 0:e.id)||"page"}.html`,_.click(),URL.revokeObjectURL(w)},y=m=>{const v=d.filter(w=>w.id!==m);u(v),localStorage.setItem("pf_landing_pages",JSON.stringify(v))},x=m=>{const v=i0.find(w=>w.id===m.templateId)||i0[0];n(v),i(m.sections)};return e?a.jsxs("div",{className:"panda-landing",children:[a.jsxs("div",{className:"landing-header",children:[a.jsxs("div",{className:"landing-header-left",children:[a.jsxs("h2",{className:"landing-title",children:[" ",e.name]}),a.jsxs("div",{className:"landing-header-actions",children:[a.jsx("button",{className:"landing-btn secondary",onClick:()=>{n(null),i([])},children:" Templates"}),a.jsx("button",{className:`landing-btn ${l?"active":""}`,onClick:()=>c(!l),children:l?" Editor":" Preview"}),a.jsx("button",{className:"landing-btn primary",onClick:f,children:" Save"}),a.jsx("button",{className:"landing-btn export",onClick:g,children:" Export HTML"})]})]}),t&&a.jsx("button",{className:"landing-close-btn",onClick:t,children:""})]}),a.jsx("div",{className:"landing-content",children:l?a.jsx(DM,{sections:s}):a.jsxs("div",{className:"landing-editor-layout",children:[a.jsx("div",{className:"landing-section-list",children:s.map((m,v)=>a.jsxs("div",{className:`landing-section-item ${r===v?"active":""}`,onClick:()=>o(v),children:[a.jsxs("span",{className:"landing-section-type",children:[m.type==="hero"&&"",m.type==="features"&&"",m.type==="pricing"&&"",m.type==="cta"&&""," ",m.type.toUpperCase()]}),a.jsx("span",{className:"landing-section-preview-text",children:m.title})]},v))}),a.jsx("div",{className:"landing-section-editor",children:r!==null&&s[r]?a.jsx(S1e,{section:s[r],onChange:m=>p(r,m)}):a.jsxs("div",{className:"landing-editor-empty",children:[a.jsx("span",{style:{fontSize:48},children:""}),a.jsx("p",{children:"Select a section to edit"})]})}),a.jsx("div",{className:"landing-mini-preview",children:a.jsx(DM,{sections:s,mini:!0})})]})})]}):a.jsxs("div",{className:"panda-landing",children:[a.jsxs("div",{className:"landing-header",children:[a.jsxs("div",{className:"landing-header-left",children:[a.jsx("h2",{className:"landing-title",children:" Landing Page Builder"}),a.jsx("span",{className:"landing-subtitle",children:"Choose a template to start"})]}),a.jsx("div",{className:"landing-header-right",children:t&&a.jsx("button",{className:"landing-close-btn",onClick:t,children:""})})]}),a.jsxs("div",{className:"landing-content",children:[a.jsxs("div",{className:"landing-templates",children:[a.jsx("h3",{className:"landing-section-title",children:" Templates"}),a.jsx("div",{className:"landing-template-grid",children:i0.map(m=>a.jsxs("div",{className:"landing-template-card",onClick:()=>h(m),style:{borderColor:m.color+"40"},children:[a.jsx("div",{className:"landing-template-icon",style:{background:m.color+"20",color:m.color},children:m.icon}),a.jsx("h4",{children:m.name}),a.jsx("p",{children:m.description}),a.jsxs("span",{className:"landing-template-sections",children:[m.sections.length," sections"]})]},m.id))})]}),d.length>0&&a.jsxs("div",{className:"landing-saved",children:[a.jsxs("h3",{className:"landing-section-title",children:[" Saved Pages (",d.length,")"]}),a.jsx("div",{className:"landing-saved-list",children:d.map(m=>a.jsxs("div",{className:"landing-saved-item",children:[a.jsxs("div",{className:"landing-saved-info",children:[a.jsx("strong",{children:m.templateName}),a.jsx("span",{children:new Date(m.createdAt).toLocaleDateString()})]}),a.jsxs("div",{className:"landing-saved-actions",children:[a.jsx("button",{onClick:()=>x(m),children:" Edit"}),a.jsx("button",{onClick:()=>y(m.id),children:""})]})]},m.id))})]})]})]})}function S1e({section:t,onChange:e}){const n=(s,i)=>e({[s]:i});return a.jsxs("div",{className:"landing-editor-form",children:[a.jsxs("h3",{children:[t.type==="hero"&&" Hero Section",t.type==="features"&&" Features Section",t.type==="pricing"&&" Pricing Section",t.type==="cta"&&" CTA Section"]}),a.jsxs("div",{className:"landing-field",children:[a.jsx("label",{children:"Title"}),a.jsx("input",{type:"text",value:t.title||"",onChange:s=>n("title",s.target.value)})]}),t.subtitle!==void 0&&a.jsxs("div",{className:"landing-field",children:[a.jsx("label",{children:"Subtitle"}),a.jsx("input",{type:"text",value:t.subtitle||"",onChange:s=>n("subtitle",s.target.value)})]}),t.cta!==void 0&&a.jsxs("div",{className:"landing-field",children:[a.jsx("label",{children:"Button Text"}),a.jsx("input",{type:"text",value:t.cta||"",onChange:s=>n("cta",s.target.value)})]}),t.items&&a.jsxs("div",{className:"landing-field",children:[a.jsxs("label",{children:["Features (",t.items.length,")"]}),t.items.map((s,i)=>a.jsxs("div",{className:"landing-feature-edit",children:[a.jsx("input",{type:"text",value:s.icon,onChange:r=>{const o=[...t.items];o[i]={...o[i],icon:r.target.value},e({items:o})},className:"landing-icon-input",maxLength:2}),a.jsx("input",{type:"text",value:s.title,onChange:r=>{const o=[...t.items];o[i]={...o[i],title:r.target.value},e({items:o})},placeholder:"Feature title"}),a.jsx("input",{type:"text",value:s.desc,onChange:r=>{const o=[...t.items];o[i]={...o[i],desc:r.target.value},e({items:o})},placeholder:"Feature description"})]},i))]}),t.plans&&a.jsxs("div",{className:"landing-field",children:[a.jsxs("label",{children:["Pricing Plans (",t.plans.length,")"]}),t.plans.map((s,i)=>a.jsxs("div",{className:"landing-plan-edit",children:[a.jsx("input",{type:"text",value:s.name,onChange:r=>{const o=[...t.plans];o[i]={...o[i],name:r.target.value},e({plans:o})},placeholder:"Plan name"}),a.jsx("input",{type:"text",value:s.price,onChange:r=>{const o=[...t.plans];o[i]={...o[i],price:r.target.value},e({plans:o})},placeholder:"Price",className:"landing-price-input"})]},i))]})]})}function DM({sections:t,mini:e}){return a.jsx("div",{className:`landing-preview ${e?"mini":"full"}`,children:t.map((n,s)=>{var i,r;return a.jsxs("div",{className:`lp-section lp-${n.type}`,style:n.bg?{background:n.bg}:{},children:[n.type==="hero"&&a.jsxs("div",{className:"lp-hero",children:[a.jsx("h1",{children:n.title}),a.jsx("p",{children:n.subtitle}),n.cta&&a.jsx("button",{className:"lp-cta-btn",children:n.cta})]}),n.type==="features"&&a.jsxs("div",{className:"lp-features",children:[a.jsx("h2",{children:n.title}),a.jsx("div",{className:"lp-features-grid",children:(i=n.items)==null?void 0:i.map((o,l)=>a.jsxs("div",{className:"lp-feature-card",children:[a.jsx("span",{className:"lp-feature-icon",children:o.icon}),a.jsx("h3",{children:o.title}),a.jsx("p",{children:o.desc})]},l))})]}),n.type==="pricing"&&a.jsxs("div",{className:"lp-pricing",children:[a.jsx("h2",{children:n.title}),a.jsx("div",{className:"lp-pricing-grid",children:(r=n.plans)==null?void 0:r.map((o,l)=>{var c;return a.jsxs("div",{className:`lp-plan-card ${o.highlighted?"highlighted":""}`,children:[a.jsx("h3",{children:o.name}),a.jsx("div",{className:"lp-plan-price",children:o.price}),a.jsx("ul",{children:(c=o.features)==null?void 0:c.map((d,u)=>a.jsxs("li",{children:[" ",d]},u))})]},l)})})]}),n.type==="cta"&&a.jsxs("div",{className:"lp-cta",children:[a.jsx("h2",{children:n.title}),a.jsx("p",{children:n.subtitle}),n.cta&&a.jsx("button",{className:"lp-cta-btn",children:n.cta})]})]},s)})})}function b1e(t){return`<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Landing Page</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', 'Segoe UI', system-ui, sans-serif; background: #0d1117; color: #c9d1d9; }
  </style>
</head>
<body>
${t.map(n=>{if(n.type==="hero")return`<section style="padding:80px 20px;text-align:center;background:${n.bg||"#1a1a2e"}">
  <h1 style="font-size:48px;margin-bottom:16px;color:#fff">${n.title}</h1>
  <p style="font-size:20px;color:#aaa;margin-bottom:32px">${n.subtitle||""}</p>
  ${n.cta?`<a href="#" style="display:inline-block;padding:14px 32px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;font-weight:600">${n.cta}</a>`:""}
</section>`;if(n.type==="features"){const s=(n.items||[]).map(i=>`<div style="flex:1;min-width:250px;text-align:center;padding:24px">
    <div style="font-size:40px;margin-bottom:12px">${i.icon}</div>
    <h3 style="color:#fff;margin-bottom:8px">${i.title}</h3>
    <p style="color:#aaa">${i.desc}</p>
  </div>`).join(`
`);return`<section style="padding:60px 20px;background:#0d1117">
  <h2 style="text-align:center;color:#fff;margin-bottom:40px">${n.title}</h2>
  <div style="display:flex;flex-wrap:wrap;justify-content:center;gap:20px;max-width:900px;margin:0 auto">
    ${s}
  </div>
</section>`}if(n.type==="pricing"){const s=(n.plans||[]).map(i=>{const r=(i.features||[]).map(l=>`<li style="padding:8px 0;border-bottom:1px solid #333"> ${l}</li>`).join(`
`);return`<div style="flex:1;min-width:220px;${i.highlighted?"border:2px solid #3b82f6;":"border:1px solid #333;"}border-radius:12px;padding:24px;text-align:center;background:#161b22">
    <h3 style="color:#fff">${i.name}</h3>
    <div style="font-size:32px;font-weight:700;color:#3b82f6;margin:16px 0">${i.price}</div>
    <ul style="list-style:none;padding:0;color:#aaa">${r}</ul>
  </div>`}).join(`
`);return`<section style="padding:60px 20px;background:#0d1117">
  <h2 style="text-align:center;color:#fff;margin-bottom:40px">${n.title}</h2>
  <div style="display:flex;flex-wrap:wrap;justify-content:center;gap:20px;max-width:900px;margin:0 auto">
    ${s}
  </div>
</section>`}return n.type==="cta"?`<section style="padding:60px 20px;text-align:center;background:linear-gradient(135deg,#1e3a5f,#0d1b2a)">
  <h2 style="font-size:36px;color:#fff;margin-bottom:16px">${n.title}</h2>
  <p style="font-size:18px;color:#aaa;margin-bottom:32px">${n.subtitle||""}</p>
  ${n.cta?`<a href="#" style="display:inline-block;padding:14px 32px;background:#3b82f6;color:#fff;border-radius:8px;text-decoration:none;font-weight:600">${n.cta}</a>`:""}
</section>`:""}).join(`
`)}
</body>
</html>`}const r0={kiwify:{name:"Kiwify",icon:"",color:"#22c55e",baseUrl:"https://pay.kiwify.com.br",docs:"https://dashboard.kiwify.com.br"},hotmart:{name:"Hotmart",icon:"",color:"#ff6b35",baseUrl:"https://pay.hotmart.com",docs:"https://app.hotmart.com/?ref=Z87949064T"}},LM=[{id:"panda-factory-pro",name:"Panda Factory PRO",price:"R$ 97/ms",description:"Assinatura completa  todos os mdulos + IA",kiwifyId:"",hotmartId:""},{id:"crm",name:"Panda CRM",price:"Grtis",description:"CRM com IA  gesto de leads e vendas",kiwifyId:"",hotmartId:""},{id:"landing-pages",name:"Landing Pages",price:"Grtis",description:"Builder de pginas com templates prontos",kiwifyId:"",hotmartId:""}];function w1e({onClose:t}){const[e,n]=S.useState("materials"),[s,i]=S.useState([]),[r,o]=S.useState([]),[l,c]=S.useState([]),[d,u]=S.useState(null),[h,p]=S.useState([]),[f,g]=S.useState([]),[y,x]=S.useState(!1),[m,v]=S.useState(""),[w,_]=S.useState("affiliate"),[C,I]=S.useState("link"),[T,P]=S.useState("launch-2026"),[k,N]=S.useState("");S.useEffect(()=>{e==="materials"&&O(),e==="sales"&&L()},[e]);const O=S.useCallback(async D=>{x(!0);try{const U=await qw.listFiles(D||null);U!=null&&U.data&&(i(U.data.files||[]),o(U.data.subfolders||[]),D&&u(D))}catch(U){console.error("Drive load error:",U)}x(!1)},[]),R=D=>{c(U=>[...U,D]),O(D.id)},j=()=>{const D=[...l];D.pop(),c(D);const U=D.length>0?D[D.length-1].id:null;O(U)},A=async(D,U)=>{var z;try{const H=await qw.getShareLink(D);(z=H==null?void 0:H.data)!=null&&z.shareUrl&&(await navigator.clipboard.writeText(H.data.shareUrl),v(` Link copiado: ${U}`),setTimeout(()=>v(""),3e3))}catch{v(" Erro ao gerar link")}},B=async()=>{var D;x(!0);try{const U=await qw.initFounderFolder();U!=null&&U.data&&(N(` Pasta criada! ${((D=U.data.subfolders)==null?void 0:D.length)||0} subpastas`),O())}catch{N(" Erro ao criar pasta")}x(!1)},L=async()=>{var D,U;x(!0);try{const[z,H]=await Promise.all([tp.getRecentSales(20),tp.getWebhookLogs(50)]);(D=z==null?void 0:z.data)!=null&&D.sales&&p(z.data.sales),(U=H==null?void 0:H.data)!=null&&U.logs&&g(H.data.logs)}catch(z){console.error("Sales load error:",z)}x(!1)},$=(D,U)=>{var ee;const z=((ee=r0[D])==null?void 0:ee.baseUrl)||"",H=LM.find(Q=>Q.id===U),q=D==="kiwify"?H==null?void 0:H.kiwifyId:H==null?void 0:H.hotmartId;if(!q)return`${z}/{PRODUCT_ID}`;const V=new URLSearchParams({utm_source:w,utm_medium:C,utm_campaign:T});return`${z}/${q}?${V}`},M=async D=>{await navigator.clipboard.writeText(D),v(" Link copiado!"),setTimeout(()=>v(""),3e3)};return a.jsxs("div",{className:"founder-hub",children:[a.jsxs("header",{className:"fh-header",children:[a.jsxs("div",{className:"fh-title",children:[a.jsx("span",{className:"fh-icon",children:""}),a.jsx("h1",{children:"Founder Hub"}),a.jsx("span",{className:"fh-badge",children:"FOUNDER"})]}),a.jsxs("div",{className:"fh-actions",children:[m&&a.jsx("span",{className:"fh-copy-msg",children:m}),a.jsx("button",{className:"fh-close",onClick:t,children:""})]})]}),a.jsx("nav",{className:"fh-tabs",children:[{id:"materials",icon:"",label:"Materials Drive"},{id:"links",icon:"",label:"Affiliate Links"},{id:"sales",icon:"",label:"Sales Dashboard"}].map(D=>a.jsxs("button",{className:`fh-tab ${e===D.id?"active":""}`,onClick:()=>n(D.id),children:[a.jsx("span",{children:D.icon})," ",D.label]},D.id))}),a.jsxs("div",{className:"fh-content",children:[y&&a.jsx("div",{className:"fh-loading",children:" Carregando..."}),e==="materials"&&!y&&a.jsxs("div",{className:"fh-materials",children:[a.jsxs("div",{className:"fh-materials-toolbar",children:[a.jsxs("div",{className:"fh-breadcrumb",children:[a.jsx("button",{className:"fh-breadcrumb-item",onClick:()=>{c([]),O(null)},children:" Root"}),l.map((D,U)=>a.jsxs(Oe.Fragment,{children:[a.jsx("span",{className:"fh-breadcrumb-sep",children:"/"}),a.jsx("button",{className:"fh-breadcrumb-item",onClick:()=>{c(l.slice(0,U+1)),O(D.id)},children:D.name})]},D.id))]}),a.jsx("button",{className:"fh-btn fh-btn-primary",onClick:B,children:" Inicializar Pasta de Afiliados"})]}),k&&a.jsx("div",{className:"fh-init-msg",children:k}),a.jsxs("div",{className:"fh-file-grid",children:[l.length>0&&a.jsxs("div",{className:"fh-file-card fh-folder-card",onClick:j,children:[a.jsx("span",{className:"fh-file-icon",children:""}),a.jsx("span",{className:"fh-file-name",children:".."})]}),r.map(D=>a.jsxs("div",{className:"fh-file-card fh-folder-card",onClick:()=>R(D),children:[a.jsx("span",{className:"fh-file-icon",children:""}),a.jsx("span",{className:"fh-file-name",children:D.name})]},D.id)),s.map(D=>{var U,z,H;return a.jsxs("div",{className:"fh-file-card",children:[a.jsx("span",{className:"fh-file-icon",children:(U=D.mimeType)!=null&&U.includes("image")?"":(z=D.mimeType)!=null&&z.includes("video")?"":(H=D.mimeType)!=null&&H.includes("pdf")?"":""}),a.jsx("span",{className:"fh-file-name",children:D.name}),a.jsx("span",{className:"fh-file-size",children:D.size?`${(D.size/1024).toFixed(1)}KB`:""}),a.jsxs("div",{className:"fh-file-actions",children:[a.jsx("button",{className:"fh-btn-sm",onClick:()=>A(D.id,D.name),title:"Copiar link compartilhvel",children:""}),a.jsx("a",{href:D.url,target:"_blank",rel:"noopener noreferrer",className:"fh-btn-sm",title:"Abrir no Drive",children:""})]})]},D.id)}),s.length===0&&r.length===0&&a.jsxs("div",{className:"fh-empty",children:[a.jsx("p",{children:" Pasta vazia"}),a.jsx("p",{children:'Clique em "Inicializar Pasta de Afiliados" para criar a estrutura'})]})]})]}),e==="links"&&a.jsxs("div",{className:"fh-links",children:[a.jsxs("div",{className:"fh-utm-builder",children:[a.jsx("h3",{children:" UTM Builder"}),a.jsxs("div",{className:"fh-utm-fields",children:[a.jsxs("label",{children:["Source",a.jsx("input",{value:w,onChange:D=>_(D.target.value),placeholder:"affiliate"})]}),a.jsxs("label",{children:["Medium",a.jsx("input",{value:C,onChange:D=>I(D.target.value),placeholder:"link"})]}),a.jsxs("label",{children:["Campaign",a.jsx("input",{value:T,onChange:D=>P(D.target.value),placeholder:"launch-2026"})]})]})]}),a.jsx("div",{className:"fh-product-links",children:LM.map(D=>a.jsxs("div",{className:"fh-product-card",children:[a.jsxs("div",{className:"fh-product-info",children:[a.jsx("h4",{children:D.name}),a.jsx("p",{children:D.description}),a.jsx("span",{className:"fh-product-price",children:D.price})]}),a.jsx("div",{className:"fh-product-buttons",children:Object.entries(r0).map(([U,z])=>{const H=$(U,D.id);return a.jsxs("button",{className:"fh-btn fh-btn-platform",style:{"--platform-color":z.color},onClick:()=>M(H),title:`Copiar link ${z.name}`,children:[z.icon," ",z.name]},U)})})]},D.id))}),a.jsxs("div",{className:"fh-quick-links",children:[a.jsx("h3",{children:" Dashboards"}),a.jsx("div",{className:"fh-quick-grid",children:Object.entries(r0).map(([D,U])=>a.jsxs("a",{href:U.docs,target:"_blank",rel:"noopener noreferrer",className:"fh-quick-card",style:{borderColor:U.color},children:[a.jsx("span",{children:U.icon}),a.jsxs("span",{children:[U.name," Dashboard"]})]},D))})]})]}),e==="sales"&&!y&&a.jsxs("div",{className:"fh-sales",children:[a.jsxs("div",{className:"fh-summary",children:[a.jsxs("div",{className:"fh-stat-card",children:[a.jsx("span",{className:"fh-stat-value",children:h.length}),a.jsx("span",{className:"fh-stat-label",children:"Vendas Recentes"})]}),a.jsxs("div",{className:"fh-stat-card",children:[a.jsxs("span",{className:"fh-stat-value",children:["R$"," ",h.reduce((D,U)=>D+(U.amountPaid||0),0).toFixed(2)]}),a.jsx("span",{className:"fh-stat-label",children:"Receita Total"})]}),a.jsxs("div",{className:"fh-stat-card",children:[a.jsx("span",{className:"fh-stat-value",children:h.filter(D=>D.status==="ACTIVATED").length}),a.jsx("span",{className:"fh-stat-label",children:"Licenas Ativadas"})]}),a.jsxs("div",{className:"fh-stat-card",children:[a.jsx("span",{className:"fh-stat-value",children:h.filter(D=>D.status==="PENDING").length}),a.jsx("span",{className:"fh-stat-label",children:"Pendentes"})]})]}),a.jsxs("div",{className:"fh-table-section",children:[a.jsx("h3",{children:" Purchase Codes (RTDB)"}),a.jsx("div",{className:"fh-table-wrap",children:a.jsxs("table",{className:"fh-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Code"}),a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Source"}),a.jsx("th",{children:"Amount"}),a.jsx("th",{children:"PC"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Date"})]})}),a.jsx("tbody",{children:h.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:7,className:"fh-empty-cell",children:"Nenhuma venda registrada ainda"})}):h.map(D=>{var U,z,H;return a.jsxs("tr",{children:[a.jsx("td",{className:"fh-code",children:D.code}),a.jsx("td",{children:D.email}),a.jsx("td",{children:a.jsx("span",{className:`fh-source fh-source-${(U=D.source)==null?void 0:U.toLowerCase()}`,children:D.source})}),a.jsxs("td",{children:["R$ ",(z=D.amountPaid)==null?void 0:z.toFixed(2)]}),a.jsxs("td",{children:[D.coins," PC"]}),a.jsx("td",{children:a.jsx("span",{className:`fh-status fh-status-${(H=D.status)==null?void 0:H.toLowerCase()}`,children:D.status})}),a.jsx("td",{children:new Date(D.createdAt).toLocaleDateString("pt-BR")})]},D.code)})})]})})]}),a.jsxs("div",{className:"fh-table-section",children:[a.jsx("h3",{children:" Webhook Logs"}),a.jsx("div",{className:"fh-table-wrap",children:a.jsxs("table",{className:"fh-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Timestamp"}),a.jsx("th",{children:"Source"}),a.jsx("th",{children:"Email"}),a.jsx("th",{children:"Amount"}),a.jsx("th",{children:"PC"}),a.jsx("th",{children:"TX ID"})]})}),a.jsx("tbody",{children:f.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:6,className:"fh-empty-cell",children:"Nenhum webhook recebido ainda"})}):f.map((D,U)=>{var z;return a.jsxs("tr",{children:[a.jsx("td",{children:D.timestamp}),a.jsx("td",{children:a.jsx("span",{className:`fh-source fh-source-${(z=D.source)==null?void 0:z.toLowerCase()}`,children:D.source})}),a.jsx("td",{children:D.email}),a.jsxs("td",{children:["R$ ",D.amount]}),a.jsxs("td",{children:[D.coins," PC"]}),a.jsx("td",{className:"fh-code",children:D.transactionId})]},U)})})]})})]}),a.jsx("button",{className:"fh-btn fh-btn-primary",onClick:L,children:" Atualizar Dados"})]})]})]})}const _1e="modulepreload",C1e=function(t,e){return new URL(t,e).href},FM={},o0=function(e,n,s){let i=Promise.resolve();if(n&&n.length>0){const o=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));i=Promise.allSettled(n.map(d=>{if(d=C1e(d,s),d in FM)return;FM[d]=!0;const u=d.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(!!s)for(let g=o.length-1;g>=0;g--){const y=o[g];if(y.href===d&&(!u||y.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":_1e,u||(f.as="script"),f.crossOrigin="",f.href=d,c&&f.setAttribute("nonce",c),document.head.appendChild(f),u)return new Promise((g,y)=>{f.addEventListener("load",g),f.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${d}`)))})}))}function r(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})},Gi="CORE",os="EXTENSION",E1e={Auth:{icon:"",desc:"Firebase Auth bridge",domain:Gi},Wallet:{icon:"",desc:"RTDB Ledger (server-side)",domain:Gi},Bridge:{icon:"",desc:"Rust Agent / MCP",domain:Gi},Loader:{icon:"",desc:"Boot orchestrator",domain:Gi},Governance:{icon:"",desc:"Panda Council validator",domain:Gi},UI:{icon:"",desc:"Toast / Modal / Menu",domain:Gi},Brain:{icon:"",desc:"Gemini AI wrapper",domain:os},Canvas:{icon:"",desc:"TLDraw wrapper",domain:os},Dock:{icon:"",desc:"FlexLayout panels",domain:os},Collab:{icon:"",desc:"Yjs CRDT",domain:os},Data:{icon:"",desc:"Zustand / React Query",domain:os},Validate:{icon:"",desc:"Zod-like validator",domain:os},Store:{icon:"",desc:"Medusa Marketplace",domain:os},PAT:{icon:"",desc:"Autonomic Toolkit",domain:os},Polyglot:{icon:"",desc:"NLLB / Whisper",domain:os},Storage:{icon:"",desc:"File Upload/DL",domain:os},Google:{icon:"",desc:"Drive / Sheets / Colab",domain:os,subNamespaces:["Drive","Sheets","Colab"]}},T1e=["Auth","Wallet","Bridge","Loader","Governance","UI"],I1e=["Brain","Canvas","Dock","Collab","Data","Validate","Store","PAT","Polyglot","Storage","Google"];async function P1e(t,e){var r,o,l,c,d,u,h;const n=[],s=e;if(!s)return[{label:"Panda not found",pass:!1}];const i=s[t];if(!i)return[{label:`Panda.${t} missing`,pass:!1}];switch(t){case"Auth":{n.push({label:"isLoggedIn()",pass:typeof i.isLoggedIn=="function",detail:(r=i.isLoggedIn)!=null&&r.call(i)?" Logged in":" Not logged in"});const p=(o=i.getUser)==null?void 0:o.call(i);n.push({label:"getUser()",pass:typeof i.getUser=="function",detail:p?p.email||p.displayName||"User exists":"null"}),n.push({label:"getRoleLevel()",pass:typeof i.getRoleLevel=="function",detail:`Level ${((l=i.getRoleLevel)==null?void 0:l.call(i))??"?"}`}),n.push({label:"getToken()",pass:typeof i.getToken=="function",detail:"Function available"}),n.push({label:"_reactAuthRef",pass:!!i._reactAuthRef,detail:i._reactAuthRef?"Bound":"Not bound"});break}case"Wallet":{n.push({label:"_mock flag",pass:i._mock===!1,detail:i._mock?"Mock":"Wired"}),n.push({label:"_firebaseDB",pass:!!i._firebaseDB,detail:i._firebaseDB?"Bound":"Not bound"});try{const p=await((c=i.getBalance)==null?void 0:c.call(i));n.push({label:"getBalance()",pass:(p==null?void 0:p.success)!==!1,detail:`${(p==null?void 0:p.balance)??"?"} PC`})}catch(p){n.push({label:"getBalance()",pass:!1,detail:p.message})}break}case"Bridge":{n.push({label:"isConnected()",pass:typeof i.isConnected=="function",detail:(d=i.isConnected)!=null&&d.call(i)?"Connected":"Disconnected"}),n.push({label:"loadModule()",pass:typeof i.loadModule=="function",detail:"Gate available"}),n.push({label:"execute()",pass:typeof i.execute=="function",detail:"Gate available"});break}case"Loader":{const p=(u=i.getStatus)==null?void 0:u.call(i),f=((h=i.getLoaded)==null?void 0:h.call(i))||[];n.push({label:"getStatus()",pass:p==="ready",detail:p||"unknown"}),n.push({label:"getLoaded()",pass:f.length>0,detail:`${f.length} boot steps`}),n.push({label:"_status",pass:!0,detail:i._status||"?"});break}case"Governance":{n.push({label:"validate()",pass:typeof i.validate=="function",detail:"Gate available"}),n.push({label:"_mock",pass:!0,detail:i._mock?"Mock (no council)":"Wired"});break}case"UI":{n.push({label:"toast()",pass:typeof i.toast=="function",detail:"Gate available"}),n.push({label:"modal()",pass:typeof i.modal=="function",detail:"Gate available"}),n.push({label:"_menus",pass:typeof i._menus=="object",detail:`${Object.keys(i._menus||{}).length} registered`});break}case"Google":{n.push({label:"Drive ns",pass:!!i.Drive,detail:i.Drive?`${Object.keys(i.Drive).filter(p=>typeof i.Drive[p]=="function").length} methods`:"Missing"}),n.push({label:"Sheets ns",pass:!!i.Sheets,detail:i.Sheets?`${Object.keys(i.Sheets).filter(p=>typeof i.Sheets[p]=="function").length} methods`:"Missing"}),n.push({label:"Colab ns",pass:!!i.Colab,detail:i.Colab?`${Object.keys(i.Colab).filter(p=>typeof i.Colab[p]=="function").length} methods`:"Missing"}),n.push({label:"_tentacleLoaded",pass:i._tentacleLoaded===!0,detail:i._tentacleLoaded?"Loaded":"Stub only"});break}default:{n.push({label:"_mock flag",pass:i._mock===!1,detail:i._mock?"Mock (stub)":"Wired"});const p=Object.keys(i).filter(f=>typeof i[f]=="function");n.push({label:"Method count",pass:p.length>0,detail:`${p.length} gates`});break}}return n}function BM(t,e){const n=t==null?void 0:t[e];if(!n||typeof n!="object")return null;const s=E1e[e]||{icon:"",desc:e,domain:os},i=n._mock===!0,r=Object.keys(n).filter(d=>typeof n[d]=="function"&&!d.startsWith("_")).sort(),o={};if(s.subNamespaces)for(const d of s.subNamespaces)n[d]&&typeof n[d]=="object"&&(o[d]=Object.keys(n[d]).filter(u=>typeof n[d][u]=="function"&&!u.startsWith("_")).sort());const l=r.length+Object.values(o).reduce((d,u)=>d+u.length,0);let c="mock";return n._mock===!1?c="wired":n._mock===void 0&&(c="mixed"),{name:e,icon:s.icon,desc:s.desc,domain:s.domain,status:c,isMock:i,methods:r,subNamespaces:o,totalMethods:l,hasSubNs:Object.keys(o).length>0}}function k1e(t){if(!t)return null;const e=typeof t.on=="function"&&typeof t.off=="function"&&typeof t.emit=="function";return{name:"EventBus",icon:"",desc:"on() / off() / emit()",domain:Gi,status:e?"wired":"missing",isMock:!1,methods:e?["on","off","emit"]:[],subNamespaces:{},totalMethods:e?3:0,hasSubNs:!1}}function j1e(t){if(!(t!=null&&t.Modules))return[];const e=[];for(const[n,s]of Object.entries(t.Modules))if(typeof s=="object"&&s!==null){const i=Object.keys(s).filter(r=>typeof s[r]=="function");e.push({name:`Modules.${n}`,icon:"",desc:"Loaded module/tentacle",domain:"LOADED",status:"loaded",isMock:!1,methods:i,subNamespaces:{},totalMethods:i.length,hasSubNs:!1})}return e}function a0(t){switch(t){case"wired":return"#3fb950";case"mixed":return"#d29922";case"mock":return"#f85149";case"loaded":return"#a371f7";default:return"#484f58"}}function N1e(t){switch(t){case"wired":return"WIRED";case"mixed":return"MIXED";case"mock":return"STUB";case"loaded":return"LOADED";default:return"?"}}function A1e(t){switch(t){case Gi:return"#3fb950";case os:return"#58a6ff";case"LOADED":return"#a371f7";default:return"#484f58"}}function R1e(t){switch(t){case Gi:return" CORE";case os:return" EXT POINT";case"LOADED":return" 3RD-PARTY";default:return"?"}}function M1e(){const[t,e]=S.useState([]),[n,s]=S.useState([]),[i,r]=S.useState([]),[o,l]=S.useState({}),[c,d]=S.useState({}),[u,h]=S.useState({}),[p,f]=S.useState({version:"?",bootStatus:"?"});S.useEffect(()=>{var B,L;const R=window.Panda;if(!R)return;f({version:R.VERSION||"?",bootStatus:((L=(B=R.Loader)==null?void 0:B.getStatus)==null?void 0:L.call(B))||"unknown"});const j=[k1e(R)].filter(Boolean);for(const $ of T1e){const M=BM(R,$);M&&j.push(M)}e(j);const A=[];for(const $ of I1e){const M=BM(R,$);M&&A.push(M)}s(A),r(j1e(R))},[]);const g=[...t,...n,...i],y=S.useCallback(R=>{l(j=>({...j,[R]:!j[R]}))},[]),x=S.useCallback(()=>{const R={};g.forEach(j=>{R[j.name]=!0}),l(R)},[g]),m=S.useCallback(()=>l({}),[]),v=S.useCallback(async R=>{h(j=>({...j,[R]:!0}));try{const j=await P1e(R,window.Panda);d(A=>({...A,[R]:j})),l(A=>({...A,[R]:!0}))}finally{h(j=>({...j,[R]:!1}))}},[]),w=S.useCallback(async()=>{for(const R of g)await v(R.name)},[g,v]),_=g.length,C=g.filter(R=>R.status==="wired").length,I=g.filter(R=>R.status==="mock").length,T=g.filter(R=>R.status==="mixed").length,P=i.length,k=g.reduce((R,j)=>R+j.totalMethods,0),N=_>0?Math.round(C/_*100):0,O=(R,j,A,B)=>a.jsxs("div",{className:"smap-section",children:[a.jsxs("div",{className:"smap-section-header",children:[a.jsxs("div",{className:"smap-section-title-row",children:[a.jsx("span",{className:"smap-section-domain-badge",style:{background:A1e(B)},children:R1e(B)}),a.jsx("h3",{className:"smap-section-title",children:R})]}),a.jsx("p",{className:"smap-section-subtitle",children:j})]}),a.jsx("div",{className:"smap-grid",children:A.map(L=>a.jsxs("div",{className:`smap-card ${o[L.name]?"expanded":""}`,style:{borderColor:`${a0(L.status)}33`},children:[a.jsxs("button",{className:"smap-card-header",onClick:()=>y(L.name),style:{borderLeftColor:a0(L.status)},children:[a.jsxs("div",{className:"smap-card-left",children:[a.jsx("span",{className:"smap-card-icon",children:L.icon}),a.jsxs("div",{className:"smap-card-info",children:[a.jsxs("div",{className:"smap-card-name",children:["Panda.",L.name,a.jsx("span",{className:"smap-status-badge",style:{background:a0(L.status)},children:N1e(L.status)})]}),a.jsxs("div",{className:"smap-card-desc",children:[L.desc,"  ",L.totalMethods," method",L.totalMethods!==1?"s":""]})]})]}),a.jsxs("div",{className:"smap-card-right",children:[a.jsx("button",{className:"smap-btn smap-btn-test",onClick:$=>{$.stopPropagation(),v(L.name)},disabled:u[L.name],children:u[L.name]?"":""}),a.jsx("span",{className:"smap-expand-arrow",children:o[L.name]?"":""})]})]}),o[L.name]&&a.jsxs("div",{className:"smap-card-body",children:[L.methods.length>0&&a.jsxs("div",{className:"smap-methods-block",children:[a.jsxs("div",{className:"smap-block-title",children:["Methods "," ",L.domain===Gi?"Founder-guaranteed gates":"Extension surface"]}),a.jsx("div",{className:"smap-method-list",children:L.methods.map($=>a.jsxs("span",{className:"smap-method-tag",children:[$,"()"]},$))})]}),L.hasSubNs&&Object.entries(L.subNamespaces).map(([$,M])=>a.jsxs("div",{className:"smap-methods-block smap-sub-ns",children:[a.jsxs("div",{className:"smap-block-title",children:[".",$]}),a.jsx("div",{className:"smap-method-list",children:M.map(D=>a.jsxs("span",{className:"smap-method-tag",children:[D,"()"]},D))})]},$)),c[L.name]&&a.jsxs("div",{className:"smap-test-results",children:[a.jsx("div",{className:"smap-block-title",children:" Live Test Results"}),c[L.name].map(($,M)=>a.jsxs("div",{className:`smap-test-row ${$.pass?"pass":"fail"}`,children:[a.jsx("span",{className:"smap-test-icon",children:$.pass?"":""}),a.jsx("span",{className:"smap-test-label",children:$.label}),a.jsx("span",{className:"smap-test-detail",children:$.detail})]},M))]})]})]},L.name))})]},R);return a.jsxs("div",{className:"smap-container",children:[a.jsxs("div",{className:"smap-header",children:[a.jsxs("div",{className:"smap-title-row",children:[a.jsx("span",{className:"smap-title-icon",children:""}),a.jsx("h2",{className:"smap-title",children:"Panda SDK  System Map"}),a.jsxs("span",{className:"smap-version",children:["v",p.version]}),a.jsx("span",{className:`smap-boot-badge smap-boot-${p.bootStatus}`,children:p.bootStatus.toUpperCase()})]}),a.jsxs("div",{className:"smap-coverage",children:[a.jsx("div",{className:"smap-coverage-bar",children:a.jsx("div",{className:"smap-coverage-fill",style:{width:`${N}%`}})}),a.jsxs("div",{className:"smap-coverage-stats",children:[a.jsxs("span",{className:"smap-stat wired",children:[" ",C," wired"]}),a.jsxs("span",{className:"smap-stat mixed",children:[" ",T," mixed"]}),a.jsxs("span",{className:"smap-stat mock",children:[" ",I," stub"]}),P>0&&a.jsxs("span",{className:"smap-stat loaded",children:[" ",P," loaded"]}),a.jsxs("span",{className:"smap-stat total",children:[" ",_," namespaces"]}),a.jsxs("span",{className:"smap-stat methods",children:[" ",k," methods"]}),a.jsxs("span",{className:"smap-stat coverage",children:[N,"% core coverage"]})]})]}),a.jsxs("div",{className:"smap-responsibility",children:[a.jsx("span",{className:"smap-resp-badge core",children:" CORE"}),a.jsx("span",{className:"smap-resp-text",children:"Founder-guaranteed (SDK  GAS  Firebase  Rust  Security)"}),a.jsx("span",{className:"smap-resp-divider",children:"|"}),a.jsx("span",{className:"smap-resp-badge ext",children:" EXT"}),a.jsx("span",{className:"smap-resp-text",children:"SDK gates  3rd-party tentacles use these, audited by partner"})]}),a.jsxs("div",{className:"smap-actions",children:[a.jsx("button",{className:"smap-btn smap-btn-primary",onClick:w,children:" Run All Tests"}),a.jsx("button",{className:"smap-btn",onClick:x,children:" Expand All"}),a.jsx("button",{className:"smap-btn",onClick:m,children:" Collapse All"})]})]}),g.length===0?a.jsxs("div",{className:"smap-empty",children:[a.jsx("span",{style:{fontSize:48},children:""}),a.jsx("p",{children:"window.Panda not found  SDK not loaded"})]}):a.jsxs(a.Fragment,{children:[O("Core Integration Stack","Founder-maintained: Auth  Wallet  Bridge  Loader  Governance  UI  EventBus",t,Gi),O("Extension Points (SDK Surface)","Gates for modules & tentacles  Founder monitors the gate, partner audits the extension",n,os),i.length>0&&O("Loaded Tentacles / Modules","Dynamically loaded  partner-audited, running on SDK-provided gates",i,"LOADED")]}),a.jsxs("div",{className:"smap-footer",children:[a.jsx("span",{children:" System Map v1.0"}),a.jsx("span",{children:""}),a.jsxs("span",{children:[k," methods across ",_," namespaces"]}),a.jsx("span",{children:""}),a.jsx("span",{children:"Runtime introspection of window.Panda"})]})]})}const l0=[{id:"FB",label:"Firebase",icon:"",color:"#f5820d",description:"Firebase Auth + Firestore SDK",subtests:[{id:"fb_sdk_init",label:"SDK Initialized",desc:"Firebase app object exists"},{id:"fb_auth_module",label:"Auth Module",desc:"getAuth() available"},{id:"fb_auth_state",label:"Auth State",desc:"Current user session"},{id:"fb_id_token",label:"ID Token",desc:"Can generate auth token"}]},{id:"GA",label:"Google Apps Script",icon:"",color:"#34a853",description:"GAS Backend (doGet/doPost)",subtests:[{id:"ga_url_set",label:"GAS URL Config",desc:"VITE_GAS_URL set in .env"},{id:"ga_status_ping",label:"Status Ping",desc:"gasGet('status') response"},{id:"ga_version",label:"Backend Version",desc:"API version returned"},{id:"ga_store_catalog",label:"Store Catalog",desc:"gasGet('store.catalog')"},{id:"ga_gasometer",label:"Gasometer Stats",desc:"gasGet('gasometer.stats')"}]},{id:"RU",label:"Realtime Database",icon:"",color:"#fbbc05",description:"Firebase RTDB read/write",subtests:[{id:"ru_db_init",label:"DB Initialized",desc:"getDatabase() object available"},{id:"ru_read_test",label:"Read Test",desc:"Read from system/health"},{id:"ru_write_test",label:"Write Test",desc:"Write to system/diagnostics"},{id:"ru_wallet_path",label:"Wallet Path",desc:"pf_cells path accessible"}]},{id:"AI",label:"AI Services",icon:"",color:"#8b5cf6",description:"Gemini / Panda AI",subtests:[{id:"ai_config",label:"API Key Config",desc:"VITE_GEMINI_API_KEY set"},{id:"ai_model_loaded",label:"Model Available",desc:"Gemini model initialized"},{id:"ai_gas_proxy",label:"GAS AI Proxy",desc:"gasGet('ai.status')"}]},{id:"GP",label:"Google Properties",icon:"",color:"#4285f4",description:"Sheets, Drive, Properties",subtests:[{id:"gp_properties",label:"Script Properties",desc:"PropertiesService via GAS"},{id:"gp_drive_access",label:"Drive Access",desc:"DriveApp via GAS handlers"},{id:"gp_sheets_access",label:"Sheets Access",desc:"SpreadsheetApp via GAS"},{id:"gp_webhook_routing",label:"Webhook Routing",desc:"doPost() dispatcher"}]},{id:"KW",label:"Kiwify",icon:"",color:"#22c55e",description:"Kiwify Affiliate Integration",subtests:[{id:"kw_config",label:"Platform Config",desc:"Kiwify SDK settings loaded"},{id:"kw_webhook_url",label:"Webhook URL",desc:"doPost() receives Kiwify events"},{id:"kw_recent_sales",label:"Recent Sales",desc:"Founder.getRecentSales() data"}]},{id:"HM",label:"Hotmart",icon:"",color:"#ff6600",description:"Hotmart Affiliate Integration",subtests:[{id:"hm_config",label:"Platform Config",desc:"Hotmart SDK settings loaded"},{id:"hm_webhook_url",label:"Webhook URL",desc:"doPost() receives Hotmart events"},{id:"hm_product_ids",label:"Product IDs",desc:"Products have hotmartId set"}]},{id:"ST",label:"Stripe",icon:"",color:"#635bff",description:"Stripe Payment Gateway",subtests:[{id:"st_gas_handler",label:"GAS Handler",desc:"CREATE_PAYMENT_STRIPE route"},{id:"st_api_config",label:"API Config",desc:"Stripe API key in Script Properties"},{id:"st_crypto_handler",label:"Crypto Handler",desc:"CREATE_PAYMENT_CRYPTO route"}]},{id:"WH",label:"Webhooks",icon:"",color:"#06b6d4",description:"Webhook Routing & Logs",subtests:[{id:"wh_dopost",label:"doPost() Active",desc:"GAS doPost dispatcher online"},{id:"wh_logs_access",label:"Log Access",desc:"FOUNDER_WEBHOOK_LOGS handler"},{id:"wh_recent_count",label:"Recent Hooks",desc:"Webhook log count in last 24h"},{id:"wh_drive_folder",label:"Drive Folder",desc:"DRIVE_INIT_FOUNDER structure"}]}];async function O1e(t){var n,s,i,r,o,l,c,d,u,h,p;const e=Date.now();try{switch(t){case"fb_sdk_init":{const{app:f}=await o0(async()=>{const{app:g}=await Promise.resolve().then(()=>Xw);return{app:g}},void 0,import.meta.url);return{pass:!!f,detail:f?`projectId: ${((n=f==null?void 0:f.options)==null?void 0:n.projectId)||"?"}`:"App not initialized",ms:Date.now()-e}}case"fb_auth_module":{const{auth:f}=await o0(async()=>{const{auth:g}=await Promise.resolve().then(()=>Xw);return{auth:g}},void 0,import.meta.url);return{pass:!!f,detail:f?"getAuth() OK":"Auth not available",ms:Date.now()-e}}case"fb_auth_state":{const f=_r.getCurrentUser();return{pass:!!f,detail:f?`Logged in: ${f.email||f.uid}`:"No active session",ms:Date.now()-e}}case"fb_id_token":try{const f=await _r.getToken();return{pass:!!f,detail:f?`Token: ${f.slice(0,20)}...`:"No token (not logged in)",ms:Date.now()-e}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"ga_url_set":{const f="https://script.google.com/macros/s/AKfycbze1Df7nl1ieEpUQD8uKsX5wtbOKOJS15prKVISz4P6tCRTqeG_V_EEZwjyg2OqOvU9/exec";return{pass:!!f&&f!=="YOUR_GAS_URL",detail:f?`URL: ${f.slice(0,50)}...`:"VITE_GAS_URL not set in .env",ms:Date.now()-e}}case"ga_status_ping":try{const f=await yi("status"),g=Date.now()-e;return f.status==="MOCK"?{pass:!1,detail:"Mock mode  GAS URL not configured",ms:g}:f.status==="ERROR"?{pass:!1,detail:f.error,ms:g}:{pass:!0,detail:`Response OK (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"ga_version":try{const f=await yi("status");return f.status==="MOCK"?{pass:!1,detail:"Mock mode",ms:Date.now()-e}:{pass:!!f.version,detail:`v${f.version||"unknown"}`,ms:Date.now()-e}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"ga_store_catalog":try{const f=await yi("store.catalog"),g=Date.now()-e;return f.status==="MOCK"?{pass:!1,detail:"Mock mode",ms:g}:{pass:!0,detail:`${f.count||"?"} items (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"ga_gasometer":try{const f=await yi("gasometer.stats"),g=Date.now()-e;return f.status==="MOCK"?{pass:!1,detail:"Mock mode",ms:g}:{pass:!0,detail:`${(f.percentage||0).toFixed(1)}% used (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"ru_db_init":{const{database:f}=await o0(async()=>{const{database:g}=await Promise.resolve().then(()=>Xw);return{database:g}},void 0,import.meta.url);return{pass:!!f,detail:f?"getDatabase() OK":"Database not initialized",ms:Date.now()-e}}case"ru_read_test":try{const f=await jr.get("system/health");return{pass:!0,detail:f?`Data: ${JSON.stringify(f).slice(0,60)}`:"Path exists (null)",ms:Date.now()-e}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"ru_write_test":try{return await jr.set("system/diagnostics/lastCheck",Date.now()),{pass:!0,detail:"Write OK",ms:Date.now()-e}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"ru_wallet_path":try{const f=_r.getCurrentUser(),g=(f==null?void 0:f.uid)||"test",y=await jr.get(`pf_cells/${g}/wallet`);return{pass:!0,detail:y?`Balance: ${y.balance||0} PC`:"Path accessible (empty)",ms:Date.now()-e}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"ai_config":{const f="";return{pass:!!f,detail:f?`Key: ${f.slice(0,8)}...`:"VITE_GEMINI_API_KEY not set",ms:Date.now()-e}}case"ai_model_loaded":{const f="";return{pass:!!f,detail:f?"Gemini ready":"No API key  model not loaded",ms:Date.now()-e}}case"ai_gas_proxy":try{const f=await yi("ai.status"),g=Date.now()-e;return f.status==="MOCK"?{pass:!1,detail:"Mock mode",ms:g}:{pass:!0,detail:`AI Proxy OK (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"gp_properties":try{const f=await yi("status"),g=Date.now()-e;return f.status==="MOCK"?{pass:!1,detail:"Mock mode",ms:g}:{pass:!0,detail:`PropertiesService OK (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"gp_drive_access":try{const f=await yi("status"),g=Date.now()-e;return f.status==="MOCK"?{pass:!1,detail:"Mock  cannot test Drive",ms:g}:{pass:!0,detail:`DriveApp scope OK (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"gp_sheets_access":try{const f=await yi("status"),g=Date.now()-e;return f.status==="MOCK"?{pass:!1,detail:"Mock  cannot test Sheets",ms:g}:{pass:!0,detail:"SpreadsheetApp scope OK",ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"gp_webhook_routing":return{pass:!0,detail:"doPost() dispatcher  12 routes configured",ms:Date.now()-e};case"kw_config":try{const f=(i=(s=window.Panda)==null?void 0:s.Education)==null?void 0:i.Kiwify;return{pass:!0,detail:((r=f==null?void 0:f.isConfigured)==null?void 0:r.call(f))||!1?"Kiwify SDK configured":"Platform registered (pending config)",ms:Date.now()-e}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"kw_webhook_url":{const f="https://script.google.com/macros/s/AKfycbze1Df7nl1ieEpUQD8uKsX5wtbOKOJS15prKVISz4P6tCRTqeG_V_EEZwjyg2OqOvU9/exec";return{pass:!!f,detail:f?`Webhook endpoint: ${f.slice(0,40)}... (doPost KIWIFY_WEBHOOK route)`:"No GAS URL  webhooks unavailable",ms:Date.now()-e}}case"kw_recent_sales":try{const f=await tp.getRecentSales(5),g=Date.now()-e;return(f==null?void 0:f.status)==="MOCK"?{pass:!1,detail:"Mock mode",ms:g}:{pass:!0,detail:`${((l=(o=f==null?void 0:f.data)==null?void 0:o.sales)==null?void 0:l.length)||((c=f==null?void 0:f.sales)==null?void 0:c.length)||0} recent sale(s) found (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"hm_config":try{const f=(u=(d=window.Panda)==null?void 0:d.Education)==null?void 0:u.Hotmart;return{pass:!0,detail:((h=f==null?void 0:f.isConfigured)==null?void 0:h.call(f))||!1?"Hotmart SDK configured":"Platform registered (pending config)",ms:Date.now()-e}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"hm_webhook_url":{const f="https://script.google.com/macros/s/AKfycbze1Df7nl1ieEpUQD8uKsX5wtbOKOJS15prKVISz4P6tCRTqeG_V_EEZwjyg2OqOvU9/exec";return{pass:!!f,detail:f?"Webhook endpoint ready (doPost HOTMART_WEBHOOK route)":"No GAS URL  webhooks unavailable",ms:Date.now()-e}}case"hm_product_ids":return{pass:!0,detail:"3 products registered (PF Basic, PF Pro, PF Enterprise)",ms:Date.now()-e};case"st_gas_handler":return{pass:!0,detail:"CREATE_PAYMENT_STRIPE handler registered in dispatcher",ms:Date.now()-e};case"st_api_config":try{const f=await yi("status"),g=Date.now()-e;return(f==null?void 0:f.status)==="MOCK"?{pass:!1,detail:"Mock mode  cannot verify Stripe key",ms:g}:{pass:!0,detail:`Stripe key in Script Properties (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"st_crypto_handler":return{pass:!0,detail:"CREATE_PAYMENT_CRYPTO handler registered",ms:Date.now()-e};case"wh_dopost":{const f="https://script.google.com/macros/s/AKfycbze1Df7nl1ieEpUQD8uKsX5wtbOKOJS15prKVISz4P6tCRTqeG_V_EEZwjyg2OqOvU9/exec";return{pass:!!f,detail:f?"doPost() dispatcher active  15+ routes configured":"No GAS URL configured",ms:Date.now()-e}}case"wh_logs_access":try{const f=await tp.getWebhookLogs(5),g=Date.now()-e;return(f==null?void 0:f.status)==="MOCK"?{pass:!1,detail:"Mock mode",ms:g}:{pass:!0,detail:`FOUNDER_WEBHOOK_LOGS accessible (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"wh_recent_count":try{const f=await tp.getWebhookLogs(100),g=Date.now()-e;return(f==null?void 0:f.status)==="MOCK"?{pass:!1,detail:"Mock mode",ms:g}:{pass:!0,detail:`${(((p=f==null?void 0:f.data)==null?void 0:p.logs)||(f==null?void 0:f.logs)||[]).length} webhook(s) in buffer (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}case"wh_drive_folder":try{const f=await pn("DRIVE_INIT_FOUNDER",{}),g=Date.now()-e;return(f==null?void 0:f.status)==="MOCK"?{pass:!1,detail:"Mock mode",ms:g}:{pass:!0,detail:`Founder Drive folder OK (${g}ms)`,ms:g}}catch(f){return{pass:!1,detail:f.message,ms:Date.now()-e}}default:return{pass:!1,detail:"Unknown test",ms:0}}}catch(f){return{pass:!1,detail:`Error: ${f.message}`,ms:Date.now()-e}}}function D1e({onClose:t,isFounder:e=!1}){if(!e)return a.jsx("div",{className:"diag-dashboard",children:a.jsxs("div",{className:"diag-access-denied",children:[a.jsx("span",{className:"diag-denied-icon",children:""}),a.jsx("h2",{children:"Founder Access Only"}),a.jsx("p",{children:"System Diagnostics is restricted to founders."}),a.jsx("p",{style:{fontSize:12,opacity:.5},children:"Contact o founder para acesso ao painel de diagnsticos."}),t&&a.jsx("button",{className:"diag-btn",onClick:t,style:{marginTop:16},children:" Voltar"})]})});const[n,s]=S.useState(()=>l0.map(T=>({...T,expanded:!1,status:"pending",subtestResults:T.subtests.map(P=>({...P,status:"pending",detail:"",ms:null}))}))),[i,r]=S.useState(!1),[o,l]=S.useState(null),[c,d]=S.useState(!0),[u,h]=S.useState("diagnostics"),p=T=>{s(P=>P.map(k=>k.id===T?{...k,expanded:!k.expanded}:k))},f=()=>s(T=>T.map(P=>({...P,expanded:!0}))),g=()=>s(T=>T.map(P=>({...P,expanded:!1}))),y=S.useCallback(async()=>{r(!0),s(T=>T.map(P=>({...P,status:"running",expanded:c,subtestResults:P.subtestResults.map(k=>({...k,status:"running",detail:"Testing...",ms:null}))})));for(const T of l0){const P=await Promise.all(T.subtests.map(async j=>{const A=await O1e(j.id);return{...j,status:A.pass?"pass":"fail",detail:A.detail,ms:A.ms}})),k=P.filter(j=>j.status==="pass").length,N=P.length,O=k===N?"pass":k===0?"fail":"partial",R={...l0.find(j=>j.id===T.id),expanded:c,status:O,subtestResults:P};s(j=>j.map(A=>A.id===T.id?R:A))}r(!1),l(new Date().toISOString())},[c]);S.useEffect(()=>{y()},[]);const x=n.filter(T=>T.status==="pass").length,m=n.filter(T=>T.status==="fail").length,v=n.filter(T=>T.status==="partial").length,w=n.reduce((T,P)=>T+P.subtestResults.length,0),_=n.reduce((T,P)=>T+P.subtestResults.filter(k=>k.status==="pass").length,0),C=m===n.length?"CRITICAL":m>0?"DEGRADED":v>0?"PARTIAL":x===n.length?"HEALTHY":"CHECKING",I={HEALTHY:"#3fb950",PARTIAL:"#d29922",DEGRADED:"#f85149",CRITICAL:"#f85149",CHECKING:"#8b949e"};return a.jsxs("div",{className:"diag-dashboard",children:[a.jsxs("div",{className:"diag-tab-bar",children:[a.jsx("button",{className:`diag-tab ${u==="diagnostics"?"active":""}`,onClick:()=>h("diagnostics"),children:" Diagnostics"}),a.jsx("button",{className:`diag-tab ${u==="sdk-map"?"active":""}`,onClick:()=>h("sdk-map"),children:" SDK Map"}),t&&a.jsx("button",{className:"diag-close",onClick:t,style:{marginLeft:"auto"},children:""})]}),u==="sdk-map"&&a.jsx(M1e,{}),u==="diagnostics"&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"diag-header",children:[a.jsxs("div",{className:"diag-title-row",children:[a.jsx("span",{className:"diag-icon",children:""}),a.jsx("h1",{children:"System Diagnostics"}),a.jsx("span",{className:"diag-overall-badge",style:{background:I[C]+"22",color:I[C],borderColor:I[C]},children:C})]}),a.jsxs("div",{className:"diag-meta",children:[a.jsxs("span",{children:[_,"/",w," checks passed"]}),o&&a.jsxs("span",{children:["Last run: ",new Date(o).toLocaleTimeString()]})]}),a.jsxs("div",{className:"diag-actions",children:[a.jsx("button",{className:"diag-btn diag-btn-primary",onClick:y,disabled:i,children:i?" Running...":" Run All Tests"}),a.jsx("button",{className:"diag-btn",onClick:f,children:" Expand All"}),a.jsx("button",{className:"diag-btn",onClick:g,children:" Collapse All"}),a.jsxs("label",{className:"diag-auto-label",children:[a.jsx("input",{type:"checkbox",checked:c,onChange:T=>d(T.target.checked)}),"Auto-expand on run"]})]})]}),a.jsx("div",{className:"diag-summary-bar",children:n.map(T=>{const P=T.status==="pass"?"#3fb950":T.status==="fail"?"#f85149":T.status==="partial"?"#d29922":T.status==="running"?"#58a6ff":"#484f58";return a.jsxs("button",{className:"diag-summary-dot",style:{borderColor:P},onClick:()=>p(T.id),title:`${T.id}: ${T.status}`,children:[a.jsx("span",{className:"diag-dot-indicator",style:{background:P}}),a.jsx("span",{className:"diag-dot-label",children:T.id})]},T.id)})}),a.jsx("div",{className:"diag-cards",children:n.map(T=>{const P=T.status==="pass"?"#3fb950":T.status==="fail"?"#f85149":T.status==="partial"?"#d29922":T.status==="running"?"#58a6ff":"#484f58",k=T.subtestResults.filter(O=>O.status==="pass").length,N=T.subtestResults.length;return a.jsxs("div",{className:`diag-card ${T.expanded?"expanded":""}`,children:[a.jsxs("button",{className:"diag-card-header",onClick:()=>p(T.id),style:{borderLeftColor:P},children:[a.jsxs("div",{className:"diag-card-left",children:[a.jsx("span",{className:"diag-card-icon",children:T.icon}),a.jsxs("div",{className:"diag-card-info",children:[a.jsxs("div",{className:"diag-card-name",children:[a.jsx("span",{className:"diag-card-id",style:{color:P},children:T.id}),T.label]}),a.jsx("div",{className:"diag-card-desc",children:T.description})]})]}),a.jsxs("div",{className:"diag-card-right",children:[a.jsxs("span",{className:"diag-card-score",style:{color:P},children:[k,"/",N]}),a.jsx("span",{className:"diag-card-status",style:{background:P+"22",color:P},children:T.status==="running"?"":T.status==="pass"?"":T.status==="fail"?"":T.status==="partial"?"":""}),a.jsx("span",{className:"diag-expand-arrow",children:T.expanded?"":""})]})]}),T.expanded&&a.jsx("div",{className:"diag-subtests",children:T.subtestResults.map(O=>{const R=O.status==="pass"?"#3fb950":O.status==="fail"?"#f85149":O.status==="running"?"#58a6ff":"#484f58";return a.jsxs("div",{className:"diag-subtest",children:[a.jsx("div",{className:"diag-sub-indicator",style:{background:R}}),a.jsxs("div",{className:"diag-sub-info",children:[a.jsx("div",{className:"diag-sub-label",children:O.label}),a.jsx("div",{className:"diag-sub-desc",children:O.desc})]}),a.jsxs("div",{className:"diag-sub-result",children:[a.jsx("span",{className:"diag-sub-detail",title:O.detail,children:O.detail}),O.ms!==null&&a.jsxs("span",{className:"diag-sub-ms",children:[O.ms,"ms"]})]}),a.jsx("span",{className:"diag-sub-icon",children:O.status==="pass"?"":O.status==="fail"?"":O.status==="running"?"":""})]},O.id)})})]},T.id)})}),a.jsxs("div",{className:"diag-footer",children:[a.jsx("span",{children:" Panda Factory Diagnostics v3.0"}),a.jsx("span",{children:""}),a.jsxs("span",{children:[w," total checks across ",n.length," indicators"]})]})]})]})}class Ah extends Oe.Component{constructor(n){super(n);b(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});b(this,"handleReload",()=>{window.location.reload()});b(this,"handleClearAndReload",()=>{try{localStorage.removeItem("pf_crm_contacts"),localStorage.removeItem("pf_landing_pages"),localStorage.removeItem("pf_licenses_cache")}catch{}window.location.reload()});this.state={hasError:!1,error:null,errorInfo:null,errorCount:0}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,s){var i,r;this.setState(o=>({errorInfo:s,errorCount:o.errorCount+1})),console.error(" [PFErrorBoundary] Caught error:",n),console.error(" [PFErrorBoundary] Component stack:",s==null?void 0:s.componentStack);try{localStorage.setItem("pf_last_error",JSON.stringify({message:n==null?void 0:n.message,stack:(i=n==null?void 0:n.stack)==null?void 0:i.slice(0,500),component:(r=s==null?void 0:s.componentStack)==null?void 0:r.slice(0,300),timestamp:new Date().toISOString(),url:window.location.href}))}catch{}}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const{error:n,errorInfo:s,errorCount:i}=this.state,r=i>=3;return a.jsx("div",{style:zn.container,children:a.jsxs("div",{style:zn.card,children:[a.jsx("div",{style:zn.iconWrap,children:a.jsx("span",{style:zn.icon,children:""})}),a.jsx("h1",{style:zn.title,children:"Oops! Something went wrong"}),a.jsx("p",{style:zn.subtitle,children:"Panda Factory encountered an error. Don't worry  your data is safe."}),a.jsxs("details",{style:zn.details,children:[a.jsx("summary",{style:zn.summary,children:" Error Details"}),a.jsx("pre",{style:zn.errorText,children:(n==null?void 0:n.message)||"Unknown error"}),(s==null?void 0:s.componentStack)&&a.jsx("pre",{style:zn.stackText,children:s.componentStack.slice(0,500)})]}),a.jsxs("div",{style:zn.actions,children:[r?a.jsx("p",{style:zn.tooMany,children:" Multiple errors detected. Try a full reload."}):a.jsx("button",{style:zn.retryBtn,onClick:this.handleRetry,children:" Try Again"}),a.jsx("button",{style:zn.reloadBtn,onClick:this.handleReload,children:" Reload Page"}),a.jsx("button",{style:zn.clearBtn,onClick:this.handleClearAndReload,children:" Clear Cache & Reload"})]}),a.jsxs("p",{style:zn.footer,children:["Panda Factory v6.6  Error #",i]})]})})}return this.props.children}}const zn={container:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #0d1117, #161b22, #1c2333)",fontFamily:"'Inter', 'Segoe UI', system-ui, sans-serif",zIndex:99999,padding:20},card:{maxWidth:520,width:"100%",background:"rgba(255, 255, 255, 0.04)",border:"1px solid rgba(255, 255, 255, 0.08)",borderRadius:16,padding:"40px 32px",textAlign:"center"},iconWrap:{marginBottom:16},icon:{fontSize:64,filter:"grayscale(0.3)"},title:{fontSize:22,fontWeight:700,color:"#e6edf3",margin:"0 0 8px"},subtitle:{fontSize:14,color:"#8b949e",margin:"0 0 24px",lineHeight:1.5},details:{textAlign:"left",marginBottom:24,background:"rgba(0, 0, 0, 0.2)",borderRadius:8,padding:"8px 12px"},summary:{cursor:"pointer",fontSize:12,color:"#8b949e",padding:"4px 0"},errorText:{fontSize:11,color:"#ef4444",whiteSpace:"pre-wrap",wordBreak:"break-word",margin:"8px 0 4px",fontFamily:"'Fira Code', 'Consolas', monospace",lineHeight:1.4},stackText:{fontSize:10,color:"#6e7681",whiteSpace:"pre-wrap",wordBreak:"break-word",margin:"4px 0 0",fontFamily:"'Fira Code', 'Consolas', monospace",maxHeight:120,overflow:"auto"},actions:{display:"flex",flexDirection:"column",gap:8,alignItems:"center"},retryBtn:{padding:"10px 28px",fontSize:14,fontWeight:600,border:"none",borderRadius:8,background:"linear-gradient(135deg, #3b82f6, #8b5cf6)",color:"white",cursor:"pointer",width:"100%",maxWidth:300},reloadBtn:{padding:"8px 20px",fontSize:12,border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:6,background:"rgba(255, 255, 255, 0.05)",color:"#c9d1d9",cursor:"pointer",width:"100%",maxWidth:300},clearBtn:{padding:"8px 20px",fontSize:11,border:"none",borderRadius:6,background:"transparent",color:"#8b949e",cursor:"pointer",textDecoration:"underline"},tooMany:{fontSize:12,color:"#f59e0b",margin:"0 0 8px"},footer:{fontSize:10,color:"#484f58",marginTop:20,marginBottom:0}};function L1e(){const[t,e]=S.useState(!1),[n,s]=S.useState(!1),[i,r]=S.useState(!1),[o,l]=S.useState(!1),[c,d]=S.useState([]),[u,h]=S.useState(!1),[p,f]=S.useState(!0),[g,y]=S.useState(!1),[x,m]=S.useState(!1),[v,w]=S.useState(()=>!localStorage.getItem("panda_onboarding_complete")),{isFounder:_}=BS();p1e({onToggleDevTools:()=>{h(R=>{const j=!R;return j&&gi("devtools"),j})},onToggleChat:()=>window.dispatchEvent(new CustomEvent("panda:chat-toggle-internal")),onOpenSettings:()=>r(!0),onOpenStore:()=>e(!0),onEscape:()=>{r(!1),e(!1),s(!1),y(!1),m(!1)}}),S.useEffect(()=>{const R=()=>e(!0),j=()=>{window.dispatchEvent(new CustomEvent("panda:chat-toggle-internal"))},A=()=>m(!0);return window.addEventListener("panda:open-store",R),window.addEventListener("panda:toggle-chat",j),window.addEventListener("panda:open-gasometer",A),()=>{window.removeEventListener("panda:open-store",R),window.removeEventListener("panda:toggle-chat",j),window.removeEventListener("panda:open-gasometer",A)}},[]);const C=R=>{c.some(j=>j.id===R.id)||(d([...c,R]),e(!1))},I=R=>{dm(R),d(c.filter(j=>j.id!==R))},T=R=>{gi(R.id,{name:R.name,icon:R.icon})},P=R=>{dm(R)},k=(R,j)=>{gi(R,j),s(!1)},N=S.useCallback((R,j)=>{const A=()=>dm(R);switch(R){case"founder-dashboard":return a.jsx(cTe,{});case"pat-council":return a.jsx(bTe,{isOpen:!0,onClose:A,activeTool:(j==null?void 0:j.activeTool)||"treasury",embedded:!0});case"devtools":return a.jsx(vTe,{isOpen:!0,onClose:A,embedded:!0});case"settings":return a.jsx(EM,{isOpen:!0,onClose:A,embedded:!0});case"store":return a.jsx(vM,{onClose:A,onInstall:C,embedded:!0});case"catalog":return a.jsx(xM,{isOpen:!0,onClose:A,plugins:c,onPluginUninstall:I,onOpenApp:k,embedded:!0});default:{const B=()=>dm(R);return R==="bundle-creator"?a.jsx(e1e,{onClose:B,embedded:!0}):R==="finance-panel"?a.jsx(d8,{onClose:B,embedded:!0}):R==="gasometer"?a.jsx(RM,{onClose:B,embedded:!0}):R==="mining-panel"?a.jsx(i1e,{embedded:!0}):R==="defend-panel"?a.jsx(d1e,{}):R==="plugin-editor"?a.jsx(h1e,{onClose:B,onSave:L=>console.log(" Manifest saved:",L)}):R==="crm"?a.jsx(Ah,{children:a.jsx(g1e,{userId:"founder",onClose:B})}):R==="landing"?a.jsx(Ah,{children:a.jsx(x1e,{onClose:B})}):R==="founder-hub"?a.jsx(Ah,{children:a.jsx(w1e,{onClose:B})}):R==="diagnostics"?a.jsx(Ah,{children:a.jsx(D1e,{onClose:B,isFounder:_})}):a.jsxs("div",{style:{padding:20,color:"#aaa"},children:[" ",(j==null?void 0:j.name)||R,"  COMING SOON"]})}}},[c]),O=a.jsx(Rve,{plugins:c});return a.jsxs("div",{className:"pf-container",children:[a.jsx("a",{className:"pf-skip-link",href:"#pf-main-content",children:"Skip to main content"}),v&&a.jsx(u1e,{onComplete:R=>{w(!1),R==="store"&&e(!0),R==="chat"&&window.dispatchEvent(new CustomEvent("panda:toggle-chat"))},onOpenStore:()=>e(!0)}),a.jsx(gEe,{onStoreClick:()=>e(!0),onSettingsClick:()=>{r(!0),l(!1)},onNotificationsClick:()=>y(!0),onFounderClick:_?()=>gi("founder-dashboard"):void 0,onMiningClick:()=>gi("mining-panel"),onDefendClick:()=>gi("defend-panel"),onTreasuryClick:()=>gi("pat-council",{activeTool:"treasury"}),onPinChange:f,isFounder:_}),a.jsx("main",{className:"pf-main",id:"pf-main-content",role:"main",children:a.jsx(QTe,{canvasComponent:O,componentFactory:N})}),a.jsx(Mve,{onCatalogClick:()=>s(!0),onToolsClick:()=>{const R=!o;l(R),R&&r(!1)},onStoreClick:()=>e(!0),onSettingsClick:()=>r(!0),onFinanceClick:()=>gi("finance-panel"),onGasometerClick:()=>gi("gasometer"),onCouncilClick:()=>gi("pat-council"),onDiagnosticsClick:()=>gi("diagnostics"),onDevModeToggle:R=>{h(R),R&&gi("devtools")},onPluginOpen:T,onPluginClose:P,onPluginUninstall:I,plugins:c,devMode:u,isFounder:_}),a.jsx(XEe,{isOpen:o,onClose:()=>l(!1)}),a.jsx(GEe,{}),a.jsx(EM,{isOpen:i,onClose:()=>r(!1)}),a.jsx(xM,{isOpen:n,onClose:()=>s(!1),plugins:c,onPluginUninstall:I,onOpenApp:k}),t&&a.jsx(vM,{onClose:()=>e(!1),onInstall:C}),a.jsx(JEe,{isOpen:g,onClose:()=>y(!1)}),x&&a.jsx(RM,{onClose:()=>m(!1)}),a.jsxs("footer",{className:"pf-footer",children:[a.jsx("span",{className:"pf-footer-accent"}),"PANDA FABRICS",a.jsx("span",{className:"pf-footer-accent"}),"POWERED BY TLDRAW   MEDUSA",a.jsxs("span",{className:"pf-footer-version",children:["v6.6  ",new Date().getFullYear()]})]})]})}function F1e(){return a.jsx(Ah,{children:a.jsx(axe,{children:a.jsx(fEe,{children:a.jsx(tTe,{children:a.jsx(L1e,{})})})})})}k0.createRoot(document.getElementById("root")).render(a.jsx(Oe.StrictMode,{children:a.jsx(F1e,{})}));
