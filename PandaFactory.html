<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panda Fabrics ðŸ¼</title>
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#667eea" />
    <link rel="icon" type="image/png" href="10.assets/icons/icon-192x192.png" />
    <link rel="apple-touch-icon" href="10.assets/icons/icon-192x192.png" />
    <link rel="stylesheet" href="10.assets/css/pf.theme.css?v=3.1" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="2.system/sdk/repository.js?v=sys_v1"></script>
    <script src="2.system/sdk/api.js?v=sys_v1"></script>
    <script src="2.system/core/kernel.js?v=sys_v1"></script>
    <script src="3.sdk/pf.sdk.js?v=0.8"></script>
    <script src="3.sdk/pf.app-init.js?v=1.1" defer></script>
    <script src="4.ui/pf.omnibar.js?v=2.0" defer></script>
    <script src="4.ui/pf.modal-pin.js?v=1.0" defer></script>
    <script src="4.ui/pf.settings.js?v=1.0" defer></script>
    <script src="4.ui/pf.dock-drag.js?v=1.0" defer></script>
    <script src="4.ui/pf.devtools.js?v=1.0" defer></script>
    <script src="3.sdk/pf.ai-core.js?v=1.0" defer></script>
    <script src="3.sdk/pf.firebase-bridge.js?v=1.0" defer></script>
  </head>
  <body>
    <div id="panda-loading" class="panda-loading-screen">
      <img src="10.assets/panda_logo.jpg" alt="Panda" class="panda-loading-logo" />
    </div>
    <div class="container">
      <!-- â•â•â• INLINE: HEADER STATUS â•â•â• -->
      <div id="header-container"><!-- ============================================= -->
<!-- HEADER STATUS v4.1 (pf- prefix standard)    -->
<!-- Health Score + Arc Energy + Status Pills    -->
<!-- ============================================= -->
<style>
  /* Header Base */
  .pf-header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 56px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    z-index: 2000;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-bottom: 1px solid rgba(102, 126, 234, 0.1);
  }

  .dark-mode .pf-header {
    background: rgba(15, 15, 20, 0.9);
    border-bottom-color: rgba(102, 126, 234, 0.15);
  }

  /* Brand */
  .pf-header-brand {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .pf-header-brand h1 {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 0;
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary, #1a1a2e);
  }

  .dark-mode .pf-header-brand h1 {
    color: #fff;
  }

  .pf-header-brand .pf-logo-icon {
    width: 32px;
    height: 32px;
    border-radius: 8px;
  }

  .pf-version-badge {
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 4px;
    background: rgba(102, 126, 234, 0.15);
    color: #667eea;
    font-weight: 600;
  }

  /* Status Monitor Bar */
  .pf-status-bar {
    display: flex;
    gap: 8px;
    padding: 6px 12px;
    background: rgba(102, 126, 234, 0.06);
    border-radius: 20px;
  }

  .pf-status-pill {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .pf-status-pill:hover {
    background: rgba(102, 126, 234, 0.1);
  }

  .pf-status-label {
    font-size: 10px;
    font-weight: 600;
    color: var(--text-secondary, #64748b);
    text-transform: uppercase;
  }

  .pf-status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
  }

  .pf-status-dot.online {
    background: #10b981;
    box-shadow: 0 0 6px #10b981;
  }
  .pf-status-dot.warning {
    background: #f59e0b;
    box-shadow: 0 0 6px #f59e0b;
  }
  .pf-status-dot.offline {
    background: #ef4444;
    box-shadow: 0 0 6px #ef4444;
  }

  /* Arc Energy Bar */
  .pf-arc-energy {
    position: relative;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
  }

  .pf-arc-energy svg {
    position: absolute;
    transform: rotate(-90deg);
  }

  .pf-arc-energy-bg {
    fill: none;
    stroke: rgba(102, 126, 234, 0.15);
    stroke-width: 3;
  }

  .pf-arc-energy-fill {
    fill: none;
    stroke: url(#energyGradient);
    stroke-width: 3;
    stroke-linecap: round;
    transition: stroke-dashoffset 0.5s ease;
  }

  .pf-arc-energy-text {
    font-size: 11px;
    font-weight: 700;
    color: var(--text-primary, #1a1a2e);
  }

  .dark-mode .pf-arc-energy-text {
    color: #fff;
  }

  /* Treasury Widget */
  .pf-treasury-widget {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: rgba(16, 185, 129, 0.1);
  }

  .pf-treasury-widget:hover {
    background: rgba(16, 185, 129, 0.2);
  }

  .pf-treasury-icon {
    font-size: 16px;
  }

  .pf-treasury-score {
    font-size: 13px;
    font-weight: 700;
    color: #10b981;
  }

  /* Header Controls */
  .pf-header-controls {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .pf-header-btn {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    border: none;
    background: rgba(102, 126, 234, 0.08);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    transition: all 0.2s ease;
  }

  .pf-header-btn:hover {
    background: rgba(102, 126, 234, 0.15);
    transform: scale(1.05);
  }

  .pf-header-user {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 12px;
    border-radius: 20px;
    background: rgba(102, 126, 234, 0.06);
  }

  .pf-header-user-name {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary, #1a1a2e);
  }

  .dark-mode .pf-header-user-name {
    color: #fff;
  }

  .pf-header-time {
    font-size: 12px;
    color: var(--text-secondary, #64748b);
    font-family: monospace;
  }

  .pf-header-logout {
    padding: 6px 12px;
    border-radius: 8px;
    border: none;
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .pf-header-logout:hover {
    background: rgba(239, 68, 68, 0.2);
  }
</style>

<div class="pf-header">
  <!-- LEFT: Brand -->
  <div class="pf-header-brand">
    <h1>
      <img
        src="assets/panda_logo.jpg"
        alt="🐼"
        class="pf-logo-icon"
        onerror="this.outerHTML = '🐼'"
      />
      <span>Panda Fabrics</span>
    </h1>
    <span class="pf-version-badge">v5.0</span>
  </div>

  <!-- CENTER: Status Pills -->
  <div class="pf-status-bar">
    <div
      class="pf-status-pill"
      title="Firebase Realtime"
      onclick="PandaStatus.showDetails('firebase')"
    >
      <span class="pf-status-label">FB</span>
      <div class="pf-status-dot" id="statusFirebase"></div>
    </div>
    <div
      class="pf-status-pill"
      title="Google Apps Script"
      onclick="PandaStatus.showDetails('gas')"
    >
      <span class="pf-status-label">GA</span>
      <div class="pf-status-dot" id="statusGAS"></div>
    </div>
    <div
      class="pf-status-pill"
      title="Rust Agent"
      onclick="PandaStatus.showDetails('rust')"
    >
      <span class="pf-status-label">RU</span>
      <div class="pf-status-dot" id="statusRust"></div>
    </div>
    <div
      class="pf-status-pill"
      title="AI (Gemini)"
      onclick="PandaStatus.showDetails('ai')"
    >
      <span class="pf-status-label">AI</span>
      <div class="pf-status-dot" id="statusAI"></div>
    </div>
    <div
      class="pf-status-pill"
      title="Local GPU"
      onclick="PandaStatus.showDetails('gpu')"
    >
      <span class="pf-status-label">GP</span>
      <div class="pf-status-dot" id="statusGPU"></div>
    </div>
  </div>

  <!-- RIGHT: Controls -->
  <div class="pf-header-controls">
    <!-- Arc Energy Bar -->
    <div
      class="pf-arc-energy"
      title="Panda Coins Balance"
      onclick="PandaSettings.showSection('wallet')"
    >
      <svg width="48" height="48" viewBox="0 0 48 48">
        <defs>
          <linearGradient id="energyGradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color: #10b981" />
            <stop offset="50%" style="stop-color: #f59e0b" />
            <stop offset="100%" style="stop-color: #ef4444" />
          </linearGradient>
        </defs>
        <circle class="pf-arc-energy-bg" cx="24" cy="24" r="20" />
        <circle
          class="pf-arc-energy-fill"
          id="energyArc"
          cx="24"
          cy="24"
          r="20"
          stroke-dasharray="125.6"
          stroke-dashoffset="12.56"
        />
      </svg>
      <span class="pf-arc-energy-text" id="energyPercent">90%</span>
    </div>

    <!-- Treasury Health Score -->
    <div
      class="pf-treasury-widget"
      onclick="PandaTreasury.open()"
      title="Treasury Health Score"
    >
      <span class="pf-treasury-icon">🏦</span>
      <span class="pf-treasury-score" id="healthScore">92%</span>
    </div>

    <!-- Settings -->
    <button
      class="pf-header-btn"
      onclick="PandaSettings.open()"
      title="Settings"
    >
      ⚙️
    </button>

    <!-- User Info -->
    <div class="pf-header-user">
      <span class="pf-header-user-name" id="headerUserName">👤 Admin</span>
      <span class="pf-header-time" id="headerClock">15:51</span>
    </div>

    <!-- Logout -->
    <button class="pf-header-logout" onclick="fazerLogout()" title="Sair">
      🚪 Sair
    </button>
  </div>
</div>

<script>
  /**
   * PandaStatus Controller v4.1
   */
  window.PandaStatus = {
    statuses: {
      firebase: "online",
      gas: "warning",
      rust: "online",
      ai: "online",
      gpu: "offline",
    },

    init() {
      this.updateAll();
      this.startClock();
      // Poll status every 30s
      setInterval(() => this.checkStatus(), 30000);
    },

    updateAll() {
      Object.entries(this.statuses).forEach(([key, status]) => {
        const el = document.getElementById(
          "status" + key.charAt(0).toUpperCase() + key.slice(1),
        );
        if (el) {
          el.className = "pf-status-dot " + status;
        }
      });
    },

    async checkStatus() {
      // Check Firebase
      if (typeof firebase !== "undefined") {
        this.statuses.firebase = "online";
      }

      // Check Rust Agent
      if (typeof Panda !== "undefined" && Panda.Bridge) {
        try {
          await Panda.Bridge.ping();
          this.statuses.rust = "online";
        } catch {
          this.statuses.rust = "offline";
        }
      }

      // Check GPU
      if (typeof Panda !== "undefined" && Panda.GPU) {
        this.statuses.gpu = Panda.GPU.isAvailable() ? "online" : "offline";
      }

      this.updateAll();
    },

    showDetails(service) {
      const messages = {
        firebase: "Firebase Realtime: Sincronização de comandos",
        gas: "Google Apps Script: Backend serverless",
        rust: "Rust Agent: Processamento local",
        ai: "AI (Gemini): Assistente inteligente",
        gpu: "GPU Local: Aceleração de hardware",
      };
      Panda?.UI?.toast?.(messages[service], "info");
    },

    startClock() {
      const updateClock = () => {
        const now = new Date();
        const time = now.toLocaleTimeString("pt-BR", {
          hour: "2-digit",
          minute: "2-digit",
        });
        const el = document.getElementById("headerClock");
        if (el) el.textContent = time;
      };
      updateClock();
      setInterval(updateClock, 1000);
    },
  };

  /**
   * Arc Energy Controller
   */
  window.updateEnergy = function (percent) {
    const arc = document.getElementById("energyArc");
    const text = document.getElementById("energyPercent");
    if (arc && text) {
      const circumference = 125.6; // 2 * PI * 20
      const offset = circumference - (percent / 100) * circumference;
      arc.style.strokeDashoffset = offset;
      text.textContent = percent + "%";
    }
  };

  /**
   * Conecta Header com o SDK
   */
  async function syncWithSDK() {
    if (typeof Panda === "undefined") return;

    // 1. Atualiza Arc Energy com saldo da wallet
    try {
      const balance = await Panda.Wallet.getBalance();
      // Mapeia saldo para percentual (0-1000 PC = 0-100%)
      const percent = Math.min(100, Math.round((balance.coins / 1000) * 100));
      updateEnergy(percent);
    } catch (e) {
      console.warn("Wallet fetch failed:", e);
    }

    // 2. Atualiza status do Rust Agent
    if (Panda.Bridge) {
      const connected = Panda.Bridge.isConnected();
      const rustDot = document.getElementById("statusRust");
      if (rustDot) {
        rustDot.classList.toggle("online", connected);
        rustDot.classList.toggle("offline", !connected);
      }
      const gpuDot = document.getElementById("statusGPU");
      if (gpuDot) {
        gpuDot.classList.toggle("online", connected);
        gpuDot.classList.toggle("offline", !connected);
      }
    }

    // 3. Atualiza username
    const user = Panda.Auth.getUser();
    if (user) {
      const nameEl = document.getElementById("headerUserName");
      if (nameEl) nameEl.textContent = `👤 ${user.name}`;
    }

    // 4. Health Score (mock ou de localStorage)
    const healthScore = localStorage.getItem("pandaHealthScore") || "92";
    const healthEl = document.getElementById("healthScore");
    if (healthEl) healthEl.textContent = healthScore + "%";
  }

  // Init on load
  document.addEventListener("DOMContentLoaded", () => {
    PandaStatus.init();
    updateEnergy(90);

    // Sync com SDK após pequeno delay (para SDK carregar)
    setTimeout(syncWithSDK, 500);
  });

  // Escuta mudanças de wallet
  if (typeof Panda !== "undefined") {
    Panda.on("wallet:change", ({ balance }) => {
      const percent = Math.min(100, Math.round((balance / 1000) * 100));
      updateEnergy(percent);
    });

    Panda.on("agent:status", ({ connected }) => {
      const rustDot = document.getElementById("statusRust");
      const gpuDot = document.getElementById("statusGPU");
      if (rustDot) rustDot.classList.toggle("online", connected);
      if (gpuDot) gpuDot.classList.toggle("online", connected);
    });
  }

  console.log("🐼 Header v4.1 loaded (pf- prefix standard)");
</script>
      </div>

      <!-- â•â•â• INLINE: APP DOCK (Left) â•â•â• -->
      <div id="app-dock-container"><!-- ============================================= -->
<!-- APP DOCK v4.1 (pf- prefix standard)         -->
<!-- Only: Catalog, Store, Dev Mode              -->
<!-- Dynamic apps from user catalog              -->
<!-- ============================================= -->
<style>
  /* Dock Base */
  .pf-dock {
    position: fixed;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
    transition: all 0.3s ease;
  }

  .pf-dock.dragging {
    cursor: grabbing;
    opacity: 0.9;
  }

  .pf-dock-items {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(102, 126, 234, 0.12);
    border-radius: 18px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }

  .dark-mode .pf-dock-items {
    background: rgba(20, 20, 30, 0.88);
    border-color: rgba(102, 126, 234, 0.2);
  }

  /* Dock Item */
  .pf-dock-item {
    width: 46px;
    height: 46px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    border-radius: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: transparent;
    position: relative;
  }

  .pf-dock-item:hover {
    background: rgba(102, 126, 234, 0.12);
    transform: scale(1.15);
  }

  .pf-dock-item:active {
    transform: scale(0.95);
  }

  /* Fixed items (Catalog, Store, Dev) */
  .pf-dock-item.fixed {
    opacity: 1;
  }

  /* Dynamic items (open apps) */
  .pf-dock-item.dynamic {
    border-left: 3px solid #667eea;
  }

  .pf-dock-item.dynamic.pinned::after {
    content: "⭐";
    position: absolute;
    top: -4px;
    right: -4px;
    font-size: 10px;
  }

  /* Dev Mode Toggle */
  .pf-dock-item.pf-dev-toggle.active {
    background: linear-gradient(
      135deg,
      rgba(16, 185, 129, 0.2),
      rgba(52, 211, 153, 0.2)
    );
    box-shadow: inset 0 0 0 2px rgba(16, 185, 129, 0.4);
  }

  /* Separator */
  .pf-dock-separator {
    width: 100%;
    height: 1px;
    background: rgba(102, 126, 234, 0.15);
    margin: 4px 0;
  }

  /* Dynamic Apps Section */
  .pf-dock-dynamic {
    display: flex;
    flex-direction: column;
    gap: 6px;
    max-height: 200px;
    overflow-y: auto;
  }

  .pf-dock-dynamic::-webkit-scrollbar {
    width: 3px;
  }

  .pf-dock-dynamic::-webkit-scrollbar-thumb {
    background: rgba(102, 126, 234, 0.3);
    border-radius: 2px;
  }

  /* Context Menu */
  .pf-context-menu {
    position: fixed;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(16px);
    border: 1px solid rgba(102, 126, 234, 0.15);
    border-radius: 12px;
    padding: 6px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    z-index: 3000;
    display: none;
    min-width: 160px;
  }

  .dark-mode .pf-context-menu {
    background: rgba(25, 25, 35, 0.95);
  }

  .pf-context-menu.visible {
    display: block;
  }

  .pf-context-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 13px;
    color: var(--text-primary, #1a1a2e);
    transition: background 0.15s ease;
  }

  .dark-mode .pf-context-item {
    color: #fff;
  }

  .pf-context-item:hover {
    background: rgba(102, 126, 234, 0.1);
  }

  .pf-context-item.danger {
    color: #ef4444;
  }

  .pf-context-item.danger:hover {
    background: rgba(239, 68, 68, 0.1);
  }

  .pf-context-separator {
    height: 1px;
    background: rgba(102, 126, 234, 0.1);
    margin: 4px 0;
  }
</style>

<div id="appDock" class="pf-dock">
  <div class="pf-dock-items">
    <!-- FIXED ITEMS -->
    <div
      class="pf-dock-item fixed"
      onclick="PandaCatalog.open()"
      title="📁 Meu Catálogo"
    >
      📁
    </div>
    <div
      class="pf-dock-item fixed"
      onclick="PandaStore.open()"
      title="🏪 Store"
    >
      🏪
    </div>

    <div class="pf-dock-separator"></div>

    <!-- DEV MODE TOGGLE -->
    <div
      class="pf-dock-item fixed pf-dev-toggle"
      id="devModeToggle"
      onclick="toggleDevMode()"
      title="🛠️ Dev Mode"
    >
      🛠️
    </div>

    <div
      class="pf-dock-separator"
      id="dynamicSeparator"
      style="display: none"
    ></div>

    <!-- DYNAMIC APPS (from catalog) -->
    <div class="pf-dock-dynamic" id="dynamicApps">
      <!-- Apps appear here when opened from catalog -->
    </div>
  </div>
</div>

<!-- Context Menu (Right Click) -->
<div class="pf-context-menu" id="dockContextMenu">
  <div class="pf-context-item" onclick="DockContext.pinApp()">
    <span>📌</span> Fixar no Dock
  </div>
  <div class="pf-context-item" onclick="DockContext.closeApp()">
    <span>❌</span> Fechar
  </div>
  <div class="pf-context-separator"></div>
  <div class="pf-context-item" onclick="DockContext.openSettings()">
    <span>⚙️</span> Configurações
  </div>
  <div class="pf-context-item" onclick="DockContext.sdkActions()">
    <span>🔧</span> Ações SDK
  </div>
  <div class="pf-context-separator"></div>
  <div class="pf-context-item danger" onclick="DockContext.uninstallApp()">
    <span>🗑️</span> Desinstalar
  </div>
</div>

<script>
  /**
   * PandaDock Controller v4.1
   */
  window.PandaDock = {
    openApps: new Map(), // Currently open apps
    pinnedApps: new Set(), // Pinned to dock permanently

    // Add app to dock (when opened from catalog)
    addApp(appId, appData) {
      if (this.openApps.has(appId)) return;

      this.openApps.set(appId, appData);
      this.renderDynamicApps();

      // Show separator
      document.getElementById("dynamicSeparator").style.display = "block";
    },

    // Remove app from dock (when closed)
    removeApp(appId) {
      if (this.pinnedApps.has(appId)) return; // Don't remove pinned

      this.openApps.delete(appId);
      this.renderDynamicApps();

      // Hide separator if no apps
      if (this.openApps.size === 0) {
        document.getElementById("dynamicSeparator").style.display = "none";
      }
    },

    // Pin app to dock
    pinApp(appId) {
      this.pinnedApps.add(appId);
      localStorage.setItem("pinnedApps", JSON.stringify([...this.pinnedApps]));
      this.renderDynamicApps();
    },

    // Unpin app
    unpinApp(appId) {
      this.pinnedApps.delete(appId);
      localStorage.setItem("pinnedApps", JSON.stringify([...this.pinnedApps]));
      if (!this.openApps.has(appId)) {
        this.renderDynamicApps();
      }
    },

    // Render dynamic apps section
    renderDynamicApps() {
      const container = document.getElementById("dynamicApps");
      if (!container) return;

      container.innerHTML = "";

      // Combine open and pinned apps
      const allApps = new Map([...this.openApps]);
      this.pinnedApps.forEach((id) => {
        if (!allApps.has(id)) {
          allApps.set(id, { icon: "📱", name: "App " + id });
        }
      });

      allApps.forEach((app, id) => {
        const isPinned = this.pinnedApps.has(id);
        const div = document.createElement("div");
        div.className = `pf-dock-item dynamic${isPinned ? " pinned" : ""}`;
        div.title = app.name || id;
        div.innerHTML = app.icon || "📱";
        div.onclick = () => this.focusApp(id);
        div.oncontextmenu = (e) => {
          e.preventDefault();
          DockContext.show(e, id, app);
        };
        container.appendChild(div);
      });
    },

    // Focus/switch to app
    focusApp(appId) {
      console.log("🐼 Focus app:", appId);
      // Will connect to multi-window system
      Panda?.UI?.focusWindow?.(appId);
    },

    // Load pinned apps from storage
    init() {
      const saved = localStorage.getItem("pinnedApps");
      if (saved) {
        this.pinnedApps = new Set(JSON.parse(saved));
        this.renderDynamicApps();
      }
    },
  };

  /**
   * Context Menu Controller
   */
  window.DockContext = {
    currentApp: null,

    show(event, appId, appData) {
      this.currentApp = { id: appId, data: appData };
      const menu = document.getElementById("dockContextMenu");

      menu.style.left = event.clientX + "px";
      menu.style.top = event.clientY + "px";
      menu.classList.add("visible");

      // Close when clicking outside
      setTimeout(() => {
        document.addEventListener("click", this.hide, { once: true });
      }, 10);
    },

    hide() {
      document.getElementById("dockContextMenu")?.classList.remove("visible");
    },

    pinApp() {
      if (this.currentApp) {
        PandaDock.pinApp(this.currentApp.id);
        Panda?.UI?.toast?.("📌 App fixado no dock", "success");
      }
      this.hide();
    },

    closeApp() {
      if (this.currentApp) {
        PandaDock.removeApp(this.currentApp.id);
        // Close the actual window
        Panda?.UI?.closeWindow?.(this.currentApp.id);
      }
      this.hide();
    },

    openSettings() {
      Panda?.UI?.toast?.("⚙️ App settings coming soon", "info");
      this.hide();
    },

    sdkActions() {
      // Opens SDK actions menu - extensible by devs
      console.log("🔧 SDK Actions for:", this.currentApp?.id);
      Panda?.UI?.toast?.("🔧 SDK Actions extensible", "info");
      this.hide();
    },

    uninstallApp() {
      if (this.currentApp) {
        if (
          confirm(
            `Desinstalar ${this.currentApp.data?.name || this.currentApp.id}?`,
          )
        ) {
          PandaDock.removeApp(this.currentApp.id);
          PandaDock.unpinApp(this.currentApp.id);
          Panda?.UI?.toast?.("🗑️ App desinstalado", "success");
        }
      }
      this.hide();
    },
  };

  /**
   * Placeholder controllers for Catalog and Store
   */
  window.PandaCatalog = {
    open() {
      Panda?.UI?.toast?.("📁 Catálogo - Em desenvolvimento", "info");
      // Will open catalog modal showing user's installed apps
    },
  };

  window.PandaStore = {
    open() {
      Panda?.UI?.toast?.("🏪 Store - Em desenvolvimento", "info");
      // Will open store modal
    },
  };

  // Dev Mode Toggle
  window.toggleDevMode = function () {
    const devDock = document.getElementById("devDock");
    const toggleBtn = document.getElementById("devModeToggle");
    const isActive = devDock?.classList.toggle("active");

    if (toggleBtn) {
      toggleBtn.innerHTML = isActive ? "🔧" : "🛠️";
      toggleBtn.classList.toggle("active", isActive);
    }

    localStorage.setItem("panda_dev_mode", isActive ? "true" : "false");
    Panda?.UI?.toast?.(
      isActive ? "🔧 Dev Mode ON" : "🛠️ Dev Mode OFF",
      isActive ? "success" : "info",
    );
  };

  // Init on load
  document.addEventListener("DOMContentLoaded", () => {
    PandaDock.init();

    // Restore dev mode
    if (localStorage.getItem("panda_dev_mode") === "true") {
      document.getElementById("devDock")?.classList.add("active");
      const btn = document.getElementById("devModeToggle");
      if (btn) {
        btn.innerHTML = "🔧";
        btn.classList.add("active");
      }
    }
  });

  console.log("🐼 AppDock v4.1 loaded (pf- prefix standard)");
</script>
      </div>

      <!-- â•â•â• INLINE: DEVTOOLS DOCK (Right) â•â•â• -->
      <div id="dev-dock-container"><!-- ============================================= -->
<!-- DEVTOOLS DOCK v3.1 (pf- prefix standard)    -->
<!-- Right Side, Vertical, DevMode Tools         -->
<!-- ============================================= -->
<style>
  /* DevDock Glassmorphism Styles */
  .pf-devdock {
    position: fixed;
    right: 16px;
    top: 50%;
    transform: translateY(-50%);
    z-index: 1000;
    display: none; /* Hidden by default, shown when Dev Mode ON */
  }

  .pf-devdock.active {
    display: block;
  }

  .pf-devdock .pf-dock-items {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 12px;
    background: rgba(102, 126, 234, 0.12);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border: 1px solid rgba(102, 126, 234, 0.2);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  }

  /* Light mode */
  .pf-devdock .pf-dock-items {
    background: rgba(255, 255, 255, 0.75);
  }

  /* Dark mode */
  .dark-mode .pf-devdock .pf-dock-items {
    background: rgba(20, 20, 30, 0.85);
    border-color: rgba(102, 126, 234, 0.3);
  }

  .pf-devdock .pf-dock-item {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    background: transparent;
  }

  .pf-devdock .pf-dock-item:hover {
    background: rgba(102, 126, 234, 0.2);
    transform: scale(1.1);
  }

  .pf-devdock .pf-dock-item:active {
    transform: scale(0.95);
  }

  .pf-dock-section-label {
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #667eea;
    text-align: center;
    margin: 8px 0 4px 0;
    font-weight: 600;
    opacity: 0.8;
  }

  .pf-dock-separator {
    width: 100%;
    height: 1px;
    background: rgba(102, 126, 234, 0.2);
    margin: 4px 0;
  }
</style>

<div id="devDock" class="pf-devdock">
  <div class="pf-dock-items">
    <!-- CORE TOOLS -->
    <div class="pf-dock-section-label">Core</div>

    <div
      class="pf-dock-item"
      onclick="openDevTool('console')"
      title="💻 Console"
    >
      💻
    </div>
    <div
      class="pf-dock-item"
      onclick="openDevTool('mcp')"
      title="🧰 MCP Browser"
    >
      🧰
    </div>
    <div
      class="pf-dock-item"
      onclick="openDevTool('api')"
      title="🔌 API Tester"
    >
      🔌
    </div>

    <div class="pf-dock-separator"></div>

    <!-- GOVERNANCE -->
    <div class="pf-dock-section-label">PAT</div>

    <div
      class="pf-dock-item"
      onclick="openDevTool('treasury')"
      title="🏦 PAT Treasury"
    >
      🏦
    </div>
    <div
      class="pf-dock-item"
      onclick="openDevTool('constitution')"
      title="⚖️ Constitution"
    >
      ⚖️
    </div>

    <div class="pf-dock-separator"></div>

    <!-- DATA & EXTENSIONS -->
    <div class="pf-dock-section-label">Data</div>

    <div
      class="pf-dock-item"
      onclick="openDevTool('database')"
      title="🗄️ Database"
    >
      🗄️
    </div>
    <div
      class="pf-dock-item"
      onclick="openDevTool('extensions')"
      title="🧩 Extensions"
    >
      🧩
    </div>

    <div class="pf-dock-separator"></div>

    <!-- FUTURE TOOLS -->
    <div class="pf-dock-section-label">More</div>

    <div
      class="pf-dock-item"
      onclick="openDevTool('editor')"
      title="📝 Code Editor"
    >
      📝
    </div>
    <div
      class="pf-dock-item"
      onclick="openDevTool('rig')"
      title="🦀 RIG Config"
    >
      🦀
    </div>

    <div class="pf-dock-separator"></div>

    <!-- AI ASSISTANT -->
    <div
      class="pf-dock-item"
      onclick="openDevTool('ai')"
      title="🐼 AI Assistant"
    >
      🐼
    </div>
  </div>
</div>

<script>
  /**
   * DevTools Controller v3.1 (pf- prefix standard)
   */
  window.openDevTool = function (toolId) {
    const tools = {
      console: { title: "💻 Console", icon: "💻" },
      mcp: { title: "🧰 MCP Browser", icon: "🧰" },
      api: { title: "🔌 API Tester", icon: "🔌" },
      treasury: { title: "🏦 PAT Treasury", icon: "🏦" },
      constitution: { title: "⚖️ Constitution", icon: "⚖️" },
      database: { title: "🗄️ Database", icon: "🗄️" },
      extensions: { title: "🧩 Extensions", icon: "🧩" },
      editor: { title: "📝 Code Editor", icon: "📝" },
      rig: { title: "🦀 RIG Config", icon: "🦀" },
      ai: { title: "🐼 AI Assistant", icon: "🐼" },
    };

    const tool = tools[toolId];
    if (!tool) {
      console.warn("Unknown tool:", toolId);
      return;
    }

    // Try pop-out first
    if (typeof Panda !== "undefined" && Panda.UI?.popout) {
      Panda.UI.popout(toolId).catch(() => {
        // Fallback to toast
        Panda.UI.toast?.(`${tool.title} coming soon!`, "info");
      });
    } else {
      // Simple fallback
      console.log(`🐼 Opening ${tool.title}...`);
      alert(`${tool.title}\n\nEsta ferramenta será implementada em breve!`);
    }
  };

  /**
   * Toggle Dev Mode (also defined in AppDock, this is a backup)
   */
  if (!window.toggleDevMode) {
    window.toggleDevMode = function () {
      const devDock = document.getElementById("devDock");
      const toggleBtn = document.getElementById("devModeToggle");
      const isActive = devDock?.classList.toggle("active");

      if (toggleBtn) {
        toggleBtn.innerHTML = isActive ? "🔧" : "🛠️";
        toggleBtn.classList.toggle("active", isActive);
      }

      localStorage.setItem("panda_dev_mode", isActive ? "true" : "false");

      if (typeof Panda !== "undefined" && Panda.UI?.toast) {
        Panda.UI.toast(
          isActive ? "Dev Mode ON 🔧" : "Dev Mode OFF",
          isActive ? "success" : "info",
        );
      }

      console.log(`🐼 Dev Mode: ${isActive ? "ON" : "OFF"}`);
    };
  }

  // Auto-restore Dev Mode on load
  document.addEventListener("DOMContentLoaded", () => {
    const savedDevMode = localStorage.getItem("panda_dev_mode") === "true";
    if (savedDevMode) {
      const devDock = document.getElementById("devDock");
      const toggleBtn = document.getElementById("devModeToggle");
      if (devDock) devDock.classList.add("active");
      if (toggleBtn) {
        toggleBtn.innerHTML = "🔧";
        toggleBtn.classList.add("active");
      }
    }
  });

  console.log("🐼 DevTools Dock v3.1 loaded (pf- prefix standard)");
</script>
      </div>

      <!-- â•â•â• INLINE: SETTINGS MODAL â•â•â• -->
      <div id="settings-modal-container"><!-- ============================================= -->
<!-- SETTINGS MODAL v3.1 (pf- prefix standard)   -->
<!-- 10 Sections · Light/Dark Glassmorphism      -->
<!-- ============================================= -->
<style>
  /* ============================================= */
  /* SETTINGS MODAL - GLASSMORPHISM THEME         */
  /* ============================================= */

  .pf-settings-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    z-index: 9000;
    display: none;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .pf-settings-overlay.active {
    display: flex;
    opacity: 1;
  }

  .pf-settings-modal {
    display: flex;
    width: 90%;
    max-width: 1000px;
    height: 80vh;
    max-height: 700px;
    border-radius: 20px;
    overflow: hidden;
    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
    animation: modalSlideIn 0.3s ease;
  }

  @keyframes modalSlideIn {
    from {
      transform: scale(0.95) translateY(20px);
      opacity: 0;
    }
    to {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
  }

  /* Light Mode Glassmorphism */
  .pf-settings-modal {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.3);
  }

  /* Dark Mode Glassmorphism */
  .dark-mode .pf-settings-modal {
    background: rgba(15, 15, 20, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.08);
  }

  /* ============================================= */
  /* SIDEBAR                                       */
  /* ============================================= */

  .pf-settings-sidebar {
    width: 220px;
    padding: 24px 16px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    border-right: 1px solid rgba(102, 126, 234, 0.1);
  }

  /* Light Mode Sidebar */
  .pf-settings-sidebar {
    background: rgba(102, 126, 234, 0.05);
  }

  /* Dark Mode Sidebar */
  .dark-mode .pf-settings-sidebar {
    background: rgba(102, 126, 234, 0.08);
  }

  /* User Profile Header */
  .pf-settings-user {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 12px;
    margin-bottom: 16px;
    border-radius: 12px;
    background: rgba(102, 126, 234, 0.1);
  }

  .pf-settings-user-avatar {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea, #764ba2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }

  .pf-settings-user-info h4 {
    margin: 0;
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary, #1a1a2e);
  }

  .dark-mode .pf-settings-user-info h4 {
    color: #fff;
  }

  .pf-settings-user-info span {
    font-size: 12px;
    color: #667eea;
    font-weight: 500;
  }

  /* Nav Items */
  .pf-settings-nav-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
    font-weight: 500;
    color: var(--text-secondary, #64748b);
  }

  .dark-mode .pf-settings-nav-item {
    color: #a0a0a0;
  }

  .pf-settings-nav-item:hover {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
  }

  .pf-settings-nav-item.active {
    background: linear-gradient(
      135deg,
      rgba(102, 126, 234, 0.2),
      rgba(118, 75, 162, 0.2)
    );
    color: #667eea;
    font-weight: 600;
  }

  .pf-settings-nav-item span {
    font-size: 18px;
    width: 24px;
    text-align: center;
  }

  /* ============================================= */
  /* CONTENT AREA                                  */
  /* ============================================= */

  .pf-settings-content {
    flex: 1;
    padding: 32px;
    overflow-y: auto;
  }

  .pf-settings-section {
    display: none;
    animation: fadeIn 0.3s ease;
  }

  .pf-settings-section.active {
    display: block;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .pf-settings-section-title {
    font-size: 24px;
    font-weight: 700;
    margin: 0 0 8px 0;
    color: var(--text-primary, #1a1a2e);
  }

  .dark-mode .pf-settings-section-title {
    color: #fff;
  }

  .pf-settings-section-desc {
    color: var(--text-secondary, #64748b);
    margin: 0 0 24px 0;
    font-size: 14px;
  }

  /* Cards with Glassmorphism */
  .pf-settings-card {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(102, 126, 234, 0.1);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 16px;
  }

  .dark-mode .pf-settings-card {
    background: rgba(30, 30, 40, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.06);
  }

  .pf-settings-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(102, 126, 234, 0.08);
  }

  .pf-settings-row:last-child {
    border-bottom: none;
  }

  .pf-settings-label {
    font-weight: 600;
    color: var(--text-primary, #1a1a2e);
    font-size: 14px;
  }

  .dark-mode .pf-settings-label {
    color: #fff;
  }

  .pf-settings-sublabel {
    font-size: 12px;
    color: var(--text-secondary, #64748b);
    margin-top: 2px;
  }

  /* ============================================= */
  /* TOGGLE SWITCH (Purple Accent)                 */
  /* ============================================= */

  .pf-toggle {
    width: 48px;
    height: 26px;
    background: #e2e8f0;
    border-radius: 13px;
    cursor: pointer;
    position: relative;
    transition: all 0.3s ease;
  }

  .dark-mode .pf-toggle {
    background: #374151;
  }

  .pf-toggle::after {
    content: "";
    position: absolute;
    width: 22px;
    height: 22px;
    background: #fff;
    border-radius: 50%;
    top: 2px;
    left: 2px;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .pf-toggle.active {
    background: linear-gradient(135deg, #667eea, #764ba2);
  }

  .pf-toggle.active::after {
    left: 24px;
  }

  /* ============================================= */
  /* BUTTONS                                       */
  /* ============================================= */

  .pf-btn-primary {
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: #fff;
    border: none;
    padding: 12px 24px;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .pf-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
  }

  .pf-btn-secondary {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
    border: 1px solid rgba(102, 126, 234, 0.2);
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .pf-btn-secondary:hover {
    background: rgba(102, 126, 234, 0.2);
  }

  /* ============================================= */
  /* INPUTS                                        */
  /* ============================================= */

  .pf-settings-input {
    width: 100%;
    padding: 12px 16px;
    border-radius: 10px;
    border: 1px solid rgba(102, 126, 234, 0.2);
    background: rgba(255, 255, 255, 0.8);
    font-size: 14px;
    transition: all 0.2s ease;
  }

  .dark-mode .pf-settings-input {
    background: rgba(20, 20, 30, 0.8);
    border-color: rgba(102, 126, 234, 0.3);
    color: #fff;
  }

  .pf-settings-input:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
  }

  .pf-settings-select {
    padding: 10px 16px;
    border-radius: 8px;
    border: 1px solid rgba(102, 126, 234, 0.2);
    background: rgba(255, 255, 255, 0.9);
    cursor: pointer;
    font-size: 14px;
  }

  .dark-mode .pf-settings-select {
    background: rgba(30, 30, 40, 0.9);
    border-color: rgba(102, 126, 234, 0.3);
    color: #fff;
  }

  /* ============================================= */
  /* COLOR PICKER                                  */
  /* ============================================= */

  .pf-color-picker {
    display: flex;
    gap: 8px;
  }

  .pf-color-dot {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid transparent;
    transition: all 0.2s ease;
  }

  .pf-color-dot:hover {
    transform: scale(1.15);
  }

  .pf-color-dot.active {
    border-color: #fff;
    box-shadow: 0 0 0 2px #667eea;
  }

  /* ============================================= */
  /* WALLET DISPLAY                                */
  /* ============================================= */

  .pf-wallet-balance {
    text-align: center;
    padding: 24px;
  }

  .pf-wallet-amount {
    font-size: 42px;
    font-weight: 700;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 12px 0;
  }

  /* ============================================= */
  /* STATUS BADGES                                 */
  /* ============================================= */

  .pf-status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
  }

  .pf-status-badge.online {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
  }

  .pf-status-badge.offline {
    background: rgba(239, 68, 68, 0.15);
    color: #ef4444;
  }

  /* ============================================= */
  /* CLOSE BUTTON                                  */
  /* ============================================= */

  .pf-settings-close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: rgba(102, 126, 234, 0.1);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    color: var(--text-secondary, #64748b);
    transition: all 0.2s ease;
  }

  .pf-settings-close:hover {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
  }
</style>

<div
  class="pf-settings-overlay"
  id="settingsOverlay"
  onclick="if (event.target === this) PandaSettings.close();"
>
  <div class="pf-settings-modal">
    <!-- SIDEBAR -->
    <div class="pf-settings-sidebar">
      <!-- User Profile -->
      <div class="pf-settings-user">
        <div class="pf-settings-user-avatar">🐼</div>
        <div class="pf-settings-user-info">
          <h4 id="settings-user-name">Admin</h4>
          <span id="settings-user-role">Administrator</span>
        </div>
      </div>

      <!-- Nav Items -->
      <div
        class="pf-settings-nav-item active"
        data-section="profile"
        onclick="PandaSettings.showSection('profile')"
      >
        <span>👤</span> Profile
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="appearance"
        onclick="PandaSettings.showSection('appearance')"
      >
        <span>🎨</span> Appearance
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="translation"
        onclick="PandaSettings.showSection('translation')"
      >
        <span>🌐</span> Translation
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="notifications"
        onclick="PandaSettings.showSection('notifications')"
      >
        <span>🔔</span> Notifications
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="ai"
        onclick="PandaSettings.showSection('ai')"
      >
        <span>🧠</span> AI Settings
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="wallet"
        onclick="PandaSettings.showSection('wallet')"
      >
        <span>💰</span> Wallet
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="performance"
        onclick="PandaSettings.showSection('performance')"
      >
        <span>⚡</span> Performance
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="security"
        onclick="PandaSettings.showSection('security')"
      >
        <span>🔒</span> Security
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="integrations"
        onclick="PandaSettings.showSection('integrations')"
      >
        <span>🔌</span> Integrations
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="developer"
        onclick="PandaSettings.showSection('developer')"
      >
        <span>📊</span> Developer
      </div>
      <div
        class="pf-settings-nav-item"
        data-section="about"
        onclick="PandaSettings.showSection('about')"
      >
        <span>ℹ️</span> About
      </div>
    </div>

    <!-- CONTENT -->
    <div class="pf-settings-content">
      <!-- =========== PROFILE SECTION =========== -->
      <div class="pf-settings-section active" id="section-profile">
        <h2 class="pf-settings-section-title">Profile</h2>
        <p class="pf-settings-section-desc">Manage your account information</p>

        <div class="pf-settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Username</div>
              <div class="pf-settings-sublabel" id="profile-username">
                admin
              </div>
            </div>
            <button
              class="pf-btn-secondary"
              onclick="PandaSettings.editProfile('username')"
            >
              Edit
            </button>
          </div>
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Email</div>
              <div class="pf-settings-sublabel" id="profile-email">
                admin@panda.io
              </div>
            </div>
            <button
              class="pf-btn-secondary"
              onclick="PandaSettings.editProfile('email')"
            >
              Edit
            </button>
          </div>
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Role</div>
              <div class="pf-settings-sublabel" id="profile-role">
                Administrator
              </div>
            </div>
            <span class="pf-status-badge online">Active</span>
          </div>
        </div>
      </div>

      <!-- =========== APPEARANCE SECTION =========== -->
      <div class="pf-settings-section" id="section-appearance">
        <h2 class="pf-settings-section-title">Appearance</h2>
        <p class="pf-settings-section-desc">Customize the look and feel</p>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Theme</div>
              <div class="pf-settings-sublabel">
                Switch between light and dark mode
              </div>
            </div>
            <div
              class="pf-toggle"
              id="themeToggle"
              onclick="PandaSettings.toggleTheme()"
            ></div>
          </div>
        </div>

        <div class="settings-card">
          <div
            class="pf-settings-row"
            style="flex-direction: column; align-items: flex-start; gap: 12px"
          >
            <div class="pf-settings-label">Accent Color</div>
            <div class="pf-color-picker">
              <div
                class="pf-color-dot active"
                style="background: #667eea"
                onclick="PandaSettings.setAccent('#667eea')"
              ></div>
              <div
                class="pf-color-dot"
                style="background: #10b981"
                onclick="PandaSettings.setAccent('#10b981')"
              ></div>
              <div
                class="pf-color-dot"
                style="background: #f59e0b"
                onclick="PandaSettings.setAccent('#f59e0b')"
              ></div>
              <div
                class="pf-color-dot"
                style="background: #ef4444"
                onclick="PandaSettings.setAccent('#ef4444')"
              ></div>
              <div
                class="pf-color-dot"
                style="background: #8b5cf6"
                onclick="PandaSettings.setAccent('#8b5cf6')"
              ></div>
              <div
                class="pf-color-dot"
                style="background: #ec4899"
                onclick="PandaSettings.setAccent('#ec4899')"
              ></div>
            </div>
          </div>
        </div>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Language</div>
              <div class="pf-settings-sublabel">
                Select your preferred language
              </div>
            </div>
            <select
              class="pf-settings-select"
              onchange="PandaSettings.setLanguage(this.value)"
            >
              <option value="pt">🇧🇷 Português</option>
              <option value="en">🇺🇸 English</option>
              <option value="es">🇪🇸 Español</option>
            </select>
          </div>
        </div>
      </div>

      <!-- =========== TRANSLATION SECTION =========== -->
      <div class="pf-settings-section" id="section-translation">
        <h2 class="pf-settings-section-title">🌐 Translation</h2>
        <p class="pf-settings-section-desc">
          Configure auto-translation powered by Polyglot (200 languages)
        </p>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Auto-Translate Content</div>
              <div class="pf-settings-sublabel">
                Automatically translate incoming content to your preferred
                language
              </div>
            </div>
            <div
              class="pf-toggle"
              id="autoTranslateToggle"
              onclick="PandaSettings.toggleAutoTranslate()"
            ></div>
          </div>
        </div>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Preferred Language</div>
              <div class="pf-settings-sublabel">
                Content will be translated to this language
              </div>
            </div>
            <select
              class="pf-settings-select"
              id="preferredTranslationLang"
              onchange="PandaSettings.setTranslationLang(this.value)"
            >
              <option value="pt">🇧🇷 Português</option>
              <option value="en">🇺🇸 English</option>
              <option value="es">🇪🇸 Español</option>
              <option value="fr">🇫🇷 Français</option>
              <option value="de">🇩🇪 Deutsch</option>
              <option value="it">🇮🇹 Italiano</option>
              <option value="ja">🇯🇵 日本語</option>
              <option value="ko">🇰🇷 한국어</option>
              <option value="zh">🇨🇳 中文</option>
              <option value="ar">🇸🇦 العربية</option>
              <option value="ru">🇷🇺 Русский</option>
              <option value="hi">🇮🇳 हिन्दी</option>
              <option value="nl">🇳🇱 Nederlands</option>
              <option value="pl">🇵🇱 Polski</option>
              <option value="tr">🇹🇷 Türkçe</option>
            </select>
          </div>
        </div>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Translation Scope</div>
              <div class="pf-settings-sublabel">
                What content should be auto-translated
              </div>
            </div>
            <select
              class="pf-settings-select"
              id="translationScope"
              onchange="PandaSettings.setTranslationScope(this.value)"
            >
              <option value="all">All Content</option>
              <option value="messages">Messages Only</option>
              <option value="ai">AI Responses Only</option>
              <option value="manual">Manual Only</option>
            </select>
          </div>
        </div>

        <div class="settings-card">
          <div
            class="pf-settings-row"
            style="flex-direction: column; align-items: flex-start; gap: 12px"
          >
            <div class="pf-settings-label">Translation Engine</div>
            <div
              style="display: flex; align-items: center; gap: 12px; width: 100%"
            >
              <span class="pf-status-badge online">
                <span>🦀</span> NLLB-200 (Offline)
              </span>
              <span class="pf-settings-sublabel"
                >~600MB · 200 languages · Runs locally via Rust Agent</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- =========== NOTIFICATIONS SECTION =========== -->
      <div class="pf-settings-section" id="section-notifications">
        <h2 class="pf-settings-section-title">Notifications</h2>
        <p class="pf-settings-section-desc">
          Manage your notification preferences
        </p>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Push Notifications</div>
              <div class="pf-settings-sublabel">
                Receive browser notifications
              </div>
            </div>
            <div
              class="pf-toggle active"
              onclick="this.classList.toggle('active')"
            ></div>
          </div>
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Email Alerts</div>
              <div class="pf-settings-sublabel">
                Receive important updates via email
              </div>
            </div>
            <div
              class="pf-toggle"
              onclick="this.classList.toggle('active')"
            ></div>
          </div>
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Sound Effects</div>
              <div class="pf-settings-sublabel">
                Play sounds for notifications
              </div>
            </div>
            <div
              class="pf-toggle active"
              onclick="this.classList.toggle('active')"
            ></div>
          </div>
        </div>
      </div>

      <!-- =========== AI SETTINGS SECTION =========== -->
      <div class="pf-settings-section" id="section-ai">
        <h2 class="pf-settings-section-title">AI Settings</h2>
        <p class="pf-settings-section-desc">
          Configure your AI assistant preferences
        </p>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Default Model</div>
              <div class="pf-settings-sublabel">
                Choose your preferred AI model
              </div>
            </div>
            <select class="pf-settings-select" id="ai-model">
              <option value="gemini-flash">⚡ Gemini Flash 3 (Fast)</option>
              <option value="gemini-pro">🧠 Gemini 1.5 Pro</option>
              <option value="gpt-4o">🤖 GPT-4o</option>
              <option value="claude-3.5">📝 Claude 3.5 Sonnet</option>
              <option value="llama-local">🦙 Llama 3 (Local GPU)</option>
            </select>
          </div>
        </div>

        <div class="settings-card">
          <div
            class="pf-settings-row"
            style="flex-direction: column; align-items: flex-start; gap: 12px"
          >
            <div>
              <div class="pf-settings-label">Token Limit</div>
              <div class="pf-settings-sublabel">
                Maximum tokens per request:
                <strong id="token-value">8192</strong>
              </div>
            </div>
            <input
              type="range"
              min="1024"
              max="32000"
              value="8192"
              style="width: 100%"
              oninput="
                document.getElementById('token-value').textContent = this.value
              "
            />
          </div>
        </div>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Auto-Suggest</div>
              <div class="pf-settings-sublabel">
                AI suggestions while typing
              </div>
            </div>
            <div
              class="pf-toggle active"
              onclick="this.classList.toggle('active')"
            ></div>
          </div>
        </div>
      </div>

      <!-- =========== WALLET SECTION =========== -->
      <div class="pf-settings-section" id="section-wallet">
        <h2 class="pf-settings-section-title">Wallet</h2>
        <p class="pf-settings-section-desc">Manage your Panda Coins balance</p>

        <div class="settings-card wallet-balance">
          <div style="font-size: 48px">💰</div>
          <div class="pf-wallet-amount" id="wallet-balance">$1,250.00</div>
          <div class="pf-settings-sublabel">Available Balance</div>
          <button
            class="pf-btn-primary"
            style="margin-top: 16px"
            onclick="PandaSettings.rechargeWallet()"
          >
            + Recharge
          </button>
        </div>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div class="pf-settings-label">Today's Usage</div>
            <div style="color: #f59e0b; font-weight: 600">30 PC</div>
          </div>
          <div class="pf-settings-row">
            <div class="pf-settings-label">GPU Savings</div>
            <div style="color: #10b981; font-weight: 600">720 PC saved</div>
          </div>
          <div class="pf-settings-row">
            <div class="pf-settings-label">Transaction History</div>
            <button
              class="pf-btn-secondary"
              onclick="PandaSettings.showTransactions()"
            >
              View All
            </button>
          </div>
        </div>
      </div>

      <!-- =========== PERFORMANCE SECTION =========== -->
      <div class="pf-settings-section" id="section-performance">
        <h2 class="pf-settings-section-title">Performance</h2>
        <p class="pf-settings-section-desc">Optimize system performance</p>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">GPU Acceleration</div>
              <div class="pf-settings-sublabel">
                Use local GPU for AI processing
              </div>
            </div>
            <div
              class="pf-toggle"
              id="gpuToggle"
              onclick="PandaSettings.toggleGPU()"
            ></div>
          </div>
          <div class="pf-settings-row">
            <div class="pf-settings-label">GPU Status</div>
            <span class="pf-status-badge offline" id="gpu-status">
              <span>⚠️</span> Not Connected
            </span>
          </div>
        </div>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Cache Controls</div>
              <div class="pf-settings-sublabel">Manage local cache storage</div>
            </div>
            <div style="display: flex; gap: 8px">
              <button
                class="pf-btn-secondary"
                onclick="PandaSettings.clearCache()"
              >
                Clear Cache
              </button>
              <button
                class="pf-btn-secondary"
                onclick="PandaSettings.optimizeCache()"
              >
                Optimize
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- =========== SECURITY SECTION =========== -->
      <div class="pf-settings-section" id="section-security">
        <h2 class="pf-settings-section-title">Security</h2>
        <p class="pf-settings-section-desc">Protect your account</p>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Two-Factor Authentication</div>
              <div class="pf-settings-sublabel">
                Add an extra layer of security
              </div>
            </div>
            <div
              class="pf-toggle"
              onclick="this.classList.toggle('active')"
            ></div>
          </div>
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Active Sessions</div>
              <div class="pf-settings-sublabel">Manage logged-in devices</div>
            </div>
            <button
              class="pf-btn-secondary"
              onclick="PandaSettings.manageSessions()"
            >
              Manage
            </button>
          </div>
        </div>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Change Password</div>
              <div class="pf-settings-sublabel">
                Update your account password
              </div>
            </div>
            <button
              class="pf-btn-secondary"
              onclick="PandaSettings.changePassword()"
            >
              Change
            </button>
          </div>
        </div>
      </div>

      <!-- =========== INTEGRATIONS SECTION =========== -->
      <div class="pf-settings-section" id="section-integrations">
        <h2 class="pf-settings-section-title">Integrations</h2>
        <p class="pf-settings-section-desc">Connect external services</p>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div style="display: flex; align-items: center; gap: 12px">
              <span style="font-size: 24px">🔥</span>
              <div>
                <div class="pf-settings-label">Firebase</div>
                <div class="pf-settings-sublabel">
                  Real-time database & auth
                </div>
              </div>
            </div>
            <span class="pf-status-badge online" id="firebase-status">
              <span>✓</span> Connected
            </span>
          </div>
          <div class="pf-settings-row">
            <div style="display: flex; align-items: center; gap: 12px">
              <span style="font-size: 24px">🦀</span>
              <div>
                <div class="pf-settings-label">Panda Agent (Rust)</div>
                <div class="pf-settings-sublabel">Local GPU processing</div>
              </div>
            </div>
            <span class="pf-status-badge offline" id="agent-status">
              <span>○</span> Disconnected
            </span>
          </div>
          <div class="pf-settings-row">
            <div style="display: flex; align-items: center; gap: 12px">
              <span style="font-size: 24px">🧰</span>
              <div>
                <div class="pf-settings-label">MCP Servers</div>
                <div class="pf-settings-sublabel">Model Context Protocol</div>
              </div>
            </div>
            <button
              class="pf-btn-secondary"
              onclick="PandaSettings.configureMCP()"
            >
              Configure
            </button>
          </div>
        </div>
      </div>

      <!-- =========== DEVELOPER SECTION =========== -->
      <div class="pf-settings-section" id="section-developer">
        <h2 class="pf-settings-section-title">Developer</h2>
        <p class="pf-settings-section-desc">Advanced developer options</p>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Debug Mode</div>
              <div class="pf-settings-sublabel">Enable verbose logging</div>
            </div>
            <div
              class="pf-toggle"
              onclick="this.classList.toggle('active')"
            ></div>
          </div>
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">API Status</div>
              <div class="pf-settings-sublabel" style="font-family: monospace">
                >_ api_status
              </div>
            </div>
            <span class="pf-status-badge online">OK</span>
          </div>
        </div>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">API Tokens</div>
              <div class="pf-settings-sublabel">
                Manage your API access tokens
              </div>
            </div>
            <button
              class="pf-btn-secondary"
              onclick="PandaSettings.viewApiTokens()"
            >
              View Tokens
            </button>
          </div>
          <div class="pf-settings-row">
            <div>
              <div class="pf-settings-label">Open Console</div>
              <div class="pf-settings-sublabel">
                Developer console & testing
              </div>
            </div>
            <button
              class="pf-btn-primary"
              onclick="PandaSettings.openConsole()"
            >
              💻 Open
            </button>
          </div>
        </div>
      </div>

      <!-- =========== ABOUT SECTION =========== -->
      <div class="pf-settings-section" id="section-about">
        <h2 class="pf-settings-section-title">About</h2>
        <p class="pf-settings-section-desc">System information</p>

        <div class="settings-card">
          <div class="pf-settings-row">
            <div class="pf-settings-label">Version</div>
            <div>v5.0.0</div>
          </div>
          <div class="pf-settings-row">
            <div class="pf-settings-label">SDK Version</div>
            <div>Panda SDK v0.7.1</div>
          </div>
          <div class="pf-settings-row">
            <div class="pf-settings-label">Design System</div>
            <div>Glassmorphism v3.0</div>
          </div>
          <div class="pf-settings-row">
            <div class="pf-settings-label">License</div>
            <div><a href="#" style="color: #667eea">View License</a></div>
          </div>
        </div>

        <div style="text-align: center; margin-top: 24px; padding: 24px">
          <img
            src="assets/panda_logo.jpg"
            alt="Panda"
            style="
              width: 80px;
              height: 80px;
              border-radius: 50%;
              margin-bottom: 16px;
            "
          />
          <h3 style="margin: 0; color: var(--text-primary)">Panda Fabrics</h3>
          <p style="color: var(--text-secondary); margin: 8px 0">
            Building the Developer Soil 🐼
          </p>
          <p style="color: var(--text-secondary); font-size: 12px">
            © 2026 Panda Factory
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  /**
   * PandaSettings Controller v3.0
   * Modular Settings Modal with SDK Integration
   */
  window.PandaSettings = {
    currentSection: "profile",

    // Open/Close Modal
    open() {
      const overlay = document.getElementById("settingsOverlay");
      overlay.classList.add("active");
      this.loadUserData();
    },

    close() {
      const overlay = document.getElementById("settingsOverlay");
      overlay.classList.remove("active");
    },

    toggle() {
      const overlay = document.getElementById("settingsOverlay");
      overlay.classList.contains("active") ? this.close() : this.open();
    },

    // Section Navigation
    showSection(sectionId) {
      // Update nav items
      document.querySelectorAll(".pf-settings-nav-item").forEach((item) => {
        item.classList.remove("active");
        if (item.dataset.section === sectionId) {
          item.classList.add("active");
        }
      });

      // Update sections
      document.querySelectorAll(".pf-settings-section").forEach((sec) => {
        sec.classList.remove("active");
      });

      const target = document.getElementById("section-" + sectionId);
      if (target) {
        target.classList.add("active");
      }

      this.currentSection = sectionId;
    },

    // Load User Data from SDK
    async loadUserData() {
      if (typeof Panda !== "undefined" && Panda.Auth) {
        const user = Panda.Auth.getUser();
        if (user) {
          document.getElementById("settings-user-name").textContent =
            user.name || "User";
          document.getElementById("settings-user-role").textContent =
            user.role || "User";
          document.getElementById("profile-username").textContent =
            user.name || "admin";
          document.getElementById("profile-email").textContent =
            user.email || "user@panda.io";
        }
      }

      if (typeof Panda !== "undefined" && Panda.Wallet) {
        try {
          const balance = await Panda.Wallet.getBalance();
          document.getElementById("wallet-balance").textContent =
            `${balance.coins} PC`;
        } catch (e) {}
      }

      // Update theme toggle
      const isDark = document.body.classList.contains("dark-mode");
      const toggle = document.getElementById("themeToggle");
      if (toggle) {
        toggle.classList.toggle("active", isDark);
      }

      // Load translation settings
      this.loadTranslationSettings();
    },

    // Theme Toggle
    toggleTheme() {
      const toggle = document.getElementById("themeToggle");
      toggle.classList.toggle("active");
      document.body.classList.toggle("dark-mode");
      localStorage.setItem(
        "crmTheme",
        document.body.classList.contains("dark-mode") ? "dark" : "light",
      );
    },

    // Set Accent Color
    setAccent(color) {
      document.documentElement.style.setProperty("--accent-primary", color);
      document
        .querySelectorAll(".pf-color-dot")
        .forEach((dot) => dot.classList.remove("active"));
      event.target.classList.add("active");
      localStorage.setItem("pandaAccent", color);
    },

    // GPU Toggle
    toggleGPU() {
      const toggle = document.getElementById("gpuToggle");
      const status = document.getElementById("gpu-status");
      toggle.classList.toggle("active");

      if (toggle.classList.contains("active")) {
        status.className = "pf-status-badge online";
        status.innerHTML = "<span>⚡</span> Active";
      } else {
        status.className = "pf-status-badge offline";
        status.innerHTML = "<span>⚠️</span> Not Connected";
      }
    },

    // Placeholder methods for SDK integration
    editProfile(field) {
      Panda?.UI?.toast?.("Edit " + field + " coming soon", "info");
    },
    setLanguage(lang) {
      console.log("Language:", lang);
      if (typeof PandaI18n !== "undefined") {
        PandaI18n.setLanguage(lang);
      }
      localStorage.setItem("pandaLang", lang);
    },

    // Translation Settings (Polyglot)
    toggleAutoTranslate() {
      const toggle = document.getElementById("autoTranslateToggle");
      toggle.classList.toggle("active");
      const enabled = toggle.classList.contains("active");
      localStorage.setItem("pandaAutoTranslate", enabled);
      Panda?.UI?.toast?.(
        enabled ? "Auto-translate enabled" : "Auto-translate disabled",
        "info",
      );
    },

    setTranslationLang(lang) {
      localStorage.setItem("pandaTranslationLang", lang);
      console.log("Translation language:", lang);
    },

    setTranslationScope(scope) {
      localStorage.setItem("pandaTranslationScope", scope);
      console.log("Translation scope:", scope);
    },

    loadTranslationSettings() {
      // Auto-translate toggle
      const autoTranslate =
        localStorage.getItem("pandaAutoTranslate") === "true";
      const toggle = document.getElementById("autoTranslateToggle");
      if (toggle) {
        toggle.classList.toggle("active", autoTranslate);
      }

      // Preferred language
      const lang = localStorage.getItem("pandaTranslationLang") || "pt";
      const langSelect = document.getElementById("preferredTranslationLang");
      if (langSelect) {
        langSelect.value = lang;
      }

      // Scope
      const scope = localStorage.getItem("pandaTranslationScope") || "all";
      const scopeSelect = document.getElementById("translationScope");
      if (scopeSelect) {
        scopeSelect.value = scope;
      }
    },

    rechargeWallet() {
      Panda?.UI?.toast?.("Recharge coming soon", "info");
    },
    showTransactions() {
      Panda?.UI?.toast?.("Transaction history coming soon", "info");
    },
    clearCache() {
      localStorage.clear();
      Panda?.UI?.toast?.("Cache cleared", "success");
    },
    optimizeCache() {
      Panda?.UI?.toast?.("Cache optimized", "success");
    },
    manageSessions() {
      Panda?.UI?.toast?.("Session management coming soon", "info");
    },
    changePassword() {
      Panda?.UI?.toast?.("Password change coming soon", "info");
    },
    configureMCP() {
      Panda?.UI?.toast?.("MCP configuration coming soon", "info");
    },
    viewApiTokens() {
      Panda?.UI?.toast?.("API tokens coming soon", "info");
    },
    openConsole() {
      if (typeof PandaDevTools !== "undefined") {
        PandaDevTools.open("console");
      } else {
        console.log("🐼 Panda Console - Type Panda.* to explore the SDK");
      }
    },
  };

  // Backward compatibility
  function mudarSecaoSettings(s) {
    PandaSettings.showSection(s);
  }
  function fecharConfiguracoes() {
    PandaSettings.close();
  }
  function abrirConfiguracoes() {
    PandaSettings.open();
  }

  console.log("🐼 PandaSettings v3.1 loaded (pf- prefix standard)");
</script>
      </div>

      <!-- â•â•â• INLINE: SIDEBAR / AI CHAT â•â•â• -->
      <div id="sidebar-container"><!-- ============================================= -->
<!-- SIDEBAR COMPONENT v1.2 (pf- prefix standard) -->
<!-- Chat/Omni-Channel - Right Side/Bottom         -->
<!-- ============================================= -->
<div id="omni-channel-sidebar" class="pf-sidebar">
  <div class="pf-sidebar-header">
    <div class="pf-sidebar-title">Panda AI Assistant</div>
    <div class="pf-sidebar-controls">
      <button class="pf-icon-btn" onclick="toggleSidebar()" title="Minimizar">
        ▼
      </button>
    </div>
  </div>

  <div class="pf-sidebar-messages" id="chat-history">
    <div class="pf-chat-placeholder">
      <div class="pf-placeholder-icon">💬</div>
      <p>Olá! Como posso ajudar você hoje?</p>
      <div class="pf-suggestion-chips">
        <button onclick="setInput('Criar novo cliente')">
          Criar novo cliente
        </button>
        <button onclick="setInput('Resumo financeiro')">
          Resumo financeiro
        </button>
        <button onclick="setInput('Verificar servidor')">
          Verificar servidor
        </button>
      </div>
    </div>
  </div>

  <div class="pf-sidebar-input">
    <input
      type="text"
      id="chat-input"
      placeholder="Digite sua mensagem or /comando..."
      autocomplete="off"
    />
    <button class="pf-send-btn" onclick="sendMessage()">
      <span>➤</span>
    </button>
  </div>
</div>

<style>
  /* Sidebar / Chat Styles */
  .pf-sidebar {
    position: fixed;
    bottom: 20px;
    right: 80px;
    width: 350px;
    height: 500px;
    background: var(--bg-panel);
    backdrop-filter: blur(20px);
    border: 1px solid var(--border-subtle);
    border-radius: 16px;
    box-shadow: var(--shadow-dock);
    display: flex;
    flex-direction: column;
    z-index: 4000;
    transition: all 0.3s ease;
    overflow: hidden;
  }

  .pf-sidebar.collapsed {
    height: 50px;
  }

  .pf-sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    border-bottom: 1px solid var(--border-subtle);
    background: rgba(0, 0, 0, 0.02);
    cursor: pointer;
  }

  .pf-sidebar-title {
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-primary);
  }

  .pf-icon-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 12px;
  }

  .pf-sidebar-messages {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .pf-chat-placeholder {
    text-align: center;
    margin-top: 40px;
    color: var(--text-secondary);
  }

  .pf-placeholder-icon {
    font-size: 32px;
    margin-bottom: 12px;
    opacity: 0.5;
  }

  .pf-suggestion-chips {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 8px;
    margin-top: 20px;
  }

  .pf-suggestion-chips button {
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: 20px;
    padding: 6px 12px;
    font-size: 11px;
    cursor: pointer;
    color: var(--text-primary);
    transition: all 0.2s;
  }

  .pf-suggestion-chips button:hover {
    border-color: var(--text-primary);
    background: var(--bg-input);
  }

  .pf-sidebar-input {
    padding: 12px;
    border-top: 1px solid var(--border-subtle);
    display: flex;
    gap: 8px;
    background: var(--bg-card);
  }

  .pf-sidebar-input input {
    flex: 1;
    background: var(--bg-input);
    border: 1px solid var(--border-subtle);
    border-radius: 20px;
    padding: 8px 16px;
    color: var(--text-primary);
    outline: none;
  }

  .pf-sidebar-input input:focus {
    border-color: var(--border-focus);
  }

  .pf-send-btn {
    background: var(--accent-primary);
    color: var(--text-inverted);
    border: none;
    border-radius: 50%;
    width: 36px;
    height: 36px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>

<script>
  /**
   * Panda AI Sidebar v1.2 - pf- prefix standard
   */

  // Sidebar Interactivity
  function toggleSidebar() {
    const sidebar = document.getElementById("omni-channel-sidebar");
    sidebar.classList.toggle("collapsed");
  }

  function setInput(text) {
    document.getElementById("chat-input").value = text;
    document.getElementById("chat-input").focus();
  }

  async function sendMessage() {
    const input = document.getElementById("chat-input");
    const text = input.value.trim();
    if (!text) return;

    const history = document.getElementById("chat-history");

    // User Message
    const userDiv = document.createElement("div");
    userDiv.className = "pf-chat-bubble user";
    userDiv.style.cssText =
      "align-self:flex-end;background:var(--accent-primary);color:var(--text-inverted);padding:8px 12px;border-radius:12px 12px 0 12px;max-width:80%;font-size:13px;";
    userDiv.textContent = text;
    history.appendChild(userDiv);
    input.value = "";
    history.scrollTop = history.scrollHeight;

    // Typing indicator
    const typingDiv = document.createElement("div");
    typingDiv.id = "typing-indicator";
    typingDiv.style.cssText =
      "align-self:flex-start;color:var(--text-secondary);font-size:12px;padding:8px;";
    typingDiv.innerHTML = "🐼 Pensando...";
    history.appendChild(typingDiv);
    history.scrollTop = history.scrollHeight;

    // Get response from SDK or mock
    let response;
    try {
      if (typeof Panda !== "undefined" && Panda.Brain) {
        response = await Panda.Brain.ask(text);

        // Auto-translate if enabled
        const settings = localStorage.getItem("pf_translation_settings");
        if (settings) {
          const prefs = JSON.parse(settings);
          if (prefs.enabled && prefs.scope !== "manual") {
            const detected = await Panda.Polyglot.detectLanguage(
              response.answer,
            );
            if (detected.code !== prefs.preferredLang) {
              const translated = await Panda.Polyglot.translate(
                response.answer,
                detected.code,
                prefs.preferredLang,
              );
              response.answer = translated;
            }
          }
        }
      } else {
        // Demo fallback
        response = {
          answer: getMockResponse(text),
          confidence: 0.85,
        };
      }
    } catch (e) {
      response = { answer: "Erro ao processar: " + e.message, confidence: 0 };
    }

    // Remove typing indicator
    const indicator = document.getElementById("typing-indicator");
    if (indicator) indicator.remove();

    // Bot Response
    const botDiv = document.createElement("div");
    botDiv.className = "pf-chat-bubble bot";
    botDiv.style.cssText =
      "align-self:flex-start;background:var(--bg-card);border:1px solid var(--border-subtle);color:var(--text-primary);padding:8px 12px;border-radius:12px 12px 12px 0;max-width:80%;font-size:13px;";
    botDiv.innerHTML = response.answer;
    history.appendChild(botDiv);
    history.scrollTop = history.scrollHeight;

    console.log("🐼 AI Response:", response);
  }

  function getMockResponse(input) {
    const lower = input.toLowerCase();
    if (lower.includes("cliente")) {
      return "Para criar um novo cliente, acesse <b>CRM > Novo Cliente</b> e preencha os campos obrigatórios.";
    } else if (lower.includes("financeiro") || lower.includes("resumo")) {
      return "📊 Resumo do mês: <b>R$ 45.200</b> em vendas, <b>23 novos leads</b>.";
    } else if (lower.includes("servidor") || lower.includes("status")) {
      return "✅ Todos os serviços operacionais. Rust Agent: <b>Conectado</b>.";
    } else {
      return "Entendi! Posso ajudar com CRM, análises ou configurações. (Demo)";
    }
  }

  document.getElementById("chat-input").addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendMessage();
  });

  console.log("🐼 Panda AI Sidebar v1.2 loaded (pf- prefix standard)");
</script>
      </div>

      <!-- Additional containers for lazy-loaded components -->
      <div id="treasury-container"></div>
      <div id="login-overlay-container"></div>
      <div id="tentacle-monitor-container"></div>

      <!-- INICIO VIEW (Clean Canvas) -->
      <div id="inicio-view" class="view-section active clean-canvas">
        <img src="10.assets/panda_logo.jpg" alt="Panda Fabrics" class="canvas-logo" />
      </div>

      <!-- MODULE VIEWPORT (for dynamic modules) -->
      <div id="module-viewport" style="display: none;"></div>

    </div>

    <!-- Component Loader (skip-if-loaded aware) -->
    <script src="2.system/core/loader.js"></script>

    <!-- Module Loader -->
    <script src="3.sdk/pf.module-loader.js" onerror="console.log('pf.module-loader.js not found')"></script>

    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("./sw.js")
            .then((reg) => console.log("ðŸ¼ ServiceWorker OK:", reg.scope))
            .catch((err) => console.log("âŒ ServiceWorker falhou:", err));
        });
      }
    </script>

    <style>
      .panda-loading-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--ds-background-100, #0a0a0f); z-index: 9999; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s ease-out; }
      .panda-loading-logo { width: 150px; height: 150px; object-fit: contain; animation: pulsePanda 1.5s ease-in-out infinite; }
      @keyframes pulsePanda { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } }
      .clean-canvas { position: relative; width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center; background: var(--ds-background-100, #0a0a0f); }
      .canvas-logo { width: 200px; height: 200px; object-fit: contain; opacity: 0.3; }
      .pf-fab-chat { position: fixed; bottom: 24px; right: 24px; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #667eea, #764ba2); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 24px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4); z-index: 3500; transition: all 0.3s ease; }
      .pf-fab-chat:hover { transform: scale(1.1); box-shadow: 0 6px 28px rgba(102, 126, 234, 0.6); }
    </style>

    <button class="pf-fab-chat" onclick="toggleSidebar()" title="ðŸ¼ Panda AI">ðŸ¼</button>

  </body>
</html>
