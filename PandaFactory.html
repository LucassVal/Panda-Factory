<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Panda Fabrics üêº</title>
    
    <!-- PWA Setup -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#667eea">
    <link rel="icon" type="image/png" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/core/Repository.js?v=reset_fix_v2"></script>
    
    <style>
      /*
       * üé® PANDA FABRICS - VERCEL/GEIST UI DESIGN SYSTEM
       * Tokens extracted from vercel.com/home
       * Version: 2.3.0
       */

      /*
       * üé® PANDA FABRICS - DUAL THEME SYSTEM (Fixed)
       * Light Mode: Chrome/Grey Modern
       * Dark Mode: Deep Vercel/Geist
       */
      :root {
        /* === PRIMITIVES (Palette) === */
        --color-white: #ffffff;
        --color-black: #000000;
        
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        --gray-950: #030712;

        /* === SEMANTIC VARIABLES (LIGHT DEFAULT - Chrome/Grey) === */
        --bg-app: #f0f2f5;           /* Clean Light Chrome/Grey */
        --bg-panel: rgba(255, 255, 255, 0.7);
        --bg-card: #ffffff;
        --bg-input: #ffffff;
        
        --text-primary: #111827;     /* Near Black */
        --text-secondary: #4b5563;   /* Mid Grey */
        --text-inverted: #ffffff;

        --border-subtle: #e5e7eb;    /* Light Grey Border */
        --border-focus: #9ca3af;

        --header-bg: rgba(240, 242, 245, 0.85); /* Matches App BG but blurred */
        
        --grid-color: rgba(0, 0, 0, 0.04);
        
        --shadow-card: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        --shadow-dock: 0 8px 30px rgba(0,0,0,0.12);

        /* Accents */
        --accent-primary: #0f172a;   /* Navy/Black for Primary Actions */
        --accent-success: #10b981;
        --accent-warning: #f59e0b;
        --accent-error: #ef4444;
        
        /* Font */
        --font-sans: 'Geist', 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        --radius-card: 12px;
        --radius-btn: 8px;
      }

      /* === DARK MODE OVERRIDES === */
      body.dark-mode {
        --bg-app: #0a0a0a;
        --bg-panel: rgba(20, 20, 20, 0.7);
        --bg-card: #111111;
        --bg-input: #000000;
        
        --text-primary: #ededed;
        --text-secondary: #888888;
        --text-inverted: #000000;

        --border-subtle: #333333;
        --border-focus: #555555;

        --header-bg: rgba(10, 10, 10, 0.8);
        
        --grid-color: rgba(255, 255, 255, 0.05);
        
        --shadow-card: 0 8px 32px rgba(0,0,0,0.3);
        --shadow-dock: 0 8px 32px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05) inset;
        
        --accent-primary: #ededed;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-sans);
        background-color: var(--bg-app);
        color: var(--text-primary);
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        background-image: linear-gradient(to right, var(--grid-color) 1px, transparent 1px),
                          linear-gradient(to bottom, var(--grid-color) 1px, transparent 1px);
        background-size: 40px 40px; /* Grid Pattern */
        transition: background-color 0.3s ease, color 0.3s ease;
      }

      /* Scrollbar */
      ::-webkit-scrollbar { width: 8px; }
      ::-webkit-scrollbar-track { background: var(--bg-app); }
      ::-webkit-scrollbar-thumb { background: var(--border-subtle); border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      /* Header Minimalista */
      .header {
        background: var(--header-bg);
        backdrop-filter: blur(12px);
        padding: 24px 0;
        border-bottom: 1px solid var(--border-subtle);
        margin-bottom: 40px;
        position: sticky;
        top: 0;
        z-index: 100;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: background 0.3s, border-color 0.3s;
      }
      
      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .header h1 {
        font-size: 24px;
        font-weight: 700;
        letter-spacing: -0.02em;
        /* Gradient Text adapts to theme? Or stay consistent? Let's make it follow text primary */
        color: var(--text-primary);
        background: none; /* Remove weird gradient for cleaner look */
        -webkit-text-fill-color: initial;
      }

      .version-badge {
        background: var(--bg-panel);
        border: 1px solid var(--border-subtle);
        color: var(--text-secondary);
        padding: 2px 8px; /* Fixed padding */
        border-radius: 6px;
        font-size: 11px;
        font-weight: 600;
        margin-left: 12px;
        vertical-align: middle;
      }

      /* Stat Cards Update */
      .stat-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-card);
        padding: 24px;
        transition: all 0.2s ease;
        box-shadow: var(--shadow-card);
      }
      .stat-card:hover {
        border-color: var(--border-focus);
        transform: translateY(-2px);
      }
      .stat-number { color: var(--text-primary); }
      .stat-label { color: var(--text-secondary); }

      /* Chart Cards Update */
      .chart-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-card);
        padding: 24px;
        box-shadow: var(--shadow-card);
      }
      .chart-title { color: var(--text-primary); }

      /* Client Cards Update */
      .client-card {
        background: var(--bg-card);
        border: 1px solid var(--border-subtle);
        border-radius: var(--radius-card);
        padding: 20px;
        transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
        cursor: pointer;
        box-shadow: var(--shadow-card);
      }
      .client-card:hover {
        border-color: var(--border-focus);
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }
      .client-name { color: var(--text-primary); }
      .client-info { color: var(--text-secondary); }
      .client-id { 
        background: var(--bg-app); 
        color: var(--text-secondary);
        border: 1px solid var(--border-subtle);
      }
      
      /* Inputs Update */
      .search-box input, .filter-select {
        background: var(--bg-input);
        border: 1px solid var(--border-subtle);
        color: var(--text-primary);
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      }
      .search-box input:focus, .filter-select:focus {
        border-color: var(--text-primary);
        outline: none;
      }
      
      /* Buttons Update */
      .btn-primary {
        background: var(--accent-primary);
        color: var(--bg-card); /* Inverted text for primary button */
        border: 1px solid var(--accent-primary);
      }
      .btn-primary:hover { opacity: 0.9; }
      
      .btn-secondary {
        background: var(--bg-card);
        color: var(--text-primary);
        border: 1px solid var(--border-subtle);
      }
      .btn-secondary:hover { background: var(--bg-app); }

      /* User Info Colors */
      #userLoginInfo span { color: var(--text-primary) !important; }
      #userLoginInfo span[style*="font-size:10px"] { color: var(--text-secondary) !important; }


      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .header h1 {
        font-size: 24px;
        font-weight: 700;
        letter-spacing: -0.02em;
        background: linear-gradient(180deg, #fff, #888);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .version-badge {
        background: #1a1a1a;
        border: 1px solid #333;
        color: #888;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: 500;
        margin-left: 12px;
        vertical-align: middle;
      }

      /* Status/Stats Grid */
      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-card);
        padding: 24px;
        transition: all 0.2s ease;
      }
      .stat-card:hover {
        border-color: #555;
        box-shadow: var(--accent-glow);
      }

      .stat-number {
        font-size: 32px;
        font-weight: 600;
        letter-spacing: -0.03em;
        color: #fff;
      }
      .stat-label {
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: 4px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      /* Charts & Content Cards */
      .charts-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
      }

      .chart-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-card);
        padding: 24px;
      }

      .chart-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      /* Clients Grid & Cards (Geist Style) */
      .clients-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 20px;
        padding-bottom: 100px; /* Space for dock */
      }

      .client-card {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-card);
        padding: 20px;
        transition: all 0.2s cubic-bezier(0.2, 0, 0, 1);
        position: relative;
        overflow: hidden;
        cursor: pointer;
      }

      .client-card:hover {
        border-color: #666;
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        transform: translateY(-2px);
      }

      .client-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .client-id {
        font-family: 'Geist Mono', monospace;
        font-size: 11px;
        color: #555;
        background: #111;
        padding: 2px 6px;
        border-radius: 4px;
        border: 1px solid #222;
      }

      .status-label {
        font-size: 11px;
        font-weight: 500;
        padding: 4px 10px;
        border-radius: 20px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      /* Status Colors */
      .status-nao_acompanhando-label { background: #222; color: #888; border: 1px solid #333; }
      .status-em_acompanhamento-label { background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2); }
      .status-com_orcamento-label { background: rgba(59, 130, 246, 0.1); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.2); }
      .status-fechado-label { background: #fff; color: #000; border: 1px solid #fff; font-weight: 700; box-shadow: 0 0 10px rgba(255,255,255,0.3); }
      .status-finalizado-label { background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); }

      .client-name {
        font-size: 16px;
        font-weight: 600;
        color: #ededed;
        margin-bottom: 12px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .client-info {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: #888;
        margin-bottom: 6px;
      }

      .badges {
        display: flex;
        gap: 6px;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid #222;
      }

      .badge {
        font-size: 11px;
        padding: 3px 8px;
        border-radius: 4px;
        background: #151515;
        color: #666;
        border: 1px solid #222;
      }

      /* Controls & Toolbar */
      .controls {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: var(--radius-card);
        padding: 20px;
        margin-bottom: 40px;
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        align-items: center;
      }

      /* Inputs Geist Style */
      .search-box input, .filter-select {
        background: #000;
        border: 1px solid #333;
        color: #fff;
        padding: 10px 16px;
        border-radius: var(--radius-btn);
        font-family: var(--font-sans);
        font-size: 14px;
        transition: border 0.2s;
        min-width: 250px;
      }
      .search-box input:focus, .filter-select:focus {
        outline: none;
        border-color: #fff;
      }

      /* Buttons Geist Style */
      .btn {
        padding: 10px 20px;
        border-radius: var(--radius-btn);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid transparent;
      }

      .btn-primary {
        background: #fff;
        color: #000;
        border: 1px solid #fff;
      }
      .btn-primary:hover {
        background: #e5e5e5;
        border-color: #e5e5e5;
      }

      .btn-success { background: #000; color: #10b981; border: 1px solid #10b981; }
      .btn-success:hover { background: rgba(16, 185, 129, 0.1); }

      .btn-secondary {
        background: #000;
        color: #fff;
        border: 1px solid #333;
      }
      .btn-secondary:hover {
        border-color: #666;
      }

      /* Energy Bar - Cyberpunk Style */
      .energy-container {
        background: #111;
        border: 1px solid #333;
        padding: 6px 14px;
        border-radius: 30px;
      }
      .energy-text { color: var(--text-secondary); font-size: 12px; }
      .energy-bar { background: #222; }
      .energy-fill { background: #fff; box-shadow: 0 0 10px rgba(255,255,255,0.5); }
      .energy-icon { color: #fff; }

      
      /* APP DOCK - Draggable Glassmorphism (Themed) */
      .app-dock {
        position: fixed;
        /* Default position */
        bottom: 30px;
        left: 50%;
        transform: none; 
        
        /* THEMED BACKGROUND */
        background: var(--bg-panel); /* Uses alpha from theme */
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        
        padding: 8px 12px;
        border-radius: 20px;
        border: 1px solid var(--border-subtle);
        
        display: flex;
        align-items: center;
        gap: 8px; /* More gap for delineation */
        
        z-index: 9999;
        box-shadow: var(--shadow-dock);
        
        user-select: none;
        touch-action: none; 
        transition: box-shadow 0.2s, opacity 0.2s, background-color 0.3s;
        cursor: default;
      }
      .app-dock:hover {
        box-shadow: 0 12px 48px rgba(0,0,0,0.25), 0 0 0 1px var(--border-focus) inset; /* Lighter shadow in light mode */
      }
      .app-dock.dragging {
        opacity: 0.9;
        cursor: grabbing;
        transform: scale(1.02);
      }
      
      /* Drag Handle (Grip) */
      .dock-handle {
        width: 24px;
        height: 36px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 3px;
        cursor: grab;
        padding: 0 4px;
        border-radius: 8px;
        margin-right: 4px;
        transition: background 0.2s;
      }
      .dock-handle span {
        width: 14px;
        height: 2px;
        background: var(--text-secondary);
        border-radius: 1px;
        opacity: 0.5;
      }
      .dock-handle:hover span {
        background: var(--text-primary);
        opacity: 1;
      }

      /* Nav Separator */
      .nav-separator {
        width: 1px;
        height: 24px;
        background: var(--border-subtle);
        margin: 0 4px;
      }
      
      /* Nav Items - Delineated */
      .nav-item {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        
        /* Default State - Subtle Delineation */
        background: var(--bg-app); /* Subtle contrast against panel */
        border: 1px solid transparent; /* Ready for border */
        color: var(--text-secondary);
        
        transition: all 0.2s cubic-bezier(0.25, 1, 0.5, 1);
        cursor: pointer;
        position: relative;
      }
      
      .nav-item:hover {
        background: var(--bg-card);
        border-color: var(--border-subtle);
        color: var(--text-primary);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      }
      
      .nav-item.active {
        background: var(--bg-input); /* Lightest/Darkest bg */
        border-color: var(--border-focus);
        color: var(--text-primary);
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      }
      
      .logout-btn:hover {
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.2);
        color: #ef4444;
      }
      
      /* Tooltip Themed */
      .nav-item[title]:hover::after {
        content: attr(title);
        position: absolute;
        bottom: 56px;
        left: 50%;
        transform: translateX(-50%);
        
        background: var(--accent-primary);
        color: var(--text-inverted);
        border: 1px solid var(--accent-primary);
        
        font-family: var(--font-sans);
        padding: 6px 12px;
        font-size: 11px;
        font-weight: 500;
        border-radius: 8px;
        white-space: nowrap;
        pointer-events: none;
        z-index: 10000;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        animation: tooltipFadeIn 0.15s ease-out;
      }

      @keyframes tooltipFadeIn {
        from { opacity: 0; transform: translateX(-50%) translateY(5px); }
        to { opacity: 1; transform: translateX(-50%) translateY(0); }
      }


      /* Panda FAB (Floating Action Button) */
      #panda-fab {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        z-index: 1000;
        transition: transform 0.2s;
        color: white;
        user-select: none;
      }
      #panda-fab:hover { transform: scale(1.1); }

      
      .nav-item.logout-btn:hover {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
      }

      /* Modal Theme Dark */
      .modal-content {
        background: #0a0a0a !important;
        border: 1px solid #333;
        box-shadow: 0 20px 60px rgba(0,0,0,0.7);
        color: #fff;
      }
      .modal-header {
        background: #0a0a0a !important;
        border-bottom: 1px solid #333;
        color: #fff !important;
      }
      .modal-header h2 { color: #fff !important; }

      /* ===== SETTINGS MODAL ===== */
      .settings-overlay {
        display: none;
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.8);
        backdrop-filter: blur(8px);
        z-index: 10000;
        animation: fadeIn 0.2s ease;
      }
      .settings-overlay.active { display: flex; align-items: center; justify-content: center; }
      
      .settings-modal {
        width: 800px;
        max-width: 90vw;
        height: 600px;
        max-height: 85vh;
        background: #0a0a0a;
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 16px;
        display: flex;
        overflow: hidden;
        box-shadow: 0 30px 80px rgba(0,0,0,0.8);
      }
      
      .settings-sidebar {
        width: 200px;
        background: #050505;
        border-right: 1px solid rgba(255,255,255,0.08);
        padding: 20px 0;
      }
      
      .settings-nav-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 20px;
        color: #888;
        cursor: pointer;
        transition: all 0.15s ease;
        font-size: 14px;
      }
      .settings-nav-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
      .settings-nav-item.active { 
        background: rgba(16, 185, 129, 0.1); 
        color: #10b981; 
        border-left: 2px solid #10b981;
      }
      .settings-nav-item i { width: 20px; font-size: 16px; }
      
      .settings-content {
        flex: 1;
        padding: 30px;
        overflow-y: auto;
      }
      
      .settings-section-title {
        font-size: 24px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 8px;
      }
      .settings-section-desc {
        color: #666;
        font-size: 14px;
        margin-bottom: 30px;
      }
      
      .settings-card {
        background: #111;
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 16px;
      }
      
      .settings-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid rgba(255,255,255,0.05);
      }
      .settings-row:last-child { border-bottom: none; }
      
      .settings-label {
        font-size: 14px;
        color: #ededed;
      }
      .settings-sublabel {
        font-size: 12px;
        color: #666;
        margin-top: 4px;
      }
      
      /* Toggle Switch */
      .toggle-switch {
        position: relative;
        width: 44px;
        height: 24px;
        background: #333;
        border-radius: 12px;
        cursor: pointer;
        transition: background 0.2s;
      }
      .toggle-switch.active { background: #10b981; }
      .toggle-switch::after {
        content: '';
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        background: #fff;
        border-radius: 50%;
        transition: transform 0.2s;
      }
      .toggle-switch.active::after { transform: translateX(20px); }
      
      /* GPU Status Badge */
      .gpu-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid rgba(16, 185, 129, 0.3);
        color: #10b981;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 13px;
      }
      .gpu-badge.offline {
        background: rgba(239, 68, 68, 0.1);
        border-color: rgba(239, 68, 68, 0.3);
        color: #ef4444;
      }
      
      /* Store Grid */
      .store-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 16px;
      }
      .store-card {
        background: #111;
        border: 1px solid rgba(255,255,255,0.08);
        border-radius: 12px;
        padding: 16px;
        transition: all 0.2s;
        cursor: pointer;
      }
      .store-card:hover { 
        border-color: #10b981; 
        transform: translateY(-2px);
      }
      .store-card-icon { font-size: 32px; margin-bottom: 12px; }
      .store-card-title { font-size: 14px; font-weight: 600; color: #fff; }
      .store-card-desc { font-size: 12px; color: #666; margin-top: 4px; }
      

      
      .nav-separator {
        width: 1px;
        background: #e2e8f0;
        margin: 0 5px;
      }
      
      .logout-btn:hover {
        background: #fee2e2;
        color: #b91c1c;
      }

      /* PANDA FAB (Bot√£o Flutuante) */
      .panda-fab {
        position: fixed;
        bottom: 100px; /* Acima do Dock */
        right: 30px;
        width: 60px;
        height: 60px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 5px 25px rgba(0,0,0,0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 30px;
        cursor: pointer;
        z-index: 1000;
        border: 2px solid white;
        transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        animation: floatPanda 4s ease-in-out infinite;
      }
      .panda-fab:hover {
        transform: scale(1.1) rotate(10deg);
        box-shadow: 0 10px 40px rgba(0,0,0,0.25);
      }
      @keyframes floatPanda {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-10px); }
      }

      .view-section { animation: fadeIn 0.3s ease; display: none; }
      .view-section.active { display: block; }
      /* Agenda and Reports as overlays - appear above other content */
      #agenda-view, #reports-view { 
        position: relative;
        z-index: 10;
        margin-bottom: 30px;
      }
      /* Inicio and Contatos are mutually exclusive */
      #inicio-view, #contatos-view { position: relative; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

      /* Agenda Styles */
      .agenda-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
      .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); }
      .calendar-day-header { text-align: center; font-weight: bold; padding: 10px; color: #666; }
      .calendar-day { min-height: 120px; border: 1px solid #eee; border-radius: 8px; padding: 8px; transition: all 0.2s; background: #fafafa; }
      .calendar-day:hover { border-color: #667eea; background: white; }
      .day-today { background: #eef2ff; border-color: #667eea; }
      .calendar-event { font-size: 11px; padding: 4px 6px; margin-bottom: 4px; border-radius: 4px; background: white; border-left: 3px solid #ccc; box-shadow: 0 1px 3px rgba(0,0,0,0.1); cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .event-pending { border-left-color: #f59e0b; background: #fffbeb; }
      .event-done { border-left-color: #10b981; background: #ecfdf5; }
      .event-late { border-left-color: #ef4444; background: #fef2f2; }

      /* Dashboard Styles */
      .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
      .metric-card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-bottom: 4px solid transparent; }
      .metric-value { font-size: 24px; font-weight: 800; color: #333; }
      .metric-label { font-size: 12px; color: #666; text-transform: uppercase; letter-spacing: 0.5px; }
      .performance-table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 30px; }
      .performance-table th { background: #f8fafc; padding: 15px; text-align: left; font-weight: 600; color: #64748b; }
      .performance-table td { padding: 15px; border-bottom: 1px solid #f1f5f9; color: #334155; }

      /* AGENDA SIDEBAR */
      .agenda-sidebar {
          position: fixed; top: 0; right: -400px; width: 350px; height: 100vh;
          background: white; box-shadow: -5px 0 30px rgba(0,0,0,0.1);
          transition: right 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
          z-index: 2000; padding: 25px; overflow-y: auto;
      }
      .agenda-sidebar.active { right: 0; }
      .agenda-sidebar h3 { border-bottom: 2px solid #f3f4f6; padding-bottom: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center; color:#333; }
      .agenda-item-card {
          background: #f8fafc; border-left: 4px solid #667eea; padding: 15px;
          border-radius: 8px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s;
          box-shadow: 0 2px 5px rgba(0,0,0,0.03);
      }
      .agenda-item-card:hover { transform: translateX(-3px); background: #f1f5f9; box-shadow: 0 4px 8px rgba(0,0,0,0.08); }
      .agenda-time { font-weight: bold; color: #667eea; font-size: 13px; margin-bottom: 4px; display:block; }
      .agenda-client { font-weight: 700; color: #333; font-size: 15px; margin-bottom: 4px; display:block; }
      .agenda-desc { color: #666; font-size: 13px; line-height: 1.4; }
      
      .overlay-backdrop {
          position: fixed; top: 0; left: 0; width: 100%; height: 100%;
          background: rgba(0,0,0,0.3); z-index: 1999;
          display: none; backdrop-filter: blur(2px);
      }
      .overlay-backdrop.active { display: block; }
      
      


      /* QUICK FILTERS */
      .filter-tag { background: white; border: 1px solid #cbd5e1; padding: 6px 14px; border-radius: 20px; font-size: 13px; cursor: pointer; transition: all 0.2s; color: #475569; display:flex; align-items:center; gap:5px; }
      .filter-tag:hover { background: #e2e8f0; color: #1e293b; }
      .filter-tag.active { background: #667eea; color: white; border-color: #667eea; }

      /* KANBAN CSS */
      .kanban-container {
        display: none; /* Toggle via JS */
        overflow-x: auto;
        padding-bottom: 20px;
        align-items: flex-start;
        gap: 20px;
        height: calc(100vh - 250px);
      }
      
      .kanban-container.active {
        display: flex;
      }

      .kanban-column {
        min-width: 320px;
        max-width: 320px;
        background: #f4f5f7;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        max-height: 100%;
      }

      .kanban-header {
        padding: 15px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 2px solid #e0e0e0;
        position: sticky;
        top: 0;
        background: inherit;
        border-radius: 10px 10px 0 0;
        z-index: 10;
      }

      .kanban-body {
        padding: 10px;
        overflow-y: auto;
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .drag-over {
        background: #e2e4e9;
        border: 2px dashed #667eea;
      }

      .kanban-card {
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        cursor: grab;
      }
      
      .kanban-card:active {
        cursor: grabbing;
      }

      /* WHATSAPP & CONFIG CSS */
      .config-btn {
        background: #6b7280;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 12px;
        cursor: pointer;
        margin-left: 5px;
        border: none;
      }
      
      .phone-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
        align-items: center;
      }
      
      .btn-icon {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 16px;
      }
      
      .btn-whatsapp {
        background: #25D366;
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: transform 0.2s;
      }
      
      .btn-whatsapp:hover {
        transform: scale(1.1);
      }
      
      .template-card {
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 8px;
        cursor: pointer;
      }
      
      .template-card:hover {
        background: #f0fdf4;
        border-color: #25D366;
      }

      /* Upload de HTML */
      .upload-area {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 2000;
        align-items: center;
        justify-content: center;
      }

      .upload-box {
        background: white;
        padding: 40px;
        border-radius: 15px;
        max-width: 600px;
        text-align: center;
      }

      .upload-box h2 {
        margin-bottom: 20px;
        color: #333;
      }

      .file-input-wrapper {
        margin: 20px 0;
        padding: 40px;
        border: 3px dashed #667eea;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .file-input-wrapper:hover {
        background: #f0f0ff;
        border-color: #5568d3;
      }

      .file-input-wrapper input[type="file"] {
        display: none;
      }

      .clients-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
      }

      .client-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        cursor: pointer;
        transition: all 0.3s;
        position: relative;
        overflow: hidden;
      }

      .client-card.status-nao_acompanhando {
        background: white;
      }

      .client-card.status-em_acompanhamento {
        background: rgba(34, 197, 94, 0.3);
      }

      .client-card.status-com_orcamento {
        background: rgba(234, 179, 8, 0.5);
      }

      .client-card.status-fechado {
        background: rgba(34, 197, 94, 0.8);
      }

      .client-card.status-finalizado {
        background: rgba(239, 68, 68, 0.6);
      }

      .client-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 5px;
        height: 100%;
        background: linear-gradient(135deg, #667eea, #764ba2);
      }

      .client-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }

      .client-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 15px;
      }

      .client-id {
        background: #f0f0f0;
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        color: #666;
      }

      .status-label {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 11px;
        font-weight: bold;
        color: white;
      }

      .status-nao_acompanhando-label {
        background: #9ca3af;
      }

      .status-em_acompanhamento-label {
        background: #22c55e;
      }

      .status-com_orcamento-label {
        background: #eab308;
      }

      .status-fechado-label {
        background: #16a34a;
      }

      .status-finalizado-label {
        background: #ef4444;
      }

      .client-name {
        font-size: 20px;
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
      }

      .client-info {
        color: #666;
        font-size: 14px;
        margin: 5px 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .badges {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        flex-wrap: wrap;
      }

      .badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }

      .badge-notes {
        background: #e3f2fd;
        color: #1976d2;
      }

      .badge-returns {
        background: #f3e5f5;
        color: #7b1fa2;
      }

      .badge-prospect {
        background: #fff3e0;
        color: #f57c00;
      }


      .agenda-drawer {
        position: fixed;
        top: 70px;
        right: 0;
        width: 450px;
        height: calc(100vh - 70px);
        background: white;
        box-shadow: -2px 0 10px rgba(0,0,0,0.1);
        z-index: 2000;
        transform: translateX(100%);
        transition: transform 0.3s ease;
        overflow-y: auto;
        padding: 20px;
      }
      
      .agenda-drawer.active {
        transform: translateX(0);
      }


      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 1000;
        overflow-y: auto;
        padding: 20px;
      }

      .modal-content {
        background: white;
        max-width: 900px;
        min-width: 600px;
        min-height: 400px;
        margin: 50px auto;
        border-radius: 15px;
        padding: 30px;
        position: relative;
      }

      /* Config e WhatsApp Modals */
      #configModal .modal-content,
      #whatsappModal .modal-content {
        min-width: 700px;
        min-height: 500px;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 20px;
        border-bottom: 2px solid #f0f0f0;
      }

      .close-btn {
        background: #f44336;
        color: white;
        border: none;
        width: 35px;
        height: 35px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .close-btn:hover {
        background: #d32f2f;
      }

      .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        border-bottom: 2px solid #f0f0f0;
        flex-wrap: wrap;
      }

      .tab {
        padding: 12px 24px;
        cursor: pointer;
        border: none;
        background: none;
        font-size: 15px;
        font-weight: 600;
        color: #666;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
      }

      .tab.active {
        color: #667eea;
        border-bottom-color: #667eea;
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .info-item {
        padding: 15px;
        background: #f9f9f9;
        border-radius: 8px;
      }

      .info-label {
        font-size: 12px;
        color: #666;
        font-weight: 600;
        margin-bottom: 5px;
        text-transform: uppercase;
      }

      .info-value {
        font-size: 15px;
        color: #333;
      }

      .status-section {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .status-selector {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-bottom: 15px;
      }

      .status-option {
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s;
        font-weight: 600;
      }

      .status-option:hover {
        transform: scale(1.05);
      }

      .status-option.selected {
        border-color: #667eea;
        border-width: 3px;
      }

      .status-option.nao_acompanhando {
        background: white;
        color: #666;
      }

      .status-option.em_acompanhamento {
        background: rgba(34, 197, 94, 0.3);
        color: #166534;
      }

      .status-option.com_orcamento {
        background: rgba(234, 179, 8, 0.5);
        color: #713f12;
      }

      .status-option.fechado {
        background: rgba(34, 197, 94, 0.8);
        color: white;
      }

      .status-option.finalizado {
        background: rgba(239, 68, 68, 0.6);
        color: white;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #333;
      }

      .form-label.required::after {
        content: " *";
        color: #ef4444;
      }

      .form-input,
      .form-textarea {
        width: 100%;
        padding: 10px;
        border: 2px solid #e0e0e0;
        border-radius: 6px;
        font-size: 14px;
        font-family: inherit;
      }

      .form-textarea {
        resize: vertical;
        min-height: 80px;
      }

      .form-input:focus,
      .form-textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      .add-form {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .item-list {
        max-height: 400px;
        overflow-y: auto;
      }

      .item {
        background: white;
        border: 2px solid #f0f0f0;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .item-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 10px;
      }

      .item-date {
        font-size: 12px;
        color: #666;
      }

      .item-actions {
        display: flex;
        gap: 5px;
      }

      .item-btn {
        padding: 5px 10px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }

      .btn-edit {
        background: #2196f3;
        color: white;
      }

      .btn-delete {
        background: #f44336;
        color: white;
      }

      .status-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        display: inline-block;
      }

      .status-agendado {
        background: #fff3e0;
        color: #f57c00;
      }

      .status-concluido {
        background: #e8f5e9;
        color: #2e7d32;
      }

      .status-cancelado {
        background: #ffebee;
        color: #c62828;
      }

      .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        font-weight: 600;
      }

      .alert-warning {
        background: #fef3c7;
        color: #92400e;
        border: 2px solid #fbbf24;
      }

      .alert-success {
        background: #d1fae5;
        color: #065f46;
        border: 2px solid #34d399;
      }

      @media (max-width: 768px) {
        .clients-grid {
          grid-template-columns: 1fr;
        }

        .controls {
          flex-direction: column;
        }

        .search-box {
          width: 100%;
        }

        .charts-section {
          grid-template-columns: 1fr;
        }
      }
    </style>
      <!-- OMNI-BAR (SPOTLIGHT) -->
    <style>
        #omni-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); z-index: 9999;
            align-items: flex-start; justify-content: center; padding-top: 15vh;
        }
        #omni-bar {
            width: 600px; max-width: 90%; background: var(--surface); 
            border: 1px solid var(--border); border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); overflow: hidden;
            animation: slideDown 0.2s ease-out;
        }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .omni-input-wrapper { display: flex; align-items: center; padding: 16px; border-bottom: 1px solid var(--border); }
        .omni-icon { font-size: 20px; color: var(--text-secondary); margin-right: 12px; }
        #omni-input {
            flex: 1; background: transparent; border: none; font-size: 18px; color: var(--text-primary); outline: none;
        }
        .omni-model-badge {
            font-size: 12px; background: rgba(var(--primary-rgb), 0.1); color: var(--primary);
            padding: 4px 8px; border-radius: 4px; border: 1px solid rgba(var(--primary-rgb), 0.2);
            cursor: pointer; transition: all 0.2s;
        }
        .omni-model-badge:hover { background: rgba(var(--primary-rgb), 0.2); }

        #omni-results { max-height: 400px; overflow-y: auto; }
        .omni-item {
            padding: 12px 16px; display: flex; align-items: center; cursor: pointer;
            border-left: 2px solid transparent; color: var(--text-secondary);
        }
        .omni-item:hover, .omni-item.active {
            background: rgba(255,255,255,0.05); color: var(--text-primary); border-left-color: var(--primary);
        }
        .omni-item-icon { width: 24px; text-align: center; margin-right: 12px; font-size: 16px; }
        .omni-item-content { flex: 1; }
        .omni-item-title { font-weight: 500; }
        .omni-item-desc { font-size: 12px; opacity: 0.7; }
        .omni-shortcut { font-size: 11px; background: #333; padding: 2px 6px; border-radius: 4px; color: #aaa; }
    </style>

  
<style>
/* Settings Modal Specifics */
.glass-panel {
    background: var(--card-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    border-radius: 12px;
}

.setting-tab:hover {
    background: rgba(0,0,0,0.1);
}
.setting-tab.active {
    background: var(--primary-color, #00E676);
    color: #000;
    font-weight: bold;
}

/* Toggle Switch */
.switch {
  position: relative;
  display: inline-block;
  width: 40px;
  height: 20px;
}
.switch input { 
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  -webkit-transition: .4s;
  transition: .4s;
}
.slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  -webkit-transition: .4s;
  transition: .4s;
}
input:checked + .slider {
  background-color: var(--primary-color, #00E676);
}
input:checked + .slider:before {
  -webkit-transform: translateX(20px);
  -ms-transform: translateX(20px);
  transform: translateX(20px);
}
.slider.round {
  border-radius: 34px;
}
.slider.round:before {
  border-radius: 50%;
}

/* Developer Tools Dock (Vertical, Right Side) */
.dev-tools-dock {
  position: fixed;
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
  
  display: flex !important;
  visibility: visible !important;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  
  background: rgba(255, 255, 255, 0.9);
  backdrop-filter: blur(20px);
  border-radius: 16px;
  padding: 12px 8px;
  border: 1px solid var(--border-subtle);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
  
  z-index: 5500;
  cursor: grab;
  transition: all 0.3s ease;
  user-select: none; /* Prevent text selection during drag */
  -webkit-user-select: none;
  -moz-user-select: none;
}

body.dark-mode .dev-tools-dock {
  background: rgba(30, 30, 30, 0.95);
}

.dev-tools-dock:hover {
  box-shadow: 0 12px 48px rgba(0, 0, 0, 0.18);
  border-color: var(--accent-primary);
}

.dev-dock-handle {
  display: flex;
  gap: 3px;
  padding: 6px 0;
  cursor: grab;
  align-items: center;
}

.dev-dock-handle span {
  width: 3px;
  height: 3px;
  background: var(--text-secondary);
  border-radius: 50%;
  opacity: 0.4;
}

.dev-dock-handle:hover span {
  opacity: 0.8;
}

.dev-dock-item {
  width: 44px;
  height: 44px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.dev-dock-item:hover {
  background: var(--bg-card-hover);
  transform: scale(1.1);
}

.dev-dock-item:active {
  transform: scale(0.95);
}

.dev-separator {
  width: 30px;
  height: 1px;
  background: var(--border-subtle);
  margin: 4px 0;
}

/* Dock Rotation Button (Both Docks) */
.dock-rotate-btn {
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  background: transparent;
  margin-bottom: 8px;
}

.dock-rotate-btn:hover {
  background: var(--bg-card-hover);
  transform: rotate(180deg);
}

/* Standardized Handle Bars (3 horizontal bars) */
.dock-handle, .dev-dock-handle {
  display: flex;
  flex-direction: column;
  gap: 3px;
  padding: 8px 0;
  cursor: grab;
  align-items: center;
}

.handle-bar {
  width: 24px;
  height: 3px;
  background: var(--text-secondary);
  border-radius: 2px;
  opacity: 0.5;
  transition: opacity 0.2s;
}

.dock-handle:hover .handle-bar,
.dev-dock-handle:hover .handle-bar {
  opacity: 1;
}

/* ============================================= */
/* NEW MODULAR DOCKS - Clean Glassmorphism */
/* ============================================= */

.modular-dock {
  position: fixed;
  z-index: 5000;
  display: flex;
  flex-direction: column;
  padding: 12px;
  background: var(--bg-panel);
  backdrop-filter: blur(20px);
  border-radius: 16px;
  border: 1px solid var(--border-subtle);
  box-shadow: var(--shadow-elevation-high);
  transition: all 0.3s ease;
}

.modular-dock:hover {
  box-shadow: 0 12px 48px rgba(0,0,0,0.2);
  border-color: var(--border-focus);
}

/* Left Dock - Vertical, Centered */
.left-dock {
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
}

/* Right Dock - Vertical, Centered */
.right-dock {
  right: 20px;
  top: 50%;
  transform: translateY(-50%);
}

.dock-items {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.dock-item {
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  position: relative;
}

.dock-item:hover {
  background: var(--bg-card-hover);
  transform: scale(1.1);
}

.dock-item:active {
  transform: scale(0.95);
}

.dock-separator {
  width: 100%;
  height: 2px;
  background: var(--border-subtle);
  margin: 4px 0;
  border-radius: 1px;
}

</style>


<style>
/* OMNI BAR INTEGRATED STYLES */
.omni-bar-container {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    
    width: 650px;
    max-width: 90vw;
    background: var(--bg-panel);
    backdrop-filter: blur(15px);
    border-radius: 10px;
    border: 1px solid var(--border-subtle);
    box-shadow: var(--shadow-dock);
    
    z-index: 5000;
    transition: box-shadow 0.2s;
    display: flex;
    flex-direction: column;
    
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    touch-action: none;
    pointer-events: auto;
}

.omni-bar-container:hover {
    box-shadow: 0 12px 48px rgba(0,0,0,0.2);
    border-color: var(--border-focus);
}
.omni-bar-container.focused {
    box-shadow: 0 0 0 2px var(--ds-info);
    background: var(--bg-card);
}

/* Chat expands UPWARD */
.omni-bar-container {
    flex-direction: column-reverse; /* Input at bottom, chat grows upward */
}

.omni-input-wrapper {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    gap: 12px;
    height: 60px;
    background: transparent;
    width: 100%;
}

.omni-chat-area {
    display: none; /* Hidden by default */
    min-height: 200px;
    max-height: 220px; /* ~10 lines limit when collapsed */
    height: 400px; /* Default expanded height */
    overflow-y: auto;
    padding: 16px;
    border-bottom: 1px solid var(--border-subtle);
    position: relative;
    resize: vertical;
    transition: max-height 0.3s ease;
}

.omni-chat-area.collapsed {
    max-height: 220px; /* 10 lines */
}

.omni-chat-area.expanded {
    max-height: 600px; /* Full expansion */
}

/* Expand Button */
.chat-expand-btn {
    position: absolute;
    bottom: 8px;
    right: 8px;
    padding: 6px 12px;
    background: var(--accent-primary);
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    transition: all 0.2s;
    z-index: 10;
}

.chat-expand-btn:hover {
    background: var(--ds-info);
    transform: scale(1.05);
}

/* Resize handle indicator */
.omni-chat-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 4px;
    background: var(--text-secondary);
    border-radius: 2px;
    opacity: 0.3;
    cursor: ns-resize;
}

.omni-chat-area:hover::before {
    opacity: 0.6;
}

.omni-icon {
    font-size: 20px;
    color: var(--text-secondary);
}

#omni-input {
    flex: 1;
    background: transparent;
    border: none;
    font-size: 18px;
    color: var(--text-primary);
    font-family: var(--font-sans);
    outline: none;
    user-select: text;
    -webkit-user-select: text;
}
#omni-input::placeholder {
    color: var(--text-secondary);
    opacity: 0.7;
}

/* App Dock - Horizontal Navigation */
.app-dock {
  position: fixed;
  bottom: 20px;
  left: 20px;
  z-index: 5000;
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 16px;
  background: var(--bg-panel);
  border: 1px solid var(--border-subtle);
  border-radius: 16px;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-elevation-high);
  cursor: grab;
}

.omni-model-badge {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    background: var(--bg-app);
    border: 1px solid var(--border-subtle);
    border-radius: 8px;
    font-size: 12px;
    font-weight: 600;
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s;
}
.omni-model-badge:hover {
    background: var(--bg-card);
    border-color: var(--text-secondary);
}

.omni-shortcut-badge {
    background: rgba(0,0,0,0.05);
    border: 1px solid var(--border-subtle);
    border-radius: 6px;
    padding: 4px 8px;
    font-size: 11px;
    color: var(--text-secondary);
    font-weight: 600;
}

/* Dropdown */
.omni-results-dropdown {
    border-top: 1px solid var(--border-subtle);
    max-height: 400px;
    overflow-y: auto;
    padding: 10px;
}

/* Hide the old overlay overlay */
#omni-overlay { display: none !important; }

/* Panda FAB Position Refinement - to avoid overlapping if needed */
#panda-fab {
    bottom: 120px; /* Shifted up slightly */
    z-index: 4000;
}
</style>


    <style>
      /* === VISUAL REFINEMENTS (Gradient Body + Logo Fix) === */
      
      body {
        /* Subtle Gradient Background for both modes */
        background: radial-gradient(circle at 50% 0%, var(--bg-app) 0%, var(--bg-card) 100%);
        /* Fallback if var not ready, but they are defined in root */
        background-color: var(--bg-app);
      }
      
      body.dark-mode {
        background: radial-gradient(circle at 50% 0%, #171717 0%, #0a0a0a 100%);
      }

      /* Header Refinement */
      .header {
        /* Premium Floating Header */
        margin: 15px 24px;
        border-radius: 24px;
        border: 1px solid var(--border-subtle);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08); /* Soft Premium Shadow */
        
        /* Glass Effect */
        background: rgba(255, 255, 255, 0.85); 
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }
      
      /* Dark Mode Adaptation for Header */
      body.dark-mode .header {
        background: rgba(20, 20, 20, 0.85);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      }
      
      /* LOGO ISOLATION FIX */
      .header h1 {
        display: flex; 
        align-items: center; 
        gap: 8px;
        color: var(--text-primary);
        font-size: 24px;
        font-weight: 700;
        letter-spacing: -0.02em;
        background: none !important; 
        -webkit-text-fill-color: initial !important; 
        /* Reset parent gradient usage */
      }
      
      /* Apply gradient ONLY to the Text Span (Panda F√°brica) */
      .header h1 span:last-child {
        background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 800;
      }
      
      /* Ensure Panda Emoji is normal */
      .header h1 span:first-child {
        font-size: 24px;
        filter: none;
        -webkit-text-fill-color: initial;
      }
    </style>


<style>
/* New Omni Controls */
.omni-action-btn {
    width: 28px; height: 28px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 6px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
}
.omni-action-btn:hover {
    background: var(--bg-card-hover);
    color: var(--text-primary);
}
.omni-model-badge {
    /* Existing style override if needed */
    user-select: none;
}
</style>


<style>
/* Chat Expansion Styles */
.omni-chat-area {
    border-top: 1px solid var(--border-subtle);
    background: rgba(0,0,0,0.02);
    min-height: 150px;
    max-height: 500px;
    overflow-y: auto;
    padding: 15px;
    display: none; /* Hidden by default */
    animation: slideDown 0.2s ease-out;
}
@keyframes slideDown {
    from { height: 0; opacity: 0; }
    to { height: 150px; opacity: 1; }
}

/* Ensure minimize button is visible */
.omni-action-btn i {
    color: var(--text-secondary); /* Ensure contrast */
}
</style>


<style>
/* Ensure Minimize Icon Contrast */
.omni-action-btn i.fa-minus {
    color: var(--text-secondary);
    font-size: 14px;
}
/* Ensure FAB is above Dock */
#panda-fab {
    z-index: 6000;
    bottom: 120px; /* Above dock */
    right: 30px;
    position: fixed;
    /* Ensure other styles from previous CSS apply, providing generic .panda-fab exists */
}
</style>


<style>
/* Status Monitor Styles */
.status-monitor-bar {
    /* Adaptive visibility: Hide on very small screens? */
}
.status-pill {
    display: flex; align-items: center; gap: 6px;
    background: rgba(0,0,0,0.03);
    border: 1px solid var(--border-subtle);
    padding: 4px 8px;
    border-radius: 8px;
    cursor: help;
    transition: all 0.2s;
}
.status-pill:hover {
    background: var(--bg-card);
    transform: translateY(-1px);
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.status-label {
    font-size: 10px;    
    font-weight: 700;
    color: var(--text-secondary);
    letter-spacing: 0.5px;
}
.status-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    box-shadow: 0 0 4px rgba(0,0,0,0.1);
}

/* Gradients for Status */
/* Online: Green Neon Gradient */
.status-dot.online {
    background: radial-gradient(circle at 30% 30%, #4ade80, #22c55e); 
    box-shadow: 0 0 6px rgba(34, 197, 94, 0.4);
}
/* Warning: Yellow/Orange */
.status-dot.warning {
    background: radial-gradient(circle at 30% 30%, #facc15, #eab308);
    box-shadow: 0 0 6px rgba(234, 179, 8, 0.4);
}
/* Offline: Red Hot */
.status-dot.offline {
    background: radial-gradient(circle at 30% 30%, #f87171, #ef4444);
    box-shadow: 0 0 6px rgba(239, 68, 68, 0.4);
}
</style>


<style>
/* Language Dropdown */
.lang-dropdown {
    display: none;
    position: absolute;
    top: 45px;
    right: 0;
    background: var(--bg-card);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    width: 140px;
    z-index: 5000;
    overflow: hidden;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}
.lang-dropdown.show {
    display: block;
    animation: fadeIn 0.2s ease;
}
.lang-option {
    padding: 10px 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    font-size: 13px;
    color: var(--text-primary);
    transition: background 0.2s;
}
.lang-option:hover {
    background: rgba(0,0,0,0.05);
}
.theme-toggle-btn {
    /* Recycle existing btn style but ensure relative positioning if needed */
}
</style>


<style>
/* ... Dock Styles ... */
.nav-item {
    position: relative; /* For badge positioning */
}

/* Close Badge (X) */
.dock-close-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 16px;
    height: 16px;
    background: rgba(239, 68, 68, 0.8); /* Red translucent */
    color: white;
    font-size: 10px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    opacity: 0; /* Hidden by default */
    transition: all 0.2s ease;
    z-index: 10;
}

.nav-item:hover .dock-close-badge {
    opacity: 1; /* Show on hover */
    transform: scale(1.1);
}

.dock-close-badge:hover {
    background: rgba(220, 38, 38, 1); /* Solid red on hover */
}
</style>

<script src="js/dock-utils.js"></script>
<script src="js/AppDockDrag.js"></script>
</head>
  <body>
    <div class="container">
      
      <div class="header" style="display: flex; justify-content: space-between; align-items: center; padding: 15px 25px; width: 100%; box-sizing: border-box;">
        <!-- LEFT: Brand -->
        <div style="display: flex; align-items: center; gap: 12px; flex-shrink: 0;">
           <h1 style="margin:0; font-size:24px; display:flex; align-items:center; gap:8px; color: var(--ds-gray-1000);">
             <span>üêº</span> 
             <span style="font-weight:700; letter-spacing:-0.5px;">Panda Fabrics</span>
           </h1>
           <span class="version-badge">v2.2</span>
        </div>

        
        <!-- CENTER: System Status Monitor -->
        <div class="status-monitor-bar" style="display:flex; gap:12px; flex: 1; justify-content: center; align-items:center; min-width: 0;">
             <div class="status-pill" title="Firebase Realtime (Heartbeat)">
                <span class="status-label">FB</span>
                <div class="status-dot online"></div>
             </div>
             <div class="status-pill" title="Google App Script (Serverless)">
                <span class="status-label">GA</span>
                <div class="status-dot warning"></div>
             </div>
             <div class="status-pill" title="Rust Agent (Local Bridge)">
                <span class="status-label">RU</span>
                <div class="status-dot offline"></div>
             </div>
             <div class="status-pill" title="Database (Persist√™ncia)">
                <span class="status-label">DB</span>
                <div class="status-dot online"></div>
             </div>
             <div class="status-pill" title="Gemini AI (Intelligence)">
                <span class="status-label">AI</span>
                <div class="status-dot online"></div>
             </div>
             <div class="status-pill" title="Local GPU (Hardware)">
                <span class="status-label">GP</span>
                <div class="status-dot offline"></div>
             </div>
        </div>


        <!-- RIGHT: Controls -->
        <div class="header-controls" style="display:flex; align-items:center; gap:15px; flex-shrink: 0;">
           
           <!-- Energy Bar (Row Layout) -->
           <div class="energy-wrapper" title="Cr√©ditos de IA">
               <span class="energy-icon">‚ö°</span>
               <div class="energy-bar-container">
                   <div class="energy-fill" id="aiEnergyFill" style="width: 100%;"></div>
               </div>
               <span class="energy-text" id="aiEnergyText">100%</span>
           </div>

           <!-- Theme Toggle -->
           <button class="theme-toggle-btn" onclick="toggleDarkMode()" title="Alternar Tema Escuro/Claro">
              <span id="themeIcon">üåô</span>
           </button>

           
           <!-- Language Switcher -->
           <div class="lang-switcher-wrapper" style="position: relative;">
               <button class="theme-toggle-btn" onclick="toggleLangMenu()" title="Alterar Idioma / Change Language" id="langBtn">
                   <span style="font-size: 16px;">üáßüá∑</span>
               </button>
               <!-- Dropdown Menu -->
               <div id="langDropdown" class="lang-dropdown">
                   <div class="lang-option" onclick="changeLanguage('pt')">
                       <span>üáßüá∑</span> Portugu√™s
                   </div>
                   <div class="lang-option" onclick="changeLanguage('en')">
                       <span>üá∫üá∏</span> English
                   </div>
                   <div class="lang-option" onclick="changeLanguage('es')">
                       <span>üá™üá∏</span> Espa√±ol
                   </div>
               </div>
           </div>


           <!-- User Info & Logout -->
           <div style="display:flex; align-items:center; gap:12px; border-left: 1px solid var(--ds-gray-alpha-400); padding-left: 15px;">
              <div id="userLoginInfo" style="text-align:right;">
                  <!-- JS Injects User Name here -->
                  <div style="font-weight:600; color:var(--ds-gray-1000); font-size:13px;">Carregando...</div>
              </div>
              <button onclick="fazerLogout()" title="Sair do Sistema" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; border-radius: 8px; padding: 8px 14px; cursor: pointer; display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; transition: all 0.2s; box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 8px rgba(239, 68, 68, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 4px rgba(239, 68, 68, 0.2)'">
                  üö™ Sair
              </button>
           </div>
        </div>
      </div>

      

      <!-- Omni-bar removed - was causing bugs -->






      <!-- ============================================= -->
      <!-- NEW MODULAR DOCKS - Clean Architecture -->
      <!-- ============================================= -->

      <!-- App Dock - Left Side, Vertical, Centered -->
      <div id="appDock" class="modular-dock left-dock">
        <div class="dock-items">
          <div class="dock-item" onclick="openModule('dashboard')" title="Dashboard">üìä</div>
          <div class="dock-item" onclick="openModule('crm')" title="CRM">üë•</div>
          <div class="dock-item" onclick="openModule('analytics')" title="Analytics">üìà</div>
          
          <div class="dock-separator"></div>
          
          <div class="dock-item" onclick="abrirConfiguracoes()" title="Configura√ß√µes">‚öôÔ∏è</div>
          <div class="dock-item" onclick="window.PandaLoader.loadModule('store')" title="Loja de Apps">üè™</div>
        </div>
      </div>

      <!-- DevTools Dock - Right Side, Vertical, Centered -->
      <div id="devDock" class="modular-dock right-dock">
        <div class="dock-items">
          <div class="dock-item" onclick="openDevTool('extensions')" title="Extensions">üß©</div>
          <div class="dock-item" onclick="openDevTool('console')" title="Console">üíª</div>
          <div class="dock-item" onclick="openDevTool('api')" title="API Tester">üîå</div>
          <div class="dock-item" onclick="openDevTool('database')" title="Database">üóÑÔ∏è</div>
          <div class="dock-item" onclick="openDevTool('editor')" title="Code Editor">üìù</div>
          
          <div class="dock-separator"></div>
          
          <div class="dock-item" onclick="openDevTool('ai')" title="AI Assistant">ü§ñ</div>
        </div>
      </div>



      <!-- ===== SETTINGS MODAL ===== -->
      <div class="settings-overlay" id="settingsOverlay" onclick="if(event.target===this) fecharConfiguracoes()">
        <div class="settings-modal">
          <!-- Sidebar -->
          <div class="settings-sidebar">
            <div class="settings-nav-item active" data-section="profile" onclick="mudarSecaoSettings('profile')">
              <span>üë§</span> Profile
            </div>
            <div class="settings-nav-item" data-section="appearance" onclick="mudarSecaoSettings('appearance')">
              <span>üé®</span> Appearance
            </div>
            <div class="settings-nav-item" data-section="wallet" onclick="mudarSecaoSettings('wallet')">
              <span>üêº</span> Wallet
            </div>
            <div class="settings-nav-item" data-section="gpu" onclick="mudarSecaoSettings('gpu')">
              <span>üñ•Ô∏è</span> GPU Settings
            </div>
            <div class="settings-nav-item" data-section="store" onclick="mudarSecaoSettings('store')">
              <span>üõí</span> Store
            </div>
            <div class="settings-nav-item" data-section="about" onclick="mudarSecaoSettings('about')">
              <span>‚ÑπÔ∏è</span> About
            </div>
          </div>
          
          <!-- Content -->
          <div class="settings-content">
            <!-- Profile Section -->
            <div class="settings-section" id="settings-profile">
              <h2 class="settings-section-title">Profile</h2>
              <p class="settings-section-desc">Gerencie suas informa√ß√µes pessoais</p>
              
              <div class="settings-card">
                <div class="settings-row">
                  <div>
                    <div class="settings-label">Nome de usu√°rio</div>
                    <div class="settings-sublabel" id="settings-username">admin</div>
                  </div>
                  <button onclick="editarNomeUsuario()" style="background:#222; border:1px solid #333; color:#fff; padding:8px 16px; border-radius:6px; cursor:pointer;">Editar</button>
                </div>
                <div class="settings-row">
                  <div>
                    <div class="settings-label">Tenant ID</div>
                    <div class="settings-sublabel" id="settings-tenant">tenant_001</div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Appearance Section -->
            <div class="settings-section" id="settings-appearance" style="display:none;">
              <h2 class="settings-section-title">Appearance</h2>
              <p class="settings-section-desc">Personalize a apar√™ncia do sistema</p>
              
              <div class="settings-card">
                <div class="settings-row">
                  <div>
                    <div class="settings-label">Tema Escuro</div>
                    <div class="settings-sublabel">Ative o modo dark para melhor visualiza√ß√£o</div>
                  </div>
                  <div class="toggle-switch active" id="darkModeToggle" onclick="toggleDarkMode()"></div>
                </div>
                <div class="settings-row">
                  <div>
                    <div class="settings-label">Idioma</div>
                    <div class="settings-sublabel">Portugu√™s (Brasil)</div>
                  </div>
                  <select style="background:#222; border:1px solid #333; color:#fff; padding:8px 12px; border-radius:6px;">
                    <option>Portugu√™s</option>
                    <option>English</option>
                    <option>Espa√±ol</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Wallet Section -->
            <div class="settings-section" id="settings-wallet" style="display:none;">
              <h2 class="settings-section-title">Wallet (Panda Coins)</h2>
              <p class="settings-section-desc">Gerencie seus cr√©ditos de IA</p>
              
              <div class="settings-card" style="text-align:center; padding:30px;">
                <div style="font-size:48px;">üêº</div>
                <div style="font-size:36px; font-weight:bold; color:#10b981; margin:16px 0;" id="walletBalance">1,000 PC</div>
                <div style="color:#666; margin-bottom:20px;">Saldo dispon√≠vel</div>
                <button style="background:#10b981; color:#fff; border:none; padding:12px 24px; border-radius:8px; font-weight:600; cursor:pointer;">
                  + Recarregar
                </button>
              </div>
              
              <div class="settings-card">
                <div class="settings-row">
                  <div class="settings-label">Gastos Hoje</div>
                  <div style="color:#f59e0b;">30 PC</div>
                </div>
                <div class="settings-row">
                  <div class="settings-label">Economia Local (GPU)</div>
                  <div style="color:#10b981;">720 PC salvos</div>
                </div>
              </div>
            </div>
            
            <!-- GPU Settings Section -->
            
            <!-- GPU Settings Section (Updated for Firebase Architecture) -->
            <div class="settings-section" id="settings-gpu" style="display:none;">
              <h2 class="settings-section-title">GPU & Agent Bridge</h2>
              <p class="settings-section-desc">Conecte o Agente Local via Firebase</p>
              
              <div class="settings-card">
                <div class="settings-row">
                  <div>
                    <div class="settings-label">Modo Agente Local (Rust)</div>
                    <div class="settings-sublabel">Processamento no seu hardware (0 tokens)</div>
                  </div>
                  <div class="toggle-switch" id="gpuToggle" onclick="toggleGPU()"></div>
                </div>
              </div>

              <!-- Firebase Config Input -->
              <div class="settings-card">
                  <div class="settings-row" style="display:block;">
                      <div class="settings-label" style="margin-bottom:8px;">Firebase Channel UID</div>
                      <input type="text" id="firebaseUidInput" placeholder="ex: user_123_abc" 
                             style="width:100%; background:#111; border:1px solid #333; color:#ccc; padding:10px; border-radius:6px; font-family:monospace;">
                      <div class="settings-sublabel" style="margin-top:6px;">Este ID conecta seu navegador ao Agente Rust.</div>
                  </div>
                  <div class="settings-row">
                      <button onclick="window.PandaBridge.connect(document.getElementById('firebaseUidInput').value)" 
                              style="width:100%; padding:10px; background:var(--accent-primary); border:none; color:white; border-radius:6px; cursor:pointer; font-weight:bold;">
                          üíæ Salvar & Conectar
                      </button>
                  </div>
              </div>
              
              <div class="settings-card">
                <div class="settings-row">
                  <div class="settings-label">Status Panda Agent</div>
                  <div class="gpu-badge offline" id="agentBadge">
                    <span>üî¥</span> Desconectado
                  </div>
                </div>
              </div>
              
              <div style="text-align:center; margin-top:20px;">
                <a href="#" style="color:#10b981; text-decoration:none;">üì• Baixar Panda Agent Installer (v2.0)</a>
              </div>
            </div>

            <!-- Store Section -->
            <div class="settings-section" id="settings-store" style="display:none;">
              <h2 class="settings-section-title">Store</h2>
              <p class="settings-section-desc">Instale m√≥dulos para expandir funcionalidades</p>
              
              <div class="store-grid">
                <div class="store-card">
                  <div class="store-card-icon">üìä</div>
                  <div class="store-card-title">M√≥dulo Fiscal</div>
                  <div class="store-card-desc">NFe, NFCe, SPED</div>
                </div>
                <div class="store-card">
                  <div class="store-card-icon">üìà</div>
                  <div class="store-card-title">Bot de Trade</div>
                  <div class="store-card-desc">Binance, MetaTrader</div>
                </div>
                <div class="store-card">
                  <div class="store-card-icon">üí¨</div>
                  <div class="store-card-title">WhatsApp Auto</div>
                  <div class="store-card-desc">Disparos em massa</div>
                </div>
                <div class="store-card">
                  <div class="store-card-icon">üè™</div>
                  <div class="store-card-title">Multi-Lojas</div>
                  <div class="store-card-desc">Gest√£o multi-tenant</div>
                </div>
              </div>
            </div>
            
            <!-- About Section -->
            <div class="settings-section" id="settings-about" style="display:none;">
              <h2 class="settings-section-title">About</h2>
              <p class="settings-section-desc">Informa√ß√µes do sistema</p>
              
              <div class="settings-card">
                <div class="settings-row">
                  <div class="settings-label">Vers√£o</div>
                  <div>v2.3.0</div>
                </div>
                <div class="settings-row">
                  <div class="settings-label">SDK</div>
                  <div>Panda SDK v1.0.0</div>
                </div>
                <div class="settings-row">
                  <div class="settings-label">Design System</div>
                  <div>Vercel/Geist</div>
                </div>
              </div>
              
              <div style="text-align:center; margin-top:20px; color:#666;">
                <p>¬© 2026 Panda Fabrics</p>
                <p>Building the Developer Soil üêº</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- PANDA FAB (Floating Action Button) -->
      <!-- Aparece quando o Omni-Bar est√° fechado ou para acesso r√°pido -->
      

      <!-- PANDA LOADING SCREEN (Logo Gigante que some) -->
      <div id="panda-loading" class="panda-loading-screen">
          <h1 class="panda-loading-logo">üêº</h1>
      </div>

      <!-- IN√çCIO VIEW (Clean Canvas) -->
      <div id="inicio-view" class="view-section active clean-canvas">
          
          <!-- BARRA FLUTUANTE UNIFICADA (Arrast√°vel) -->

    <!-- OMNI-BAR (Unified & Integrated) -->

          
      </div>

      <!-- Script: Loading & Draggable Logic -->
      <script>
        // 1. Loading Screen Logic
        window.addEventListener('load', () => {
            const loader = document.getElementById('panda-loading');
            setTimeout(() => {
                loader.style.opacity = '0';
                // Remove do DOM ap√≥s transi√ß√£o para liberar mem√≥ria (opcional, ou s√≥ display:none)
                setTimeout(() => loader.style.display = 'none', 500);
            }, 1000); // 1s de "charme"
        });

        // 2. Draggable Logic para a Barra
        const omniTrigger = document.getElementById('omni-trigger');
        let isDraggingBar = false;
        let startX, startY, initialLeft, initialTop;

        omniTrigger.addEventListener('mousedown', (e) => {
            isDraggingBar = true;
            omniTrigger.style.cursor = 'grabbing';
            omniTrigger.style.transform = 'translate(-50%, -50%) scale(1.02)'; // Feedback visual
            
            // Pega posi√ß√£o inicial do mouse relative ao viewport
            startX = e.clientX;
            startY = e.clientY;
            
            // Pega posi√ß√£o atual do elemento (computada)
            const rect = omniTrigger.getBoundingClientRect();
            // Como usaremos position absolute com top/left, calculamos baseado no centro ou topo/esq
            // Simplifica√ß√£o: vamos atualizar o style.left e style.top diretamente
            // Mas cuidado: o transform translate(-50%, -50%) atrapalha calculo direto se n√£o compensar
            
            // Estrategia Robustez: Ao arrastar, removemos o transform e setamos top/left exatos da posi√ß√£o atual
            omniTrigger.style.transform = 'none';
            omniTrigger.style.left = rect.left + 'px';
            omniTrigger.style.top = rect.top + 'px';
            omniTrigger.style.width = rect.width + 'px'; // Fixar largura para n√£o quebrar layout
            
            // Recalcula diff para arraste suave
            initialLeft = rect.left;
            initialTop = rect.top;
        });

        window.addEventListener('mousemove', (e) => {
            if (!isDraggingBar) return;
            e.preventDefault();
            
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            
            omniTrigger.style.left = (initialLeft + dx) + 'px';
            omniTrigger.style.top = (initialTop + dy) + 'px';
        });

        window.addEventListener('mouseup', () => {
            if(isDraggingBar) {
                isDraggingBar = false;
                omniTrigger.style.cursor = 'grab';
                // Opcional: Efeito de soltar
            }
        });
      </script>

      <!-- CONTATOS VIEW (Full Client List) -->
      <!-- MODULE PLACEHOLDER: crm -->
<!-- End contatos-view -->

      <!-- AGENDA VIEW -->
      <!-- MODULE PLACEHOLDER: agenda -->
<!-- REPORTS VIEW -->
      <!-- MODULE PLACEHOLDER: reports -->
<!-- Upload de HTML -->
    <div class="upload-area" id="uploadArea">
      <div class="upload-box">
        <h2>üìÅ Upload de Relat√≥rio HTML</h2>
        <p style="color: #666; margin-bottom: 20px">
          Envie o arquivo HTML do relat√≥rio do Guia da Constru√ß√£o
        </p>

        <div
          class="file-input-wrapper"
          onclick="document.getElementById('fileInput').click()"
        >
      


          <input
            type="file"
            id="fileInput"
            accept=".html"
            onchange="processarUpload(this)"
          />
          <p>üñ±Ô∏è Clique aqui ou arraste o arquivo HTML</p>
          <p style="font-size: 12px; color: #999; margin-top: 10px">
            Aceita apenas arquivos .html
          </p>
        </div>

        <div style="display: flex; gap: 10px; justify-content: center">
          <button class="btn btn-primary" onclick="fecharUpload()">
            Fechar
          </button>
        </div>

        <div id="uploadStatus" style="margin-top: 20px"></div>

        <button
          class="btn"
          style="
            background: #64748b;
            color: white;
            margin-top: 20px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
          "
          onclick="verAuditoria()"
        >
          <span>üìú</span> Ver Hist√≥rico de Importa√ß√µes
        </button>
      </div>
    </div>

    <!-- Duplicate Modal Removed (Consolidated into settingsModal) -->

    <!-- MODAL SELE√á√ÉO DE TEMPLATE WHATSAPP -->
    <div id="whatsappModal" class="modal" style="z-index: 2000;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üì± Enviar WhatsApp</h2>
                <button class="close-btn" onclick="fecharModal('whatsappModal')">√ó</button>
            </div>
            <p style="margin-bottom: 15px;">Selecione um template ou escreva sua mensagem:</p>
            <div id="whatsappTemplatesList" style="max-height: 200px; overflow-y: auto; margin-bottom: 20px;">
                <!-- Templates clic√°veis -->
            </div>
            <textarea id="whatsappPreview" class="form-textarea" style="height: 150px;"></textarea>
            <div style="margin-top: 15px; text-align: right;">
                <button class="btn btn-success" onclick="enviarWhatsappReal()">üöÄ Enviar Mensagem</button>
            </div>
        </div>
    </div>

    <!-- MODAL DE AUDITORIA -->
    <div id="auditModal" class="modal">
      <div class="modal-content" style="max-width: 600px">
        <div class="modal-header">
          <h2>üìú Hist√≥rico de Importa√ß√µes</h2>
          <button class="close-btn" onclick="fecharModal()">√ó</button>
        </div>
        <div
          id="auditList"
          class="notes-list"
          style="margin-top: 20px; max-height: 500px; overflow-y: auto"
        >
          <!-- Lista ser√° preenchida via JS -->
        </div>
      </div>
    </div>

    <!-- Modal de Detalhes do Cliente (REFACTOR V3.2) -->
    <div class="modal" id="clientModal">
      <div class="modal-content" style="max-width: 900px; height: 85vh; display: flex; flex-direction: column;">
        <div class="modal-header">
          <div style="flex:1">
            <h2 id="modalTitle" style="margin:0;">Detalhes do Cliente</h2>
            <div id="modalSubtitle" style="font-size:12px; color:#cbd5e1; font-weight:normal;">ID: <span id="modalId">---</span></div>
          </div>
          <!-- ACTIONS -->
          <button class="popout-btn" onclick="togglePopOut('clientModal')" title="Pop-out Nativo (Janela Separada)">‚ùê</button>
          <button class="pin-btn" onclick="togglePinModal('clientModal')" title="Fixar (Permitir uso do HUD)">üîì</button>
          <button class="close-btn" onclick="fecharModal()">√ó</button>
        </div>

        <div class="tabs">
          <button class="tab active" onclick="mudarTab(0)">üìã Ficha de Atendimento</button>
          <button class="tab" onclick="mudarTab(1)">‚úèÔ∏è Dados Cadastrais</button>
        </div>

        <!-- TAB 0: FICHA UNIFICADA -->
        <div class="tab-content active" id="tab0" style="flex:1; overflow:hidden; display:flex; flex-direction:column;">
            
            <!-- STATUS BAR -->
            <div style="background:#f8fafc; padding:15px; border-bottom:1px solid #e2e8f0; display:flex; align-items:center; gap:15px; flex-wrap:wrap;">
                <div style="flex:1; min-width:200px;">
                    <label style="font-size:11px; font-weight:bold; color:#64748b;">STATUS ATUAL</label>
                    <select id="unifiedStatus" class="form-input" onchange="atualizarStatusRapido()" style="margin-top:5px; border:2px solid #e2e8f0;">
                         <option value="nao_acompanhando">‚ö™ N√£o Acompanhando</option>
                         <option value="em_acompanhamento">üü° Em Acompanhamento</option>
                         <option value="com_orcamento">üîµ Com Or√ßamento</option>
                         <option value="fechado">üü¢ Fechado</option>
                         <option value="finalizado">üî¥ Finalizado/Perdido</option>
                    </select>
                </div>
                <!-- Quick Actions -->
                <div style="display:flex; gap:5px;">
                    <button class="filter-tag" onclick="setStatusRapido('em_acompanhamento', 'Em Negocia√ß√£o')">üí¨ Em Negocia√ß√£o</button>
                    <button class="filter-tag" onclick="setStatusRapido('sem_contato', 'Sem Contato')">üìµ Sem Contato</button>
                    <button class="filter-tag" onclick="setStatusRapido('fechado', 'Venda Realizada!')">üí∞ Venda!</button>
                </div>
            </div>

            <!-- TIMELINE -->
            <div id="unifiedTimeline" style="flex:1; overflow-y:auto; padding:20px; background:#fff;">
                <!-- Filled via JS -->
            </div>

            <!-- INPUT AREA -->
            <div style="padding:15px; background:#f1f5f9; border-top:1px solid #cbd5e1;">
                 <!-- ATENDENTE -->
                 <div style="margin-bottom:10px; display:flex; gap:10px; align-items:center;">
                     <label for="attendantSelect" style="min-width:100px; font-weight:600; color:#475569;">üë§ Atendente:</label>
                     <select id="attendantSelect" class="form-select" style="flex:1; padding:8px; border:2px solid #e2e8f0; border-radius:8px;">
                         <option value="">Selecione o atendente...</option>
                     </select>
                 </div>
                 
                 <!-- NOTA -->
                 <div style="display:flex; gap:10px;">
                     <textarea id="unifiedNoteInput" class="form-textarea" placeholder="Digite uma nota ou resumo do atendimento..." style="height:50px; resize:none;"></textarea>
                     <button class="btn btn-primary" onclick="salvarNotaUnificada()" style="height:50px; width:100px;">Enviar ‚ûú</button>
                 </div>
                 
                 <!-- AGENDAMENTO -->
                 <div style="margin-top:10px; display:flex; gap:10px; align-items:center;">
                     <small>Agendar:</small>
                     <input type="datetime-local" id="unifiedScheduleDate" class="form-input" style="width:auto; padding:5px;">
                     <span style="flex:1;"></span>
                 </div>
            </div>
        </div>

        <!-- TAB 1: DADOS CADASTRAIS (EDICAO) -->
        <div class="tab-content" id="tab1" style="overflow-y:auto; padding:20px;">
           <div class="info-grid" id="modalInfo"></div>
           <div class="form-group"><label>Nome</label><input id="editNome" class="form-input"></div>

           <!-- Maps Search -->
           <div class="form-group" style="background:#f8fafc; padding:15px; border-radius:8px; border:1px solid #e2e8f0; margin-bottom:15px;">
               <label class="form-label" style="font-weight:bold;">üìç Atualizar Endere√ßo</label>
               <div id="edit-place-autocomplete-container"></div>
           </div>

           <!-- Fonte -->
           <div class="form-group">
               <label>Fonte de Capta√ß√£o</label>
               <select id="editFonte" class="form-input"></select>
           </div>
           
           <!-- TELEFONES -->
           <div class="form-group">
               <label>üìû Telefones</label>
               <div id="editPhonesList" style="display:flex; flex-direction:column; gap:8px;">
                   <!-- Populated via JS -->
               </div>
               <button type="button" class="btn" onclick="adicionarTelefoneEdit()" style="margin-top:8px; padding:6px 12px; font-size:13px; background:#10b981; color:white;">‚ûï Adicionar Telefone</button>
           </div>
           
           <div style="display:grid; grid-template-columns: 1fr 100px; gap:10px; margin-bottom:10px;">
               <div class="form-group"><label>Rua</label><input id="editClientRua" class="form-input" autocomplete="address-line1"></div>
               <div class="form-group"><label>N√∫mero</label><input id="editClientNumero" class="form-input" autocomplete="address-line2"></div>
           </div>
           
           <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
               <div class="form-group"><label>Bairro</label><input id="editBairro" class="form-input" autocomplete="address-level3"></div>
               <div class="form-group"><label>CEP</label><input id="editClientCep" class="form-input" autocomplete="postal-code"></div>
           </div>

           <div style="display:grid; grid-template-columns: 1fr 80px; gap:10px;">
               <div class="form-group"><label>Cidade</label><input id="editCidade" class="form-input" autocomplete="address-level2"></div>
               <div class="form-group"><label>UF</label><input id="editClientEstado" class="form-input" autocomplete="address-level1"></div>
           </div>
            <!-- Dynamic Fields will be injected here -->
           <div class="form-group"><label>Valor Est. (R$)</label><input id="editValor" class="form-input"></div>
           
           <div style="margin-top:20px; text-align:right;">
               <button class="btn btn-success" onclick="salvarEdicaoRapida()">üíæ Salvar Dados</button>
           </div>
           
           <hr style="margin:20px 0;">
           <button class="btn" style="background:#ef4444; color:white; width:100%;" onclick="deletarCliente()">üóëÔ∏è Deletar Cliente</button>
        </div>
      </div>
    </div>
        </div>
      </div>
    </div>

    <!-- MODAL NOVO CLIENTE (Restored) -->
    <div id="newClientModal" style="display: none;" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="newClientModalLabel">Novo Cadastro</h2>
          <button class="close-btn" onclick="fecharNovoCliente()">√ó</button>
        </div>
        <div id="newClientAlert"></div>
        
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; padding:20px;">
            <div class="form-group">
                <label class="form-label required" for="newClientNome">Nome do Cliente</label>
                <input type="text" class="form-input" id="newClientNome" name="newClientNome" placeholder="Nome completo / Empresa">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="newClientFonte">Fonte de Capta√ß√£o</label>
               <select class="form-input" id="newClientFonte" name="newClientFonte" onchange="verificarFonteOutros(this)">
                 <!-- Populated by JS -->
               </select>
            </div>

            <div class="form-group">
                <label class="form-label required" for="newClientVendedor">Vendedor Respons√°vel</label>
                <select class="form-input" id="newClientVendedor" name="newClientVendedor">
                    <option value="">Selecione...</option>
                    <!-- Populated by JS -->
                </select>
            </div>

            <div class="form-group" style="grid-column: 1 / -1; background:#f8fafc; padding:15px; border-radius:8px; border:1px solid #e2e8f0;">
                <label class="form-label" style="color:#0f172a; font-weight:bold; display:flex; align-items:center; gap:5px;">
                    üìç Endere√ßo (Busca Autom√°tica)
                </label>
                <!-- Container for Google Maps Place Autocomplete Element -->
                <div id="place-autocomplete-container" style="margin-bottom:10px;"></div>
                
                <div style="display:grid; grid-template-columns: 1fr 100px; gap:10px; margin-top:10px;">
                    <div>
                        <label class="form-label" for="newClientRua" style="font-size:11px;">Rua/Logradouro</label>
                        <input type="text" class="form-input" id="newClientRua" autocomplete="address-line1">
                    </div>
                    <div>
                        <label class="form-label" for="newClientNumero" style="font-size:11px;">N√∫mero</label>
                        <input type="text" class="form-input" id="newClientNumero" autocomplete="address-line2">
                    </div>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                    <div>
                        <label class="form-label" for="newClientBairro" style="font-size:11px;">Bairro</label>
                        <input type="text" class="form-input" id="newClientBairro" autocomplete="address-level3">
                    </div>
                    <div>
                        <label class="form-label" for="newClientCep" style="font-size:11px;">CEP</label>
                        <input type="text" class="form-input" id="newClientCep" autocomplete="postal-code">
                    </div>
                </div>

                <div style="display:grid; grid-template-columns: 1fr 80px; gap:10px; margin-top:10px;">
                    <div>
                        <label class="form-label" for="newClientCidade" style="font-size:11px;">Cidade</label>
                        <input type="text" class="form-input" id="newClientCidade" autocomplete="address-level2">
                    </div>
                    <div>
                        <label class="form-label" for="newClientEstado" style="font-size:11px;">UF</label>
                        <input type="text" class="form-input" id="newClientEstado" autocomplete="address-level1">
                    </div>
                </div>
            </div>

             <!-- Dynamic Fields -->
            <div id="customFieldsContainer" style="grid-column: 1 / -1; display:grid; grid-template-columns: 1fr 1fr; gap:15px;"></div>

            <div class="form-group" style="grid-column: 1 / -1;">
                <label class="form-label">Telefones</label>
                <div id="phonesContainer"></div>
                <button class="config-btn" onclick="adicionarInputTelefone('Celular', '')" style="background:#10b981;">‚ûï Adicionar Telefone</button>
            </div>
            
            <div class="form-group" style="grid-column: 1 / -1;">
                 <label class="form-label">Valor Estimado (R$)</label>
                 <input type="number" class="form-input" id="newClientValor">
            </div>
        </div>

        <div style="padding:20px; text-align:right; border-top:1px solid #eee;">
            <button class="btn btn-success" onclick="salvarNovoCliente()">üíæ Salvar Cliente</button>
        </div>
      </div>
    </div>

    <!-- MODAL DE CONFIGURA√á√ïES -->
    <!-- REMOVED OLD COMPONENT: old_settings -->
<!-- Modal de Novo Cliente -->
    <!-- Modal Moved to modules/crm/index.html -->

    
<script src="js/panda.core.js"></script>

    
    <!-- SCRIPT DE AUTO IMPORTA√á√ÉO (Gerado pelo Python) -->
    <!-- Se o arquivo n√£o existir, o console mostrar√° um erro 404 inofensivo -->
    <script src="dados/auto_import.js" onerror="console.log('Nenhum dado novo do scraper encontrado.')"></script>
    <div id="loginOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); z-index:9999; display:none; justify-content:center; align-items:center;">
        <div style="background:white; padding:40px; border-radius:15px; width:400px; text-align:center; box-shadow:0 10px 40px rgba(0,0,0,0.5);">
            <div style="font-size:50px; margin-bottom:10px;">üîê</div>
            <h2 style="margin-bottom:20px; color:#333;">CRM Login</h2>
            <input type="text" id="loginUser" placeholder="Usu√°rio" class="form-input" style="margin-bottom:15px; padding:12px;">
            <input type="password" id="loginPass" placeholder="Senha" class="form-input" style="margin-bottom:20px; padding:12px;" onkeypress="if(event.key==='Enter') fazerLogin()">
            <button class="btn btn-primary" style="width:100%; padding:12px; font-size:16px;" onclick="fazerLogin()">Entrar no Sistema</button>
            <p style="margin-top:20px; color:#999; font-size:12px;">Padr√£o: admin / admin</p>
        </div>
    </div>
    <!-- AGENDA SIDEBAR (DRAWER) -->
    <div id="agendaBackdrop" class="overlay-backdrop" onclick="fecharAgendaDrawer()"></div>
    <div id="agendaDrawer" class="agenda-drawer">
        <h3 id="sidebarTitle" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <span id="agendaDrawerDate">üìÖ Detalhes</span> 
            <button onclick="fecharAgendaDrawer()" style="border:none;background:none;font-size:24px;cursor:pointer;color:#999;">&times;</button>
        </h3>
        
        <!-- FORMUL√ÅRIO DE NOVO AGENDAMENTO -->
        <div style="background:#f1f5f9; padding:15px; border-radius:10px; margin-bottom:20px;">
            <h4 style="margin:0 0 15px 0; color:#334155;">‚ûï Novo Agendamento</h4>
            
            <label style="display:block; margin-bottom:5px; font-weight:600; color:#475569; font-size:13px;">Tipo:</label>
            <select id="agendaTipo" class="form-input" style="margin-bottom:12px;">
                <option value="reuniao">üìÖ Reuni√£o</option>
                <option value="ligacao">üìû Liga√ß√£o</option>
                <option value="visita">üè† Visita</option>
                <option value="outro">üìù Outro</option>
            </select>
            
            <label style="display:block; margin-bottom:5px; font-weight:600; color:#475569; font-size:13px;">T√≠tulo: *</label>
            <input type="text" id="agendaTitulo" class="form-input" placeholder="Ex: Reuni√£o com cliente" style="margin-bottom:12px;">
            
            
            <label style="display:block; margin-bottom:5px; font-weight:600; color:#475569; font-size:13px;">Vincular a Cliente (opcional):</label>
            <input type="text" id="agendaClienteInput" list="clientesList" class="form-input" placeholder="Digite o nome ou ID do cliente..." style="margin-bottom:12px;">
            <datalist id="clientesList">
            </datalist>
            <input type="hidden" id="agendaCliente">
            
            <label style="display:block; margin-bottom:5px; font-weight:600; color:#475569; font-size:13px;">üë§ Respons√°vel: *</label>
            <select id="agendaResponsavel" class="form-input" style="margin-bottom:12px;">
                <option value="">Selecione...</option>
            </select>
            
            <label style="display:block; margin-bottom:5px; font-weight:600; color:#475569; font-size:13px;">Data e Hora: *</label>
            <input type="datetime-local" id="agendaDataHora" class="form-input" style="margin-bottom:12px;">
            
            <label style="display:block; margin-bottom:5px; font-weight:600; color:#475569; font-size:13px;">Descri√ß√£o:</label>
            <textarea id="agendaDescricao" class="form-textarea" rows="3" placeholder="Detalhes do agendamento..." style="margin-bottom:12px; resize:vertical;"></textarea>
            
            <button onclick="salvarAgendamento()" class="btn btn-primary" style="width:100%; padding:10px;">üíæ Salvar Agendamento</button>
        </div>
        
        <!-- LISTA DE AGENDAMENTOS DO DIA -->
        

    <div id="listaAgendamentosDia">
            <p style="color:#999; text-align:center; padding:20px;">Nenhum agendamento para este dia.</p>
        </div>
    </div>
    <script>
      // PWA Service Worker Registration
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          navigator.serviceWorker.register('./sw.js')
            .then(function(registration) {
              console.log('üêº Panda CRM: ServiceWorker registrado com sucesso: ', registration.scope);
            }, function(err) {
              console.log('‚ùå ServiceWorker falhou: ', err);
            });
        });
      }
    </script>
    <!-- OMNI-BAR LOGIC -->
    <script>
        const omniOverlay = document.getElementById('omni-overlay');
        const omniInput = document.getElementById('omni-input');
        const omniResults = document.getElementById('omni-results');
        const modelBadge = document.getElementById('current-model-badge');
        let isOmniOpen = false;

        const MODELS = [
            { id: 'gemini-3.0-flash', name: 'Gemini 3.0 Flash', icon: 'fa-bolt', free: true },
            { id: 'gemini-1.5-pro', name: 'Gemini 1.5 Pro', icon: 'fa-brain', free: false },
            { id: 'gpt-4o', name: 'GPT-4o', icon: 'fa-robot', free: false },
            { id: 'claude-3.5-sonnet', name: 'Claude 3.5', icon: 'fa-feather', free: false },
            { id: 'imagen-3', name: 'Imagen 3', icon: 'fa-image', free: false }
        ];
        let currentModelIndex = 0;

        // Toggle Omni-Bar (Ctrl+K or Command+K)
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                toggleOmniBar();
            }
            if (e.key === 'Escape' && isOmniOpen) {
                toggleOmniBar();
            }
        });

        function toggleOmniBar() {
            isOmniOpen = !isOmniOpen;
            omniOverlay.style.display = isOmniOpen ? 'flex' : 'none';
            if (isOmniOpen) {
                omniInput.value = '';
                omniInput.focus();
                renderResults([]); // Show default or history
            }
        }

        function cycleModel() {
            currentModelIndex = (currentModelIndex + 1) % MODELS.length;
            const model = MODELS[currentModelIndex];
            modelBadge.innerHTML = `<i class="fas ${model.icon}"></i> ${model.name}`;
            // TODO: Save preference to LocalStorage
        }

        // Search Mockup & ENTER Key Support
        omniInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
               const query = omniInput.value.trim();
               if (query) {
                   // TODO: Enviar para AI Agent ou Executar Comando
                   console.log('ü§ñ Executando comando Omni-Bar:', query);
                   alert(`Panda Assistant em breve processar√°: "${query}"\n(Funcionalidade v3.0 em desenvolvimento)`);
                   toggleOmniBar(); // Opcional: fechar ap√≥s enviar
               }
            }
        });

        omniInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            if(!query) { omniResults.innerHTML = ''; return; }
            
            // Mock Results
            const results = [
                { title: 'Analisar Contrato', desc: 'Use Gemini para ler PDF', icon: 'fa-file-contract', type: 'AI' },
                { title: 'Criar Imagem', desc: 'Gerar assets visuais', icon: 'fa-paint-brush', type: 'AI' },
                { title: 'Financeiro', desc: 'Abrir Dashboard Financeiro', icon: 'fa-chart-line', type: 'Nav' },
                { title: 'Novo Cliente', desc: 'Cadastrar lead', icon: 'fa-user-plus', type: 'Action' }
            ].filter(r => r.title.toLowerCase().includes(query));

            renderResults(results);
        });
        
        // Prevent closing when clicking inside input wrapper
        document.querySelector('.omni-input-wrapper').onclick = function(e) {
            e.stopPropagation();
        };

        function renderResults(list) {
            omniResults.innerHTML = list.map(item => `
                <div class="omni-item">
                    <div class="omni-item-icon"><i class="fas ${item.icon}"></i></div>
                    <div class="omni-item-content">
                        <div class="omni-item-title">${item.title}</div>
                        <div class="omni-item-desc">${item.desc}</div>
                    </div>
                    <div class="omni-shortcut">‚Üµ</div>
                </div>
            `).join('');
        }
    </script>
    <script>
      // ========== MODAL PIN/FIX LOGIC ==========
      let pinnedModals = {}; // Rastreia quais modais est√£o fixados

      function togglePinModal(modalId) {
        const modal = document.getElementById(modalId);
        if (!modal) return;
        
        const isPinned = !!pinnedModals[modalId];
        pinnedModals[modalId] = !isPinned; // Toggle State
        
        const btnFn = modal.querySelector('.pin-btn');
        
        if (pinnedModals[modalId]) {
            // ATIVAR PIN (Permite clicar no fundo)
            modal.style.backgroundColor = 'transparent';
            modal.style.pointerEvents = 'none'; // Deixa clicar no fundo
            
            // Mas o conte√∫do deve continuar clic√°vel
            const content = modal.querySelector('.modal-content');
            if(content) {
                content.style.pointerEvents = 'auto';
                content.style.border = '2px solid #3b82f6'; // Realce azul
                content.style.boxShadow = '0 0 15px rgba(59, 130, 246, 0.3)';
            }

            if(btnFn) {
                btnFn.innerHTML = 'üîí';
                btnFn.title = 'Desafixar (Voltar ao modo Modal)';
                btnFn.style.background = '#e2e8f0';
            }
        } else {
            // DESATIVAR PIN (Modo Modal Normal)
            modal.style.backgroundColor = ''; // Volta ao CSS original (rgba)
            modal.style.pointerEvents = '';
            
            const content = modal.querySelector('.modal-content');
            if(content) {
                content.style.pointerEvents = '';
                content.style.border = '';
                content.style.boxShadow = '';
            }

            if(btnFn) {
                btnFn.innerHTML = 'üîì';
                btnFn.title = 'Fixar (Permitir uso do HUD)';
                btnFn.style.background = 'transparent';
            }
        }
      }

      // ========== NATIVE POP-OUT (Picture-in-Picture) ==========
      async function togglePopOut(modalId) {
        const modal = document.getElementById(modalId);
        const content = modal.querySelector('.modal-content');
        
        // Verifica suporte
        if (!window.documentPictureInPicture) {
            alert('Seu navegador n√£o suporta Pop-out Nativo (Document PiP). Use Chrome ou Edge atualizado.');
            return;
        }

        try {
            // Se j√° estiver em PiP, poder√≠amos trazer de volta (complexo gerenciar estado), 
            // por enquanto focamos em abrir.
            
            const pipWindow = await window.documentPictureInPicture.requestWindow({
                width: content.offsetWidth || 800,
                height: content.offsetHeight || 600,
            });

            // Copiar estilos para a nova janela
            [...document.styleSheets].forEach((styleSheet) => {
                try {
                    const cssRules = [...styleSheet.cssRules].map((rule) => rule.cssText).join('');
                    const style = document.createElement('style');
                    style.textContent = cssRules;
                    pipWindow.document.head.appendChild(style);
                } catch (e) {
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.type = styleSheet.type;
                    link.media = styleSheet.media;
                    link.href = styleSheet.href;
                    pipWindow.document.head.appendChild(link);
                }
            });

            // Mover conte√∫do para a janela
            pipWindow.document.body.append(content);
            
            // Fechar modal original (que ficou vazio)
            modal.style.display = 'none';

            // Quando fechar a janela PiP, trazer de volta
            pipWindow.addEventListener('pagehide', (event) => {
                const modalParams = document.getElementById(modalId);
                if(modalParams) {
                    modalParams.style.display = 'flex'; // ou block
                    modalParams.appendChild(content); // Retorna o filho
                    // Restaurar background se estava pinned
                    togglePinModal(modalId); // Reset ou force state
                    pinnedModals[modalId] = false; // Reset logico
                    
                    // Re-render styles cleanup se necessario
                    modalParams.style.backgroundColor = '';
                    modalParams.style.pointerEvents = '';
                    content.style.border = '';
                }
            });

        } catch (err) {
            console.error("Erro ao abrir Pop-out:", err);
        }
      }


      // Override no click fora do modal (Mantido logicamente)
      window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            const modalId = event.target.id;
            // Se pinned, nem recebe evento pq pointer-events = none no container
            // Mas se receber (algum browser behavior), checa:
            if (pinnedModals[modalId]) return;
            
            fecharModal();
        }
        
        if (event.target.id === 'omni-overlay') {
            toggleOmniBar();
        }
      }
    </script>
    <style>
        .pin-btn, .popout-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            padding: 5px 8px;
            border-radius: 4px;
            margin-right: 5px;
            transition: all 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .pin-btn:hover, .popout-btn:hover {
            background: #f1f5f9;
        }
    
      /* =========================================
       * CLEAN CANVAS & OMNI BAR (Vercel Themed)
       * ========================================= */
      .clean-canvas {
        position: relative; width: 100%; height: 100vh; overflow: hidden;
        background: var(--ds-background-100);
      }
      .omni-search-bar {
        position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
        width: 100%; max-width: 650px; padding: 15px 25px;
        background: var(--ds-background-100);
        border: 1px solid var(--ds-gray-alpha-400); border-radius: 20px;
        box-shadow: var(--ds-shadow-border), 0 10px 40px rgba(0,0,0,0.2);
        display: flex; flex-direction: column; gap: 10px; cursor: grab;
        transition: box-shadow 0.3s, transform 0.1s; z-index: 100;
        user-select: none; backdrop-filter: blur(10px);
      }
      .omni-search-bar:active { cursor: grabbing; }
      .omni-search-bar:hover { box-shadow: var(--ds-shadow-border), 0 20px 60px rgba(0,0,0,0.3); }
      .omni-greeting { font-size: 18px; color: var(--ds-gray-1000); font-weight: 500; margin-left: 5px; font-family: var(--font-sans); }
      .omni-fake-input { 
        display: flex; align-items: center; background: var(--ds-gray-100);
        padding: 12px 20px; border-radius: 12px; color: var(--ds-gray-900);
        border: 1px solid transparent; transition: all 0.2s;
      }
      .omni-fake-input:hover { background: var(--ds-gray-200); border-color: var(--ds-gray-alpha-400); }
      .omni-search-icon { color: var(--ds-gray-500); font-size: 18px; margin-right: 15px; }
      .omni-placeholder { font-size: 16px; color: var(--ds-gray-600); }
      .omni-shortcut-badge { 
        margin-left: auto; color: var(--ds-gray-500); font-size: 11px; 
        background: var(--ds-background-100); padding: 4px 8px; border-radius: 6px; 
        border: 1px solid var(--ds-gray-alpha-400); font-weight: 600;
      }
      .panda-loading-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: var(--ds-background-100); z-index: 9999;
        display: flex; align-items: center; justify-content: center;
        transition: opacity 0.5s ease-out; pointer-events: none;
      }
      .panda-loading-logo { font-size: 80px; animation: floatPanda 2s ease-in-out infinite; }
</style>
    <script>
      // === MVP FIX: ATUALIZAR ESTATISTICAS (HERO) ===
      // Substitui a l√≥gica antiga de gr√°ficos que foi removida
      function atualizarEstatisticas() {
        if (!window.clientes) return;

        const total = window.clientes.length;
        // Filtrar fechados (status 'fechado' ou 'finalizado' dependendo da regra de neg√≥cio, aqui focando em vendas)
        const fechados = window.clientes.filter(c => c.status === 'fechado').length;

        const elProspects = document.getElementById('totalProspects');
        const elFechados = document.getElementById('totalFechados');
        
        // Anima√ß√£o simples de n√∫meros poderia vir aqui
        if(elProspects) elProspects.innerText = total; 
        if(elFechados) elFechados.innerText = fechados;
        
        console.log('üêº Stats Updated:', { total, fechados });
      }

      // Hook para rodar ap√≥s carregar dados
      // Se Repository.js chama 'filtrarClientes()', podemos hookar l√° ou usar Intervalo para MVP
      setInterval(atualizarEstatisticas, 2000); // Polling a cada 2s para garantir atualiza√ß√£o sem mexer no Core
    </script>
  
      <!-- APP DOCK (Mac-style) -->
      

    <script>
      // Omni-Bar is now FIXED (no drag)
    </script>

<style>
/* HEADER REFINEMENTS */
.version-badge {
    background: var(--ds-gray-200); color: var(--ds-gray-1000);
    padding: 2px 8px; border-radius: 6px; font-size: 11px; font-weight: 600;
    vertical-align: middle; border: 1px solid var(--ds-gray-alpha-400);
}

.energy-wrapper {
    display: flex; align-items: center; gap: 10px;
    background: var(--ds-background-200); padding: 5px 12px; border-radius: 99px;
    border: 1px solid var(--ds-gray-alpha-400); height: 34px; box-sizing: border-box;
}
.energy-bar-container {
    width: 60px; height: 6px; background: var(--ds-gray-300); border-radius: 3px; overflow: hidden;
}
.energy-fill {
    height: 100%; background: linear-gradient(90deg, #10b981, #3b82f6);
    transition: width 0.5s ease;
}
.energy-text { font-size: 12px; font-weight: 600; color: var(--ds-gray-1000); min-width: 35px; text-align:right; }

.theme-toggle-btn {
    background: transparent; border: 1px solid var(--ds-gray-alpha-400);
    width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 16px; transition: all 0.2s; color: var(--ds-gray-1000);
}
.theme-toggle-btn:hover { background: var(--ds-gray-200); }

/* User Info Styles Injection Helper */
#userLoginInfo span { color: var(--ds-gray-1000) !important; }
#userLoginInfo span[style*="font-size:10px"] { color: var(--ds-gray-500) !important; }
</style>

<script>
  function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('crmTheme', isDark ? 'dark' : 'light');
      
      // Update Icon
      const icon = document.getElementById('themeIcon');
      if(icon) icon.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
  }

  // Auto-load theme
  (function() {
      const saved = localStorage.getItem('crmTheme');
      if(saved === 'dark') {
          document.body.classList.add('dark-mode');
          const icon = document.getElementById('themeIcon');
          if(icon) icon.textContent = '‚òÄÔ∏è';
      }
  })();
</script>

<div id="configModal" class="modal" style="display: none;">
    <div class="modal-content glass-panel" style="max-width: 600px; padding: 0;">
        <div class="modal-header" style="justify-content: space-between; padding: 15px 20px; border-bottom: 1px solid var(--border-color);">
            <h2 style="margin: 0; font-size: 1.2rem;">Configura√ß√µes</h2>
            <span class="close-modal" onclick="fecharConfiguracoes()" style="cursor: pointer; font-size: 1.5rem;">&times;</span>
        </div>
        <div class="modal-body" style="padding: 0;">
            <div class="settings-container" style="display: flex; height: 400px;">
                <!-- Sidebar Navigation -->
                <div class="settings-sidebar" style="width: 150px; background: rgba(0,0,0,0.05); padding: 10px; border-right: 1px solid var(--border-color);">
                    <div class="setting-tab active" onclick="mudarSecaoSettings('geral', this)" style="padding: 10px; cursor: pointer; border-radius: 8px; margin-bottom: 5px;">Geral</div>
                    <div class="setting-tab" onclick="mudarSecaoSettings('aparencia', this)" style="padding: 10px; cursor: pointer; border-radius: 8px; margin-bottom: 5px;">Apar√™ncia</div>
                    <div class="setting-tab" onclick="mudarSecaoSettings('sistema', this)" style="padding: 10px; cursor: pointer; border-radius: 8px; margin-bottom: 5px;">Sistema</div>
                </div>

                <!-- Content Area -->
                <div class="settings-content" style="flex: 1; padding: 20px; overflow-y: auto;">
                    
                    <!-- Secao Geral -->
                    <div id="sec-geral" class="setting-section">
                        <h3>Informa√ß√µes</h3>
                        <div class="setting-item">
                            <label>Vers√£o do Sistema</label>
                            <div style="opacity: 0.7;">Panda CRM v2.2 (Build 2024)</div>
                        </div>
                        <div class="setting-item" style="margin-top: 15px;">
                            <label>Usu√°rio Atual</label>
                            <div id="configUserDisplay" style="font-weight: bold;">--</div>
                        </div>
                    </div>

                    <!-- Secao Aparencia -->
                    <div id="sec-aparencia" class="setting-section" style="display: none;">
                        <h3>Personaliza√ß√£o</h3>
                        <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
                            <label>Modo Escuro</label>
                            <button id="btnToggleDark" onclick="toggleDarkMode()" style="padding: 5px 15px; border-radius: 20px; border: 1px solid var(--border-color); cursor: pointer; background: var(--card-bg);">Alternar</button>
                        </div>
                        <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0; opacity: 0.5;">
                            <label>Cor de Destaque (Em breve)</label>
                            <div style="width: 20px; height: 20px; background: #00E676; border-radius: 50%;"></div>
                        </div>
                    </div>

                    <!-- Secao Sistema -->
                    <div id="sec-sistema" class="setting-section" style="display: none;">
                        <h3>Performance & Dados</h3>
                        <div class="setting-item" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 0;">
                            <label>GPU Acceleration (Cloud)</label>
                            <label class="switch">
                              <input type="checkbox" id="gpuToggle" onchange="toggleGPU(this)">
                              <span class="slider round"></span>
                            </label>
                        </div>
                        <p style="font-size: 0.8rem; opacity: 0.7; margin-bottom: 20px;">Use recursos da sua GPU local ou alugue poder computacional para tarefas pesadas.</p>
                        
                        <div style="border-top: 1px solid var(--border-color); margin: 10px 0;"></div>
                        
                        <button onclick="limparCacheSistema()" style="background: #ff4757; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; width: 100%;">Limpar Cache & Reiniciar</button>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>


<script>
    // Omni Bar Features
    function minimizeOmniBar() {
        // Logic to minimize: Scale down and move to corner, or hide and show a bubble
        // For now, let's just fade it out and show a refined notification or bubble (future)
        // User said: "when it minimizes ... opens the pop window"
        
        const bar = document.getElementById('omni-trigger');
        bar.style.transform = 'translate(-50%, 100vh)'; // Slide down off screen?
        bar.style.opacity = '0';
        
        // Show restore button (Mini Pop) - TODO: Implement the dedicated pop/bubble trigger
        // For now, let's allow Ctrl+K to restore
        setTimeout(() => {
             // Create or show a mini bubble? 
             // "vamos deixa o modo pop de fora" -> Maybe just hide it effectively.
        }, 300);
    }
    
    function toggleModelSelector() {
        const results = document.getElementById('omni-results');
        const isVisible = results.style.display !== 'none';
        
        if(isVisible) {
            results.style.display = 'none';
            return;
        }
        
        // Populate with Model Garden options
        const models = [
            {id: 'gemini-flash', name: 'Gemini 1.5 Flash', icon: 'fa-bolt', desc: 'R√°pido e eficiente'},
            {id: 'gemini-pro', name: 'Gemini 1.5 Pro', icon: 'fa-brain', desc: 'Racioc√≠nio complexo'},
            {id: 'claude-sonnet', name: 'Claude 3.5 Sonnet', icon: 'fa-feather', desc: 'Criatividade e c√≥digo'},
            {id: 'imagen-3', name: 'Imagen 3', icon: 'fa-image', desc: 'Gera√ß√£o de imagens'}
        ];
        
        let html = '<div style="padding:8px;"><div style="font-size:11px; font-weight:600; color:var(--text-secondary); margin-bottom:8px; padding-left:8px;">MODEL GARDEN</div>';
        
        models.forEach(m => {
            html += `
            <div class="omni-item" onclick="selectModel('${m.name}')" style="padding:8px 12px; border-radius:8px; display:flex; align-items:center; gap:10px; cursor:pointer;">
                <div style="width:24px; height:24px; background:var(--bg-app); border-radius:6px; display:flex; align-items:center; justify-content:center;">
                    <i class="fas ${m.icon}" style="font-size:12px;"></i>
                </div>
                <div>
                    <div style="font-size:13px; font-weight:500; color:var(--text-primary);">${m.name}</div>
                    <div style="font-size:11px; color:var(--text-secondary);">${m.desc}</div>
                </div>
                ${document.getElementById('model-name-text').innerText === m.name ? '<i class="fas fa-check" style="margin-left:auto; color:var(--accent-primary); font-size:12px;"></i>' : ''}
            </div>
            `;
        });
        
        html += '</div>';
        results.innerHTML = html;
        results.style.display = 'block';
    }
    
    function selectModel(name) {
        document.getElementById('model-name-text').innerText = name;
        document.getElementById('omni-results').style.display = 'none';
    }
</script>


<script>
    // Extend Omni Input to show chat on Enter
    document.getElementById('omni-input').addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && e.target.value.trim()) {
            // Show chat window
            const chatArea = document.getElementById('omni-chat-expansion');
            chatArea.style.display = 'block';
            
            // Add user message (Demo)
            const msg = document.createElement('div');
            msg.innerHTML = `<div style="text-align:right; margin-bottom:10px;"><span style="background:var(--accent-primary); color:white; padding:6px 12px; border-radius:12px 12px 0 12px; font-size:14px;">${e.target.value}</span></div>`;
            chatArea.appendChild(msg);
            
            // Simulate Reply
            setTimeout(() => {
                 const reply = document.createElement('div');
                 reply.innerHTML = `<div style="text-align:left; margin-bottom:10px; display:flex; gap:8px;">
                    <div style="font-size:20px;">üêº</div>
                    <div style="background:var(--bg-card); border:1px solid var(--border-subtle); padding:8px 12px; border-radius:12px 12px 12px 0; font-size:14px; color:var(--text-primary);">Processando sua solicita√ß√£o... <br><span style="font-size:11px; opacity:0.7;">(Conectado ao Gemini Flash)</span></div>
                 </div>`;
                 chatArea.appendChild(reply);
                 chatArea.scrollTop = chatArea.scrollHeight;
            }, 600);
            
            e.target.value = ''; // Clear
        }
    });
</script>


<script>
    // State: Start with Bar Open, FAB Hidden (or logic choice)
    // User wants: Minimize -> Show FAB. Click FAB -> Show Bar.
    
    function minimizeOmniBar() {
        // Animation Out
        const bar = document.getElementById('omni-trigger');
        bar.style.opacity = '0';
        bar.style.transform = 'translate(-50%, 20px) scale(0.95)';
        
        setTimeout(() => {
            bar.style.display = 'none';
            // Show FAB
            const fab = document.getElementById('panda-fab');
            fab.style.display = 'flex';
            // Small animation for FAB pop
            fab.style.transform = 'scale(0)';
            setTimeout(() => fab.style.transform = 'scale(1)', 50);
        }, 200);
    }
    
    // This function might already exist, we override or ensure it handles the FAB
    window.toggleOmniBar = function() {
        const bar = document.getElementById('omni-trigger');
        const fab = document.getElementById('panda-fab');
        
        // If bar is hidden, show it
        if (bar.style.display === 'none') {
            fab.style.transform = 'scale(0)';
            setTimeout(() => fab.style.display = 'none', 200);
            
            bar.style.display = 'flex';
            
            setTimeout(() => {
                bar.style.opacity = '1';
                // CRITICAL: Preserve bottom-centered positioning
                bar.style.transform = 'translateX(-50%)';
            }, 50);
            
            // Focus input
            setTimeout(() => document.getElementById('omni-input').focus(), 100);
            
        } else {
            minimizeOmniBar();
        }
    };
    
    // Ensure Minimize Icon is Visible (Force Color fix if needed)
    // Injected styles handle it, but let's be safe.
</script>


<script>
    // Language Switcher Logic
    function toggleLangMenu() {
        const dropdown = document.getElementById('langDropdown');
        dropdown.classList.toggle('show');
        
        // Close on click outside
        document.addEventListener('click', function closeLang(e) {
            if (!e.target.closest('.lang-switcher-wrapper')) {
                dropdown.classList.remove('show');
                document.removeEventListener('click', closeLang);
            }
        });
    }

    function changeLanguage(lang) {
        const btn = document.getElementById('langBtn');
        const map = {
            'pt': 'üáßüá∑',
            'en': 'üá∫üá∏',
            'es': 'üá™üá∏'
        };
        btn.innerHTML = `<span style="font-size: 16px;">${map[lang]}</span>`;
        // Future: trigger translation logic here
        console.log("Language changed to:", lang);
    }
</script>


<script type="module">
    // üêº Panda Fabrics - Firebase Bridge (Frontend)
    // Connects Browser -> Firebase -> Rust Agent
    
    // Config Placeholder (User needs to fill this securely)
    const FIREBASE_CONFIG = {
        databaseURL: "https://YOUR-PROJECT.firebasedatabase.app",
        projectId: "YOUR-PROJECT",
    };

    class PandaBridgeFirebase {
        constructor() {
            this.uid = null;
            this.db = null; // Initialize Firebase ref
            this.status = 'disconnected';
            this.monitors = {
                fb: document.querySelector('.status-pill[title*="Firebase"] .status-dot'),
                ru: document.querySelector('.status-pill[title*="Rust"] .status-dot')
            };
            
            console.log("üêº Bridge: Initializing...");
            this.updateStatus('fb', 'warning'); // Connecting
        }

        async connect(uid) {
            this.uid = uid;
            // Mock connection success
            setTimeout(() => {
                this.status = 'connected';
                this.updateStatus('fb', 'online');
                console.log(`üêº Bridge: Connected to Channel [${uid}]`);
                
                // Simulate heartbeat from Rust
                this.simulateRustHeartbeat();
            }, 1000);
        }
           
        updateStatus(agent, state) {
            // state: online, warning, offline
            if(this.monitors[agent]) {
                const dot = this.monitors[agent];
                dot.className = `status-dot ${state}`;
            }
        }

        async sendCommand(action, payload) {
            if (this.status !== 'connected') {
                console.warn("üêº Bridge: Offline. Check Firebase.");
                return;
            }
            
            const cmdId = Date.now().toString(36);
            const securePayload = this.encrypt(payload); // Client-side encryption
            
            console.log(`üöÄ Sending Command [${action}] -> Firebase...`);
            // Real code would use: set(ref(db, `channels/${this.uid}/command_queue/${cmdId}`), ...)
            
            return cmdId;
        }

        encrypt(data) {
            // TODO: Implement AES-GCM 256 here.
            // For now, identity.
            return data;
        }
        
        simulateRustHeartbeat() {
            // Mocking Rust agent coming online after a few seconds
            setTimeout(() => {
                this.updateStatus('ru', 'online');
                console.log("ü¶Ä Rust Agent: ONLINE via Firebase");
            }, 3000);
        }
    }

    // Expose Global
    window.PandaBridge = new PandaBridgeFirebase();
    
    // Auto-connect on load (Mock ID)
    window.addEventListener('load', () => {
        window.PandaBridge.connect('user_123_mock');
    });

</script>


<script>
    // Settings Modal Logic
    function mudarSecaoSettings(sectionId) {
        // 1. Sidebar Active State
        document.querySelectorAll('.settings-nav-item').forEach(item => {
            item.classList.remove('active');
            if(item.getAttribute('data-section') === sectionId) {
                item.classList.add('active');
            }
        });

        // 2. Hide all Sections
        document.querySelectorAll('.settings-section').forEach(sec => {
            sec.style.display = 'none';
        });

        // 3. Show Target Section
        const target = document.getElementById('settings-' + sectionId);
        if(target) {
            target.style.display = 'block';
            // Animation
            target.style.opacity = '0';
            target.style.transform = 'translateY(10px)';
            setTimeout(() => {
                target.style.opacity = '1';
                target.style.transform = 'translateY(0)';
            }, 50);
        }
    }

    // Toggle GPU Mock
    function toggleGPU() {
        const toggle = document.getElementById('gpuToggle');
        toggle.classList.toggle('active');
        const isActive = toggle.classList.contains('active');
        
        // Update Badge
        const badge = document.getElementById('gpuBadge');
        if(isActive) {
            badge.className = 'gpu-badge online';
            badge.innerHTML = '<span>‚ö°</span> RTX 3060 (Simulated)';
        } else {
            badge.className = 'gpu-badge offline';
            badge.innerHTML = '<span>‚ö†Ô∏è</span> Nenhuma GPU detectada';
        }
    }
</script>

<script type="module" src="js/ModuleLoader.js"></script>
</body>
</html>