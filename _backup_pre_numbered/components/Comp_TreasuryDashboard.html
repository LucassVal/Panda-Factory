<!-- ============================================= -->
<!-- TREASURY DASHBOARD v1.0                     -->
<!-- Financial Health Score + Reserve Breakdown  -->
<!-- ============================================= -->
<style>
  .treasury-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(8px);
    z-index: 9500;
    display: none;
    align-items: center;
    justify-content: center;
  }

  .treasury-overlay.active {
    display: flex;
  }

  .treasury-modal {
    width: 90%;
    max-width: 700px;
    max-height: 85vh;
    overflow-y: auto;
    border-radius: 24px;
    padding: 32px;
    animation: modalSlideIn 0.3s ease;
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(102, 126, 234, 0.1);
    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.3);
  }

  .dark-mode .treasury-modal {
    background: rgba(15, 15, 25, 0.95);
    border-color: rgba(102, 126, 234, 0.2);
  }

  @keyframes modalSlideIn {
    from {
      transform: scale(0.95) translateY(20px);
      opacity: 0;
    }
    to {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
  }

  .treasury-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }

  .treasury-title {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .treasury-title h2 {
    margin: 0;
    font-size: 24px;
    font-weight: 700;
    color: var(--text-primary, #1a1a2e);
  }

  .dark-mode .treasury-title h2 {
    color: #fff;
  }

  .treasury-close {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    background: rgba(102, 126, 234, 0.1);
    cursor: pointer;
    font-size: 18px;
  }

  /* Health Score Circle */
  .health-score-container {
    display: flex;
    align-items: center;
    gap: 32px;
    padding: 24px;
    background: linear-gradient(
      135deg,
      rgba(16, 185, 129, 0.1),
      rgba(102, 126, 234, 0.1)
    );
    border-radius: 20px;
    margin-bottom: 24px;
  }

  .health-circle {
    position: relative;
    width: 120px;
    height: 120px;
  }

  .health-circle svg {
    transform: rotate(-90deg);
  }

  .health-circle-bg {
    fill: none;
    stroke: rgba(102, 126, 234, 0.15);
    stroke-width: 8;
  }

  .health-circle-fill {
    fill: none;
    stroke: #10b981;
    stroke-width: 8;
    stroke-linecap: round;
    transition: stroke-dashoffset 1s ease;
  }

  .health-circle-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
  }

  .health-score-value {
    font-size: 32px;
    font-weight: 800;
    color: #10b981;
  }

  .health-score-label {
    font-size: 11px;
    color: var(--text-secondary, #64748b);
    text-transform: uppercase;
  }

  .health-breakdown {
    flex: 1;
  }

  .health-metric {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  .health-metric-bar {
    flex: 1;
    height: 8px;
    background: rgba(102, 126, 234, 0.15);
    border-radius: 4px;
    overflow: hidden;
  }

  .health-metric-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease;
  }

  .health-metric-label {
    width: 140px;
    font-size: 12px;
    color: var(--text-secondary, #64748b);
  }

  .health-metric-value {
    width: 50px;
    font-size: 12px;
    font-weight: 600;
    text-align: right;
  }

  /* Reserve Breakdown */
  .reserve-section {
    margin-bottom: 24px;
  }

  .section-title {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-secondary, #64748b);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 16px;
  }

  .reserve-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
  }

  .reserve-card {
    padding: 16px;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(102, 126, 234, 0.1);
  }

  .dark-mode .reserve-card {
    background: rgba(30, 30, 45, 0.6);
  }

  .reserve-card-icon {
    font-size: 24px;
    margin-bottom: 8px;
  }

  .reserve-card-label {
    font-size: 12px;
    color: var(--text-secondary, #64748b);
    margin-bottom: 4px;
  }

  .reserve-card-value {
    font-size: 20px;
    font-weight: 700;
    color: var(--text-primary, #1a1a2e);
  }

  .dark-mode .reserve-card-value {
    color: #fff;
  }

  .reserve-card-percent {
    font-size: 12px;
    color: #10b981;
    font-weight: 600;
  }

  /* Total Reserve */
  .total-reserve {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    background: linear-gradient(135deg, #667eea, #764ba2);
    border-radius: 16px;
    color: #fff;
    margin-bottom: 24px;
  }

  .total-label {
    font-size: 14px;
    opacity: 0.9;
  }

  .total-value {
    font-size: 28px;
    font-weight: 800;
  }

  /* Audit Section */
  .audit-section {
    padding: 16px;
    background: rgba(102, 126, 234, 0.06);
    border-radius: 12px;
  }

  .audit-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid rgba(102, 126, 234, 0.1);
  }

  .audit-row:last-child {
    border-bottom: none;
  }

  .audit-label {
    font-size: 13px;
    color: var(--text-secondary, #64748b);
  }

  .audit-value {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-primary, #1a1a2e);
  }

  .dark-mode .audit-value {
    color: #fff;
  }

  .audit-link {
    color: #667eea;
    text-decoration: none;
    font-size: 12px;
  }

  .audit-link:hover {
    text-decoration: underline;
  }
</style>

<div
  class="treasury-overlay"
  id="treasuryOverlay"
  onclick="if (event.target === this) PandaTreasury.close();"
>
  <div class="treasury-modal">
    <div class="treasury-header">
      <div class="treasury-title">
        <span style="font-size: 32px">üè¶</span>
        <h2>Panda Treasury</h2>
      </div>
      <button class="treasury-close" onclick="PandaTreasury.close()">‚úï</button>
    </div>

    <!-- Health Score -->
    <div class="health-score-container">
      <div class="health-circle">
        <svg width="120" height="120" viewBox="0 0 120 120">
          <circle class="health-circle-bg" cx="60" cy="60" r="52" />
          <circle
            class="health-circle-fill"
            id="healthCircleFill"
            cx="60"
            cy="60"
            r="52"
            stroke-dasharray="326.7"
            stroke-dashoffset="26.1"
          />
        </svg>
        <div class="health-circle-text">
          <div class="health-score-value" id="healthScoreDisplay">92%</div>
          <div class="health-score-label">Health</div>
        </div>
      </div>

      <div class="health-breakdown">
        <div class="health-metric">
          <span class="health-metric-label">Reserva vs Circulante</span>
          <div class="health-metric-bar">
            <div
              class="health-metric-fill"
              style="width: 85%; background: #10b981"
            ></div>
          </div>
          <span class="health-metric-value">85%</span>
        </div>
        <div class="health-metric">
          <span class="health-metric-label">Runway (dias)</span>
          <div class="health-metric-bar">
            <div
              class="health-metric-fill"
              style="width: 100%; background: #667eea"
            ></div>
          </div>
          <span class="health-metric-value">120d</span>
        </div>
        <div class="health-metric">
          <span class="health-metric-label">Diversifica√ß√£o</span>
          <div class="health-metric-bar">
            <div
              class="health-metric-fill"
              style="width: 80%; background: #f59e0b"
            ></div>
          </div>
          <span class="health-metric-value">80%</span>
        </div>
        <div class="health-metric">
          <span class="health-metric-label">Liquidez Imediata</span>
          <div class="health-metric-bar">
            <div
              class="health-metric-fill"
              style="width: 100%; background: #8b5cf6"
            ></div>
          </div>
          <span class="health-metric-value">100%</span>
        </div>
      </div>
    </div>

    <!-- Reserve Breakdown -->
    <div class="reserve-section">
      <div class="section-title">üí∞ Composi√ß√£o da Reserva</div>
      <div class="reserve-grid">
        <div class="reserve-card">
          <div class="reserve-card-icon">ü•á</div>
          <div class="reserve-card-label">PAXG (Ouro)</div>
          <div class="reserve-card-value">$1,500,000</div>
          <div class="reserve-card-percent">65%</div>
        </div>
        <div class="reserve-card">
          <div class="reserve-card-icon">üíµ</div>
          <div class="reserve-card-label">USDC (Stablecoin)</div>
          <div class="reserve-card-value">$700,000</div>
          <div class="reserve-card-percent">30%</div>
        </div>
        <div class="reserve-card">
          <div class="reserve-card-icon">‚ö°</div>
          <div class="reserve-card-label">Liquidez Ops</div>
          <div class="reserve-card-value">$100,000</div>
          <div class="reserve-card-percent">5%</div>
        </div>
        <div class="reserve-card">
          <div class="reserve-card-icon">üîí</div>
          <div class="reserve-card-label">Em Staking</div>
          <div class="reserve-card-value">$50,000</div>
          <div class="reserve-card-percent">+2.1%</div>
        </div>
      </div>
    </div>

    <!-- Total -->
    <div class="total-reserve">
      <div>
        <div class="total-label">Reserva Total</div>
        <div class="total-value">$2,300,000</div>
      </div>
      <div style="text-align: right">
        <div class="total-label">Circulante</div>
        <div style="font-size: 20px; font-weight: 600">5.2M PC</div>
      </div>
    </div>

    <!-- Audit Info -->
    <div class="audit-section">
      <div class="section-title">üîê Auditoria On-Chain</div>
      <div class="audit-row">
        <span class="audit-label">√öltimo Snapshot</span>
        <span class="audit-value" id="lastSnapshot">23/01/2026 15:00</span>
      </div>
      <div class="audit-row">
        <span class="audit-label">Frequ√™ncia</span>
        <span class="audit-value">Di√°ria (~$0.30/m√™s)</span>
      </div>
      <div class="audit-row">
        <span class="audit-label">Blockchain</span>
        <span class="audit-value">Solana (Ed25519)</span>
      </div>
      <div class="audit-row">
        <span class="audit-label">Hash Transa√ß√£o</span>
        <a href="#" class="audit-link">4xK7...mN9p (ver Solscan)</a>
      </div>
    </div>
  </div>
</div>

<script>
  /**
   * PandaTreasury Controller v1.1 - SDK Integrated
   */
  window.PandaTreasury = {
    data: {
      healthScore: 92,
      reserves: {
        paxg: 1500000,
        usdc: 700000,
        ops: 100000,
        staking: 50000,
      },
      circulatingPC: 5200000,
      lastSnapshot: new Date(),
    },

    async open() {
      const overlay = document.getElementById("treasuryOverlay");
      if (overlay) {
        overlay.classList.add("active");
        await this.syncWithSDK();
        this.updateDisplay();
      }
    },

    close() {
      const overlay = document.getElementById("treasuryOverlay");
      if (overlay) {
        overlay.classList.remove("active");
      }
    },

    /**
     * Sync with Panda SDK for live reserve data
     */
    async syncWithSDK() {
      try {
        if (typeof Panda === "undefined" || !Panda.Treasury) {
          console.log("üè¶ Treasury: Using local mock data");
          return;
        }

        // Fetch live data from SDK
        const reserves = await Panda.Treasury.getReserves();
        const health = await Panda.Treasury.getHealthScore();

        if (reserves) {
          this.data.reserves = reserves;
          this.data.healthScore = health || this.calculateHealth();
          this.data.lastSnapshot = new Date();
        }

        console.log("üè¶ Treasury: Synced with SDK", this.data);
      } catch (e) {
        console.warn("üè¶ Treasury SDK sync failed:", e.message);
      }
    },

    updateDisplay() {
      // Update health score circle
      const circle = document.getElementById("healthCircleFill");
      const display = document.getElementById("healthScoreDisplay");
      const header = document.getElementById("healthScore");

      if (circle) {
        const circumference = 326.7;
        const offset =
          circumference - (this.data.healthScore / 100) * circumference;
        circle.style.strokeDashoffset = offset;
      }

      if (display) display.textContent = this.data.healthScore + "%";
      if (header) header.textContent = this.data.healthScore + "%";

      // Update reserve cards dynamically
      this.updateReserveCards();
      this.updateTotalReserve();
      this.updateSnapshotTime();
    },

    updateReserveCards() {
      const total = Object.values(this.data.reserves).reduce(
        (a, b) => a + b,
        0,
      );
      const cards = document.querySelectorAll(".reserve-card");

      const values = [
        { key: "paxg", label: "PAXG" },
        { key: "usdc", label: "USDC" },
        { key: "ops", label: "Ops" },
        { key: "staking", label: "Staking" },
      ];

      cards.forEach((card, i) => {
        if (values[i]) {
          const val = this.data.reserves[values[i].key] || 0;
          const pct = Math.round((val / total) * 100);
          const valueEl = card.querySelector(".reserve-card-value");
          const pctEl = card.querySelector(".reserve-card-percent");
          if (valueEl) valueEl.textContent = "$" + val.toLocaleString("en-US");
          if (pctEl) pctEl.textContent = pct + "%";
        }
      });
    },

    updateTotalReserve() {
      const total = Object.values(this.data.reserves).reduce(
        (a, b) => a + b,
        0,
      );
      const totalEl = document.querySelector(".total-value");
      if (totalEl) totalEl.textContent = "$" + total.toLocaleString("en-US");
    },

    updateSnapshotTime() {
      const el = document.getElementById("lastSnapshot");
      if (el && this.data.lastSnapshot) {
        el.textContent = this.data.lastSnapshot.toLocaleString("pt-BR");
      }
    },

    calculateHealth() {
      // Formula: (reserve/circulating*40) + (runway*30) + (diversification*20) + (liquidity*10)
      const totalReserve = Object.values(this.data.reserves).reduce(
        (a, b) => a + b,
        0,
      );
      const reserveRatio = Math.min(
        100,
        (totalReserve / (this.data.circulatingPC * 0.01)) * 100,
      );

      // Simplified calculation
      this.data.healthScore = Math.round(
        reserveRatio * 0.4 +
          100 * 0.3 + // runway score
          80 * 0.2 + // diversification
          100 * 0.1, // liquidity
      );

      return this.data.healthScore;
    },
  };

  console.log("üè¶ PandaTreasury v1.1 loaded (SDK integrated)");
</script>
