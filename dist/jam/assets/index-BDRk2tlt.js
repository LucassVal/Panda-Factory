var o8=Object.defineProperty;var a8=(n,e,t)=>e in n?o8(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var w=(n,e,t)=>a8(n,typeof e!="symbol"?e+"":e,t);function l8(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const i in s)if(i!=="default"&&!(i in n)){const r=Object.getOwnPropertyDescriptor(s,i);r&&Object.defineProperty(n,i,r.get?r:{enumerable:!0,get:()=>s[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var Gn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Oa(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var FR={exports:{}},Cv={},BR={exports:{}},Ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _p=Symbol.for("react.element"),c8=Symbol.for("react.portal"),d8=Symbol.for("react.fragment"),u8=Symbol.for("react.strict_mode"),h8=Symbol.for("react.profiler"),p8=Symbol.for("react.provider"),f8=Symbol.for("react.context"),g8=Symbol.for("react.forward_ref"),m8=Symbol.for("react.suspense"),y8=Symbol.for("react.memo"),v8=Symbol.for("react.lazy"),gI=Symbol.iterator;function x8(n){return n===null||typeof n!="object"?null:(n=gI&&n[gI]||n["@@iterator"],typeof n=="function"?n:null)}var UR={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},$R=Object.assign,zR={};function Nd(n,e,t){this.props=n,this.context=e,this.refs=zR,this.updater=t||UR}Nd.prototype.isReactComponent={};Nd.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Nd.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function WR(){}WR.prototype=Nd.prototype;function sC(n,e,t){this.props=n,this.context=e,this.refs=zR,this.updater=t||UR}var iC=sC.prototype=new WR;iC.constructor=sC;$R(iC,Nd.prototype);iC.isPureReactComponent=!0;var mI=Array.isArray,HR=Object.prototype.hasOwnProperty,rC={current:null},GR={key:!0,ref:!0,__self:!0,__source:!0};function VR(n,e,t){var s,i={},r=null,o=null;if(e!=null)for(s in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)HR.call(e,s)&&!GR.hasOwnProperty(s)&&(i[s]=e[s]);var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];i.children=c}if(n&&n.defaultProps)for(s in l=n.defaultProps,l)i[s]===void 0&&(i[s]=l[s]);return{$$typeof:_p,type:n,key:r,ref:o,props:i,_owner:rC.current}}function S8(n,e){return{$$typeof:_p,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function oC(n){return typeof n=="object"&&n!==null&&n.$$typeof===_p}function w8(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var yI=/\/+/g;function sS(n,e){return typeof n=="object"&&n!==null&&n.key!=null?w8(""+n.key):e.toString(36)}function Rg(n,e,t,s,i){var r=typeof n;(r==="undefined"||r==="boolean")&&(n=null);var o=!1;if(n===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(n.$$typeof){case _p:case c8:o=!0}}if(o)return o=n,i=i(o),n=s===""?"."+sS(o,0):s,mI(i)?(t="",n!=null&&(t=n.replace(yI,"$&/")+"/"),Rg(i,e,t,"",function(d){return d})):i!=null&&(oC(i)&&(i=S8(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(yI,"$&/")+"/")+n)),e.push(i)),1;if(o=0,s=s===""?".":s+":",mI(n))for(var l=0;l<n.length;l++){r=n[l];var c=s+sS(r,l);o+=Rg(r,e,t,c,i)}else if(c=x8(n),typeof c=="function")for(n=c.call(n),l=0;!(r=n.next()).done;)r=r.value,c=s+sS(r,l++),o+=Rg(r,e,t,c,i);else if(r==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Sf(n,e,t){if(n==null)return n;var s=[],i=0;return Rg(n,s,"","",function(r){return e.call(t,r,i++)}),s}function b8(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var ls={current:null},Mg={transition:null},_8={ReactCurrentDispatcher:ls,ReactCurrentBatchConfig:Mg,ReactCurrentOwner:rC};function KR(){throw Error("act(...) is not supported in production builds of React.")}Ue.Children={map:Sf,forEach:function(n,e,t){Sf(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Sf(n,function(){e++}),e},toArray:function(n){return Sf(n,function(e){return e})||[]},only:function(n){if(!oC(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Ue.Component=Nd;Ue.Fragment=d8;Ue.Profiler=h8;Ue.PureComponent=sC;Ue.StrictMode=u8;Ue.Suspense=m8;Ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=_8;Ue.act=KR;Ue.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var s=$R({},n.props),i=n.key,r=n.ref,o=n._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=rC.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(c in e)HR.call(e,c)&&!GR.hasOwnProperty(c)&&(s[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)s.children=t;else if(1<c){l=Array(c);for(var d=0;d<c;d++)l[d]=arguments[d+2];s.children=l}return{$$typeof:_p,type:n.type,key:i,ref:r,props:s,_owner:o}};Ue.createContext=function(n){return n={$$typeof:f8,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:p8,_context:n},n.Consumer=n};Ue.createElement=VR;Ue.createFactory=function(n){var e=VR.bind(null,n);return e.type=n,e};Ue.createRef=function(){return{current:null}};Ue.forwardRef=function(n){return{$$typeof:g8,render:n}};Ue.isValidElement=oC;Ue.lazy=function(n){return{$$typeof:v8,_payload:{_status:-1,_result:n},_init:b8}};Ue.memo=function(n,e){return{$$typeof:y8,type:n,compare:e===void 0?null:e}};Ue.startTransition=function(n){var e=Mg.transition;Mg.transition={};try{n()}finally{Mg.transition=e}};Ue.unstable_act=KR;Ue.useCallback=function(n,e){return ls.current.useCallback(n,e)};Ue.useContext=function(n){return ls.current.useContext(n)};Ue.useDebugValue=function(){};Ue.useDeferredValue=function(n){return ls.current.useDeferredValue(n)};Ue.useEffect=function(n,e){return ls.current.useEffect(n,e)};Ue.useId=function(){return ls.current.useId()};Ue.useImperativeHandle=function(n,e,t){return ls.current.useImperativeHandle(n,e,t)};Ue.useInsertionEffect=function(n,e){return ls.current.useInsertionEffect(n,e)};Ue.useLayoutEffect=function(n,e){return ls.current.useLayoutEffect(n,e)};Ue.useMemo=function(n,e){return ls.current.useMemo(n,e)};Ue.useReducer=function(n,e,t){return ls.current.useReducer(n,e,t)};Ue.useRef=function(n){return ls.current.useRef(n)};Ue.useState=function(n){return ls.current.useState(n)};Ue.useSyncExternalStore=function(n,e,t){return ls.current.useSyncExternalStore(n,e,t)};Ue.useTransition=function(){return ls.current.useTransition()};Ue.version="18.3.1";BR.exports=Ue;var b=BR.exports;const Oe=Oa(b),YR=l8({__proto__:null,default:Oe},[b]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C8=b,E8=Symbol.for("react.element"),T8=Symbol.for("react.fragment"),I8=Object.prototype.hasOwnProperty,P8=C8.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,k8={key:!0,ref:!0,__self:!0,__source:!0};function XR(n,e,t){var s,i={},r=null,o=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(s in e)I8.call(e,s)&&!k8.hasOwnProperty(s)&&(i[s]=e[s]);if(n&&n.defaultProps)for(s in e=n.defaultProps,e)i[s]===void 0&&(i[s]=e[s]);return{$$typeof:E8,type:n,key:r,ref:o,props:i,_owner:P8.current}}Cv.Fragment=T8;Cv.jsx=XR;Cv.jsxs=XR;FR.exports=Cv;var a=FR.exports,Ab={},qR={exports:{}},ti={},ZR={exports:{}},JR={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(F,W){var $=F.length;F.push(W);e:for(;0<$;){var K=$-1>>>1,Y=F[K];if(0<i(Y,W))F[K]=W,F[$]=Y,$=K;else break e}}function t(F){return F.length===0?null:F[0]}function s(F){if(F.length===0)return null;var W=F[0],$=F.pop();if($!==W){F[0]=$;e:for(var K=0,Y=F.length,U=Y>>>1;K<U;){var J=2*(K+1)-1,te=F[J],ee=J+1,ae=F[ee];if(0>i(te,$))ee<Y&&0>i(ae,te)?(F[K]=ae,F[ee]=$,K=ee):(F[K]=te,F[J]=$,K=J);else if(ee<Y&&0>i(ae,$))F[K]=ae,F[ee]=$,K=ee;else break e}}return W}function i(F,W){var $=F.sortIndex-W.sortIndex;return $!==0?$:F.id-W.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;n.unstable_now=function(){return r.now()}}else{var o=Date,l=o.now();n.unstable_now=function(){return o.now()-l}}var c=[],d=[],u=1,h=null,p=3,f=!1,g=!1,m=!1,x=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(F){for(var W=t(d);W!==null;){if(W.callback===null)s(d);else if(W.startTime<=F)s(d),W.sortIndex=W.expirationTime,e(c,W);else break;W=t(d)}}function C(F){if(m=!1,v(F),!g)if(t(c)!==null)g=!0,L(T);else{var W=t(d);W!==null&&O(C,W.startTime-F)}}function T(F,W){g=!1,m&&(m=!1,y(P),P=-1),f=!0;var $=p;try{for(v(W),h=t(c);h!==null&&(!(h.expirationTime>W)||F&&!D());){var K=h.callback;if(typeof K=="function"){h.callback=null,p=h.priorityLevel;var Y=K(h.expirationTime<=W);W=n.unstable_now(),typeof Y=="function"?h.callback=Y:h===t(c)&&s(c),v(W)}else s(c);h=t(c)}if(h!==null)var U=!0;else{var J=t(d);J!==null&&O(C,J.startTime-W),U=!1}return U}finally{h=null,p=$,f=!1}}var I=!1,E=null,P=-1,k=5,j=-1;function D(){return!(n.unstable_now()-j<k)}function R(){if(E!==null){var F=n.unstable_now();j=F;var W=!0;try{W=E(!0,F)}finally{W?A():(I=!1,E=null)}}else I=!1}var A;if(typeof S=="function")A=function(){S(R)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,B=N.port2;N.port1.onmessage=R,A=function(){B.postMessage(null)}}else A=function(){x(R,0)};function L(F){E=F,I||(I=!0,A())}function O(F,W){P=x(function(){F(n.unstable_now())},W)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(F){F.callback=null},n.unstable_continueExecution=function(){g||f||(g=!0,L(T))},n.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<F?Math.floor(1e3/F):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(F){switch(p){case 1:case 2:case 3:var W=3;break;default:W=p}var $=p;p=W;try{return F()}finally{p=$}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(F,W){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var $=p;p=F;try{return W()}finally{p=$}},n.unstable_scheduleCallback=function(F,W,$){var K=n.unstable_now();switch(typeof $=="object"&&$!==null?($=$.delay,$=typeof $=="number"&&0<$?K+$:K):$=K,F){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=$+Y,F={id:u++,callback:W,priorityLevel:F,startTime:$,expirationTime:Y,sortIndex:-1},$>K?(F.sortIndex=$,e(d,F),t(c)===null&&F===t(d)&&(m?(y(P),P=-1):m=!0,O(C,$-K))):(F.sortIndex=Y,e(c,F),g||f||(g=!0,L(T))),F},n.unstable_shouldYield=D,n.unstable_wrapCallback=function(F){var W=p;return function(){var $=p;p=W;try{return F.apply(this,arguments)}finally{p=$}}}})(JR);ZR.exports=JR;var A8=ZR.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j8=b,Js=A8;function ie(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var QR=new Set,Oh={};function Vl(n,e){cd(n,e),cd(n+"Capture",e)}function cd(n,e){for(Oh[n]=e,n=0;n<e.length;n++)QR.add(e[n])}var go=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),jb=Object.prototype.hasOwnProperty,N8=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,vI={},xI={};function R8(n){return jb.call(xI,n)?!0:jb.call(vI,n)?!1:N8.test(n)?xI[n]=!0:(vI[n]=!0,!1)}function M8(n,e,t,s){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function O8(n,e,t,s){if(e===null||typeof e>"u"||M8(n,e,t,s))return!0;if(s)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function cs(n,e,t,s,i,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var Pn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Pn[n]=new cs(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Pn[e]=new cs(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Pn[n]=new cs(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Pn[n]=new cs(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Pn[n]=new cs(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Pn[n]=new cs(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Pn[n]=new cs(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Pn[n]=new cs(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Pn[n]=new cs(n,5,!1,n.toLowerCase(),null,!1,!1)});var aC=/[\-:]([a-z])/g;function lC(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(aC,lC);Pn[e]=new cs(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(aC,lC);Pn[e]=new cs(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(aC,lC);Pn[e]=new cs(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Pn[n]=new cs(n,1,!1,n.toLowerCase(),null,!1,!1)});Pn.xlinkHref=new cs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Pn[n]=new cs(n,1,!1,n.toLowerCase(),null,!0,!0)});function cC(n,e,t,s){var i=Pn.hasOwnProperty(e)?Pn[e]:null;(i!==null?i.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(O8(e,t,i,s)&&(t=null),s||i===null?R8(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,s=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,s?n.setAttributeNS(s,e,t):n.setAttribute(e,t))))}var Po=j8.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,wf=Symbol.for("react.element"),bc=Symbol.for("react.portal"),_c=Symbol.for("react.fragment"),dC=Symbol.for("react.strict_mode"),Nb=Symbol.for("react.profiler"),eM=Symbol.for("react.provider"),tM=Symbol.for("react.context"),uC=Symbol.for("react.forward_ref"),Rb=Symbol.for("react.suspense"),Mb=Symbol.for("react.suspense_list"),hC=Symbol.for("react.memo"),Zo=Symbol.for("react.lazy"),nM=Symbol.for("react.offscreen"),SI=Symbol.iterator;function au(n){return n===null||typeof n!="object"?null:(n=SI&&n[SI]||n["@@iterator"],typeof n=="function"?n:null)}var Lt=Object.assign,iS;function Uu(n){if(iS===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);iS=e&&e[1]||""}return`
`+iS+n}var rS=!1;function oS(n,e){if(!n||rS)return"";rS=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(d){var s=d}Reflect.construct(n,[],e)}else{try{e.call()}catch(d){s=d}n.call(e.prototype)}else{try{throw Error()}catch(d){s=d}n()}}catch(d){if(d&&s&&typeof d.stack=="string"){for(var i=d.stack.split(`
`),r=s.stack.split(`
`),o=i.length-1,l=r.length-1;1<=o&&0<=l&&i[o]!==r[l];)l--;for(;1<=o&&0<=l;o--,l--)if(i[o]!==r[l]){if(o!==1||l!==1)do if(o--,l--,0>l||i[o]!==r[l]){var c=`
`+i[o].replace(" at new "," at ");return n.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",n.displayName)),c}while(1<=o&&0<=l);break}}}finally{rS=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?Uu(n):""}function D8(n){switch(n.tag){case 5:return Uu(n.type);case 16:return Uu("Lazy");case 13:return Uu("Suspense");case 19:return Uu("SuspenseList");case 0:case 2:case 15:return n=oS(n.type,!1),n;case 11:return n=oS(n.type.render,!1),n;case 1:return n=oS(n.type,!0),n;default:return""}}function Ob(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case _c:return"Fragment";case bc:return"Portal";case Nb:return"Profiler";case dC:return"StrictMode";case Rb:return"Suspense";case Mb:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case tM:return(n.displayName||"Context")+".Consumer";case eM:return(n._context.displayName||"Context")+".Provider";case uC:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case hC:return e=n.displayName||null,e!==null?e:Ob(n.type)||"Memo";case Zo:e=n._payload,n=n._init;try{return Ob(n(e))}catch{}}return null}function L8(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ob(e);case 8:return e===dC?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ia(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function sM(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function F8(n){var e=sM(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),s=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,r=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){s=""+o,r.call(this,o)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return s},setValue:function(o){s=""+o},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function bf(n){n._valueTracker||(n._valueTracker=F8(n))}function iM(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),s="";return n&&(s=sM(n)?n.checked?"true":"false":n.value),n=s,n!==t?(e.setValue(n),!0):!1}function Fm(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Db(n,e){var t=e.checked;return Lt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function wI(n,e){var t=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;t=Ia(e.value!=null?e.value:t),n._wrapperState={initialChecked:s,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function rM(n,e){e=e.checked,e!=null&&cC(n,"checked",e,!1)}function Lb(n,e){rM(n,e);var t=Ia(e.value),s=e.type;if(t!=null)s==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(s==="submit"||s==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Fb(n,e.type,t):e.hasOwnProperty("defaultValue")&&Fb(n,e.type,Ia(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function bI(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Fb(n,e,t){(e!=="number"||Fm(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var $u=Array.isArray;function Vc(n,e,t,s){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&s&&(n[t].defaultSelected=!0)}else{for(t=""+Ia(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,s&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function Bb(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ie(91));return Lt({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function _I(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(ie(92));if($u(t)){if(1<t.length)throw Error(ie(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Ia(t)}}function oM(n,e){var t=Ia(e.value),s=Ia(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),s!=null&&(n.defaultValue=""+s)}function CI(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function aM(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ub(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?aM(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var _f,lM=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,s,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,s,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(_f=_f||document.createElement("div"),_f.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=_f.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Dh(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var uh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},B8=["Webkit","ms","Moz","O"];Object.keys(uh).forEach(function(n){B8.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),uh[e]=uh[n]})});function cM(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||uh.hasOwnProperty(n)&&uh[n]?(""+e).trim():e+"px"}function dM(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var s=t.indexOf("--")===0,i=cM(t,e[t],s);t==="float"&&(t="cssFloat"),s?n.setProperty(t,i):n[t]=i}}var U8=Lt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function $b(n,e){if(e){if(U8[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ie(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ie(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ie(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ie(62))}}function zb(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wb=null;function pC(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Hb=null,Kc=null,Yc=null;function EI(n){if(n=Tp(n)){if(typeof Hb!="function")throw Error(ie(280));var e=n.stateNode;e&&(e=kv(e),Hb(n.stateNode,n.type,e))}}function uM(n){Kc?Yc?Yc.push(n):Yc=[n]:Kc=n}function hM(){if(Kc){var n=Kc,e=Yc;if(Yc=Kc=null,EI(n),e)for(n=0;n<e.length;n++)EI(e[n])}}function pM(n,e){return n(e)}function fM(){}var aS=!1;function gM(n,e,t){if(aS)return n(e,t);aS=!0;try{return pM(n,e,t)}finally{aS=!1,(Kc!==null||Yc!==null)&&(fM(),hM())}}function Lh(n,e){var t=n.stateNode;if(t===null)return null;var s=kv(t);if(s===null)return null;t=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(n=n.type,s=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!s;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(ie(231,e,typeof t));return t}var Gb=!1;if(go)try{var lu={};Object.defineProperty(lu,"passive",{get:function(){Gb=!0}}),window.addEventListener("test",lu,lu),window.removeEventListener("test",lu,lu)}catch{Gb=!1}function $8(n,e,t,s,i,r,o,l,c){var d=Array.prototype.slice.call(arguments,3);try{e.apply(t,d)}catch(u){this.onError(u)}}var hh=!1,Bm=null,Um=!1,Vb=null,z8={onError:function(n){hh=!0,Bm=n}};function W8(n,e,t,s,i,r,o,l,c){hh=!1,Bm=null,$8.apply(z8,arguments)}function H8(n,e,t,s,i,r,o,l,c){if(W8.apply(this,arguments),hh){if(hh){var d=Bm;hh=!1,Bm=null}else throw Error(ie(198));Um||(Um=!0,Vb=d)}}function Kl(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function mM(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function TI(n){if(Kl(n)!==n)throw Error(ie(188))}function G8(n){var e=n.alternate;if(!e){if(e=Kl(n),e===null)throw Error(ie(188));return e!==n?null:n}for(var t=n,s=e;;){var i=t.return;if(i===null)break;var r=i.alternate;if(r===null){if(s=i.return,s!==null){t=s;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===t)return TI(i),n;if(r===s)return TI(i),e;r=r.sibling}throw Error(ie(188))}if(t.return!==s.return)t=i,s=r;else{for(var o=!1,l=i.child;l;){if(l===t){o=!0,t=i,s=r;break}if(l===s){o=!0,s=i,t=r;break}l=l.sibling}if(!o){for(l=r.child;l;){if(l===t){o=!0,t=r,s=i;break}if(l===s){o=!0,s=r,t=i;break}l=l.sibling}if(!o)throw Error(ie(189))}}if(t.alternate!==s)throw Error(ie(190))}if(t.tag!==3)throw Error(ie(188));return t.stateNode.current===t?n:e}function yM(n){return n=G8(n),n!==null?vM(n):null}function vM(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=vM(n);if(e!==null)return e;n=n.sibling}return null}var xM=Js.unstable_scheduleCallback,II=Js.unstable_cancelCallback,V8=Js.unstable_shouldYield,K8=Js.unstable_requestPaint,Ht=Js.unstable_now,Y8=Js.unstable_getCurrentPriorityLevel,fC=Js.unstable_ImmediatePriority,SM=Js.unstable_UserBlockingPriority,$m=Js.unstable_NormalPriority,X8=Js.unstable_LowPriority,wM=Js.unstable_IdlePriority,Ev=null,wr=null;function q8(n){if(wr&&typeof wr.onCommitFiberRoot=="function")try{wr.onCommitFiberRoot(Ev,n,void 0,(n.current.flags&128)===128)}catch{}}var $i=Math.clz32?Math.clz32:Q8,Z8=Math.log,J8=Math.LN2;function Q8(n){return n>>>=0,n===0?32:31-(Z8(n)/J8|0)|0}var Cf=64,Ef=4194304;function zu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function zm(n,e){var t=n.pendingLanes;if(t===0)return 0;var s=0,i=n.suspendedLanes,r=n.pingedLanes,o=t&268435455;if(o!==0){var l=o&~i;l!==0?s=zu(l):(r&=o,r!==0&&(s=zu(r)))}else o=t&~i,o!==0?s=zu(o):r!==0&&(s=zu(r));if(s===0)return 0;if(e!==0&&e!==s&&!(e&i)&&(i=s&-s,r=e&-e,i>=r||i===16&&(r&4194240)!==0))return e;if(s&4&&(s|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=s;0<e;)t=31-$i(e),i=1<<t,s|=n[t],e&=~i;return s}function eW(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tW(n,e){for(var t=n.suspendedLanes,s=n.pingedLanes,i=n.expirationTimes,r=n.pendingLanes;0<r;){var o=31-$i(r),l=1<<o,c=i[o];c===-1?(!(l&t)||l&s)&&(i[o]=eW(l,e)):c<=e&&(n.expiredLanes|=l),r&=~l}}function Kb(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function bM(){var n=Cf;return Cf<<=1,!(Cf&4194240)&&(Cf=64),n}function lS(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Cp(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-$i(e),n[e]=t}function nW(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var s=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-$i(t),r=1<<i;e[i]=0,s[i]=-1,n[i]=-1,t&=~r}}function gC(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var s=31-$i(t),i=1<<s;i&e|n[s]&e&&(n[s]|=e),t&=~i}}var it=0;function _M(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var CM,mC,EM,TM,IM,Yb=!1,Tf=[],ua=null,ha=null,pa=null,Fh=new Map,Bh=new Map,Qo=[],sW="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function PI(n,e){switch(n){case"focusin":case"focusout":ua=null;break;case"dragenter":case"dragleave":ha=null;break;case"mouseover":case"mouseout":pa=null;break;case"pointerover":case"pointerout":Fh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bh.delete(e.pointerId)}}function cu(n,e,t,s,i,r){return n===null||n.nativeEvent!==r?(n={blockedOn:e,domEventName:t,eventSystemFlags:s,nativeEvent:r,targetContainers:[i]},e!==null&&(e=Tp(e),e!==null&&mC(e)),n):(n.eventSystemFlags|=s,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function iW(n,e,t,s,i){switch(e){case"focusin":return ua=cu(ua,n,e,t,s,i),!0;case"dragenter":return ha=cu(ha,n,e,t,s,i),!0;case"mouseover":return pa=cu(pa,n,e,t,s,i),!0;case"pointerover":var r=i.pointerId;return Fh.set(r,cu(Fh.get(r)||null,n,e,t,s,i)),!0;case"gotpointercapture":return r=i.pointerId,Bh.set(r,cu(Bh.get(r)||null,n,e,t,s,i)),!0}return!1}function PM(n){var e=ul(n.target);if(e!==null){var t=Kl(e);if(t!==null){if(e=t.tag,e===13){if(e=mM(t),e!==null){n.blockedOn=e,IM(n.priority,function(){EM(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Og(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Xb(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var s=new t.constructor(t.type,t);Wb=s,t.target.dispatchEvent(s),Wb=null}else return e=Tp(t),e!==null&&mC(e),n.blockedOn=t,!1;e.shift()}return!0}function kI(n,e,t){Og(n)&&t.delete(e)}function rW(){Yb=!1,ua!==null&&Og(ua)&&(ua=null),ha!==null&&Og(ha)&&(ha=null),pa!==null&&Og(pa)&&(pa=null),Fh.forEach(kI),Bh.forEach(kI)}function du(n,e){n.blockedOn===e&&(n.blockedOn=null,Yb||(Yb=!0,Js.unstable_scheduleCallback(Js.unstable_NormalPriority,rW)))}function Uh(n){function e(i){return du(i,n)}if(0<Tf.length){du(Tf[0],n);for(var t=1;t<Tf.length;t++){var s=Tf[t];s.blockedOn===n&&(s.blockedOn=null)}}for(ua!==null&&du(ua,n),ha!==null&&du(ha,n),pa!==null&&du(pa,n),Fh.forEach(e),Bh.forEach(e),t=0;t<Qo.length;t++)s=Qo[t],s.blockedOn===n&&(s.blockedOn=null);for(;0<Qo.length&&(t=Qo[0],t.blockedOn===null);)PM(t),t.blockedOn===null&&Qo.shift()}var Xc=Po.ReactCurrentBatchConfig,Wm=!0;function oW(n,e,t,s){var i=it,r=Xc.transition;Xc.transition=null;try{it=1,yC(n,e,t,s)}finally{it=i,Xc.transition=r}}function aW(n,e,t,s){var i=it,r=Xc.transition;Xc.transition=null;try{it=4,yC(n,e,t,s)}finally{it=i,Xc.transition=r}}function yC(n,e,t,s){if(Wm){var i=Xb(n,e,t,s);if(i===null)vS(n,e,s,Hm,t),PI(n,s);else if(iW(i,n,e,t,s))s.stopPropagation();else if(PI(n,s),e&4&&-1<sW.indexOf(n)){for(;i!==null;){var r=Tp(i);if(r!==null&&CM(r),r=Xb(n,e,t,s),r===null&&vS(n,e,s,Hm,t),r===i)break;i=r}i!==null&&s.stopPropagation()}else vS(n,e,s,null,t)}}var Hm=null;function Xb(n,e,t,s){if(Hm=null,n=pC(s),n=ul(n),n!==null)if(e=Kl(n),e===null)n=null;else if(t=e.tag,t===13){if(n=mM(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return Hm=n,null}function kM(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Y8()){case fC:return 1;case SM:return 4;case $m:case X8:return 16;case wM:return 536870912;default:return 16}default:return 16}}var ra=null,vC=null,Dg=null;function AM(){if(Dg)return Dg;var n,e=vC,t=e.length,s,i="value"in ra?ra.value:ra.textContent,r=i.length;for(n=0;n<t&&e[n]===i[n];n++);var o=t-n;for(s=1;s<=o&&e[t-s]===i[r-s];s++);return Dg=i.slice(n,1<s?1-s:void 0)}function Lg(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function If(){return!0}function AI(){return!1}function ni(n){function e(t,s,i,r,o){this._reactName=t,this._targetInst=i,this.type=s,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(t=n[l],this[l]=t?t(r):r[l]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?If:AI,this.isPropagationStopped=AI,this}return Lt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=If)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=If)},persist:function(){},isPersistent:If}),e}var Rd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xC=ni(Rd),Ep=Lt({},Rd,{view:0,detail:0}),lW=ni(Ep),cS,dS,uu,Tv=Lt({},Ep,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:SC,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==uu&&(uu&&n.type==="mousemove"?(cS=n.screenX-uu.screenX,dS=n.screenY-uu.screenY):dS=cS=0,uu=n),cS)},movementY:function(n){return"movementY"in n?n.movementY:dS}}),jI=ni(Tv),cW=Lt({},Tv,{dataTransfer:0}),dW=ni(cW),uW=Lt({},Ep,{relatedTarget:0}),uS=ni(uW),hW=Lt({},Rd,{animationName:0,elapsedTime:0,pseudoElement:0}),pW=ni(hW),fW=Lt({},Rd,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),gW=ni(fW),mW=Lt({},Rd,{data:0}),NI=ni(mW),yW={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vW={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xW={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function SW(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=xW[n])?!!e[n]:!1}function SC(){return SW}var wW=Lt({},Ep,{key:function(n){if(n.key){var e=yW[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=Lg(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?vW[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:SC,charCode:function(n){return n.type==="keypress"?Lg(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Lg(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),bW=ni(wW),_W=Lt({},Tv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),RI=ni(_W),CW=Lt({},Ep,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:SC}),EW=ni(CW),TW=Lt({},Rd,{propertyName:0,elapsedTime:0,pseudoElement:0}),IW=ni(TW),PW=Lt({},Tv,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),kW=ni(PW),AW=[9,13,27,32],wC=go&&"CompositionEvent"in window,ph=null;go&&"documentMode"in document&&(ph=document.documentMode);var jW=go&&"TextEvent"in window&&!ph,jM=go&&(!wC||ph&&8<ph&&11>=ph),MI=" ",OI=!1;function NM(n,e){switch(n){case"keyup":return AW.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function RM(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Cc=!1;function NW(n,e){switch(n){case"compositionend":return RM(e);case"keypress":return e.which!==32?null:(OI=!0,MI);case"textInput":return n=e.data,n===MI&&OI?null:n;default:return null}}function RW(n,e){if(Cc)return n==="compositionend"||!wC&&NM(n,e)?(n=AM(),Dg=vC=ra=null,Cc=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return jM&&e.locale!=="ko"?null:e.data;default:return null}}var MW={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function DI(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!MW[n.type]:e==="textarea"}function MM(n,e,t,s){uM(s),e=Gm(e,"onChange"),0<e.length&&(t=new xC("onChange","change",null,t,s),n.push({event:t,listeners:e}))}var fh=null,$h=null;function OW(n){GM(n,0)}function Iv(n){var e=Ic(n);if(iM(e))return n}function DW(n,e){if(n==="change")return e}var OM=!1;if(go){var hS;if(go){var pS="oninput"in document;if(!pS){var LI=document.createElement("div");LI.setAttribute("oninput","return;"),pS=typeof LI.oninput=="function"}hS=pS}else hS=!1;OM=hS&&(!document.documentMode||9<document.documentMode)}function FI(){fh&&(fh.detachEvent("onpropertychange",DM),$h=fh=null)}function DM(n){if(n.propertyName==="value"&&Iv($h)){var e=[];MM(e,$h,n,pC(n)),gM(OW,e)}}function LW(n,e,t){n==="focusin"?(FI(),fh=e,$h=t,fh.attachEvent("onpropertychange",DM)):n==="focusout"&&FI()}function FW(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Iv($h)}function BW(n,e){if(n==="click")return Iv(e)}function UW(n,e){if(n==="input"||n==="change")return Iv(e)}function $W(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ki=typeof Object.is=="function"?Object.is:$W;function zh(n,e){if(Ki(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),s=Object.keys(e);if(t.length!==s.length)return!1;for(s=0;s<t.length;s++){var i=t[s];if(!jb.call(e,i)||!Ki(n[i],e[i]))return!1}return!0}function BI(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function UI(n,e){var t=BI(n);n=0;for(var s;t;){if(t.nodeType===3){if(s=n+t.textContent.length,n<=e&&s>=e)return{node:t,offset:e-n};n=s}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=BI(t)}}function LM(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?LM(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function FM(){for(var n=window,e=Fm();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=Fm(n.document)}return e}function bC(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function zW(n){var e=FM(),t=n.focusedElem,s=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&LM(t.ownerDocument.documentElement,t)){if(s!==null&&bC(t)){if(e=s.start,n=s.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,r=Math.min(s.start,i);s=s.end===void 0?r:Math.min(s.end,i),!n.extend&&r>s&&(i=s,s=r,r=i),i=UI(t,r);var o=UI(t,s);i&&o&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==o.node||n.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),r>s?(n.addRange(e),n.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var WW=go&&"documentMode"in document&&11>=document.documentMode,Ec=null,qb=null,gh=null,Zb=!1;function $I(n,e,t){var s=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Zb||Ec==null||Ec!==Fm(s)||(s=Ec,"selectionStart"in s&&bC(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),gh&&zh(gh,s)||(gh=s,s=Gm(qb,"onSelect"),0<s.length&&(e=new xC("onSelect","select",null,e,t),n.push({event:e,listeners:s}),e.target=Ec)))}function Pf(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Tc={animationend:Pf("Animation","AnimationEnd"),animationiteration:Pf("Animation","AnimationIteration"),animationstart:Pf("Animation","AnimationStart"),transitionend:Pf("Transition","TransitionEnd")},fS={},BM={};go&&(BM=document.createElement("div").style,"AnimationEvent"in window||(delete Tc.animationend.animation,delete Tc.animationiteration.animation,delete Tc.animationstart.animation),"TransitionEvent"in window||delete Tc.transitionend.transition);function Pv(n){if(fS[n])return fS[n];if(!Tc[n])return n;var e=Tc[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in BM)return fS[n]=e[t];return n}var UM=Pv("animationend"),$M=Pv("animationiteration"),zM=Pv("animationstart"),WM=Pv("transitionend"),HM=new Map,zI="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Da(n,e){HM.set(n,e),Vl(e,[n])}for(var gS=0;gS<zI.length;gS++){var mS=zI[gS],HW=mS.toLowerCase(),GW=mS[0].toUpperCase()+mS.slice(1);Da(HW,"on"+GW)}Da(UM,"onAnimationEnd");Da($M,"onAnimationIteration");Da(zM,"onAnimationStart");Da("dblclick","onDoubleClick");Da("focusin","onFocus");Da("focusout","onBlur");Da(WM,"onTransitionEnd");cd("onMouseEnter",["mouseout","mouseover"]);cd("onMouseLeave",["mouseout","mouseover"]);cd("onPointerEnter",["pointerout","pointerover"]);cd("onPointerLeave",["pointerout","pointerover"]);Vl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Vl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Vl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Vl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Vl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Vl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),VW=new Set("cancel close invalid load scroll toggle".split(" ").concat(Wu));function WI(n,e,t){var s=n.type||"unknown-event";n.currentTarget=t,H8(s,e,void 0,n),n.currentTarget=null}function GM(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var s=n[t],i=s.event;s=s.listeners;e:{var r=void 0;if(e)for(var o=s.length-1;0<=o;o--){var l=s[o],c=l.instance,d=l.currentTarget;if(l=l.listener,c!==r&&i.isPropagationStopped())break e;WI(i,l,d),r=c}else for(o=0;o<s.length;o++){if(l=s[o],c=l.instance,d=l.currentTarget,l=l.listener,c!==r&&i.isPropagationStopped())break e;WI(i,l,d),r=c}}}if(Um)throw n=Vb,Um=!1,Vb=null,n}function xt(n,e){var t=e[n0];t===void 0&&(t=e[n0]=new Set);var s=n+"__bubble";t.has(s)||(VM(e,n,2,!1),t.add(s))}function yS(n,e,t){var s=0;e&&(s|=4),VM(t,n,s,e)}var kf="_reactListening"+Math.random().toString(36).slice(2);function Wh(n){if(!n[kf]){n[kf]=!0,QR.forEach(function(t){t!=="selectionchange"&&(VW.has(t)||yS(t,!1,n),yS(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[kf]||(e[kf]=!0,yS("selectionchange",!1,e))}}function VM(n,e,t,s){switch(kM(e)){case 1:var i=oW;break;case 4:i=aW;break;default:i=yC}t=i.bind(null,e,t,n),i=void 0,!Gb||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),s?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function vS(n,e,t,s,i){var r=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var o=s.tag;if(o===3||o===4){var l=s.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(o===4)for(o=s.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;l!==null;){if(o=ul(l),o===null)return;if(c=o.tag,c===5||c===6){s=r=o;continue e}l=l.parentNode}}s=s.return}gM(function(){var d=r,u=pC(t),h=[];e:{var p=HM.get(n);if(p!==void 0){var f=xC,g=n;switch(n){case"keypress":if(Lg(t)===0)break e;case"keydown":case"keyup":f=bW;break;case"focusin":g="focus",f=uS;break;case"focusout":g="blur",f=uS;break;case"beforeblur":case"afterblur":f=uS;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=jI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=dW;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=EW;break;case UM:case $M:case zM:f=pW;break;case WM:f=IW;break;case"scroll":f=lW;break;case"wheel":f=kW;break;case"copy":case"cut":case"paste":f=gW;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=RI}var m=(e&4)!==0,x=!m&&n==="scroll",y=m?p!==null?p+"Capture":null:p;m=[];for(var S=d,v;S!==null;){v=S;var C=v.stateNode;if(v.tag===5&&C!==null&&(v=C,y!==null&&(C=Lh(S,y),C!=null&&m.push(Hh(S,C,v)))),x)break;S=S.return}0<m.length&&(p=new f(p,g,null,t,u),h.push({event:p,listeners:m}))}}if(!(e&7)){e:{if(p=n==="mouseover"||n==="pointerover",f=n==="mouseout"||n==="pointerout",p&&t!==Wb&&(g=t.relatedTarget||t.fromElement)&&(ul(g)||g[mo]))break e;if((f||p)&&(p=u.window===u?u:(p=u.ownerDocument)?p.defaultView||p.parentWindow:window,f?(g=t.relatedTarget||t.toElement,f=d,g=g?ul(g):null,g!==null&&(x=Kl(g),g!==x||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=d),f!==g)){if(m=jI,C="onMouseLeave",y="onMouseEnter",S="mouse",(n==="pointerout"||n==="pointerover")&&(m=RI,C="onPointerLeave",y="onPointerEnter",S="pointer"),x=f==null?p:Ic(f),v=g==null?p:Ic(g),p=new m(C,S+"leave",f,t,u),p.target=x,p.relatedTarget=v,C=null,ul(u)===d&&(m=new m(y,S+"enter",g,t,u),m.target=v,m.relatedTarget=x,C=m),x=C,f&&g)t:{for(m=f,y=g,S=0,v=m;v;v=rc(v))S++;for(v=0,C=y;C;C=rc(C))v++;for(;0<S-v;)m=rc(m),S--;for(;0<v-S;)y=rc(y),v--;for(;S--;){if(m===y||y!==null&&m===y.alternate)break t;m=rc(m),y=rc(y)}m=null}else m=null;f!==null&&HI(h,p,f,m,!1),g!==null&&x!==null&&HI(h,x,g,m,!0)}}e:{if(p=d?Ic(d):window,f=p.nodeName&&p.nodeName.toLowerCase(),f==="select"||f==="input"&&p.type==="file")var T=DW;else if(DI(p))if(OM)T=UW;else{T=FW;var I=LW}else(f=p.nodeName)&&f.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(T=BW);if(T&&(T=T(n,d))){MM(h,T,t,u);break e}I&&I(n,p,d),n==="focusout"&&(I=p._wrapperState)&&I.controlled&&p.type==="number"&&Fb(p,"number",p.value)}switch(I=d?Ic(d):window,n){case"focusin":(DI(I)||I.contentEditable==="true")&&(Ec=I,qb=d,gh=null);break;case"focusout":gh=qb=Ec=null;break;case"mousedown":Zb=!0;break;case"contextmenu":case"mouseup":case"dragend":Zb=!1,$I(h,t,u);break;case"selectionchange":if(WW)break;case"keydown":case"keyup":$I(h,t,u)}var E;if(wC)e:{switch(n){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else Cc?NM(n,t)&&(P="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(P="onCompositionStart");P&&(jM&&t.locale!=="ko"&&(Cc||P!=="onCompositionStart"?P==="onCompositionEnd"&&Cc&&(E=AM()):(ra=u,vC="value"in ra?ra.value:ra.textContent,Cc=!0)),I=Gm(d,P),0<I.length&&(P=new NI(P,n,null,t,u),h.push({event:P,listeners:I}),E?P.data=E:(E=RM(t),E!==null&&(P.data=E)))),(E=jW?NW(n,t):RW(n,t))&&(d=Gm(d,"onBeforeInput"),0<d.length&&(u=new NI("onBeforeInput","beforeinput",null,t,u),h.push({event:u,listeners:d}),u.data=E))}GM(h,e)})}function Hh(n,e,t){return{instance:n,listener:e,currentTarget:t}}function Gm(n,e){for(var t=e+"Capture",s=[];n!==null;){var i=n,r=i.stateNode;i.tag===5&&r!==null&&(i=r,r=Lh(n,t),r!=null&&s.unshift(Hh(n,r,i)),r=Lh(n,e),r!=null&&s.push(Hh(n,r,i))),n=n.return}return s}function rc(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function HI(n,e,t,s,i){for(var r=e._reactName,o=[];t!==null&&t!==s;){var l=t,c=l.alternate,d=l.stateNode;if(c!==null&&c===s)break;l.tag===5&&d!==null&&(l=d,i?(c=Lh(t,r),c!=null&&o.unshift(Hh(t,c,l))):i||(c=Lh(t,r),c!=null&&o.push(Hh(t,c,l)))),t=t.return}o.length!==0&&n.push({event:e,listeners:o})}var KW=/\r\n?/g,YW=/\u0000|\uFFFD/g;function GI(n){return(typeof n=="string"?n:""+n).replace(KW,`
`).replace(YW,"")}function Af(n,e,t){if(e=GI(e),GI(n)!==e&&t)throw Error(ie(425))}function Vm(){}var Jb=null,Qb=null;function e0(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var t0=typeof setTimeout=="function"?setTimeout:void 0,XW=typeof clearTimeout=="function"?clearTimeout:void 0,VI=typeof Promise=="function"?Promise:void 0,qW=typeof queueMicrotask=="function"?queueMicrotask:typeof VI<"u"?function(n){return VI.resolve(null).then(n).catch(ZW)}:t0;function ZW(n){setTimeout(function(){throw n})}function xS(n,e){var t=e,s=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(s===0){n.removeChild(i),Uh(e);return}s--}else t!=="$"&&t!=="$?"&&t!=="$!"||s++;t=i}while(t);Uh(e)}function fa(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function KI(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Md=Math.random().toString(36).slice(2),hr="__reactFiber$"+Md,Gh="__reactProps$"+Md,mo="__reactContainer$"+Md,n0="__reactEvents$"+Md,JW="__reactListeners$"+Md,QW="__reactHandles$"+Md;function ul(n){var e=n[hr];if(e)return e;for(var t=n.parentNode;t;){if(e=t[mo]||t[hr]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=KI(n);n!==null;){if(t=n[hr])return t;n=KI(n)}return e}n=t,t=n.parentNode}return null}function Tp(n){return n=n[hr]||n[mo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ic(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(ie(33))}function kv(n){return n[Gh]||null}var s0=[],Pc=-1;function La(n){return{current:n}}function Ct(n){0>Pc||(n.current=s0[Pc],s0[Pc]=null,Pc--)}function pt(n,e){Pc++,s0[Pc]=n.current,n.current=e}var Pa={},Yn=La(Pa),As=La(!1),_l=Pa;function dd(n,e){var t=n.type.contextTypes;if(!t)return Pa;var s=n.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var i={},r;for(r in t)i[r]=e[r];return s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function js(n){return n=n.childContextTypes,n!=null}function Km(){Ct(As),Ct(Yn)}function YI(n,e,t){if(Yn.current!==Pa)throw Error(ie(168));pt(Yn,e),pt(As,t)}function KM(n,e,t){var s=n.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return t;s=s.getChildContext();for(var i in s)if(!(i in e))throw Error(ie(108,L8(n)||"Unknown",i));return Lt({},t,s)}function Ym(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Pa,_l=Yn.current,pt(Yn,n),pt(As,As.current),!0}function XI(n,e,t){var s=n.stateNode;if(!s)throw Error(ie(169));t?(n=KM(n,e,_l),s.__reactInternalMemoizedMergedChildContext=n,Ct(As),Ct(Yn),pt(Yn,n)):Ct(As),pt(As,t)}var Xr=null,Av=!1,SS=!1;function YM(n){Xr===null?Xr=[n]:Xr.push(n)}function e9(n){Av=!0,YM(n)}function Fa(){if(!SS&&Xr!==null){SS=!0;var n=0,e=it;try{var t=Xr;for(it=1;n<t.length;n++){var s=t[n];do s=s(!0);while(s!==null)}Xr=null,Av=!1}catch(i){throw Xr!==null&&(Xr=Xr.slice(n+1)),xM(fC,Fa),i}finally{it=e,SS=!1}}return null}var kc=[],Ac=0,Xm=null,qm=0,ui=[],hi=0,Cl=null,eo=1,to="";function rl(n,e){kc[Ac++]=qm,kc[Ac++]=Xm,Xm=n,qm=e}function XM(n,e,t){ui[hi++]=eo,ui[hi++]=to,ui[hi++]=Cl,Cl=n;var s=eo;n=to;var i=32-$i(s)-1;s&=~(1<<i),t+=1;var r=32-$i(e)+i;if(30<r){var o=i-i%5;r=(s&(1<<o)-1).toString(32),s>>=o,i-=o,eo=1<<32-$i(e)+i|t<<i|s,to=r+n}else eo=1<<r|t<<i|s,to=n}function _C(n){n.return!==null&&(rl(n,1),XM(n,1,0))}function CC(n){for(;n===Xm;)Xm=kc[--Ac],kc[Ac]=null,qm=kc[--Ac],kc[Ac]=null;for(;n===Cl;)Cl=ui[--hi],ui[hi]=null,to=ui[--hi],ui[hi]=null,eo=ui[--hi],ui[hi]=null}var Vs=null,Gs=null,Pt=!1,Oi=null;function qM(n,e){var t=gi(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function qI(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Vs=n,Gs=fa(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Vs=n,Gs=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Cl!==null?{id:eo,overflow:to}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=gi(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Vs=n,Gs=null,!0):!1;default:return!1}}function i0(n){return(n.mode&1)!==0&&(n.flags&128)===0}function r0(n){if(Pt){var e=Gs;if(e){var t=e;if(!qI(n,e)){if(i0(n))throw Error(ie(418));e=fa(t.nextSibling);var s=Vs;e&&qI(n,e)?qM(s,t):(n.flags=n.flags&-4097|2,Pt=!1,Vs=n)}}else{if(i0(n))throw Error(ie(418));n.flags=n.flags&-4097|2,Pt=!1,Vs=n}}}function ZI(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Vs=n}function jf(n){if(n!==Vs)return!1;if(!Pt)return ZI(n),Pt=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!e0(n.type,n.memoizedProps)),e&&(e=Gs)){if(i0(n))throw ZM(),Error(ie(418));for(;e;)qM(n,e),e=fa(e.nextSibling)}if(ZI(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(ie(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Gs=fa(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Gs=null}}else Gs=Vs?fa(n.stateNode.nextSibling):null;return!0}function ZM(){for(var n=Gs;n;)n=fa(n.nextSibling)}function ud(){Gs=Vs=null,Pt=!1}function EC(n){Oi===null?Oi=[n]:Oi.push(n)}var t9=Po.ReactCurrentBatchConfig;function hu(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(ie(309));var s=t.stateNode}if(!s)throw Error(ie(147,n));var i=s,r=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var l=i.refs;o===null?delete l[r]:l[r]=o},e._stringRef=r,e)}if(typeof n!="string")throw Error(ie(284));if(!t._owner)throw Error(ie(290,n))}return n}function Nf(n,e){throw n=Object.prototype.toString.call(e),Error(ie(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function JI(n){var e=n._init;return e(n._payload)}function JM(n){function e(y,S){if(n){var v=y.deletions;v===null?(y.deletions=[S],y.flags|=16):v.push(S)}}function t(y,S){if(!n)return null;for(;S!==null;)e(y,S),S=S.sibling;return null}function s(y,S){for(y=new Map;S!==null;)S.key!==null?y.set(S.key,S):y.set(S.index,S),S=S.sibling;return y}function i(y,S){return y=va(y,S),y.index=0,y.sibling=null,y}function r(y,S,v){return y.index=v,n?(v=y.alternate,v!==null?(v=v.index,v<S?(y.flags|=2,S):v):(y.flags|=2,S)):(y.flags|=1048576,S)}function o(y){return n&&y.alternate===null&&(y.flags|=2),y}function l(y,S,v,C){return S===null||S.tag!==6?(S=IS(v,y.mode,C),S.return=y,S):(S=i(S,v),S.return=y,S)}function c(y,S,v,C){var T=v.type;return T===_c?u(y,S,v.props.children,C,v.key):S!==null&&(S.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Zo&&JI(T)===S.type)?(C=i(S,v.props),C.ref=hu(y,S,v),C.return=y,C):(C=Hg(v.type,v.key,v.props,null,y.mode,C),C.ref=hu(y,S,v),C.return=y,C)}function d(y,S,v,C){return S===null||S.tag!==4||S.stateNode.containerInfo!==v.containerInfo||S.stateNode.implementation!==v.implementation?(S=PS(v,y.mode,C),S.return=y,S):(S=i(S,v.children||[]),S.return=y,S)}function u(y,S,v,C,T){return S===null||S.tag!==7?(S=xl(v,y.mode,C,T),S.return=y,S):(S=i(S,v),S.return=y,S)}function h(y,S,v){if(typeof S=="string"&&S!==""||typeof S=="number")return S=IS(""+S,y.mode,v),S.return=y,S;if(typeof S=="object"&&S!==null){switch(S.$$typeof){case wf:return v=Hg(S.type,S.key,S.props,null,y.mode,v),v.ref=hu(y,null,S),v.return=y,v;case bc:return S=PS(S,y.mode,v),S.return=y,S;case Zo:var C=S._init;return h(y,C(S._payload),v)}if($u(S)||au(S))return S=xl(S,y.mode,v,null),S.return=y,S;Nf(y,S)}return null}function p(y,S,v,C){var T=S!==null?S.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return T!==null?null:l(y,S,""+v,C);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case wf:return v.key===T?c(y,S,v,C):null;case bc:return v.key===T?d(y,S,v,C):null;case Zo:return T=v._init,p(y,S,T(v._payload),C)}if($u(v)||au(v))return T!==null?null:u(y,S,v,C,null);Nf(y,v)}return null}function f(y,S,v,C,T){if(typeof C=="string"&&C!==""||typeof C=="number")return y=y.get(v)||null,l(S,y,""+C,T);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case wf:return y=y.get(C.key===null?v:C.key)||null,c(S,y,C,T);case bc:return y=y.get(C.key===null?v:C.key)||null,d(S,y,C,T);case Zo:var I=C._init;return f(y,S,v,I(C._payload),T)}if($u(C)||au(C))return y=y.get(v)||null,u(S,y,C,T,null);Nf(S,C)}return null}function g(y,S,v,C){for(var T=null,I=null,E=S,P=S=0,k=null;E!==null&&P<v.length;P++){E.index>P?(k=E,E=null):k=E.sibling;var j=p(y,E,v[P],C);if(j===null){E===null&&(E=k);break}n&&E&&j.alternate===null&&e(y,E),S=r(j,S,P),I===null?T=j:I.sibling=j,I=j,E=k}if(P===v.length)return t(y,E),Pt&&rl(y,P),T;if(E===null){for(;P<v.length;P++)E=h(y,v[P],C),E!==null&&(S=r(E,S,P),I===null?T=E:I.sibling=E,I=E);return Pt&&rl(y,P),T}for(E=s(y,E);P<v.length;P++)k=f(E,y,P,v[P],C),k!==null&&(n&&k.alternate!==null&&E.delete(k.key===null?P:k.key),S=r(k,S,P),I===null?T=k:I.sibling=k,I=k);return n&&E.forEach(function(D){return e(y,D)}),Pt&&rl(y,P),T}function m(y,S,v,C){var T=au(v);if(typeof T!="function")throw Error(ie(150));if(v=T.call(v),v==null)throw Error(ie(151));for(var I=T=null,E=S,P=S=0,k=null,j=v.next();E!==null&&!j.done;P++,j=v.next()){E.index>P?(k=E,E=null):k=E.sibling;var D=p(y,E,j.value,C);if(D===null){E===null&&(E=k);break}n&&E&&D.alternate===null&&e(y,E),S=r(D,S,P),I===null?T=D:I.sibling=D,I=D,E=k}if(j.done)return t(y,E),Pt&&rl(y,P),T;if(E===null){for(;!j.done;P++,j=v.next())j=h(y,j.value,C),j!==null&&(S=r(j,S,P),I===null?T=j:I.sibling=j,I=j);return Pt&&rl(y,P),T}for(E=s(y,E);!j.done;P++,j=v.next())j=f(E,y,P,j.value,C),j!==null&&(n&&j.alternate!==null&&E.delete(j.key===null?P:j.key),S=r(j,S,P),I===null?T=j:I.sibling=j,I=j);return n&&E.forEach(function(R){return e(y,R)}),Pt&&rl(y,P),T}function x(y,S,v,C){if(typeof v=="object"&&v!==null&&v.type===_c&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case wf:e:{for(var T=v.key,I=S;I!==null;){if(I.key===T){if(T=v.type,T===_c){if(I.tag===7){t(y,I.sibling),S=i(I,v.props.children),S.return=y,y=S;break e}}else if(I.elementType===T||typeof T=="object"&&T!==null&&T.$$typeof===Zo&&JI(T)===I.type){t(y,I.sibling),S=i(I,v.props),S.ref=hu(y,I,v),S.return=y,y=S;break e}t(y,I);break}else e(y,I);I=I.sibling}v.type===_c?(S=xl(v.props.children,y.mode,C,v.key),S.return=y,y=S):(C=Hg(v.type,v.key,v.props,null,y.mode,C),C.ref=hu(y,S,v),C.return=y,y=C)}return o(y);case bc:e:{for(I=v.key;S!==null;){if(S.key===I)if(S.tag===4&&S.stateNode.containerInfo===v.containerInfo&&S.stateNode.implementation===v.implementation){t(y,S.sibling),S=i(S,v.children||[]),S.return=y,y=S;break e}else{t(y,S);break}else e(y,S);S=S.sibling}S=PS(v,y.mode,C),S.return=y,y=S}return o(y);case Zo:return I=v._init,x(y,S,I(v._payload),C)}if($u(v))return g(y,S,v,C);if(au(v))return m(y,S,v,C);Nf(y,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,S!==null&&S.tag===6?(t(y,S.sibling),S=i(S,v),S.return=y,y=S):(t(y,S),S=IS(v,y.mode,C),S.return=y,y=S),o(y)):t(y,S)}return x}var hd=JM(!0),QM=JM(!1),Zm=La(null),Jm=null,jc=null,TC=null;function IC(){TC=jc=Jm=null}function PC(n){var e=Zm.current;Ct(Zm),n._currentValue=e}function o0(n,e,t){for(;n!==null;){var s=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),n===t)break;n=n.return}}function qc(n,e){Jm=n,TC=jc=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Es=!0),n.firstContext=null)}function wi(n){var e=n._currentValue;if(TC!==n)if(n={context:n,memoizedValue:e,next:null},jc===null){if(Jm===null)throw Error(ie(308));jc=n,Jm.dependencies={lanes:0,firstContext:n}}else jc=jc.next=n;return e}var hl=null;function kC(n){hl===null?hl=[n]:hl.push(n)}function eO(n,e,t,s){var i=e.interleaved;return i===null?(t.next=t,kC(e)):(t.next=i.next,i.next=t),e.interleaved=t,yo(n,s)}function yo(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Jo=!1;function AC(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function tO(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function lo(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function ga(n,e,t){var s=n.updateQueue;if(s===null)return null;if(s=s.shared,Xe&2){var i=s.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),s.pending=e,yo(n,t)}return i=s.interleaved,i===null?(e.next=e,kC(s)):(e.next=i.next,i.next=e),s.interleaved=e,yo(n,t)}function Fg(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,gC(n,t)}}function QI(n,e){var t=n.updateQueue,s=n.alternate;if(s!==null&&(s=s.updateQueue,t===s)){var i=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};r===null?i=r=o:r=r.next=o,t=t.next}while(t!==null);r===null?i=r=e:r=r.next=e}else i=r=e;t={baseState:s.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:s.shared,effects:s.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Qm(n,e,t,s){var i=n.updateQueue;Jo=!1;var r=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,d=c.next;c.next=null,o===null?r=d:o.next=d,o=c;var u=n.alternate;u!==null&&(u=u.updateQueue,l=u.lastBaseUpdate,l!==o&&(l===null?u.firstBaseUpdate=d:l.next=d,u.lastBaseUpdate=c))}if(r!==null){var h=i.baseState;o=0,u=d=c=null,l=r;do{var p=l.lane,f=l.eventTime;if((s&p)===p){u!==null&&(u=u.next={eventTime:f,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var g=n,m=l;switch(p=e,f=t,m.tag){case 1:if(g=m.payload,typeof g=="function"){h=g.call(f,h,p);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=m.payload,p=typeof g=="function"?g.call(f,h,p):g,p==null)break e;h=Lt({},h,p);break e;case 2:Jo=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,p=i.effects,p===null?i.effects=[l]:p.push(l))}else f={eventTime:f,lane:p,tag:l.tag,payload:l.payload,callback:l.callback,next:null},u===null?(d=u=f,c=h):u=u.next=f,o|=p;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;p=l,l=p.next,p.next=null,i.lastBaseUpdate=p,i.shared.pending=null}}while(!0);if(u===null&&(c=h),i.baseState=c,i.firstBaseUpdate=d,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else r===null&&(i.shared.lanes=0);Tl|=o,n.lanes=o,n.memoizedState=h}}function eP(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var s=n[e],i=s.callback;if(i!==null){if(s.callback=null,s=t,typeof i!="function")throw Error(ie(191,i));i.call(s)}}}var Ip={},br=La(Ip),Vh=La(Ip),Kh=La(Ip);function pl(n){if(n===Ip)throw Error(ie(174));return n}function jC(n,e){switch(pt(Kh,e),pt(Vh,n),pt(br,Ip),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ub(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Ub(e,n)}Ct(br),pt(br,e)}function pd(){Ct(br),Ct(Vh),Ct(Kh)}function nO(n){pl(Kh.current);var e=pl(br.current),t=Ub(e,n.type);e!==t&&(pt(Vh,n),pt(br,t))}function NC(n){Vh.current===n&&(Ct(br),Ct(Vh))}var Nt=La(0);function ey(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var wS=[];function RC(){for(var n=0;n<wS.length;n++)wS[n]._workInProgressVersionPrimary=null;wS.length=0}var Bg=Po.ReactCurrentDispatcher,bS=Po.ReactCurrentBatchConfig,El=0,Dt=null,qt=null,sn=null,ty=!1,mh=!1,Yh=0,n9=0;function Rn(){throw Error(ie(321))}function MC(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Ki(n[t],e[t]))return!1;return!0}function OC(n,e,t,s,i,r){if(El=r,Dt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Bg.current=n===null||n.memoizedState===null?o9:a9,n=t(s,i),mh){r=0;do{if(mh=!1,Yh=0,25<=r)throw Error(ie(301));r+=1,sn=qt=null,e.updateQueue=null,Bg.current=l9,n=t(s,i)}while(mh)}if(Bg.current=ny,e=qt!==null&&qt.next!==null,El=0,sn=qt=Dt=null,ty=!1,e)throw Error(ie(300));return n}function DC(){var n=Yh!==0;return Yh=0,n}function cr(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?Dt.memoizedState=sn=n:sn=sn.next=n,sn}function bi(){if(qt===null){var n=Dt.alternate;n=n!==null?n.memoizedState:null}else n=qt.next;var e=sn===null?Dt.memoizedState:sn.next;if(e!==null)sn=e,qt=n;else{if(n===null)throw Error(ie(310));qt=n,n={memoizedState:qt.memoizedState,baseState:qt.baseState,baseQueue:qt.baseQueue,queue:qt.queue,next:null},sn===null?Dt.memoizedState=sn=n:sn=sn.next=n}return sn}function Xh(n,e){return typeof e=="function"?e(n):e}function _S(n){var e=bi(),t=e.queue;if(t===null)throw Error(ie(311));t.lastRenderedReducer=n;var s=qt,i=s.baseQueue,r=t.pending;if(r!==null){if(i!==null){var o=i.next;i.next=r.next,r.next=o}s.baseQueue=i=r,t.pending=null}if(i!==null){r=i.next,s=s.baseState;var l=o=null,c=null,d=r;do{var u=d.lane;if((El&u)===u)c!==null&&(c=c.next={lane:0,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null}),s=d.hasEagerState?d.eagerState:n(s,d.action);else{var h={lane:u,action:d.action,hasEagerState:d.hasEagerState,eagerState:d.eagerState,next:null};c===null?(l=c=h,o=s):c=c.next=h,Dt.lanes|=u,Tl|=u}d=d.next}while(d!==null&&d!==r);c===null?o=s:c.next=l,Ki(s,e.memoizedState)||(Es=!0),e.memoizedState=s,e.baseState=o,e.baseQueue=c,t.lastRenderedState=s}if(n=t.interleaved,n!==null){i=n;do r=i.lane,Dt.lanes|=r,Tl|=r,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function CS(n){var e=bi(),t=e.queue;if(t===null)throw Error(ie(311));t.lastRenderedReducer=n;var s=t.dispatch,i=t.pending,r=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do r=n(r,o.action),o=o.next;while(o!==i);Ki(r,e.memoizedState)||(Es=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,s]}function sO(){}function iO(n,e){var t=Dt,s=bi(),i=e(),r=!Ki(s.memoizedState,i);if(r&&(s.memoizedState=i,Es=!0),s=s.queue,LC(aO.bind(null,t,s,n),[n]),s.getSnapshot!==e||r||sn!==null&&sn.memoizedState.tag&1){if(t.flags|=2048,qh(9,oO.bind(null,t,s,i,e),void 0,null),dn===null)throw Error(ie(349));El&30||rO(t,e,i)}return i}function rO(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Dt.updateQueue,e===null?(e={lastEffect:null,stores:null},Dt.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function oO(n,e,t,s){e.value=t,e.getSnapshot=s,lO(e)&&cO(n)}function aO(n,e,t){return t(function(){lO(e)&&cO(n)})}function lO(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Ki(n,t)}catch{return!0}}function cO(n){var e=yo(n,1);e!==null&&zi(e,n,1,-1)}function tP(n){var e=cr();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xh,lastRenderedState:n},e.queue=n,n=n.dispatch=r9.bind(null,Dt,n),[e.memoizedState,n]}function qh(n,e,t,s){return n={tag:n,create:e,destroy:t,deps:s,next:null},e=Dt.updateQueue,e===null?(e={lastEffect:null,stores:null},Dt.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(s=t.next,t.next=n,n.next=s,e.lastEffect=n)),n}function dO(){return bi().memoizedState}function Ug(n,e,t,s){var i=cr();Dt.flags|=n,i.memoizedState=qh(1|e,t,void 0,s===void 0?null:s)}function jv(n,e,t,s){var i=bi();s=s===void 0?null:s;var r=void 0;if(qt!==null){var o=qt.memoizedState;if(r=o.destroy,s!==null&&MC(s,o.deps)){i.memoizedState=qh(e,t,r,s);return}}Dt.flags|=n,i.memoizedState=qh(1|e,t,r,s)}function nP(n,e){return Ug(8390656,8,n,e)}function LC(n,e){return jv(2048,8,n,e)}function uO(n,e){return jv(4,2,n,e)}function hO(n,e){return jv(4,4,n,e)}function pO(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function fO(n,e,t){return t=t!=null?t.concat([n]):null,jv(4,4,pO.bind(null,e,n),t)}function FC(){}function gO(n,e){var t=bi();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&MC(e,s[1])?s[0]:(t.memoizedState=[n,e],n)}function mO(n,e){var t=bi();e=e===void 0?null:e;var s=t.memoizedState;return s!==null&&e!==null&&MC(e,s[1])?s[0]:(n=n(),t.memoizedState=[n,e],n)}function yO(n,e,t){return El&21?(Ki(t,e)||(t=bM(),Dt.lanes|=t,Tl|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Es=!0),n.memoizedState=t)}function s9(n,e){var t=it;it=t!==0&&4>t?t:4,n(!0);var s=bS.transition;bS.transition={};try{n(!1),e()}finally{it=t,bS.transition=s}}function vO(){return bi().memoizedState}function i9(n,e,t){var s=ya(n);if(t={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null},xO(n))SO(e,t);else if(t=eO(n,e,t,s),t!==null){var i=rs();zi(t,n,s,i),wO(t,e,s)}}function r9(n,e,t){var s=ya(n),i={lane:s,action:t,hasEagerState:!1,eagerState:null,next:null};if(xO(n))SO(e,i);else{var r=n.alternate;if(n.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,l=r(o,t);if(i.hasEagerState=!0,i.eagerState=l,Ki(l,o)){var c=e.interleaved;c===null?(i.next=i,kC(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}t=eO(n,e,i,s),t!==null&&(i=rs(),zi(t,n,s,i),wO(t,e,s))}}function xO(n){var e=n.alternate;return n===Dt||e!==null&&e===Dt}function SO(n,e){mh=ty=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function wO(n,e,t){if(t&4194240){var s=e.lanes;s&=n.pendingLanes,t|=s,e.lanes=t,gC(n,t)}}var ny={readContext:wi,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useInsertionEffect:Rn,useLayoutEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useMutableSource:Rn,useSyncExternalStore:Rn,useId:Rn,unstable_isNewReconciler:!1},o9={readContext:wi,useCallback:function(n,e){return cr().memoizedState=[n,e===void 0?null:e],n},useContext:wi,useEffect:nP,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,Ug(4194308,4,pO.bind(null,e,n),t)},useLayoutEffect:function(n,e){return Ug(4194308,4,n,e)},useInsertionEffect:function(n,e){return Ug(4,2,n,e)},useMemo:function(n,e){var t=cr();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var s=cr();return e=t!==void 0?t(e):e,s.memoizedState=s.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},s.queue=n,n=n.dispatch=i9.bind(null,Dt,n),[s.memoizedState,n]},useRef:function(n){var e=cr();return n={current:n},e.memoizedState=n},useState:tP,useDebugValue:FC,useDeferredValue:function(n){return cr().memoizedState=n},useTransition:function(){var n=tP(!1),e=n[0];return n=s9.bind(null,n[1]),cr().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var s=Dt,i=cr();if(Pt){if(t===void 0)throw Error(ie(407));t=t()}else{if(t=e(),dn===null)throw Error(ie(349));El&30||rO(s,e,t)}i.memoizedState=t;var r={value:t,getSnapshot:e};return i.queue=r,nP(aO.bind(null,s,r,n),[n]),s.flags|=2048,qh(9,oO.bind(null,s,r,t,e),void 0,null),t},useId:function(){var n=cr(),e=dn.identifierPrefix;if(Pt){var t=to,s=eo;t=(s&~(1<<32-$i(s)-1)).toString(32)+t,e=":"+e+"R"+t,t=Yh++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=n9++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},a9={readContext:wi,useCallback:gO,useContext:wi,useEffect:LC,useImperativeHandle:fO,useInsertionEffect:uO,useLayoutEffect:hO,useMemo:mO,useReducer:_S,useRef:dO,useState:function(){return _S(Xh)},useDebugValue:FC,useDeferredValue:function(n){var e=bi();return yO(e,qt.memoizedState,n)},useTransition:function(){var n=_S(Xh)[0],e=bi().memoizedState;return[n,e]},useMutableSource:sO,useSyncExternalStore:iO,useId:vO,unstable_isNewReconciler:!1},l9={readContext:wi,useCallback:gO,useContext:wi,useEffect:LC,useImperativeHandle:fO,useInsertionEffect:uO,useLayoutEffect:hO,useMemo:mO,useReducer:CS,useRef:dO,useState:function(){return CS(Xh)},useDebugValue:FC,useDeferredValue:function(n){var e=bi();return qt===null?e.memoizedState=n:yO(e,qt.memoizedState,n)},useTransition:function(){var n=CS(Xh)[0],e=bi().memoizedState;return[n,e]},useMutableSource:sO,useSyncExternalStore:iO,useId:vO,unstable_isNewReconciler:!1};function Ni(n,e){if(n&&n.defaultProps){e=Lt({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}function a0(n,e,t,s){e=n.memoizedState,t=t(s,e),t=t==null?e:Lt({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Nv={isMounted:function(n){return(n=n._reactInternals)?Kl(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var s=rs(),i=ya(n),r=lo(s,i);r.payload=e,t!=null&&(r.callback=t),e=ga(n,r,i),e!==null&&(zi(e,n,i,s),Fg(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var s=rs(),i=ya(n),r=lo(s,i);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=ga(n,r,i),e!==null&&(zi(e,n,i,s),Fg(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=rs(),s=ya(n),i=lo(t,s);i.tag=2,e!=null&&(i.callback=e),e=ga(n,i,s),e!==null&&(zi(e,n,s,t),Fg(e,n,s))}};function sP(n,e,t,s,i,r,o){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(s,r,o):e.prototype&&e.prototype.isPureReactComponent?!zh(t,s)||!zh(i,r):!0}function bO(n,e,t){var s=!1,i=Pa,r=e.contextType;return typeof r=="object"&&r!==null?r=wi(r):(i=js(e)?_l:Yn.current,s=e.contextTypes,r=(s=s!=null)?dd(n,i):Pa),e=new e(t,r),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Nv,n.stateNode=e,e._reactInternals=n,s&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=r),e}function iP(n,e,t,s){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,s),e.state!==n&&Nv.enqueueReplaceState(e,e.state,null)}function l0(n,e,t,s){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs={},AC(n);var r=e.contextType;typeof r=="object"&&r!==null?i.context=wi(r):(r=js(e)?_l:Yn.current,i.context=dd(n,r)),i.state=n.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(a0(n,e,r,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Nv.enqueueReplaceState(i,i.state,null),Qm(n,t,i,s),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function fd(n,e){try{var t="",s=e;do t+=D8(s),s=s.return;while(s);var i=t}catch(r){i=`
Error generating stack: `+r.message+`
`+r.stack}return{value:n,source:e,stack:i,digest:null}}function ES(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function c0(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var c9=typeof WeakMap=="function"?WeakMap:Map;function _O(n,e,t){t=lo(-1,t),t.tag=3,t.payload={element:null};var s=e.value;return t.callback=function(){iy||(iy=!0,x0=s),c0(n,e)},t}function CO(n,e,t){t=lo(-1,t),t.tag=3;var s=n.type.getDerivedStateFromError;if(typeof s=="function"){var i=e.value;t.payload=function(){return s(i)},t.callback=function(){c0(n,e)}}var r=n.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){c0(n,e),typeof s!="function"&&(ma===null?ma=new Set([this]):ma.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function rP(n,e,t){var s=n.pingCache;if(s===null){s=n.pingCache=new c9;var i=new Set;s.set(e,i)}else i=s.get(e),i===void 0&&(i=new Set,s.set(e,i));i.has(t)||(i.add(t),n=_9.bind(null,n,e,t),e.then(n,n))}function oP(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function aP(n,e,t,s,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=lo(-1,1),e.tag=2,ga(t,e,1))),t.lanes|=1),n)}var d9=Po.ReactCurrentOwner,Es=!1;function ts(n,e,t,s){e.child=n===null?QM(e,null,t,s):hd(e,n.child,t,s)}function lP(n,e,t,s,i){t=t.render;var r=e.ref;return qc(e,i),s=OC(n,e,t,s,r,i),t=DC(),n!==null&&!Es?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,vo(n,e,i)):(Pt&&t&&_C(e),e.flags|=1,ts(n,e,s,i),e.child)}function cP(n,e,t,s,i){if(n===null){var r=t.type;return typeof r=="function"&&!VC(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,EO(n,e,r,s,i)):(n=Hg(t.type,null,s,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(r=n.child,!(n.lanes&i)){var o=r.memoizedProps;if(t=t.compare,t=t!==null?t:zh,t(o,s)&&n.ref===e.ref)return vo(n,e,i)}return e.flags|=1,n=va(r,s),n.ref=e.ref,n.return=e,e.child=n}function EO(n,e,t,s,i){if(n!==null){var r=n.memoizedProps;if(zh(r,s)&&n.ref===e.ref)if(Es=!1,e.pendingProps=s=r,(n.lanes&i)!==0)n.flags&131072&&(Es=!0);else return e.lanes=n.lanes,vo(n,e,i)}return d0(n,e,t,s,i)}function TO(n,e,t){var s=e.pendingProps,i=s.children,r=n!==null?n.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},pt(Rc,$s),$s|=t;else{if(!(t&1073741824))return n=r!==null?r.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,pt(Rc,$s),$s|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=r!==null?r.baseLanes:t,pt(Rc,$s),$s|=s}else r!==null?(s=r.baseLanes|t,e.memoizedState=null):s=t,pt(Rc,$s),$s|=s;return ts(n,e,i,t),e.child}function IO(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function d0(n,e,t,s,i){var r=js(t)?_l:Yn.current;return r=dd(e,r),qc(e,i),t=OC(n,e,t,s,r,i),s=DC(),n!==null&&!Es?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,vo(n,e,i)):(Pt&&s&&_C(e),e.flags|=1,ts(n,e,t,i),e.child)}function dP(n,e,t,s,i){if(js(t)){var r=!0;Ym(e)}else r=!1;if(qc(e,i),e.stateNode===null)$g(n,e),bO(e,t,s),l0(e,t,s,i),s=!0;else if(n===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,d=t.contextType;typeof d=="object"&&d!==null?d=wi(d):(d=js(t)?_l:Yn.current,d=dd(e,d));var u=t.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==s||c!==d)&&iP(e,o,s,d),Jo=!1;var p=e.memoizedState;o.state=p,Qm(e,s,o,i),c=e.memoizedState,l!==s||p!==c||As.current||Jo?(typeof u=="function"&&(a0(e,t,u,s),c=e.memoizedState),(l=Jo||sP(e,t,l,s,p,c,d))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=c),o.props=s,o.state=c,o.context=d,s=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{o=e.stateNode,tO(n,e),l=e.memoizedProps,d=e.type===e.elementType?l:Ni(e.type,l),o.props=d,h=e.pendingProps,p=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=wi(c):(c=js(t)?_l:Yn.current,c=dd(e,c));var f=t.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==h||p!==c)&&iP(e,o,s,c),Jo=!1,p=e.memoizedState,o.state=p,Qm(e,s,o,i);var g=e.memoizedState;l!==h||p!==g||As.current||Jo?(typeof f=="function"&&(a0(e,t,f,s),g=e.memoizedState),(d=Jo||sP(e,t,d,s,p,g,c)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(s,g,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(s,g,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=g),o.props=s,o.state=g,o.context=c,s=d):(typeof o.componentDidUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&p===n.memoizedState||(e.flags|=1024),s=!1)}return u0(n,e,t,s,r,i)}function u0(n,e,t,s,i,r){IO(n,e);var o=(e.flags&128)!==0;if(!s&&!o)return i&&XI(e,t,!1),vo(n,e,r);s=e.stateNode,d9.current=e;var l=o&&typeof t.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,n!==null&&o?(e.child=hd(e,n.child,null,r),e.child=hd(e,null,l,r)):ts(n,e,l,r),e.memoizedState=s.state,i&&XI(e,t,!0),e.child}function PO(n){var e=n.stateNode;e.pendingContext?YI(n,e.pendingContext,e.pendingContext!==e.context):e.context&&YI(n,e.context,!1),jC(n,e.containerInfo)}function uP(n,e,t,s,i){return ud(),EC(i),e.flags|=256,ts(n,e,t,s),e.child}var h0={dehydrated:null,treeContext:null,retryLane:0};function p0(n){return{baseLanes:n,cachePool:null,transitions:null}}function kO(n,e,t){var s=e.pendingProps,i=Nt.current,r=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=n!==null&&n.memoizedState===null?!1:(i&2)!==0),l?(r=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),pt(Nt,i&1),n===null)return r0(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=s.children,n=s.fallback,r?(s=e.mode,r=e.child,o={mode:"hidden",children:o},!(s&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=Ov(o,s,0,null),n=xl(n,s,t,null),r.return=e,n.return=e,r.sibling=n,e.child=r,e.child.memoizedState=p0(t),e.memoizedState=h0,n):BC(e,o));if(i=n.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return u9(n,e,o,s,l,i,t);if(r){r=s.fallback,o=e.mode,i=n.child,l=i.sibling;var c={mode:"hidden",children:s.children};return!(o&1)&&e.child!==i?(s=e.child,s.childLanes=0,s.pendingProps=c,e.deletions=null):(s=va(i,c),s.subtreeFlags=i.subtreeFlags&14680064),l!==null?r=va(l,r):(r=xl(r,o,t,null),r.flags|=2),r.return=e,s.return=e,s.sibling=r,e.child=s,s=r,r=e.child,o=n.child.memoizedState,o=o===null?p0(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=n.childLanes&~t,e.memoizedState=h0,s}return r=n.child,n=r.sibling,s=va(r,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=t),s.return=e,s.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=s,e.memoizedState=null,s}function BC(n,e){return e=Ov({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Rf(n,e,t,s){return s!==null&&EC(s),hd(e,n.child,null,t),n=BC(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function u9(n,e,t,s,i,r,o){if(t)return e.flags&256?(e.flags&=-257,s=ES(Error(ie(422))),Rf(n,e,o,s)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(r=s.fallback,i=e.mode,s=Ov({mode:"visible",children:s.children},i,0,null),r=xl(r,i,o,null),r.flags|=2,s.return=e,r.return=e,s.sibling=r,e.child=s,e.mode&1&&hd(e,n.child,null,o),e.child.memoizedState=p0(o),e.memoizedState=h0,r);if(!(e.mode&1))return Rf(n,e,o,null);if(i.data==="$!"){if(s=i.nextSibling&&i.nextSibling.dataset,s)var l=s.dgst;return s=l,r=Error(ie(419)),s=ES(r,s,void 0),Rf(n,e,o,s)}if(l=(o&n.childLanes)!==0,Es||l){if(s=dn,s!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(s.suspendedLanes|o)?0:i,i!==0&&i!==r.retryLane&&(r.retryLane=i,yo(n,i),zi(s,n,i,-1))}return GC(),s=ES(Error(ie(421))),Rf(n,e,o,s)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=C9.bind(null,n),i._reactRetry=e,null):(n=r.treeContext,Gs=fa(i.nextSibling),Vs=e,Pt=!0,Oi=null,n!==null&&(ui[hi++]=eo,ui[hi++]=to,ui[hi++]=Cl,eo=n.id,to=n.overflow,Cl=e),e=BC(e,s.children),e.flags|=4096,e)}function hP(n,e,t){n.lanes|=e;var s=n.alternate;s!==null&&(s.lanes|=e),o0(n.return,e,t)}function TS(n,e,t,s,i){var r=n.memoizedState;r===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:t,tailMode:i}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=s,r.tail=t,r.tailMode=i)}function AO(n,e,t){var s=e.pendingProps,i=s.revealOrder,r=s.tail;if(ts(n,e,s.children,t),s=Nt.current,s&2)s=s&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&hP(n,t,e);else if(n.tag===19)hP(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}s&=1}if(pt(Nt,s),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&ey(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),TS(e,!1,i,t,r);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&ey(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}TS(e,!0,t,null,r);break;case"together":TS(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function $g(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function vo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Tl|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(ie(153));if(e.child!==null){for(n=e.child,t=va(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=va(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function h9(n,e,t){switch(e.tag){case 3:PO(e),ud();break;case 5:nO(e);break;case 1:js(e.type)&&Ym(e);break;case 4:jC(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,i=e.memoizedProps.value;pt(Zm,s._currentValue),s._currentValue=i;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(pt(Nt,Nt.current&1),e.flags|=128,null):t&e.child.childLanes?kO(n,e,t):(pt(Nt,Nt.current&1),n=vo(n,e,t),n!==null?n.sibling:null);pt(Nt,Nt.current&1);break;case 19:if(s=(t&e.childLanes)!==0,n.flags&128){if(s)return AO(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),pt(Nt,Nt.current),s)break;return null;case 22:case 23:return e.lanes=0,TO(n,e,t)}return vo(n,e,t)}var jO,f0,NO,RO;jO=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};f0=function(){};NO=function(n,e,t,s){var i=n.memoizedProps;if(i!==s){n=e.stateNode,pl(br.current);var r=null;switch(t){case"input":i=Db(n,i),s=Db(n,s),r=[];break;case"select":i=Lt({},i,{value:void 0}),s=Lt({},s,{value:void 0}),r=[];break;case"textarea":i=Bb(n,i),s=Bb(n,s),r=[];break;default:typeof i.onClick!="function"&&typeof s.onClick=="function"&&(n.onclick=Vm)}$b(t,s);var o;t=null;for(d in i)if(!s.hasOwnProperty(d)&&i.hasOwnProperty(d)&&i[d]!=null)if(d==="style"){var l=i[d];for(o in l)l.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else d!=="dangerouslySetInnerHTML"&&d!=="children"&&d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&d!=="autoFocus"&&(Oh.hasOwnProperty(d)?r||(r=[]):(r=r||[]).push(d,null));for(d in s){var c=s[d];if(l=i!=null?i[d]:void 0,s.hasOwnProperty(d)&&c!==l&&(c!=null||l!=null))if(d==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(r||(r=[]),r.push(d,t)),t=c;else d==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(r=r||[]).push(d,c)):d==="children"?typeof c!="string"&&typeof c!="number"||(r=r||[]).push(d,""+c):d!=="suppressContentEditableWarning"&&d!=="suppressHydrationWarning"&&(Oh.hasOwnProperty(d)?(c!=null&&d==="onScroll"&&xt("scroll",n),r||l===c||(r=[])):(r=r||[]).push(d,c))}t&&(r=r||[]).push("style",t);var d=r;(e.updateQueue=d)&&(e.flags|=4)}};RO=function(n,e,t,s){t!==s&&(e.flags|=4)};function pu(n,e){if(!Pt)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var s=null;t!==null;)t.alternate!==null&&(s=t),t=t.sibling;s===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:s.sibling=null}}function Mn(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,s=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags&14680064,s|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,s|=i.subtreeFlags,s|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=s,n.childLanes=t,e}function p9(n,e,t){var s=e.pendingProps;switch(CC(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mn(e),null;case 1:return js(e.type)&&Km(),Mn(e),null;case 3:return s=e.stateNode,pd(),Ct(As),Ct(Yn),RC(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(n===null||n.child===null)&&(jf(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Oi!==null&&(b0(Oi),Oi=null))),f0(n,e),Mn(e),null;case 5:NC(e);var i=pl(Kh.current);if(t=e.type,n!==null&&e.stateNode!=null)NO(n,e,t,s,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(ie(166));return Mn(e),null}if(n=pl(br.current),jf(e)){s=e.stateNode,t=e.type;var r=e.memoizedProps;switch(s[hr]=e,s[Gh]=r,n=(e.mode&1)!==0,t){case"dialog":xt("cancel",s),xt("close",s);break;case"iframe":case"object":case"embed":xt("load",s);break;case"video":case"audio":for(i=0;i<Wu.length;i++)xt(Wu[i],s);break;case"source":xt("error",s);break;case"img":case"image":case"link":xt("error",s),xt("load",s);break;case"details":xt("toggle",s);break;case"input":wI(s,r),xt("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!r.multiple},xt("invalid",s);break;case"textarea":_I(s,r),xt("invalid",s)}$b(t,r),i=null;for(var o in r)if(r.hasOwnProperty(o)){var l=r[o];o==="children"?typeof l=="string"?s.textContent!==l&&(r.suppressHydrationWarning!==!0&&Af(s.textContent,l,n),i=["children",l]):typeof l=="number"&&s.textContent!==""+l&&(r.suppressHydrationWarning!==!0&&Af(s.textContent,l,n),i=["children",""+l]):Oh.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&xt("scroll",s)}switch(t){case"input":bf(s),bI(s,r,!0);break;case"textarea":bf(s),CI(s);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(s.onclick=Vm)}s=i,e.updateQueue=s,s!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=aM(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=o.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof s.is=="string"?n=o.createElement(t,{is:s.is}):(n=o.createElement(t),t==="select"&&(o=n,s.multiple?o.multiple=!0:s.size&&(o.size=s.size))):n=o.createElementNS(n,t),n[hr]=e,n[Gh]=s,jO(n,e,!1,!1),e.stateNode=n;e:{switch(o=zb(t,s),t){case"dialog":xt("cancel",n),xt("close",n),i=s;break;case"iframe":case"object":case"embed":xt("load",n),i=s;break;case"video":case"audio":for(i=0;i<Wu.length;i++)xt(Wu[i],n);i=s;break;case"source":xt("error",n),i=s;break;case"img":case"image":case"link":xt("error",n),xt("load",n),i=s;break;case"details":xt("toggle",n),i=s;break;case"input":wI(n,s),i=Db(n,s),xt("invalid",n);break;case"option":i=s;break;case"select":n._wrapperState={wasMultiple:!!s.multiple},i=Lt({},s,{value:void 0}),xt("invalid",n);break;case"textarea":_I(n,s),i=Bb(n,s),xt("invalid",n);break;default:i=s}$b(t,i),l=i;for(r in l)if(l.hasOwnProperty(r)){var c=l[r];r==="style"?dM(n,c):r==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&lM(n,c)):r==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&Dh(n,c):typeof c=="number"&&Dh(n,""+c):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(Oh.hasOwnProperty(r)?c!=null&&r==="onScroll"&&xt("scroll",n):c!=null&&cC(n,r,c,o))}switch(t){case"input":bf(n),bI(n,s,!1);break;case"textarea":bf(n),CI(n);break;case"option":s.value!=null&&n.setAttribute("value",""+Ia(s.value));break;case"select":n.multiple=!!s.multiple,r=s.value,r!=null?Vc(n,!!s.multiple,r,!1):s.defaultValue!=null&&Vc(n,!!s.multiple,s.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=Vm)}switch(t){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Mn(e),null;case 6:if(n&&e.stateNode!=null)RO(n,e,n.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(ie(166));if(t=pl(Kh.current),pl(br.current),jf(e)){if(s=e.stateNode,t=e.memoizedProps,s[hr]=e,(r=s.nodeValue!==t)&&(n=Vs,n!==null))switch(n.tag){case 3:Af(s.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Af(s.nodeValue,t,(n.mode&1)!==0)}r&&(e.flags|=4)}else s=(t.nodeType===9?t:t.ownerDocument).createTextNode(s),s[hr]=e,e.stateNode=s}return Mn(e),null;case 13:if(Ct(Nt),s=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Pt&&Gs!==null&&e.mode&1&&!(e.flags&128))ZM(),ud(),e.flags|=98560,r=!1;else if(r=jf(e),s!==null&&s.dehydrated!==null){if(n===null){if(!r)throw Error(ie(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(ie(317));r[hr]=e}else ud(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Mn(e),r=!1}else Oi!==null&&(b0(Oi),Oi=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(s=s!==null,s!==(n!==null&&n.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(n===null||Nt.current&1?Zt===0&&(Zt=3):GC())),e.updateQueue!==null&&(e.flags|=4),Mn(e),null);case 4:return pd(),f0(n,e),n===null&&Wh(e.stateNode.containerInfo),Mn(e),null;case 10:return PC(e.type._context),Mn(e),null;case 17:return js(e.type)&&Km(),Mn(e),null;case 19:if(Ct(Nt),r=e.memoizedState,r===null)return Mn(e),null;if(s=(e.flags&128)!==0,o=r.rendering,o===null)if(s)pu(r,!1);else{if(Zt!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(o=ey(n),o!==null){for(e.flags|=128,pu(r,!1),s=o.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=t,t=e.child;t!==null;)r=t,n=s,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=n,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,n=o.dependencies,r.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return pt(Nt,Nt.current&1|2),e.child}n=n.sibling}r.tail!==null&&Ht()>gd&&(e.flags|=128,s=!0,pu(r,!1),e.lanes=4194304)}else{if(!s)if(n=ey(o),n!==null){if(e.flags|=128,s=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),pu(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!Pt)return Mn(e),null}else 2*Ht()-r.renderingStartTime>gd&&t!==1073741824&&(e.flags|=128,s=!0,pu(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(t=r.last,t!==null?t.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=Ht(),e.sibling=null,t=Nt.current,pt(Nt,s?t&1|2:t&1),e):(Mn(e),null);case 22:case 23:return HC(),s=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?$s&1073741824&&(Mn(e),e.subtreeFlags&6&&(e.flags|=8192)):Mn(e),null;case 24:return null;case 25:return null}throw Error(ie(156,e.tag))}function f9(n,e){switch(CC(e),e.tag){case 1:return js(e.type)&&Km(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return pd(),Ct(As),Ct(Yn),RC(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return NC(e),null;case 13:if(Ct(Nt),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(ie(340));ud()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Ct(Nt),null;case 4:return pd(),null;case 10:return PC(e.type._context),null;case 22:case 23:return HC(),null;case 24:return null;default:return null}}var Mf=!1,$n=!1,g9=typeof WeakSet=="function"?WeakSet:Set,fe=null;function Nc(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(s){$t(n,e,s)}else t.current=null}function g0(n,e,t){try{t()}catch(s){$t(n,e,s)}}var pP=!1;function m9(n,e){if(Jb=Wm,n=FM(),bC(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var s=t.getSelection&&t.getSelection();if(s&&s.rangeCount!==0){t=s.anchorNode;var i=s.anchorOffset,r=s.focusNode;s=s.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var o=0,l=-1,c=-1,d=0,u=0,h=n,p=null;t:for(;;){for(var f;h!==t||i!==0&&h.nodeType!==3||(l=o+i),h!==r||s!==0&&h.nodeType!==3||(c=o+s),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)p=h,h=f;for(;;){if(h===n)break t;if(p===t&&++d===i&&(l=o),p===r&&++u===s&&(c=o),(f=h.nextSibling)!==null)break;h=p,p=h.parentNode}h=f}t=l===-1||c===-1?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(Qb={focusedElem:n,selectionRange:t},Wm=!1,fe=e;fe!==null;)if(e=fe,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,fe=n;else for(;fe!==null;){e=fe;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var m=g.memoizedProps,x=g.memoizedState,y=e.stateNode,S=y.getSnapshotBeforeUpdate(e.elementType===e.type?m:Ni(e.type,m),x);y.__reactInternalSnapshotBeforeUpdate=S}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ie(163))}}catch(C){$t(e,e.return,C)}if(n=e.sibling,n!==null){n.return=e.return,fe=n;break}fe=e.return}return g=pP,pP=!1,g}function yh(n,e,t){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var i=s=s.next;do{if((i.tag&n)===n){var r=i.destroy;i.destroy=void 0,r!==void 0&&g0(e,t,r)}i=i.next}while(i!==s)}}function Rv(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var s=t.create;t.destroy=s()}t=t.next}while(t!==e)}}function m0(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function MO(n){var e=n.alternate;e!==null&&(n.alternate=null,MO(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[hr],delete e[Gh],delete e[n0],delete e[JW],delete e[QW])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function OO(n){return n.tag===5||n.tag===3||n.tag===4}function fP(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||OO(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function y0(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Vm));else if(s!==4&&(n=n.child,n!==null))for(y0(n,e,t),n=n.sibling;n!==null;)y0(n,e,t),n=n.sibling}function v0(n,e,t){var s=n.tag;if(s===5||s===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(s!==4&&(n=n.child,n!==null))for(v0(n,e,t),n=n.sibling;n!==null;)v0(n,e,t),n=n.sibling}var vn=null,Ri=!1;function zo(n,e,t){for(t=t.child;t!==null;)DO(n,e,t),t=t.sibling}function DO(n,e,t){if(wr&&typeof wr.onCommitFiberUnmount=="function")try{wr.onCommitFiberUnmount(Ev,t)}catch{}switch(t.tag){case 5:$n||Nc(t,e);case 6:var s=vn,i=Ri;vn=null,zo(n,e,t),vn=s,Ri=i,vn!==null&&(Ri?(n=vn,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):vn.removeChild(t.stateNode));break;case 18:vn!==null&&(Ri?(n=vn,t=t.stateNode,n.nodeType===8?xS(n.parentNode,t):n.nodeType===1&&xS(n,t),Uh(n)):xS(vn,t.stateNode));break;case 4:s=vn,i=Ri,vn=t.stateNode.containerInfo,Ri=!0,zo(n,e,t),vn=s,Ri=i;break;case 0:case 11:case 14:case 15:if(!$n&&(s=t.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){i=s=s.next;do{var r=i,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&g0(t,e,o),i=i.next}while(i!==s)}zo(n,e,t);break;case 1:if(!$n&&(Nc(t,e),s=t.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=t.memoizedProps,s.state=t.memoizedState,s.componentWillUnmount()}catch(l){$t(t,e,l)}zo(n,e,t);break;case 21:zo(n,e,t);break;case 22:t.mode&1?($n=(s=$n)||t.memoizedState!==null,zo(n,e,t),$n=s):zo(n,e,t);break;default:zo(n,e,t)}}function gP(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new g9),e.forEach(function(s){var i=E9.bind(null,n,s);t.has(s)||(t.add(s),s.then(i,i))})}}function Ai(n,e){var t=e.deletions;if(t!==null)for(var s=0;s<t.length;s++){var i=t[s];try{var r=n,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:vn=l.stateNode,Ri=!1;break e;case 3:vn=l.stateNode.containerInfo,Ri=!0;break e;case 4:vn=l.stateNode.containerInfo,Ri=!0;break e}l=l.return}if(vn===null)throw Error(ie(160));DO(r,o,i),vn=null,Ri=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(d){$t(i,e,d)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)LO(e,n),e=e.sibling}function LO(n,e){var t=n.alternate,s=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ai(e,n),ir(n),s&4){try{yh(3,n,n.return),Rv(3,n)}catch(m){$t(n,n.return,m)}try{yh(5,n,n.return)}catch(m){$t(n,n.return,m)}}break;case 1:Ai(e,n),ir(n),s&512&&t!==null&&Nc(t,t.return);break;case 5:if(Ai(e,n),ir(n),s&512&&t!==null&&Nc(t,t.return),n.flags&32){var i=n.stateNode;try{Dh(i,"")}catch(m){$t(n,n.return,m)}}if(s&4&&(i=n.stateNode,i!=null)){var r=n.memoizedProps,o=t!==null?t.memoizedProps:r,l=n.type,c=n.updateQueue;if(n.updateQueue=null,c!==null)try{l==="input"&&r.type==="radio"&&r.name!=null&&rM(i,r),zb(l,o);var d=zb(l,r);for(o=0;o<c.length;o+=2){var u=c[o],h=c[o+1];u==="style"?dM(i,h):u==="dangerouslySetInnerHTML"?lM(i,h):u==="children"?Dh(i,h):cC(i,u,h,d)}switch(l){case"input":Lb(i,r);break;case"textarea":oM(i,r);break;case"select":var p=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!r.multiple;var f=r.value;f!=null?Vc(i,!!r.multiple,f,!1):p!==!!r.multiple&&(r.defaultValue!=null?Vc(i,!!r.multiple,r.defaultValue,!0):Vc(i,!!r.multiple,r.multiple?[]:"",!1))}i[Gh]=r}catch(m){$t(n,n.return,m)}}break;case 6:if(Ai(e,n),ir(n),s&4){if(n.stateNode===null)throw Error(ie(162));i=n.stateNode,r=n.memoizedProps;try{i.nodeValue=r}catch(m){$t(n,n.return,m)}}break;case 3:if(Ai(e,n),ir(n),s&4&&t!==null&&t.memoizedState.isDehydrated)try{Uh(e.containerInfo)}catch(m){$t(n,n.return,m)}break;case 4:Ai(e,n),ir(n);break;case 13:Ai(e,n),ir(n),i=n.child,i.flags&8192&&(r=i.memoizedState!==null,i.stateNode.isHidden=r,!r||i.alternate!==null&&i.alternate.memoizedState!==null||(zC=Ht())),s&4&&gP(n);break;case 22:if(u=t!==null&&t.memoizedState!==null,n.mode&1?($n=(d=$n)||u,Ai(e,n),$n=d):Ai(e,n),ir(n),s&8192){if(d=n.memoizedState!==null,(n.stateNode.isHidden=d)&&!u&&n.mode&1)for(fe=n,u=n.child;u!==null;){for(h=fe=u;fe!==null;){switch(p=fe,f=p.child,p.tag){case 0:case 11:case 14:case 15:yh(4,p,p.return);break;case 1:Nc(p,p.return);var g=p.stateNode;if(typeof g.componentWillUnmount=="function"){s=p,t=p.return;try{e=s,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(m){$t(s,t,m)}}break;case 5:Nc(p,p.return);break;case 22:if(p.memoizedState!==null){yP(h);continue}}f!==null?(f.return=p,fe=f):yP(h)}u=u.sibling}e:for(u=null,h=n;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,d?(r=i.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(l=h.stateNode,c=h.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=cM("display",o))}catch(m){$t(n,n.return,m)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=d?"":h.memoizedProps}catch(m){$t(n,n.return,m)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===n)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===n)break e;for(;h.sibling===null;){if(h.return===null||h.return===n)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ai(e,n),ir(n),s&4&&gP(n);break;case 21:break;default:Ai(e,n),ir(n)}}function ir(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(OO(t)){var s=t;break e}t=t.return}throw Error(ie(160))}switch(s.tag){case 5:var i=s.stateNode;s.flags&32&&(Dh(i,""),s.flags&=-33);var r=fP(n);v0(n,r,i);break;case 3:case 4:var o=s.stateNode.containerInfo,l=fP(n);y0(n,l,o);break;default:throw Error(ie(161))}}catch(c){$t(n,n.return,c)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function y9(n,e,t){fe=n,FO(n)}function FO(n,e,t){for(var s=(n.mode&1)!==0;fe!==null;){var i=fe,r=i.child;if(i.tag===22&&s){var o=i.memoizedState!==null||Mf;if(!o){var l=i.alternate,c=l!==null&&l.memoizedState!==null||$n;l=Mf;var d=$n;if(Mf=o,($n=c)&&!d)for(fe=i;fe!==null;)o=fe,c=o.child,o.tag===22&&o.memoizedState!==null?vP(i):c!==null?(c.return=o,fe=c):vP(i);for(;r!==null;)fe=r,FO(r),r=r.sibling;fe=i,Mf=l,$n=d}mP(n)}else i.subtreeFlags&8772&&r!==null?(r.return=i,fe=r):mP(n)}}function mP(n){for(;fe!==null;){var e=fe;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:$n||Rv(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!$n)if(t===null)s.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Ni(e.type,t.memoizedProps);s.componentDidUpdate(i,t.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&eP(e,r,s);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}eP(e,o,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var d=e.alternate;if(d!==null){var u=d.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Uh(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ie(163))}$n||e.flags&512&&m0(e)}catch(p){$t(e,e.return,p)}}if(e===n){fe=null;break}if(t=e.sibling,t!==null){t.return=e.return,fe=t;break}fe=e.return}}function yP(n){for(;fe!==null;){var e=fe;if(e===n){fe=null;break}var t=e.sibling;if(t!==null){t.return=e.return,fe=t;break}fe=e.return}}function vP(n){for(;fe!==null;){var e=fe;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Rv(4,e)}catch(c){$t(e,t,c)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var i=e.return;try{s.componentDidMount()}catch(c){$t(e,i,c)}}var r=e.return;try{m0(e)}catch(c){$t(e,r,c)}break;case 5:var o=e.return;try{m0(e)}catch(c){$t(e,o,c)}}}catch(c){$t(e,e.return,c)}if(e===n){fe=null;break}var l=e.sibling;if(l!==null){l.return=e.return,fe=l;break}fe=e.return}}var v9=Math.ceil,sy=Po.ReactCurrentDispatcher,UC=Po.ReactCurrentOwner,xi=Po.ReactCurrentBatchConfig,Xe=0,dn=null,Xt=null,Tn=0,$s=0,Rc=La(0),Zt=0,Zh=null,Tl=0,Mv=0,$C=0,vh=null,ws=null,zC=0,gd=1/0,Kr=null,iy=!1,x0=null,ma=null,Of=!1,oa=null,ry=0,xh=0,S0=null,zg=-1,Wg=0;function rs(){return Xe&6?Ht():zg!==-1?zg:zg=Ht()}function ya(n){return n.mode&1?Xe&2&&Tn!==0?Tn&-Tn:t9.transition!==null?(Wg===0&&(Wg=bM()),Wg):(n=it,n!==0||(n=window.event,n=n===void 0?16:kM(n.type)),n):1}function zi(n,e,t,s){if(50<xh)throw xh=0,S0=null,Error(ie(185));Cp(n,t,s),(!(Xe&2)||n!==dn)&&(n===dn&&(!(Xe&2)&&(Mv|=t),Zt===4&&ea(n,Tn)),Ns(n,s),t===1&&Xe===0&&!(e.mode&1)&&(gd=Ht()+500,Av&&Fa()))}function Ns(n,e){var t=n.callbackNode;tW(n,e);var s=zm(n,n===dn?Tn:0);if(s===0)t!==null&&II(t),n.callbackNode=null,n.callbackPriority=0;else if(e=s&-s,n.callbackPriority!==e){if(t!=null&&II(t),e===1)n.tag===0?e9(xP.bind(null,n)):YM(xP.bind(null,n)),qW(function(){!(Xe&6)&&Fa()}),t=null;else{switch(_M(s)){case 1:t=fC;break;case 4:t=SM;break;case 16:t=$m;break;case 536870912:t=wM;break;default:t=$m}t=VO(t,BO.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function BO(n,e){if(zg=-1,Wg=0,Xe&6)throw Error(ie(327));var t=n.callbackNode;if(Zc()&&n.callbackNode!==t)return null;var s=zm(n,n===dn?Tn:0);if(s===0)return null;if(s&30||s&n.expiredLanes||e)e=oy(n,s);else{e=s;var i=Xe;Xe|=2;var r=$O();(dn!==n||Tn!==e)&&(Kr=null,gd=Ht()+500,vl(n,e));do try{w9();break}catch(l){UO(n,l)}while(!0);IC(),sy.current=r,Xe=i,Xt!==null?e=0:(dn=null,Tn=0,e=Zt)}if(e!==0){if(e===2&&(i=Kb(n),i!==0&&(s=i,e=w0(n,i))),e===1)throw t=Zh,vl(n,0),ea(n,s),Ns(n,Ht()),t;if(e===6)ea(n,s);else{if(i=n.current.alternate,!(s&30)&&!x9(i)&&(e=oy(n,s),e===2&&(r=Kb(n),r!==0&&(s=r,e=w0(n,r))),e===1))throw t=Zh,vl(n,0),ea(n,s),Ns(n,Ht()),t;switch(n.finishedWork=i,n.finishedLanes=s,e){case 0:case 1:throw Error(ie(345));case 2:ol(n,ws,Kr);break;case 3:if(ea(n,s),(s&130023424)===s&&(e=zC+500-Ht(),10<e)){if(zm(n,0)!==0)break;if(i=n.suspendedLanes,(i&s)!==s){rs(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=t0(ol.bind(null,n,ws,Kr),e);break}ol(n,ws,Kr);break;case 4:if(ea(n,s),(s&4194240)===s)break;for(e=n.eventTimes,i=-1;0<s;){var o=31-$i(s);r=1<<o,o=e[o],o>i&&(i=o),s&=~r}if(s=i,s=Ht()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*v9(s/1960))-s,10<s){n.timeoutHandle=t0(ol.bind(null,n,ws,Kr),s);break}ol(n,ws,Kr);break;case 5:ol(n,ws,Kr);break;default:throw Error(ie(329))}}}return Ns(n,Ht()),n.callbackNode===t?BO.bind(null,n):null}function w0(n,e){var t=vh;return n.current.memoizedState.isDehydrated&&(vl(n,e).flags|=256),n=oy(n,e),n!==2&&(e=ws,ws=t,e!==null&&b0(e)),n}function b0(n){ws===null?ws=n:ws.push.apply(ws,n)}function x9(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var s=0;s<t.length;s++){var i=t[s],r=i.getSnapshot;i=i.value;try{if(!Ki(r(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ea(n,e){for(e&=~$C,e&=~Mv,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-$i(e),s=1<<t;n[t]=-1,e&=~s}}function xP(n){if(Xe&6)throw Error(ie(327));Zc();var e=zm(n,0);if(!(e&1))return Ns(n,Ht()),null;var t=oy(n,e);if(n.tag!==0&&t===2){var s=Kb(n);s!==0&&(e=s,t=w0(n,s))}if(t===1)throw t=Zh,vl(n,0),ea(n,e),Ns(n,Ht()),t;if(t===6)throw Error(ie(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ol(n,ws,Kr),Ns(n,Ht()),null}function WC(n,e){var t=Xe;Xe|=1;try{return n(e)}finally{Xe=t,Xe===0&&(gd=Ht()+500,Av&&Fa())}}function Il(n){oa!==null&&oa.tag===0&&!(Xe&6)&&Zc();var e=Xe;Xe|=1;var t=xi.transition,s=it;try{if(xi.transition=null,it=1,n)return n()}finally{it=s,xi.transition=t,Xe=e,!(Xe&6)&&Fa()}}function HC(){$s=Rc.current,Ct(Rc)}function vl(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,XW(t)),Xt!==null)for(t=Xt.return;t!==null;){var s=t;switch(CC(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Km();break;case 3:pd(),Ct(As),Ct(Yn),RC();break;case 5:NC(s);break;case 4:pd();break;case 13:Ct(Nt);break;case 19:Ct(Nt);break;case 10:PC(s.type._context);break;case 22:case 23:HC()}t=t.return}if(dn=n,Xt=n=va(n.current,null),Tn=$s=e,Zt=0,Zh=null,$C=Mv=Tl=0,ws=vh=null,hl!==null){for(e=0;e<hl.length;e++)if(t=hl[e],s=t.interleaved,s!==null){t.interleaved=null;var i=s.next,r=t.pending;if(r!==null){var o=r.next;r.next=i,s.next=o}t.pending=s}hl=null}return n}function UO(n,e){do{var t=Xt;try{if(IC(),Bg.current=ny,ty){for(var s=Dt.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}ty=!1}if(El=0,sn=qt=Dt=null,mh=!1,Yh=0,UC.current=null,t===null||t.return===null){Zt=1,Zh=e,Xt=null;break}e:{var r=n,o=t.return,l=t,c=e;if(e=Tn,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var d=c,u=l,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var p=u.alternate;p?(u.updateQueue=p.updateQueue,u.memoizedState=p.memoizedState,u.lanes=p.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=oP(o);if(f!==null){f.flags&=-257,aP(f,o,l,r,e),f.mode&1&&rP(r,d,e),e=f,c=d;var g=e.updateQueue;if(g===null){var m=new Set;m.add(c),e.updateQueue=m}else g.add(c);break e}else{if(!(e&1)){rP(r,d,e),GC();break e}c=Error(ie(426))}}else if(Pt&&l.mode&1){var x=oP(o);if(x!==null){!(x.flags&65536)&&(x.flags|=256),aP(x,o,l,r,e),EC(fd(c,l));break e}}r=c=fd(c,l),Zt!==4&&(Zt=2),vh===null?vh=[r]:vh.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var y=_O(r,c,e);QI(r,y);break e;case 1:l=c;var S=r.type,v=r.stateNode;if(!(r.flags&128)&&(typeof S.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(ma===null||!ma.has(v)))){r.flags|=65536,e&=-e,r.lanes|=e;var C=CO(r,l,e);QI(r,C);break e}}r=r.return}while(r!==null)}WO(t)}catch(T){e=T,Xt===t&&t!==null&&(Xt=t=t.return);continue}break}while(!0)}function $O(){var n=sy.current;return sy.current=ny,n===null?ny:n}function GC(){(Zt===0||Zt===3||Zt===2)&&(Zt=4),dn===null||!(Tl&268435455)&&!(Mv&268435455)||ea(dn,Tn)}function oy(n,e){var t=Xe;Xe|=2;var s=$O();(dn!==n||Tn!==e)&&(Kr=null,vl(n,e));do try{S9();break}catch(i){UO(n,i)}while(!0);if(IC(),Xe=t,sy.current=s,Xt!==null)throw Error(ie(261));return dn=null,Tn=0,Zt}function S9(){for(;Xt!==null;)zO(Xt)}function w9(){for(;Xt!==null&&!V8();)zO(Xt)}function zO(n){var e=GO(n.alternate,n,$s);n.memoizedProps=n.pendingProps,e===null?WO(n):Xt=e,UC.current=null}function WO(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=f9(t,e),t!==null){t.flags&=32767,Xt=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Zt=6,Xt=null;return}}else if(t=p9(t,e,$s),t!==null){Xt=t;return}if(e=e.sibling,e!==null){Xt=e;return}Xt=e=n}while(e!==null);Zt===0&&(Zt=5)}function ol(n,e,t){var s=it,i=xi.transition;try{xi.transition=null,it=1,b9(n,e,t,s)}finally{xi.transition=i,it=s}return null}function b9(n,e,t,s){do Zc();while(oa!==null);if(Xe&6)throw Error(ie(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(ie(177));n.callbackNode=null,n.callbackPriority=0;var r=t.lanes|t.childLanes;if(nW(n,r),n===dn&&(Xt=dn=null,Tn=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Of||(Of=!0,VO($m,function(){return Zc(),null})),r=(t.flags&15990)!==0,t.subtreeFlags&15990||r){r=xi.transition,xi.transition=null;var o=it;it=1;var l=Xe;Xe|=4,UC.current=null,m9(n,t),LO(t,n),zW(Qb),Wm=!!Jb,Qb=Jb=null,n.current=t,y9(t),K8(),Xe=l,it=o,xi.transition=r}else n.current=t;if(Of&&(Of=!1,oa=n,ry=i),r=n.pendingLanes,r===0&&(ma=null),q8(t.stateNode),Ns(n,Ht()),e!==null)for(s=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],s(i.value,{componentStack:i.stack,digest:i.digest});if(iy)throw iy=!1,n=x0,x0=null,n;return ry&1&&n.tag!==0&&Zc(),r=n.pendingLanes,r&1?n===S0?xh++:(xh=0,S0=n):xh=0,Fa(),null}function Zc(){if(oa!==null){var n=_M(ry),e=xi.transition,t=it;try{if(xi.transition=null,it=16>n?16:n,oa===null)var s=!1;else{if(n=oa,oa=null,ry=0,Xe&6)throw Error(ie(331));var i=Xe;for(Xe|=4,fe=n.current;fe!==null;){var r=fe,o=r.child;if(fe.flags&16){var l=r.deletions;if(l!==null){for(var c=0;c<l.length;c++){var d=l[c];for(fe=d;fe!==null;){var u=fe;switch(u.tag){case 0:case 11:case 15:yh(8,u,r)}var h=u.child;if(h!==null)h.return=u,fe=h;else for(;fe!==null;){u=fe;var p=u.sibling,f=u.return;if(MO(u),u===d){fe=null;break}if(p!==null){p.return=f,fe=p;break}fe=f}}}var g=r.alternate;if(g!==null){var m=g.child;if(m!==null){g.child=null;do{var x=m.sibling;m.sibling=null,m=x}while(m!==null)}}fe=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,fe=o;else e:for(;fe!==null;){if(r=fe,r.flags&2048)switch(r.tag){case 0:case 11:case 15:yh(9,r,r.return)}var y=r.sibling;if(y!==null){y.return=r.return,fe=y;break e}fe=r.return}}var S=n.current;for(fe=S;fe!==null;){o=fe;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,fe=v;else e:for(o=S;fe!==null;){if(l=fe,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Rv(9,l)}}catch(T){$t(l,l.return,T)}if(l===o){fe=null;break e}var C=l.sibling;if(C!==null){C.return=l.return,fe=C;break e}fe=l.return}}if(Xe=i,Fa(),wr&&typeof wr.onPostCommitFiberRoot=="function")try{wr.onPostCommitFiberRoot(Ev,n)}catch{}s=!0}return s}finally{it=t,xi.transition=e}}return!1}function SP(n,e,t){e=fd(t,e),e=_O(n,e,1),n=ga(n,e,1),e=rs(),n!==null&&(Cp(n,1,e),Ns(n,e))}function $t(n,e,t){if(n.tag===3)SP(n,n,t);else for(;e!==null;){if(e.tag===3){SP(e,n,t);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(ma===null||!ma.has(s))){n=fd(t,n),n=CO(e,n,1),e=ga(e,n,1),n=rs(),e!==null&&(Cp(e,1,n),Ns(e,n));break}}e=e.return}}function _9(n,e,t){var s=n.pingCache;s!==null&&s.delete(e),e=rs(),n.pingedLanes|=n.suspendedLanes&t,dn===n&&(Tn&t)===t&&(Zt===4||Zt===3&&(Tn&130023424)===Tn&&500>Ht()-zC?vl(n,0):$C|=t),Ns(n,e)}function HO(n,e){e===0&&(n.mode&1?(e=Ef,Ef<<=1,!(Ef&130023424)&&(Ef=4194304)):e=1);var t=rs();n=yo(n,e),n!==null&&(Cp(n,e,t),Ns(n,t))}function C9(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),HO(n,t)}function E9(n,e){var t=0;switch(n.tag){case 13:var s=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:s=n.stateNode;break;default:throw Error(ie(314))}s!==null&&s.delete(e),HO(n,t)}var GO;GO=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||As.current)Es=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Es=!1,h9(n,e,t);Es=!!(n.flags&131072)}else Es=!1,Pt&&e.flags&1048576&&XM(e,qm,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;$g(n,e),n=e.pendingProps;var i=dd(e,Yn.current);qc(e,t),i=OC(null,e,s,n,i,t);var r=DC();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,js(s)?(r=!0,Ym(e)):r=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,AC(e),i.updater=Nv,e.stateNode=i,i._reactInternals=e,l0(e,s,n,t),e=u0(null,e,s,!0,r,t)):(e.tag=0,Pt&&r&&_C(e),ts(null,e,i,t),e=e.child),e;case 16:s=e.elementType;e:{switch($g(n,e),n=e.pendingProps,i=s._init,s=i(s._payload),e.type=s,i=e.tag=I9(s),n=Ni(s,n),i){case 0:e=d0(null,e,s,n,t);break e;case 1:e=dP(null,e,s,n,t);break e;case 11:e=lP(null,e,s,n,t);break e;case 14:e=cP(null,e,s,Ni(s.type,n),t);break e}throw Error(ie(306,s,""))}return e;case 0:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Ni(s,i),d0(n,e,s,i,t);case 1:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Ni(s,i),dP(n,e,s,i,t);case 3:e:{if(PO(e),n===null)throw Error(ie(387));s=e.pendingProps,r=e.memoizedState,i=r.element,tO(n,e),Qm(e,s,null,t);var o=e.memoizedState;if(s=o.element,r.isDehydrated)if(r={element:s,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){i=fd(Error(ie(423)),e),e=uP(n,e,s,t,i);break e}else if(s!==i){i=fd(Error(ie(424)),e),e=uP(n,e,s,t,i);break e}else for(Gs=fa(e.stateNode.containerInfo.firstChild),Vs=e,Pt=!0,Oi=null,t=QM(e,null,s,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(ud(),s===i){e=vo(n,e,t);break e}ts(n,e,s,t)}e=e.child}return e;case 5:return nO(e),n===null&&r0(e),s=e.type,i=e.pendingProps,r=n!==null?n.memoizedProps:null,o=i.children,e0(s,i)?o=null:r!==null&&e0(s,r)&&(e.flags|=32),IO(n,e),ts(n,e,o,t),e.child;case 6:return n===null&&r0(e),null;case 13:return kO(n,e,t);case 4:return jC(e,e.stateNode.containerInfo),s=e.pendingProps,n===null?e.child=hd(e,null,s,t):ts(n,e,s,t),e.child;case 11:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Ni(s,i),lP(n,e,s,i,t);case 7:return ts(n,e,e.pendingProps,t),e.child;case 8:return ts(n,e,e.pendingProps.children,t),e.child;case 12:return ts(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(s=e.type._context,i=e.pendingProps,r=e.memoizedProps,o=i.value,pt(Zm,s._currentValue),s._currentValue=o,r!==null)if(Ki(r.value,o)){if(r.children===i.children&&!As.current){e=vo(n,e,t);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var l=r.dependencies;if(l!==null){o=r.child;for(var c=l.firstContext;c!==null;){if(c.context===s){if(r.tag===1){c=lo(-1,t&-t),c.tag=2;var d=r.updateQueue;if(d!==null){d=d.shared;var u=d.pending;u===null?c.next=c:(c.next=u.next,u.next=c),d.pending=c}}r.lanes|=t,c=r.alternate,c!==null&&(c.lanes|=t),o0(r.return,t,e),l.lanes|=t;break}c=c.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(ie(341));o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),o0(o,t,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}ts(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,s=e.pendingProps.children,qc(e,t),i=wi(i),s=s(i),e.flags|=1,ts(n,e,s,t),e.child;case 14:return s=e.type,i=Ni(s,e.pendingProps),i=Ni(s.type,i),cP(n,e,s,i,t);case 15:return EO(n,e,e.type,e.pendingProps,t);case 17:return s=e.type,i=e.pendingProps,i=e.elementType===s?i:Ni(s,i),$g(n,e),e.tag=1,js(s)?(n=!0,Ym(e)):n=!1,qc(e,t),bO(e,s,i),l0(e,s,i,t),u0(null,e,s,!0,n,t);case 19:return AO(n,e,t);case 22:return TO(n,e,t)}throw Error(ie(156,e.tag))};function VO(n,e){return xM(n,e)}function T9(n,e,t,s){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(n,e,t,s){return new T9(n,e,t,s)}function VC(n){return n=n.prototype,!(!n||!n.isReactComponent)}function I9(n){if(typeof n=="function")return VC(n)?1:0;if(n!=null){if(n=n.$$typeof,n===uC)return 11;if(n===hC)return 14}return 2}function va(n,e){var t=n.alternate;return t===null?(t=gi(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function Hg(n,e,t,s,i,r){var o=2;if(s=n,typeof n=="function")VC(n)&&(o=1);else if(typeof n=="string")o=5;else e:switch(n){case _c:return xl(t.children,i,r,e);case dC:o=8,i|=8;break;case Nb:return n=gi(12,t,e,i|2),n.elementType=Nb,n.lanes=r,n;case Rb:return n=gi(13,t,e,i),n.elementType=Rb,n.lanes=r,n;case Mb:return n=gi(19,t,e,i),n.elementType=Mb,n.lanes=r,n;case nM:return Ov(t,i,r,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case eM:o=10;break e;case tM:o=9;break e;case uC:o=11;break e;case hC:o=14;break e;case Zo:o=16,s=null;break e}throw Error(ie(130,n==null?n:typeof n,""))}return e=gi(o,t,e,i),e.elementType=n,e.type=s,e.lanes=r,e}function xl(n,e,t,s){return n=gi(7,n,s,e),n.lanes=t,n}function Ov(n,e,t,s){return n=gi(22,n,s,e),n.elementType=nM,n.lanes=t,n.stateNode={isHidden:!1},n}function IS(n,e,t){return n=gi(6,n,null,e),n.lanes=t,n}function PS(n,e,t){return e=gi(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function P9(n,e,t,s,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=lS(0),this.expirationTimes=lS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=lS(0),this.identifierPrefix=s,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function KC(n,e,t,s,i,r,o,l,c){return n=new P9(n,e,t,l,c),e===1?(e=1,r===!0&&(e|=8)):e=0,r=gi(3,null,null,e),n.current=r,r.stateNode=n,r.memoizedState={element:s,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},AC(r),n}function k9(n,e,t){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:bc,key:s==null?null:""+s,children:n,containerInfo:e,implementation:t}}function KO(n){if(!n)return Pa;n=n._reactInternals;e:{if(Kl(n)!==n||n.tag!==1)throw Error(ie(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(js(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ie(171))}if(n.tag===1){var t=n.type;if(js(t))return KM(n,t,e)}return e}function YO(n,e,t,s,i,r,o,l,c){return n=KC(t,s,!0,n,i,r,o,l,c),n.context=KO(null),t=n.current,s=rs(),i=ya(t),r=lo(s,i),r.callback=e??null,ga(t,r,i),n.current.lanes=i,Cp(n,i,s),Ns(n,s),n}function Dv(n,e,t,s){var i=e.current,r=rs(),o=ya(i);return t=KO(t),e.context===null?e.context=t:e.pendingContext=t,e=lo(r,o),e.payload={element:n},s=s===void 0?null:s,s!==null&&(e.callback=s),n=ga(i,e,o),n!==null&&(zi(n,i,o,r),Fg(n,i,o)),o}function ay(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function wP(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function YC(n,e){wP(n,e),(n=n.alternate)&&wP(n,e)}function A9(){return null}var XO=typeof reportError=="function"?reportError:function(n){console.error(n)};function XC(n){this._internalRoot=n}Lv.prototype.render=XC.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(ie(409));Dv(n,e,null,null)};Lv.prototype.unmount=XC.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Il(function(){Dv(null,n,null,null)}),e[mo]=null}};function Lv(n){this._internalRoot=n}Lv.prototype.unstable_scheduleHydration=function(n){if(n){var e=TM();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Qo.length&&e!==0&&e<Qo[t].priority;t++);Qo.splice(t,0,n),t===0&&PM(n)}};function qC(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Fv(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function bP(){}function j9(n,e,t,s,i){if(i){if(typeof s=="function"){var r=s;s=function(){var d=ay(o);r.call(d)}}var o=YO(e,s,n,0,null,!1,!1,"",bP);return n._reactRootContainer=o,n[mo]=o.current,Wh(n.nodeType===8?n.parentNode:n),Il(),o}for(;i=n.lastChild;)n.removeChild(i);if(typeof s=="function"){var l=s;s=function(){var d=ay(c);l.call(d)}}var c=KC(n,0,!1,null,null,!1,!1,"",bP);return n._reactRootContainer=c,n[mo]=c.current,Wh(n.nodeType===8?n.parentNode:n),Il(function(){Dv(e,c,t,s)}),c}function Bv(n,e,t,s,i){var r=t._reactRootContainer;if(r){var o=r;if(typeof i=="function"){var l=i;i=function(){var c=ay(o);l.call(c)}}Dv(e,o,n,i)}else o=j9(t,e,n,i,s);return ay(o)}CM=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=zu(e.pendingLanes);t!==0&&(gC(e,t|1),Ns(e,Ht()),!(Xe&6)&&(gd=Ht()+500,Fa()))}break;case 13:Il(function(){var s=yo(n,1);if(s!==null){var i=rs();zi(s,n,1,i)}}),YC(n,1)}};mC=function(n){if(n.tag===13){var e=yo(n,134217728);if(e!==null){var t=rs();zi(e,n,134217728,t)}YC(n,134217728)}};EM=function(n){if(n.tag===13){var e=ya(n),t=yo(n,e);if(t!==null){var s=rs();zi(t,n,e,s)}YC(n,e)}};TM=function(){return it};IM=function(n,e){var t=it;try{return it=n,e()}finally{it=t}};Hb=function(n,e,t){switch(e){case"input":if(Lb(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var s=t[e];if(s!==n&&s.form===n.form){var i=kv(s);if(!i)throw Error(ie(90));iM(s),Lb(s,i)}}}break;case"textarea":oM(n,t);break;case"select":e=t.value,e!=null&&Vc(n,!!t.multiple,e,!1)}};pM=WC;fM=Il;var N9={usingClientEntryPoint:!1,Events:[Tp,Ic,kv,uM,hM,WC]},fu={findFiberByHostInstance:ul,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},R9={bundleType:fu.bundleType,version:fu.version,rendererPackageName:fu.rendererPackageName,rendererConfig:fu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Po.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=yM(n),n===null?null:n.stateNode},findFiberByHostInstance:fu.findFiberByHostInstance||A9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Df=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Df.isDisabled&&Df.supportsFiber)try{Ev=Df.inject(R9),wr=Df}catch{}}ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N9;ti.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qC(e))throw Error(ie(200));return k9(n,e,null,t)};ti.createRoot=function(n,e){if(!qC(n))throw Error(ie(299));var t=!1,s="",i=XO;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=KC(n,1,!1,null,null,t,!1,s,i),n[mo]=e.current,Wh(n.nodeType===8?n.parentNode:n),new XC(e)};ti.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(ie(188)):(n=Object.keys(n).join(","),Error(ie(268,n)));return n=yM(e),n=n===null?null:n.stateNode,n};ti.flushSync=function(n){return Il(n)};ti.hydrate=function(n,e,t){if(!Fv(e))throw Error(ie(200));return Bv(null,n,e,!0,t)};ti.hydrateRoot=function(n,e,t){if(!qC(n))throw Error(ie(405));var s=t!=null&&t.hydratedSources||null,i=!1,r="",o=XO;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=YO(e,null,n,1,t??null,i,!1,r,o),n[mo]=e.current,Wh(n),s)for(n=0;n<s.length;n++)t=s[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new Lv(e)};ti.render=function(n,e,t){if(!Fv(e))throw Error(ie(200));return Bv(null,n,e,!1,t)};ti.unmountComponentAtNode=function(n){if(!Fv(n))throw Error(ie(40));return n._reactRootContainer?(Il(function(){Bv(null,null,n,!1,function(){n._reactRootContainer=null,n[mo]=null})}),!0):!1};ti.unstable_batchedUpdates=WC;ti.unstable_renderSubtreeIntoContainer=function(n,e,t,s){if(!Fv(t))throw Error(ie(200));if(n==null||n._reactInternals===void 0)throw Error(ie(38));return Bv(n,e,t,!1,s)};ti.version="18.3.1-next-f1338f8080-20240426";function qO(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(qO)}catch(n){console.error(n)}}qO(),qR.exports=ti;var kr=qR.exports;const M9=Oa(kr);var ZC,_P=kr;ZC=Ab.createRoot=_P.createRoot,Ab.hydrateRoot=_P.hydrateRoot;var gu=function(n){return n&&n.Math===Math&&n},qn=gu(typeof globalThis=="object"&&globalThis)||gu(typeof window=="object"&&window)||gu(typeof self=="object"&&self)||gu(typeof Gn=="object"&&Gn)||gu(typeof Gn=="object"&&Gn)||function(){return this}()||Function("return this")(),JC={},Zn=function(n){try{return!!n()}catch{return!0}},O9=Zn,ko=!O9(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),D9=Zn,Uv=!D9(function(){var n=(function(){}).bind();return typeof n!="function"||n.hasOwnProperty("prototype")}),L9=Uv,Lf=Function.prototype.call,Ao=L9?Lf.bind(Lf):function(){return Lf.apply(Lf,arguments)},ZO={},JO={}.propertyIsEnumerable,QO=Object.getOwnPropertyDescriptor,F9=QO&&!JO.call({1:2},1);ZO.f=F9?function(e){var t=QO(this,e);return!!t&&t.enumerable}:JO;var QC=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}},e2=Uv,t2=Function.prototype,_0=t2.call,B9=e2&&t2.bind.bind(_0,_0),hn=e2?B9:function(n){return function(){return _0.apply(n,arguments)}},n2=hn,U9=n2({}.toString),$9=n2("".slice),Od=function(n){return $9(U9(n),8,-1)},z9=hn,W9=Zn,H9=Od,kS=Object,G9=z9("".split),V9=W9(function(){return!kS("z").propertyIsEnumerable(0)})?function(n){return H9(n)==="String"?G9(n,""):kS(n)}:kS,s2=function(n){return n==null},K9=s2,Y9=TypeError,Dd=function(n){if(K9(n))throw new Y9("Can't call method on "+n);return n},X9=V9,q9=Dd,$v=function(n){return X9(q9(n))},AS=typeof document=="object"&&document.all,ds=typeof AS>"u"&&AS!==void 0?function(n){return typeof n=="function"||n===AS}:function(n){return typeof n=="function"},Z9=ds,Ba=function(n){return typeof n=="object"?n!==null:Z9(n)},jS=qn,J9=ds,Q9=function(n){return J9(n)?n:void 0},zv=function(n,e){return arguments.length<2?Q9(jS[n]):jS[n]&&jS[n][e]},eH=hn,i2=eH({}.isPrototypeOf),tH=qn,CP=tH.navigator,EP=CP&&CP.userAgent,nH=EP?String(EP):"",r2=qn,NS=nH,TP=r2.process,IP=r2.Deno,PP=TP&&TP.versions||IP&&IP.version,kP=PP&&PP.v8,Di,ly;kP&&(Di=kP.split("."),ly=Di[0]>0&&Di[0]<4?1:+(Di[0]+Di[1]));!ly&&NS&&(Di=NS.match(/Edge\/(\d+)/),(!Di||Di[1]>=74)&&(Di=NS.match(/Chrome\/(\d+)/),Di&&(ly=+Di[1])));var sH=ly,AP=sH,iH=Zn,rH=qn,oH=rH.String,o2=!!Object.getOwnPropertySymbols&&!iH(function(){var n=Symbol("symbol detection");return!oH(n)||!(Object(n)instanceof Symbol)||!Symbol.sham&&AP&&AP<41}),aH=o2,a2=aH&&!Symbol.sham&&typeof Symbol.iterator=="symbol",lH=zv,cH=ds,dH=i2,uH=a2,hH=Object,l2=uH?function(n){return typeof n=="symbol"}:function(n){var e=lH("Symbol");return cH(e)&&dH(e.prototype,hH(n))},pH=String,fH=function(n){try{return pH(n)}catch{return"Object"}},gH=ds,mH=fH,yH=TypeError,eE=function(n){if(gH(n))return n;throw new yH(mH(n)+" is not a function")},vH=eE,xH=s2,tE=function(n,e){var t=n[e];return xH(t)?void 0:vH(t)},RS=Ao,MS=ds,OS=Ba,SH=TypeError,wH=function(n,e){var t,s;if(e==="string"&&MS(t=n.toString)&&!OS(s=RS(t,n))||MS(t=n.valueOf)&&!OS(s=RS(t,n))||e!=="string"&&MS(t=n.toString)&&!OS(s=RS(t,n)))return s;throw new SH("Can't convert object to primitive value")},c2={exports:{}},jP=qn,bH=Object.defineProperty,nE=function(n,e){try{bH(jP,n,{value:e,configurable:!0,writable:!0})}catch{jP[n]=e}return e},_H=qn,CH=nE,NP="__core-js_shared__",RP=c2.exports=_H[NP]||CH(NP,{});(RP.versions||(RP.versions=[])).push({version:"3.48.0",mode:"global",copyright:" 20132025 Denis Pushkarev (zloirock.ru), 20252026 CoreJS Company (core-js.io). All rights reserved.",license:"https://github.com/zloirock/core-js/blob/v3.48.0/LICENSE",source:"https://github.com/zloirock/core-js"});var sE=c2.exports,MP=sE,iE=function(n,e){return MP[n]||(MP[n]=e||{})},EH=Dd,TH=Object,Pp=function(n){return TH(EH(n))},IH=hn,PH=Pp,kH=IH({}.hasOwnProperty),Ua=Object.hasOwn||function(e,t){return kH(PH(e),t)},AH=hn,jH=0,NH=Math.random(),RH=AH(1.1.toString),d2=function(n){return"Symbol("+(n===void 0?"":n)+")_"+RH(++jH+NH,36)},MH=qn,OH=iE,OP=Ua,DH=d2,LH=o2,FH=a2,Mc=MH.Symbol,DS=OH("wks"),BH=FH?Mc.for||Mc:Mc&&Mc.withoutSetter||DH,jo=function(n){return OP(DS,n)||(DS[n]=LH&&OP(Mc,n)?Mc[n]:BH("Symbol."+n)),DS[n]},UH=Ao,DP=Ba,LP=l2,$H=tE,zH=wH,WH=jo,HH=TypeError,GH=WH("toPrimitive"),VH=function(n,e){if(!DP(n)||LP(n))return n;var t=$H(n,GH),s;if(t){if(e===void 0&&(e="default"),s=UH(t,n,e),!DP(s)||LP(s))return s;throw new HH("Can't convert object to primitive value")}return e===void 0&&(e="number"),zH(n,e)},KH=VH,YH=l2,u2=function(n){var e=KH(n,"string");return YH(e)?e:e+""},XH=qn,FP=Ba,C0=XH.document,qH=FP(C0)&&FP(C0.createElement),h2=function(n){return qH?C0.createElement(n):{}},ZH=ko,JH=Zn,QH=h2,p2=!ZH&&!JH(function(){return Object.defineProperty(QH("div"),"a",{get:function(){return 7}}).a!==7}),e7=ko,t7=Ao,n7=ZO,s7=QC,i7=$v,r7=u2,o7=Ua,a7=p2,BP=Object.getOwnPropertyDescriptor;JC.f=e7?BP:function(e,t){if(e=i7(e),t=r7(t),a7)try{return BP(e,t)}catch{}if(o7(e,t))return s7(!t7(n7.f,e,t),e[t])};var Yl={},l7=ko,c7=Zn,f2=l7&&c7(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),d7=Ba,u7=String,h7=TypeError,Xl=function(n){if(d7(n))return n;throw new h7(u7(n)+" is not an object")},p7=ko,f7=p2,g7=f2,Ff=Xl,UP=u2,m7=TypeError,LS=Object.defineProperty,y7=Object.getOwnPropertyDescriptor,FS="enumerable",BS="configurable",US="writable";Yl.f=p7?g7?function(e,t,s){if(Ff(e),t=UP(t),Ff(s),typeof e=="function"&&t==="prototype"&&"value"in s&&US in s&&!s[US]){var i=y7(e,t);i&&i[US]&&(e[t]=s.value,s={configurable:BS in s?s[BS]:i[BS],enumerable:FS in s?s[FS]:i[FS],writable:!1})}return LS(e,t,s)}:LS:function(e,t,s){if(Ff(e),t=UP(t),Ff(s),f7)try{return LS(e,t,s)}catch{}if("get"in s||"set"in s)throw new m7("Accessors not supported");return"value"in s&&(e[t]=s.value),e};var v7=ko,x7=Yl,S7=QC,rE=v7?function(n,e,t){return x7.f(n,e,S7(1,t))}:function(n,e,t){return n[e]=t,n},g2={exports:{}},E0=ko,w7=Ua,m2=Function.prototype,b7=E0&&Object.getOwnPropertyDescriptor,_7=w7(m2,"name"),C7=_7&&(!E0||E0&&b7(m2,"name").configurable),E7={CONFIGURABLE:C7},T7=hn,I7=ds,T0=sE,P7=T7(Function.toString);I7(T0.inspectSource)||(T0.inspectSource=function(n){return P7(n)});var y2=T0.inspectSource,k7=qn,A7=ds,$P=k7.WeakMap,j7=A7($P)&&/native code/.test(String($P)),N7=iE,R7=d2,zP=N7("keys"),v2=function(n){return zP[n]||(zP[n]=R7(n))},oE={},M7=j7,x2=qn,O7=rE,$S=Ua,zS=sE,D7=v2,L7=oE,WP="Object already initialized",HP=x2.TypeError,F7=x2.WeakMap,I0,cy,P0,B7=function(n){return P0(n)?cy(n):I0(n,{})};if(M7||zS.state){var rr=zS.state||(zS.state=new F7);rr.get=rr.get,rr.has=rr.has,rr.set=rr.set,I0=function(n,e){if(rr.has(n))throw new HP(WP);return e.facade=n,rr.set(n,e),e},cy=function(n){return rr.get(n)||{}},P0=function(n){return rr.has(n)}}else{var oc=D7("state");L7[oc]=!0,I0=function(n,e){if($S(n,oc))throw new HP(WP);return e.facade=n,O7(n,oc,e),e},cy=function(n){return $S(n,oc)?n[oc]:{}},P0=function(n){return $S(n,oc)}}var S2={get:cy,enforce:B7},aE=hn,U7=Zn,$7=ds,Bf=Ua,k0=ko,z7=E7.CONFIGURABLE,W7=y2,w2=S2,H7=w2.enforce,G7=w2.get,GP=String,Gg=Object.defineProperty,V7=aE("".slice),K7=aE("".replace),Y7=aE([].join),X7=k0&&!U7(function(){return Gg(function(){},"length",{value:8}).length!==8}),q7=String(String).split("String"),Z7=g2.exports=function(n,e,t){V7(GP(e),0,7)==="Symbol("&&(e="["+K7(GP(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),t&&t.getter&&(e="get "+e),t&&t.setter&&(e="set "+e),(!Bf(n,"name")||z7&&n.name!==e)&&(k0?Gg(n,"name",{value:e,configurable:!0}):n.name=e),X7&&t&&Bf(t,"arity")&&n.length!==t.arity&&Gg(n,"length",{value:t.arity});try{t&&Bf(t,"constructor")&&t.constructor?k0&&Gg(n,"prototype",{writable:!1}):n.prototype&&(n.prototype=void 0)}catch{}var s=H7(n);return Bf(s,"source")||(s.source=Y7(q7,typeof e=="string"?e:"")),n};Function.prototype.toString=Z7(function(){return $7(this)&&G7(this).source||W7(this)},"toString");var J7=g2.exports,Q7=ds,eG=Yl,tG=J7,nG=nE,b2=function(n,e,t,s){s||(s={});var i=s.enumerable,r=s.name!==void 0?s.name:e;if(Q7(t)&&tG(t,r,s),s.global)i?n[e]=t:nG(e,t);else{try{s.unsafe?n[e]&&(i=!0):delete n[e]}catch{}i?n[e]=t:eG.f(n,e,{value:t,enumerable:!1,configurable:!s.nonConfigurable,writable:!s.nonWritable})}return n},_2={},sG=Math.ceil,iG=Math.floor,rG=Math.trunc||function(e){var t=+e;return(t>0?iG:sG)(t)},oG=rG,ql=function(n){var e=+n;return e!==e||e===0?0:oG(e)},aG=ql,lG=Math.max,cG=Math.min,dG=function(n,e){var t=aG(n);return t<0?lG(t+e,0):cG(t,e)},uG=ql,hG=Math.min,C2=function(n){var e=uG(n);return e>0?hG(e,9007199254740991):0},pG=C2,kp=function(n){return pG(n.length)},fG=$v,gG=dG,mG=kp,yG=function(n){return function(e,t,s){var i=fG(e),r=mG(i);if(r===0)return!n&&-1;var o=gG(s,r),l;if(n&&t!==t){for(;r>o;)if(l=i[o++],l!==l)return!0}else for(;r>o;o++)if((n||o in i)&&i[o]===t)return n||o||0;return!n&&-1}},vG={indexOf:yG(!1)},xG=hn,WS=Ua,SG=$v,wG=vG.indexOf,bG=oE,VP=xG([].push),E2=function(n,e){var t=SG(n),s=0,i=[],r;for(r in t)!WS(bG,r)&&WS(t,r)&&VP(i,r);for(;e.length>s;)WS(t,r=e[s++])&&(~wG(i,r)||VP(i,r));return i},lE=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_G=E2,CG=lE,EG=CG.concat("length","prototype");_2.f=Object.getOwnPropertyNames||function(e){return _G(e,EG)};var T2={};T2.f=Object.getOwnPropertySymbols;var TG=zv,IG=hn,PG=_2,kG=T2,AG=Xl,jG=IG([].concat),NG=TG("Reflect","ownKeys")||function(e){var t=PG.f(AG(e)),s=kG.f;return s?jG(t,s(e)):t},KP=Ua,RG=NG,MG=JC,OG=Yl,DG=function(n,e,t){for(var s=RG(e),i=OG.f,r=MG.f,o=0;o<s.length;o++){var l=s[o];!KP(n,l)&&!(t&&KP(t,l))&&i(n,l,r(e,l))}},LG=Zn,FG=ds,BG=/#|\.prototype\./,Ap=function(n,e){var t=$G[UG(n)];return t===WG?!0:t===zG?!1:FG(e)?LG(e):!!e},UG=Ap.normalize=function(n){return String(n).replace(BG,".").toLowerCase()},$G=Ap.data={},zG=Ap.NATIVE="N",WG=Ap.POLYFILL="P",HG=Ap,Uf=qn,GG=JC.f,VG=rE,KG=b2,YG=nE,XG=DG,qG=HG,Ld=function(n,e){var t=n.target,s=n.global,i=n.stat,r,o,l,c,d,u;if(s?o=Uf:i?o=Uf[t]||YG(t,{}):o=Uf[t]&&Uf[t].prototype,o)for(l in e){if(d=e[l],n.dontCallGetSet?(u=GG(o,l),c=u&&u.value):c=o[l],r=qG(s?l:t+(i?".":"#")+l,n.forced),!r&&c!==void 0){if(typeof d==typeof c)continue;XG(d,c)}(n.sham||c&&c.sham)&&VG(d,"sham",!0),KG(o,l,d,n)}},I2={},ZG=E2,JG=lE,QG=Object.keys||function(e){return ZG(e,JG)},eV=ko,tV=f2,nV=Yl,sV=Xl,iV=$v,rV=QG;I2.f=eV&&!tV?Object.defineProperties:function(e,t){sV(e);for(var s=iV(t),i=rV(t),r=i.length,o=0,l;r>o;)nV.f(e,l=i[o++],s[l]);return e};var oV=zv,aV=oV("document","documentElement"),lV=Xl,cV=I2,YP=lE,dV=oE,uV=aV,hV=h2,pV=v2,XP=">",qP="<",A0="prototype",j0="script",P2=pV("IE_PROTO"),HS=function(){},k2=function(n){return qP+j0+XP+n+qP+"/"+j0+XP},ZP=function(n){n.write(k2("")),n.close();var e=n.parentWindow.Object;return n=null,e},fV=function(){var n=hV("iframe"),e="java"+j0+":",t;return n.style.display="none",uV.appendChild(n),n.src=String(e),t=n.contentWindow.document,t.open(),t.write(k2("document.F=Object")),t.close(),t.F},$f,Vg=function(){try{$f=new ActiveXObject("htmlfile")}catch{}Vg=typeof document<"u"?document.domain&&$f?ZP($f):fV():ZP($f);for(var n=YP.length;n--;)delete Vg[A0][YP[n]];return Vg()};dV[P2]=!0;var A2=Object.create||function(e,t){var s;return e!==null?(HS[A0]=lV(e),s=new HS,HS[A0]=null,s[P2]=e):s=Vg(),t===void 0?s:cV.f(s,t)},gV=jo,mV=A2,yV=Yl.f,N0=gV("unscopables"),R0=Array.prototype;R0[N0]===void 0&&yV(R0,N0,{configurable:!0,value:mV(null)});var cE=function(n){R0[N0][n]=!0},vV=Ld,xV=Pp,SV=kp,wV=ql,bV=cE;vV({target:"Array",proto:!0},{at:function(e){var t=xV(this),s=SV(t),i=wV(e),r=i>=0?i:s+i;return r<0||r>=s?void 0:t[r]}});bV("at");var _V=qn,CV=hn,jp=function(n,e){return CV(_V[n].prototype[e])},EV=jp;EV("Array","at");var TV=Od,j2=Array.isArray||function(e){return TV(e)==="Array"},IV=TypeError,PV=9007199254740991,kV=function(n){if(n>PV)throw IV("Maximum allowed index exceeded");return n},AV=Od,jV=hn,NV=function(n){if(AV(n)==="Function")return jV(n)},JP=NV,RV=eE,MV=Uv,OV=JP(JP.bind),DV=function(n,e){return RV(n),e===void 0?n:MV?OV(n,e):function(){return n.apply(e,arguments)}},LV=ko,FV=Yl,BV=QC,UV=function(n,e,t){LV?FV.f(n,e,BV(0,t)):n[e]=t},$V=j2,zV=kp,WV=kV,HV=DV,GV=UV,N2=function(n,e,t,s,i,r,o,l){for(var c=i,d=0,u=o?HV(o,l):!1,h,p;d<s;)d in t&&(h=u?u(t[d],d,e):t[d],r>0&&$V(h)?(p=zV(h),c=N2(n,e,h,p,c,r-1)-1):(WV(c+1),GV(n,c,h)),c++),d++;return c},R2=N2,VV=jo,KV=VV("toStringTag"),M2={};M2[KV]="z";var YV=String(M2)==="[object z]",XV=YV,qV=ds,Kg=Od,ZV=jo,JV=ZV("toStringTag"),QV=Object,eK=Kg(function(){return arguments}())==="Arguments",tK=function(n,e){try{return n[e]}catch{}},O2=XV?Kg:function(n){var e,t,s;return n===void 0?"Undefined":n===null?"Null":typeof(t=tK(e=QV(n),JV))=="string"?t:eK?Kg(e):(s=Kg(e))==="Object"&&qV(e.callee)?"Arguments":s},nK=hn,sK=Zn,D2=ds,iK=O2,rK=zv,oK=y2,L2=function(){},F2=rK("Reflect","construct"),dE=/^\s*(?:class|function)\b/,aK=nK(dE.exec),lK=!dE.test(L2),mu=function(e){if(!D2(e))return!1;try{return F2(L2,[],e),!0}catch{return!1}},B2=function(e){if(!D2(e))return!1;switch(iK(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return lK||!!aK(dE,oK(e))}catch{return!0}};B2.sham=!0;var cK=!F2||sK(function(){var n;return mu(mu.call)||!mu(Object)||!mu(function(){n=!0})||n})?B2:mu,QP=j2,dK=cK,uK=Ba,hK=jo,pK=hK("species"),ek=Array,fK=function(n){var e;return QP(n)&&(e=n.constructor,dK(e)&&(e===ek||QP(e.prototype))?e=void 0:uK(e)&&(e=e[pK],e===null&&(e=void 0))),e===void 0?ek:e},gK=fK,U2=function(n,e){return new(gK(n))(e===0?0:e)},mK=Ld,yK=R2,vK=eE,xK=Pp,SK=kp,wK=U2;mK({target:"Array",proto:!0},{flatMap:function(e){var t=xK(this),s=SK(t),i;return vK(e),i=wK(t,0),yK(i,t,t,s,0,1,e,arguments.length>1?arguments[1]:void 0),i}});var bK=cE;bK("flatMap");var _K=jp;_K("Array","flatMap");var CK=Ld,EK=R2,TK=Pp,IK=kp,PK=ql,kK=U2;CK({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=TK(this),s=IK(t),i=kK(t,0);return EK(i,t,t,s,0,e===void 0?1:PK(e)),i}});var AK=cE;AK("flat");var jK=jp;jK("Array","flat");var NK=O2,RK=String,Np=function(n){if(NK(n)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return RK(n)},MK=Ld,OK=hn,DK=Dd,LK=ql,FK=Np,BK=Zn,UK=OK("".charAt),$K=BK(function(){return"".at(-2)!=="\uD842"});MK({target:"String",proto:!0,forced:$K},{at:function(e){var t=FK(DK(this)),s=t.length,i=LK(e),r=i>=0?i:s+i;return r<0||r>=s?void 0:UK(t,r)}});var zK=jp;zK("String","at");var WK=Xl,$2=function(){var n=WK(this),e="";return n.hasIndices&&(e+="d"),n.global&&(e+="g"),n.ignoreCase&&(e+="i"),n.multiline&&(e+="m"),n.dotAll&&(e+="s"),n.unicode&&(e+="u"),n.unicodeSets&&(e+="v"),n.sticky&&(e+="y"),e},uE=Zn,HK=qn,hE=HK.RegExp,z2=uE(function(){var n=hE("a","y");return n.lastIndex=2,n.exec("abcd")!==null});z2||uE(function(){return!hE("a","y").sticky});var GK=z2||uE(function(){var n=hE("^r","gy");return n.lastIndex=2,n.exec("str")!==null}),VK={BROKEN_CARET:GK},KK=Zn,YK=qn,XK=YK.RegExp,qK=KK(function(){var n=XK(".","s");return!(n.dotAll&&n.test(`
`)&&n.flags==="s")}),ZK=Zn,JK=qn,QK=JK.RegExp,eY=ZK(function(){var n=QK("(?<a>b)","g");return n.exec("b").groups.a!=="b"||"b".replace(n,"$<a>c")!=="bc"}),Oc=Ao,Wv=hn,tY=Np,nY=$2,sY=VK,iY=iE,rY=A2,oY=S2.get,aY=qK,lY=eY,cY=iY("native-string-replace",String.prototype.replace),dy=RegExp.prototype.exec,M0=dy,dY=Wv("".charAt),uY=Wv("".indexOf),hY=Wv("".replace),GS=Wv("".slice),O0=function(){var n=/a/,e=/b*/g;return Oc(dy,n,"a"),Oc(dy,e,"a"),n.lastIndex!==0||e.lastIndex!==0}(),W2=sY.BROKEN_CARET,D0=/()??/.exec("")[1]!==void 0,pY=O0||D0||W2||aY||lY;pY&&(M0=function(e){var t=this,s=oY(t),i=tY(e),r=s.raw,o,l,c,d,u,h,p;if(r)return r.lastIndex=t.lastIndex,o=Oc(M0,r,i),t.lastIndex=r.lastIndex,o;var f=s.groups,g=W2&&t.sticky,m=Oc(nY,t),x=t.source,y=0,S=i;if(g&&(m=hY(m,"y",""),uY(m,"g")===-1&&(m+="g"),S=GS(i,t.lastIndex),t.lastIndex>0&&(!t.multiline||t.multiline&&dY(i,t.lastIndex-1)!==`
`)&&(x="(?: "+x+")",S=" "+S,y++),l=new RegExp("^(?:"+x+")",m)),D0&&(l=new RegExp("^"+x+"$(?!\\s)",m)),O0&&(c=t.lastIndex),d=Oc(dy,g?l:t,S),g?d?(d.input=GS(d.input,y),d[0]=GS(d[0],y),d.index=t.lastIndex,t.lastIndex+=d[0].length):t.lastIndex=0:O0&&d&&(t.lastIndex=t.global?d.index+d[0].length:c),D0&&d&&d.length>1&&Oc(cY,d[0],l,function(){for(u=1;u<arguments.length-2;u++)arguments[u]===void 0&&(d[u]=void 0)}),d&&f)for(d.groups=h=rY(null),u=0;u<f.length;u++)p=f[u],h[p[0]]=d[p[1]];return d});var pE=M0,fY=Ld,tk=pE;fY({target:"RegExp",proto:!0,forced:/./.exec!==tk},{exec:tk});var gY=Uv,H2=Function.prototype,nk=H2.apply,sk=H2.call,mY=typeof Reflect=="object"&&Reflect.apply||(gY?sk.bind(nk):function(){return sk.apply(nk,arguments)}),ik=Ao,rk=b2,yY=pE,ok=Zn,G2=jo,vY=rE,xY=G2("species"),VS=RegExp.prototype,SY=function(n,e,t,s){var i=G2(n),r=!ok(function(){var d={};return d[i]=function(){return 7},""[n](d)!==7}),o=r&&!ok(function(){var d=!1,u=/a/;if(n==="split"){var h={};h[xY]=function(){return u},u={constructor:h,flags:""},u[i]=/./[i]}return u.exec=function(){return d=!0,null},u[i](""),!d});if(!r||!o||t){var l=/./[i],c=e(i,""[n],function(d,u,h,p,f){var g=u.exec;return g===yY||g===VS.exec?r&&!f?{done:!0,value:ik(l,u,h,p)}:{done:!0,value:ik(d,h,u,p)}:{done:!1}});rk(String.prototype,n,c[0]),rk(VS,i,c[1])}s&&vY(VS[i],"sham",!0)},fE=hn,wY=ql,bY=Np,_Y=Dd,CY=fE("".charAt),ak=fE("".charCodeAt),EY=fE("".slice),TY=function(n){return function(e,t){var s=bY(_Y(e)),i=wY(t),r=s.length,o,l;return i<0||i>=r?n?"":void 0:(o=ak(s,i),o<55296||o>56319||i+1===r||(l=ak(s,i+1))<56320||l>57343?n?CY(s,i):o:n?EY(s,i,i+2):(o-55296<<10)+(l-56320)+65536)}},IY={charAt:TY(!0)},PY=IY.charAt,kY=function(n,e,t){return e+(t?PY(n,e).length:1)},gE=hn,AY=Pp,jY=Math.floor,KS=gE("".charAt),NY=gE("".replace),YS=gE("".slice),RY=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,MY=/\$([$&'`]|\d{1,2})/g,V2=function(n,e,t,s,i,r){var o=t+n.length,l=s.length,c=MY;return i!==void 0&&(i=AY(i),c=RY),NY(r,c,function(d,u){var h;switch(KS(u,0)){case"$":return"$";case"&":return n;case"`":return YS(e,0,t);case"'":return YS(e,o);case"<":h=i[YS(u,1,-1)];break;default:var p=+u;if(p===0)return d;if(p>l){var f=jY(p/10);return f===0?d:f<=l?s[f-1]===void 0?KS(u,1):s[f-1]+KS(u,1):d}h=s[p-1]}return h===void 0?"":h})},OY=qn,DY=Zn,lk=OY.RegExp,LY=!DY(function(){var n=!0;try{lk(".","d")}catch{n=!1}var e={},t="",s=n?"dgimsy":"gimsy",i=function(c,d){Object.defineProperty(e,c,{get:function(){return t+=d,!0}})},r={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};n&&(r.hasIndices="d");for(var o in r)i(o,r[o]);var l=Object.getOwnPropertyDescriptor(lk.prototype,"flags").get.call(e);return l!==s||t!==s}),FY={correct:LY},BY=Ao,UY=Ua,$Y=i2,ck=FY,zY=$2,WY=RegExp.prototype,K2=ck.correct?function(n){return n.flags}:function(n){return!ck.correct&&$Y(WY,n)&&!UY(n,"flags")?BY(zY,n):n.flags},dk=Ao,HY=Xl,GY=ds,VY=Od,KY=pE,YY=TypeError,XY=function(n,e){var t=n.exec;if(GY(t)){var s=dk(t,n,e);return s!==null&&HY(s),s}if(VY(n)==="RegExp")return dk(KY,n,e);throw new YY("RegExp#exec called on incompatible receiver")},qY=mY,uk=Ao,Hv=hn,ZY=SY,JY=Zn,QY=Xl,eX=ds,tX=Ba,nX=ql,sX=C2,tl=Np,iX=Dd,rX=kY,oX=tE,aX=V2,lX=K2,cX=XY,dX=jo,L0=dX("replace"),uX=Math.max,hX=Math.min,pX=Hv([].concat),XS=Hv([].push),zf=Hv("".indexOf),hk=Hv("".slice),fX=function(n){return n===void 0?n:String(n)},gX=function(){return"a".replace(/./,"$0")==="$0"}(),pk=function(){return/./[L0]?/./[L0]("a","$0")==="":!1}(),mX=!JY(function(){var n=/./;return n.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(n,"$<a>")!=="7"});ZY("replace",function(n,e,t){var s=pk?"$":"$0";return[function(r,o){var l=iX(this),c=tX(r)?oX(r,L0):void 0;return c?uk(c,r,l,o):uk(e,tl(l),r,o)},function(i,r){var o=QY(this),l=tl(i);if(typeof r=="string"&&zf(r,s)===-1&&zf(r,"$<")===-1){var c=t(e,o,l,r);if(c.done)return c.value}var d=eX(r);d||(r=tl(r));var u=tl(lX(o)),h=zf(u,"g")!==-1,p;h&&(p=zf(u,"u")!==-1,o.lastIndex=0);for(var f=[],g;g=cX(o,l),!(g===null||(XS(f,g),!h));){var m=tl(g[0]);m===""&&(o.lastIndex=rX(l,sX(o.lastIndex),p))}for(var x="",y=0,S=0;S<f.length;S++){g=f[S];for(var v=tl(g[0]),C=uX(hX(nX(g.index),l.length),0),T=[],I,E=1;E<g.length;E++)XS(T,fX(g[E]));var P=g.groups;if(d){var k=pX([v],T,C,l);P!==void 0&&XS(k,P),I=tl(qY(r,void 0,k))}else I=aX(v,l,C,T,P,r);C>=y&&(x+=hk(l,y,C)+I,y=C+v.length)}return x+hk(l,y)}]},!mX||!gX||pk);var yX=Ba,vX=Od,xX=jo,SX=xX("match"),wX=function(n){var e;return yX(n)&&((e=n[SX])!==void 0?!!e:vX(n)==="RegExp")},bX=Ld,_X=Ao,mE=hn,fk=Dd,CX=ds,EX=Ba,TX=wX,yu=Np,IX=tE,PX=K2,kX=V2,AX=jo,jX=AX("replace"),NX=TypeError,qS=mE("".indexOf);mE("".replace);var gk=mE("".slice),RX=Math.max;bX({target:"String",proto:!0},{replaceAll:function(e,t){var s=fk(this),i,r,o,l,c,d,u,h,p,f,g=0,m="";if(EX(e)){if(i=TX(e),i&&(r=yu(fk(PX(e))),!~qS(r,"g")))throw new NX("`.replaceAll` does not allow non-global regexes");if(o=IX(e,jX),o)return _X(o,e,s,t)}for(l=yu(s),c=yu(e),d=CX(t),d||(t=yu(t)),u=c.length,h=RX(1,u),p=qS(l,c);p!==-1;)f=d?yu(t(c,p,l)):kX(c,l,p,[],void 0,t),m+=gk(l,g,p)+f,g=p+u,p=p+h>l.length?-1:qS(l,c,p+h);return g<l.length&&(m+=gk(l,g)),m}});var MX=jp;MX("String","replaceAll");function Y2(n){return n&&typeof n=="object"&&"parents"in n}function X2(n){for(let e=0,t=n.parents.length;e<t;e++)if(n.parents[e].__unsafe__getWithoutCapture(!0),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}const uy=(n,e)=>{if(n.children.remove(e)&&n.children.isEmpty&&Y2(n))for(let t=0,s=n.parents.length;t<s;t++)uy(n.parents[t],n)},yE=(n,e)=>{if(n.children.add(e)&&Y2(n))for(let t=0,s=n.parents.length;t<s;t++)yE(n.parents[t],n)};function q2(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function $a(n,e){const t=Symbol.for(`com.tldraw.state/${n}`),s=globalThis;return s[t]??(s[t]=e()),s[t]}const co=$a("empty_array",()=>Object.freeze([])),mk=8;class hy{constructor(){w(this,"arraySize",0);w(this,"array",Array(mk));w(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<mk?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const s=this.array[t];typeof s<"u"&&e(s)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const Ks=Symbol.for("com.tldraw.state/RESET_VALUE");class Z2{constructor(e){w(this,"index",0);w(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,s){if(s!==void 0){if(s===Ks){this.clear();return}this.buffer[this.index]=[e,t,s],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:s,buffer:i}=this;for(let r=0;r<s;r++){const o=(t-1+s-r)%s,l=i[o];if(!l)return Ks;const[c,d]=l;if(r===0&&e>=d)return[];if(c<=e&&e<d){const u=r+1,h=new Array(u);for(let p=0;p<u;p++)h[p]=i[(o+p)%s][2];return h}}return Ks}}class OX{constructor(e,t){w(this,"offset",0);w(this,"maybeRemoved");this.below=e,this.child=t}}const Tt=$a("capture",()=>({stack:null}));function Wf(n){const e=Tt.stack;Tt.stack=null;try{return n()}finally{Tt.stack=e}}function J2(n){Tt.stack=new OX(Tt.stack,n),n.parentSet.clear()}function Q2(){const n=Tt.stack;if(Tt.stack=n.below,n.offset<n.child.parents.length){for(let e=n.offset;e<n.child.parents.length;e++){const t=n.child.parents[e];n.child.parentSet.has(t)||uy(t,n.child)}n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset}if(n.maybeRemoved)for(let e=0;e<n.maybeRemoved.length;e++){const t=n.maybeRemoved[e];n.child.parentSet.has(t)||uy(t,n.child)}}function py(n){if(Tt.stack){if(Tt.stack.child.parentSet.has(n))return;if(Tt.stack.child.parentSet.add(n),Tt.stack.child.isActivelyListening&&yE(n,Tt.stack.child),Tt.stack.offset<Tt.stack.child.parents.length){const t=Tt.stack.child.parents[Tt.stack.offset];t!==n&&(Tt.stack.maybeRemoved?Tt.stack.maybeRemoved.push(t):Tt.stack.maybeRemoved=[t])}Tt.stack.child.parents[Tt.stack.offset]=n,Tt.stack.child.parentEpochs[Tt.stack.offset]=n.lastChangedEpoch,Tt.stack.offset++}}const aa=-1;class DX{constructor(e,t,s){w(this,"_isActivelyListening",!1);w(this,"lastTraversedEpoch",aa);w(this,"lastReactedEpoch",aa);w(this,"_scheduleCount",0);w(this,"parentSet",new hy);w(this,"parentEpochs",[]);w(this,"parents",[]);w(this,"_scheduleEffect");w(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=s==null?void 0:s.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==xs()){if(this.parents.length&&!X2(this)){this.lastReactedEpoch=xs();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)yE(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)uy(this.parents[e],this)}execute(){try{J2(this);const e=xs(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{Q2()}}}const Fd=$a("EffectScheduler",()=>DX);function Zl(n,e,t){const s=new Fd(n,e,t);return s.attach(),s.scheduleEffect(),()=>{s.detach()}}function LX(n,e,t){const s=new Fd(n,e,t);return{scheduler:s,start:i=>{const r=(i==null?void 0:i.force)??!1;s.attach(),r?s.scheduleEffect():s.maybeScheduleEffect()},stop:()=>{s.detach()}}}class FX{constructor(e){w(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){this.isRoot?eD(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){ot.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{var s;t.set(e),(s=t.historyBuffer)==null||s.clear()}),this.commit()}}const ot=$a("transactions",()=>({globalEpoch:aa+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:aa+1}));function BX(){return ot.reactionEpoch}function xs(){return ot.globalEpoch}function UX(){return ot.globalIsReacting}function vE(n,e){e.lastTraversedEpoch!==ot.globalEpoch&&(e.lastTraversedEpoch=ot.globalEpoch,e instanceof Fd?n.add(e):e.children.visit(t=>vE(n,t)))}function eD(n){var e;if(ot.globalIsReacting)throw new Error("cannot change atoms during reaction cycle");try{ot.globalIsReacting=!0,ot.reactionEpoch=ot.globalEpoch;const t=new Set;for(const i of n)i.children.visit(r=>vE(t,r));for(const i of t)i.maybeScheduleEffect();let s=0;for(;(e=ot.cleanupReactors)!=null&&e.size;){if(s++>1e3)throw new Error("Reaction update depth limit exceeded");const i=ot.cleanupReactors;ot.cleanupReactors=null;for(const r of i)r.maybeScheduleEffect()}}finally{ot.cleanupReactors=null,ot.globalIsReacting=!1}}function $X(n,e){if(ot.globalIsReacting){const t=ot.cleanupReactors??(ot.cleanupReactors=new Set);n.children.visit(s=>vE(t,s))}else ot.currentTransaction?ot.currentTransaction.initialAtomValues.has(n)||ot.currentTransaction.initialAtomValues.set(n,e):eD([n])}function zX(){ot.globalEpoch++}function WX(n){const e=new FX(ot.currentTransaction);ot.currentTransaction=e;try{let t,s=!1;try{t=n(()=>s=!0)}catch(i){throw e.abort(),i}return s?e.abort():e.commit(),t}finally{ot.currentTransaction=ot.currentTransaction.parent}}function _r(n){return ot.currentTransaction?n():WX(n)}class HX{constructor(e,t,s){w(this,"isEqual");w(this,"computeDiff");w(this,"lastChangedEpoch",xs());w(this,"children",new hy);w(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(s==null?void 0:s.isEqual)??null,s&&(s.historyLength&&(this.historyBuffer=new Z2(s.historyLength)),this.computeDiff=s.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return py(this),this.current}set(e,t){var i,r;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,e))??q2(this.current,e))return this.current;zX(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,xs(),t??((r=this.computeDiff)==null?void 0:r.call(this,this.current,e,this.lastChangedEpoch,xs()))??Ks),this.lastChangedEpoch=xs();const s=this.current;return this.current=e,$X(this,s),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return py(this),e>=this.lastChangedEpoch?co:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??Ks}}const GX=$a("Atom",()=>HX);function an(n,e,t){return new GX(n,e,t)}let yk=!1;function VX(){yk||(yk=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const Hu=Symbol.for("com.tldraw.state/UNINITIALIZED"),Sl=n=>n===Hu,F0=$a("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function Gu(n,e){return new F0(n,e)}class KX{constructor(e,t,s){w(this,"lastChangedEpoch",aa);w(this,"lastTraversedEpoch",aa);w(this,"lastCheckedEpoch",aa);w(this,"parentSet",new hy);w(this,"parents",[]);w(this,"parentEpochs",[]);w(this,"children",new hy);w(this,"historyBuffer");w(this,"state",Hu);w(this,"error",null);w(this,"computeDiff");w(this,"isEqual");this.name=e,this.derive=t,s!=null&&s.historyLength&&(this.historyBuffer=new Z2(s.historyLength)),this.computeDiff=s==null?void 0:s.computeDiff,this.isEqual=(s==null?void 0:s.isEqual)??q2}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var i;const t=this.lastChangedEpoch===aa,s=xs();if(!t&&(this.lastCheckedEpoch===s||this.isActivelyListening&&UX()&&this.lastTraversedEpoch<BX()||!X2(this)))if(this.lastCheckedEpoch=s,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{J2(this);const r=this.derive(this.state,this.lastCheckedEpoch),o=r instanceof F0?r.value:r,l=this.state===Hu;if(l||!this.isEqual(o,this.state)){if(this.historyBuffer&&!l){const c=r instanceof F0?r.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,xs(),c??((i=this.computeDiff)==null?void 0:i.call(this,this.state,o,this.lastCheckedEpoch,xs()))??Ks)}this.lastChangedEpoch=xs(),this.state=o}return this.error=null,this.lastCheckedEpoch=xs(),this.state}catch(r){if(this.state!==Hu&&(this.state=Hu,this.lastChangedEpoch=xs()),this.lastCheckedEpoch=xs(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:r},!e)throw r;return this.state}finally{Q2()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{py(this)}}getDiffSince(e){var t;return this.__unsafe__getWithoutCapture(!0),py(this),e>=this.lastChangedEpoch?co:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??Ks}}const xE=$a("Computed",()=>KX);function YX(n={},e,t,s){const i=s.value,r=Symbol.for("__@tldraw/state__computed__"+t);return s.value=function(){let o=this[r];return o||(o=new xE(t,i.bind(this),n),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},s.value[qX]=!0,s}function vk(n={},e,t,s){return s.get?(VX(),XX(n,e,t,s)):YX(n,e,t,s)}function XX(n={},e,t,s){const i=s.get,r=Symbol.for("__@tldraw/state__computed__"+t);return s.get=function(){let o=this[r];return o||(o=new xE(t,i.bind(this),n),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},s}const qX="@@__isComputedMethod__@@";function Q(){if(arguments.length===1){const n=arguments[0];return(e,t,s)=>vk(n,e,t,s)}else return typeof arguments[0]=="string"?new xE(arguments[0],arguments[1],arguments[2]):vk(void 0,arguments[0],arguments[1],arguments[2])}const tD=1,ZX=$a("apiVersion",()=>tD);if(ZX!==tD)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");var nD="Expected a function",xk=NaN,JX="[object Symbol]",QX=/^\s+|\s+$/g,eq=/^[-+]0x[0-9a-f]+$/i,tq=/^0b[01]+$/i,nq=/^0o[0-7]+$/i,sq=parseInt,iq=typeof Gn=="object"&&Gn&&Gn.Object===Object&&Gn,rq=typeof self=="object"&&self&&self.Object===Object&&self,oq=iq||rq||Function("return this")(),aq=Object.prototype,lq=aq.toString,cq=Math.max,dq=Math.min,ZS=function(){return oq.Date.now()};function uq(n,e,t){var s,i,r,o,l,c,d=0,u=!1,h=!1,p=!0;if(typeof n!="function")throw new TypeError(nD);e=Sk(e)||0,fy(t)&&(u=!!t.leading,h="maxWait"in t,r=h?cq(Sk(t.maxWait)||0,e):r,p="trailing"in t?!!t.trailing:p);function f(I){var E=s,P=i;return s=i=void 0,d=I,o=n.apply(P,E),o}function g(I){return d=I,l=setTimeout(y,e),u?f(I):o}function m(I){var E=I-c,P=I-d,k=e-E;return h?dq(k,r-P):k}function x(I){var E=I-c,P=I-d;return c===void 0||E>=e||E<0||h&&P>=r}function y(){var I=ZS();if(x(I))return S(I);l=setTimeout(y,m(I))}function S(I){return l=void 0,p&&s?f(I):(s=i=void 0,o)}function v(){l!==void 0&&clearTimeout(l),d=0,s=c=i=l=void 0}function C(){return l===void 0?o:S(ZS())}function T(){var I=ZS(),E=x(I);if(s=arguments,i=this,c=I,E){if(l===void 0)return g(c);if(h)return l=setTimeout(y,e),f(c)}return l===void 0&&(l=setTimeout(y,e)),o}return T.cancel=v,T.flush=C,T}function hq(n,e,t){var s=!0,i=!0;if(typeof n!="function")throw new TypeError(nD);return fy(t)&&(s="leading"in t?!!t.leading:s,i="trailing"in t?!!t.trailing:i),uq(n,e,{leading:s,maxWait:e,trailing:i})}function fy(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function pq(n){return!!n&&typeof n=="object"}function fq(n){return typeof n=="symbol"||pq(n)&&lq.call(n)==JX}function Sk(n){if(typeof n=="number")return n;if(fq(n))return xk;if(fy(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=fy(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(QX,"");var t=tq.test(n);return t||nq.test(n)?sq(n.slice(2),t?2:8):eq.test(n)?xk:+n}var gq=hq;const sD=Oa(gq);var mq=200,SE="__lodash_hash_undefined__",yq=1/0,vq="[object Function]",xq="[object GeneratorFunction]",Sq=/[\\^$.*+?()[\]{}|]/g,wq=/^\[object .+?Constructor\]$/,bq=typeof Gn=="object"&&Gn&&Gn.Object===Object&&Gn,_q=typeof self=="object"&&self&&self.Object===Object&&self,wE=bq||_q||Function("return this")();function Cq(n,e){var t=n?n.length:0;return!!t&&Tq(n,e,0)>-1}function Eq(n,e,t,s){for(var i=n.length,r=t+-1;++r<i;)if(e(n[r],r,n))return r;return-1}function Tq(n,e,t){if(e!==e)return Eq(n,Iq,t);for(var s=t-1,i=n.length;++s<i;)if(n[s]===e)return s;return-1}function Iq(n){return n!==n}function Pq(n,e){return n.has(e)}function kq(n,e){return n==null?void 0:n[e]}function Aq(n){var e=!1;if(n!=null&&typeof n.toString!="function")try{e=!!(n+"")}catch{}return e}function iD(n){var e=-1,t=Array(n.size);return n.forEach(function(s){t[++e]=s}),t}var jq=Array.prototype,Nq=Function.prototype,rD=Object.prototype,JS=wE["__core-js_shared__"],wk=function(){var n=/[^.]+$/.exec(JS&&JS.keys&&JS.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),oD=Nq.toString,bE=rD.hasOwnProperty,Rq=rD.toString,Mq=RegExp("^"+oD.call(bE).replace(Sq,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Oq=jq.splice,Dq=_E(wE,"Map"),QS=_E(wE,"Set"),Jh=_E(Object,"create");function Pl(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}function Lq(){this.__data__=Jh?Jh(null):{}}function Fq(n){return this.has(n)&&delete this.__data__[n]}function Bq(n){var e=this.__data__;if(Jh){var t=e[n];return t===SE?void 0:t}return bE.call(e,n)?e[n]:void 0}function Uq(n){var e=this.__data__;return Jh?e[n]!==void 0:bE.call(e,n)}function $q(n,e){var t=this.__data__;return t[n]=Jh&&e===void 0?SE:e,this}Pl.prototype.clear=Lq;Pl.prototype.delete=Fq;Pl.prototype.get=Bq;Pl.prototype.has=Uq;Pl.prototype.set=$q;function Bd(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}function zq(){this.__data__=[]}function Wq(n){var e=this.__data__,t=Gv(e,n);if(t<0)return!1;var s=e.length-1;return t==s?e.pop():Oq.call(e,t,1),!0}function Hq(n){var e=this.__data__,t=Gv(e,n);return t<0?void 0:e[t][1]}function Gq(n){return Gv(this.__data__,n)>-1}function Vq(n,e){var t=this.__data__,s=Gv(t,n);return s<0?t.push([n,e]):t[s][1]=e,this}Bd.prototype.clear=zq;Bd.prototype.delete=Wq;Bd.prototype.get=Hq;Bd.prototype.has=Gq;Bd.prototype.set=Vq;function Ud(n){var e=-1,t=n?n.length:0;for(this.clear();++e<t;){var s=n[e];this.set(s[0],s[1])}}function Kq(){this.__data__={hash:new Pl,map:new(Dq||Bd),string:new Pl}}function Yq(n){return Vv(this,n).delete(n)}function Xq(n){return Vv(this,n).get(n)}function qq(n){return Vv(this,n).has(n)}function Zq(n,e){return Vv(this,n).set(n,e),this}Ud.prototype.clear=Kq;Ud.prototype.delete=Yq;Ud.prototype.get=Xq;Ud.prototype.has=qq;Ud.prototype.set=Zq;function gy(n){var e=-1,t=n?n.length:0;for(this.__data__=new Ud;++e<t;)this.add(n[e])}function Jq(n){return this.__data__.set(n,SE),this}function Qq(n){return this.__data__.has(n)}gy.prototype.add=gy.prototype.push=Jq;gy.prototype.has=Qq;function Gv(n,e){for(var t=n.length;t--;)if(aZ(n[t][0],e))return t;return-1}function eZ(n){if(!aD(n)||iZ(n))return!1;var e=lZ(n)||Aq(n)?Mq:wq;return e.test(rZ(n))}function tZ(n,e,t){var s=-1,i=Cq,r=n.length,o=!0,l=[],c=l;if(r>=mq){var d=nZ(n);if(d)return iD(d);o=!1,i=Pq,c=new gy}else c=l;e:for(;++s<r;){var u=n[s],h=u;if(u=u!==0?u:0,o&&h===h){for(var p=c.length;p--;)if(c[p]===h)continue e;l.push(u)}else i(c,h,t)||(c!==l&&c.push(h),l.push(u))}return l}var nZ=QS&&1/iD(new QS([,-0]))[1]==yq?function(n){return new QS(n)}:cZ;function Vv(n,e){var t=n.__data__;return sZ(e)?t[typeof e=="string"?"string":"hash"]:t.map}function _E(n,e){var t=kq(n,e);return eZ(t)?t:void 0}function sZ(n){var e=typeof n;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?n!=="__proto__":n===null}function iZ(n){return!!wk&&wk in n}function rZ(n){if(n!=null){try{return oD.call(n)}catch{}try{return n+""}catch{}}return""}function oZ(n){return n&&n.length?tZ(n):[]}function aZ(n,e){return n===e||n!==n&&e!==e}function lZ(n){var e=aD(n)?Rq.call(n):"";return e==vq||e==xq}function aD(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function cZ(){}var dZ=oZ;const uZ=Oa(dZ),Vu={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},hZ=Vu.Good;class lD{constructor(){w(this,"startTime",0);w(this,"name","");w(this,"frames",0);w(this,"started",!1);w(this,"frame",null);w(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,t=e===0?0:Math.floor(this.frames/e),s=t>55?Vu.Good:t>30?Vu.Mid:Vu.Poor,i=s===Vu.Mid?"black":"white",r=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${r} %c${t}%c fps`,`color: white; background: ${hZ};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${s};color: ${i};`,"font-weight: normal")}isStarted(){return this.started}}function CE(n,e){const t=[];e:for(const s of n){for(const i of t)if(e?e(s,i):s===i)continue e;t.push(s)}return t}function Ne(n){return n.filter(e=>e!=null)}function wn(n){return n[n.length-1]}function pZ(n,e){let t,s=1/0;for(const i of n){const r=e(i);r<s&&(t=i,s=r)}return t}function fZ(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Object.is(n[t],e[t]))return!1;return!0}class xo{constructor(){w(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function cD(n){const e=(...t)=>{try{return n(...t)}catch(s){throw s instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(s,e),s}};return e}const Qh=()=>{},xa={ok(n){return{ok:!0,value:n}},err(n){return{ok:!1,error:n}}};function Vn(n,e){const t=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${t}`)}const mt=cD((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),pi=cD((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function dD(n,e){let t;const s=(...i)=>(t||(t={},t.promise=new Promise((r,o)=>{t.resolve=r,t.reject=o})),clearTimeout(t.timeout),t.latestArgs=i,t.timeout=setTimeout(()=>{const r=t;t=void 0;try{r.resolve(n(...r.latestArgs))}catch(o){r.reject(o)}},e),t.promise);return s.cancel=()=>{t&&clearTimeout(t.timeout)},s}const bk=new WeakMap;function EE(n,e){if(typeof n!="object"||n===null)return;let t=bk.get(n);t||(t={tags:{},extras:{}},bk.set(n,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}async function Ar(n,e){return window.fetch(n,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const md=(n,e)=>{const t=new window.Image(n,e);return t.referrerPolicy="strict-origin-when-cross-origin",t};class wl{static async dataUrlToArrayBuffer(e){return Ar(e).then(function(t){return t.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((t,s)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=r=>s(r),i.onabort=r=>s(r),i.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,s)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=r=>s(r),i.onabort=r=>s(r),i.readAsText(e)}})}}function B0(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e+""}function gZ(n){const e=new DataView(n);let t=0;for(let s=0;s<e.byteLength;s++)t=(t<<5)-t+e.getUint8(s),t|=0;return t+""}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function mZ(n){const e=new Uint8Array(n);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function s(r,o,l,c,d=1024){if(!o)return-1;o=new RegExp(o,"g");const u=o.source.length,h=new TextDecoder,p=r.length;if(typeof c>"u"&&(c=p),l>=p||c<=0||l>=c)return-1;r=r.subarray(l,c);let f=-1,g=0,m=0,x="";e:for(;g<r.length;){const y=g+d,S=r.subarray(g,y),v=h.decode(S,{stream:!0}),C=x+v;let T,I=-1;for(;(T=o.exec(C))!==null;){I=T.index-x.length,f=m+I;break e}g=y,m+=v.length;const E=I>-1?I+u:v.length-u;x=v.slice(E)}return f>=0&&(f+=l>=0?l:p+l),f}const i=s(e,"IDAT",12);return i>=12?s(e,"acTL",8,i)>=8:!1}const yZ=n=>new Uint8Array(n)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Jzef Sokoowski <j.k.sokolowski@gmail.com>
 */function _k(n,e){let t=0;for(;n[e+t];)t+=n[e+t]+1;return t+1}function vZ(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function xZ(n){const e=new Uint8Array(n);let t,s,i=0,r=0;if(!vZ(n))return!1;for(t=e[10]&128,s=e[10]&7,i+=6,i+=7,i+=t?3*Math.pow(2,s+1):0;r<2&&i<e.length;)switch(e[i]){case 44:r+=1,t=e[i+9]&128,s=e[i+9]&7,i+=10,i+=t?3*Math.pow(2,s+1):0,i+=_k(e,i+1)+1;break;case 33:i+=2,i+=_k(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return r>1}let U0=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(U0=new Int32Array(U0));/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */const SZ=(n,e)=>{let t=-1;for(let s=0;s<n.length;s++)t=U0[(t^n[s])&255]^t>>>8;return t^-1},Ck=4,Ek=4;class pr{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const s={};if(!pr.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const i=t,r=e.getInt32(t);t+=4;const o=pr.getChunkType(e,t);if(o==="IDAT"&&s[o]){t+=r+Ck+Ek;continue}if(o==="IEND")break;s[o]={start:i,dataOffset:t+4,size:r},t+=r+Ck+Ek}return s}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return pr.readChunks(e)[t]}static setPhysChunk(e,t=1,s){let i=46,r=0;const o=pr.findChunk(e,"pHYs");o&&(i=o.start,r=o.size);const l=pr.findChunk(e,"IDAT");l&&(i=l.start,r=0);const c=new ArrayBuffer(21),d=new DataView(c);d.setUint32(0,9),d.setUint8(4,112),d.setUint8(5,72),d.setUint8(6,89),d.setUint8(7,115);const u=2835.5;d.setInt32(8,u*t),d.setInt32(12,u*t),d.setInt8(16,1);const h=new Uint8Array(c.slice(4,17));d.setInt32(17,SZ(h));const p=e.buffer.slice(0,i),f=e.buffer.slice(i+r);return new Blob([p,c,f],s)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function wZ(n){return!n||n.length<12?!1:n[8]===87&&n[9]===69&&n[10]===66&&n[11]===80}function bZ(n){const e=new Uint8Array(n);return!wZ(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const uD=Object.freeze(["image/svg+xml"]),hD=Object.freeze(["image/jpeg","image/png","image/webp"]),pD=Object.freeze(["image/gif","image/apng","image/avif"]),TE=Object.freeze([...hD,...uD,...pD]),fD=Object.freeze(["video/mp4","video/webm","video/quicktime"]),_Z=[...TE,...fD].join(",");class gr{static loadVideo(e){return new Promise((t,s)=>{const i=document.createElement("video");i.onloadeddata=()=>t(i),i.onerror=r=>{console.error(r),s(new Error("Could not load video"))},i.crossOrigin="anonymous",i.src=e})}static loadImage(e){return new Promise((t,s)=>{const i=md();i.onload=()=>t(i),i.onerror=r=>{console.error(r),s(new Error("Could not load image"))},i.crossOrigin="anonymous",i.referrerPolicy="strict-origin-when-cross-origin",i.src=e})}static async getVideoSize(e){return gr.usingObjectURL(e,async t=>{const s=await gr.loadVideo(t);return{w:s.videoWidth,h:s.videoHeight}})}static async getImageSize(e){const t=await gr.usingObjectURL(e,gr.loadImage);try{if(e.type==="image/png"){const s=new DataView(await e.arrayBuffer());if(pr.isPng(s,0)){const i=pr.findChunk(s,"pHYs");if(i){const r=pr.parsePhys(s,i.dataOffset);if(r.unit===0&&r.ppux===r.ppuy){const o=Math.max(r.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/o),h:Math.round(t.naturalHeight/o)}}}}}}catch(s){return console.error(s),{w:t.naturalWidth,h:t.naturalHeight}}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?xZ(await e.arrayBuffer()):e.type==="image/avif"?yZ(await e.arrayBuffer()):e.type==="image/webp"?bZ(await e.arrayBuffer()):e.type==="image/apng"?mZ(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return pD.includes(e||"")}static isStaticImageType(e){return hD.includes(e||"")}static isVectorImageType(e){return uD.includes(e||"")}static isImageType(e){return TE.includes(e)}static async usingObjectURL(e,t){const s=URL.createObjectURL(e);try{return await t(s)}finally{URL.revokeObjectURL(s)}}}function bs(n,e,t){return n+(e-n)*t}function Zi(n=""){let e=0,t=0,s=0,i=0;function r(){const o=e^e<<11;return e=t,t=s,s=i,i^=(i>>>19^o^o>>>8)>>>0,i/4294967296*2}for(let o=0;o<n.length+64;o++)e^=n.charCodeAt(o)|0,r();return r}function yd(n,e,t,s=!1){const[i,r]=e,[o,l]=t,c=o+(n-i)/(r-i)*(l-o);return s?o<l?Math.max(Math.min(c,l),o):Math.max(Math.min(c,o),l):c}function Cr(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ts(n,e){if(Cr(n,e))return n[e]}function Tk(n){return Object.keys(n)}function Ut(n){return Object.values(n)}function Rs(n){return Object.entries(n)}function gD(n){return Object.fromEntries(n)}function Sh(n,e){const t={};let s=!1;for(const[i,r]of Rs(n))e(i,r)?t[i]=r:s=!0;return s?t:n}function Rp(n,e){const t={};for(const[s,i]of Rs(n)){const r=e(s,i);t[s]=r}return t}function mD(n,e){if(n===e)return!0;const t=new Set(Object.keys(n)),s=new Set(Object.keys(e));if(t.size!==s.size)return!1;for(const i of t)if(!s.has(i)||!Object.is(n[i],e[i]))return!1;return!0}const Hs="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",yD="a0",vD="A00000000000000000000000000";function xD(n){if(n>="a"&&n<="z")return n.charCodeAt(0)-97+2;if(n>="A"&&n<="Z")return 90-n.charCodeAt(0)+2;throw new Error("Invalid index key head: "+n)}function SD(n){if(n.length!==xD(n.charAt(0)))throw new Error("invalid integer part of index key: "+n)}function Ik(n){if(n===void 0)throw Error("n is undefined")}function Pk(n){SD(n);const[e,...t]=n.split("");let s=!0;for(let i=t.length-1;s&&i>=0;i--){const r=Hs.indexOf(t[i])+1;r===Hs.length?t[i]="0":(t[i]=Hs.charAt(r),s=!1)}if(s){if(e==="Z")return"a0";if(e==="z")return;const i=String.fromCharCode(e.charCodeAt(0)+1);return i>"a"?t.push("0"):t.pop(),i+t.join("")}else return e+t.join("")}function CZ(n){SD(n);const[e,...t]=n.split("");let s=!0;for(let i=t.length-1;s&&i>=0;i--){const r=Hs.indexOf(t[i])-1;r===-1?t[i]=Hs.slice(-1):(t[i]=Hs.charAt(r),s=!1)}if(s){if(e==="a")return"Z"+Hs.slice(-1);if(e==="A")return;const i=String.fromCharCode(e.charCodeAt(0)-1);return i<"Z"?t.push(Hs.slice(-1)):t.pop(),i+t.join("")}else return e+t.join("")}function Dc(n,e){if(e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n.slice(-1)==="0"||e&&e.slice(-1)==="0")throw new Error("trailing zero");if(e){let i=0;for(;(n.charAt(i)||"0")===e.charAt(i);)i++;if(i>0)return e.slice(0,i)+Dc(n.slice(i),e.slice(i))}const t=n?Hs.indexOf(n.charAt(0)):0,s=e!==void 0?Hs.indexOf(e.charAt(0)):Hs.length;if(s-t>1){const i=Math.round(.5*(t+s));return Hs.charAt(i)}else return e&&e.length>1?e.slice(0,1):Hs.charAt(t)+Dc(n.slice(1),void 0)}function Ku(n){const e=xD(n.charAt(0));if(e>n.length)throw new Error("invalid index: "+n);return n.slice(0,e)}function $0(n){if(n===vD)throw new Error("invalid index: "+n);const e=Ku(n);if(n.slice(e.length).slice(-1)==="0")throw new Error("invalid index: "+n)}function ac(n,e){if(n!==void 0&&$0(n),e!==void 0&&$0(e),n!==void 0&&e!==void 0&&n>=e)throw new Error(n+" >= "+e);if(n===void 0&&e===void 0)return yD;if(n===void 0){if(e===void 0)throw Error("b is undefined");const l=Ku(e),c=e.slice(l.length);if(l===vD)return l+Dc("",c);if(l<e)return l;const d=CZ(l);return Ik(d),d}if(e===void 0){const l=Ku(n),c=n.slice(l.length),d=Pk(l);return d===void 0?l+Dc(c,void 0):d}const t=Ku(n),s=n.slice(t.length),i=Ku(e),r=e.slice(i.length);if(t===i)return t+Dc(s,r);const o=Pk(t);return Ik(o),o<e?o:t+Dc(s,void 0)}function ka(n,e,t){if(t===0)return[];if(t===1)return[ac(n,e)];if(e===void 0){let r=ac(n,e);const o=[r];for(let l=0;l<t-1;l++)r=ac(r,e),o.push(r);return o}if(n===void 0){let r=ac(n,e);const o=[r];for(let l=0;l<t-1;l++)r=ac(n,r),o.push(r);return o.reverse(),o}const s=Math.floor(t/2),i=ac(n,e);return[...ka(n,i,s),i,...ka(i,e,t-s-1)]}const wD=yD;function EZ(n){$0(n)}function vd(n,e,t){return ka(n,e,t)}function ew(n,e){return ka(n,void 0,e)}function ep(n,e){return ka(n,e,1)[0]}function Li(n){return ka(n,void 0,1)[0]}function TZ(n){return ka(void 0,n,1)[0]}function tp(n,e="a1"){return[e,...ka(e,void 0,n)]}function Hn(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function IZ(n,e){return n.id>e.id?1:-1}function IE(n){try{return localStorage.getItem(n)}catch{return null}}function PE(n,e){try{localStorage.setItem(n,e)}catch{}}function PZ(){try{localStorage.clear()}catch{}}function bD(n){try{return sessionStorage.getItem(n)}catch{return null}}function kE(n,e){try{sessionStorage.setItem(n,e)}catch{}}function _D(n){try{sessionStorage.removeItem(n)}catch{}}function kZ(){try{sessionStorage.clear()}catch{}}const Lc=[],AZ=60,Yg=Math.ceil(1e3/AZ);let vu,tw=0,z0=0;const jZ=()=>{const n=Lc.splice(0,Lc.length);for(const e of n)e()};function CD(){if(vu)return;const n=Date.now(),e=n-z0;if(tw+e<Yg){vu=requestAnimationFrame(()=>{vu=void 0,CD()});return}vu=requestAnimationFrame(()=>{vu=void 0,z0=n,tw=Math.min(tw+e-Yg,Yg*10),jZ()})}let kk=!1;function ED(n){return Lc.includes(n)||(Lc.push(n),kk||(kk=!0,z0=Date.now()-Yg-1),CD()),()=>{const e=Lc.indexOf(n);e>-1&&Lc.splice(e,1)}}class NZ{constructor(){w(this,"timeouts",[]);w(this,"intervals",[]);w(this,"rafs",[])}setTimeout(e,t,...s){const i=window.setTimeout(e,t,s);return this.timeouts.push(i),i}setInterval(e,t,...s){const i=window.setInterval(e,t,s);return this.intervals.push(i),i}requestAnimationFrame(e){const t=window.requestAnimationFrame(e);return this.rafs.push(t),t}dispose(){this.timeouts.forEach(e=>clearTimeout(e)),this.intervals.forEach(e=>clearInterval(e)),this.rafs.forEach(e=>cancelAnimationFrame(e)),this.timeouts.length=0,this.intervals.length=0,this.rafs.length=0}}function RZ(n){return n!==null}function MZ(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[n=>n&&JSON.parse(JSON.stringify(n)),!1]}const TD=MZ(),ft=TD[0];TD[1];const OZ=Object.getPrototypeOf(ft({}));var nw={};const AE={enableLicensing:DZ("enableLicensing",{defaults:{all:!0,production:!1}})},ID=ms("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),Gt={logPreventDefaults:ms("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:ms("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:ms("logElementRemoves",{defaults:{all:!1}}),debugSvg:ms("debugSvg",{defaults:{all:!1}}),showFps:ms("showFps",{defaults:{all:!1}}),measurePerformance:ms("measurePerformance",{defaults:{all:!1}}),throwToBlob:ms("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:ms("reconnectOnPing",{defaults:{all:!1}}),debugCursors:ms("debugCursors",{defaults:{all:!1}}),forceSrgb:ms("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:ms("debugGeometry",{defaults:{all:!1}}),hideShapes:ms("hideShapes",{defaults:{all:!1}}),editOnType:ms("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const n=Element.prototype.removeChild;Zl("element removal logging",()=>{Gt.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function ms(n,{defaults:e,shouldStoreForSession:t=!0}){return PD({name:n,defaults:e,shouldStoreForSession:t})}function DZ(n,{defaults:e,shouldStoreForSession:t=!0}){return PD({name:n,defaults:e,shouldStoreForSession:t})}function PD(n){const e=FZ(n),t=n.shouldStoreForSession?LZ(n.name):null,s=an(`debug:${n.name}`,t??e);return typeof window<"u"&&(n.shouldStoreForSession&&Zl(`debug:${n.name}`,()=>{const i=s.get();i===e?_D(`tldraw_debug:${n.name}`):kE(`tldraw_debug:${n.name}`,JSON.stringify(i))}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return s.get()},set(i){s.set(i)},configurable:!0})),Object.assign(s,n)}function LZ(n){try{return JSON.parse(bD(`tldraw_debug:${n}`)??"null")}catch{return null}}function sw(n){try{return n()}catch{return null}}function FZ(n){switch(sw(()=>nw.TLDRAW_ENV)??sw(()=>nw.VERCEL_PUBLIC_TLDRAW_ENV)??sw(()=>nw.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}class Xg{constructor(e){w(this,"nextValue");w(this,"diff");this.previousValue=e}get(){var s,i,r,o;const e=((i=(s=this.diff)==null?void 0:s.removed)==null?void 0:i.size)??0,t=((o=(r=this.diff)==null?void 0:r.added)==null?void 0:o.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var s,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(s=this.diff.removed)==null||s.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var i,r,o;const t=this.previousValue.has(e);if(t)return((r=(i=this.diff)==null?void 0:i.removed)==null?void 0:r.has(e))?this._add(e,t):void 0;(o=this.nextValue)!=null&&o.has(e)||this._add(e,t)}_remove(e,t){var s,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((s=this.diff).removed??(s.removed=new Set),this.diff.removed.add(e)):(i=this.diff.added)==null||i.delete(e)}remove(e){var i,r,o,l;const t=this.previousValue.has(e);if(!t)return((r=(i=this.diff)==null?void 0:i.added)==null?void 0:r.has(e))?this._remove(e,t):void 0;(l=(o=this.diff)==null?void 0:o.removed)!=null&&l.has(e)||this._remove(e,t)}}let Mp=(n=21)=>crypto.getRandomValues(new Uint8Array(n)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");class Kv{constructor(e,t){w(this,"createDefaultProperties");w(this,"validator");w(this,"ephemeralKeys");w(this,"ephemeralKeySet");w(this,"scope");w(this,"isInstance",e=>(e==null?void 0:e.typeName)===this.typeName);this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:i=>i},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;const s=new Set;if(t.ephemeralKeys)for(const[i,r]of Rs(t.ephemeralKeys))r&&s.add(i);this.ephemeralKeySet=s}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[s,i]of Object.entries(e))i!==void 0&&(t[s]=i);return t.typeName=this.typeName,t}clone(e){return{...ft(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??Mp())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new Kv(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function Dr(n,e){return new Kv(n,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function my(){return{added:{},updated:{},removed:{}}}function W0(n){const e={added:n.removed,removed:n.added,updated:{}};for(const[t,s]of Object.values(n.updated))e.updated[t.id]=[s,t];return e}function kD(n){return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0}function jE(n){const e={added:{},removed:{},updated:{}};return wh(e,n),e}function wh(n,e){for(const t of e){for(const[s,i]of Rs(t.added))if(n.removed[s]){const r=n.removed[s];delete n.removed[s],r!==i&&(n.updated[s]=[r,i])}else n.added[s]=i;for(const[s,[i,r]]of Rs(t.updated)){if(n.added[s]){n.added[s]=r,delete n.updated[s],delete n.removed[s];continue}if(n.updated[s]){n.updated[s]=[n.updated[s][0],r],delete n.removed[s];continue}n.updated[s]=t.updated[s],delete n.removed[s]}for(const[s,i]of Rs(t.removed))n.added[s]?delete n.added[s]:n.updated[s]?(n.removed[s]=n.updated[s][0],delete n.updated[s]):n.removed[s]=i}}var yy={exports:{}};yy.exports;(function(n,e){var t=200,s="__lodash_hash_undefined__",i=1,r=2,o=9007199254740991,l="[object Arguments]",c="[object Array]",d="[object AsyncFunction]",u="[object Boolean]",h="[object Date]",p="[object Error]",f="[object Function]",g="[object GeneratorFunction]",m="[object Map]",x="[object Number]",y="[object Null]",S="[object Object]",v="[object Promise]",C="[object Proxy]",T="[object RegExp]",I="[object Set]",E="[object String]",P="[object Symbol]",k="[object Undefined]",j="[object WeakMap]",D="[object ArrayBuffer]",R="[object DataView]",A="[object Float32Array]",N="[object Float64Array]",B="[object Int8Array]",L="[object Int16Array]",O="[object Int32Array]",F="[object Uint8Array]",W="[object Uint8ClampedArray]",$="[object Uint16Array]",K="[object Uint32Array]",Y=/[\\^$.*+?()[\]{}|]/g,U=/^\[object .+?Constructor\]$/,J=/^(?:0|[1-9]\d*)$/,te={};te[A]=te[N]=te[B]=te[L]=te[O]=te[F]=te[W]=te[$]=te[K]=!0,te[l]=te[c]=te[D]=te[u]=te[R]=te[h]=te[p]=te[f]=te[m]=te[x]=te[S]=te[T]=te[I]=te[E]=te[j]=!1;var ee=typeof Gn=="object"&&Gn&&Gn.Object===Object&&Gn,ae=typeof self=="object"&&self&&self.Object===Object&&self,ce=ee||ae||Function("return this")(),he=e&&!e.nodeType&&e,Ee=he&&!0&&n&&!n.nodeType&&n,ke=Ee&&Ee.exports===he,Jt=ke&&ee.process,tt=function(){try{return Jt&&Jt.binding&&Jt.binding("util")}catch{}}(),re=tt&&tt.isTypedArray;function $e(M,z){for(var ne=-1,pe=M==null?0:M.length,yt=0,Ae=[];++ne<pe;){var Ft=M[ne];z(Ft,ne,M)&&(Ae[yt++]=Ft)}return Ae}function At(M,z){for(var ne=-1,pe=z.length,yt=M.length;++ne<pe;)M[yt+ne]=z[ne];return M}function gn(M,z){for(var ne=-1,pe=M==null?0:M.length;++ne<pe;)if(z(M[ne],ne,M))return!0;return!1}function nu(M,z){for(var ne=-1,pe=Array(M);++ne<M;)pe[ne]=z(ne);return pe}function Fo(M){return function(z){return M(z)}}function t6(M,z){return M.has(z)}function n6(M,z){return M==null?void 0:M[z]}function s6(M){var z=-1,ne=Array(M.size);return M.forEach(function(pe,yt){ne[++z]=[yt,pe]}),ne}function i6(M,z){return function(ne){return M(z(ne))}}function r6(M){var z=-1,ne=Array(M.size);return M.forEach(function(pe){ne[++z]=pe}),ne}var o6=Array.prototype,a6=Function.prototype,hf=Object.prototype,qx=ce["__core-js_shared__"],ZT=a6.toString,sr=hf.hasOwnProperty,JT=function(){var M=/[^.]+$/.exec(qx&&qx.keys&&qx.keys.IE_PROTO||"");return M?"Symbol(src)_1."+M:""}(),QT=hf.toString,l6=RegExp("^"+ZT.call(sr).replace(Y,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),eI=ke?ce.Buffer:void 0,pf=ce.Symbol,tI=ce.Uint8Array,nI=hf.propertyIsEnumerable,c6=o6.splice,qa=pf?pf.toStringTag:void 0,sI=Object.getOwnPropertySymbols,d6=eI?eI.isBuffer:void 0,u6=i6(Object.keys,Object),Zx=ic(ce,"DataView"),su=ic(ce,"Map"),Jx=ic(ce,"Promise"),Qx=ic(ce,"Set"),eS=ic(ce,"WeakMap"),iu=ic(Object,"create"),h6=Qa(Zx),p6=Qa(su),f6=Qa(Jx),g6=Qa(Qx),m6=Qa(eS),iI=pf?pf.prototype:void 0,tS=iI?iI.valueOf:void 0;function Za(M){var z=-1,ne=M==null?0:M.length;for(this.clear();++z<ne;){var pe=M[z];this.set(pe[0],pe[1])}}function y6(){this.__data__=iu?iu(null):{},this.size=0}function v6(M){var z=this.has(M)&&delete this.__data__[M];return this.size-=z?1:0,z}function x6(M){var z=this.__data__;if(iu){var ne=z[M];return ne===s?void 0:ne}return sr.call(z,M)?z[M]:void 0}function S6(M){var z=this.__data__;return iu?z[M]!==void 0:sr.call(z,M)}function w6(M,z){var ne=this.__data__;return this.size+=this.has(M)?0:1,ne[M]=iu&&z===void 0?s:z,this}Za.prototype.clear=y6,Za.prototype.delete=v6,Za.prototype.get=x6,Za.prototype.has=S6,Za.prototype.set=w6;function Ur(M){var z=-1,ne=M==null?0:M.length;for(this.clear();++z<ne;){var pe=M[z];this.set(pe[0],pe[1])}}function b6(){this.__data__=[],this.size=0}function _6(M){var z=this.__data__,ne=gf(z,M);if(ne<0)return!1;var pe=z.length-1;return ne==pe?z.pop():c6.call(z,ne,1),--this.size,!0}function C6(M){var z=this.__data__,ne=gf(z,M);return ne<0?void 0:z[ne][1]}function E6(M){return gf(this.__data__,M)>-1}function T6(M,z){var ne=this.__data__,pe=gf(ne,M);return pe<0?(++this.size,ne.push([M,z])):ne[pe][1]=z,this}Ur.prototype.clear=b6,Ur.prototype.delete=_6,Ur.prototype.get=C6,Ur.prototype.has=E6,Ur.prototype.set=T6;function Ja(M){var z=-1,ne=M==null?0:M.length;for(this.clear();++z<ne;){var pe=M[z];this.set(pe[0],pe[1])}}function I6(){this.size=0,this.__data__={hash:new Za,map:new(su||Ur),string:new Za}}function P6(M){var z=mf(this,M).delete(M);return this.size-=z?1:0,z}function k6(M){return mf(this,M).get(M)}function A6(M){return mf(this,M).has(M)}function j6(M,z){var ne=mf(this,M),pe=ne.size;return ne.set(M,z),this.size+=ne.size==pe?0:1,this}Ja.prototype.clear=I6,Ja.prototype.delete=P6,Ja.prototype.get=k6,Ja.prototype.has=A6,Ja.prototype.set=j6;function ff(M){var z=-1,ne=M==null?0:M.length;for(this.__data__=new Ja;++z<ne;)this.add(M[z])}function N6(M){return this.__data__.set(M,s),this}function R6(M){return this.__data__.has(M)}ff.prototype.add=ff.prototype.push=N6,ff.prototype.has=R6;function Bo(M){var z=this.__data__=new Ur(M);this.size=z.size}function M6(){this.__data__=new Ur,this.size=0}function O6(M){var z=this.__data__,ne=z.delete(M);return this.size=z.size,ne}function D6(M){return this.__data__.get(M)}function L6(M){return this.__data__.has(M)}function F6(M,z){var ne=this.__data__;if(ne instanceof Ur){var pe=ne.__data__;if(!su||pe.length<t-1)return pe.push([M,z]),this.size=++ne.size,this;ne=this.__data__=new Ja(pe)}return ne.set(M,z),this.size=ne.size,this}Bo.prototype.clear=M6,Bo.prototype.delete=O6,Bo.prototype.get=D6,Bo.prototype.has=L6,Bo.prototype.set=F6;function B6(M,z){var ne=yf(M),pe=!ne&&e8(M),yt=!ne&&!pe&&nS(M),Ae=!ne&&!pe&&!yt&&pI(M),Ft=ne||pe||yt||Ae,Qt=Ft?nu(M.length,String):[],mn=Qt.length;for(var jt in M)sr.call(M,jt)&&!(Ft&&(jt=="length"||yt&&(jt=="offset"||jt=="parent")||Ae&&(jt=="buffer"||jt=="byteLength"||jt=="byteOffset")||X6(jt,mn)))&&Qt.push(jt);return Qt}function gf(M,z){for(var ne=M.length;ne--;)if(cI(M[ne][0],z))return ne;return-1}function U6(M,z,ne){var pe=z(M);return yf(M)?pe:At(pe,ne(M))}function ru(M){return M==null?M===void 0?k:y:qa&&qa in Object(M)?K6(M):Q6(M)}function rI(M){return ou(M)&&ru(M)==l}function oI(M,z,ne,pe,yt){return M===z?!0:M==null||z==null||!ou(M)&&!ou(z)?M!==M&&z!==z:$6(M,z,ne,pe,oI,yt)}function $6(M,z,ne,pe,yt,Ae){var Ft=yf(M),Qt=yf(z),mn=Ft?c:Uo(M),jt=Qt?c:Uo(z);mn=mn==l?S:mn,jt=jt==l?S:jt;var Ls=mn==S,ki=jt==S,Nn=mn==jt;if(Nn&&nS(M)){if(!nS(z))return!1;Ft=!0,Ls=!1}if(Nn&&!Ls)return Ae||(Ae=new Bo),Ft||pI(M)?aI(M,z,ne,pe,yt,Ae):G6(M,z,mn,ne,pe,yt,Ae);if(!(ne&i)){var ri=Ls&&sr.call(M,"__wrapped__"),oi=ki&&sr.call(z,"__wrapped__");if(ri||oi){var $o=ri?M.value():M,$r=oi?z.value():z;return Ae||(Ae=new Bo),yt($o,$r,ne,pe,Ae)}}return Nn?(Ae||(Ae=new Bo),V6(M,z,ne,pe,yt,Ae)):!1}function z6(M){if(!hI(M)||Z6(M))return!1;var z=dI(M)?l6:U;return z.test(Qa(M))}function W6(M){return ou(M)&&uI(M.length)&&!!te[ru(M)]}function H6(M){if(!J6(M))return u6(M);var z=[];for(var ne in Object(M))sr.call(M,ne)&&ne!="constructor"&&z.push(ne);return z}function aI(M,z,ne,pe,yt,Ae){var Ft=ne&i,Qt=M.length,mn=z.length;if(Qt!=mn&&!(Ft&&mn>Qt))return!1;var jt=Ae.get(M);if(jt&&Ae.get(z))return jt==z;var Ls=-1,ki=!0,Nn=ne&r?new ff:void 0;for(Ae.set(M,z),Ae.set(z,M);++Ls<Qt;){var ri=M[Ls],oi=z[Ls];if(pe)var $o=Ft?pe(oi,ri,Ls,z,M,Ae):pe(ri,oi,Ls,M,z,Ae);if($o!==void 0){if($o)continue;ki=!1;break}if(Nn){if(!gn(z,function($r,el){if(!t6(Nn,el)&&(ri===$r||yt(ri,$r,ne,pe,Ae)))return Nn.push(el)})){ki=!1;break}}else if(!(ri===oi||yt(ri,oi,ne,pe,Ae))){ki=!1;break}}return Ae.delete(M),Ae.delete(z),ki}function G6(M,z,ne,pe,yt,Ae,Ft){switch(ne){case R:if(M.byteLength!=z.byteLength||M.byteOffset!=z.byteOffset)return!1;M=M.buffer,z=z.buffer;case D:return!(M.byteLength!=z.byteLength||!Ae(new tI(M),new tI(z)));case u:case h:case x:return cI(+M,+z);case p:return M.name==z.name&&M.message==z.message;case T:case E:return M==z+"";case m:var Qt=s6;case I:var mn=pe&i;if(Qt||(Qt=r6),M.size!=z.size&&!mn)return!1;var jt=Ft.get(M);if(jt)return jt==z;pe|=r,Ft.set(M,z);var Ls=aI(Qt(M),Qt(z),pe,yt,Ae,Ft);return Ft.delete(M),Ls;case P:if(tS)return tS.call(M)==tS.call(z)}return!1}function V6(M,z,ne,pe,yt,Ae){var Ft=ne&i,Qt=lI(M),mn=Qt.length,jt=lI(z),Ls=jt.length;if(mn!=Ls&&!Ft)return!1;for(var ki=mn;ki--;){var Nn=Qt[ki];if(!(Ft?Nn in z:sr.call(z,Nn)))return!1}var ri=Ae.get(M);if(ri&&Ae.get(z))return ri==z;var oi=!0;Ae.set(M,z),Ae.set(z,M);for(var $o=Ft;++ki<mn;){Nn=Qt[ki];var $r=M[Nn],el=z[Nn];if(pe)var fI=Ft?pe(el,$r,Nn,z,M,Ae):pe($r,el,Nn,M,z,Ae);if(!(fI===void 0?$r===el||yt($r,el,ne,pe,Ae):fI)){oi=!1;break}$o||($o=Nn=="constructor")}if(oi&&!$o){var vf=M.constructor,xf=z.constructor;vf!=xf&&"constructor"in M&&"constructor"in z&&!(typeof vf=="function"&&vf instanceof vf&&typeof xf=="function"&&xf instanceof xf)&&(oi=!1)}return Ae.delete(M),Ae.delete(z),oi}function lI(M){return U6(M,s8,Y6)}function mf(M,z){var ne=M.__data__;return q6(z)?ne[typeof z=="string"?"string":"hash"]:ne.map}function ic(M,z){var ne=n6(M,z);return z6(ne)?ne:void 0}function K6(M){var z=sr.call(M,qa),ne=M[qa];try{M[qa]=void 0;var pe=!0}catch{}var yt=QT.call(M);return pe&&(z?M[qa]=ne:delete M[qa]),yt}var Y6=sI?function(M){return M==null?[]:(M=Object(M),$e(sI(M),function(z){return nI.call(M,z)}))}:i8,Uo=ru;(Zx&&Uo(new Zx(new ArrayBuffer(1)))!=R||su&&Uo(new su)!=m||Jx&&Uo(Jx.resolve())!=v||Qx&&Uo(new Qx)!=I||eS&&Uo(new eS)!=j)&&(Uo=function(M){var z=ru(M),ne=z==S?M.constructor:void 0,pe=ne?Qa(ne):"";if(pe)switch(pe){case h6:return R;case p6:return m;case f6:return v;case g6:return I;case m6:return j}return z});function X6(M,z){return z=z??o,!!z&&(typeof M=="number"||J.test(M))&&M>-1&&M%1==0&&M<z}function q6(M){var z=typeof M;return z=="string"||z=="number"||z=="symbol"||z=="boolean"?M!=="__proto__":M===null}function Z6(M){return!!JT&&JT in M}function J6(M){var z=M&&M.constructor,ne=typeof z=="function"&&z.prototype||hf;return M===ne}function Q6(M){return QT.call(M)}function Qa(M){if(M!=null){try{return ZT.call(M)}catch{}try{return M+""}catch{}}return""}function cI(M,z){return M===z||M!==M&&z!==z}var e8=rI(function(){return arguments}())?rI:function(M){return ou(M)&&sr.call(M,"callee")&&!nI.call(M,"callee")},yf=Array.isArray;function t8(M){return M!=null&&uI(M.length)&&!dI(M)}var nS=d6||r8;function n8(M,z){return oI(M,z)}function dI(M){if(!hI(M))return!1;var z=ru(M);return z==f||z==g||z==d||z==C}function uI(M){return typeof M=="number"&&M>-1&&M%1==0&&M<=o}function hI(M){var z=typeof M;return M!=null&&(z=="object"||z=="function")}function ou(M){return M!=null&&typeof M=="object"}var pI=re?Fo(re):W6;function s8(M){return t8(M)?B6(M):H6(M)}function i8(){return[]}function r8(){return!1}n.exports=n8})(yy,yy.exports);var BZ=yy.exports;const UZ=Oa(BZ);function $Z(n){if(n.length===0)return new Set;const e=n[0],t=n.slice(1),s=new Set;for(const i of e)t.every(r=>r.has(i))&&s.add(i);return s}function zZ(n,e){const t={};for(const s of e)n.has(s)||(t.added??(t.added=new Set),t.added.add(s));for(const s of n)e.has(s)||(t.removed??(t.removed=new Set),t.removed.add(s));return t.added||t.removed?t:void 0}function Ak(n,e){for(const[t,s]of Object.entries(n)){const i=s,r=e[t];if("eq"in i&&r!==i.eq||"neq"in i&&r===i.neq||"gt"in i&&(typeof r!="number"||r<=i.gt))return!1}return!0}function jk(n,e,t){const s=Object.fromEntries(Object.keys(t).map(i=>[i,new Set]));for(const[i,r]of Object.entries(t))if("eq"in r){const l=n.index(e,i).get().get(r.eq);if(l)for(const c of l)s[i].add(c)}else if("neq"in r){const o=n.index(e,i);for(const[l,c]of o.get())if(l!==r.neq)for(const d of c)s[i].add(d)}else if("gt"in r){const o=n.index(e,i);for(const[l,c]of o.get())if(l>r.gt)for(const d of c)s[i].add(d)}return $Z(Object.values(s))}class WZ{constructor(e,t){w(this,"indexCache",new Map);w(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=Q("filterHistory:"+e,(s,i)=>{if(Sl(s))return this.history.get();const r=this.history.getDiffSince(i);if(r===Ks)return this.history.get();const o={added:{},removed:{},updated:{}};let l=0,c=0,d=0;for(const u of r){for(const h of Ut(u.added))if(h.typeName===e)if(o.removed[h.id]){const p=o.removed[h.id];delete o.removed[h.id],c--,p!==h&&(o.updated[h.id]=[p,h],d++)}else o.added[h.id]=h,l++;for(const[h,p]of Ut(u.updated))p.typeName===e&&(o.added[p.id]?o.added[p.id]=p:o.updated[p.id]?o.updated[p.id]=[o.updated[p.id][0],p]:(o.updated[p.id]=[h,p],d++));for(const h of Ut(u.removed))h.typeName===e&&(o.added[h.id]?(delete o.added[h.id],l--):o.updated[h.id]?(o.removed[h.id]=o.updated[h.id][0],delete o.updated[h.id],d--,c++):(o.removed[h.id]=h,c++))}return l||c||d?Gu(this.history.get(),o):s},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const s=e+":"+t;if(this.indexCache.has(s))return this.indexCache.get(s);const i=this.__uncached_createIndex(e,t);return this.indexCache.set(s,i),i}__uncached_createIndex(e,t){const s=this.filterHistory(e),i=()=>{s.get();const r=new Map;for(const o of Ut(this.atoms.get())){const l=o.get();if(l.typeName===e){const c=l[t];r.has(c)||r.set(c,new Set),r.get(c).add(l.id)}}return r};return Q("index:"+e+":"+t,(r,o)=>{if(Sl(r))return i();const l=s.getDiffSince(o);if(l===Ks)return i();const c=new Map,d=(f,g)=>{let m=c.get(f);m||(m=new Xg(r.get(f)??new Set)),m.add(g),c.set(f,m)},u=(f,g)=>{let m=c.get(f);m||(m=new Xg(r.get(f)??new Set)),m.remove(g),c.set(f,m)};for(const f of l){for(const g of Ut(f.added))if(g.typeName===e){const m=g[t];d(m,g.id)}for(const[g,m]of Ut(f.updated))if(m.typeName===e){const x=g[t],y=m[t];x!==y&&(u(x,m.id),d(y,m.id))}for(const g of Ut(f.removed))if(g.typeName===e){const m=g[t];u(m,g.id)}}let h,p;for(const[f,g]of c){const m=g.get();m&&(h||(h=new Map(r)),p||(p=new Map),m.value.size===0?h.delete(f):h.set(f,m.value),p.set(f,m.diff))}return h&&p?Gu(h,p):r},{historyLength:100})}record(e,t=()=>({}),s="record:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,s);return Q(s,()=>{var r;for(const o of i.get())return(r=this.atoms.get()[o])==null?void 0:r.get()})}records(e,t=()=>({}),s="records:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,"ids:"+s);return Q(s,()=>[...i.get()].map(r=>{const o=this.atoms.get()[r];if(!o)throw new Error("no atom found for record id: "+r);return o.get()}))}ids(e,t=()=>({}),s="ids:"+e+(t?":"+t.toString():"")){const i=this.filterHistory(e),r=()=>{i.get();const c=t();return Object.keys(c).length===0?new Set(Ut(this.atoms.get()).flatMap(d=>{const u=d.get();return u.typeName===e?u.id:[]})):jk(this,e,c)},o=c=>{const d=r(),u=zZ(c,d);return u?Gu(d,u):c},l=Q("ids_query:"+s,t,{isEqual:UZ});return Q("query:"+s,(c,d)=>{const u=l.get();if(Sl(c))return r();if(d<l.lastChangedEpoch)return o(c);const h=i.getDiffSince(d);if(h===Ks)return o(c);const p=new Xg(c);for(const g of h){for(const m of Ut(g.added))m.typeName===e&&Ak(u,m)&&p.add(m.id);for(const[m,x]of Ut(g.updated))x.typeName===e&&(Ak(u,x)?p.add(x.id):p.remove(x.id));for(const m of Ut(g.removed))m.typeName===e&&p.remove(m.id)}const f=p.get();return f?Gu(f.value,f.diff):c},{historyLength:50})}exec(e,t){const s=jk(this,e,t);if(s.size===0)return co;const i=this.atoms.get();return[...s].map(r=>i[r].get())}}class HZ{constructor(e){w(this,"_beforeCreateHandlers",{});w(this,"_afterCreateHandlers",{});w(this,"_beforeChangeHandlers",{});w(this,"_afterChangeHandlers",{});w(this,"_beforeDeleteHandlers",{});w(this,"_afterDeleteHandlers",{});w(this,"_operationCompleteHandlers",[]);w(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const s=this._beforeCreateHandlers[e.typeName];if(s){let i=e;for(const r of s)i=r(i,t);return i}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const s=this._afterCreateHandlers[e.typeName];if(s)for(const i of s)i(e,t)}handleBeforeChange(e,t,s){if(!this._isEnabled)return t;const i=this._beforeChangeHandlers[t.typeName];if(i){let r=t;for(const o of i)r=o(e,r,s);return r}return t}handleAfterChange(e,t,s){if(!this._isEnabled)return;const i=this._afterChangeHandlers[t.typeName];if(i)for(const r of i)r(e,t,s)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const s=this._beforeDeleteHandlers[e.typeName];if(s){for(const i of s)if(i(e,t)===!1)return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const s=this._afterDeleteHandlers[e.typeName];if(s)for(const i of s)i(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[s,i]of Object.entries(e))i!=null&&i.beforeCreate&&t.push(this.registerBeforeCreateHandler(s,i.beforeCreate)),i!=null&&i.afterCreate&&t.push(this.registerAfterCreateHandler(s,i.afterCreate)),i!=null&&i.beforeChange&&t.push(this.registerBeforeChangeHandler(s,i.beforeChange)),i!=null&&i.afterChange&&t.push(this.registerAfterChangeHandler(s,i.afterChange)),i!=null&&i.beforeDelete&&t.push(this.registerBeforeDeleteHandler(s,i.beforeDelete)),i!=null&&i.afterDelete&&t.push(this.registerAfterDeleteHandler(s,i.afterDelete));return()=>{for(const s of t)s()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>nl(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>nl(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>nl(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>nl(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>nl(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>nl(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>nl(this._operationCompleteHandlers,e)}}function nl(n,e){const t=n.indexOf(e);t>=0&&n.splice(t,1)}class NE{constructor(e){w(this,"id");w(this,"atoms",an("store_atoms",{}));w(this,"history",an("history",0,{historyLength:1e3}));w(this,"query",new WZ(this.atoms,this.history));w(this,"listeners",new Set);w(this,"historyAccumulator",new VZ);w(this,"historyReactor");w(this,"cancelHistoryReactor",()=>{});w(this,"schema");w(this,"props");w(this,"scopedTypes");w(this,"sideEffects",new HZ(this));w(this,"put",(e,t)=>{this.atomic(()=>{const s={},i={},r=this.atoms.__unsafe__getWithoutCapture();let o=null,l,c=!1;const d=this.isMergingRemoteChanges?"remote":"user";for(let u=0,h=e.length;u<h;u++){l=e[u];const p=(o??r)[l.id];if(p){const f=p.__unsafe__getWithoutCapture();if(l=this.sideEffects.handleBeforeChange(f,l,d),this.schema.validateRecord(this,l,t??"updateRecord",f)===f)continue;p.set(l),c=!0;const m=p.__unsafe__getWithoutCapture();s[l.id]=[f,m],this.addDiffForAfterEvent(f,m)}else l=this.sideEffects.handleBeforeCreate(l,d),c=!0,l=this.schema.validateRecord(this,l,t??"createRecord",null),i[l.id]=l,this.addDiffForAfterEvent(null,l),o||(o={...r}),o[l.id]=an("atom:"+l.id,l)}o&&this.atoms.set(o),c&&this.updateHistory({added:i,updated:s,removed:{}})})});w(this,"remove",e=>{this.atomic(()=>{const t=new Set,s=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const r of e){const o=this.atoms.__unsafe__getWithoutCapture()[r];o&&this.sideEffects.handleBeforeDelete(o.get(),s)===!1&&t.add(r)}let i;this.atoms.update(r=>{let o;for(const l of e){if(t.has(l)||!(l in r))continue;o||(o={...r}),i||(i={}),delete o[l];const c=r[l].get();i[l]=c,this.addDiffForAfterEvent(c,null)}return o??r}),i&&this.updateHistory({added:{},updated:{},removed:i})})});w(this,"get",e=>{var t;return(t=this.atoms.get()[e])==null?void 0:t.get()});w(this,"unsafeGetWithoutCapture",e=>{var t;return(t=this.atoms.__unsafe__getWithoutCapture()[e])==null?void 0:t.__unsafe__getWithoutCapture()});w(this,"serialize",(e="document")=>{const t={};for(const[s,i]of Rs(this.atoms.get())){const r=i.get();(e==="all"||this.scopedTypes[e].has(r.typeName))&&(t[s]=r)}return t});w(this,"allRecords",()=>Ut(this.atoms.get()).map(e=>e.get()));w(this,"clear",()=>{this.remove(Tk(this.atoms.get()))});w(this,"update",(e,t)=>{const s=this.atoms.get()[e];if(!s){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(s.__unsafe__getWithoutCapture())])});w(this,"has",e=>!!this.atoms.get()[e]);w(this,"listen",(e,t)=>{this._flushHistory();const s={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.listeners.add(s),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(s),this.listeners.size===0&&this.historyReactor.stop()}});w(this,"isMergingRemoteChanges",!1);w(this,"mergeRemoteChanges",e=>{if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,_r(e)}finally{this.isMergingRemoteChanges=!1}});w(this,"createComputedCache",(e,t,s)=>{const i=new xo;return{get:r=>{const o=this.atoms.get()[r];if(o)return i.get(o,()=>{const l=s?Q(o.name+":equals",()=>o.get(),{isEqual:s}):o;return Q(e+":"+r,()=>t(l.get()))}).get()}}});w(this,"createSelectedComputedCache",(e,t,s)=>{const i=new xo;return{get:r=>{const o=this.atoms.get()[r];if(o)return i.get(o,()=>{const l=Q(e+":"+r+":selector",()=>t(o.get()));return Q(e+":"+r,()=>s(l.get()))}).get()}}});w(this,"_integrityChecker");w(this,"_isPossiblyCorrupted",!1);w(this,"pendingAfterEvents",null);w(this,"_isInAtomicOp",!1);const{initialData:t,schema:s,id:i}=e;this.id=i??Mp(),this.schema=s,this.props=e.props,t&&this.atoms.set(gD(Rs(t).map(([r,o])=>[r,an("atom:"+r,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=LX("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:r=>this.cancelHistoryReactor=ED(r)}),this.scopedTypes={document:new Set(Ut(this.schema.types).filter(r=>r.scope==="document").map(r=>r.typeName)),session:new Set(Ut(this.schema.types).filter(r=>r.scope==="session").map(r=>r.typeName)),presence:new Set(Ut(this.schema.types).filter(r=>r.scope==="presence").map(r=>r.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:s}of e){let i=null,r=null,o=null;for(const{onHistory:l,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==s))if(c.scope!=="all")if(c.scope==="document"){if(r??(r=this.filterChangesByScope(t,"document")),!r)continue;l({changes:r,source:s})}else if(c.scope==="session"){if(i??(i=this.filterChangesByScope(t,"session")),!i)continue;l({changes:i,source:s})}else{if(o??(o=this.filterChangesByScope(t,"presence")),!o)continue;l({changes:o,source:s})}else l({changes:t,source:s})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const s={added:Sh(e.added,(i,r)=>this.scopedTypes[t].has(r.typeName)),updated:Sh(e.updated,(i,r)=>this.scopedTypes[t].has(r[1].typeName)),removed:Sh(e.removed,(i,r)=>this.scopedTypes[t].has(r.typeName))};return Object.keys(s.added).length===0&&Object.keys(s.updated).length===0&&Object.keys(s.removed).length===0?null:s}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);const s=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(s)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}extractingChanges(e){const t=[],s=this.historyAccumulator.addInterceptor(i=>t.push(i.changes));try{return _r(e),jE(t)}finally{s()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:s=!1}={}){this.atomic(()=>{const i=Ut(e.added);for(const[o,l]of Ut(e.updated)){const c=this.schema.getType(l.typeName);if(s&&c.ephemeralKeySet.size){const d=this.get(l.id);if(!d){i.push(l);continue}let u=null;for(const[h,p]of Object.entries(l))c.ephemeralKeySet.has(h)||Object.is(p,Ts(d,h))||(u||(u={...d}),u[h]=p);u&&i.push(u)}else i.push(l)}const r=Tk(e.removed);i.length&&this.put(i),r.length&&this.remove(r)},t)}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,t){if(mt(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&mt(e.id===t.id),!e&&!t))return;const s=(e||t).id,i=this.pendingAfterEvents.get(s);i?i.after=t:this.pendingAfterEvents.set(s,{before:e,after:t})}flushAtomicCallbacks(){let e=0;const t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const s=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:i,after:r}of s.values())i&&r?this.sideEffects.handleAfterChange(i,r,t):i&&!r?this.sideEffects.handleAfterDelete(i,t):!i&&r&&this.sideEffects.handleAfterCreate(r,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}atomic(e,t=!0){return _r(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const s=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??s),this._isInAtomicOp=!0;try{const i=e();return this.flushAtomicCallbacks(),i}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(s),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}}function GZ(n){if(n.length===0)return[];const e=[];let t=[n[0]],s;for(let i=1,r=n.length;i<r;i++)s=n[i],t[0].source!==s.source&&(e.push(t),t=[]),t.push(s);return e.push(t),e.map(i=>({source:i[0].source,changes:jE(i.map(r=>r.changes))}))}class VZ{constructor(){w(this,"_history",[]);w(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=GZ(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function KZ(n,e,t){const s=new xo;return{get(i,r){return s.get(i,()=>(i instanceof NE?i:i.store).createComputedCache(n,c=>e(i,c),t)).get(r)}}}function YZ(n){const e=[];for(let t=n.length-1;t>=0;t--){const s=n[t];if("id"in s)e.unshift(s);else{const i=s.dependsOn,r=e[0];r&&(e[0]={...r,dependsOn:i.concat(r.dependsOn??[])})}}return e}function Jc({sequence:n,sequenceId:e,retroactive:t=!0}){const s={sequenceId:e,retroactive:t,sequence:YZ(n)};return AD(s),s}function Os(n,e){return Object.fromEntries(Rs(e).map(([t,s])=>[t,`${n}/${s}`]))}function si(n){const e=n.sequenceId;return Jc({sequenceId:e,retroactive:n.retroactive??!0,sequence:n.sequence.map(t=>"id"in t?{...t,scope:"record",filter:s=>{var i,r;return s.typeName===n.recordType&&(((i=t.filter)==null?void 0:i.call(t,s))??!0)&&(((r=n.filter)==null?void 0:r.call(n,s))??!0)}}:t)})}function XZ(n){const e=new Map(n.map(r=>[r.id,r])),t=new Set,s=[];function i(r){mt(!t.has(r.id),`Circular dependency in migrations: ${r.id}`),t.add(r.id);const{version:o,sequenceId:l}=vy(r.id),c=e.get(`${l}/${o-1}`);if(c&&i(c),r.dependsOn)for(const d of r.dependsOn){const u=e.get(d);u&&i(u)}e.delete(r.id),s.push(r)}for(const r of e.values())i(r);return s}function vy(n){const[e,t]=n.split("/");return{sequenceId:e,version:parseInt(t)}}function Nk(n,e){e&&mt(n.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${n}'`),mt(n.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${n}'`)}function AD(n){if(mt(!n.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${n.sequenceId}`),mt(n.sequenceId.length,"sequenceId must be a non-empty string"),n.sequence.length===0)return;Nk(n.sequence[0].id,n.sequenceId);let e=vy(n.sequence[0].id).version;mt(e===1,`Expected the first migrationId to be '${n.sequenceId}/1' but got '${n.sequence[0].id}'`);for(let t=1;t<n.sequence.length;t++){const s=n.sequence[t].id;Nk(s,n.sequenceId);const i=vy(s).version;mt(i===e+1,`Migration id numbers must increase in increments of 1, expected ${n.sequenceId}/${e+1} but got '${n.sequence[t].id}'`),e=i}}var Yo=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(Yo||{});function qZ(n){if(n.schemaVersion>2||n.schemaVersion<1)return xa.err("Bad schema version");if(n.schemaVersion===2)return xa.ok(n);const e={schemaVersion:2,sequences:{}};for(const[t,s]of Object.entries(n.recordVersions))if(e.sequences[`com.tldraw.${t}`]=s.version,"subTypeKey"in s)for(const[i,r]of Object.entries(s.subTypeVersions))e.sequences[`com.tldraw.${t}.${i}`]=r;return xa.ok(e)}class RE{constructor(e,t){w(this,"migrations",{});w(this,"sortedMigrations");var i;this.types=e,this.options=t;for(const r of t.migrations??[])mt(!this.migrations[r.sequenceId],`Duplicate migration sequenceId ${r.sequenceId}`),AD(r),this.migrations[r.sequenceId]=r;const s=Object.values(this.migrations).flatMap(r=>r.sequence);this.sortedMigrations=XZ(s);for(const r of this.sortedMigrations)if((i=r.dependsOn)!=null&&i.length)for(const o of r.dependsOn){const l=s.find(c=>c.id===o);mt(l,`Migration '${r.id}' depends on missing migration '${o}'`)}}static create(e,t){return new RE(e,t??{})}validateRecord(e,t,s,i){try{const r=Ts(this.types,t.typeName);if(!r)throw new Error(`Missing definition for record type ${t.typeName}`);return r.validate(t,i??void 0)}catch(r){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:s,recordBefore:i,error:r});throw r}}getMigrationsSince(e){const t=qZ(e);if(!t.ok)return t;const s=t.value,i=new Set(Object.keys(s.sequences).filter(o=>this.migrations[o]));for(const o in this.migrations)s.sequences[o]===void 0&&this.migrations[o].retroactive&&i.add(o);if(i.size===0)return xa.ok([]);const r=new Set;for(const o of i){const l=s.sequences[o];if(typeof l!="number"&&this.migrations[o].retroactive||l===0){for(const u of this.migrations[o].sequence)r.add(u.id);continue}const c=`${o}/${l}`,d=this.migrations[o].sequence.findIndex(u=>u.id===c);if(d===-1)return xa.err("Incompatible schema?");for(const u of this.migrations[o].sequence.slice(d+1))r.add(u.id)}return xa.ok(this.sortedMigrations.filter(({id:o})=>r.has(o)))}migratePersistedRecord(e,t,s="up"){const i=this.getMigrationsSince(t);if(!i.ok)return console.error("Error migrating record",i.error),{type:"error",reason:Yo.MigrationError};let r=i.value;if(r.length===0)return{type:"success",value:e};if(r.some(o=>o.scope==="store"))return{type:"error",reason:s==="down"?Yo.TargetVersionTooOld:Yo.TargetVersionTooNew};if(s==="down"){if(!r.every(o=>o.down))return{type:"error",reason:Yo.TargetVersionTooOld};r=r.slice().reverse()}e=ft(e);try{for(const o of r){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(e):!0))continue;const c=o[s](e);c&&(e=ft(c))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:Yo.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e;const s=this.getMigrationsSince(e.schema);if(!s.ok)return console.error("Error migrating store",s.error),{type:"error",reason:Yo.MigrationError};const i=s.value;if(i.length===0)return{type:"success",value:t};t=ft(t);try{for(const r of i)if(r.scope==="record")for(const[o,l]of Object.entries(t)){if(!(r.filter?r.filter(l):!0))continue;const d=r.up(l);d&&(t[o]=ft(d))}else if(r.scope==="store"){const o=r.up(t);o&&(t=ft(o))}else Vn(r)}catch(r){return console.error("Error migrating store",r),{type:"error",reason:Yo.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){var t,s;return((s=(t=this.options).createIntegrityChecker)==null?void 0:s.call(t,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?vy(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const t=Ts(this.types,e);return mt(t,"record type does not exists"),t}}function ZZ(n){if(!n.length)return null;let e="";for(const t of n)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class He extends Error{constructor(t,s=[]){const i=ZZ(s),r=t.split(`
`).map((o,l)=>l===0?o:`  ${o}`).join(`
`);super(s?`At ${i}: ${r}`:r);w(this,"name","ValidationError");this.rawMessage=t,this.path=s}}function Ms(n,e){try{return e()}catch(t){throw t instanceof He?new He(t.rawMessage,[n,...t.path]):new He(t.toString(),[n])}}function Aa(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:Vn(e)}}class us{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return sJ(this)}optional(){return ND(this)}refine(e){return new us(t=>e(this.validate(t)),(t,s)=>{const i=this.validateUsingKnownGoodVersion(t,s);return Object.is(t,i)?t:e(i)})}check(e,t){return typeof e=="string"?this.refine(s=>(Ms(`(check ${e})`,()=>t(s)),s)):this.refine(s=>(e(s),s))}}class JZ extends us{constructor(e){super(t=>{const s=Rk.validate(t);for(let i=0;i<s.length;i++)Ms(i,()=>e.validate(s[i]));return s},(t,s)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(s);const i=Rk.validate(s);let r=t.length!==i.length;for(let o=0;o<i.length;o++){const l=i[o];if(o>=t.length){r=!0,Ms(o,()=>e.validate(l));continue}if(Object.is(t[o],l))continue;const c=Ms(o,()=>e.validateUsingKnownGoodVersion(t[o],l));Object.is(c,t[o])||(r=!0)}return r?s:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new He("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new He("Expected an array with length greater than 1")})}}class xy extends us{constructor(e,t=!1){super(s=>{if(typeof s!="object"||s===null)throw new He(`Expected object, got ${Aa(s)}`);for(const[i,r]of Object.entries(e))Ms(i,()=>{r.validate(Ts(s,i))});if(!t){for(const i of Object.keys(s))if(!Cr(e,i))throw new He("Unexpected property",[i])}return s},(s,i)=>{if(typeof i!="object"||i===null)throw new He(`Expected object, got ${Aa(i)}`);let r=!1;for(const[o,l]of Object.entries(e)){const c=Ts(s,o),d=Ts(i,o);if(Object.is(c,d))continue;const u=Ms(o,()=>{const h=l;return h.validateUsingKnownGoodVersion?h.validateUsingKnownGoodVersion(c,d):h.validate(d)});Object.is(u,c)||(r=!0)}if(!t){for(const o of Object.keys(i))if(!Cr(e,o))throw new He("Unexpected property",[o])}for(const o of Object.keys(s))if(!Cr(i,o)){r=!0;break}return r?i:s}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new xy(this.config,!0)}extend(e){return new xy({...this.config,...e})}}class Yv extends us{constructor(e,t,s,i){super(r=>{this.expectObject(r);const{matchingSchema:o,variant:l}=this.getMatchingSchemaAndVariant(r);return o===void 0?this.unknownValueValidation(r,l):Ms(`(${e} = ${l})`,()=>o.validate(r))},(r,o)=>{this.expectObject(o),this.expectObject(r);const{matchingSchema:l,variant:c}=this.getMatchingSchemaAndVariant(o);return l===void 0?this.unknownValueValidation(o,c):Ts(r,e)!==Ts(o,e)?Ms(`(${e} = ${c})`,()=>l.validate(o)):Ms(`(${e} = ${c})`,()=>l.validateUsingKnownGoodVersion?l.validateUsingKnownGoodVersion(r,o):l.validate(o))}),this.key=e,this.config=t,this.unknownValueValidation=s,this.useNumberKeys=i}expectObject(e){if(typeof e!="object"||e===null)throw new He(`Expected an object, got ${Aa(e)}`,[])}getMatchingSchemaAndVariant(e){const t=Ts(e,this.key);if(!this.useNumberKeys&&typeof t!="string")throw new He(`Expected a string for key "${this.key}", got ${Aa(t)}`);if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new He(`Expected a number for key "${this.key}", got "${t}"`);return{matchingSchema:Cr(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new Yv(this.key,this.config,e,this.useNumberKeys)}}class QZ extends us{constructor(e,t){super(s=>{if(typeof s!="object"||s===null)throw new He(`Expected object, got ${Aa(s)}`);for(const[i,r]of Object.entries(s))Ms(i,()=>{e.validate(i),t.validate(r)});return s},(s,i)=>{if(typeof i!="object"||i===null)throw new He(`Expected object, got ${Aa(i)}`);let r=!1;for(const[o,l]of Object.entries(i)){if(!Cr(s,o)){r=!0,Ms(o,()=>{e.validate(o),t.validate(l)});continue}const c=Ts(s,o),d=l;if(Object.is(c,d))continue;const u=Ms(o,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(c,d):t.validate(d));Object.is(u,c)||(r=!0)}for(const o of Object.keys(s))if(!Cr(i,o)){r=!0;break}return r?i:s}),this.keyValidator=e,this.valueValidator=t}}function ME(n){return new us(e=>{if(typeof e!==n)throw new He(`Expected ${n}, got ${Aa(e)}`);return e})}const eJ=new us(n=>n),Pe=ME("string"),_e=ME("number").check(n=>{if(Number.isNaN(n))throw new He("Expected a number, got NaN");if(!Number.isFinite(n))throw new He(`Expected a finite number, got ${n}`)}),Sy=_e.check(n=>{if(n<0)throw new He(`Expected a positive number, got ${n}`)}),Kt=_e.check(n=>{if(n<=0)throw new He(`Expected a non-zero positive number, got ${n}`)}),jD=_e.check(n=>{if(!Number.isInteger(n))throw new He(`Expected an integer, got ${n}`)}),qg=jD.check(n=>{if(n<0)throw new He(`Expected a positive integer, got ${n}`)}),tJ=jD.check(n=>{if(n<=0)throw new He(`Expected a non-zero positive integer, got ${n}`)}),Me=ME("boolean");function Xn(n){return new us(e=>{if(e!==n)throw new He(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const Rk=new us(n=>{if(!Array.isArray(n))throw new He(`Expected an array, got ${Aa(n)}`);return n});function bn(n){return new JZ(n)}function Le(n){return new xy(n)}function H0(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null||Object.getPrototypeOf(n)===OZ)}function G0(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(G0):H0(n)?Object.values(n).every(G0):!1}const _n=new us(n=>{if(G0(n))return n;throw new He(`Expected json serializable value, got ${typeof n}`)},(n,e)=>{if(Array.isArray(n)&&Array.isArray(e)){let t=n.length!==e.length;for(let s=0;s<e.length;s++){if(s>=n.length){t=!0,_n.validate(e[s]);continue}const i=n[s],r=e[s];if(Object.is(i,r))continue;const o=_n.validateUsingKnownGoodVersion(i,r);Object.is(o,i)||(t=!0)}return t?e:n}else if(H0(n)&&H0(e)){let t=!1;for(const s of Object.keys(e)){if(!Cr(n,s)){t=!0,_n.validate(e[s]);continue}const i=n[s],r=e[s];if(Object.is(i,r))continue;const o=_n.validateUsingKnownGoodVersion(i,r);Object.is(o,i)||(t=!0)}for(const s of Object.keys(n))if(!Cr(e,s)){t=!0;break}return t?e:n}else return _n.validate(e)});function wy(n,e){return new QZ(n,e)}function OE(n,e){return new Yv(n,e,(t,s)=>{throw new He(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(s)}`,[n])},!1)}function nJ(n,e){return new Yv(n,e,(t,s)=>{throw new He(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(s)}`,[n])},!0)}function Lr(n,e){return new us(t=>Ms(n,()=>e.validate(t)),(t,s)=>Ms(n,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(t,s):e.validate(s)))}function Xv(n){return new us(e=>{if(!n.has(e)){const t=Array.from(n,s=>JSON.stringify(s)).join(" or ");throw new He(`Expected ${t}, got ${e}`)}return e})}function ND(n){return new us(e=>{if(e!==void 0)return n.validate(e)},(e,t)=>{if(!(e===void 0&&t===void 0)&&t!==void 0)return n.validateUsingKnownGoodVersion&&e!==void 0?n.validateUsingKnownGoodVersion(e,t):n.validate(t)})}function sJ(n){return new us(e=>e===null?null:n.validate(e),(e,t)=>t===null?null:n.validateUsingKnownGoodVersion&&e!==null?n.validateUsingKnownGoodVersion(e,t):n.validate(t))}function qv(...n){return Xv(new Set(n))}function DE(n){try{return new URL(n)}catch{if(n.startsWith("/")||n.startsWith("./"))try{return new URL(n,"http://example.com")}catch{throw new He(`Expected a valid url, got ${JSON.stringify(n)}`)}throw new He(`Expected a valid url, got ${JSON.stringify(n)}`)}}const iJ=new Set(["http:","https:","mailto:"]),Qs=Pe.check(n=>{if(n==="")return;const e=DE(n);if(!iJ.has(e.protocol.toLowerCase()))throw new He(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),rJ=new Set(["http:","https:","data:","asset:"]),kl=Pe.check(n=>{if(n==="")return;const e=DE(n);if(!rJ.has(e.protocol.toLowerCase()))throw new He(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});Pe.check(n=>{if(n==="")return;if(!DE(n).protocol.toLowerCase().match(/^https?:$/))throw new He(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});const LE=Pe.refine(n=>{try{return EZ(n),n}catch{throw new He(`Expected an index key, got ${JSON.stringify(n)}`)}});function Ys(n){return Pe.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const Zv=Ys("asset");function FE(n,e){return Le({id:Zv,typeName:Xn("asset"),type:Xn(n),props:e,meta:_n})}const Al=Le({x:_e,y:_e,z:_e.optional()}),bh=Le({x:_e,y:_e,w:_e,h:_e}),RD=_e.check(n=>{if(n<0||n>1)throw new He("Opacity must be between 0 and 1")}),oJ=Pe.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),ci=Ys("shape");function aJ(n,e,t){return Le({id:ci,typeName:Xn("shape"),x:_e,y:_e,rotation:_e,index:LE,parentId:oJ,type:Xn(n),isLocked:Me,opacity:RD,props:e?Le(e):_n,meta:t?Le(t):_n})}const lJ=Ys("binding");function cJ(n,e,t){return Le({id:lJ,typeName:Xn("binding"),type:Xn(n),fromId:ci,toId:ci,props:e?Le(e):_n,meta:t?Le(t):_n})}Os("com.tldraw.binding",{});si({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function bl(n){return`binding:${Mp()}`}function dJ(n){return Dr("binding",{scope:"document",validator:Lr("binding",OE("type",Rp(n,(e,{props:t,meta:s})=>cJ(e,t,s))))}).withDefaultProperties(()=>({meta:{}}))}class kn{constructor(e,t,s){this.id=e,this.defaultValue=t,this.type=s}static define(e,t){const{defaultValue:s,type:i=eJ}=t;return new kn(e,s,i)}static defineEnum(e,t){const{defaultValue:s,values:i}=t;return new uJ(e,s,i)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class uJ extends kn{constructor(e,t,s){super(e,t,qv(...s)),this.values=s}}const Hf=Os("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),hJ=si({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:Hf.AddIsLocked,up:n=>{n.isLocked=!1},down:n=>{delete n.isLocked}},{id:Hf.HoistOpacity,up:n=>{n.opacity=Number(n.props.opacity??"1"),delete n.props.opacity},down:n=>{const e=n.opacity;delete n.opacity,n.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:Hf.AddMeta,up:n=>{n.meta={}}},{id:Hf.AddWhite,up:n=>{},down:n=>{n.props.color==="white"&&(n.props.color="black")}}]});function Fc(n){return n?n.typeName==="shape":!1}function Ss(n){return n?n.startsWith("shape:"):!1}function st(n){return`shape:${n??Mp()}`}function MD(n){const e=new Map;for(const[t,s]of Object.entries(n))if(s instanceof kn){if(e.has(s))throw new Error(`Duplicate style prop ${s.id}. Each style prop can only be used once within a shape.`);e.set(s,t)}return e}function Ji(n,e){return Rp(e,(t,s)=>`com.tldraw.shape.${n}/${s}`)}function pJ(n){return Dr("shape",{scope:"document",validator:Lr("shape",OE("type",Rp(n,(e,{props:t,meta:s})=>aJ(e,t,s))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function Mk(n,e){const t=[];for(const[s,{migrations:i}]of Object.entries(e)){const r=`com.tldraw.${n}.${s}`;i?"sequenceId"in i?(mt(r===i.sequenceId,`sequenceId mismatch for ${s} ${Kv} migrations. Expected '${r}', got '${i.sequenceId}'`),t.push(i)):"sequence"in i?t.push(Jc({sequenceId:r,retroactive:!1,sequence:i.sequence.map(o=>"id"in o?OD(n,s,o):o)})):t.push(Jc({sequenceId:r,retroactive:!1,sequence:Object.keys(i.migrators).map(o=>Number(o)).sort((o,l)=>o-l).map(o=>({id:`${r}/${o}`,scope:"record",filter:l=>l.typeName===n&&l.type===s,up:l=>{const c=i.migrators[o].up(l);if(c)return c},down:l=>{const c=i.migrators[o].down(l);if(c)return c}}))})):t.push(Jc({sequenceId:r,retroactive:!1,sequence:[]}))}return t}function OD(n,e,t){return{id:t.id,dependsOn:t.dependsOn,scope:"record",filter:s=>s.typeName===n&&s.type===e,up:s=>{const i=t.up(s.props);i&&(s.props=i)},down:typeof t.down=="function"?s=>{const i=t.down(s.props);i&&(s.props=i)}:void 0}}const DD=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],by={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function No(n){return n.isDarkMode?by.darkMode:by.lightMode}const ei=kn.defineEnum("tldraw:color",{defaultValue:"black",values:DD}),LD=kn.defineEnum("tldraw:labelColor",{defaultValue:"black",values:DD}),jl=kn.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Nl=kn.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),jr=kn.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),FD={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Nr=kn.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),BD=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],_y=kn.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:BD}),Cy=kn.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:BD}),UD={labelColor:LD,color:ei,fill:Nl,dash:jl,size:Nr,arrowheadStart:_y,arrowheadEnd:Cy,font:jr,start:Al,end:Al,bend:_e,text:Pe,labelPosition:_e,scale:Kt},xc=Ji("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function Gf(n){return OD("shape","arrow",n)}const $D=Jc({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[Gf({id:xc.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"}),Gf({id:xc.AddIsPrecise,up:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise=!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise||(n.normalizedAnchor={x:.5,y:.5}),delete n.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),Gf({id:xc.AddLabelPosition,up:n=>{n.labelPosition=.5},down:n=>{delete n.labelPosition}}),{id:xc.ExtractBindings,scope:"store",up:n=>{const e=Object.values(n).filter(t=>t.typeName==="shape"&&t.type==="arrow");for(const t of e){const{start:s,end:i}=t.props;if(s.type==="binding"){const r=bl(),o={typeName:"binding",id:r,type:"arrow",fromId:t.id,toId:s.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:s.normalizedAnchor,isExact:s.isExact,isPrecise:s.isPrecise}};n[r]=o,t.props.start={x:0,y:0}}else delete t.props.start.type;if(i.type==="binding"){const r=bl(),o={typeName:"binding",id:r,type:"arrow",fromId:t.id,toId:i.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};n[r]=o,t.props.end={x:0,y:0}}else delete t.props.end.type}}},Gf({id:xc.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}})]}),zD={terminal:qv("start","end"),normalizedAnchor:Al,isExact:Me,isPrecise:Me},WD={sequence:[{dependsOn:[xc.ExtractBindings]}]},fJ=Lr("camera",Le({typeName:Xn("camera"),id:Ys("camera"),x:_e,y:_e,z:_e,meta:_n})),gJ=Os("com.tldraw.camera",{AddMeta:1}),mJ=si({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:gJ.AddMeta,up:n=>{n.meta={}}}]}),mr=Dr("camera",{validator:fJ,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),yJ=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),HD=Xv(yJ),vJ=Le({type:HD,rotation:_e}),xJ=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),SJ=Xv(xJ),wJ=new Set(["starting","paused","active","stopping"]),GD=Le({id:Pe,points:bn(Al),size:Sy,color:SJ,opacity:_e,state:Xv(wJ),delay:_e,shrink:_e,taper:Me}),np=Ys("page"),bJ=Lr("page",Le({typeName:Xn("page"),id:np,name:Pe,index:LE,meta:_n})),_J=Os("com.tldraw.page",{AddMeta:1}),CJ=si({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:_J.AddMeta,up:n=>{n.meta={}}}]}),So=Dr("page",{validator:bJ,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function vs(n){return So.isId(n)}const EJ={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1},VD=n=>n?Sh(n,e=>EJ[e]):null;Ys("instance");function TJ(n){const e={};for(const[s,i]of n)e[s]=ND(i);const t=Lr("instance",Le({typeName:Xn("instance"),id:Ys("instance"),currentPageId:np,followingUserId:Pe.nullable(),brush:bh.nullable(),opacityForNextShape:RD,stylesForNextShape:Le(e),cursor:vJ,scribbles:bn(GD),isFocusMode:Me,isDebugMode:Me,isToolLocked:Me,exportBackground:Me,screenBounds:bh,insets:bn(Me),zoomBrush:bh.nullable(),isPenMode:Me,isGridMode:Me,chatMessage:Pe,isChatting:Me,highlightedUserIds:bn(Pe),isFocused:Me,devicePixelRatio:_e,isCoarsePointer:Me,isHoveringCanvas:Me.nullable(),openMenus:bn(Pe),isChangingStyle:Me,isReadonly:Me,meta:_n,duplicateProps:Le({shapeIds:bn(Ys("shape")),offset:Le({x:_e,y:_e})}).nullable()}));return Dr("instance",{validator:t,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const vt=Os("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),IJ=si({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:vt.AddTransparentExportBgs,up:n=>({...n,exportBackground:!0})},{id:vt.RemoveDialog,up:({dialog:n,...e})=>e},{id:vt.AddToolLockMode,up:n=>({...n,isToolLocked:!1})},{id:vt.RemoveExtraPropsForNextShape,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))})},{id:vt.AddLabelColor,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}})},{id:vt.AddFollowingUserId,up:n=>({...n,followingUserId:null})},{id:vt.RemoveAlignJustify,up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}}},{id:vt.AddZoom,up:n=>({...n,zoomBrush:null})},{id:vt.AddVerticalAlign,up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}})},{id:vt.AddScribbleDelay,up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n}},{id:vt.RemoveUserId,up:({userId:n,...e})=>e},{id:vt.AddIsPenModeAndIsGridMode,up:n=>({...n,isPenMode:!1,isGridMode:!1})},{id:vt.HoistOpacity,up:({propsForNextShape:{opacity:n,...e},...t})=>({...t,opacityForNextShape:Number(n??"1"),propsForNextShape:e})},{id:vt.AddChat,up:n=>({...n,chatMessage:"",isChatting:!1})},{id:vt.AddHighlightedUserIds,up:n=>({...n,highlightedUserIds:[]})},{id:vt.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}})},{id:vt.AddMeta,up:n=>({...n,meta:{}})},{id:vt.RemoveCursorColor,up:n=>{const{color:e,...t}=n.cursor;return{...n,cursor:t}}},{id:vt.AddLonelyProperties,up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:vt.ReadOnlyReadonly,up:({isReadOnly:n,...e})=>({...e,isReadonly:n})},{id:vt.AddHoveringCanvas,up:n=>({...n,isHoveringCanvas:null})},{id:vt.AddScribbles,up:({scribble:n,...e})=>({...e,scribbles:[]})},{id:vt.AddInset,up:n=>({...n,insets:[!1,!1,!1,!1]}),down:({insets:n,...e})=>({...e})},{id:vt.AddDuplicateProps,up:n=>({...n,duplicateProps:null}),down:({duplicateProps:n,...e})=>({...e})},{id:vt.RemoveCanMoveCamera,up:({canMoveCamera:n,...e})=>({...e}),down:n=>({...n,canMoveCamera:!0})}]}),ns="instance:instance",PJ=Lr("instance_page_state",Le({typeName:Xn("instance_page_state"),id:Ys("instance_page_state"),pageId:np,selectedShapeIds:bn(ci),hintingShapeIds:bn(ci),erasingShapeIds:bn(ci),hoveredShapeId:ci.nullable(),editingShapeId:ci.nullable(),croppingShapeId:ci.nullable(),focusedGroupId:ci.nullable(),meta:_n})),xu=Os("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),kJ=si({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:xu.AddCroppingId,up(n){n.croppingShapeId=null}},{id:xu.RemoveInstanceIdAndCameraId,up(n){delete n.instanceId,delete n.cameraId}},{id:xu.AddMeta,up:n=>{n.meta={}}},{id:xu.RenameProperties,up:n=>{},down:n=>{}},{id:xu.RenamePropertiesAgain,up:n=>{n.selectedShapeIds=n.selectedIds,delete n.selectedIds,n.hintingShapeIds=n.hintingIds,delete n.hintingIds,n.erasingShapeIds=n.erasingIds,delete n.erasingIds,n.hoveredShapeId=n.hoveredId,delete n.hoveredId,n.editingShapeId=n.editingId,delete n.editingId,n.croppingShapeId=n.croppingShapeId??n.croppingId??null,delete n.croppingId,n.focusedGroupId=n.focusLayerId,delete n.focusLayerId},down:n=>{n.selectedIds=n.selectedShapeIds,delete n.selectedShapeIds,n.hintingIds=n.hintingShapeIds,delete n.hintingShapeIds,n.erasingIds=n.erasingShapeIds,delete n.erasingShapeIds,n.hoveredId=n.hoveredShapeId,delete n.hoveredShapeId,n.editingId=n.editingShapeId,delete n.editingShapeId,n.croppingId=n.croppingShapeId,delete n.croppingShapeId,n.focusLayerId=n.focusedGroupId,delete n.focusedGroupId}}]}),Bi=Dr("instance_page_state",{validator:PJ,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),AJ=Lr("pointer",Le({typeName:Xn("pointer"),id:Ys("pointer"),x:_e,y:_e,lastActivityTimestamp:_e,meta:_n})),jJ=Os("com.tldraw.pointer",{AddMeta:1}),NJ=si({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:jJ.AddMeta,up:n=>{n.meta={}}}]}),BE=Dr("pointer",{validator:AJ,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),Ey=BE.createId("pointer"),RJ=Lr("instance_presence",Le({typeName:Xn("instance_presence"),id:Ys("instance_presence"),userId:Pe,userName:Pe,lastActivityTimestamp:_e,followingUserId:Pe.nullable(),cursor:Le({x:_e,y:_e,type:HD,rotation:_e}),color:Pe,camera:Le({x:_e,y:_e,z:_e}),screenBounds:bh,selectedShapeIds:bn(Ys("shape")),currentPageId:Ys("page"),brush:bh.nullable(),scribbles:bn(GD),chatMessage:Pe,meta:_n})),Su=Os("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),MJ=si({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:Su.AddScribbleDelay,up:n=>{n.scribble!==null&&(n.scribble.delay=0)}},{id:Su.RemoveInstanceId,up:n=>{delete n.instanceId}},{id:Su.AddChatMessage,up:n=>{n.chatMessage=""}},{id:Su.AddMeta,up:n=>{n.meta={}}},{id:Su.RenameSelectedShapeIds,up:n=>{}}]}),OJ=Dr("instance_presence",{validator:RJ,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),DJ=Lr("document",Le({typeName:Xn("document"),id:Xn("document:document"),gridSize:_e,name:Pe,meta:_n})),Ok=Os("com.tldraw.document",{AddName:1,AddMeta:2}),LJ=si({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:Ok.AddName,up:n=>{n.name=""},down:n=>{delete n.name}},{id:Ok.AddMeta,up:n=>{n.meta={}}}]}),UE=Dr("document",{validator:DJ,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),V0=UE.createId("document");function FJ(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function Dk(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}const BJ=({error:n,phase:e,record:t,recordBefore:s})=>{throw EE(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:s?Dk(ft(s)):void 0,recordAfter:Dk(ft(t))}}),n};function UJ(){return[So.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function $J(n){const e=n.query.ids("page"),t=()=>{if(!n.has(V0))return n.put([UE.create({id:V0,name:n.props.defaultName})]),t();if(!n.has(Ey))return n.put([BE.create({id:Ey})]),t();const s=e.get();if(s.size===0)return n.put(UJ()),t();const i=()=>[...s].map(c=>n.get(c)).sort(FJ)[0].id,r=n.get(ns);if(r){if(!s.has(r.currentPageId))return n.put([{...r,currentPageId:i()}]),t()}else return n.put([n.schema.types.instance.create({id:ns,currentPageId:i(),exportBackground:!0})]),t();const o=new Set,l=new Set;for(const c of s){const d=Bi.createId(c);n.has(d)||o.add(d);const u=mr.createId(c);n.has(u)||l.add(u)}o.size>0&&n.put([...o].map(c=>Bi.create({id:c,pageId:Bi.parseId(c)}))),l.size>0&&n.put([...l].map(c=>mr.create({id:c})))};return t}const zJ=FE("bookmark",Le({title:Pe,description:Pe,image:Pe,favicon:Pe,src:kl.nullable()})),Lk=Os("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),WJ=si({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:n=>n.type==="bookmark",sequence:[{id:Lk.MakeUrlsValid,up:n=>{kl.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:Lk.AddFavicon,up:n=>{kl.isValid(n.props.favicon)||(n.props.favicon="")},down:n=>{delete n.props.favicon}}]}),HJ=FE("image",Le({w:_e,h:_e,name:Pe,isAnimated:Me,mimeType:Pe.nullable(),src:kl.nullable(),fileSize:Kt.optional()})),wu=Os("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),GJ=si({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:n=>n.type==="image",sequence:[{id:wu.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:wu.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:wu.MakeUrlsValid,up:n=>{kl.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:wu.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:wu.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),VJ=FE("video",Le({w:_e,h:_e,name:Pe,isAnimated:Me,mimeType:Pe.nullable(),src:kl.nullable(),fileSize:_e.optional()})),bu=Os("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),KJ=si({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:n=>n.type==="video",sequence:[{id:bu.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:bu.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:bu.MakeUrlsValid,up:n=>{kl.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:bu.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:bu.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),YJ=Lr("asset",OE("type",{image:HJ,video:VJ,bookmark:zJ})),XJ=Os("com.tldraw.asset",{AddMeta:1}),qJ=si({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:XJ.AddMeta,up:n=>{n.meta={}}}]}),fl=Dr("asset",{validator:YJ,scope:"document"}).withDefaultProperties(()=>({meta:{}})),KD={w:Kt,h:Kt,assetId:Zv.nullable(),url:Qs},Fk=Ji("bookmark",{NullAssetId:1,MakeUrlsValid:2}),YD={sequence:[{id:Fk.NullAssetId,up:n=>{n.assetId===void 0&&(n.assetId=null)},down:"retired"},{id:Fk.MakeUrlsValid,up:n=>{Qs.isValid(n.url)||(n.url="")},down:n=>{}}]},XD=Le({type:qv("free","straight"),points:bn(Al)}),qD={color:ei,fill:Nl,dash:jl,size:Nr,segments:bn(XD),isComplete:Me,isClosed:Me,isPen:Me,scale:Kt},Bk=Ji("draw",{AddInPen:1,AddScale:2}),ZD={sequence:[{id:Bk.AddInPen,up:n=>{const{points:e}=n.segments[0];if(e.length===0){n.isPen=!1;return}let t=!(e[0].z===0||e[0].z===.5);e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),n.isPen=t},down:"retired"},{id:Bk.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]};var ZJ={};const Uk=/(^\/r\/[^/]+\/?$)/,Ze=n=>{try{return new URL(n)}catch{return}},Op=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(Uk))return n},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(Uk))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:n=>{if(n.includes("/maps/")){const e=n.match(/@(.*),(.*),(.*)z/);let t;if(e){const[,s,i,r]=e;t=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${ZJ.NEXT_PUBLIC_GC_API_KEY}&center=${s},${i}&zoom=${r}`}else t="";return t}},fromEmbedUrl:n=>{const e=Ze(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const s=e.searchParams.get("zoom"),[i,r]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${r},${s}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ze(n),t=e&&e.pathname.match(/\/v\/(.+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Ze(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ze(n),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Ze(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=n.match(e);if(t){const[s,i,r]=t;return`https://codepen.io/${i}/embed/${r}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[s,i,r]=t;return`https://codepen.io/${i}/pen/${r}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=n.match(e);if(t){const[s,i]=t;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[s,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ze(n);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=Ze(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const s=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(s)return`https://www.youtube.com/watch?v=${s[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=Ze(n),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const s=Array.from(e.searchParams.keys());for(const i of s)e.searchParams.delete(i);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:n=>{const e=Ze(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const s=Array.from(e.searchParams.keys());for(const i of s)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=Ze(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const s of t)e.searchParams.delete(s);return e.href}},fromEmbedUrl:n=>{const e=Ze(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const s of t)e.searchParams.delete(s);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ze(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ze(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:n=>{const e=Ze(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${n}?embed`},fromEmbedUrl:n=>{const e=Ze(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],JJ={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},JD={w:Kt,h:Kt,url:Pe},Vf=Ji("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),QD={sequence:[{id:Vf.GenOriginalUrlInEmbed,up:n=>{try{const e=n.url,t=new URL(e).host.replace("www.","");let s;for(const i of Op)if(i.hostnames.includes(t))try{s=i.fromEmbedUrl(e)}catch(r){console.warn(r)}n.tmpOldUrl=n.url,n.url=s??""}catch{n.url="",n.tmpOldUrl=n.url}},down:"retired"},{id:Vf.RemoveDoesResize,up:n=>{delete n.doesResize},down:"retired"},{id:Vf.RemoveTmpOldUrl,up:n=>{delete n.tmpOldUrl},down:"retired"},{id:Vf.RemovePermissionOverrides,up:n=>{delete n.overridePermissions},down:"retired"}]},eL={w:Kt,h:Kt,name:Pe},tL={sequence:[]},Ty=kn.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Iy=kn.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),mi=kn.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),nL={geo:mi,labelColor:LD,color:ei,fill:Nl,dash:jl,size:Nr,font:jr,align:Ty,verticalAlign:Iy,url:Qs,w:Kt,h:Kt,growY:Sy,text:Pe,scale:Kt},zr=Ji("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),sL={sequence:[{id:zr.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:zr.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"},{id:zr.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:zr.AddCheckBox,up:n=>{},down:"retired"},{id:zr.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:zr.MigrateLegacyAlign,up:n=>{let e;switch(n.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}n.align=e},down:"retired"},{id:zr.AddCloud,up:n=>{},down:"retired"},{id:zr.MakeUrlsValid,up:n=>{Qs.isValid(n.url)||(n.url="")},down:n=>{}},{id:zr.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},iL={},rL={sequence:[]},oL={color:ei,size:Nr,segments:bn(XD),isComplete:Me,isPen:Me,scale:Kt},QJ=Ji("highlight",{AddScale:1}),aL={sequence:[{id:QJ.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},eQ=Le({topLeft:Al,bottomRight:Al}),lL={w:Kt,h:Kt,playing:Me,url:Qs,assetId:Zv.nullable(),crop:eQ.nullable(),flipX:Me,flipY:Me},Kf=Ji("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),cL={sequence:[{id:Kf.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Kf.AddCropProp,up:n=>{n.crop=null},down:n=>{delete n.crop}},{id:Kf.MakeUrlsValid,up:n=>{Qs.isValid(n.url)||(n.url="")},down:n=>{}},{id:Kf.AddFlipProps,up:n=>{n.flipX=!1,n.flipY=!1},down:n=>{delete n.flipX,delete n.flipY}}]},Py=kn.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),tQ=Le({id:Pe,index:LE,x:_e,y:_e}),dL={color:ei,dash:jl,size:Nr,spline:Py,points:wy(Pe,tQ),scale:Kt},_u=Ji("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),uL={sequence:[{id:_u.AddSnapHandles,up:n=>{for(const e of Object.values(n.handles))e.canSnap=!0},down:"retired"},{id:_u.RemoveExtraHandleProps,up:n=>{n.handles=gD(Object.values(n.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:n=>{const e=Object.entries(n.handles).map(([t,s])=>({index:t,...s})).sort(Hn);n.handles=Object.fromEntries(e.map((t,s)=>{const i=s===0?"start":s===e.length-1?"end":`handle:${t.index}`;return[i,{id:i,type:"vertex",canBind:!1,canSnap:!0,index:t.index,x:t.x,y:t.y}]}))}},{id:_u.HandlesToPoints,up:n=>{const e=Object.entries(n.handles).map(([t,{x:s,y:i}])=>({x:s,y:i,index:t})).sort(Hn);n.points=e.map(({x:t,y:s})=>({x:t,y:s})),delete n.handles},down:n=>{const e=tp(n.points.length);n.handles=Object.fromEntries(n.points.map((t,s)=>[e[s],{x:t.x,y:t.y}])),delete n.points}},{id:_u.PointIndexIds,up:n=>{const e=tp(n.points.length);n.points=Object.fromEntries(n.points.map((t,s)=>{const i=e[s];return[i,{id:i,index:i,x:t.x,y:t.y}]}))},down:n=>{const e=Object.values(n.points).sort(Hn);n.points=e.map(({x:t,y:s})=>({x:t,y:s}))}},{id:_u.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},hL={color:ei,size:Nr,font:jr,fontSizeAdjustment:Sy,align:Ty,verticalAlign:Iy,growY:Sy,url:Qs,text:Pe,scale:Kt},sl=Ji("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7}),pL={sequence:[{id:sl.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:sl.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:sl.MigrateLegacyAlign,up:n=>{switch(n.align){case"start":n.align="start-legacy";return;case"end":n.align="end-legacy";return;default:n.align="middle-legacy";return}},down:"retired"},{id:sl.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:sl.MakeUrlsValid,up:n=>{Qs.isValid(n.url)||(n.url="")},down:n=>{}},{id:sl.AddFontSizeAdjustment,up:n=>{n.fontSizeAdjustment=0},down:n=>{delete n.fontSizeAdjustment}},{id:sl.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},K0=kn.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),fL={color:ei,size:Nr,font:jr,textAlign:K0,w:Kt,text:Pe,scale:Kt,autoSize:Me},$k=Ji("text",{RemoveJustify:1,AddTextAlign:2}),gL={sequence:[{id:$k.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:$k.AddTextAlign,up:n=>{n.textAlign=n.align,delete n.align},down:n=>{n.align=n.textAlign,delete n.textAlign}}]},mL={w:Kt,h:Kt,time:_e,playing:Me,url:Qs,assetId:Zv.nullable()},zk=Ji("video",{AddUrlProp:1,MakeUrlsValid:2}),yL={sequence:[{id:zk.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:zk.MakeUrlsValid,up:n=>{Qs.isValid(n.url)||(n.url="")},down:n=>{}}]},Yf=Os("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),nQ=Jc({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:Yf.RemoveCodeAndIconShapeTypes,scope:"store",up:n=>{for(const[e,t]of Rs(n))t.typeName==="shape"&&(t.type==="icon"||t.type==="code")&&delete n[e]}},{id:Yf.AddInstancePresenceType,scope:"store",up(n){}},{id:Yf.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:n=>{for(const[e,t]of Rs(n))t.typeName.match(/^(user|user_presence)$/)&&delete n[e]}},{id:Yf.RemoveUserDocument,scope:"store",up:n=>{for(const[e,t]of Rs(n))t.typeName.match("user_document")&&delete n[e]}}]}),sQ={arrow:{migrations:$D,props:UD},bookmark:{migrations:YD,props:KD},draw:{migrations:ZD,props:qD},embed:{migrations:QD,props:JD},frame:{migrations:tL,props:eL},geo:{migrations:sL,props:nL},group:{migrations:rL,props:iL},highlight:{migrations:aL,props:oL},image:{migrations:cL,props:lL},line:{migrations:uL,props:dL},note:{migrations:pL,props:hL},text:{migrations:gL,props:fL},video:{migrations:yL,props:mL}},iQ={arrow:{migrations:WD,props:zD}};function rQ({shapes:n=sQ,bindings:e=iQ,migrations:t}={}){const s=new Map;for(const l of Ut(n))for(const c of MD(l.props??{}).keys()){if(s.has(c.id)&&s.get(c.id)!==c)throw new Error(`Multiple StyleProp instances with the same id: ${c.id}`);s.set(c.id,c)}const i=pJ(n),r=dJ(e),o=TJ(s);return RE.create({asset:fl,binding:r,camera:mr,document:UE,instance:o,instance_page_state:Bi,page:So,instance_presence:OJ,pointer:BE,shape:i},{migrations:[nQ,qJ,mJ,LJ,IJ,kJ,CJ,MJ,NJ,hJ,WJ,GJ,KJ,...Mk("shape",n),...Mk("binding",e),...t??[]],onValidationFailure:BJ,createIntegrityChecker:$J})}const sp=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Catal"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espaol"},{locale:"fr",label:"Franais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugus - Brasil"},{locale:"pt-pt",label:"Portugus - Europeu"},{locale:"ro",label:"Romn"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"Trke"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ku",label:""},{locale:"ne",label:""},{locale:"hi-in",label:""},{locale:"te",label:""},{locale:"th",label:""},{locale:"my",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function oQ(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return aQ(n)}function aQ(n){for(const e of n){const t=lQ(e);if(t)return t}return"en"}const Wk={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function lQ(n){const e=sp.find(i=>i.locale===n.toLowerCase());if(e)return e.locale;const[t,s]=n.split(/[-_]/).map(i=>i.toLowerCase());if(s){const i=sp.find(r=>r.locale===t);if(i)return i.locale}return t in Wk?Wk[t]:null}function Jv(n,e){const t=Oe.useRef(e);t.current=e;const[s,i,r]=Oe.useMemo(()=>{let o=null;const l=u=>(o=u,()=>{o=null}),c=new Fd(`useStateTracking(${n})`,()=>{var u;return(u=t.current)==null?void 0:u.call(t)},{scheduleEffect(){o==null||o()}});return[c,l,()=>c.scheduleCount]},[n]);return Oe.useSyncExternalStore(i,r,r),Oe.useEffect(()=>(s.attach(),s.maybeScheduleEffect(),()=>{s.detach()}),[s]),s.execute()}const Hk={apply(n,e,t){return Jv(n.displayName??n.name??"tracked(???)",()=>n.apply(e,t))}},cQ=Symbol.for("react.memo"),dQ=Symbol.for("react.forward_ref");function pn(n){let e=null;const t=n.$$typeof;return t===cQ&&(n=n.type,e=n.compare),t===dQ?b.memo(b.forwardRef(new Proxy(n.render,Hk))):b.memo(new Proxy(n,Hk),e)}function uQ(){const n=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],s=arguments.length===3?arguments[2]:arguments[3];return b.useMemo(()=>Q(`useComputed(${n})`,e,t),s)}function Sa(n,e,t=co){b.useEffect(()=>{const s=new Fd(n,e);return s.attach(),s.execute(),()=>{s.detach()}},t)}function q(){const n=arguments,e=n.length===3?n[2]:[n[0]],t=n.length===3?n[0]:`useValue(${n[0].name})`,s=b.useRef(!0);s.current=!0;const i=b.useMemo(()=>n.length===1?n[0]:Q(t,()=>{if(s.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:r,getSnapshot:o}=b.useMemo(()=>({subscribe:l=>Zl(`useValue(${t})`,()=>{i.get(),l()}),getSnapshot:()=>i.get()}),[i]);return b.useSyncExternalStore(r,o,o)}finally{s.current=!1}}var vL={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var r="",o=0;o<arguments.length;o++){var l=arguments[o];l&&(r=i(r,s(l)))}return r}function s(r){if(typeof r=="string"||typeof r=="number")return r;if(typeof r!="object")return"";if(Array.isArray(r))return t.apply(null,r);if(r.toString!==Object.prototype.toString&&!r.toString.toString().includes("[native code]"))return r.toString();var o="";for(var l in r)e.call(r,l)&&r[l]&&(o=i(o,l));return o}function i(r,o){return o?r?r+" "+o:r+o:r}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(vL);var hQ=vL.exports;const Se=Oa(hQ),xL="2.4.6",Gk={major:"2024-06-28T10:56:07.893Z",minor:"2024-07-22T16:42:50.301Z"},pQ={error:null};let SL=class extends b.Component{constructor(){super(...arguments);w(this,"state",pQ)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var s,i;(i=(s=this.props).onError)==null||i.call(s,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:s}=this.props;return a.jsx(s,{error:t})}return this.props.children}};function ip({children:n,fallback:e,...t}){return e===null?n:a.jsx(SL,{fallback:e,...t,children:n})}const Qv=b.createContext(null);function G(){const n=Oe.useContext(Qv);if(!n)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return n}function fQ(){return a.jsx("div",{className:"tl-background"})}function $d(n,e,t,s,i,r){b.useLayoutEffect(()=>{const o=n.current;if(!o||e===void 0)return;let l=`translate(${e}px, ${t}px)`;s!==void 0&&(l+=` scale(${s})`),i!==void 0&&(l+=` rotate(${i}rad)`),r&&(l+=` translate(${r.x}px, ${r.y}px)`),o.style.transform=l})}const ln={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class _{constructor(e=0,t=0,s=1){this.x=e,this.y=t,this.z=s}get pressure(){return this.z}set(e=this.x,t=this.y,s=this.z){return this.x=e,this.y=t,this.z=s,this}setTo({x:e=0,y:t=0,z:s=1}){return this.x=e,this.y=t,this.z=s,this}rot(e){if(e===0)return this;const{x:t,y:s}=this,i=Math.sin(e),r=Math.cos(e);return this.x=t*r-s*i,this.y=t*i+s*r,this}rotWith(e,t){if(t===0)return this;const s=this.x-e.x,i=this.y-e.y,r=Math.sin(t),o=Math.cos(t);return this.x=e.x+(s*o-i*r),this.y=e.y+(s*r+i*o),this}clone(){const{x:e,y:t,z:s}=this;return new _(e,t,s)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const s=_.Tan(e,this);return this.add(s.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return _.Dpr(this,e)}cpr(e){return _.Cpr(this,e)}len2(){return _.Len2(this)}len(){return _.Len(this)}pry(e){return _.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return _.Uni(this)}tan(e){return _.Tan(this,e)}dist(e){return _.Dist(this,e)}distanceToLineSegment(e,t){return _.DistanceToLineSegment(e,t,this)}slope(e){return _.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return _.Angle(this,e)}toAngle(){return _.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return _.Equals(this,e)}equalsXY(e,t){return _.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return _.ToFixed(this)}toString(){return _.ToString(_.ToFixed(this))}toJson(){return _.ToJson(this)}toArray(){return _.ToArray(this)}static Add(e,t){return new _(e.x+t.x,e.y+t.y)}static AddXY(e,t,s){return new _(e.x+t,e.y+s)}static Sub(e,t){return new _(e.x-t.x,e.y-t.y)}static SubXY(e,t,s){return new _(e.x-t,e.y-s)}static AddScalar(e,t){return new _(e.x+t,e.y+t)}static SubScalar(e,t){return new _(e.x-t,e.y-t)}static Div(e,t){return new _(e.x/t,e.y/t)}static Mul(e,t){return new _(e.x*t,e.y*t)}static DivV(e,t){return new _(e.x/t.x,e.y/t.y)}static MulV(e,t){return new _(e.x*t.x,e.y*t.y)}static Neg(e){return new _(-e.x,-e.y)}static Per(e){return new _(e.y,-e.x)}static Abs(e){return new _(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,s){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<s**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new _(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return _.Dpr(e,t)/_.Len(t)}static Uni(e){return _.Div(e,_.Len(e))}static Tan(e,t){return _.Uni(_.Sub(e,t))}static Min(e,t){return new _(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new _(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:s=1}){return new _(e,t,s)}static FromArray(e){return new _(e[0],e[1])}static Rot(e,t=0){const s=Math.sin(t),i=Math.cos(t);return new _(e.x*i-e.y*s,e.x*s+e.y*i)}static RotWith(e,t,s){const i=e.x-t.x,r=e.y-t.y,o=Math.sin(s),l=Math.cos(s);return new _(t.x+(i*l-r*o),t.y+(i*o+r*l))}static NearestPointOnLineThroughPoint(e,t,s){return _.Mul(t,_.Sub(s,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,s,i=!0){if(_.Equals(e,s)||_.Equals(t,s))return _.From(s);const r=_.Tan(t,e),o=_.Add(e,_.Mul(r,_.Sub(s,e).pry(r)));if(i){if(o.x<Math.min(e.x,t.x))return _.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return _.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return _.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return _.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,s){return _.Dist(s,_.NearestPointOnLineThroughPoint(e,t,s))}static DistanceToLineSegment(e,t,s,i=!0){return _.Dist(s,_.NearestPointOnLineSegment(e,t,s,i))}static Snap(e,t=1){return new _(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof _?e:_.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,s){return _.Sub(t,e).mul(s).add(e)}static Med(e,t){return new _((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,s){return e.x===t&&e.y===s}static Clockwise(e,t,s){return(s.x-e.x)*(t.y-e.y)-(t.x-e.x)*(s.y-e.y)<0}static Rescale(e,t){const s=_.Len(e);return new _(t*e.x/s,t*e.y/s)}static ScaleWithOrigin(e,t,s){return _.Sub(e,s).mul(t).add(s)}static ToFixed(e){return new _(qr(e.x),qr(e.y))}static ToInt(e){return new _(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,s){return _.Add(e,_.Tan(t,e).mul(s))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new _(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:s,z:i}=e;return{x:t,y:s,z:i}}static Average(e){const t=e.length,s=new _(0,0);if(t===0)return s;for(let i=0;i<t;i++)s.add(e[i]);return s.div(t)}static Clamp(e,t,s){return s===void 0?new _(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new _(Math.min(Math.max(e.x,t),s),Math.min(Math.max(e.y,t),s))}static PointsBetween(e,t,s=6){const i=[];for(let r=0;r<s;r++){const o=ln.easeInQuad(r/(s-1)),l=_.Lrp(e,t,o);l.z=Math.min(1,.5+Math.abs(.5-gQ(o))*.65),i.push(l)}return i}static SnapToGrid(e,t=8){return new _(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const gQ=n=>n<.5?2*n*n:-1+(4-2*n)*n;function Ye(n){return`${H(n.x)},${H(n.y)} `}function _s(n,e){return`${H((n.x+e.x)/2)},${H((n.y+e.y)/2)} `}const qe=Math.PI,gt=qe/2,et=qe*2,mQ=Math.sin;function tn(n,e,t){return Math.max(e,typeof t<"u"?Math.min(n,t):n)}function Xf(n,e=1e10){return n?Math.round(n*e)/e:0}function wa(n,e,t=1e-6){return Math.abs(n-e)<=t}function wL(n,e){const t=Math.pow(n-e,2)/Math.pow(n+e,2);return qe*(n+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function ba(n){return n=n%et,n<0?n=n+et:n===0&&(n=0),n}function Dp(n,e){return n=ba(n),e=ba(e),n>e&&(e+=et),e-n}function bL(n,e){return et-Dp(n,e)}function Zg(n,e){const t=(e-n)%et;return 2*t%et-t}function Y0(n){return(et+n)%et}function ky(n,e){const t=et/e;let s=Math.floor((Y0(n)+t/2)/t)*t%et;return s<qe&&(s+=et),s>qe&&(s-=et),s}function _L(n,e){return n===e||wa(n%(Math.PI/2)-e%(Math.PI/2),0)}function yQ(n){return n*qe/180}function vQ(n){return n*180/qe}function Rl(n,e,t){return new _(n.x,n.y).add(_.FromAngle(t,e))}function iw(n,e,t){const s=n/2,i=e/2,r=[];let o=1/0,l=-1/0,c=1/0,d=-1/0;for(let g=0;g<t;g++){const m=et/t,x=-gt+g*m,y=s+s*Math.cos(x),S=i+i*Math.sin(x);y<o&&(o=y),S<c&&(c=S),y>l&&(l=y),S>d&&(d=S),r.push(new _(y,S))}const u=l-o,h=d-c,p=n-u,f=e-h;if(p!==0||f!==0)for(let g=0;g<r.length;g++){const m=r[g];m.x=(m.x-o)/u*n,m.y=(m.y-c)/h*e}return r}function Cu(n,e,t,s){return n<s&&t<e}function Mi(n,e,t,s){const i=Math.max(n,t),r=Math.min(e,s);return i<=r?[i,r]:null}function Vk(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}function Xs(n,e){let t=0,s,i;for(let r=0;r<e.length;r++){if(s=e[r],s.x===n.x&&s.y===n.y||(i=e[(r+1)%e.length],_.Dist(n,s)+_.Dist(n,i)===_.Dist(s,i)))return!0;s.y<=n.y?i.y>n.y&&Vk(s,i,n)>0&&(t+=1):i.y<=n.y&&Vk(s,i,n)<0&&(t-=1)}return t!==0}function H(n){return Math.round(n*1e4)/1e4}function qr(n){return Math.round(n*100)/100}const Kk=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER;function ta(n,e,t){return t<0?Dp(n,e):bL(n,e)}function X0(n,e,t,s){let i;if(Math.abs(n)>qe){i=Zg(e,s);const r=Zg(s,t);return Math.abs(i)<Math.abs(r)?i/n:(n-r)/n}else{i=Zg(e,s);const r=i/n;return Math.sign(i)!==Math.sign(n)?Math.abs(r)>.5?1:0:r}}function xQ(n,e,t,s){const i=2*((e-n)%et)%et-(e-n)%et;return s?(et-Math.abs(i))*(t?1:-1):i}function $E(n,e,t){const s=-2*(n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y);return new _(((n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y))/s,((n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x))/s)}function SQ(n,e,t,s,i){if(t===null)return[_.From(n),_.From(e)];const r=[],o=_.Angle(t,n),l=_.Angle(t,e),c=Dp(o,l);for(let d=0;d<i;d++){const u=d/(i-1),h=o+c*u,p=Rl(t,s,h);r.push(p)}return r}const rw=({brush:n,color:e,opacity:t,className:s})=>{const i=b.useRef(null);$d(i,n.x,n.y);const r=H(Math.max(1,n.w)),o=H(Math.max(1,n.h));return a.jsx("svg",{className:"tl-overlays__item",ref:i,children:e?a.jsxs("g",{className:"tl-brush",opacity:t,children:[a.jsx("rect",{width:r,height:o,fill:e,opacity:.75}),a.jsx("rect",{width:r,height:o,fill:"none",stroke:e,opacity:.1})]}):a.jsx("rect",{className:`tl-brush tl-brush__default ${s}`,width:r,height:o})})},Yk={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},ow={duration:0,easing:ln.easeInOutCubic},Xk={CAMERA_MOVE:-10},wQ=["top","right","bottom","left"],qk=0,zE=2,qf=1,Zk=5,bQ=128;function Ay(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return Ay(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function ze(n){n.preventDefault(),Gt.logPreventDefaults.get()&&console.warn("preventDefault called on event:",n)}function Lp(n,e){if(n.setPointerCapture(e.pointerId),Gt.logPointerCaptures.get()){const t=ID.get();t.set(n,(t.get(n)??0)+1),console.warn("setPointerCapture called on element:",n,e)}}function Fp(n,e){if(n.hasPointerCapture(e.pointerId)&&(n.releasePointerCapture(e.pointerId),Gt.logPointerCaptures.get())){const t=ID.get();t.get(n)===1?t.delete(n):t.has(n)?t.set(n,t.get(n)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",n,e)}}const un=n=>n.stopPropagation(),Dn=(n,e,t)=>{n&&n.style.setProperty(e,t)};function Is(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}function CL(){const n=G();return b.useMemo(function(){let s,i;function r(m){if(!m.isKilled){if(m.button===zE){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...Is(m)});return}m.button!==0&&m.button!==1&&m.button!==5||(Lp(m.currentTarget,m),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Is(m)}))}}function o(m){m.isKilled||m.clientX===s&&m.clientY===i||(s=m.clientX,i=m.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Is(m)}))}function l(m){m.isKilled||m.button!==0&&m.button!==1&&m.button!==2&&m.button!==5||(s=m.clientX,i=m.clientY,Fp(m.currentTarget,m),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Is(m)}))}function c(m){if(m.isKilled||n.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const x=m.pointerType==="mouse"||m.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:x?!0:null})}function d(m){if(m.isKilled||n.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const x=m.pointerType==="mouse"||m.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:x?!1:null})}function u(m){m.isKilled=!0,ze(m)}function h(m){m.isKilled=!0,m.target instanceof HTMLElement&&m.target.tagName!=="A"&&m.target.tagName!=="TEXTAREA"&&!(n.getEditingShape()&&m.target.className.includes("tl-text-content"))&&ze(m)}function p(m){ze(m)}async function f(m){var y,S;if(ze(m),!((S=(y=m.dataTransfer)==null?void 0:y.files)!=null&&S.length))return;const x=Array.from(m.dataTransfer.files);await n.putExternalContent({type:"files",files:x,point:n.screenToPage({x:m.clientX,y:m.clientY}),ignoreParent:!1})}function g(m){un(m)}return{onPointerDown:r,onPointerMove:o,onPointerUp:l,onPointerEnter:c,onPointerLeave:d,onDragOver:p,onDrop:f,onTouchStart:u,onTouchEnd:h,onClick:g}},[n])}function _Q(){const n=G();b.useEffect(()=>{let e=n.getInstanceState().isCoarsePointer;const t=o=>{const l=o.pointerType!=="mouse";e!==l&&(e=l,n.updateInstanceState({isCoarsePointer:l}))};window.addEventListener("pointerdown",t,{capture:!0});const s=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),i=n.environment.isFirefox&&!n.environment.isAndroid&&!n.environment.isIos,r=()=>{const o=i?!1:s.matches;e===o&&(e=o,n.updateInstanceState({isCoarsePointer:o}))};return s&&(s.addEventListener("change",r),r()),()=>{window.removeEventListener("pointerdown",t,{capture:!0}),s&&s.removeEventListener("change",r)}},[n])}const EL=b.createContext(null);function CQ({container:n,children:e}){return a.jsx(EL.Provider,{value:n,children:e})}function fn(){return pi(b.useContext(EL),"useContainer used outside of <Tldraw />")}function EQ(){const n=G(),e=fn(),t=q("isFocused",()=>n.getIsFocused(),[n]);b.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let s=null;const i=()=>{s!=null&&s();const r=`(resolution: ${window.devicePixelRatio}dppx)`,o=matchMedia(r),l=c=>{c.type==="change"&&i()};o.addEventListener?o.addEventListener("change",i):o.addListener&&o.addListener(l),s=()=>{o.removeEventListener?o.removeEventListener("change",i):o.removeListener&&o.removeListener(l)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return i(),()=>{s==null||s()}},[n]),b.useEffect(()=>{if(!t)return;const s=l=>{if(l.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!Zf()&&ze(l),l.isKilled)return;switch(l.isKilled=!0,l.key){case"=":case"-":case"0":{if(l.metaKey||l.ctrlKey){ze(l);return}break}case"Tab":{if(Zf()||n.getIsMenuOpen())return;break}case",":return;case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&l.preventDefault(),n.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),n.focus());return}default:if(Zf()||n.getIsMenuOpen())return}const c={type:"keyboard",name:l.repeat?"key_repeat":"key_down",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey};n.dispatch(c)},i=l=>{if(l.isKilled||(l.isKilled=!0,Zf()||n.getIsMenuOpen())||l.key===",")return;const c={type:"keyboard",name:"key_up",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey};n.dispatch(c)};function r(l){var c,d;if(e.contains(l.target)){const u=l.touches[0].pageX,h=l.touches[0].radiusX||0;(u-h<10||u+h>n.getViewportScreenBounds().width-10)&&(((c=l.target)==null?void 0:c.tagName)==="BUTTON"&&((d=l.target)==null||d.click()),ze(l))}}const o=l=>{e.contains(l.target)&&(l.ctrlKey||l.metaKey)&&ze(l)};return e.addEventListener("touchstart",r,{passive:!1}),e.addEventListener("wheel",o,{passive:!1}),document.addEventListener("gesturestart",ze),document.addEventListener("gesturechange",ze),document.addEventListener("gestureend",ze),e.addEventListener("keydown",s),e.addEventListener("keyup",i),()=>{e.removeEventListener("touchstart",r),e.removeEventListener("wheel",o),document.removeEventListener("gesturestart",ze),document.removeEventListener("gesturechange",ze),document.removeEventListener("gestureend",ze),e.removeEventListener("keydown",s),e.removeEventListener("keyup",i)}},[n,e,t])}const TQ=["input","select","button","textarea"];function Zf(){const{activeElement:n}=document;return!!(n&&(n.getAttribute("contenteditable")||TQ.indexOf(n.tagName.toLowerCase())>-1))}const IQ=["textarea","input"];function PQ(n){const e=G();b.useEffect(()=>{const t=n.current;if(!t)return;const s=i=>{var r;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:o}=i;if(IQ.includes((r=o.tagName)==null?void 0:r.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;ze(i)}};return t.addEventListener("touchstart",s),t.addEventListener("touchend",s),()=>{t.removeEventListener("touchstart",s),t.removeEventListener("touchend",s)}},[e,n])}function kQ(n,e,t){return Math.max(e,Math.min(n,t))}const En={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function Jk(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function Qk(n,e,t,s=.15){return s===0?kQ(n,e,t):n<e?-Jk(e-n,t-e,s)+e:n>t?+Jk(n-t,t-e,s)+t:n}function AQ(n,[e,t],[s,i]){const[[r,o],[l,c]]=n;return[Qk(e,r,o,s),Qk(t,l,c,i)]}function jQ(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function NQ(n){var e=jQ(n,"string");return typeof e=="symbol"?e:String(e)}function Fn(n,e,t){return e=NQ(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function eA(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function Mt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?eA(Object(t),!0).forEach(function(s){Fn(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):eA(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}const TL={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function tA(n){return n?n[0].toUpperCase()+n.slice(1):""}const RQ=["enter","leave"];function MQ(n=!1,e){return n&&!RQ.includes(e)}function OQ(n,e="",t=!1){const s=TL[n],i=s&&s[e]||e;return"on"+tA(n)+tA(i)+(MQ(t,i)?"Capture":"")}const DQ=["gotpointercapture","lostpointercapture"];function LQ(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const s=DQ.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(s);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function FQ(n,e=""){const t=TL[n],s=t&&t[e]||e;return n+s}function IL(n){return"touches"in n}function BQ(n){return IL(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function UQ(n){return Array.from(n.touches).filter(e=>{var t,s;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(s=t.contains)===null||s===void 0?void 0:s.call(t,e.target))})}function q0(n,e){try{const t=e.clientX-n.clientX,s=e.clientY-n.clientY,i=(e.clientX+n.clientX)/2,r=(e.clientY+n.clientY)/2,o=Math.hypot(t,s);return{angle:-(Math.atan2(t,s)*180)/Math.PI,distance:o,origin:[i,r]}}catch{}return null}function $Q(n){return UQ(n).map(e=>e.identifier)}function nA(n,e){const[t,s]=Array.from(n.touches).filter(i=>e.includes(i.identifier));return q0(t,s)}const sA=40,iA=800;function PL(n){let{deltaX:e,deltaY:t,deltaMode:s}=n;return s===1?(e*=sA,t*=sA):s===2&&(e*=iA,t*=iA),[e,t]}function zQ(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:s,metaKey:i,ctrlKey:r}=n;Object.assign(e,{shiftKey:t,altKey:s,metaKey:i,ctrlKey:r})}return e}function jy(n,...e){return typeof n=="function"?n(...e):n}function WQ(){}function HQ(...n){return n.length===0?WQ:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function rA(n,e){return Object.assign({},e,n||{})}const GQ=32;class kL{constructor(e,t,s){this.ctrl=e,this.args=t,this.key=s,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:s,args:i}=this;t[s]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,s=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=s.from?jy(s.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:s,shared:i}=this;t.args=this.args;let r=0;if(e&&(t.event=e,s.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,zQ(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,r=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const I=t._delta.map(Math.abs);En.addTo(t._distance,I)}this.axisIntent&&this.axisIntent(e);const[o,l]=t._movement,[c,d]=s.threshold,{_step:u,values:h}=t;if(s.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(o)>=c&&h[0]),u[1]===!1&&(u[1]=Math.abs(l)>=d&&h[1])):(u[0]===!1&&(u[0]=Math.abs(o)>=c&&Math.sign(o)*c),u[1]===!1&&(u[1]=Math.abs(l)>=d&&Math.sign(l)*d)),t.intentional=u[0]!==!1||u[1]!==!1,!t.intentional)return;const p=[0,0];if(s.hasCustomTransform){const[I,E]=h;p[0]=u[0]!==!1?I-u[0]:0,p[1]=u[1]!==!1?E-u[1]:0}else p[0]=u[0]!==!1?o-u[0]:0,p[1]=u[1]!==!1?l-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(p);const f=t.offset,g=t._active&&!t._blocked||t.active;g&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in s&&(t._bounds=jy(s.bounds,t)),this.setup&&this.setup()),t.movement=p,this.computeOffset()));const[m,x]=t.offset,[[y,S],[v,C]]=t._bounds;t.overflow=[m<y?-1:m>S?1:0,x<v?-1:x>C?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const T=t._active?s.rubberband||[0,0]:[0,0];if(t.offset=AQ(t._bounds,t.offset,T),t.delta=En.sub(t.offset,f),this.computeMovement(),g&&(!t.last||r>GQ)){t.delta=En.sub(t.offset,f);const I=t.delta.map(Math.abs);En.addTo(t.distance,I),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&r>0&&(t.velocity=[I[0]/r,I[1]/r],t.timeDelta=r)}}emit(){const e=this.state,t=this.shared,s=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!s.triggerAllEvents)return;const i=this.handler(Mt(Mt(Mt({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function VQ([n,e],t){const s=Math.abs(n),i=Math.abs(e);if(s>i&&s>t)return"x";if(i>s&&i>t)return"y"}class KQ extends kL{constructor(...e){super(...e),Fn(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=En.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=En.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,s=this.config;if(!t.axis&&e){const i=typeof s.axisThreshold=="object"?s.axisThreshold[BQ(e)]:s.axisThreshold;t.axis=VQ(t._movement,i)}t._blocked=(s.lockDirection||!!s.axis)&&!t.axis||!!s.axis&&s.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const YQ=n=>n,oA=.15,AL={enabled(n=!0){return n},eventOptions(n,e,t){return Mt(Mt({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[oA,oA];case!1:return[0,0];default:return En.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return En.toVector(n)},transform(n,e,t){const s=n||t.shared.transform;return this.hasCustomTransform=!!s,s||YQ},threshold(n){return En.toVector(n,0)}},XQ=0,Bp=Mt(Mt({},AL),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=XQ){return n},bounds(n={}){if(typeof n=="function")return r=>Bp.bounds(n(r));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:s=-1/0,bottom:i=1/0}=n;return[[e,t],[s,i]]}}),Up=typeof window<"u"&&window.document&&window.document.createElement;function jL(){return Up&&"ontouchstart"in window}function qQ(){return jL()||Up&&window.navigator.maxTouchPoints>1}function ZQ(){return Up&&"onpointerdown"in window}function JQ(){return Up&&"exitPointerLock"in window.document}function QQ(){try{return"constructor"in GestureEvent}catch{return!1}}const fi={isBrowser:Up,gesture:QQ(),touch:jL(),touchscreen:qQ(),pointer:ZQ(),pointerLock:JQ()},eee=250,tee=180,nee=.5,see=50,iee=250,ree=10,aA={mouse:0,touch:0,pen:8};Mt(Mt({},Bp),{},{device(n,e,{pointer:{touch:t=!1,lock:s=!1,mouse:i=!1}={}}){return this.pointerLock=s&&fi.pointerLock,fi.touch&&t?"touch":this.pointerLock?"mouse":fi.pointer&&!i?"pointer":fi.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?eee:void 0,!(!fi.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:s=1,keys:i=!0}={}}){return this.pointerButtons=s,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:s=3,axis:i=void 0}){const r=En.toVector(n,t?s:i?1:0);return this.filterTaps=t,this.tapsThreshold=s,r},swipe({velocity:n=nee,distance:e=see,duration:t=iee}={}){return{velocity:this.transform(En.toVector(n)),distance:this.transform(En.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return tee;case!1:return 0;default:return n}},axisThreshold(n){return n?Mt(Mt({},aA),n):aA},keyboardDisplacement(n=ree){return n}});function NL(n){const[e,t]=n.overflow,[s,i]=n._delta,[r,o]=n._direction;(e<0&&s>0&&r<0||e>0&&s<0&&r>0)&&(n._movement[0]=n._movementBound[0]),(t<0&&i>0&&o<0||t>0&&i<0&&o>0)&&(n._movement[1]=n._movementBound[1])}const oee=30,aee=100;class lee extends kL{constructor(...e){super(...e),Fn(this,"ingKey","pinching"),Fn(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:s}=this.state;e==="wheel"?this.state.offset=En.add(t,s):this.state.offset=[(1+t[0])*s[0],t[1]+s[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,s]=e._movement;if(!e.axis){const i=Math.abs(t)*oee-Math.abs(s);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,s=this.ctrl.touchIds;if(t._active&&t._touchIds.every(r=>s.has(r))||s.size<2)return;this.start(e),t._touchIds=Array.from(s).slice(0,2);const i=nA(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,s=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(s.keys()).every(o=>i.has(o))||(s.size<2&&s.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const r=q0(...Array.from(s.values()));r&&this.pinchStart(e,r)}pinchStart(e,t){const s=this.state;s.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=nA(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const s=q0(...Array.from(t.values()));s&&this.pinchMove(e,s)}pinchMove(e,t){const s=this.state,i=s._values[1],r=t.angle-i;let o=0;Math.abs(r)>270&&(o+=Math.sign(r)),this.computeValues([t.distance,t.angle-360*o]),s.origin=t.origin,s.turns=o,s._movement=[s._values[0]/s._initial[0]-1,s._values[1]-s._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const s=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=En.sub(t._movement,s),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(s=>e[s]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const s=this.state;s._delta=[-PL(e)[1]/aee*s.offset[0],0],En.addTo(s._movement,s._delta),NL(s),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const cee=Mt(Mt({},AL),{},{device(n,e,{shared:t,pointer:{touch:s=!1}={}}){if(t.target&&!fi.touch&&fi.gesture)return"gesture";if(fi.touch&&s)return"touch";if(fi.touchscreen){if(fi.pointer)return"pointer";if(fi.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:s={}}){const i=o=>{const l=rA(jy(t,o),{min:-1/0,max:1/0});return[l.min,l.max]},r=o=>{const l=rA(jy(s,o),{min:-1/0,max:1/0});return[l.min,l.max]};return typeof t!="function"&&typeof s!="function"?[i(),r()]:o=>[i(o),r(o)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",En.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});Mt(Mt({},Bp),{},{mouseOnly:(n=!0)=>n});class dee extends KQ{constructor(...e){super(...e),Fn(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=PL(e),En.addTo(t._movement,t._delta),NL(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const uee=Bp;Mt(Mt({},Bp),{},{mouseOnly:(n=!0)=>n});const WE=new Map,Z0=new Map;function hee(n){WE.set(n.key,n.engine),Z0.set(n.key,n.resolver)}const pee={key:"pinch",engine:lee,resolver:cee},fee={key:"wheel",engine:dee,resolver:uee};function gee(n,e){if(n==null)return{};var t={},s=Object.keys(n),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function mee(n,e){if(n==null)return{};var t=gee(n,e),s,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(t[s]=n[s])}return t}const yee={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=fi.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},vee=["target","eventOptions","window","enabled","transform"];function Jg(n={},e){const t={};for(const[s,i]of Object.entries(e))switch(typeof i){case"function":t[s]=i.call(t,n[s],s,n);break;case"object":t[s]=Jg(n[s],i);break;case"boolean":i&&(t[s]=n[s]);break}return t}function xee(n,e,t={}){const s=n,{target:i,eventOptions:r,window:o,enabled:l,transform:c}=s,d=mee(s,vee);if(t.shared=Jg({target:i,eventOptions:r,window:o,enabled:l,transform:c},yee),e){const u=Z0.get(e);t[e]=Jg(Mt({shared:t.shared},d),u)}else for(const u in d){const h=Z0.get(u);h&&(t[u]=Jg(Mt({shared:t.shared},d[u]),h))}return t}class RL{constructor(e,t){Fn(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,s,i,r){const o=this._listeners,l=FQ(t,s),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},d=Mt(Mt({},c),r);e.addEventListener(l,i,d);const u=()=>{e.removeEventListener(l,i,d),o.delete(u)};return o.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class See{constructor(){Fn(this,"_timeouts",new Map)}add(e,t,s=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,s,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class wee{constructor(e){Fn(this,"gestures",new Set),Fn(this,"_targetEventStore",new RL(this)),Fn(this,"gestureEventStores",{}),Fn(this,"gestureTimeoutStores",{}),Fn(this,"handlers",{}),Fn(this,"config",{}),Fn(this,"pointerIds",new Set),Fn(this,"touchIds",new Set),Fn(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),bee(this,e)}setEventIds(e){if(IL(e))return this.touchIds=new Set($Q(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=xee(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,s={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const o of this.gestures){const l=this.config[o],c=lA(s,l.eventOptions,!!i);if(l.enabled){const d=WE.get(o);new d(this,e,o).bind(c)}}const r=lA(s,t.eventOptions,!!i);for(const o in this.nativeHandlers)r(o,"",l=>this.nativeHandlers[o](Mt(Mt({},this.state.shared),{},{event:l,args:e})),void 0,!0)}for(const r in s)s[r]=HQ(...s[r]);if(!i)return s;for(const r in s){const{device:o,capture:l,passive:c}=LQ(r);this._targetEventStore.add(i,o,"",s[r],{capture:l,passive:c})}}}}function lc(n,e){n.gestures.add(e),n.gestureEventStores[e]=new RL(n,e),n.gestureTimeoutStores[e]=new See}function bee(n,e){e.drag&&lc(n,"drag"),e.wheel&&lc(n,"wheel"),e.scroll&&lc(n,"scroll"),e.move&&lc(n,"move"),e.pinch&&lc(n,"pinch"),e.hover&&lc(n,"hover")}const lA=(n,e,t)=>(s,i,r,o={},l=!1)=>{var c,d;const u=(c=o.capture)!==null&&c!==void 0?c:e.capture,h=(d=o.passive)!==null&&d!==void 0?d:e.passive;let p=l?s:OQ(s,i,u);t&&h&&(p+="Passive"),n[p]=n[p]||[],n[p].push(r)},_ee=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function Cee(n){const e={},t={},s=new Set;for(let i in n)_ee.test(i)?(s.add(RegExp.lastMatch),t[i]=n[i]):e[i]=n[i];return[t,e,s]}function cc(n,e,t,s,i,r){if(!n.has(t)||!WE.has(s))return;const o=t+"Start",l=t+"End",c=d=>{let u;return d.first&&o in e&&e[o](d),t in e&&(u=e[t](d)),d.last&&l in e&&e[l](d),u};i[s]=c,r[s]=r[s]||{}}function Eee(n,e){const[t,s,i]=Cee(n),r={};return cc(i,t,"onDrag","drag",r,e),cc(i,t,"onWheel","wheel",r,e),cc(i,t,"onScroll","scroll",r,e),cc(i,t,"onPinch","pinch",r,e),cc(i,t,"onMove","move",r,e),cc(i,t,"onHover","hover",r,e),{handlers:r,config:e,nativeHandlers:s}}function Tee(n,e={},t,s){const i=Oe.useMemo(()=>new wee(n),[]);if(i.applyHandlers(n,s),i.applyConfig(e,t),Oe.useEffect(i.effect.bind(i)),Oe.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function Iee(n){return n.forEach(hee),function(t,s){const{handlers:i,nativeHandlers:r,config:o}=Eee(t,s||{});return Tee(i,o,void 0,r)}}const cA=10,Pee=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function ML(n){let{deltaY:e,deltaX:t}=n,s=0;return n.ctrlKey||n.altKey||n.metaKey?s=(Math.abs(e)>cA?cA*Math.sign(e):e)/100:n.shiftKey&&!Pee&&(t=e,e=0),{x:-t,y:-e,z:-s}}const kee=Iee([fee,pee]);let dc;const Aee=n=>dc===void 0?(dc=n,!1):n-dc>120&&n-dc<160?(dc=n,!0):(dc=n,!1);function jee(n){const e=G(),t=b.useMemo(()=>{let s="not sure";const i=({event:m})=>{if(!e.getInstanceState().isFocused||(s="not sure",Aee(Date.now())))return;const x=e.getEditingShapeId();if(x){const v=e.getShape(x);if(v&&e.getShapeUtil(v).canScroll(v)){const T=e.getShapePageBounds(x);if(T!=null&&T.containsPoint(e.inputs.currentPagePoint))return}}ze(m),un(m);const y=ML(m);if(y.x===0&&y.y===0)return;const S={type:"wheel",name:"wheel",delta:y,point:new _(m.clientX,m.clientY),shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey};e.dispatch(S)};let r=1,o=1,l=1,c=0;const d=new _,u=new _,h=m=>{const x=n.current;s="not sure";const{event:y,origin:S,da:v}=m;y instanceof WheelEvent||(y.target===x||x!=null&&x.contains(y.target))&&(u.x=S[0],u.y=S[1],d.x=S[0],d.y=S[1],r=v[0],o=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:S[0],y:S[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey}))},p=m=>{if(m&&(s="zooming"),s==="zooming")return;const x=Math.abs(c-r),y=_.Dist(d,u);switch(s){case"not sure":{x>24?s="zooming":y>16&&(s="panning");break}case"panning":{x>64&&(s="zooming");break}}};return{onWheel:i,onPinchStart:h,onPinchEnd:m=>{const x=n.current,{event:y,origin:S,offset:v}=m;if(y instanceof WheelEvent||!(y.target===x||x!=null&&x.contains(y.target)))return;const C=v[0];s="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:S[0],y:S[1],z:C},delta:{x:S[0],y:S[1]},shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey})})},onPinch:m=>{const x=n.current,{event:y,origin:S,offset:v,da:C}=m;if(y instanceof WheelEvent||!(y.target===x||x!=null&&x.contains(y.target)))return;const T=m.type==="gesturechange"||m.type==="gestureend";c=C[0];const I=S[0]-u.x,E=S[1]-u.y;switch(u.x=S[0],u.y=S[1],p(T),s){case"zooming":{l=v[0],e.dispatch({type:"pinch",name:"pinch",point:{x:S[0],y:S[1],z:l},delta:{x:I,y:E},shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:S[0],y:S[1],z:o},delta:{x:I,y:E},shiftKey:y.shiftKey,altKey:y.altKey,ctrlKey:y.metaKey||y.ctrlKey});break}}}}},[e,n]);kee(t,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>({from:e.getZoomLevel(),max:8,min:.05})}})}function aw(n,e,t){const s=n.getShape(e),i=n.getShapeHandles(s);return{shape:s,handle:i.find(r=>r.id===t)}}function Nee(n,e){const t=G();return b.useMemo(()=>{const s=c=>{if(c.isKilled)return;const d=Ay(c.currentTarget);Lp(d,c);const{shape:u,handle:h}=aw(t,n,e);h&&t.dispatch({type:"pointer",target:"handle",handle:h,shape:u,name:"pointer_down",...Is(c)})};let i,r;return{onPointerDown:s,onPointerMove:c=>{if(c.isKilled||c.clientX===i&&c.clientY===r)return;i=c.clientX,r=c.clientY;const{shape:d,handle:u}=aw(t,n,e);u&&t.dispatch({type:"pointer",target:"handle",handle:u,shape:d,name:"pointer_move",...Is(c)})},onPointerUp:c=>{if(c.isKilled)return;const d=Ay(c.currentTarget);Fp(d,c);const{shape:u,handle:h}=aw(t,n,e);h&&t.dispatch({type:"pointer",target:"handle",handle:h,shape:u,name:"pointer_up",...Is(c)})}}},[t,n,e])}const St=class St{constructor(e=0,t=0,s=0,i=0){w(this,"x",0);w(this,"y",0);w(this,"w",0);w(this,"h",0);this.x=e,this.y=t,this.w=s,this.h=i}get point(){return new _(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new _(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new _(this.minX,this.minY),new _(this.maxX,this.minY),new _(this.maxX,this.maxY),new _(this.minX,this.maxY)]}get cornersAndCenter(){return[new _(this.minX,this.minY),new _(this.maxX,this.minY),new _(this.maxX,this.maxY),new _(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new _(this.w,this.h)}toFixed(){return this.x=Xf(this.x),this.y=Xf(this.y),this.w=Xf(this.w),this.h=Xf(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,s=0,i=0){return this.x=e,this.y=t,this.w=s,this.h=i,this}expand(e){const t=Math.min(this.minX,e.minX),s=Math.min(this.minY,e.minY),i=Math.max(this.maxX,e.maxX),r=Math.max(this.maxY,e.maxY);return this.x=t,this.y=s,this.w=i-t,this.h=r-s,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:s,h:i}=this;return new St(e,t,s,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,s=Math.round(this.minY/e)*e,i=Math.round(this.maxX/e)*e,r=Math.round(this.maxY/e)*e;this.minX=t,this.minY=s,this.width=Math.max(1,i-t),this.height=Math.max(1,r-s)}collides(e){return St.Collides(this,e)}contains(e){return St.Contains(this,e)}includes(e){return St.Includes(this,e)}containsPoint(e,t=0){return St.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new _(this.minX,this.minY);case"top_right":return new _(this.maxX,this.minY);case"bottom_left":return new _(this.minX,this.maxY);case"bottom_right":return new _(this.maxX,this.maxY);case"top":return new _(this.midX,this.minY);case"right":return new _(this.maxX,this.midY);case"bottom":return new _(this.midX,this.maxY);case"left":return new _(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,s){const{minX:i,minY:r,maxX:o,maxY:l}=this;let{minX:c,minY:d,maxX:u,maxY:h}=this;switch(e){case"left":case"top_left":case"bottom_left":{c+=t;break}case"right":case"top_right":case"bottom_right":{u+=t;break}}switch(e){case"top":case"top_left":case"top_right":{d+=s;break}case"bottom":case"bottom_left":case"bottom_right":{h+=s;break}}const p=(u-c)/(o-i),f=(h-d)/(l-r),g=p<0,m=f<0;if(g){const x=u;u=c,c=x}if(m){const x=h;h=d,d=x}this.minX=c,this.minY=d,this.width=Math.abs(u-c),this.height=Math.abs(h-d)}union(e){const t=Math.min(this.minX,e.x),s=Math.min(this.minY,e.y),i=Math.max(this.maxX,e.w+e.x),r=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=s,this.width=i-t,this.height=r-s,this}static From(e){return new St(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new St(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){if(e.length===0)return new St;let t=1/0,s=1/0,i=-1/0,r=-1/0,o;for(let l=0,c=e.length;l<c;l++)o=e[l],t=Math.min(o.x,t),s=Math.min(o.y,s),i=Math.max(o.x,i),r=Math.max(o.y,r);return new St(t,s,i-t,r-s)}static Expand(e,t){const s=Math.min(t.minX,e.minX),i=Math.min(t.minY,e.minY),r=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return new St(s,i,r-s,o-i)}static ExpandBy(e,t){return new St(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Resize(e,t,s,i,r=!1){const{minX:o,minY:l,maxX:c,maxY:d}=e;let{minX:u,minY:h,maxX:p,maxY:f}=e;switch(t){case"left":case"top_left":case"bottom_left":{u+=s;break}case"right":case"top_right":case"bottom_right":{p+=s;break}}switch(t){case"top":case"top_left":case"top_right":{h+=i;break}case"bottom":case"bottom_left":case"bottom_right":{f+=i;break}}const g=(p-u)/(c-o),m=(f-h)/(d-l),x=g<0,y=m<0;if(r){const v=(c-o)/(d-l),C=Math.abs(p-u),T=Math.abs(f-h),I=C*(m<0?1:-1)*(1/v),E=T*(g<0?1:-1)*v,P=v<C/T;switch(t){case"top_left":{P?h=f+I:u=p+E;break}case"top_right":{P?h=f+I:p=u-E;break}case"bottom_right":{P?f=h-I:p=u-E;break}case"bottom_left":{P?f=h-I:u=p+E;break}case"bottom":case"top":{const k=(u+p)/2,j=T*v;u=k-j/2,p=k+j/2;break}case"left":case"right":{const k=(h+f)/2,j=C/v;h=k-j/2,f=k+j/2;break}}}if(x){const v=p;p=u,u=v}if(y){const v=f;f=h,h=v}const S=new St(u,h,Math.abs(p-u),Math.abs(f-h));return{box:S,scaleX:+(S.width/e.width*(g>0?1:-1)).toFixed(5),scaleY:+(S.height/e.height*(m>0?1:-1)).toFixed(5)}}equals(e){return St.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new St(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};w(St,"Collides",(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)),w(St,"Contains",(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX),w(St,"Includes",(e,t)=>St.Collides(e,t)||St.Contains(e,t)),w(St,"ContainsPoint",(e,t,s=0)=>!(t.x<e.minX-s||t.y<e.minY-s||t.x>e.maxX+s||t.y>e.maxY+s)),w(St,"Common",e=>{let t=1/0,s=1/0,i=-1/0,r=-1/0;for(let o=0;o<e.length;o++){const l=e[o];t=Math.min(t,l.minX),s=Math.min(s,l.minY),i=Math.max(i,l.maxX),r=Math.max(r,l.maxY)}return new St(t,s,i-t,r-s)}),w(St,"Sides",(e,t=0)=>{const{corners:s}=e;return[[s[0],s[1]],[s[1],s[2]],[s[2],s[3]],[s[3],s[0]]]});let ue=St;function Ree(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function Mee(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function Oee(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}function Dee(n){const e=G();b.useLayoutEffect(()=>{let t=new ue;function s(){const d=n.current;if(!d)return null;const u=d.getBoundingClientRect(),h=new ue(u.left||u.x,u.top||u.y,Math.max(u.width,1),Math.max(u.height,1));t.equals(h)||(e.updateViewportScreenBounds(h),t=h)}s();const i=sD(s,200,{trailing:!0}),r=e.timers.setInterval(i,1e3);window.addEventListener("resize",i);const o=new ResizeObserver(d=>{d[0].contentRect&&i()}),l=n.current;let c=null;return l&&(o.observe(l),c=Lee(l),c.addEventListener("scroll",i)),()=>{clearInterval(r),window.removeEventListener("resize",i),o.disconnect(),c==null||c.removeEventListener("scroll",i),i.cancel()}},[e,n])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const Lee=n=>{let e=n.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document},Je=class Je{constructor(e,t,s,i,r,o){w(this,"a",1);w(this,"b",0);w(this,"c",0);w(this,"d",1);w(this,"e",0);w(this,"f",0);this.a=e,this.b=t,this.c=s,this.d=i,this.e=r,this.f=o}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:s,b:i,c:r,d:o,e:l,f:c}=this;return this.a=s*t.a+r*t.b,this.c=s*t.c+r*t.d,this.e=s*t.e+r*t.f+l,this.b=i*t.a+o*t.b,this.d=i*t.c+o*t.d,this.f=i*t.e+o*t.f+c,this}rotate(e,t,s){return e===0?this:t===void 0?this.multiply(Je.Rotate(e)):this.translate(t,s).multiply(Je.Rotate(e)).translate(-t,-s)}translate(e,t){return this.multiply(Je.Translate(e,t))}scale(e,t){return this.multiply(Je.Scale(e,t))}invert(){const{a:e,b:t,c:s,d:i,e:r,f:o}=this,l=e*i-t*s;return this.a=i/l,this.b=t/-l,this.c=s/-l,this.d=e/l,this.e=(i*r-s*o)/-l,this.f=(t*r-e*o)/l,this}applyToPoint(e){return Je.applyToPoint(this,e)}applyToPoints(e){return Je.applyToPoints(this,e)}rotation(){return Je.Rotation(this)}point(){return Je.Point(this)}decomposed(){return Je.Decompose(this)}toCssString(){return Je.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return Je.Decompose(this)}clone(){return new Je(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Je(1,0,0,1,0,0)}static Translate(e,t){return new Je(1,0,0,1,e,t)}static Rotate(e,t,s){if(e===0)return Je.Identity();const i=Math.cos(e),r=Math.sin(e),o=new Je(i,r,-r,i,0,0);return t===void 0?o:Je.Compose(Je.Translate(t,s),o,Je.Translate(-t,-s))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=Je.Identity();for(let s=0,i=e.length;s<i;s++)t.multiply(e[s]);return t}static Point(e){return new _(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const s=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/s)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const s=(e.b*e.b+e.d*e.d)**.5;t=gt+Math.acos(e.b/s)*(e.d>0?-1:1)}else t=0;return Y0(t)}static Decompose(e){let t,s,i;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;t=r,s=(e.a*e.d-e.b*e.c)/r,i=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/r,s=r,i=gt+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0,s=0,i=0;return{x:e.e,y:e.f,scaleX:t,scaleY:s,rotation:Y0(i)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${H(e.a)}, ${H(e.b)}, ${H(e.c)}, ${H(e.d)}, ${H(e.e)}, ${H(e.f)})`}static applyToPoint(e,t){return new _(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,s){return[e.a*t+e.c*s+e.e,e.b*t+e.d*s+e.f]}static applyToPoints(e,t){return t.map(s=>new _(e.a*s.x+e.c*s.y+e.e,e.b*s.x+e.d*s.y+e.f,s.z))}static applyToBounds(e,t){return new ue(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new Je(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof Je?e:Je.From(e)}};w(Je,"Scale",(e,t,s,i)=>{const r=new Je(e,0,0,t,0,0);return s===void 0?r:Je.Compose(Je.Translate(s,i),r,Je.Translate(-s,-i))});let ve=Je;function OL(n,e){return e===0?n:OL(e,n%e)}function DL(n){const e=n.toString().split(".")[1];if(!e)return 1;const t=Math.pow(10,e.length),s=parseInt(e,10);return t/OL(s,t)}class za{constructor(e){w(this,"isFilled",!1);w(this,"isClosed",!0);w(this,"isLabel",!1);w(this,"debugColor");w(this,"ignore");w(this,"_vertices");w(this,"_bounds");w(this,"_area");w(this,"_length");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,s=!1){return this.isClosed&&(this.isFilled||s)&&Xs(e,this.vertices)?!0:_.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&Xs(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){if(e.equals(t))return this.distanceToPoint(e);const{vertices:s}=this;let i,r=1/0,o,l,c;for(let d=0;d<s.length;d++)l=s[d],c=_.NearestPointOnLineSegment(e,t,l,!0),o=_.Dist2(l,c),o<r&&(r=o,i=c);if(!i)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&Xs(i,this.vertices)?-r:r}hitTestLineSegment(e,t,s=0){return this.distanceToLineSegment(e,t)<=s}nearestPointOnLineSegment(e,t){const{vertices:s}=this;let i,r=1/0,o,l,c;for(let d=0;d<s.length;d++)l=s[d],c=_.NearestPointOnLineSegment(e,t,l,!0),o=_.Dist2(l,c),o<r&&(r=o,i=c);if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,t=0){const{bounds:s}=this;return!(e.x<s.minX-t||e.y<s.minY-t||e.x>s.maxX+t||e.y>s.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return ue.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let s=0,i=e.length;s<i;s++){const r=e[s],o=e[(s+1)%i];t+=r.x*o.y-o.x*r.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,s=t.length;if(s===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let i=1;i<s;i++)e+=`L${t[i].x},${t[i].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let t,s=e[0],i=0;for(let r=1;r<e.length;r++)t=e[r],i+=_.Dist2(s,t),s=t;return Math.sqrt(i)}}class Yi extends za{constructor(t){super({...t,isClosed:!0,isFilled:!1});w(this,"children",[]);w(this,"ignoredChildren",[]);for(const s of t.children)s.ignore?this.ignoredChildren.push(s):this.children.push(s);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let s=1/0,i;const{children:r}=this;if(r.length===0)throw Error("no children");let o,l;for(const c of r)o=c.nearestPoint(t),l=_.Dist2(o,t),l<s&&(s=l,i=o);if(!i)throw Error("nearest point not found");return i}distanceToPoint(t,s=!1){return Math.min(...this.children.map((i,r)=>i.distanceToPoint(t,s||r>0)))}hitTestPoint(t,s,i){return!!this.children.filter(r=>!r.isLabel).find(r=>r.hitTestPoint(t,s,i))}hitTestLineSegment(t,s,i){return!!this.children.filter(r=>!r.isLabel).find(r=>r.hitTestLineSegment(t,s,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const i of this.children)t+=i.toSimpleSvgPath();const s=ue.FromPoints(this.vertices).corners;for(let i=0,r=s.length;i<r;i++){const o=s[i],l=s[(i-1+r)%r],c=o.dist(l),d=s[(i+1)%r],u=o.dist(d),h=o.clone().lrp(l,4/c),p=o,f=o.clone().lrp(d,4/u);t+=`M${h.x},${h.y} L${p.x},${p.y} L${f.x},${f.y} `}return t}getLength(){return this.children.reduce((t,s)=>s.isLabel?t:t+s.length,0)}getSvgPathData(){return this.children.map((t,s)=>t.isLabel?"":t.getSvgPathData(s===0)).join(" ")}}function Fee(n=!0){const[e,t]=b.useState(0),s=G();b.useEffect(()=>{if(!n)return;const i=()=>t(r=>r+1);return s.on("tick",i),()=>{s.off("tick",i)}},[s,n])}const Bee=pn(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:s=!0}){const i=G();Fee(s);const r=i.getZoomLevel(),o=i.getRenderingShapes(),{inputs:{currentPagePoint:l}}=i;return a.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(c=>{const d=i.getShape(c.id);if(d.type==="group")return null;const u=i.getShapeGeometry(d),h=i.getShapePageTransform(d),p=i.getPointInShapeSpace(d,l),f=u.nearestPoint(p),g=u.distanceToPoint(p,!0),m=Math.abs(g)*r,x=g<0,{vertices:y}=u;return a.jsxs("g",{transform:h.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&a.jsx("g",{stroke:u.debugColor??"red",opacity:"1",strokeWidth:2/r,fill:"none",children:a.jsx(LL,{geometry:u})}),t&&y.map((S,v)=>a.jsx("circle",{cx:S.x,cy:S.y,r:2/r,fill:`hsl(${yd(v,[0,y.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/r},`v${v}`)),s&&m<150&&a.jsx("line",{x1:f.x,y1:f.y,x2:p.x,y2:p.y,opacity:1-m/150,stroke:x?"goldenrod":"dodgerblue",strokeWidth:2/r})]},c.id+"_outline")})})});function LL({geometry:n}){return n instanceof Yi?a.jsx(a.Fragment,{children:[...n.children,...n.ignoredChildren].map((e,t)=>a.jsx(LL,{geometry:e},t))}):a.jsx("path",{d:n.toSimpleSvgPath()})}function FL(n){return uZ(n)}function BL(){const n=G(),e=uQ("userIds",()=>FL(n.getCollaborators().map(t=>t.userId)).sort(),{isEqual:(t,s)=>{var i;return t.join(",")===((i=s.join)==null?void 0:i.call(s,","))}},[n]);return q(e)}function ex(n){const e=G();return q(`latestPresence:${n}`,()=>e.getCollaborators().find(s=>s.userId===n),[e,n])??null}const Uee=pn(function(){return BL().map(t=>a.jsx($ee,{collaboratorId:t},t))}),$ee=pn(function({collaboratorId:e}){const t=G(),s=ex(e),i=Wee(t,s);if(!(s&&s.currentPageId===t.getCurrentPageId()))return null;switch(i){case"inactive":{const{followingUserId:r,highlightedUserIds:o}=t.getInstanceState();if(!(r===s.userId||o.includes(s.userId)))return null;break}case"idle":{const{highlightedUserIds:r}=t.getInstanceState();if(s.followingUserId===t.user.getId()&&!(s.chatMessage||r.includes(s.userId)))return null;break}}return a.jsx(zee,{latestPresence:s})}),zee=pn(function({latestPresence:e}){const t=G(),{CollaboratorBrush:s,CollaboratorScribble:i,CollaboratorCursor:r,CollaboratorHint:o,CollaboratorShapeIndicator:l}=kt(),c=t.getZoomLevel(),d=t.getViewportPageBounds(),{userId:u,chatMessage:h,brush:p,scribbles:f,selectedShapeIds:g,userName:m,cursor:x,color:y}=e,S=!(x.x<d.minX-12/c||x.y<d.minY-16/c||x.x>d.maxX-12/c||x.y>d.maxY-16/c);return a.jsxs(a.Fragment,{children:[p&&s?a.jsx(s,{className:"tl-collaborator__brush",brush:p,color:y,opacity:.1},u+"_brush"):null,S&&r?a.jsx(r,{className:"tl-collaborator__cursor",point:x,color:y,zoom:c,name:m!=="New User"?m:null,chatMessage:h},u+"_cursor"):o?a.jsx(o,{className:"tl-collaborator__cursor-hint",point:x,color:y,zoom:c,viewport:d},u+"_cursor_hint"):null,i&&f.length?a.jsx(a.Fragment,{children:f.map(v=>a.jsx(i,{className:"tl-collaborator__scribble",scribble:v,color:y,zoom:c,opacity:v.color==="laser"?.5:.1},u+"_scribble_"+v.id))}):null,l&&g.map(v=>a.jsx(l,{className:"tl-collaborator__shape-indicator",shapeId:v,color:y,opacity:.5},u+"_"+v))]})});function dA(n,e){return e>n.options.collaboratorInactiveTimeoutMs?"inactive":e>n.options.collaboratorIdleTimeoutMs?"idle":"active"}function Wee(n,e){const t=b.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[s,i]=b.useState(()=>dA(n,Date.now()-t.current));return b.useEffect(()=>{const r=n.timers.setInterval(()=>{i(dA(n,Date.now()-t.current))},n.options.collaboratorCheckIntervalMs);return()=>clearInterval(r)},[n]),e&&(t.current=e.lastActivityTimestamp),s}const UL=b.memo(function({id:e,shape:t,util:s,index:i,backgroundIndex:r,opacity:o,dprMultiple:l}){const c=G(),{ShapeErrorFallback:d}=kt(),u=b.useRef(null),h=b.useRef(null),p=b.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});Sa("set shape stuff",()=>{const m=c.getShape(e);if(!m)return;const x=p.current,y=c.getShapeClipPath(e)??"none";y!==x.clipPath&&(Dn(u.current,"clip-path",y),Dn(h.current,"clip-path",y),x.clipPath=y);const S=c.getShapePageTransform(e),v=ve.toCssString(S),C=c.getShapeGeometry(m).bounds;v!==x.transform&&(Dn(u.current,"transform",v),Dn(h.current,"transform",v),x.transform=v);const T=C.w%l,I=C.h%l,E=T===0?C.w:C.w+(l-T),P=I===0?C.h:C.h+(l-I);(E!==x.width||P!==x.height)&&(Dn(u.current,"width",Math.max(E,l)+"px"),Dn(u.current,"height",Math.max(P,l)+"px"),Dn(h.current,"width",Math.max(E,l)+"px"),Dn(h.current,"height",Math.max(P,l)+"px"),x.width=E,x.height=P)},[c]),Sa("set opacity and z-index",()=>{const m=u.current,x=h.current;Dn(m,"opacity",o),Dn(x,"opacity",o),Dn(m,"z-index",i),Dn(x,"z-index",r)},[o,i,r]),Sa("set display",()=>{if(!c.getShape(e))return;const y=c.getCulledShapes().has(e);y!==p.current.isCulled&&(Dn(u.current,"display",y?"none":"block"),Dn(h.current,"display",y?"none":"block"),p.current.isCulled=y)},[c]);const f=b.useCallback(m=>c.annotateError(m,{origin:"shape",willCrashApp:!1}),[c]);if(!t)return null;const g="fill"in t.props&&t.props.fill!=="none";return a.jsxs(a.Fragment,{children:[s.backgroundComponent&&a.jsx("div",{ref:h,className:"tl-shape tl-shape-background","data-shape-type":t.type,draggable:!1,children:a.jsx(ip,{fallback:d,onError:f,children:a.jsx(Gee,{shape:t,util:s})})}),a.jsx("div",{ref:u,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":g,draggable:!1,children:a.jsx(ip,{fallback:d,onError:f,children:a.jsx(Hee,{shape:t,util:s})})})]})}),Hee=b.memo(function({shape:e,util:t}){return Jv("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta),Gee=b.memo(function({shape:e,util:t}){return Jv("InnerShape:"+e.type,()=>{var s;return(s=t.backgroundComponent)==null?void 0:s.call(t,t.editor.store.unsafeGetWithoutCapture(e.id))})},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta);function Vee({className:n}){const e=G(),{Background:t,SvgDefs:s,ShapeIndicators:i}=kt(),r=b.useRef(null),o=b.useRef(null),l=b.useRef(null),c=fn();Dee(r),EQ(),_Q(),jee(r),PQ(r);const d=b.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});Sa("position layers",function(){const{x:S,y:v,z:C}=e.getCamera();if(d.current.allowTextOutline&&e.environment.isSafari&&(c.style.setProperty("--tl-text-outline","none"),d.current.allowTextOutline=!1),d.current.allowTextOutline&&C<e.options.textShadowLod!==d.current.lodDisableTextOutline){const E=C<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",E?"none":"var(--tl-text-outline-reference)"),d.current.lodDisableTextOutline=E}const T=C>=1?yd(C,[1,8],[.125,.5],!0):yd(C,[.1,1],[-2,.125],!0),I=`scale(${H(C)}) translate(${H(S+T)}px,${H(v+T)}px)`;Dn(o.current,"transform",I),Dn(l.current,"transform",I)},[e,c]);const u=CL(),h=q("shapeSvgDefs",()=>{const y=new Map;for(const S of Ut(e.shapeUtils)){if(!S)return;const v=S.getCanvasSvgDefs();for(const{key:C,component:T}of v)y.has(C)||y.set(C,a.jsx(T,{},C))}return[...y.values()]},[e]),p=q("debug_shapes",()=>Gt.hideShapes.get(),[Gt]),f=q("debug_svg",()=>Gt.debugSvg.get(),[Gt]),g=q("debug_geometry",()=>Gt.debugGeometry.get(),[Gt]),m=q("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),x=q("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return a.jsxs(a.Fragment,{children:[a.jsxs("div",{ref:r,draggable:!1,"data-iseditinganything":m,"data-isselectinganything":x,className:Se("tl-canvas",n),"data-testid":"canvas",...u,children:[a.jsx("svg",{className:"tl-svg-context",children:a.jsxs("defs",{children:[h,a.jsx(ote,{}),a.jsx(ate,{}),s&&a.jsx(s,{})]})}),t&&a.jsx("div",{className:"tl-background__wrapper",children:a.jsx(t,{})}),a.jsx(Yee,{}),a.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[a.jsx(ute,{}),a.jsx(dte,{}),p?null:f?a.jsx(nte,{}):a.jsx(ite,{})]}),a.jsx("div",{className:"tl-overlays",children:a.jsxs("div",{ref:l,className:"tl-html-layer",children:[g?a.jsx(Bee,{}):null,a.jsx(Qee,{}),a.jsx(qee,{}),a.jsx(Xee,{}),a.jsx(Zee,{}),i&&a.jsx(i,{}),a.jsx(rte,{}),a.jsx(Jee,{}),a.jsx(cte,{}),a.jsx(Uee,{})]})}),a.jsx(hte,{})]}),a.jsx(Kee,{})]})}function Kee(){const{InFrontOfTheCanvas:n}=kt();return n?a.jsx(n,{}):null}function Yee(){const n=G(),e=q("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:t,y:s,z:i}=q("camera",()=>n.getCamera(),[n]),r=q("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:o}=kt();return o&&r?a.jsx(o,{x:t,y:s,z:i,size:e}):null}function Xee(){const n=G(),e=q("scribbles",()=>n.getInstanceState().scribbles,[n]),t=q("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:s}=kt();return s&&e.length?e.map(i=>a.jsx(s,{className:"tl-user-scribble",scribble:i,zoom:t},i.id)):null}function qee(){const n=G(),e=q("brush",()=>n.getInstanceState().brush,[n]),{Brush:t}=kt();return t&&e?a.jsx(t,{className:"tl-user-brush",brush:e}):null}function Zee(){const n=G(),e=q("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:t}=kt();return t&&e?a.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function Jee(){const n=G(),e=q("snapLines",()=>n.snaps.getIndicators(),[n]),t=q("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapIndicator:s}=kt();return s&&e.length>0?e.map(i=>a.jsx(s,{className:"tl-user-snapline",line:i,zoom:t},i.id)):null}function Qee(){const n=G(),e=q("handles shapeIdWithHandles",()=>{const{isReadonly:t,isChangingStyle:s}=n.getInstanceState();if(t||s)return!1;const i=n.getOnlySelectedShape();return!i||!n.getShapeHandles(i)?!1:i.id},[n]);return e?a.jsx(ete,{shapeId:e}):null}function ete({shapeId:n}){const e=G(),{Handles:t}=kt(),s=q("zoomLevel",()=>e.getZoomLevel(),[e]),i=q("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),r=q("handles transform",()=>e.getShapePageTransform(n),[e,n]),o=q("handles",()=>{const l=e.getShapeHandles(n);if(!l)return null;const c=(i?e.options.coarseHandleRadius:e.options.handleRadius)/s*2;return l.filter(d=>d.type!=="virtual"||!l.some(u=>u!==d&&u.type==="vertex"&&_.Dist(d,u)<c)).sort(d=>d.type==="vertex"?1:-1)},[e,s,i,n]);return!t||!o||!r?null:a.jsx(t,{children:a.jsx("g",{transform:ve.toCssString(r),children:o.map(l=>a.jsx(tte,{shapeId:n,handle:l,zoom:s,isCoarse:i},l.id))})})}function tte({shapeId:n,handle:e,zoom:t,isCoarse:s}){const i=Nee(n,e.id),{Handle:r}=kt();return r?a.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:a.jsx(r,{shapeId:n,handle:e,zoom:t,isCoarse:s})}):null}function nte(){const n=G(),e=q("rendering shapes",()=>n.getRenderingShapes(),[n]),t=q("dpr multiple",()=>DL(Math.floor(n.getInstanceState().devicePixelRatio*100)/100),[n]);return e.map(s=>a.jsxs(b.Fragment,{children:[a.jsx(UL,{...s,dprMultiple:t}),a.jsx(lte,{id:s.id})]},s.id+"_fragment"))}function ste(){const n=G(),e=b.useRef(new Set);return Sa("reflow for culled shapes",()=>{const t=n.getCulledShapes();if(e.current.size===t.size&&[...t].every(i=>e.current.has(i)))return;e.current=t;const s=document.getElementsByClassName("tl-canvas");s.length!==0&&s[0].offsetHeight},[n]),null}function ite(){const n=G(),e=q("rendering shapes",()=>n.getRenderingShapes(),[n]),t=q("dpr multiple",()=>DL(Math.floor(n.getInstanceState().devicePixelRatio*100)/100),[n]);return a.jsxs(a.Fragment,{children:[e.map(s=>a.jsx(UL,{...s,dprMultiple:t},s.id+"_shape")),n.environment.isSafari&&a.jsx(ste,{})]})}function rte(){const n=G(),{ShapeIndicator:e}=kt(),t=q("hinting shape ids",()=>CE(n.getHintingShapeIds()),[n]);return!t.length||!e?null:t.map(s=>a.jsx(e,{className:"tl-user-indicator__hint",shapeId:s},s+"_hinting"))}function ote(){return a.jsxs("g",{id:"cursor",children:[a.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[a.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),a.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),a.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[a.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),a.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),a.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[a.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),a.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function ate(){return a.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function lte({id:n}){const e=G(),[t,s]=b.useState(null),i=q("is in root",()=>{const r=e.getShape(n);return(r==null?void 0:r.parentId)===e.getCurrentPageId()},[e,n]);return b.useEffect(()=>{if(!i)return;let r=null;const o=Zl("shape to svg",async()=>{const l=Math.random();r=l;const d=e.isShapeOfType(n,"frame")?0:10;let u=e.getShapePageBounds(n);if(!u)return;u=u.clone().expandBy(d);const h=await e.getSvgString([n],{padding:d,background:e.getInstanceState().exportBackground});if(r!==l||!h)return;const p=`data:image/svg+xml;utf8,${encodeURIComponent(h.svg)}`;s({src:p,bounds:u})});return()=>{r=null,o()}},[e,n,i]),!i||!t?null:a.jsx("img",{src:t.src,width:t.bounds.width,height:t.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${t.bounds.x}px, ${t.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function cte(){const n=G(),e=q("selection rotation",()=>n.getSelectionRotation(),[n]),t=q("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:s}=kt();return!t||!s?null:a.jsx(s,{bounds:t,rotation:e})}function dte(){const n=G(),e=q("selection rotation",()=>n.getSelectionRotation(),[n]),t=q("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:s}=kt();return!t||!s?null:a.jsx(s,{bounds:t,rotation:e})}function ute(){const{OnTheCanvas:n}=kt();return n?a.jsx(n,{}):null}function hte(){const n=G(),e=q("camera state",()=>n.getCameraState(),[n]);return a.jsx("div",{className:Se("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function pte({className:n,zoom:e,point:t,color:s,viewport:i,opacity:r=1}){const o=b.useRef(null);return $d(o,tn(t.x,i.minX+5/e,i.maxX-5/e),tn(t.y,i.minY+5/e,i.maxY-5/e),1/e,_.Angle(i.center,t)),a.jsxs("svg",{ref:o,className:Se("tl-overlays__item",n),children:[a.jsx("use",{href:"#cursor_hint",color:s,strokeWidth:3,stroke:"var(--color-background)"}),a.jsx("use",{href:"#cursor_hint",color:s,opacity:r})]})}const uA=b.memo(function({className:e,zoom:t,point:s,color:i,name:r,chatMessage:o}){const l=b.useRef(null);return $d(l,s==null?void 0:s.x,s==null?void 0:s.y,1/t),s?a.jsxs("div",{ref:l,className:Se("tl-overlays__item",e),children:[a.jsx("svg",{className:"tl-cursor",children:a.jsx("use",{href:"#cursor",color:i})}),o?a.jsxs(a.Fragment,{children:[r&&a.jsx("div",{className:"tl-nametag-title",style:{color:i},children:r}),a.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:o})]}):r&&a.jsx("div",{className:"tl-nametag",style:{backgroundColor:i},children:r})]}):null});function $L(){return b.useId().replace(/:/g,"_")}function fte({x:n,y:e,z:t,size:s}){const i=`grid_${$L()}`,r=G(),{gridSteps:o}=r.options;return a.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[a.jsx("defs",{children:o.map(({min:l,mid:c,step:d},u)=>{const h=d*s*t,p=.5+n*t,f=.5+e*t,g=p>0?p%h:h+p%h,m=f>0?f%h:h+f%h,x=t<c?yd(t,[l,c],[0,1]):1;return a.jsx("pattern",{id:`${i}_${d}`,width:h,height:h,patternUnits:"userSpaceOnUse",children:a.jsx("circle",{className:"tl-grid-dot",cx:g,cy:m,r:1,opacity:x})},u)})}),o.map(({step:l},c)=>a.jsx("rect",{width:"100%",height:"100%",fill:`url(#${i}_${l})`},c))]})}function gte({handle:n,isCoarse:e,className:t,zoom:s}){const i=G(),r=(e?i.options.coarseHandleRadius:i.options.handleRadius)/s;if(n.type==="clone"){const l=3/s,c=`M0,${-l} A${l},${l} 0 0,1 0,${l}`,d=wQ.indexOf(n.id);return a.jsxs("g",{className:Se(`tl-handle tl-handle__${n.type}`,t),children:[a.jsx("circle",{className:"tl-handle__bg",r}),a.jsx("path",{className:"tl-handle__fg",d:c,transform:`rotate(${-90+90*d})`})]})}const o=(n.type==="create"&&e?3:4)/Math.max(s,.25);return a.jsxs("g",{className:Se(`tl-handle tl-handle__${n.type}`,t),children:[a.jsx("circle",{className:"tl-handle__bg",r}),a.jsx("circle",{className:"tl-handle__fg",r:o})]})}const mte=({children:n})=>a.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),yte=()=>{const{Spinner:n}=kt();return a.jsx(s1,{children:n?a.jsx(n,{}):null})};function HE(n,e=!0){const t=n.length;if(t<2)return"";let s=n[0],i=n[1];if(t===2)return`M${Ye(s)}L${Ye(i)}`;let r="";for(let o=2,l=t-1;o<l;o++)s=n[o],i=n[o+1],r+=_s(s,i);return e?`M${_s(n[0],n[1])}Q${Ye(n[1])}${_s(n[1],n[2])}T${r}${_s(n[t-1],n[0])}${_s(n[0],n[1])}Z`:`M${Ye(n[0])}Q${Ye(n[1])}${_s(n[1],n[2])}${n.length>3?"T":""}${r}L${Ye(n[t-1])}`}function hA({scribble:n,zoom:e,color:t,opacity:s,className:i}){return n.points.length?a.jsx("svg",{className:i&&Se("tl-overlays__item",i),children:a.jsx("path",{className:"tl-scribble",d:HE(n.points,!1),stroke:t??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:s??n.opacity})}):null}function zL({bounds:n,rotation:e}){const t=b.useRef(null);return $d(t,n.x,n.y,1,e),b.useLayoutEffect(()=>{const s=t.current;s&&(s.style.width=H(Math.max(1,n.width))+"px",s.style.height=H(Math.max(1,n.height))+"px")},[n.width,n.height]),a.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})}function vte({bounds:n,rotation:e}){const t=G(),s=b.useRef(null),i=q("only selected shape",()=>t.getOnlySelectedShape(),[t]),r=i?t.getShapeUtil(i).expandSelectionOutlinePx(i):0;return $d(s,n==null?void 0:n.x,n==null?void 0:n.y,1,e,{x:-r,y:-r}),n=n.clone().expandBy(r).zeroFix(),a.jsx("svg",{ref:s,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:a.jsx("rect",{className:Se("tl-selection__fg__outline"),width:H(n.width),height:H(n.height)})})}const xte=()=>a.jsx("div",{className:"tl-shape-error-boundary"}),Ste=({shape:n,util:e})=>Jv("Indicator: "+n.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(n.id))),wte=({editor:n,id:e})=>{const t=q("shape for indicator",()=>n.store.get(e),[n,e]),{ShapeIndicatorErrorFallback:s}=kt();return!t||t.isLocked?null:a.jsx(ip,{fallback:s,onError:i=>n.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:a.jsx(Ste,{shape:t,util:n.getShapeUtil(t)},t.id)})},pA=b.memo(function({shapeId:e,className:t,color:s,hidden:i,opacity:r}){const o=G(),l=b.useRef(null);return Sa("indicator transform",()=>{const c=l.current;if(!c)return;const d=o.getShapePageTransform(e);d&&c.style.setProperty("transform",d.toCssString())},[o,e]),b.useLayoutEffect(()=>{const c=l.current;c&&c.style.setProperty("display",i?"none":"block")},[i]),a.jsx("svg",{ref:l,className:Se("tl-overlays__item",t),children:a.jsx("g",{className:"tl-shape-indicator",stroke:s??"var(--color-selected)",opacity:r,children:a.jsx(wte,{editor:o,id:e})})})}),bte=()=>a.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),WL=b.memo(function(){const e=G(),t=b.useRef(new Set),s=q("should display selected ids",()=>{const o=t.current,l=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const c=e.getSelectedShapeIds();for(const d of c)l.add(d);if(e.isInAny("select.idle","select.editing_shape")){const d=e.getInstanceState();if(d.isHoveringCanvas&&!d.isCoarsePointer){const u=e.getHoveredShapeId();u&&l.add(u)}}}if(o.size!==l.size)return t.current=l,l;for(const c of l)if(!o.has(c))return t.current=l,l;return o},[e]),i=q("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:r}=kt();return r?i.map(({id:o})=>a.jsx(r,{shapeId:o,hidden:!s.has(o)},o+"_indicator")):null});function _te({points:n,zoom:e}){const t=2.5/e,s=n.reduce((p,f)=>Math.min(p,f.x),1/0),i=n.reduce((p,f)=>Math.max(p,f.x),-1/0),r=n.reduce((p,f)=>Math.min(p,f.y),1/0),o=n.reduce((p,f)=>Math.max(p,f.y),-1/0),l=n.some(p=>p.x===s&&p.y===r);let c,d,u,h;return l?(c=s,d=r,u=i,h=o):(c=s,d=o,u=i,h=r),a.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[a.jsx("line",{x1:c,y1:d,x2:u,y2:h}),n.map((p,f)=>a.jsx("g",{transform:`translate(${p.x},${p.y})`,children:a.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},f))]})}function Cte({gaps:n,direction:e,zoom:t}){const s=3.5/t;let i=[-1/0,1/0],r=null;const o=e==="horizontal";for(const c of n){if(r=Mi(i[0],i[1],o?c.startEdge[0].y:c.startEdge[0].x,o?c.startEdge[1].y:c.startEdge[1].x),r)i=r;else continue;if(r=Mi(i[0],i[1],o?c.endEdge[0].y:c.endEdge[0].x,o?c.endEdge[1].y:c.endEdge[1].x),r)i=r;else continue}if(i===null)return null;const l=(i[0]+i[1])/2;return a.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:n.map(({startEdge:c,endEdge:d},u)=>a.jsx(b.Fragment,{children:o?a.jsxs(a.Fragment,{children:[a.jsx("line",{x1:c[0].x,y1:l-2*s,x2:c[1].x,y2:l+2*s}),a.jsx("line",{x1:d[0].x,y1:l-2*s,x2:d[1].x,y2:l+2*s}),a.jsx("line",{x1:c[0].x,y1:l,x2:d[0].x,y2:l}),a.jsx("line",{x1:(c[0].x+d[0].x)/2,y1:l-s,x2:(c[0].x+d[0].x)/2,y2:l+s})]}):a.jsxs(a.Fragment,{children:[a.jsx("line",{x1:l-2*s,y1:c[0].y,x2:l+2*s,y2:c[1].y}),a.jsx("line",{x1:l-2*s,y1:d[0].y,x2:l+2*s,y2:d[1].y}),a.jsx("line",{x1:l,y1:c[0].y,x2:l,y2:d[0].y}),a.jsx("line",{x1:l-s,y1:(c[0].y+d[0].y)/2,x2:l+s,y2:(c[0].y+d[0].y)/2})]})},u))})}function Ete({className:n,line:e,zoom:t}){return a.jsx("svg",{className:Se("tl-overlays__item",n),children:e.type==="points"?a.jsx(_te,{...e,zoom:t}):e.type==="gaps"?a.jsx(Cte,{...e,zoom:t}):null})}function GE(){return a.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:a.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[a.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),a.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:a.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const Tte=()=>null;function HL(n,e){const t=b.useRef(n);return e(n,t.current)?t.current:(t.current=n,n)}function _h(n){return HL(n,fZ)}const Ite=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:mD(n,e));function tx(n){return HL(n,Ite)}const GL=b.createContext(null);function Pte({overrides:n={},children:e}){const t=tx(n),s=b.useMemo(()=>({Background:fQ,SvgDefs:Tte,Brush:rw,ZoomBrush:rw,CollaboratorBrush:rw,Cursor:uA,CollaboratorCursor:uA,CollaboratorHint:pte,CollaboratorShapeIndicator:pA,Grid:fte,Scribble:hA,SnapIndicator:Ete,Handles:mte,Handle:gte,CollaboratorScribble:hA,ErrorFallback:KL,ShapeErrorFallback:xte,ShapeIndicatorErrorFallback:bte,Spinner:GE,SelectionBackground:zL,SelectionForeground:vte,ShapeIndicators:WL,ShapeIndicator:pA,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:Vee,LoadingScreen:yte,...t}),[t]);return a.jsx(GL.Provider,{value:s,children:e})}function kt(){const n=b.useContext(GL);if(!n)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return n}const VE={openWindow:(n,e)=>window.open(n,e,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function VL(){VE.hardReset()}function kte(){VE.refreshPage()}const Ate="https://github.com/tldraw/tldraw/issues/new",KL=({error:n,editor:e})=>{const t=b.useRef(null),[s,i]=b.useState(!1),[r,o]=b.useState(!1),[l,c]=b.useState(!1);let d=null;try{d=kt().Canvas??null}catch{}const u=n instanceof Error?n.message:String(n),h=n instanceof Error?n.stack:null,p=q("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[f,g]=b.useState(null);b.useLayoutEffect(()=>{var T;p!==null&&g(p);let v=(T=t.current)==null?void 0:T.parentElement,C=!1;for(;v;){if(v.classList.contains("tl-theme__dark")||v.classList.contains("tl-theme__light")){C=!0;break}v=v.parentElement}if(C){g(null);return}typeof window<"u"&&"matchMedia"in window&&g(window.matchMedia("(prefers-color-scheme: dark)").matches)},[p]),b.useEffect(()=>{if(r){const v=e==null?void 0:e.timers.setTimeout(()=>{o(!1)},2e3);return()=>clearTimeout(v)}},[r,e]);const m=()=>{const v=document.createElement("textarea");v.value=h??u,document.body.appendChild(v),v.select(),document.execCommand("copy"),v.remove(),o(!0)},x=()=>{kte()},y=async()=>{VL()},S=new URL(Ate);return S.searchParams.set("title",u),S.searchParams.set("labels","bug"),S.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${h??u}
\`\`\`

My browser: ${navigator.userAgent}`),a.jsxs("div",{ref:t,className:Se("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[a.jsx("div",{className:"tl-error-boundary__overlay"}),e&&a.jsx(SL,{onError:Qh,fallback:()=>null,children:a.jsx(Qv.Provider,{value:e,children:a.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:d?a.jsx(d,{}):null})})}),a.jsx("div",{className:Se("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":s&&!l}),children:l?a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Are you sure?"}),a.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),a.jsxs("div",{className:"tl-error-boundary__content__actions",children:[a.jsx("button",{onClick:()=>c(!1),children:"Cancel"}),a.jsx("button",{className:"tl-error-boundary__reset",onClick:y,children:"Reset data"})]})]}):a.jsxs(a.Fragment,{children:[a.jsx("h2",{children:"Something's gone wrong."}),a.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",a.jsx("a",{href:S.toString(),children:"create a GitHub issue"})," or"," ",a.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),s&&a.jsxs(a.Fragment,{children:["Message:",a.jsx("h4",{children:a.jsx("code",{children:u})}),"Stack trace:",a.jsxs("div",{className:"tl-error-boundary__content__error",children:[a.jsx("pre",{children:a.jsx("code",{children:h??u})}),a.jsx("button",{onClick:m,children:r?"Copied!":"Copy"})]})]}),a.jsxs("div",{className:"tl-error-boundary__content__actions",children:[a.jsx("button",{onClick:()=>i(!s),children:s?"Hide details":"Show details"}),a.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[a.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),a.jsx("button",{className:"tl-error-boundary__refresh",onClick:x,children:"Refresh Page"})]})]})]})})]})};function Rt(){return Mp()}const YL="TLDRAW_USER_DATA_v3",XL=Le({id:Pe,name:Pe.nullable().optional(),locale:Pe.nullable().optional(),color:Pe.nullable().optional(),colorScheme:qv("light","dark","system").optional(),animationSpeed:_e.nullable().optional(),edgeScrollSpeed:_e.nullable().optional(),isSnapMode:Me.nullable().optional(),isWrapMode:Me.nullable().optional(),isDynamicSizeMode:Me.nullable().optional(),isPasteAtCursorMode:Me.nullable().optional()}),Hr={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},KE=Math.max(...Object.values(Hr));function jte(n){n.version<Hr.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<Hr.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version<Hr.MakeFieldsNullable,n.version<Hr.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<Hr.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<Hr.AllowSystemColorScheme&&(n.user.isDarkMode===!0?n.user.colorScheme="dark":n.user.isDarkMode===!1&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<Hr.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version<Hr.AddPasteAtCursor&&(n.user.isPasteAtCursorMode=!1),n.version=KE}const J0=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function qL(){return J0[Math.floor(Math.random()*J0.length)]}function Nte(){var n,e;return typeof window<"u"&&"matchMedia"in window?((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const Wr=Object.freeze({name:"New User",locale:oQ(),color:qL(),edgeScrollSpeed:1,animationSpeed:Nte()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"system"});function lw(){return{id:Rt(),color:qL()}}function ZL(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return lw();const e=ft(n);jte(e);try{return XL.validate(e.user)}catch{return lw()}}function Rte(){const n=JSON.parse(IE(YL)||"null")??null;return ZL(n)}const nx=an("globalUserData",null);function Mte(){PE(YL,JSON.stringify({version:KE,user:nx.get()}))}function JL(n){XL.validate(n),nx.set(n),Mte(),Ote()}const Qc=typeof BroadcastChannel<"u"?new BroadcastChannel("tldraw-user-sync"):null;Qc==null||Qc.addEventListener("message",n=>{const e=n.data;(e==null?void 0:e.type)===eF&&(e==null?void 0:e.origin)!==QL()&&nx.set(ZL(e.data))});let cw=null;function QL(){return cw===null&&(cw=Rt()),cw}const eF="tldraw-user-preferences-change";function Ote(){Qc==null||Qc.postMessage({type:eF,origin:QL(),data:{user:tF(),version:KE}})}function tF(){let n=nx.get();return n||(n=Rte(),JL(n)),n}const Dte=Q("defaultLocalStorageUserPrefs",()=>tF());function nF(n={}){return{userPreferences:n.userPreferences??Dte,setUserPreferences:n.setUserPreferences??JL}}var sF={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function i(c,d,u){this.fn=c,this.context=d,this.once=u||!1}function r(c,d,u,h,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new i(u,h||c,p),g=t?t+d:d;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],f]:c._events[g].push(f):(c._events[g]=f,c._eventsCount++),c}function o(c,d){--c._eventsCount===0?c._events=new s:delete c._events[d]}function l(){this._events=new s,this._eventsCount=0}l.prototype.eventNames=function(){var d=[],u,h;if(this._eventsCount===0)return d;for(h in u=this._events)e.call(u,h)&&d.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(u)):d},l.prototype.listeners=function(d){var u=t?t+d:d,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,f=h.length,g=new Array(f);p<f;p++)g[p]=h[p].fn;return g},l.prototype.listenerCount=function(d){var u=t?t+d:d,h=this._events[u];return h?h.fn?1:h.length:0},l.prototype.emit=function(d,u,h,p,f,g){var m=t?t+d:d;if(!this._events[m])return!1;var x=this._events[m],y=arguments.length,S,v;if(x.fn){switch(x.once&&this.removeListener(d,x.fn,void 0,!0),y){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,u),!0;case 3:return x.fn.call(x.context,u,h),!0;case 4:return x.fn.call(x.context,u,h,p),!0;case 5:return x.fn.call(x.context,u,h,p,f),!0;case 6:return x.fn.call(x.context,u,h,p,f,g),!0}for(v=1,S=new Array(y-1);v<y;v++)S[v-1]=arguments[v];x.fn.apply(x.context,S)}else{var C=x.length,T;for(v=0;v<C;v++)switch(x[v].once&&this.removeListener(d,x[v].fn,void 0,!0),y){case 1:x[v].fn.call(x[v].context);break;case 2:x[v].fn.call(x[v].context,u);break;case 3:x[v].fn.call(x[v].context,u,h);break;case 4:x[v].fn.call(x[v].context,u,h,p);break;default:if(!S)for(T=1,S=new Array(y-1);T<y;T++)S[T-1]=arguments[T];x[v].fn.apply(x[v].context,S)}}return!0},l.prototype.on=function(d,u,h){return r(this,d,u,h,!1)},l.prototype.once=function(d,u,h){return r(this,d,u,h,!0)},l.prototype.removeListener=function(d,u,h,p){var f=t?t+d:d;if(!this._events[f])return this;if(!u)return o(this,f),this;var g=this._events[f];if(g.fn)g.fn===u&&(!p||g.once)&&(!h||g.context===h)&&o(this,f);else{for(var m=0,x=[],y=g.length;m<y;m++)(g[m].fn!==u||p&&!g[m].once||h&&g[m].context!==h)&&x.push(g[m]);x.length?this._events[f]=x.length===1?x[0]:x:o(this,f)}return this},l.prototype.removeAllListeners=function(d){var u;return d?(u=t?t+d:d,this._events[u]&&o(this,u)):(this._events=new s,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=t,l.EventEmitter=l,n.exports=l})(sF);var Lte=sF.exports;const Fte=Oa(Lte),ed="TLDRAW_TAB_ID_v2",Er=globalThis.window;function Bte(){return Er?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Er.navigator.platform)||Er.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const Ny=Er?Er[ed]??bD(ed)??"TLDRAW_INSTANCE_STATE_V1_"+Rt():"<error>";Er&&(Er[ed]=Ny,Bte()?kE(ed,Ny):_D(ed));Er==null||Er.addEventListener("beforeunload",()=>{kE(ed,Ny)});const iF={Initial:0},sx=Math.max(...Object.values(iF));function Ute(n){n.version<iF.Initial,n.version=sx}const rF=Le({version:_e,currentPageId:np,isFocusMode:Me,exportBackground:Me,isDebugMode:Me,isToolLocked:Me,isGridMode:Me,pageStates:bn(Le({pageId:np,camera:Le({x:_e,y:_e,z:_e}),selectedShapeIds:bn(ci),focusedGroupId:ci.nullable()}))});function $te(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;n.version!==sx&&(n=ft(n),Ute(n));try{return rF.validate(n)}catch(e){return console.warn(e),null}}function oF(n){const e=n.query.ids("page");return Q("sessionStateSnapshot",()=>{const t=n.get(ns);if(!t)return null;const s=[...e.get()];return{version:sx,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:s.map(i=>{const r=n.get(Bi.createId(i)),o=n.get(mr.createId(i));return{pageId:i,camera:{x:(o==null?void 0:o.x)??0,y:(o==null?void 0:o.y)??0,z:(o==null?void 0:o.z)??1},selectedShapeIds:(r==null?void 0:r.selectedShapeIds)??[],focusedGroupId:(r==null?void 0:r.focusedGroupId)??null}})}})}function aF(n,e){const t=$te(e);if(!t)return;const s=n.schema.types.instance.create({id:ns,...VD(n.get(ns)),currentPageId:t.currentPageId,isDebugMode:t.isDebugMode,isFocusMode:t.isFocusMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,exportBackground:t.exportBackground}),i=n.allRecords().filter(r=>r.typeName==="instance_page_state"||r.typeName==="camera");n.atomic(()=>{n.remove(i.map(r=>r.id));for(const r of t.pageStates)n.put([mr.create({id:mr.createId(r.pageId),x:r.camera.x,y:r.camera.y,z:r.camera.z}),Bi.create({id:Bi.createId(r.pageId),pageId:r.pageId,selectedShapeIds:r.selectedShapeIds,focusedGroupId:r.focusedGroupId})]);n.put([s]),n.ensureStoreIsUsable()})}function zte(n){var i;const e=[];for(const r of Object.values(n))(i=r.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&e.push(r);const t=e.filter(r=>r.typeName==="instance"&&r.id!==ns)[0];if(!t)return null;const s={version:sx,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(r=>r.typeName==="instance_page_state"&&r.instanceId===t.id).map(r=>{const o=n[r.cameraId]??{x:0,y:0,z:1};return{pageId:r.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:r.selectedShapeIds,focusedGroupId:r.focusedGroupId}})};try{return rF.validate(s),s}catch{return null}}function lF(n,e){let t={};if("store"in e){const i=n.schema.migrateStoreSnapshot(e);if(i.type!=="success")throw new Error("Failed to migrate store snapshot: "+i.reason);t.document={schema:n.schema.serialize(),store:Sh(i.value,(r,{typeName:o})=>n.scopedTypes.document.has(o))}}else t=e;const s=VD(n.get(ns));n.atomic(()=>{t.document&&n.loadStoreSnapshot(t.document),s&&n.update(ns,i=>({...i,...s})),t.session&&aF(n,t.session)})}const Wte=new xo;function Hte(n){const t=Wte.get(n,oF).get();if(!t)throw new Error("Session state is not ready yet");return{document:n.getStoreSnapshot(),session:t}}function cF(n){const e=[],t=new Set;for(const s of n){if(t.has(s.type))throw new Error(`Binding type "${s.type}" is defined more than once`);e.push(s),t.add(s.type)}return e}function ja({children:n,className:e="",...t}){return a.jsx("svg",{...t,className:Se("tl-svg-container",e),children:n})}function YE(n,e,t,s){const i=n.x-t.x,r=n.y-t.y,o=s.x-t.x,l=s.y-t.y,c=e.x-n.x,d=e.y-n.y,u=o*r-l*i,h=c*r-d*i,p=l*c-o*d;if(u===0||h===0||p===0)return null;if(p!==0){const f=u/p,g=h/p;if(0<=f&&f<=1&&0<=g&&g<=1)return _.AddXY(n,f*c,f*d)}return null}function $p(n,e,t,s){const i=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),r=2*((e.x-n.x)*(n.x-t.x)+(e.y-n.y)*(n.y-t.y)),o=t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-s*s,l=r*r-4*i*o;if(l<0||l===0)return null;const c=Math.sqrt(l),d=(-r+c)/(2*i),u=(-r-c)/(2*i);if((d<0||d>1)&&(u<0||u>1))return null;const h=[];return 0<=d&&d<=1&&h.push(_.Lrp(n,e,d)),0<=u&&u<=1&&h.push(_.Lrp(n,e,u)),h.length===0?null:h}function Gte(n,e,t){const s=[];let i;for(let r=0,o=t.length-1;r<o;r++)i=YE(n,e,t[r],t[r+1]),i&&s.push(i);return s.length===0?null:s}function XE(n,e,t){const s=[];let i;for(let r=1,o=t.length;r<o+1;r++)i=YE(n,e,t[r-1],t[r%t.length]),i&&s.push(i);return s.length===0?null:s}function Vte(n,e,t,s){let i=t.x-n.x,r=t.y-n.y;const o=Math.sqrt(i*i+r*r),l=(o*o-s*s+e*e)/(2*o),c=Math.sqrt(e*e-l*l);return i/=o,r/=o,[new _(n.x+i*l-r*c,n.y+r*l+i*c),new _(n.x+i*l+r*c,n.y+r*l-i*c)]}function Q0(n,e,t){const s=[];let i,r,o;for(let l=0,c=t.length;l<c;l++)i=t[l],r=t[(l+1)%t.length],o=$p(i,r,n,e),o&&s.push(...o);return s.length===0?null:s}function fA(n,e,t){const s=[];let i,r,o;for(let l=1,c=t.length;l<c;l++)i=t[l-1],r=t[l],o=$p(i,r,n,e),o&&s.push(...o);return s.length===0?null:s}function Jf(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function qE(n,e,t,s){return Jf(n,t,s)!==Jf(e,t,s)&&Jf(n,e,t)!==Jf(n,e,s)}function gA(n,e){const t=new Map;let s,i,r,o;for(let l=0,c=n.length;l<c;l++)if(s=n[l],Xs(s,e)){const d=dw(s);t.has(d)||t.set(d,s)}for(let l=0,c=e.length;l<c;l++)if(s=e[l],Xs(s,n)){const d=dw(s);t.has(d)||t.set(d,s)}for(let l=0,c=n.length;l<c;l++){s=n[l],i=n[(l+1)%n.length];for(let d=0,u=e.length;d<u;d++){r=e[d],o=e[(d+1)%e.length];const h=YE(s,i,r,o);if(h!==null){const p=dw(h);t.has(p)||t.set(p,h)}}}return t.size===0?null:Kte([...t.values()])}function dw(n){return`${n.x},${n.y}`}function Kte(n){const e=_.Average(n);return n.sort((t,s)=>_.Angle(e,t)-_.Angle(e,s))}function dF(n,e){let t,s,i,r;for(let o=0,l=n.length;o<l;o++){t=n[o],s=n[(o+1)%l];for(let c=0,d=e.length;c<d;c++)if(i=e[c],r=e[(c+1)%d],qE(t,s,i,r))return!0}return!1}function Yte(n,e){let t,s,i,r;for(let o=0,l=n.length;o<l;o++){t=n[o],s=n[(o+1)%l];for(let c=1,d=e.length;c<d;c++)if(i=e[c-1],r=e[c],qE(t,s,i,r))return!0}return!1}class no extends za{constructor(t){super({...t,isClosed:!1,isFilled:!1});w(this,"start");w(this,"end");w(this,"d");w(this,"u");w(this,"ul");const{start:s,end:i}=t;this.start=s,this.end=i,this.d=s.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:s,end:i,u:r,ul:o}=this;if(o===0)return s;const l=_.Sub(t,s).dpr(r)/o,c=s.x+r.x*l;if(c<Math.min(s.x,i.x))return s.x<i.x?s:i;if(c>Math.max(s.x,i.x))return s.x>i.x?s:i;const d=s.y+r.y*l;return d<Math.min(s.y,i.y)?s.y<i.y?s:i:d>Math.max(s.y,i.y)?s.y>i.y?s:i:new _(c,d)}hitTestLineSegment(t,s,i=0){return qE(t,s,this.start,this.end)||this.distanceToLineSegment(t,s)<=i}getSvgPathData(t=!0){const{start:s,end:i}=this;return`${t?`M${s.toFixed()}`:""} L${i.toFixed()}`}}class zd extends za{constructor(t){super({isClosed:!1,isFilled:!1,...t});w(this,"points");w(this,"_segments");const{points:s}=t;this.points=s}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let s=0,i=t.length-1;s<i;s++){const r=t[s],o=t[s+1];this._segments.push(new no({start:r,end:o}))}this.isClosed&&this._segments.push(new no({start:t[t.length-1],end:t[0]}))}return this._segments}getLength(){return this.segments.reduce((t,s)=>t+s.length,0)}getVertices(){return this.points}nearestPoint(t){const{segments:s}=this;let i=this.points[0],r=1/0,o,l;for(let c=0;c<s.length;c++)o=s[c].nearestPoint(t),l=_.Dist2(o,t),l<r&&(i=o,r=l);if(!i)throw Error("nearest point not found");return i}hitTestLineSegment(t,s,i=0){const{segments:r}=this;for(let o=0,l=r.length;o<l;o++)if(r[o].hitTestLineSegment(t,s,i))return!0;return!1}getSvgPathData(){const{vertices:t}=this;return t.length<2?"":t.reduce((s,i,r)=>r===0?`M ${i.x} ${i.y}`:`${s} L ${i.x} ${i.y}`,"")}}class Wt extends zd{constructor(e){super({...e}),this.isClosed=!0}}class wo extends Wt{constructor(t){const{x:s=0,y:i=0,width:r,height:o}=t;super({...t,points:[new _(s,i),new _(s+r,i),new _(s+r,i+o),new _(s,i+o)]});w(this,"x");w(this,"y");w(this,"w");w(this,"h");this.x=s,this.y=i,this.w=r,this.h=o}getBounds(){return new ue(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:t,y:s,w:i,h:r}=this;return`M${t},${s} h${i} v${r} h-${i}z`}}class Wi{constructor(e){w(this,"canSnap",()=>!0);w(this,"canScroll",()=>!1);w(this,"canEdit",()=>!1);w(this,"canResize",()=>!0);w(this,"canEditInReadOnly",()=>!1);w(this,"canCrop",()=>!1);w(this,"canBeLaidOut",()=>!0);w(this,"hideResizeHandles",()=>!1);w(this,"hideRotateHandle",()=>!1);w(this,"hideSelectionBoundsBg",()=>!1);w(this,"hideSelectionBoundsFg",()=>!1);w(this,"isAspectRatioLocked",()=>!1);w(this,"onBeforeCreate");w(this,"onBeforeUpdate");w(this,"onDragShapesOver");w(this,"onDragShapesOut");w(this,"onDropShapesOver");w(this,"onResizeStart");w(this,"onResize");w(this,"onResizeEnd");w(this,"onTranslateStart");w(this,"onTranslate");w(this,"onTranslateEnd");w(this,"onHandleDrag");w(this,"onRotateStart");w(this,"onRotate");w(this,"onRotateEnd");w(this,"onBindingChange");w(this,"onChildrenChange");w(this,"onDoubleClickHandle");w(this,"onDoubleClickEdge");w(this,"onDoubleClick");w(this,"onClick");w(this,"onEditEnd");this.editor=e}canBind(e){return!0}providesBackgroundForChildren(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}}w(Wi,"props"),w(Wi,"migrations"),w(Wi,"type");function Xte(n,e,t={}){const{closed:s=!1,snap:i=1,start:r="outset",end:o="outset",lengthRatio:l=2,style:c="dashed"}=t;let d=0,u=0,h=1,p=0,f=0;switch(c){case"dashed":{h=1,d=Math.min(e*l,n/4);break}case"dotted":{h=100,d=e/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return s||(r==="outset"?(n+=d/2,f+=d/2):r==="skip"&&(n-=d,f-=d),o==="outset"?n+=d/2:o==="skip"&&(n-=d)),u=Math.floor(n/d/(2*h)),u-=u%i,u<3&&c==="dashed"?n/e<5?(d=n,u=1,p=0):(d=n*.333,p=n*.333):(u=Math.max(u,3),d=n/u/(2*h),s?(f=d/2,p=(n-u*d)/u):p=(n-u*d)/Math.max(1,u-1)),{strokeDasharray:[d,p].join(" "),strokeDashoffset:f.toString()}}function mA({bounds:n,className:e}){const t=G(),s=q("zoom level",()=>t.getZoomLevel(),[t]);return a.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((i,r)=>{const{strokeDasharray:o,strokeDashoffset:l}=Xte(i[0].dist(i[1]),1/s,{style:"dashed",lengthRatio:4});return a.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:o,strokeDashoffset:l},r)})})}class Qg extends Wi{constructor(){super(...arguments);w(this,"hideSelectionBoundsFg",()=>!0);w(this,"canBind",()=>!1);w(this,"onChildrenChange",t=>{const s=this.editor.getSortedChildIdsForParent(t.id);if(s.length===0){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([t.id]);return}else if(s.length===1){this.editor.getCurrentPageState().focusedGroupId===t.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(s,t.parentId),this.editor.deleteShapes([t.id]);return}})}getDefaultProps(){return{}}getGeometry(t){const s=this.editor.getSortedChildIdsForParent(t.id);return s.length===0?new wo({width:1,height:1,isFilled:!1}):new Yi({children:s.map(i=>{const r=this.editor.getShape(i),o=this.editor.getShapeGeometry(i),l=this.editor.getShapeLocalTransform(r).applyToPoints(o.vertices);return o.isClosed?new Wt({points:l,isFilled:!0}):new zd({points:l})})})}component(t){const s=this.editor.getErasingShapeIds().includes(t.id),{hintingShapeIds:i}=this.editor.getCurrentPageState(),r=i.length>0&&i.some(c=>c!==t.id&&this.editor.isShapeOfType(this.editor.getShape(c),"group")),o=this.editor.getCurrentPageState().focusedGroupId!==t.id;if(!s&&(o||r))return null;const l=this.editor.getShapeGeometry(t).bounds;return a.jsx(ja,{id:t.id,children:a.jsx(mA,{className:"tl-group",bounds:l})})}indicator(t){const s=this.editor.getShapeGeometry(t).bounds;return a.jsx(mA,{className:"",bounds:s})}}w(Qg,"type","group"),w(Qg,"props",iL),w(Qg,"migrations",rL);const uF=[Qg],qte=new Set(uF.map(n=>n.type));function hF(n){const e=[...uF],t=new Set;for(const s of n){if(qte.has(s.type))throw new Error(`Shape type "${s.type}" is a core shapes type and cannot be overridden`);if(t.has(s.type))throw new Error(`Shape type "${s.type}" is defined more than once`);e.push(s),t.add(s.type)}return e}const Zte={maxShapesPerPage:4e3,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16};function yA(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw Vn(n)}}class Jte{constructor(e){w(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[s,i]of this){if(!yA(i,e.get(s)))return!1;t.add(s)}for(const[s,i]of e)if(!t.has(s)&&!yA(i,this.get(s)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class e_ extends Jte{set(e,t){this.map.set(e,t)}applyValue(e,t){const s=this.get(e);if(!s){this.set(e,{type:"shared",value:t});return}switch(s.type){case"mixed":return;case"shared":s.value!==t&&this.set(e,{type:"mixed"});return;default:Vn(s,"type")}}}function Qte(n,e,t){return Ar(n).then(function(s){return s.arrayBuffer()}).then(function(s){return new File([s],e,{type:t})})}const ene="https://cdn.tldraw.com";function la(){return`${ene}/${xL}`}function tne(n,e){var i;let t=n;const s=new Set(e);for(;s.has(t);)t=(i=/^.*(\d+)$/.exec(t))!=null&&i[1]?t.replace(/(\d+)(?=\D?)$/,r=>(+r+1).toString()):`${t} 1`;return t}function Qf(n,e,t){if(t.length===0)return[];const s=new Map;for(const r of Ne(t.map(o=>n.getShape(o)))){const{parentId:o}=r;s.has(o)||s.set(o,{children:Ne(n.getSortedChildIdsForParent(o).map(l=>n.getShape(l))),moving:new Set}),s.get(o).moving.add(r)}const i=[];switch(e){case"toBack":{s.forEach(({moving:r,children:o})=>nne(r,o,i));break}case"toFront":{s.forEach(({moving:r,children:o})=>sne(r,o,i));break}case"forward":{s.forEach(({moving:r,children:o})=>ine(r,o,i));break}case"backward":{s.forEach(({moving:r,children:o})=>rne(r,o,i));break}}return i}function nne(n,e,t){const s=e.length;if(n.size===s)return;let i,r;for(let o=0;o<s;o++){const l=e[o];if(n.has(l))i=l.index,n.delete(l);else{r=l.index;break}}if(n.size!==0){const o=vd(i,r,n.size);t.push(...Array.from(n.values()).sort(Hn).map((l,c)=>({...l,index:o[c]})))}}function sne(n,e,t){const s=e.length;if(n.size===s)return;let i,r;for(let o=s-1;o>-1;o--){const l=e[o];if(n.has(l))r=l.index,n.delete(l);else{i=l.index;break}}if(n.size!==0){const o=vd(i,r,n.size);t.push(...Array.from(n.values()).sort(Hn).map((l,c)=>({...l,index:o[c]})))}}function ine(n,e,t){var r;const s=e.length;if(n.size===s)return;let i={name:"skipping"};for(let o=0;o<s;o++){const l=n.has(e[o]);switch(i.name){case"skipping":{if(!l)continue;i={name:"selecting",selectIndex:o};break}case"selecting":{if(l)continue;const{selectIndex:c}=i;vd(e[o].index,(r=e[o+1])==null?void 0:r.index,o-c).forEach((d,u)=>t.push({...e[c+u],index:d})),i={name:"skipping"};break}}}}function rne(n,e,t){var r;const s=e.length;if(n.size===s)return;let i={name:"skipping"};for(let o=s-1;o>-1;o--){const l=n.has(e[o]);switch(i.name){case"skipping":{if(!l)continue;i={name:"selecting",selectIndex:o};break}case"selecting":{if(l)continue;vd((r=e[o-1])==null?void 0:r.index,e[o].index,i.selectIndex-o).forEach((c,d)=>{t.push({...e[o+d+1],index:c})}),i={name:"skipping"};break}}}}function pF({editor:n}){const e=n.getSelectedShapes(),t=n.getSelectionRotation(),s=n.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:i}}=n;if(!s)return null;const r=s.center.clone().rotWith(s.point,t);return{selectionPageCenter:r,initialCursorAngle:r.angle(i),initialSelectionRotation:t,shapeSnapshots:e.map(o=>({shape:ft(o),initialPagePoint:n.getShapePageTransform(o.id).point()}))}}function em({delta:n,editor:e,snapshot:t,stage:s}){const{selectionPageCenter:i,shapeSnapshots:r}=t;e.updateShapes(r.map(({shape:l,initialPagePoint:c})=>{const d=Ss(l.parentId)?e.getShapePageTransform(l.parentId):ve.Identity(),u=_.RotWith(c,i,n),h=ve.applyToPoint(ve.Inverse(d),u),p=ba(l.rotation+n);return{id:l.id,type:l.type,x:h.x,y:h.y,rotation:p}}));const o=[];r.forEach(({shape:l})=>{var h,p,f;const c=e.getShape(l.id);if(!c)return;const d=e.getShapeUtil(l);if(s==="start"||s==="one-off"){const g=(h=d.onRotateStart)==null?void 0:h.call(d,l);g&&o.push(g)}const u=(p=d.onRotate)==null?void 0:p.call(d,l,c);if(u&&o.push(u),s==="end"||s==="one-off"){const g=(f=d.onRotateEnd)==null?void 0:f.call(d,l,c);g&&o.push(g)}}),o.length>0&&e.updateShapes(o)}const one=n=>{const{store:e}=n,t=e.query.filterHistory("binding"),s=e.query.records("binding");function i(){const r=s.get(),o=new Map;for(const l of r){const{fromId:c,toId:d}=l,u=o.get(c);u?u.push(l):o.set(c,[l]);const h=o.get(d);h?h.push(l):o.set(d,[l])}return o}return Q("arrowBindingsIndex",(r,o)=>{if(Sl(r))return i();const l=r,c=t.getDiffSince(o);if(c===Ks)return i();let d;function u(f){d??(d=new Map(l));const g=d.get(f.fromId),m=g==null?void 0:g.filter(S=>S.id!==f.id);m!=null&&m.length?d.set(f.fromId,m):d.delete(f.fromId);const x=d.get(f.toId),y=x==null?void 0:x.filter(S=>S.id!==f.id);y!=null&&y.length?d.set(f.toId,y):d.delete(f.toId)}function h(f){d??(d=new Map(l));let g=d.get(f);return g?g===l.get(f)&&(g=g.slice(0),d.set(f,g)):(g=[],d.set(f,g)),g}function p(f){h(f.fromId).push(f),h(f.toId).push(f)}for(const f of c){for(const g of Ut(f.added))p(g);for(const[g,m]of Ut(f.updated))u(g),p(m);for(const g of Ut(f.removed))u(g)}return d??l})};function ane(n,e,t){const s=n.getShapeMaskedPageBounds(e);return s===void 0?!0:!t.includes(s)}const lne=n=>{function e(t){const s=t.getCurrentPageShapeIds(),i=t.getViewportPageBounds(),r=new Set;return s.forEach(o=>{ane(t,o,i)&&r.add(o)}),r}return Q("getCulledShapes",t=>{if(Sl(t))return e(n);const s=e(n);if(t.size!==s.size)return s;for(const i of t)if(!s.has(i))return s;return t})},cne=n=>{const e=n.query.ids("shape"),t=n.query.filterHistory("shape");function s(){const i={},r=e.get(),o=Array(r.size);return r.forEach(l=>o.push(n.get(l))),o.sort(Hn),o.forEach(l=>{i[l.parentId]||(i[l.parentId]=[]),i[l.parentId].push(l.id)}),i}return Q("parentsToChildrenWithIndexes",(i,r)=>{if(Sl(i))return s();const o=t.getDiffSince(r);if(o===Ks)return s();if(o.length===0)return i;let l=null;const c=h=>{l||(l={...i}),l[h]?l[h]===i[h]&&(l[h]=[...l[h]]):l[h]=[]},d=new Set;let u;for(let h=0,p=o.length;h<p;h++){u=o[h];for(const f of Object.values(u.added))Fc(f)&&(c(f.parentId),l[f.parentId].push(f.id),d.add(l[f.parentId]));for(const[f,g]of Object.values(u.updated))if(Fc(g)&&Fc(f)){if(f.parentId!==g.parentId)c(f.parentId),c(g.parentId),l[f.parentId].splice(l[f.parentId].indexOf(g.id),1),l[g.parentId].push(g.id),d.add(l[g.parentId]);else if(f.index!==g.index){c(g.parentId);const m=l[g.parentId].indexOf(g.id);l[g.parentId][m]=g.id,d.add(l[g.parentId])}}for(const f of Object.values(u.removed))Fc(f)&&(c(f.parentId),l[f.parentId].splice(l[f.parentId].indexOf(f.id),1))}for(const h of d){const p=Ne(h.map(f=>n.get(f)));p.sort(Hn),h.splice(0,h.length,...p.map(f=>f.id))}return l??i})},uw=(n,e,t)=>{for(;!vs(t.parentId);){const s=n.get(t.parentId);if(!s)return!1;t=s}return t.parentId===e},dne=(n,e)=>{const t=n.query.ids("shape");let s=null;function i(){const r=e();return s=r,new Set([...t.get()].filter(o=>uw(n,r,n.get(o))))}return Q("_shapeIdsInCurrentPage",(r,o)=>{if(Sl(r))return i();const l=e();if(l!==s)return i();const c=n.history.getDiffSince(o);if(c===Ks)return i();const d=new Xg(r);for(const h of c){for(const p of Object.values(h.added))Fc(p)&&uw(n,l,p)&&d.add(p.id);for(const[p,f]of Object.values(h.updated))Fc(f)&&(uw(n,l,f)?d.add(f.id):d.remove(f.id));for(const p of Object.keys(h.removed))Ss(p)&&d.remove(p)}const u=d.get();return u?Gu(u.value,u.diff):r})},fF=b.createContext(null);function une({context:n,editor:e,children:t}){return a.jsx(Qv.Provider,{value:e,children:a.jsx(fF.Provider,{value:n,children:t})})}function gF(){const n=b.useContext(fF);return n?{isDarkMode:n.isDarkMode}:null}async function hne(n,e,t={}){var T,I;const s=typeof e[0]=="string"?e:e.map(E=>E.id);if(s.length===0)return;if(!window.document)throw Error("No document");const{scale:i=1,background:r=!1,padding:o=n.options.defaultSvgPadding,preserveAspectRatio:l=!1}=t,c=t.darkMode??n.user.getIsDarkMode(),d=No({isDarkMode:c}),u=n.getShapeAndDescendantIds(s),h=n.getUnorderedRenderingShapes(!1).filter(({id:E})=>u.has(E));let p=null;if(t.bounds)p=t.bounds;else for(const{id:E}of h){const P=n.getShapeMaskedPageBounds(E);P&&(p?p.union(P):p=P.clone())}if(!p)return;const f=s.length===1&&n.isShapeOfType(n.getShape(s[0]),"frame")?s[0]:null;f||p.expandBy(o);const g=p.width*i,m=p.height*i;try{(I=(T=document.body).focus)==null||I.call(T)}catch{}const x=[],y=new Map,S={isDarkMode:c,addExportDef:E=>{if(y.has(E.key))return;const P=(async()=>{const k=await E.getElement();k&&x.push(a.jsx(b.Fragment,{children:k},x.length))})();y.set(E.key,P)}},v=(await Promise.all(h.map(async({id:E,opacity:P,index:k,backgroundIndex:j})=>{var F,W;if(E===f)return[];const D=n.getShape(E);if(n.isShapeOfType(D,"group"))return[];const R=n.getShapeUtil(D);let A=await((F=R.toSvg)==null?void 0:F.call(R,D,S)),N=await((W=R.toBackgroundSvg)==null?void 0:W.call(R,D,S));if(!A&&!N){const $=n.getShapePageBounds(D);A=a.jsx("rect",{width:$.w,height:$.h,fill:d.solid,stroke:d.grey.pattern,strokeWidth:1})}let B=n.getShapePageTransform(D).toCssString();"scale"in D.props&&D.props.scale!==1&&(B=`${B} scale(${D.props.scale}, ${D.props.scale})`),A&&(A=a.jsx("g",{transform:B,opacity:P,children:A},D.id)),N&&(N=a.jsx("g",{transform:B,opacity:P,children:N},`bg_${D.id}`));const L=n.getShapeMask(D.id);if(L){const $=`mask_${D.id.replace(":","_")}`;x.push(a.jsx("clipPath",{id:$,children:a.jsx("path",{d:`M${L.map(({x:K,y:Y})=>`${K},${Y}`).join("L")}Z`})},x.length)),A&&(A=a.jsx("g",{clipPath:`url(#${$})`,children:A},D.id)),N&&(N=a.jsx("g",{clipPath:`url(#${$})`,children:N},`bg_${D.id}`))}const O=[];return A&&O.push({zIndex:k,element:A}),N&&O.push({zIndex:j,element:N}),O}))).flat();return await Promise.all(y.values()),{jsx:a.jsx(une,{editor:n,context:S,children:a.jsxs("svg",{preserveAspectRatio:l||void 0,direction:"ltr",width:g,height:m,viewBox:`${p.minX} ${p.minY} ${p.width} ${p.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:r?f?d.solid:d.background:"transparent"},children:[a.jsx("defs",{children:x}),v.sort((E,P)=>E.zIndex-P.zIndex).map(({element:E})=>E)]})}),width:g,height:m}}const pne=40;class fne{constructor(e){w(this,"_clickId","");w(this,"_clickTimeout");w(this,"_clickScreenPoint");w(this,"_previousScreenPoint");w(this,"_getClickTimeout",(e,t=Rt())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)});w(this,"_clickState","idle");w(this,"lastPointerInfo",{});w(this,"handlePointerEvent",e=>{switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=_.From(e.point),this._previousScreenPoint&&_.Dist2(this._previousScreenPoint,this._clickScreenPoint)>pne**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=_.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&_.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e});w(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});this.editor=e}get clickState(){return this._clickState}}class gne{constructor(e){w(this,"_isEdgeScrolling",!1);w(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:t}=this,s=this.getEdgeScroll();if(s.x===0&&s.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const i=t.options.edgeScrollEaseDuration>0?ln.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:s.x*i,y:s.y*i})}}getEdgeProximityFactors(e,t,s,i,r){const{editor:o}=this,l=o.options.edgeScrollDistance,c=s?o.options.coarsePointerWidth:0,d=e-c,u=e+c,h=i?0:l,p=r?t:t-l;return d<h?Math.min(1,(h-d)/l):u>p?-Math.min(1,(u-p)/l):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:s}}}=e,i=e.getViewportScreenBounds(),{isCoarsePointer:r,insets:[o,l,c,d]}=e.getInstanceState(),u=this.getEdgeProximityFactors(t,i.w,r,d,l),h=this.getEdgeProximityFactors(s,i.h,r,o,c);return{x:u,y:h}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const s=t.getViewportScreenBounds(),i=s.w<1e3?.612:1,r=s.h<1e3?.612:1,o=t.getZoomLevel(),l=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,c=l*e.x*i/o,d=l*e.y*r/o,{x:u,y:h,z:p}=t.getCamera();t.setCamera(new _(u+c,h+d,p))}}class mne{constructor(e){w(this,"isSafari");w(this,"isIos");w(this,"isChromeForIos");w(this,"isFirefox");w(this,"isAndroid");this.editor=e,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}class yne{constructor(e,t){w(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(i,r)=>{i.isFocused!==r.isFocused&&(r.isFocused?this.focus():this.blur(),this.updateContainerClass())});const s=e.getInstanceState().isFocused;t!==s&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;(e=this.disposeSideEffectListener)==null||e.call(this)}}function Eu(n){return xne}class vne{constructor(){w(this,"length",0);w(this,"head",null);w(this,"tail",this)}push(e){return new ZE(e,this)}toArray(){return co}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const xne=new vne;class ZE{constructor(e,t){w(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new ZE(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class Sne{constructor(e){w(this,"store");w(this,"dispose");w(this,"state","recording");w(this,"pendingDiff",new bne);w(this,"stacks",an("HistoryManager.stacks",{undos:Eu(),redos:Eu()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos}));w(this,"annotateError");w(this,"_isInBatch",!1);w(this,"batch",(e,t)=>{const s=this.state;s!=="paused"&&(t!=null&&t.history)&&(this.state=wne[t.history]);try{if(this._isInBatch)return _r(e),this;this._isInBatch=!0;try{_r(e)}catch(i){throw this.annotateError(i),i}finally{this._isInBatch=!1}return this}finally{this.state=s}});w(this,"_undo",({pushToRedoStack:e,toMark:t=void 0})=>{var i;const s=this.state;this.state="paused";try{let{undos:r,redos:o}=this.stacks.get();const l=this.pendingDiff.clear(),c=kD(l),d=W0(l);e&&!c&&(o=o.push({type:"diff",diff:l}));let u=!1;if(c)for(;((i=r.head)==null?void 0:i.type)==="stop";){const h=r.head;if(r=r.tail,e&&(o=o.push(h)),h.id===t){u=!0;break}}if(!u)e:for(;r.head;){const h=r.head;switch(r=r.tail,e&&(o=o.push(h)),h.type){case"diff":wh(d,[W0(h.diff)]);break;case"stop":if(!t||h.id===t)break e;break;default:Vn(h)}}this.store.applyDiff(d,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:o})}finally{this.state=s}return this});w(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));w(this,"redo",()=>{var t;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:s,redos:i}=this.stacks.get();if(i.length===0)return this;for(;((t=i.head)==null?void 0:t.type)==="stop";)s=s.push(i.head),i=i.tail;const r=my();for(;i.head;){const o=i.head;if(s=s.push(o),i=i.tail,o.type==="diff")wh(r,[o.diff]);else break}this.store.applyDiff(r,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:i})}finally{this.state=e}return this});w(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));w(this,"bailToMark",e=>(this._undo({pushToRedoStack:!1,toMark:e}),this));w(this,"squashToMark",e=>{var r;let t=this.stacks.get().undos;const s=[];for(;t.head&&!(t.head.type==="stop"&&t.head.id===e);)t.head.type==="diff"&&s.push(t.head.diff),t=t.tail;if(!t.head||((r=t.head)==null?void 0:r.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(s.length===0)return this;const i=my();return wh(i,s.reverse()),this.stacks.update(({redos:o})=>({undos:t.push({type:"diff",diff:i}),redos:o})),this});w(this,"mark",(e=Rt())=>(_r(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:s})=>({undos:t.push({type:"stop",id:e}),redos:s}))}),e));this.store=e.store,this.annotateError=e.annotateError??Qh,this.dispose=this.store.addHistoryInterceptor((t,s)=>{if(s==="user")switch(this.state){case"recording":this.pendingDiff.apply(t.changes),this.stacks.update(({undos:i})=>({undos:i,redos:Eu()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(t.changes);break;case"paused":break;default:Vn(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:s})=>({undos:t.push({type:"diff",diff:e}),redos:s}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}clear(){this.stacks.set({undos:Eu(),redos:Eu()}),this.pendingDiff.clear()}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const wne={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class bne{constructor(){w(this,"diff",my());w(this,"isEmptyAtom",an("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=my(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){wh(this.diff,[e]),this.isEmptyAtom.set(kD(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class _ne{constructor(e){w(this,"scribbleItems",new Map);w(this,"state","paused");w(this,"addScribble",(e,t=Rt())=>{const s={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,s),s});w(this,"stop",e=>{const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t});w(this,"addPoint",(e,t,s)=>{const i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);const{prev:r}=i,o={x:t,y:s,z:.5};return(!r||_.Dist(r,o)>=1)&&(i.next=o),i});w(this,"tick",e=>{this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:c,prev:d}=t;c&&c!==d&&(t.prev=c,t.scribble.points.push(c)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:s,timeoutMs:i,prev:r,next:o,scribble:l}=t;switch(l.state){case"active":{o&&o!==r?(t.prev=o,l.points.push(o),s===0&&l.points.length>8&&l.points.shift()):i===0&&(l.points.length>1?l.points.shift():t.delayRemaining=l.delay);break}case"stopping":{if(t.delayRemaining===0&&i===0){if(l.points.length===1){this.scribbleItems.delete(t.id);return}l.shrink&&(l.size=Math.max(1,l.size*(1-l.shrink))),l.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)})})});this.editor=e}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}}var Cne=Object.defineProperty,Ene=Object.getOwnPropertyDescriptor,ix=(n,e,t,s)=>{for(var i=Ene(e,t),r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(e,t,i)||i);return i&&Cne(e,t,i),i};const be=n=>Math.round(n*10**8)/10**8;function Gr(n,e,t,s,i){const r=n.filter(l=>(s==="forward"?l.startNode.id===e:l.endNode.id===e)&&be(l.length)===be(t)&&Mi(l.breadthIntersection[0],l.breadthIntersection[1],i[0],i[1]));if(r.length===0)return[];const o=new Set;return r.forEach(l=>{const c=s==="forward"?l.endNode.id:l.startNode.id;if(!o.has(c)){o.add(c);const d=Gr(n,c,t,s,Mi(l.breadthIntersection[0],l.breadthIntersection[1],i[0],i[1]));r.push(...d)}}),r}function Tne(n){n.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const t=n[e];for(let s=e-1;s>=0;s--){const i=n[s];if(i.direction===t.direction&&t.gaps.every(r=>i.gaps.some(o=>be(r.startEdge[0].x)===be(o.startEdge[0].x)&&be(r.startEdge[0].y)===be(o.startEdge[0].y)&&be(r.startEdge[1].x)===be(o.startEdge[1].x)&&be(r.startEdge[1].y)===be(o.startEdge[1].y))&&i.gaps.some(o=>be(r.endEdge[0].x)===be(o.endEdge[0].x)&&be(r.endEdge[0].y)===be(o.endEdge[0].y)&&be(r.endEdge[1].x)===be(o.endEdge[1].x)&&be(r.endEdge[1].y)===be(o.endEdge[1].y)))){n.splice(e,1);break}}}}class zp{constructor(e){w(this,"editor");this.manager=e,this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const s=e.getShapePageTransform(t.id);if(!s)return;const r=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(!(!s||!r))return r.map((o,l)=>{const{x:c,y:d}=ve.applyToPoint(s,o);return{x:c,y:d,id:`${t.id}:${l}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),s=[];for(const i of t){const r=e.get(i);r&&s.push(...r)}return s}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:pi(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],t=[];let s,i;const r=this.getSnappableGapNodes().sort((l,c)=>l.pageBounds.minX-c.pageBounds.minX);for(let l=0;l<r.length;l++){s=r[l];for(let c=l+1;c<r.length;c++)i=r[c],s.pageBounds.maxX<i.pageBounds.minX&&Cu(s.pageBounds.minY,s.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:s,endNode:i,startEdge:[new _(s.pageBounds.maxX,s.pageBounds.minY),new _(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new _(i.pageBounds.minX,i.pageBounds.minY),new _(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-s.pageBounds.maxX,breadthIntersection:Mi(s.pageBounds.minY,s.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const o=r.sort((l,c)=>l.pageBounds.minY-c.pageBounds.minY);for(let l=0;l<o.length;l++){s=o[l];for(let c=l+1;c<o.length;c++)i=o[c],s.pageBounds.maxY<i.pageBounds.minY&&Cu(s.pageBounds.minX,s.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&t.push({startNode:s,endNode:i,startEdge:[new _(s.pageBounds.minX,s.pageBounds.maxY),new _(s.pageBounds.maxX,s.pageBounds.maxY)],endEdge:[new _(i.pageBounds.minX,i.pageBounds.minY),new _(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-s.pageBounds.maxY,breadthIntersection:Mi(s.pageBounds.minX,s.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:s,dragDelta:i}){var x,y;const r=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),l=t.clone().translate(i),c=s.map(({x:S,y:v},C)=>({id:"selection:"+C,x:S+i.x,y:v+i.y})),d=o,u=[],h=[],p=new _(r,r);this.collectPointSnaps({minOffset:p,nearestSnapsX:u,nearestSnapsY:h,otherNodeSnapPoints:d,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:l,nearestSnapsX:u,nearestSnapsY:h,minOffset:p});const f=new _(e==="x"?0:((x=u[0])==null?void 0:x.nudge)??0,e==="y"?0:((y=h[0])==null?void 0:y.nudge)??0);p.x=0,p.y=0,u.length=0,h.length=0,c.forEach(S=>{S.x+=f.x,S.y+=f.y}),l.translate(f),this.collectPointSnaps({minOffset:p,nearestSnapsX:u,nearestSnapsY:h,otherNodeSnapPoints:d,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:l,nearestSnapsX:u,nearestSnapsY:h,minOffset:p});const g=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:h}),m=this.getGapSnapLines({selectionPageBounds:l,nearestSnapsX:u,nearestSnapsY:h});return this.manager.setIndicators([...m,...g]),{nudge:f}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:s,isAspectRatioLocked:i,isResizingFromCenter:r}){var E,P;const o=this.manager.getSnapThreshold(),{box:l,scaleX:c,scaleY:d}=ue.Resize(e,s,r?t.x*2:t.x,r?t.y*2:t.y,i);let u=s;c<0&&(u=Mee(u)),d<0&&(u=Ree(u)),r&&(l.center=e.center);const h=u==="top"||u==="bottom",p=u==="left"||u==="right",f=vA(u,l),g=this.getSnappablePoints(),m=[],x=[],y=new _(o,o);this.collectPointSnaps({minOffset:y,nearestSnapsX:m,nearestSnapsY:x,otherNodeSnapPoints:g,selectionSnapPoints:f});const S=new _(h?0:((E=m[0])==null?void 0:E.nudge)??0,p?0:((P=x[0])==null?void 0:P.nudge)??0);if(i&&Oee(u)&&S.len()!==0){const k=m.length&&x.length?Math.abs(S.x)<Math.abs(S.y)?"x":"y":m.length?"x":"y",j=e.aspectRatio;k==="x"?(x.length=0,S.y=S.x/j,(u==="bottom_left"||u==="top_right")&&(S.y=-S.y)):(m.length=0,S.x=S.y*j,(u==="bottom_left"||u==="top_right")&&(S.x=-S.x))}const v=_.Add(t,S),{box:C}=ue.Resize(e,s,r?v.x*2:v.x,r?v.y*2:v.y,i);r&&(C.center=e.center);const T=vA("any",C);m.length=0,x.length=0,y.x=0,y.y=0,this.collectPointSnaps({minOffset:y,nearestSnapsX:m,nearestSnapsY:x,otherNodeSnapPoints:g,selectionSnapPoints:T});const I=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:x});return this.manager.setIndicators([...I]),{nudge:S}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:s,nearestSnapsX:i,nearestSnapsY:r}){for(const o of e)for(const l of t){const c=_.Sub(o,l),d=Math.abs(c.x),u=Math.abs(c.y);be(d)<=be(s.x)&&(be(d)<be(s.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:l},nudge:l.x-o.x}),s.x=d),be(u)<=be(s.y)&&(be(u)<be(s.y)&&(r.length=0),r.push({type:"points",points:{thisPoint:o,otherPoint:l},nudge:l.y-o.y}),s.y=u)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:s,nearestSnapsY:i}){const{horizontal:r,vertical:o}=this.getVisibleGaps();for(const l of r){if(!Cu(l.breadthIntersection[0],l.breadthIntersection[1],e.minY,e.maxY))continue;const d=l.startEdge[0].x+l.length/2-e.center.x;if(l.length>e.width&&be(Math.abs(d))<=be(t.x)){be(Math.abs(d))<be(t.x)&&(s.length=0),t.x=Math.abs(d);const y={type:"gap_center",gap:l,nudge:d},S=s.find(({type:C})=>C==="gap_center"),v=S&&Mi(l.breadthIntersection[0],l.breadthIntersection[1],S.gap.breadthIntersection[0],S.gap.breadthIntersection[1]);S&&S.gap.length>l.length&&v?s[s.indexOf(S)]=y:(!S||!v)&&s.push(y)}const h=l.startNode.pageBounds.minX-l.length,p=e.maxX,f=h-p;be(Math.abs(f))<=be(t.x)&&(be(Math.abs(f))<be(t.x)&&(s.length=0),t.x=Math.abs(f),s.push({type:"gap_duplicate",gap:l,protrusionDirection:"left",nudge:f}));const g=l.endNode.pageBounds.maxX+l.length,m=e.minX,x=g-m;be(Math.abs(x))<=be(t.x)&&(be(Math.abs(x))<be(t.x)&&(s.length=0),t.x=Math.abs(x),s.push({type:"gap_duplicate",gap:l,protrusionDirection:"right",nudge:x}))}for(const l of o){if(!Cu(l.breadthIntersection[0],l.breadthIntersection[1],e.minX,e.maxX))continue;const d=l.startEdge[0].y+l.length/2-e.center.y;if(l.length>e.height&&be(Math.abs(d))<=be(t.y)){be(Math.abs(d))<be(t.y)&&(i.length=0),t.y=Math.abs(d);const y={type:"gap_center",gap:l,nudge:d},S=i.find(({type:C})=>C==="gap_center"),v=S&&Cu(S.gap.breadthIntersection[0],S.gap.breadthIntersection[1],l.breadthIntersection[0],l.breadthIntersection[1]);S&&S.gap.length>l.length&&v?i[i.indexOf(S)]=y:(!S||!v)&&i.push(y);continue}const h=l.startNode.pageBounds.minY-l.length,p=e.maxY,f=h-p;be(Math.abs(f))<=be(t.y)&&(be(Math.abs(f))<be(t.y)&&(i.length=0),t.y=Math.abs(f),i.push({type:"gap_duplicate",gap:l,protrusionDirection:"top",nudge:f}));const g=l.endNode.pageBounds.maxY+l.length,m=e.minY,x=g-m;be(Math.abs(x))<=be(t.y)&&(be(Math.abs(x))<be(t.y)&&(i.length=0),t.y=Math.abs(x),i.push({type:"gap_duplicate",gap:l,protrusionDirection:"bottom",nudge:x}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const s={},i={};if(e.length>0){for(const r of e)if(r.type==="points"){const o=be(r.points.otherPoint.x);s[o]||(s[o]=[]),s[o].push(r.points)}}if(t.length>0){for(const r of t)if(r.type==="points"){const o=be(r.points.otherPoint.y);i[o]||(i[o]=[]),i[o].push(r.points)}}return Object.values(s).concat(Object.values(i)).map(r=>({id:Rt(),type:"points",points:CE(r.map(o=>_.From(o.otherPoint)).concat(r.map(o=>_.From(o.thisPoint))),(o,l)=>o.equals(l))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:s}){const{vertical:i,horizontal:r}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},l=[];if(t.length>0)for(const c of t){if(c.type==="points")continue;const{gap:{breadthIntersection:d,startEdge:u,startNode:h,endNode:p,length:f,endEdge:g}}=c;switch(c.type){case"gap_center":{const m=(f-e.width)/2,x=Mi(d[0],d[1],e.minY,e.maxY);l.push({type:"gaps",direction:"horizontal",id:Rt(),gaps:[...Gr(r,h.id,m,"backward",x),{startEdge:u,endEdge:o.left},{startEdge:o.right,endEdge:g},...Gr(r,p.id,m,"forward",x)]});break}case"gap_duplicate":{const m=Mi(d[0],d[1],e.minY,e.maxY);l.push({type:"gaps",direction:"horizontal",id:Rt(),gaps:c.protrusionDirection==="left"?[{startEdge:o.right,endEdge:u.map(x=>x.clone().addXY(-h.pageBounds.width,0))},{startEdge:u,endEdge:g},...Gr(r,p.id,f,"forward",m)]:[...Gr(r,h.id,f,"backward",m),{startEdge:u,endEdge:g},{startEdge:g.map(x=>x.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:o.left}]});break}}}if(s.length>0)for(const c of s){if(c.type==="points")continue;const{gap:{breadthIntersection:d,startEdge:u,startNode:h,endNode:p,length:f,endEdge:g}}=c;switch(c.type){case"gap_center":{const m=(f-e.height)/2,x=Mi(d[0],d[1],e.minX,e.maxX);l.push({type:"gaps",direction:"vertical",id:Rt(),gaps:[...Gr(i,h.id,m,"backward",x),{startEdge:u,endEdge:o.top},{startEdge:o.bottom,endEdge:g},...Gr(i,c.gap.endNode.id,m,"forward",x)]});break}case"gap_duplicate":{const m=Mi(d[0],d[1],e.minX,e.maxX);l.push({type:"gaps",direction:"vertical",id:Rt(),gaps:c.protrusionDirection==="top"?[{startEdge:o.bottom,endEdge:u.map(x=>x.clone().addXY(0,-h.pageBounds.height))},{startEdge:u,endEdge:g},...Gr(i,p.id,f,"forward",m)]:[...Gr(i,h.id,f,"backward",m),{startEdge:u,endEdge:g},{startEdge:g.map(x=>x.clone().addXY(0,p.pageBounds.height)),endEdge:o.top}]})}break}}return Tne(l),l}}ix([Q],zp.prototype,"getSnapPointsCache");ix([Q],zp.prototype,"getSnappablePoints");ix([Q],zp.prototype,"getSnappableGapNodes");ix([Q],zp.prototype,"getVisibleGaps");function vA(n,e){const{minX:t,maxX:s,minY:i,maxY:r}=e,o=[];switch(n){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:t,y:i})}switch(n){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:s,y:i})}switch(n){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:s,y:r})}switch(n){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:t,y:r})}return o}var Ine=Object.defineProperty,Pne=Object.getOwnPropertyDescriptor,kne=(n,e,t,s)=>{for(var i=Pne(e,t),r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(e,t,i)||i);return i&&Ine(e,t,i),i};const Ane=()=>null,jne=()=>[];class mF{constructor(e){w(this,"editor");this.manager=e,this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{const s=e.getShapeUtil(t).getHandleSnapGeometry(t);return{outline:s.outline===void 0?e.getShapeGeometry(t):s.outline,points:s.points??[],getSelfSnapOutline:s.getSelfSnapOutline??Ane,getSelfSnapPoints:s.getSelfSnapPoints??jne}})}*iterateSnapPointsInPageSpace(e,t){var i,r;const s=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapPoints(t);if(s&&s.length){const o=pi(this.editor.getShapePageTransform(e));for(const l of s)yield o.applyToPoint(l)}for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const l=(r=this.getSnapGeometryCache().get(o))==null?void 0:r.points;if(!l||!l.length)continue;const c=pi(this.editor.getShapePageTransform(o));for(const d of l)yield c.applyToPoint(d)}}*iterateSnapOutlines(e,t){var i,r;const s=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapOutline(t);s&&(yield{shapeId:e,outline:s});for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const l=(r=this.getSnapGeometryCache().get(o))==null?void 0:r.outline;l&&(yield{shapeId:o,outline:l})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:s}){const i=this.manager.getSnapThreshold();let r=i,o=null;for(const d of this.iterateSnapPointsInPageSpace(e,t))_.DistMin(s,d,r)&&(r=_.Dist(s,d),o=d);if(o)return o;let l=i,c=null;for(const{shapeId:d,outline:u}of this.iterateSnapOutlines(e,t)){const h=pi(this.editor.getShapePageTransform(d)),p=this.editor.getPointInShapeSpace(d,s),f=u.nearestPoint(p),g=h.applyToPoint(f);_.DistMin(s,g,l)&&(l=_.Dist(s,g),c=g)}return c||null}snapHandle({currentShapeId:e,handle:t}){const i=pi(this.editor.getShapePageTransform(e)).applyToPoint(t),r=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:i});return r?(this.manager.setIndicators([{id:Rt(),type:"points",points:[r]}]),{nudge:_.Sub(r,i)}):null}}kne([Q],mF.prototype,"getSnapGeometryCache");var Nne=Object.defineProperty,Rne=Object.getOwnPropertyDescriptor,JE=(n,e,t,s)=>{for(var i=Rne(e,t),r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(e,t,i)||i);return i&&Nne(e,t,i),i};class rx{constructor(e){w(this,"shapeBounds");w(this,"handles");w(this,"_snapIndicators",an("snapLines",void 0));this.editor=e,this.shapeBounds=new zp(this),this.handles=new mF(this)}getIndicators(){return this._snapIndicators.get()??co}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getViewportPageBounds(),s=e.getSelectedShapeIds(),i=new Set,r=o=>{if(Ss(o)){const c=e.getShape(o);c&&e.isShapeOfType(c,"frame")&&i.add(o)}const l=e.getSortedChildIdsForParent(o);for(const c of l){if(s.includes(c))continue;const d=e.getShape(c);if(!d||!e.getShapeUtil(d).canSnap(d))continue;const h=e.getShapePageBounds(c);if(h&&t.includes(h)){if(e.isShapeOfType(d,"group")){r(c);continue}i.add(c)}}};return r(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}JE([Q],rx.prototype,"getSnapThreshold");JE([Q],rx.prototype,"getSnappableShapes");JE([Q],rx.prototype,"getCurrentCommonAncestor");const Mne=/\r?\n|\r/g;function xA(n){return n.replace(Mne,`
`).split(`
`).map(e=>e||" ").join(`
`)}const One={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},Dne=/\s/;class Lne{constructor(e){w(this,"baseElm");w(this,"measureText",(e,t)=>{var o;const s=(o=this.baseElm)==null?void 0:o.cloneNode();this.baseElm.insertAdjacentElement("afterend",s),s.setAttribute("dir","auto"),s.style.setProperty("unicode-bidi","plaintext"),s.style.setProperty("font-family",t.fontFamily),s.style.setProperty("font-style",t.fontStyle),s.style.setProperty("font-weight",t.fontWeight),s.style.setProperty("font-size",t.fontSize+"px"),s.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),s.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),s.style.setProperty("min-width",t.minWidth===null?null:t.minWidth+"px"),s.style.setProperty("padding",t.padding),s.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),s.textContent=xA(e);const i=s.scrollWidth,r=s.getBoundingClientRect();return s.remove(),{x:0,y:0,w:r.width,h:r.height,scrollWidth:i}});this.editor=e;const t=this.editor.getContainer(),s=document.createElement("div");s.classList.add("tl-text"),s.classList.add("tl-text-measure"),s.tabIndex=-1,t.appendChild(s),this.baseElm=s,e.disposables.add(()=>{s.remove()})}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const s=[],i=e.getBoundingClientRect(),r=-i.left,o=-i.top,l=new Range,c=e.childNodes[0];let d=0,u=null,h=null,p=0,f=0,g=!1;for(const m of e.childNodes)if(m.nodeType===Node.TEXT_NODE)for(const x of m.textContent??""){l.setStart(c,d),l.setEnd(c,d+x.length);const y=l.getClientRects(),S=y[y.length-1],v=S.top+o,C=S.left+r,T=S.right+r,I=C<f,E=Dne.test(x);if(E!==h||v!==p||!u){if(u){if(t&&v!==p){g=!0;break}s.push(u)}u={box:{x:C,y:v,w:S.width,h:S.height},text:x},f=C}else I&&(u.box.x=C),u.box.w=I?u.box.w+S.width:T-u.box.x,u.text+=x;x===`
`&&(f=0),h=E,p=v,d+=x.length}return u&&s.push(u),{spans:s,didTruncate:g}}measureTextSpans(e,t){var d;if(e==="")return[];const s=(d=this.baseElm)==null?void 0:d.cloneNode();this.baseElm.insertAdjacentElement("afterend",s);const i=Math.ceil(t.width-t.padding*2);s.setAttribute("dir","auto"),s.style.setProperty("unicode-bidi","plaintext"),s.style.setProperty("width",`${i}px`),s.style.setProperty("height","min-content"),s.style.setProperty("font-size",`${t.fontSize}px`),s.style.setProperty("font-family",t.fontFamily),s.style.setProperty("font-weight",t.fontWeight),s.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),s.style.setProperty("text-align",One[t.textAlign]);const r=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip";r&&(s.style.setProperty("overflow-wrap","anywhere"),s.style.setProperty("word-break","break-all"));const o=xA(e);s.textContent=o;const{spans:l,didTruncate:c}=this.measureElementTextNodeSpans(s,{shouldTruncateToFirstLine:r});if(t.overflow==="truncate-ellipsis"&&c){s.textContent="";const u=Math.ceil(this.measureElementTextNodeSpans(s).spans[0].box.w);s.style.setProperty("width",`${i-u}px`),s.textContent=o;const h=this.measureElementTextNodeSpans(s,{shouldTruncateToFirstLine:!0}).spans,p=h[h.length-1];return h.push({text:"",box:{x:Math.min(p.box.x+p.box.w,t.width-t.padding-u),y:p.box.y,w:u,h:p.box.h}}),h}return s.remove(),l}}const SA=ED;class Fne{constructor(e){w(this,"cancelRaf");w(this,"isPaused",!0);w(this,"now",0);w(this,"start",()=>{var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=SA(this.tick),this.now=Date.now()});w(this,"tick",()=>{if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=SA(this.tick)});w(this,"dispose",()=>{var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)});w(this,"prevPoint",new _);w(this,"updatePointerVelocity",e=>{const{prevPoint:t,editor:{inputs:{currentScreenPoint:s,pointerVelocity:i}}}=this;if(e===0)return;const r=_.Sub(s,t);this.prevPoint=s.clone();const o=r.len(),l=o?r.div(o):new _(0,0),c=i.clone().lrp(l.mul(o/e),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),i.equals(c)||(this.editor.inputs.pointerVelocity=c)});this.editor=e,this.editor.disposables.add(this.dispose),this.start()}}var Bne=Object.defineProperty,Une=Object.getOwnPropertyDescriptor,Ii=(n,e,t,s)=>{for(var i=Une(e,t),r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(e,t,i)||i);return i&&Bne(e,t,i),i};class ii{constructor(e,t){w(this,"systemColorScheme",an("systemColorScheme","light"));w(this,"updateUserPreferences",e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})});if(this.user=e,this.inferDarkMode=t,typeof window>"u"||!("matchMedia"in window))return;const s=window.matchMedia("(prefers-color-scheme: dark)");s!=null&&s.matches&&this.systemColorScheme.set("dark"),s==null||s.addEventListener("change",i=>{i.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??Wr.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??Wr.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??Wr.name}getLocale(){return this.user.userPreferences.get().locale??Wr.locale}getColor(){return this.user.userPreferences.get().color??Wr.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??Wr.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??Wr.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??Wr.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??Wr.isPasteAtCursorMode}}Ii([Q],ii.prototype,"getUserPreferences");Ii([Q],ii.prototype,"getIsDarkMode");Ii([Q],ii.prototype,"getEdgeScrollSpeed");Ii([Q],ii.prototype,"getAnimationSpeed");Ii([Q],ii.prototype,"getId");Ii([Q],ii.prototype,"getName");Ii([Q],ii.prototype,"getLocale");Ii([Q],ii.prototype,"getColor");Ii([Q],ii.prototype,"getIsSnapMode");Ii([Q],ii.prototype,"getIsWrapMode");Ii([Q],ii.prototype,"getIsDynamicResizeMode");Ii([Q],ii.prototype,"getIsPasteAtCursorMode");const $ne={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},zne=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class ye{constructor(e,t){w(this,"performanceTracker");w(this,"id");w(this,"type");w(this,"shapeType");w(this,"initial");w(this,"children");w(this,"isLockable");w(this,"parent");w(this,"_path");w(this,"_current");w(this,"_isActive");w(this,"transition",(e,t={})=>{var r;const s=e.split(".");let i=this;for(let o=0;o<s.length;o++){const l=s[o],c=i.getCurrent(),d=(r=i.children)==null?void 0:r[l];if(!d)throw Error(`${i.id} - no child state exists with the id ${l}.`);if((c==null?void 0:c.id)!==d.id&&(c==null||c.exit(t,l),i._current.set(d),d.enter(t,(c==null?void 0:c.id)||"initial"),!d.getIsActive()))break;i=d}return this});w(this,"handleEvent",e=>{var i;const t=$ne[e.name],s=this._current.__unsafe__getWithoutCapture();(i=this[t])==null||i.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&s&&s===this._current.__unsafe__getWithoutCapture()&&s.handleEvent(e)});w(this,"enter",(e,t)=>{var s;if(Gt.measurePerformance.get()&&zne.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(s=this.onEnter)==null||s.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,t)}});w(this,"exit",(e,t)=>{var s,i;Gt.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(s=this.onExit)==null||s.call(this,e,t),this.getIsActive()||(i=this.getCurrent())==null||i.exit(e,t)});w(this,"_currentToolIdMask",an("curent tool id mask",void 0));w(this,"onWheel");w(this,"onPointerDown");w(this,"onPointerMove");w(this,"onLongPress");w(this,"onPointerUp");w(this,"onDoubleClick");w(this,"onTripleClick");w(this,"onQuadrupleClick");w(this,"onRightClick");w(this,"onMiddleClick");w(this,"onKeyDown");w(this,"onKeyUp");w(this,"onKeyRepeat");w(this,"onCancel");w(this,"onComplete");w(this,"onInterrupt");w(this,"onTick");w(this,"onEnter");w(this,"onExit");this.editor=e;const{id:s,children:i,initial:r,isLockable:o}=this.constructor;this.id=s,this._isActive=an("toolIsActive"+this.id,!1),this._current=an("toolState"+this.id,void 0),this._path=Q("toolPath"+this.id,()=>{const l=this.getCurrent();return this.id+(l?`.${l.getPath()}`:"")}),this.parent=t??{},this.parent?i&&r?(this.type="branch",this.initial=r,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&r&&(this.initial=r,this.children=Object.fromEntries(i().map(l=>[l.id,new l(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=o,this.performanceTracker=new lD}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}w(ye,"id"),w(ye,"initial"),w(ye,"children"),w(ye,"isLockable",!0);class tm extends ye{constructor(){super(...arguments);w(this,"onKeyDown",t=>{var s;switch(t.code){case"KeyZ":{if(!(t.shiftKey||t.ctrlKey)){const i=this.getCurrent();i&&((s=i.getCurrent())==null?void 0:s.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...t,onInteractionEnd:i.id})}break}}})}}w(tm,"id","root"),w(tm,"initial",""),w(tm,"children",()=>[]);var Wne=Object.defineProperty,Hne=Object.getOwnPropertyDescriptor,ge=(n,e,t,s)=>{for(var i=Hne(e,t),r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(e,t,i)||i);return i&&Wne(e,t,i),i};class le extends Fte{constructor({store:t,user:s,shapeUtils:i,bindingUtils:r,tools:o,getContainer:l,cameraOptions:c,initialState:d,autoFocus:u,inferDarkMode:h,options:p}){super();w(this,"options");w(this,"store");w(this,"root");w(this,"disposables",new Set);w(this,"isDisposed",!1);w(this,"_tickManager");w(this,"snaps");w(this,"timers");w(this,"user");w(this,"textMeasure");w(this,"environment");w(this,"scribbles");w(this,"sideEffects");w(this,"edgeScrollManager");w(this,"focusManager");w(this,"getContainer");w(this,"shapeUtils");w(this,"styleProps");w(this,"bindingUtils");w(this,"history");w(this,"_shouldIgnoreShapeLock",!1);w(this,"_crashingError",null);w(this,"_updateInstanceState",(t,s)=>{this.run(()=>{this.store.put([{...this.getInstanceState(),...t}])},s)});w(this,"_isChangingStyleTimeout",-1);w(this,"setCursor",t=>(this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...t}}),this));w(this,"_updateCurrentPageState",t=>{this.store.update(t.id??this.getCurrentPageState().id,s=>({...s,...t}))});w(this,"_cameraOptions",an("camera options",Yk));w(this,"_viewportAnimation",null);w(this,"_willSetInitialBounds",!0);w(this,"_isLockedOnFollowingUser",an("isLockedOnFollowingUser",!1));w(this,"_cameraState",an("camera state","idle"));w(this,"_cameraStateTimeoutRemaining",0);w(this,"_decayCameraStateTimeout",t=>{this._cameraStateTimeoutRemaining-=t,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))});w(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))});w(this,"_currentPageShapeIds");w(this,"_parentIdsToChildIds");w(this,"animatingShapes",new Map);w(this,"_updateShapes",t=>{this.getInstanceState().isReadonly||this.run(()=>{var o,l;const s=[];let i,r;for(let c=0,d=t.length;c<d;c++){const u=t[c];u&&(i=this.getShape(u.id),i&&(r=or(i,u),r!==i&&(r=((l=(o=this.getShapeUtil(i)).onBeforeUpdate)==null?void 0:l.call(o,i,r))??r,s.push(r))))}this.store.put(s)})});w(this,"externalAssetContentHandlers",{file:null,url:null});w(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});w(this,"inputs",{originPagePoint:new _,originScreenPoint:new _,previousPagePoint:new _,previousScreenPoint:new _,currentPagePoint:new _,currentScreenPoint:new _,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new _});w(this,"_clickManager",new fne(this));w(this,"_prevCursor","default");w(this,"_shiftKeyTimeout",-1);w(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});w(this,"_altKeyTimeout",-1);w(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});w(this,"_ctrlKeyTimeout",-1);w(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});w(this,"_restoreToolId","select");w(this,"_pinchStart",1);w(this,"_didPinch",!1);w(this,"_selectedShapeIdsAtPointerDown",[]);w(this,"_longPressTimeout",-1);w(this,"capturedPointerId",null);w(this,"performanceTracker");w(this,"performanceTrackerTimeout",-1);w(this,"dispatch",t=>(this._pendingEventsForNextTick.push(t),t.type==="pointer"&&t.name==="pointer_move"||t.type==="wheel"||t.type==="pinch"||this._flushEventsForTick(0),this));w(this,"_pendingEventsForNextTick",[]);w(this,"_flushEventForTick",t=>{if(this.getCrashingError())return this;const{inputs:s}=this,{type:i}=t;if(t.type==="misc"){(t.name==="cancel"||t.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(t);return}t.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,s.shiftKey=!0):!t.shiftKey&&s.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),t.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,s.altKey=!0):!t.altKey&&s.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),t.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,s.ctrlKey=!0):!t.ctrlKey&&s.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:r,currentPagePoint:o}=s;s.isPointing||(s.isDragging=!1);const l=this.store.unsafeGetWithoutCapture(ns),c=this.store.get(this._getCurrentPageStateId()),d=this._cameraOptions.__unsafe__getWithoutCapture();switch(i){case"pinch":{if(d.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(t),t.name){case"pinch_start":{if(s.isPinching)return;s.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...c.selectedShapeIds]),this._didPinch=!0,s.isPinching=!0,this.interrupt());return}case"pinch":{if(!s.isPinching)return;const{point:{z:u=1},delta:{x:h,y:p}}=t,{x:f,y:g}=_.SubXY(t.point,l.screenBounds.x,l.screenBounds.y);this.stopCameraAnimation(),l.followingUserId&&this.stopFollowingUser();const{x:m,y:x,z:y}=Wf(()=>this.getCamera()),{panSpeed:S,zoomSpeed:v}=d;this._setCamera(new _(m+h*S/y-f/y+f/(u*v),x+p*S/y-g/y+g/(u*v),u*v),{immediate:!0});return}case"pinch_end":{if(!s.isPinching)return this;s.isPinching=!1;const{_selectedShapeIdsAtPointerDown:u}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,u.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(u)}));return}}}case"wheel":{if(d.isLocked)return;if(this._updateInputsFromEvent(t),!this.getIsMenuOpen()){const{panSpeed:u,zoomSpeed:h,wheelBehavior:p}=d;if(p!=="none"){this.stopCameraAnimation(),l.followingUserId&&this.stopFollowingUser();const{x:f,y:g,z:m}=Wf(()=>this.getCamera()),{x,y,z:S=0}=t.delta;let v=p;switch(s.ctrlKey&&(v=p==="pan"?"zoom":"pan"),v){case"zoom":{const{x:C,y:T}=this.inputs.currentScreenPoint;let I=S;p==="zoom"&&(Math.abs(y)>10?I=10*Math.sign(y)/100:I=y/100);const E=m+(I??0)*h*m;this._setCamera(new _(f+(C/E-C)-(C/m-C),g+(T/E-T)-(T/m-T),E),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new _(f+x*u/m,g+y*u/m,m),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}}break}case"pointer":{if(s.isPinching)return;this._updateInputsFromEvent(t);const{isPen:u}=t,{isPenMode:h}=l;switch(t.name){case"pointer_down":{if(h&&!u)return;if(this.clearOpenMenus(),this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{this.dispatch({...t,point:this.inputs.currentScreenPoint,name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),t.button===qk&&(this.capturedPointerId=t.pointerId),s.buttons.add(t.button),s.isPointing=!0,s.isDragging=!1,!h&&u&&this.updateInstanceState({isPenMode:!0}),t.button===Zk?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):t.button===qf&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!u&&h)return;const{x:p,y:f,z:g}=Wf(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:m,previousScreenPoint:x}=this.inputs,{panSpeed:y}=d,S=_.Sub(m,x);this.setCamera(new _(p+S.x*y/g,f+S.y*y/g,g),{immediate:!0}),this.maybeTrackPerformance("Panning");return}s.isPointing&&!s.isDragging&&_.Dist2(r,o)*this.getZoomLevel()>(l.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/g&&(s.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(s.isDragging=!1,s.isPointing=!1,clearTimeout(this._longPressTimeout),s.buttons.delete(t.button),this.getIsMenuOpen()||l.isPenMode&&!u)return;if(this.capturedPointerId===t.pointerId&&(this.capturedPointerId=null,t.button=0),s.isPanning){s.keys.has("Space")||(s.isPanning=!1);const p=this.inputs.pointerVelocity,f=Math.min(2,p.len());switch(t.button){case qk:{this.setCursor({type:"grab",rotation:0});break}case qf:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}f>0&&this.slideCamera({speed:f,direction:p})}else t.button===Zk&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(t.key==="ShiftRight"&&(t.key="ShiftLeft"),t.key==="AltRight"&&(t.key="AltLeft"),t.code==="ControlRight"&&(t.code="ControlLeft"),t.name){case"key_down":{s.keys.add(t.code),t.code==="Space"&&!t.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=l.cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0}));break}case"key_up":{s.keys.delete(t.code),t.code==="Space"&&(this.inputs.buttons.has(qf)||(this.inputs.isPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(t.type==="pointer"){t.button===qf?t.name="middle_click":t.button===zE&&(t.name="right_click");const{isPenMode:u}=this.store.unsafeGetWithoutCapture(ns);if(t.isPen===u){const h=this._clickManager.handlePointerEvent(t);if(t.name!==h.name){this.root.handleEvent(t),this.emit("event",t),this.root.handleEvent(h),this.emit("event",h);return}}}return this.root.handleEvent(t),this.emit("event",t),this});this.options={...Zte,...p},this.store=t,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new Sne({store:t,annotateError:k=>{this.annotateError(k,{origin:"history.batch",willCrashApp:!0}),this.crash(k)}}),this.snaps=new rx(this),this.timers=new NZ,this.disposables.add(this.timers.dispose.bind(this.timers)),this._cameraOptions.set({...Yk,...c}),this.user=new ii(s??nF(),h??!1),this.getContainer=l??(()=>document.body),this.textMeasure=new Lne(this),this._tickManager=new Fne(this);class f extends tm{}w(f,"initial",d??""),this.root=new f(this),this.root.children={};const g=hF(i),m={},x={},y=new Map;for(const k of g){const j=new k(this);m[k.type]=j;const D=MD(k.props??{});x[k.type]=D;for(const R of D.keys())if(!y.has(R.id))y.set(R.id,R);else if(y.get(R.id)!==R)throw Error(`Multiple style props with id "${R.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=m,this.styleProps=x;const S=cF(r),v={};for(const k of S){const j=new k(this);v[k.type]=j}this.bindingUtils=v;for(const k of[...o]){if(Cr(this.root.children,k.id))throw Error(`Can't override tool with id "${k.id}"`);this.root.children[k.id]=new k(this,this.root)}this.environment=new mne(this),this.scribbles=new _ne(this);const C=(k,j)=>{let D=null;const R=k.selectedShapeIds.filter(B=>!j.has(B));R.length!==k.selectedShapeIds.length&&(D||(D={...k}),D.selectedShapeIds=R);const A=k.erasingShapeIds.filter(B=>!j.has(B));A.length!==k.erasingShapeIds.length&&(D||(D={...k}),D.erasingShapeIds=A),k.hoveredShapeId&&j.has(k.hoveredShapeId)&&(D||(D={...k}),D.hoveredShapeId=null),k.editingShapeId&&j.has(k.editingShapeId)&&(D||(D={...k}),D.editingShapeId=null);const N=k.hintingShapeIds.filter(B=>!j.has(B));return N.length!==k.hintingShapeIds.length&&(D||(D={...k}),D.hintingShapeIds=N),k.focusedGroupId&&j.has(k.focusedGroupId)&&(D||(D={...k}),D.focusedGroupId=null),D};this.sideEffects=this.store.sideEffects;let T=new Map;const I=new Set,E=new Set;let P=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var k,j,D,R;I.clear();for(const A of E){E.delete(A);const N=this.getShape(A);if(!N)continue;const B=this.getShapeUtil(N),L=(k=B.onChildrenChange)==null?void 0:k.call(B,N);L!=null&&L.length&&this.updateShapes(L)}if(P.size){const A=P;P=new Set;for(const N of A){const B=this.getBindingUtil(N);(j=B.onOperationComplete)==null||j.call(B)}}if(T.size){const A=T;T=new Map;for(const N of A.values())(R=(D=this.getBindingUtil(N.binding)).onAfterDelete)==null||R.call(D,N)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(k,j)=>{var D,R,A,N;for(const B of this.getBindingsInvolvingShape(j))P.add(B.type),B.fromId===j.id&&((R=(D=this.getBindingUtil(B)).onAfterChangeFromShape)==null||R.call(D,{binding:B,shapeBefore:k,shapeAfter:j})),B.toId===j.id&&((N=(A=this.getBindingUtil(B)).onAfterChangeToShape)==null||N.call(A,{binding:B,shapeBefore:k,shapeAfter:j}));if(k.parentId!==j.parentId){const B=L=>{var F,W,$,K;const O=this.getShape(L);if(O)for(const Y of this.getBindingsInvolvingShape(O))P.add(Y.type),Y.fromId===O.id&&((W=(F=this.getBindingUtil(Y)).onAfterChangeFromShape)==null||W.call(F,{binding:Y,shapeBefore:O,shapeAfter:O})),Y.toId===O.id&&((K=($=this.getBindingUtil(Y)).onAfterChangeToShape)==null||K.call($,{binding:Y,shapeBefore:O,shapeAfter:O}))};B(j.id),this.visitDescendants(j.id,B)}if(k.parentId!==j.parentId&&vs(j.parentId)){const B=new Set([k.id]);this.visitDescendants(k.id,L=>{B.add(L)});for(const L of this.getPageStates()){if(L.pageId===j.parentId)continue;const O=C(L,B);O&&this.store.put([O])}}k.parentId&&Ss(k.parentId)&&E.add(k.parentId),j.parentId!==k.parentId&&Ss(j.parentId)&&E.add(j.parentId)},beforeDelete:k=>{var A,N,B,L;if(I.has(k.id))return;k.parentId&&Ss(k.parentId)&&E.add(k.parentId),I.add(k.id);const j=[];for(const O of this.getBindingsInvolvingShape(k)){P.add(O.type),j.push(O.id);const F=this.getBindingUtil(O);O.fromId===k.id?((A=F.onBeforeIsolateToShape)==null||A.call(F,{binding:O,removedShape:k}),(N=F.onBeforeDeleteFromShape)==null||N.call(F,{binding:O,shape:k})):((B=F.onBeforeIsolateFromShape)==null||B.call(F,{binding:O,removedShape:k}),(L=F.onBeforeDeleteToShape)==null||L.call(F,{binding:O,shape:k}))}j.length&&this.deleteBindings(j);const D=new Set([k.id]),R=Ne(this.getPageStates().map(O=>C(O,D)));R.length&&this.store.put(R)}},binding:{beforeCreate:k=>{var D,R;const j=(R=(D=this.getBindingUtil(k)).onBeforeCreate)==null?void 0:R.call(D,{binding:k});return j||k},afterCreate:k=>{var j,D;P.add(k.type),(D=(j=this.getBindingUtil(k)).onAfterCreate)==null||D.call(j,{binding:k})},beforeChange:(k,j)=>{var R,A;const D=(A=(R=this.getBindingUtil(j)).onBeforeChange)==null?void 0:A.call(R,{bindingBefore:k,bindingAfter:j});return D||j},afterChange:(k,j)=>{var D,R;P.add(j.type),(R=(D=this.getBindingUtil(j)).onAfterChange)==null||R.call(D,{bindingBefore:k,bindingAfter:j})},beforeDelete:k=>{var j,D;(D=(j=this.getBindingUtil(k)).onBeforeDelete)==null||D.call(j,{binding:k})},afterDelete:k=>{var j,D;(D=(j=this.getBindingUtil(k)).onAfterDelete)==null||D.call(j,{binding:k}),P.add(k.type)}},page:{afterCreate:k=>{const j=mr.createId(k.id),D=Bi.createId(k.id);this.store.has(j)||this.store.put([mr.create({id:j})]),this.store.has(D)||this.store.put([Bi.create({id:D,pageId:k.id})])},afterDelete:(k,j)=>{var A,N;if(((A=this.getInstanceState())==null?void 0:A.currentPageId)===k.id){const B=(N=this.getPages().find(L=>L.id!==k.id))==null?void 0:N.id;B?this.store.put([{...this.getInstanceState(),currentPageId:B}]):j==="user"&&this.store.ensureStoreIsUsable()}const D=mr.createId(k.id),R=Bi.createId(k.id);this.store.remove([D,R])}},instance:{afterChange:(k,j,D)=>{var R;if(!this.store.has(j.currentPageId)){const A=this.store.has(k.currentPageId)?k.currentPageId:(R=this.getPages()[0])==null?void 0:R.id;A?this.store.update(j.id,N=>({...N,currentPageId:A})):D==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(k,j)=>{if((k==null?void 0:k.selectedShapeIds)!==(j==null?void 0:j.selectedShapeIds)){const D=j.selectedShapeIds.filter(A=>{var B,L;let N=(B=this.getShape(A))==null?void 0:B.parentId;for(;Ss(N);){if(j.selectedShapeIds.includes(N))return!1;N=(L=this.getShape(N))==null?void 0:L.parentId}return!0});let R=null;if(D.length>0){const A=this.findCommonAncestor(Ne(D.map(N=>this.getShape(N))),N=>this.isShapeOfType(N,"group"));A&&(R=A)}else j!=null&&j.focusedGroupId&&(R=j.focusedGroupId);(D.length!==j.selectedShapeIds.length||R!==j.focusedGroupId)&&this.store.put([{...j,selectedShapeIds:D,focusedGroupId:R??null}])}}}})),this._currentPageShapeIds=dne(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=cne(this.store),this.disposables.add(this.store.listen(k=>{this.emit("change",k)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),d&&this.root.children[d]===void 0)throw Error(`No state found for initialState "${d}".`);this.root.enter(void 0,"initial"),this.edgeScrollManager=new gne(this),this.focusManager=new yne(this,u),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new lD}dispose(){this.disposables.forEach(t=>t()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(t){const s=typeof t=="string"?t:t.type,i=Ts(this.shapeUtils,s);return mt(i,`No shape util found for type "${s}"`),i}getBindingUtil(t){const s=typeof t=="string"?t:t.type,i=Ts(this.bindingUtils,s);return mt(i,`No binding util found for type "${s}"`),i}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(t){return this.history.mark(t),this}squashToMark(t){return this.history.squashToMark(t),this}bail(){return this.history.bail(),this}bailToMark(t){return this.history.bailToMark(t),this}run(t,s){const i=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(s==null?void 0:s.ignoreShapeLock)??i;try{this.history.batch(t,s)}finally{this._shouldIgnoreShapeLock=i}return this}batch(t,s){return this.run(t,s)}annotateError(t,{origin:s,willCrashApp:i,tags:r,extras:o}){const l=this.createErrorAnnotations(s,i);return EE(t,{tags:{...l.tags,...r},extras:{...l.extras,...o}}),i&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(t,s){try{const i=this.getEditingShapeId();return{tags:{origin:t,willCrashApp:s},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:i?this.getShape(i):void 0,inputs:this.inputs}}}catch{return{tags:{origin:t,willCrashApp:s},extras:{}}}}getCrashingError(){return this._crashingError}crash(t){return this._crashingError=t,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:t}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(t){const s=t.split(".").reverse();let i=this.root;for(;s.length>0;){const r=s.pop();if(!r)return!0;const o=i.getCurrent();if((o==null?void 0:o.id)===r){if(s.length===0)return!0;i=o;continue}else return!1}return!1}isInAny(...t){return t.some(s=>this.isIn(s))}setCurrentTool(t,s={}){return this.root.transition(t,s),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const t=this.getCurrentTool();return t?t.getCurrentToolIdMask()??t.id:""}getStateDescendant(t){var r;const s=t.split(".").reverse();let i=this.root;for(;s.length>0;){const o=s.pop();if(!o)return i;const l=(r=i.children)==null?void 0:r[o];if(!l)return;i=l}return i}getDocumentSettings(){return this.store.get(V0)}updateDocumentSettings(t){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...t}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(ns)}updateInstanceState(t,s){return this._updateInstanceState(t,{history:"ignore",...s}),t.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),t.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}getOpenMenus(){return this.getInstanceState().openMenus}addOpenMenu(t){const s=new Set(this.getOpenMenus());return s.has(t)||(s.add(t),this.updateInstanceState({openMenus:[...s]})),this}deleteOpenMenu(t){const s=new Set(this.getOpenMenus());return s.has(t)&&(s.delete(t),this.updateInstanceState({openMenus:[...s]})),this}clearOpenMenus(){return this.getOpenMenus().length&&this.updateInstanceState({openMenus:[]}),this}getIsMenuOpen(){return this.getOpenMenus().length>0}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Bi.createId(this.getCurrentPageId())}updateCurrentPageState(t){return this._updateCurrentPageState(t),this}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:t}=this.getCurrentPageState();return Ne(t.map(s=>this.store.get(s)))}setSelectedShapes(t){return this.run(()=>{const s=t.map(o=>typeof o=="string"?o:o.id),{selectedShapeIds:i}=this.getCurrentPageState(),r=new Set(i);if(s.length===r.size&&s.every(o=>r.has(o)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:s}])},{history:"record-preserveRedoStack"})}isAncestorSelected(t){const s=typeof t=="string"?t:(t==null?void 0:t.id)??null,i=this.getShape(s);if(!i)return!1;const r=this.getSelectedShapeIds();return!!this.findShapeAncestor(i,o=>r.includes(o.id))}select(...t){const s=typeof t[0]=="string"?t:t.map(i=>i.id);return this.setSelectedShapes(s),this}deselect(...t){const s=typeof t[0]=="string"?t:t.map(r=>r.id),i=this.getSelectedShapeIds();return i.length>0&&s.length>0&&this.setSelectedShapes(i.filter(r=>!s.includes(r))),this}selectAll(){const t=this.getSortedChildIdsForParent(this.getCurrentPageId());return t.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(t)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var t;return((t=this.getOnlySelectedShape())==null?void 0:t.id)??null}getOnlySelectedShape(){const t=this.getSelectedShapes();return t.length===1?t[0]:null}getSelectionPageBounds(){const t=this.getCurrentPageState().selectedShapeIds;return t.length===0?null:ue.Common(Ne(t.map(s=>this.getShapePageBounds(s))))}getSelectionRotation(){const t=this.getSelectedShapeIds();let s=!1,i=0;for(let r=0,o=t.length;r<o;r++){const l=this.getShapePageTransform(t[r]);if(l)if(s){if(l.rotation()!==i)return 0}else s=!0,i=l.rotation()}return i}getSelectionRotatedPageBounds(){const t=this.getSelectedShapeIds();if(t.length===0)return;const s=this.getSelectionRotation();if(s===0)return this.getSelectionPageBounds();if(t.length===1){const r=this.getShapeGeometry(t[0]).bounds.clone(),o=this.getShapePageTransform(t[0]);return r.point=o.applyToPoint(r.point),r}const i=ue.FromPoints(this.getSelectedShapeIds().flatMap(r=>{const o=this.getShapePageTransform(r);return o?o.applyToPoints(this.getShapeGeometry(r).bounds.corners):[]}).map(r=>r.rot(-s)));return i.point=i.point.rot(s),i}getSelectionRotatedScreenBounds(){const t=this.getSelectionRotatedPageBounds();if(!t)return;const{x:s,y:i}=this.pageToScreen(t.point),r=this.getZoomLevel();return new ue(s,i,t.width*r,t.height*r)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const t=this.getFocusedGroupId();return t?this.getShape(t):void 0}setFocusedGroup(t){const s=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(s!==null){const i=this.getShape(s);if(!i)throw Error(`Editor.setFocusedGroup: Shape with id ${s} does not exist`);if(!this.isShapeOfType(i,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${i.type}`)}return s===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,i=>({...i,focusedGroupId:s}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const t=this.getFocusedGroup();if(t){const s=this.findShapeAncestor(t,i=>this.isShapeOfType(i,"group"));this.setFocusedGroup((s==null?void 0:s.id)??null),this.select(t.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const t=this.getEditingShapeId();return t?this.getShape(t):void 0}setEditingShape(t){const s=typeof t=="string"?t:(t==null?void 0:t.id)??null;if(s!==this.getEditingShapeId()){if(s){const i=this.getShape(s);if(i&&this.getShapeUtil(i).canEdit(i))return this.run(()=>{this._updateCurrentPageState({editingShapeId:s})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const t=this.getHoveredShapeId();return t?this.getShape(t):void 0}setHoveredShape(t){const s=typeof t=="string"?t:(t==null?void 0:t.id)??null;return s===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:s})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const t=this.getHintingShapeIds();return Ne(t.map(s=>this.getShape(s)))}setHintingShapes(t){const s=typeof t[0]=="string"?t:t.map(i=>i.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:CE(s)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const t=this.getErasingShapeIds();return Ne(t.map(s=>this.getShape(s)))}setErasingShapes(t){const s=typeof t[0]=="string"?t:t.map(r=>r.id);s.sort();const i=this.getErasingShapeIds();return this.run(()=>{if(s.length===i.length){for(let r=0;r<s.length;r++)if(s[r]!==i[r]){this._updateCurrentPageState({erasingShapeIds:s});break}}else this._updateCurrentPageState({erasingShapeIds:s})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(t){const s=typeof t=="string"?t:(t==null?void 0:t.id)??null;return s!==this.getCroppingShapeId()&&this.run(()=>{if(!s)this.updateCurrentPageState({croppingShapeId:null});else{const i=this.getShape(s),r=this.getShapeUtil(i);i&&r.canCrop(i)&&this.updateCurrentPageState({croppingShapeId:s})}},{history:"ignore"}),this}_unsafe_getCameraId(){return mr.createId(this.getCurrentPageId())}getCamera(){const t=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const s=this.getCameraForFollowing();if(s)return{...t,...s}}return t}getViewportPageBoundsForFollowing(){const t=this.getInstanceState().followingUserId;if(!t)return null;const s=this.getCollaborators().find(p=>p.userId===t);if(!s)return null;const{w:i,h:r}=s.screenBounds,{x:o,y:l,z:c}=s.camera,d=new ue(-o,-l,i/c,r/c),u=this.getViewportScreenBounds().clone(),h=u.width/u.height;return u.width=d.width,u.height=u.width/h,u.height<d.height&&(u.height=d.height,u.width=u.height*h),u.center=d.center,u}getCameraForFollowing(){const t=this.getViewportPageBoundsForFollowing();return t?{x:-t.x,y:-t.y,z:this.getViewportScreenBounds().w/t.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const t=this.getCameraOptions();if(!t.constraints||t.constraints.initialZoom==="default")return 1;const{zx:s,zy:i}=bA(this,t);switch(t.constraints.initialZoom){case"fit-min":return Math.max(s,i);case"fit-max":return Math.min(s,i);case"fit-x":return s;case"fit-y":return i;case"fit-min-100":return Math.min(1,Math.max(s,i));case"fit-max-100":return Math.min(1,Math.min(s,i));case"fit-x-100":return Math.min(1,s);case"fit-y-100":return Math.min(1,i);default:throw Vn(t.constraints.initialZoom)}}getBaseZoom(){const t=this.getCameraOptions();if(!t.constraints||t.constraints.baseZoom==="default")return 1;const{zx:s,zy:i}=bA(this,t);switch(t.constraints.baseZoom){case"fit-min":return Math.max(s,i);case"fit-max":return Math.min(s,i);case"fit-x":return s;case"fit-y":return i;case"fit-min-100":return Math.min(1,Math.max(s,i));case"fit-max-100":return Math.min(1,Math.min(s,i));case"fit-x-100":return Math.min(1,s);case"fit-y-100":return Math.min(1,i);default:throw Vn(t.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(t){var i;const s=ft({...this._cameraOptions.__unsafe__getWithoutCapture(),...t});return((i=s.zoomSteps)==null?void 0:i.length)<1&&(s.zoomSteps=[1]),this._cameraOptions.set(s),this}getConstrainedCamera(t,s){const i=this.getCamera();let{x:r,y:o,z:l=i.z}=t;if(!(s!=null&&s.force)){const c=this.getCameraOptions(),d=c.zoomSteps[0],u=wn(c.zoomSteps),h=this.getViewportScreenBounds();if(c.constraints){const{constraints:p}=c,f=Math.min(p.padding.y,h.w/2),g=Math.min(p.padding.x,h.h/2),m=ue.From(c.constraints.bounds),x=(h.w-g*2)/m.w,y=(h.h-f*2)/m.h,S=this.getBaseZoom(),v=u*S,C=d*S;if(s!=null&&s.reset&&(l=this.getInitialZoom()),l<C||l>v){const{x:A,y:N,z:B}=i,L=-A+h.w/B/2,O=-N+h.h/B/2;l=tn(l,C,v);const F=-A+h.w/l/2,W=-N+h.h/l/2;r=A+F-L,o=N+W-O}const T=g/l-m.x,I=f/l-m.y,E=(h.w-g*2)/l-m.w,P=(h.h-f*2)/l-m.h,k=T+E*p.origin.x,j=I+P*p.origin.y,D=typeof p.behavior=="string"?p.behavior:p.behavior.x,R=typeof p.behavior=="string"?p.behavior:p.behavior.y;if(s!=null&&s.reset)r=k,o=j;else{switch(D){case"fixed":{r=k;break}case"contain":{l<x?r=k:r=tn(r,T+E,T);break}case"inside":{l<x?r=tn(r,T,(h.w-g)/l-m.w):r=tn(r,T+E,T);break}case"outside":{r=tn(r,g/l-m.w,(h.w-g)/l);break}case"free":break;default:throw Vn(D)}switch(R){case"fixed":{o=j;break}case"contain":{l<y?o=j:o=tn(o,I+P,I);break}case"inside":{l<y?o=tn(o,I,(h.h-f)/l-m.h):o=tn(o,I+P,I);break}case"outside":{o=tn(o,f/l-m.h,(h.h-f)/l);break}case"free":break;default:throw Vn(R)}}}else if(l>u||l<d){const{x:p,y:f,z:g}=i;l=tn(l,d,u),r=p+(-p+h.w/l/2)-(-p+h.w/g/2),o=f+(-f+h.h/l/2)-(-f+h.h/g/2)}}return{x:r,y:o,z:l}}_setCamera(t,s){const i=this.getCamera(),{x:r,y:o,z:l}=this.getConstrainedCamera(t,s);return i.x===r&&i.y===o&&i.z===l?this:(_r(()=>{const c={...i,x:r,y:o,z:l};this.run(()=>{this.store.put([c])},{history:"ignore"});const{currentScreenPoint:d,currentPagePoint:u}=this.inputs,{screenBounds:h}=this.store.unsafeGetWithoutCapture(ns);if(d.x/l-r!==u.x||d.y/l-o!==u.y){const p={type:"pointer",target:"canvas",name:"pointer_move",point:_.AddXY(d,h.x,h.y),pointerId:Xk.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.getInstanceState().isPenMode??!1};s!=null&&s.immediate?this._flushEventForTick(p):this.dispatch(p)}this._tickCameraState()}),this)}setCamera(t,s){const{isLocked:i}=this._cameraOptions.__unsafe__getWithoutCapture();if(i&&!(s!=null&&s.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const r=_.Cast(t);Number.isFinite(r.x)||(r.x=0),Number.isFinite(r.y)||(r.y=0),(r.z===void 0||!Number.isFinite(r.z))&&(t.z=this.getZoomLevel());const o=this.getConstrainedCamera(r,s);if(s!=null&&s.animation){const{width:l,height:c}=this.getViewportScreenBounds();this._animateToViewport(new ue(-o.x,-o.y,l/o.z,c/o.z),s)}else this._setCamera(o,{...s,force:!0});return this}centerOnPoint(t,s){const{isLocked:i}=this.getCameraOptions();if(i&&!(s!=null&&s.force))return this;const{width:r,height:o}=this.getViewportPageBounds();return this.setCamera(new _(-(t.x-r/2),-(t.y-o/2),this.getCamera().z),s),this}zoomToFit(t){const s=[...this.getCurrentPageShapeIds()];if(s.length<=0)return this;const i=ue.Common(Ne(s.map(r=>this.getShapePageBounds(r))));return this.zoomToBounds(i,t),this}resetZoom(t=this.getViewportScreenCenter(),s){const{isLocked:i,constraints:r}=this.getCameraOptions();if(i&&!(s!=null&&s.force))return this;const o=this.getCamera(),{x:l,y:c,z:d}=o,{x:u,y:h}=t;let p=1;if(r){const f=this.getInitialZoom();d!==f&&(p=f)}return this.setCamera(new _(l+(u/p-u)-(u/d-u),c+(h/p-h)-(h/d-h),p),s),this}zoomIn(t=this.getViewportScreenCenter(),s){const{isLocked:i}=this.getCameraOptions();if(i&&!(s!=null&&s.force))return this;const{x:r,y:o,z:l}=this.getCamera(),{zoomSteps:c}=this.getCameraOptions();if(c!==null&&c.length>1){const d=this.getBaseZoom();let u=wn(c)*d;for(let h=1;h<c.length;h++){const p=c[h-1]*d,f=c[h]*d;if(!(f-l<=(f-p)/2)){u=f;break}}this.setCamera(new _(r+(t.x/u-t.x)-(t.x/l-t.x),o+(t.y/u-t.y)-(t.y/l-t.y),u),s)}return this}zoomOut(t=this.getViewportScreenCenter(),s){const{isLocked:i}=this.getCameraOptions();if(i&&!(s!=null&&s.force))return this;const{zoomSteps:r}=this.getCameraOptions();if(r!==null&&r.length>1){const o=this.getBaseZoom(),{x:l,y:c,z:d}=this.getCamera();let u=r[0]*o;for(let h=r.length-1;h>0;h--){const p=r[h-1]*o,f=r[h]*o;if(!(f-d>=(f-p)/2)){u=p;break}}this.setCamera(new _(l+(t.x/u-t.x)-(t.x/d-t.x),c+(t.y/u-t.y)-(t.y/d-t.y),u),s)}return this}zoomToSelection(t){const{isLocked:s}=this.getCameraOptions();if(s&&!(t!=null&&t.force))return this;const i=this.getSelectionPageBounds();return i&&this.zoomToBounds(i,{targetZoom:Math.max(1,this.getZoomLevel()),...t}),this}zoomToBounds(t,s){const i=this._cameraOptions.__unsafe__getWithoutCapture();if(i.isLocked&&!(s!=null&&s.force))return this;const r=this.getViewportScreenBounds(),o=(s==null?void 0:s.inset)??Math.min(bQ,r.width*.28),l=this.getBaseZoom(),c=i.zoomSteps[0],d=wn(i.zoomSteps);let u=tn(Math.min((r.width-o)/t.w,(r.height-o)/t.h),c*l,d*l);return(s==null?void 0:s.targetZoom)!==void 0&&(u=Math.min(s.targetZoom,u)),this.setCamera(new _(-t.x+(r.width-t.w*u)/2/u,-t.y+(r.height-t.h*u)/2/u,u),s),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(t){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=t;const{elapsed:s,easing:i,duration:r,start:o,end:l}=this._viewportAnimation;if(s>r){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new _(-l.x,-l.y,this.getViewportScreenBounds().width/l.width));return}const c=r-s,d=i(1-c/r),u=o.minX+(l.minX-o.minX)*d,h=o.minY+(l.minY-o.minY)*d,p=o.maxX+(l.maxX-o.maxX)*d;this._setCamera(new _(-u,-h,this.getViewportScreenBounds().width/(p-u)),{force:!0})}_animateToViewport(t,s={animation:ow}){const{animation:i,...r}=s;if(!i)return;const{duration:o=0,easing:l=ln.easeInOutCubic}=i,c=this.user.getAnimationSpeed(),d=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),o===0||c===0?this._setCamera(new _(-t.x,-t.y,this.getViewportScreenBounds().width/t.width),{...r}):(this._viewportAnimation={elapsed:0,duration:o/c,easing:l,start:d.clone(),end:t.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(t={}){const{isLocked:s}=this.getCameraOptions();if(s&&!(t!=null&&t.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:r,friction:o=this.options.cameraSlideFriction,direction:l,speedThreshold:c=.01}=t;let d=Math.min(r,1);const u=()=>{this.off("tick",h),this.off("stop-camera-animation",u)};this.once("stop-camera-animation",u);const h=p=>{const{x:f,y:g,z:m}=this.getCamera(),x=_.Mul(l,d*p/m);d*=1-o,d<c?u():this._setCamera(new _(f+x.x,g+x.y,m))};return this.on("tick",h),this}zoomToUser(t,s={animation:{duration:500}}){const i=this.getCollaborators().find(r=>r.userId===t);return i?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const r=i.currentPageId===this.getCurrentPageId();r||this.setCurrentPage(i.currentPageId),s&&s.animation&&!r&&(s.animation=void 0),this.centerOnPoint(i.cursor,s);const{highlightedUserIds:o}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...o,t]}),this.timers.setTimeout(()=>{const l=[...this.getInstanceState().highlightedUserIds],c=l.indexOf(t);c<0||(l.splice(c,1),this.updateInstanceState({highlightedUserIds:l}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(t,s=!1){t.width=Math.max(t.width,1),t.height=Math.max(t.height,1);const i=[t.minY!==0,!wa(document.body.scrollWidth,t.maxX,1),!wa(document.body.scrollHeight,t.maxY,1),t.minX!==0],{screenBounds:r,insets:o}=this.getInstanceState();if(t.equals(r)&&i.every((c,d)=>c===o[d]))return this;const{_willSetInitialBounds:l}=this;if(this._willSetInitialBounds=!1,l)this.updateInstanceState({screenBounds:t.toJson(),insets:i}),this.setCamera(this.getCamera());else if(s&&!this.getInstanceState().followingUserId){const c=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:t.toJson(),insets:i}),this.centerOnPoint(c)}else this.updateInstanceState({screenBounds:t.toJson(),insets:i}),this._setCamera(_.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:t,y:s,w:i,h:r}=this.getInstanceState().screenBounds;return new ue(t,s,i,r)}getViewportScreenCenter(){const t=this.getViewportScreenBounds();return new _(t.midX-t.minX,t.midY-t.minY)}getViewportPageBounds(){const{w:t,h:s}=this.getViewportScreenBounds(),{x:i,y:r,z:o}=this.getCamera();return new ue(-i,-r,t/o,s/o)}screenToPage(t){const{screenBounds:s}=this.store.unsafeGetWithoutCapture(ns),{x:i,y:r,z:o=1}=this.getCamera();return new _((t.x-s.x)/o-i,(t.y-s.y)/o-r,t.z??.5)}pageToScreen(t){const{screenBounds:s}=this.store.unsafeGetWithoutCapture(ns),{x:i,y:r,z:o=1}=this.getCamera();return new _((t.x+i)*o+s.x,(t.y+r)*o+s.y,t.z??.5)}pageToViewport(t){const{x:s,y:i,z:r=1}=this.getCamera();return new _((t.x+s)*r,(t.y+i)*r,t.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const t=this._getCollaboratorsQuery().get();return t.length?[...new Set(t.map(i=>i.userId))].sort().map(i=>t.filter(o=>o.userId===i).sort((o,l)=>l.lastActivityTimestamp-o.lastActivityTimestamp)[0]):co}getCollaboratorsOnCurrentPage(){const t=this.getCurrentPageId();return this.getCollaborators().filter(s=>s.currentPageId===t)}startFollowingUser(t){this.stopFollowingUser();const s=this._getCollaboratorsQuery().get().filter(o=>o.userId===t);if(!s.length)return console.warn("User not found"),this;const i=this.user.getId();if(i||console.warn("You should set the userId for the current instance before following a user"),s.some(o=>o.followingUserId===i))return this;const r=Q("latestLeaderPresence",()=>this.getCollaborators().find(o=>o.userId===t));return _r(()=>{this.updateInstanceState({followingUserId:t},{history:"ignore"});const o=Zl("update current page",()=>{const d=r.get();if(!d){this.stopFollowingUser();return}d.currentPageId!==this.getCurrentPageId()&&this.getPage(d.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:d.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),l=()=>{o(),this._isLockedOnFollowingUser.set(!1),this.off("frame",c),this.off("stop-following",l)},c=()=>{if(!r.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const u=this.user.getAnimationSpeed();if(u===0){this._isLockedOnFollowingUser.set(!0);return}const h=this.getViewportPageBoundsForFollowing();if(!h){this.stopFollowingUser();return}const p=this.getViewportPageBounds(),f=Math.abs(h.minX-p.minX)+Math.abs(h.maxX-p.maxX),g=Math.abs(h.minY-p.minY)+Math.abs(h.maxY-p.maxY);if(f<this.options.followChaseViewportSnap&&g<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const m=tn(u*.5,.1,.8),x=new ue(bs(p.minX,h.minX,m),bs(p.minY,h.minY,m),bs(p.width,h.width,m),bs(p.height,h.height,m)),y=new _(-x.x,-x.y,this.getViewportScreenBounds().width/x.width);this.stopCameraAnimation(),this._setCamera(y)};this.once("stop-following",l),this.addListener("frame",c),c()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(t){const s=[];let i=this.options.maxShapesPerPage*2,r=this.options.maxShapesPerPage;const o=this.getErasingShapeIds(),l=(d,u,h)=>{const p=this.getShape(d);if(!p)return;u*=p.opacity;let f=!1;const g=this.getShapeUtil(p);t&&(f=!h&&o.includes(d),f&&(u*=.32)),s.push({id:d,shape:p,util:g,index:i,backgroundIndex:r,opacity:u}),i+=1,r+=1;const m=this.getSortedChildIdsForParent(d);if(!m.length)return;let x=null;g.providesBackgroundForChildren(p)&&(x=r,r=i,i+=this.options.maxShapesPerPage);for(const y of m)l(y,u,h||f);x!==null&&(r=x)},c=t?[this.getCurrentPage()]:this.getPages();for(const d of c)for(const u of this.getSortedChildIdsForParent(d.id))l(u,1,!1);return s}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(IZ)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(Hn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(t){return this.store.get(typeof t=="string"?t:t.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(t){const s=typeof t=="string"?t:t.id,i=this.store.query.exec("shape",{parentId:{eq:s}});return this.getShapeAndDescendantIds(i.map(r=>r.id))}setCurrentPage(t){const s=typeof t=="string"?t:t.id;return this.store.has(s)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:s}])},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(t){return this.getInstanceState().isReadonly?this:this.getPage(t.id)?this.run(()=>this.store.update(t.id,i=>({...i,...t}))):this}createPage(t){return this.run(()=>{if(this.getInstanceState().isReadonly||this.getPages().length>=this.options.maxPages)return;const s=this.getPages(),i=tne(t.name??"Page 1",s.map(l=>l.name));let r=t.index;(!r||s.some(l=>l.index===r))&&(r=Li(s[s.length-1].index));const o=So.create({meta:{},...t,name:i,index:r});this.store.put([o])}),this}deletePage(t){const s=typeof t=="string"?t:t.id;return this.run(()=>{if(this.getInstanceState().isReadonly)return;const i=this.getPages();if(i.length===1)return;const r=this.getPage(s);if(r){if(s===this.getCurrentPageId()){const o=i.findIndex(c=>c.id===s),l=i[o-1]??i[o+1];this.setCurrentPage(l.id)}this.store.remove([r.id])}}),this}duplicatePage(t,s=So.createId()){if(this.getPages().length>=this.options.maxPages)return this;const i=typeof t=="string"?t:t.id,r=this.getPage(i);if(!r)return this;const o={...this.getCamera()},l=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(r.id));return this.run(()=>{var u;const c=this.getPages(),d=ep(r.index,(u=c[c.indexOf(r)+1])==null?void 0:u.index);if(this.createPage({name:r.name+" Copy",id:s,index:d}),this.setCurrentPage(s),this.setCamera(o),l)return this.putContentOntoCurrentPage(l)}),this}renamePage(t,s){const i=typeof t=="string"?t:t.id;return this.getInstanceState().isReadonly?this:(this.updatePage({id:i,name:s}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(t){return this.getInstanceState().isReadonly?this:t.length<=0?this:(this.run(()=>this.store.put(t),{history:"ignore"}),this)}updateAssets(t){return this.getInstanceState().isReadonly?this:t.length<=0?this:(this.run(()=>{this.store.put(t.map(s=>({...this.store.get(s.id),...s})))},{history:"ignore"}),this)}deleteAssets(t){if(this.getInstanceState().isReadonly)return this;const s=typeof t[0]=="string"?t:t.map(i=>i.id);return s.length<=0?this:(this.run(()=>this.store.remove(s),{history:"ignore"}),this)}getAsset(t){return this.store.get(typeof t=="string"?t:t.id)}async resolveAssetUrl(t,s){if(!t)return null;const i=this.getAsset(t);if(!i)return null;const{screenScale:r=1,shouldResolveToOriginal:o=!1}=s,c=Math.max(.125,(h=>Math.pow(2,Math.ceil(Math.log2(h))))(r)),d="connection"in navigator?navigator.connection.effectiveType:null,u=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(i,{screenScale:r||1,steppedScreenScale:c,dpr:u,networkEffectiveType:d,shouldResolveToOriginal:o})}async uploadAsset(t,s){return await this.store.props.assets.upload(t,s)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",t=>this.getShapeUtil(t).getGeometry(t),(t,s)=>t.props===s.props)}getShapeGeometry(t){return this._getShapeGeometryCache().get(typeof t=="string"?t:t.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",t=>{var s,i;return(i=(s=this.getShapeUtil(t)).getHandles)==null?void 0:i.call(s,t)})}getShapeHandles(t){return this._getShapeHandlesCache().get(typeof t=="string"?t:t.id)}getShapeLocalTransform(t){const s=typeof t=="string"?t:t.id,i=this.getShape(s);if(!i)throw Error("Editor.getTransform: shape not found");return ve.Identity().translate(i.x,i.y).rotate(i.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",t=>{if(vs(t.parentId))return this.getShapeLocalTransform(t);const s=this._getShapePageTransformCache().get(t.parentId)??ve.Identity();return ve.Compose(s,this.getShapeLocalTransform(t))})}getShapeParentTransform(t){const s=typeof t=="string"?t:t.id,i=this.getShape(s);return!i||vs(i.parentId)?ve.Identity():this._getShapePageTransformCache().get(i.parentId)??ve.Identity()}getShapePageTransform(t){const s=typeof t=="string"?t:t.id;return this._getShapePageTransformCache().get(s)??ve.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",t=>{const s=this._getShapePageTransformCache().get(t.id);return s?ue.FromPoints(ve.applyToPoints(s,this.getShapeGeometry(t).vertices)):new ue})}getShapePageBounds(t){return this._getShapePageBoundsCache().get(typeof t=="string"?t:t.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",t=>{const s=this._getShapeMaskCache().get(t.id);if(!s)return;if(s.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const i=this._getShapePageTransformCache().get(t.id);return i?`polygon(${ve.applyToPoints(ve.Inverse(i),s).map(o=>`${o.x}px ${o.y}px`).join(",")})`:void 0})}getShapeClipPath(t){return this._getShapeClipPathCache().get(typeof t=="string"?t:t.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",t=>{if(vs(t.parentId))return;const s=this.getShapeAncestors(t.id).filter(r=>this.isShapeOfType(r,"frame"));return s.length===0?void 0:s.map(r=>this._getShapePageTransformCache().get(r.id).applyToPoints(this.getShapeGeometry(r).vertices)).reduce((r,o)=>{if(!(o&&r))return;const l=gA(r,o);return l?l.map(_.Cast):[]})})}getShapeMask(t){return this._getShapeMaskCache().get(typeof t=="string"?t:t.id)}getShapeMaskedPageBounds(t){return typeof t!="string"&&(t=t.id),this._getShapeMaskedPageBoundsCache().get(t)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",t=>{const s=this._getShapePageBoundsCache().get(t.id);if(!s)return;const i=this._getShapeMaskCache().get(t.id);if(i){if(i.length===0)return;const{corners:r}=s;if(r.every((l,c)=>l&&_.Equals(l,i[c])))return s.clone();const o=gA(i,r);return o?ue.FromPoints(o):void 0}return s})}getShapeAncestors(t,s=[]){const i=typeof t=="string"?t:t.id,r=this.getShape(i);if(!r)return s;const o=r.parentId;if(vs(o))return s.reverse(),s;const l=this.store.get(o);return l?(s.push(l),this.getShapeAncestors(l,s)):s}findShapeAncestor(t,s){const i=typeof t=="string"?t:t.id,r=this.getShape(i);if(!r)return;const o=r.parentId;if(vs(o))return;const l=this.getShape(o);if(l)return s(l)?l:this.findShapeAncestor(l,s)}hasAncestor(t,s){const i=typeof t=="string"?t:t==null?void 0:t.id,r=i&&this.getShape(i);return r?r.parentId===s?!0:this.hasAncestor(this.getShapeParent(r),s):!1}findCommonAncestor(t,s){var d;if(t.length===0)return;const i=typeof t[0]=="string"?t:t.map(u=>u.id),r=Ne(i.map(u=>this.getShape(u)));if(r.length===1){const u=r[0].parentId;return vs(u)?void 0:s?(d=this.findShapeAncestor(r[0],s))==null?void 0:d.id:u}const[o,...l]=r;let c=this.getShapeParent(o);for(;c;){if(s&&!s(c)){c=this.getShapeParent(c);continue}if(l.every(u=>this.hasAncestor(u,c.id)))return c.id;c=this.getShapeParent(c)}}isShapeOrAncestorLocked(t){const s=typeof t=="string"?this.getShape(t):t;return s===void 0?!1:s.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(s))}_notVisibleShapes(){return lne(this)}getCulledShapes(){const t=this._notVisibleShapes().get(),s=this.getSelectedShapeIds(),i=this.getEditingShapeId(),r=new Set(t);return i&&r.delete(i),s.forEach(o=>{r.delete(o)}),r}getCurrentPageBounds(){let t;return this.getCurrentPageShapeIdsSorted().forEach(s=>{const i=this.getShapeMaskedPageBounds(s);i&&(t?t=t.expand(i):t=i.clone())}),t}getSelectedShapeAtPoint(t){const s=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(i=>i.type!=="group"&&s.includes(i.id)).reverse().find(i=>this.isPointInShape(i,t,{hitInside:!0,margin:0}))}getShapeAtPoint(t,s={}){const i=this.getZoomLevel(),r=this.getViewportPageBounds(),{filter:o,margin:l=0,hitLocked:c=!1,hitLabels:d=!1,hitInside:u=!1,hitFrameInside:h=!1}=s;let p=1/0,f=null,g=1/0,m=null;const x=(s.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(y=>{if(y.isLocked&&!c||this.isShapeOfType(y,"group"))return!1;const S=this.getShapeMask(y);return S&&!Xs(t,S)?!1:o?o(y):!0});for(let y=x.length-1;y>=0;y--){const S=x[y],v=this.getShapeGeometry(S),C=v instanceof Yi,T=this.getPointInShapeSpace(S,t);if((this.isShapeOfType(S,"arrow")||this.isShapeOfType(S,"geo")&&S.props.fill==="none")&&S.props.text.trim()){for(const E of v.children)if(E.isLabel&&E.isPointInBounds(T))return S}if(this.isShapeOfType(S,"frame")){const E=v.distanceToPoint(T,u);if(Math.abs(E)<=l)return m||S;if(v.hitTestPoint(T,0,!0))return m||f||(h?S:void 0);continue}let I;if(C){let E=1/0;for(const P of v.children){if(P.isLabel&&!d)continue;const k=P.distanceToPoint(T,u);k<E&&(E=k)}I=E}else l===0&&(v.bounds.w<1||v.bounds.h<1)||v.bounds.containsPoint(T,l)?I=v.distanceToPoint(T,u):I=1/0;if(v.isClosed){if(I<=l){if(v.isFilled||C&&v.children[0].isFilled)return m||S;if(this.getShapePageBounds(S).contains(r))continue;if(Math.abs(I)<l)Math.abs(I)<g&&(g=Math.abs(I),m=S);else if(!m){const{area:E}=v;E<p&&(p=E,f=S)}}}else if(I<this.options.hitTestMargin/i)return S}return m||f||void 0}getShapesAtPoint(t,s={}){return this.getCurrentPageShapes().filter(i=>this.isPointInShape(i,t,s))}isPointInShape(t,s,i={}){const{hitInside:r=!1,margin:o=0}=i,l=typeof t=="string"?t:t.id,c=this.getShapeMask(l);return c&&!Xs(s,c)?!1:this.getShapeGeometry(l).hitTestPoint(this.getPointInShapeSpace(t,s),o,r)}getPointInShapeSpace(t,s){const i=typeof t=="string"?t:t.id;return this._getShapePageTransformCache().get(i).clone().invert().applyToPoint(s)}getPointInParentSpace(t,s){const i=typeof t=="string"?t:t.id,r=this.getShape(i);if(!r)return new _(0,0);if(vs(r.parentId))return _.From(s);const o=this.getShapePageTransform(r.parentId);return o?o.clone().invert().applyToPoint(s):_.From(s)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),t=>this.store.get(t))}getCurrentPageShapesSorted(){const t=[],s=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let i=0,r=s.length;i<r;i++)yF(this,s[i],t);return t}getCurrentPageRenderingShapesSorted(){const t=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:s})=>!t.has(s))}isShapeOfType(t,s){const i=typeof t=="string"?this.getShape(t):t;return i?i.type===s:!1}getShape(t){const s=typeof t=="string"?t:t.id;if(Ss(s))return this.store.get(s)}getShapeParent(t){const s=typeof t=="string"?t:t==null?void 0:t.id;if(!s)return;const i=this.getShape(s);if(!(i===void 0||!Ss(i.parentId)))return this.store.get(i.parentId)}getShapeNearestSibling(t,s){return s?s.parentId===t.parentId?s:this.findShapeAncestor(s,r=>r.parentId===t.parentId):void 0}isShapeInPage(t,s=this.getCurrentPageId()){const i=typeof t=="string"?t:t.id,r=this.getShape(i);if(!r)return!1;let o=!1;if(r.parentId===s)o=!0;else{let l=this.getShape(r.parentId);e:for(;l;){if(l.parentId===s){o=!0;break e}l=this.getShape(l.parentId)}}return o}getAncestorPageId(t){const s=typeof t=="string"?t:t==null?void 0:t.id,i=s&&this.getShape(s);if(i)return vs(i.parentId)?i.parentId:this.getAncestorPageId(this.getShape(i.parentId))}reparentShapes(t,s,i){const r=typeof t[0]=="string"?t:t.map(f=>f.id);if(r.length===0)return this;const o=[],l=vs(s)?ve.Identity():this.getShapePageTransform(s),c=l.rotation();let d=[];const u=Ne(this.getSortedChildIdsForParent(s).map(f=>this.getShape(f)));if(i){const f=u.find(g=>g.index===i);if(f){const g=u[u.indexOf(f)+1];g?d=vd(i,g.index,r.length):d=ew(i,r.length)}else{const g=u.sort(Hn).find(m=>m.index>i);g?d=vd(i,g.index,r.length):d=ew(i,r.length)}}else{const f=u.length&&u[u.length-1];d=f?ew(f.index,r.length):tp(r.length)}const h=l.clone().invert(),p=Ne(r.map(f=>this.getShape(f)));return this.run(()=>{for(let f=0;f<p.length;f++){const g=p[f],m=this.getShapePageTransform(g);if(!m)continue;const x=m.point();if(!x)continue;const y=h.applyToPoint(x),S=m.rotation()-c;o.push({id:g.id,type:g.type,parentId:s,x:y.x,y:y.y,rotation:S,index:d[f]})}this.updateShapes(o)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(t){const s=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[s];if(!i||i.length===0)return"a1";const r=this.getShape(i[i.length-1]);return Li(r.index)}getSortedChildIdsForParent(t){const s=typeof t=="string"?t:t.id,i=this._parentIdsToChildIds.get()[s];return i||co}visitDescendants(t,s){const i=typeof t=="string"?t:t.id,r=this.getSortedChildIdsForParent(i);for(const o of r)s(o)!==!1&&this.visitDescendants(o,s);return this}getShapeAndDescendantIds(t){const s=new Set;for(const i of t.map(r=>this.getShape(r)).sort(Hn))s.add(i.id),this.visitDescendants(i,r=>{s.add(r)});return s}getDroppingOverShape(t,s=[]){const i=this.getCurrentPageShapesSorted();for(let r=i.length-1;r>=0;r--){const o=i[r];if(this.getSelectedShapeIds().includes(o.id)||!this.getShapeUtil(o).canDropShapes(o,s)||s.find(c=>c.id===o.id||this.hasAncestor(o,c.id)))continue;const l=this.getShapeMaskedPageBounds(o.id);if(l&&l.containsPoint(t)&&this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(o,t),0,!0))return o}}getOutermostSelectableShape(t,s){const i=typeof t=="string"?t:t.id,r=this.getShape(i);let o=r,l=r;const c=this.getFocusedGroup();for(;l;){if(this.isShapeOfType(l,"group")&&(c==null?void 0:c.id)!==l.id&&!this.hasAncestor(c,l.id)&&((s==null?void 0:s(l))??!0))o=l;else if((c==null?void 0:c.id)===l.id)break;l=this.getShapeParent(l)}return o}_getBindingsIndexCache(){const t=one(this);return this.store.createComputedCache("bindingsIndex",s=>t.get().get(s.id))}getBinding(t){return this.store.get(t)}getBindingsFromShape(t,s){const i=typeof t=="string"?t:t.id;return this.getBindingsInvolvingShape(i).filter(r=>r.fromId===i&&r.type===s)}getBindingsToShape(t,s){const i=typeof t=="string"?t:t.id;return this.getBindingsInvolvingShape(i).filter(r=>r.toId===i&&r.type===s)}getBindingsInvolvingShape(t,s){const i=typeof t=="string"?t:t.id,r=this._getBindingsIndexCache().get(i)??co;return s?r.filter(o=>o.type===s):r}createBindings(t){const s=[];for(const i of t){const r=this.getShape(i.fromId),o=this.getShape(i.toId);if(!r||!o||!this.canBindShapes({fromShape:r,toShape:o,binding:i}))continue;const c=this.getBindingUtil(i.type).getDefaultProps(),d=this.store.schema.types.binding.create({...i,id:i.id??bl(),props:{...c,...i.props}});s.push(d)}return this.store.put(s),this}createBinding(t){return this.createBindings([t])}updateBindings(t){const s=[];for(const i of t){if(!i)continue;const r=this.getBinding(i.id);if(!r)continue;const o=or(r,i);if(o===r)continue;const l=this.getShape(o.fromId),c=this.getShape(o.toId);!l||!c||this.canBindShapes({fromShape:l,toShape:c,binding:o})&&s.push(o)}return this.store.put(s),this}updateBinding(t){return this.updateBindings([t])}deleteBindings(t,{isolateShapes:s=!1}={}){const i=t.map(r=>typeof r=="string"?r:r.id);return s?this.store.atomic(()=>{var r,o;for(const l of i){const c=this.getBinding(l);if(!c)continue;const d=this.getBindingUtil(c);(r=d.onBeforeIsolateFromShape)==null||r.call(d,{binding:c,removedShape:this.getShape(c.toId)}),(o=d.onBeforeIsolateToShape)==null||o.call(d,{binding:c,removedShape:this.getShape(c.fromId)}),this.store.remove([l])}}):this.store.remove(i),this}deleteBinding(t,s){return this.deleteBindings([t],s)}canBindShapes({fromShape:t,toShape:s,binding:i}){const r=typeof t=="string"?t:t.type,o=typeof s=="string"?s:s.type,l=typeof i=="string"?i:i.type,c={fromShapeType:r,toShapeType:o,bindingType:l};return r===o?this.getShapeUtil(r).canBind(c):this.getShapeUtil(r).canBind(c)&&this.getShapeUtil(o).canBind(c)}rotateShapesBy(t,s){if((typeof t[0]=="string"?t:t.map(o=>o.id)).length<=0)return this;const r=pF({editor:this});return r?(em({delta:s,snapshot:r,editor:this,stage:"one-off"}),this):this}getChangesToTranslateShape(t,s){var o,l,c;let i=t;const r=this.getShapeUtil(t);return i=or(i,((o=r.onTranslateStart)==null?void 0:o.call(r,i))??void 0),i=or(i,{id:t.id,type:t.type,x:s.x,y:s.y}),i=or(i,((l=r.onTranslate)==null?void 0:l.call(r,t,i))??void 0),i=or(i,((c=r.onTranslateEnd)==null?void 0:c.call(r,t,i))??void 0),i}nudgeShapes(t,s){const i=typeof t[0]=="string"?t:t.map(o=>o.id);if(i.length<=0)return this;const r=[];for(const o of i){const l=this.getShape(o),c=_.From(s),d=this.getShapeParentTransform(l);d&&c.rot(-d.rotation()),r.push(this.getChangesToTranslateShape(l,c.add(l)))}return this.updateShapes(r),this}duplicateShapes(t,s){return this.run(()=>{const i=typeof t[0]=="string"?t:t.map(p=>p.id);if(i.length<=0)return this;const r=new Set(i),o=this.getShapeAndDescendantIds(i),l=[...o].reverse(),c=new Map;for(const p of o)c.set(p,st());const{shapesToCreate:d,bindingsToCreate:u}=wA(this,o,p=>{const f=[];for(const m of p){const x=this.getBinding(m);if(!x)continue;const y=bl();f.push({...x,id:y,fromId:pi(c.get(x.fromId)),toId:pi(c.get(x.toId))})}const g=[];for(const m of l){const x=pi(c.get(m)),y=this.getShape(m);if(!y)continue;let S=0,v=0;if(s&&r.has(m)){const j=this.getShapeParentTransform(y),D=new _(s.x,s.y).rot(-j.rotation());S=D.x,v=D.y}const C=y.parentId,T=this.getSortedChildIdsForParent(C),I=T.indexOf(y.id),E=T[I+1],P=E?this.getShape(E):null,k=P?ep(y.index,P.index):Li(y.index);g.push({...y,id:x,x:y.x+S,y:y.y+v,index:k,parentId:c.get(y.parentId)??y.parentId})}return{shapesToCreate:g,bindingsToCreate:f}});if(d.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){eg(this);return}if(this.createShapes(d),this.createBindings(u),this.setSelectedShapes(Ne(i.map(p=>c.get(p)))),s!==void 0){const p=this.getSelectionPageBounds(),f=this.getViewportPageBounds();p&&!f.contains(p)&&this.centerOnPoint(p.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(t,s){const i=typeof t[0]=="string"?t:t.map(c=>c.id);if(i.length===0)return this;if(this.getInstanceState().isReadonly)return this;const r=this.getCurrentPageId();if(s===r)return this;if(!this.store.has(s))return this;const o=this.getContentFromCurrentPage(i);if(!o)return this;if(this.getPageShapeIds(s).size+o.shapes.length>this.options.maxShapesPerPage)return eg(this,s),this;const l=this.getCamera().z;return this.run(()=>{this.deleteShapes(i),this.setCurrentPage(s),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(o,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:l}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(t){const s=typeof t[0]=="string"?t:t.map(l=>l.id);if(this.getInstanceState().isReadonly||s.length===0)return this;let i=!0,r=!0;const o=[];for(const l of s){const c=this.getShape(l);c&&(o.push(c),c.isLocked?r=!1:i=!1)}return this.run(()=>{r?(this.updateShapes(o.map(l=>({id:l.id,type:l.type,isLocked:!0}))),this.setSelectedShapes([])):i?this.updateShapes(o.map(l=>({id:l.id,type:l.type,isLocked:!1}))):this.updateShapes(o.map(l=>({id:l.id,type:l.type,isLocked:!0})))}),this}sendToBack(t){const s=typeof t[0]=="string"?t:t.map(r=>r.id),i=Qf(this,"toBack",s);return i&&this.updateShapes(i),this}sendBackward(t){const s=typeof t[0]=="string"?t:t.map(r=>r.id),i=Qf(this,"backward",s);return i&&this.updateShapes(i),this}bringForward(t){const s=typeof t[0]=="string"?t:t.map(r=>r.id),i=Qf(this,"forward",s);return i&&this.updateShapes(i),this}bringToFront(t){const s=typeof t[0]=="string"?t:t.map(r=>r.id),i=Qf(this,"toFront",s);return i&&this.updateShapes(i),this}flipShapes(t,s){const i=typeof t[0]=="string"?t:t.map(l=>l.id);if(this.getInstanceState().isReadonly)return this;let r=Ne(i.map(l=>this.getShape(l)));if(!r.length)return this;r=Ne(r.map(l=>this.isShapeOfType(l,"group")?this.getSortedChildIdsForParent(l.id).map(c=>this.getShape(c)):l).flat());const o=ue.Common(Ne(r.map(l=>this.getShapePageBounds(l)))).center;return this.run(()=>{for(const l of r){const c=this.getShapeGeometry(l).bounds,d=this.getShapePageTransform(l.id);d&&this.resizeShape(l.id,{x:s==="horizontal"?-1:1,y:s==="vertical"?-1:1},{initialBounds:c,initialPageTransform:d,initialShape:l,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(l).isAspectRatioLocked(l),scaleOrigin:o,scaleAxisRotation:0})}}),this}stackShapes(t,s,i){const r=typeof t[0]=="string"?t:t.map(x=>x.id);if(this.getInstanceState().isReadonly)return this;const o=r.map(x=>this.getShape(x)).filter(x=>x?this.getShapeUtil(x).canBeLaidOut(x):!1),l=o.length;if(i===0&&l<3||l<2)return this;const c=Object.fromEntries(o.map(x=>[x.id,this.getShapePageBounds(x)]));let d,u,h,p;s==="horizontal"?(d="x",u="minX",h="maxX",p="width"):(d="y",u="minY",h="maxY",p="height");let f;if(i===0){const x=[];o.sort((S,v)=>c[S.id][u]-c[v.id][u]);for(let S=0;S<l-1;S++){const v=o[S],C=o[S+1],T=c[v.id],E=c[C.id][u]-T[h],P=x.find(k=>k.gap===E);P?P.count++:x.push({gap:E,count:1})}let y=0;x.forEach(S=>{S.count>y&&(y=S.count,f=S.gap)}),y===1&&(f=Math.max(0,x.reduce((S,v)=>S+v.gap*v.count,0)/(l-1)))}else f=i;const g=[];let m=c[o[0].id][h];return o.forEach((x,y)=>{var I,E;if(y===0)return;const S={x:0,y:0};S[d]=m+f-c[x.id][d];const v=this.getShapeParent(x),C=v?_.Rot(S,-this.getShapePageTransform(v).decompose().rotation):S,T=(E=(I=this.getShapeUtil(x)).onTranslateStart)==null?void 0:E.call(I,x);g.push(T?{...T,[d]:x[d]+C[d]}:{id:x.id,type:x.type,[d]:x[d]+C[d]}),m+=c[x.id][p]+f}),this.updateShapes(g),this}packShapes(t,s){var E,P;const i=typeof t[0]=="string"?t:t.map(k=>k.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const r=i.map(k=>this.getShape(k)).filter(k=>k?this.getShapeUtil(k).canBeLaidOut(k):!1),o={},l={};let c,d,u=0;for(let k=0;k<r.length;k++)c=r[k],d=this.getShapePageBounds(c),o[c.id]=d,l[c.id]=d.clone(),u+=d.width*d.height;const h=ue.Common(Ne(Object.values(o))),p=h.width;r.sort((k,j)=>o[j.id].height-o[k.id].height);const f=Math.max(Math.ceil(Math.sqrt(u/.95)),p),g=[new ue(h.x,h.y,f,1/0)];let m=0,x=0,y,S;for(let k=0;k<r.length;k++){c=r[k],d=l[c.id];for(let j=g.length-1;j>=0;j--)if(y=g[j],!(d.width>y.width||d.height>y.height)){d.x=y.x,d.y=y.y,x=Math.max(x,d.maxY),m=Math.max(m,d.maxX),d.width===y.width&&d.height===y.height?(S=g.pop(),j<g.length&&(g[j]=S)):d.height===y.height?(y.x+=d.width+s,y.width-=d.width+s):d.width===y.width?(y.y+=d.height+s,y.height-=d.height+s):(g.push(new ue(y.x+(d.width+s),y.y,y.width-(d.width+s),d.height)),y.y+=d.height+s,y.height-=d.height+s);break}}const v=ue.Common(Object.values(l)),C=_.Sub(h.center,v.center);let T;const I=[];for(let k=0;k<r.length;k++){c=r[k],d=o[c.id],T=l[c.id];const j=_.Sub(T.point,d.point).add(C),D=this.getShapeParentTransform(c);D&&j.rot(-D.rotation());const R={id:c.id,type:c.type,x:c.x+j.x,y:c.y+j.y},A=(P=(E=this.getShapeUtil(c)).onTranslateStart)==null?void 0:P.call(E,{...c,...R});A?I.push({...R,...A}):I.push(R)}return I.length&&this.updateShapes(I),this}alignShapes(t,s){const i=typeof t[0]=="string"?t:t.map(d=>d.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const r=Ne(i.map(d=>this.getShape(d))),o=Object.fromEntries(r.map(d=>[d.id,this.getShapePageBounds(d)])),l=ue.Common(Ne(Object.values(o))),c=[];return r.forEach(d=>{const u=o[d.id];if(!u)return;const h={x:0,y:0};switch(s){case"top":{h.y=l.minY-u.minY;break}case"center-vertical":{h.y=l.midY-u.minY-u.height/2;break}case"bottom":{h.y=l.maxY-u.minY-u.height;break}case"left":{h.x=l.minX-u.minX;break}case"center-horizontal":{h.x=l.midX-u.minX-u.width/2;break}case"right":{h.x=l.maxX-u.minX-u.width;break}}const p=this.getShapeParent(d),f=p?_.Rot(h,-this.getShapePageTransform(p).decompose().rotation):h;c.push(this.getChangesToTranslateShape(d,_.Add(d,f)))}),this.updateShapes(c),this}distributeShapes(t,s){const i=typeof t[0]=="string"?t:t.map(v=>v.id);if(this.getInstanceState().isReadonly)return this;if(i.length<3)return this;const r=i.length,o=Ne(i.map(v=>this.getShape(v))),l=Object.fromEntries(o.map(v=>[v.id,this.getShapePageBounds(v)]));let c,d,u,h,p;s==="horizontal"?(c="x",d="minX",u="maxX",h="midX",p="width"):(c="y",d="minY",u="maxY",h="midY",p="height");const f=[],g=o.sort((v,C)=>l[v.id][d]-l[C.id][d])[0],m=o.sort((v,C)=>l[C.id][u]-l[v.id][u])[0],x=l[g.id][h],y=(l[m.id][h]-x)/(r-1),S=x+y;return o.filter(v=>v!==g&&v!==m).sort((v,C)=>l[v.id][h]-l[C.id][h]).forEach((v,C)=>{const T={x:0,y:0};T[c]=S+y*C-l[v.id][p]/2-l[v.id][c];const I=this.getShapeParent(v),E=I?_.Rot(T,-this.getShapePageTransform(I).rotation()):T;f.push(this.getChangesToTranslateShape(v,_.Add(v,E)))}),this.updateShapes(f),this}stretchShapes(t,s){const i=typeof t[0]=="string"?t:t.map(d=>d.id);if(this.getInstanceState().isReadonly)return this;if(i.length<2)return this;const r=Ne(i.map(d=>this.getShape(d))),o=Object.fromEntries(i.map(d=>[d,this.getShapeGeometry(d).bounds])),l=Object.fromEntries(i.map(d=>[d,this.getShapePageBounds(d)])),c=ue.Common(Ne(Object.values(l)));switch(s){case"vertical":{this.run(()=>{for(const d of r){if(this.getShapePageTransform(d).rotation()%et)continue;const h=o[d.id],p=l[d.id],f=new _(0,c.minY-p.minY),g=this.getShapeParentTransform(d);g&&f.rot(-g.rotation());const{x:m,y:x}=_.Add(f,d);this.updateShapes([{id:d.id,type:d.type,x:m,y:x}]);const y=new _(1,c.height/p.height);this.resizeShape(d.id,y,{initialBounds:h,scaleOrigin:new _(p.center.x,c.minY),isAspectRatioLocked:this.getShapeUtil(d).isAspectRatioLocked(d),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const d of r){const u=o[d.id],h=l[d.id];if(this.getShapePageTransform(d).rotation()%et)continue;const f=new _(c.minX-h.minX,0),g=this.getShapeParentTransform(d);g&&f.rot(-g.rotation());const{x:m,y:x}=_.Add(f,d);this.updateShapes([{id:d.id,type:d.type,x:m,y:x}]);const y=new _(c.width/h.width,1);this.resizeShape(d.id,y,{initialBounds:u,scaleOrigin:new _(c.minX,h.center.y),isAspectRatioLocked:this.getShapeUtil(d).isAspectRatioLocked(d),scaleAxisRotation:0})}});break}}return this}resizeShape(t,s,i={}){var g,m,x;const r=typeof t=="string"?t:t.id;if(this.getInstanceState().isReadonly)return this;Number.isFinite(s.x)||(s=new _(1,s.y)),Number.isFinite(s.y)||(s=new _(s.x,1));const o=i.initialShape??this.getShape(r);if(!o)return this;const l=i.scaleOrigin??((g=this.getShapePageBounds(r))==null?void 0:g.center);if(!l)return this;const c=i.initialPageTransform?ve.Cast(i.initialPageTransform):this.getShapePageTransform(r);if(!c)return this;const d=c.rotation();if(d==null)return this;const u=i.scaleAxisRotation??d,h=i.initialBounds??this.getShapeGeometry(r).bounds;if(!h)return this;const p=i.isAspectRatioLocked??this.getShapeUtil(o).isAspectRatioLocked(o);if(!_L(d,u))return this._resizeUnalignedShape(r,s,{...i,initialBounds:h,scaleOrigin:l,scaleAxisRotation:u,initialPageTransform:c,isAspectRatioLocked:p,initialShape:o});const f=this.getShapeUtil(o);if(p&&(Math.abs(s.x)>Math.abs(s.y)?s=new _(s.x,Math.sign(s.y)*Math.abs(s.x)):s=new _(Math.sign(s.x)*Math.abs(s.y),s.y)),f.onResize&&f.canResize(o)){const y=this._scalePagePoint(ve.applyToPoint(c,new _(0,0)),l,s,u),S=this.getPointInParentSpace(o.id,y),v=new _(s.x,s.y),C=wa((d-u)%Math.PI,0);v.x=C?s.x:s.y,v.y=C?s.y:s.x;const T=ve.applyToPoint(c,new _),{x:I,y:E}=this.getPointInParentSpace(o.id,T);let P=o;i.skipStartAndEndCallbacks||(P=or(o,((m=f.onResizeStart)==null?void 0:m.call(f,o))??void 0)),P=or(P,{id:r,type:o.type,x:S.x,y:S.y,...f.onResize({...o,x:I,y:E},{newPoint:S,handle:i.dragHandle??"bottom_right",mode:i.mode??"scale_shape",scaleX:v.x,scaleY:v.y,initialBounds:h,initialShape:o})}),i.skipStartAndEndCallbacks||(P=or(P,((x=f.onResizeEnd)==null?void 0:x.call(f,o,P))??void 0)),this.updateShapes([P])}else{const y=ve.applyToPoint(c,h.center),S=this._scalePagePoint(y,l,s,u),v=this.getPointInParentSpace(o.id,y),C=this.getPointInParentSpace(o.id,S),T=_.Sub(C,v);this.updateShapes([{id:r,type:o.type,x:o.x+T.x,y:o.y+T.y}])}return this}_scalePagePoint(t,s,i,r){const o=_.RotWith(t,s,-r).sub(s),l=_.MulV(o,i);return _.Add(l,s).rotWith(s,r)}_resizeUnalignedShape(t,s,i){const{type:r}=i.initialShape,o=new _(s.x,s.y);if(Math.abs(s.x)>Math.abs(s.y)?o.x=Math.sign(s.x)*Math.abs(s.y):o.y=Math.sign(s.y)*Math.abs(s.x),this.resizeShape(t,o,{initialShape:i.initialShape,initialBounds:i.initialBounds,isAspectRatioLocked:i.isAspectRatioLocked}),Math.sign(s.x)*Math.sign(s.y)<0){let{rotation:y}=ve.Decompose(i.initialPageTransform);y-=2*y,this.updateShapes([{id:t,type:r,rotation:y}])}const l=ve.applyToPoint(i.initialPageTransform,i.initialBounds.center),c=this._scalePagePoint(l,i.scaleOrigin,s,i.scaleAxisRotation),d=this.getShapePageBounds(t),u=this.getShapePageTransform(t),h=d.center,p=u.point();if(!h||!p)return this;const f=_.Sub(c,h),g=_.Add(p,f),{x:m,y:x}=this.getPointInParentSpace(t,g);return this.updateShapes([{id:t,type:r,x:m,y:x}]),this}getInitialMetaForShape(t){return{}}createShape(t){return this.createShapes([t]),this}createShapes(t){if(!Array.isArray(t))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getInstanceState().isReadonly)return this;if(t.length<=0)return this;const s=this.getCurrentPageShapeIds();if(t.length+s.size>this.options.maxShapesPerPage)return eg(this),this;const r=this.getFocusedGroupId();return this.run(()=>{var h,p;const o=this.getCurrentPageShapesSorted(),l=t.map(f=>{if(f.id||(f={id:st(),...f}),!f.parentId||!(this.store.has(f.parentId)||t.some(g=>g.id===f.parentId))){let g=this.getFocusedGroupId();for(let x=o.length-1;x>=0;x--){const y=o[x];if(this.getShapeUtil(y).canReceiveNewChildrenOfType(y,f.type)&&this.isPointInShape(y,{x:f.x??0,y:f.y??0},{margin:0,hitInside:!0})){g=y.id;break}}const m=f.parentId;if(g===f.id&&(g=r),g!==m&&(f={...f},f.parentId=g,Ss(g))){const x=this.getPointInShapeSpace(this.getShape(g),{x:f.x??0,y:f.y??0});f.x=x.x,f.y=x.y,f.rotation=-this.getShapePageTransform(g).rotation()+(f.rotation??0)}}return f}),c=new Map,d=[],{opacityForNextShape:u}=this.getInstanceState();for(const f of l){const g=this.getShapeUtil(f);let m=f.index;if(!m){const v=f.parentId??r;c.has(v)||c.set(v,this.getHighestIndexForParent(v)),m=c.get(v),c.set(v,Li(m))}const x=g.getDefaultProps();for(const[v,C]of this.styleProps[f.type])x[C]=this.getStyleForNextShape(v);let y=this.store.schema.types.shape.create({...f,index:m,opacity:f.opacity??u,parentId:f.parentId??r,props:"props"in f?{...x,...f.props}:x});if(y.index===void 0)throw Error("no index!");const S=(p=(h=this.getShapeUtil(y)).onBeforeCreate)==null?void 0:p.call(h,y);S&&(y=S),d.push(y)}d.forEach(f=>{f.meta={...this.getInitialMetaForShape(f),...f.meta}}),this.store.put(d)}),this}animateShape(t,s={animation:ow}){return this.animateShapes([t],s)}animateShapes(t,s={animation:ow}){if(!s.animation)return this;const{duration:i=500,easing:r=ln.linear}=s.animation,o=Rt();let l=i,c;const d=[];let u,h;for(let f=0,g=t.length;f<g;f++){if(u=t[f],!u)continue;const m=this.getShape(u.id);m&&(h={start:ft(m),end:or(ft(m),u)},d.push(h),this.animatingShapes.set(m.id,o))}const p=f=>{var y,S;if(l-=f,l<0){const{animatingShapes:v}=this,C=t.filter(T=>T&&v.get(T.id)===o);C.length&&this.updateShapes(C),this.off("tick",p);return}c=r(1-l/i);const{animatingShapes:g}=this,m=[];let x;for(let v=0,C=d.length;v<C;v++){const{start:T,end:I}=d[v];x=g.get(T.id),x===o&&m.push({...I,x:T.x+(I.x-T.x)*c,y:T.y+(I.y-T.y)*c,opacity:T.opacity+(I.opacity-T.opacity)*c,rotation:T.rotation+(I.rotation-T.rotation)*c,props:((S=(y=this.getShapeUtil(I)).getInterpolatedProps)==null?void 0:S.call(y,T,I,c))??I.props})}this._updateShapes(m)};return this.on("tick",p),this}groupShapes(t,s={}){var m;const{groupId:i=st(),select:r=!0}=s;if(!Array.isArray(t))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getInstanceState().isReadonly)return this;const o=typeof t[0]=="string"?t:t.map(x=>x.id);if(o.length<=1)return this;const l=Ne((this._shouldIgnoreShapeLock?o:this._getUnlockedShapeIds(o)).map(x=>this.getShape(x))),c=l.sort(Hn).map(x=>x.id),d=ue.Common(Ne(l.map(x=>this.getShapePageBounds(x)))),{x:u,y:h}=d.point,p=this.findCommonAncestor(l)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const f=l.filter(x=>x.parentId===p).sort(Hn),g=(m=f[f.length-1])==null?void 0:m.index;return this.run(()=>{this.createShapes([{id:i,type:"group",parentId:p,index:g,x:u,y:h,opacity:1,props:{}}]),this.reparentShapes(c,i),r&&this.select(i)}),this}ungroupShapes(t,s={}){if(this.getInstanceState().isReadonly)return this;const{select:i=!0}=s,r=typeof t[0]=="string"?t:t.map(d=>d.id),o=Ne((this._shouldIgnoreShapeLock?r:this._getUnlockedShapeIds(r)).map(d=>this.getShape(d)));if(o.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const l=new Set,c=[];return o.forEach(d=>{this.isShapeOfType(d,"group")?c.push(d):l.add(d.id)}),c.length===0?this:(this.run(()=>{let d;for(let u=0,h=c.length;u<h;u++){d=c[u];const p=this.getSortedChildIdsForParent(d.id);for(let f=0,g=p.length;f<g;f++)l.add(p[f]);this.reparentShapes(p,d.parentId,d.index)}this.deleteShapes(c.map(u=>u.id)),i&&this.select(...l)}),this)}updateShape(t){return this.updateShapes([t]),this}updateShapes(t){const s=Array(t.length);for(let i=0,r=t.length;i<r;i++){const o=t[i];if(!o)continue;const l=this.getShape(o.id);if(l){if(!this._shouldIgnoreShapeLock){if(l.isLocked){if(!(Object.hasOwn(o,"isLocked")&&!o.isLocked))continue}else if(this.isShapeOrAncestorLocked(l))continue}this.animatingShapes.delete(o.id),s.push(o)}}return this._updateShapes(s),this}_getUnlockedShapeIds(t){return t.filter(s=>{var i;return!((i=this.getShape(s))!=null&&i.isLocked)})}deleteShapes(t){if(this.getInstanceState().isReadonly)return this;if(!Array.isArray(t))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const s=typeof t[0]=="string"?t:t.map(o=>o.id),i=this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s);if(i.length===0)return this;const r=new Set(i);for(const o of i)this.visitDescendants(o,l=>{r.add(l)});return this.run(()=>this.store.remove([...r]))}deleteShape(t){return this.deleteShapes([typeof t=="string"?t:t.id]),this}_extractSharedStyles(t,s){if(this.isShapeOfType(t,"group")){const i=this._parentIdsToChildIds.get()[t.id];if(!i)return;for(let r=0,o=i.length;r<o;r++)this._extractSharedStyles(this.getShape(i[r]),s)}else for(const[i,r]of this.styleProps[t.type])s.applyValue(i,Ts(t.props,r))}_getSelectionSharedStyles(){const t=this.getSelectedShapes(),s=new e_;for(const i of t)this._extractSharedStyles(i,s);return s}getStyleForNextShape(t){const s=this.getInstanceState().stylesForNextShape[t.id];return s===void 0?t.defaultValue:s}getShapeStyleIfExists(t,s){const i=this.styleProps[t.type].get(s);if(i!==void 0)return Ts(t.props,i)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const t=this.root.getCurrent(),s=new e_;if(!t)return s;if(t.shapeType)for(const i of this.styleProps[t.shapeType].keys())s.applyValue(i,this.getStyleForNextShape(i));return s}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const t=[],s=r=>{const o=this.getShape(r);if(o)if(this.isShapeOfType(o,"group"))for(const l of this.getSortedChildIdsForParent(o.id))s(l);else t.push(o)};for(const r of this.getSelectedShapeIds())s(r);let i=null;for(const r of t)if(i===null)i=r.opacity;else if(i!==r.opacity)return{type:"mixed"};if(i!==null)return{type:"shared",value:i}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(t,s){return this.updateInstanceState({opacityForNextShape:t},s),this}setOpacityForSelectedShapes(t){const s=this.getSelectedShapes();if(s.length>0){const i=[],r=o=>{if(this.isShapeOfType(o,"group")){const l=this.getSortedChildIdsForParent(o);for(const c of l)r(this.getShape(c))}else i.push(o)};for(const o of s)r(o);this.updateShapes(i.map(o=>({id:o.id,type:o.type,opacity:t})))}return this}setStyleForNextShapes(t,s,i){const r=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...r,[t.id]:s}},i),this}setStyleForSelectedShapes(t,s){const i=this.getSelectedShapes();if(i.length>0){const r=[],o=l=>{if(this.isShapeOfType(l,"group")){const c=this.getSortedChildIdsForParent(l.id);for(const d of c)o(this.getShape(d))}else{const c=this.getShapeUtil(l),d=this.styleProps[l.type].get(t);if(d){const u={id:l.id,type:l.type,props:{[d]:s}};r.push({util:c,originalShape:l,updatePartial:u})}}};for(const l of i)o(l);this.updateShapes(r.map(({updatePartial:l})=>l))}return this}registerExternalAssetHandler(t,s){return this.externalAssetContentHandlers[t]=s,this}async getAssetForExternalContent(t){var s,i;return await((i=(s=this.externalAssetContentHandlers)[t.type])==null?void 0:i.call(s,t))}hasExternalAssetHandler(t){return!!this.externalAssetContentHandlers[t]}registerExternalContentHandler(t,s){return this.externalContentHandlers[t]=s,this}async putExternalContent(t){var s,i;return(i=(s=this.externalContentHandlers)[t.type])==null?void 0:i.call(s,t)}getContentFromCurrentPage(t){const s=typeof t[0]=="string"?t:t.map(r=>r.id);if(!s||s.length===0)return;const i=this.getShapeAndDescendantIds(s);return wA(this,i,r=>{const o=[];for(const h of r){const p=this.getBinding(h);p&&o.push(p)}const l=[],c=[];for(const h of i){const p=this.getShape(h);if(!p)continue;if(!i.has(p.parentId)){const g=this.getShapePageTransform(p.id),m=g.point();c.push({...p,x:m.x,y:m.y,rotation:g.rotation(),parentId:this.getCurrentPageId()}),l.push(p.id)}else c.push(p)}const d=[],u=new Set;for(const h of c){if(!("assetId"in h.props))continue;const p=h.props.assetId;if(!p||u.has(p))continue;u.add(p);const f=this.getAsset(p);f&&d.push(f)}return{schema:this.store.schema.serialize(),shapes:c,rootShapeIds:l,bindings:o,assets:d}})}async resolveAssetsInContent(t){if(!t)return;const s=[];return await Promise.allSettled(t.assets.map(async i=>{var r,o;if((i.type==="image"||i.type==="video")&&!((r=i.props.src)!=null&&r.startsWith("data:image"))&&!((o=i.props.src)!=null&&o.startsWith("http"))){const l=ft(i),c=await this.store.props.assets.resolve(i,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});l.props.src=await wl.blobToDataUrl(await Ar(c).then(d=>d.blob())),s.push(l)}else s.push(i)})),t.assets=s,t}putContentOntoCurrentPage(t,s={}){var D,R;if(this.getInstanceState().isReadonly)return this;if(!t.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:i=!1,preserveIds:r=!1,preservePosition:o=!1}=s;let{point:l=void 0}=s;const c=this.getCurrentPageId(),{rootShapeIds:d}=t,u=[],h=[],p=[],f={store:{...Object.fromEntries(t.assets.map(A=>[A.id,A])),...Object.fromEntries(t.shapes.map(A=>[A.id,A])),...Object.fromEntries(((D=t.bindings)==null?void 0:D.map(A=>[A.id,A]))??[])},schema:t.schema},g=this.store.schema.migrateStoreSnapshot(f);if(g.type==="error")throw Error("Could not put content: could not migrate content");for(const A of Object.values(g.value))switch(A.typeName){case"asset":{u.push(A);break}case"shape":{h.push(A);break}case"binding":{p.push(A);break}}const m=new Map(r?h.map(A=>[A.id,A.id]):h.map(A=>[A.id,st()])),x=new Map(r?p.map(A=>[A.id,A.id]):p.map(A=>[A.id,bl()]));let y=this.getCurrentPageId(),S=1/0,v=[];for(const A of this.getSelectedShapes()){if(S===0)break;const N=this.isShapeOfType(A,"frame"),B=this.getShapeAncestors(A);N&&B.push(A);const L=N?B.length+1:B.length;if(L<S)S=L,v=B,y=N?A.id:A.parentId;else if(L===S){if(v.length!==B.length)throw Error(`Ancestors: ${v.length} !== ${B.length}`);if(v.length===0){y=c;break}else{y=c;for(let O=0;O<v.length&&B[O]===v[O];O++)y=B[O].id}}}let C=!1;if(!vs(y)){const A=this.getShape(y);if(A){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(A)))y=c;else if(d.length===1){const N=h.find(B=>B.id===d[0]);this.isShapeOfType(A,"frame")&&this.isShapeOfType(N,"frame")&&N.props.w===(A==null?void 0:A.props.w)&&N.props.h===(A==null?void 0:A.props.h)&&(C=!0)}}else y=c}C||(C=m.has(y)),C&&(y=this.getShape(y).parentId);let T=this.getHighestIndexForParent(y);const I=[],E=h.map(A=>{const N=m.get(A.id),B={...A,id:N};return d.includes(A.id)&&(B.parentId=c,I.push(B)),m.has(B.parentId)?B.parentId=m.get(A.parentId):(d.push(B.id),B.index=T,T=Li(T)),B});if(E.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return eg(this),this;const P=p.map(A=>({...A,id:pi(x.get(A.id)),fromId:pi(m.get(A.fromId)),toId:pi(m.get(A.toId))})),k=[],j=[];for(const A of u)this.store.has(A.id)||((A.type==="image"||A.type==="video")&&((R=A.props.src)!=null&&R.startsWith("data:image"))&&(j.push(ft(A)),A.props.src=null),k.push(A));return Promise.allSettled(j.map(async A=>{const N=await Qte(A.props.src,A.props.name,A.props.mimeType??"image/png"),B=await this.getAssetForExternalContent({type:"file",file:N});if(!B){this.deleteAssets([A.id]);return}this.updateAssets([{...B,id:A.id}])})),this.run(()=>{k.length>0&&this.createAssets(k),this.createShapes(E),this.createBindings(P),i&&this.select(...I.map(O=>O.id)),y!==c&&this.reparentShapes(I.map(O=>O.id),y);const A=E.map(O=>this.getShape(O.id)),N=ue.Common(A.map(O=>this.getShapePageBounds(O)));if(l===void 0)if(vs(y)){const O=this.getViewportPageBounds();o||O.includes(ue.From(N))?l=N.center:l=O.center}else{const O=this.getShape(y);l=ve.applyToPoint(this.getShapePageTransform(O),this.getShapeGeometry(O).bounds.center)}if(I.length===1){const O=I[0];if(this.isShapeOfType(O,"frame"))for(;this.getShapesAtPoint(l).some(F=>this.isShapeOfType(F,"frame")&&F.props.w===O.props.w&&F.props.h===O.props.h);)l.x+=N.w+16}const B=ue.Common(Ne(I.map(({id:O})=>this.getShapePageBounds(O)))).center,L=_.Sub(l,B);this.updateShapes(I.map(({id:O})=>{const F=this.getShape(O),W=this.getShapeParentTransform(O).decompose().rotation,$=_.Rot(L,-W);return{id:F.id,type:F.type,x:F.x+$.x,y:F.y+$.y}}))}),this}async getSvgElement(t,s={}){const i=await hne(this,t,s);if(!i)return;const r=document.createDocumentFragment(),o=ZC(r);kr.flushSync(()=>{o.render(i.jsx)});const l=r.firstElementChild;return mt(l instanceof SVGSVGElement,"Expected an SVG element"),o.unmount(),{svg:l,width:i.width,height:i.height}}async getSvgString(t,s={}){const i=await this.getSvgElement(t,s);return i?{svg:new XMLSerializer().serializeToString(i.svg),width:i.width,height:i.height}:void 0}async getSvg(t,s={}){const i=await this.getSvgElement(t,s);if(i)return i.svg}_updateInputsFromEvent(t){const{pointerVelocity:s,previousScreenPoint:i,previousPagePoint:r,currentScreenPoint:o,currentPagePoint:l}=this.inputs,{screenBounds:c}=this.store.unsafeGetWithoutCapture(ns),{x:d,y:u,z:h}=Wf(()=>this.getCamera()),p=t.point.x-c.x,f=t.point.y-c.y,g=t.point.z??.5;i.setTo(o),r.setTo(l),o.set(p,f);const m=p/h-d,x=f/h-u;isFinite(m)&&isFinite(x)&&l.set(m,x,g),this.inputs.isPen=t.type==="pointer"&&t.isPen,(t.name==="pointer_down"||this.inputs.isPinching)&&(s.set(0,0),this.inputs.originScreenPoint.setTo(o),this.inputs.originPagePoint.setTo(l)),this.run(()=>{var y;this.store.put([{id:Ey,typeName:"pointer",x:l.x,y:l.y,lastActivityTimestamp:t.type==="pointer"&&t.pointerId===Xk.CAMERA_MOVE?((y=this.store.unsafeGetWithoutCapture(Ey))==null?void 0:y.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:t=!0}={}){return this.getIsFocused()?this:(t&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:t=!0}={}){return this.getIsFocused()?(t?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getSnapshot(){return Hte(this.store)}loadSnapshot(t){return lF(this.store,t),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_flushEventsForTick(t){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const s=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const i of s)this._flushEventForTick(i)}t>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:t}),this.scribbles.tick(t)})}maybeTrackPerformance(t){Gt.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(t),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}ge([Q],le.prototype,"getCanUndo");ge([Q],le.prototype,"getCanRedo");ge([Q],le.prototype,"getPath");ge([Q],le.prototype,"getCurrentTool");ge([Q],le.prototype,"getCurrentToolId");ge([Q],le.prototype,"getDocumentSettings");ge([Q],le.prototype,"getInstanceState");ge([Q],le.prototype,"getOpenMenus");ge([Q],le.prototype,"getIsMenuOpen");ge([Q],le.prototype,"getPageStates");ge([Q],le.prototype,"_getPageStatesQuery");ge([Q],le.prototype,"getCurrentPageState");ge([Q],le.prototype,"_getCurrentPageStateId");ge([Q],le.prototype,"getSelectedShapeIds");ge([Q],le.prototype,"getSelectedShapes");ge([Q],le.prototype,"getOnlySelectedShapeId");ge([Q],le.prototype,"getOnlySelectedShape");ge([Q],le.prototype,"getSelectionPageBounds");ge([Q],le.prototype,"getSelectionRotation");ge([Q],le.prototype,"getSelectionRotatedPageBounds");ge([Q],le.prototype,"getSelectionRotatedScreenBounds");ge([Q],le.prototype,"getFocusedGroupId");ge([Q],le.prototype,"getFocusedGroup");ge([Q],le.prototype,"getEditingShapeId");ge([Q],le.prototype,"getEditingShape");ge([Q],le.prototype,"getHoveredShapeId");ge([Q],le.prototype,"getHoveredShape");ge([Q],le.prototype,"getHintingShapeIds");ge([Q],le.prototype,"getHintingShape");ge([Q],le.prototype,"getErasingShapeIds");ge([Q],le.prototype,"getErasingShapes");ge([Q],le.prototype,"_unsafe_getCameraId");ge([Q],le.prototype,"getCamera");ge([Q],le.prototype,"getViewportPageBoundsForFollowing");ge([Q],le.prototype,"getCameraForFollowing");ge([Q],le.prototype,"getZoomLevel");ge([Q],le.prototype,"getViewportScreenBounds");ge([Q],le.prototype,"getViewportScreenCenter");ge([Q],le.prototype,"getViewportPageBounds");ge([Q],le.prototype,"_getCollaboratorsQuery");ge([Q],le.prototype,"getCollaborators");ge([Q],le.prototype,"getCollaboratorsOnCurrentPage");ge([Q],le.prototype,"getRenderingShapes");ge([Q],le.prototype,"_getAllPagesQuery");ge([Q],le.prototype,"getPages");ge([Q],le.prototype,"getCurrentPageId");ge([Q],le.prototype,"getCurrentPageShapeIdsSorted");ge([Q],le.prototype,"_getAllAssetsQuery");ge([Q],le.prototype,"_getShapeGeometryCache");ge([Q],le.prototype,"_getShapeHandlesCache");ge([Q],le.prototype,"_getShapePageTransformCache");ge([Q],le.prototype,"_getShapePageBoundsCache");ge([Q],le.prototype,"_getShapeClipPathCache");ge([Q],le.prototype,"_getShapeMaskCache");ge([Q],le.prototype,"_getShapeMaskedPageBoundsCache");ge([Q],le.prototype,"_notVisibleShapes");ge([Q],le.prototype,"getCulledShapes");ge([Q],le.prototype,"getCurrentPageBounds");ge([Q],le.prototype,"getCurrentPageShapes");ge([Q],le.prototype,"getCurrentPageShapesSorted");ge([Q],le.prototype,"getCurrentPageRenderingShapesSorted");ge([Q],le.prototype,"_getBindingsIndexCache");ge([Q],le.prototype,"_getSelectionSharedStyles");ge([Q({isEqual:(n,e)=>n.equals(e)})],le.prototype,"getSharedStyles");ge([Q],le.prototype,"getSharedOpacity");ge([Q],le.prototype,"getIsFocused");function eg(n,e=n.getCurrentPageId()){const t=n.getPage(e).name;n.emit("max-shapes",{name:t,pageId:e,count:n.options.maxShapesPerPage})}function or(n,e){if(!e)return n;let t=null;const s=Object.entries(e);for(let i=0,r=s.length;i<r;i++){const[o,l]=s[i];if(l!==void 0&&!(o==="id"||o==="type"||o==="typeName")&&l!==n[o]){if(t||(t={...n}),o==="props"||o==="meta"){t[o]={...n[o]};for(const[c,d]of Object.entries(l))d!==void 0&&(t[o][c]=d);continue}t[o]=l}}return t||n}function yF(n,e,t){const s=n.getShape(e);if(!s)return;t.push(s);const i=n.getSortedChildIdsForParent(e);for(let r=0,o=i.length;r<o;r++)yF(n,i[r],t)}function wA(n,e,t){let s;if(n.run(()=>{const i=n.store.extractingChanges(()=>{const r=new Set,o=new Set;for(const l of e)if(n.getShape(l))for(const d of n.getBindingsInvolvingShape(l)){const u=e.has(d.fromId),h=e.has(d.toId);if(u&&h){r.add(d.id);continue}(!u||!h)&&o.add(d.id)}n.deleteBindings([...o],{isolateShapes:!0});try{s=xa.ok(t(r))}catch(l){s=xa.err(l)}});n.store.applyDiff(W0(i))},{history:"ignore"}),s.ok)return s.value;throw s.error}function bA(n,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:t,y:s}}=e.constraints,i=n.getViewportScreenBounds(),r=ue.From(e.constraints.bounds),o=(i.w-t*2)/r.w,l=(i.h-s*2)/r.h;return{zx:o,zy:l}}function Wp(){const n=G(),e=gF();return q("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??n.user.getIsDarkMode(),[e,n])}const _A="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",CA="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",tg='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Wo(n,e,t,s,i,r=16,o=16){const l=(-t-e)*(qe/180),c=Math.sin(l),d=Math.cos(l),u=1*d-1*c,h=1*c+1*d;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${h}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${s?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${r} ${o}, pointer`}const Gne=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],Vne={none:()=>"none","ew-resize":(n,e,t)=>Wo(CA,n,0,e,t),"ns-resize":(n,e,t)=>Wo(CA,n,90,e,t),"nesw-resize":(n,e,t)=>Wo(_A,n,0,e,t),"nwse-resize":(n,e,t)=>Wo(_A,n,90,e,t),"nwse-rotate":(n,e,t)=>Wo(tg,n,0,e,t),"nesw-rotate":(n,e,t)=>Wo(tg,n,90,e,t),"senw-rotate":(n,e,t)=>Wo(tg,n,180,e,t),"swne-rotate":(n,e,t)=>Wo(tg,n,270,e,t)};function Bs(n,e=0,t="black"){return Vne[n](vQ(e),!1,t)}function Kne(){const n=G(),e=fn(),t=Wp();Sa("useCursor",()=>{const{type:s,rotation:i}=n.getInstanceState().cursor;if(Gne.includes(s)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${s})`);return}e.style.setProperty("--tl-cursor",Bs(s,i,t?"white":"black"))},[n,e,t])}function Yne(){const n=G(),e=fn(),t=Wp(),s=q(Gt.forceSrgb);Oe.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),s?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,s,t])}function vF(n){const e=b.useRef();return b.useLayoutEffect(()=>{e.current=n}),b.useDebugValue(n),b.useCallback((...t)=>{const s=e.current;return mt(s,"fn does not exist"),s(...t)},[])}function Xne(){const[n,e]=b.useState(0);b.useEffect(()=>e(t=>t+1),[])}const qne=n=>n.props.src,Zne={upload:(n,e)=>wl.blobToDataUrl(e)};function Jne(n){return"schema"in n&&n.schema?n.schema:rQ({shapes:"shapeUtils"in n&&n.shapeUtils?EA(hF(n.shapeUtils)):void 0,bindings:"bindingUtils"in n&&n.bindingUtils?EA(cF(n.bindingUtils)):void 0,migrations:"migrations"in n?n.migrations:void 0})}function Ry({initialData:n,defaultName:e="",id:t,assets:s=Zne,onMount:i,collaboration:r,...o}={}){const l=Jne(o),c=new NE({id:t,schema:l,initialData:n,props:{defaultName:e,assets:{upload:s.upload,resolve:s.resolve??qne},onMount:d=>{mt(d instanceof le),i==null||i(d)},collaboration:r}});if(o.snapshot){if(n)throw new Error("Cannot provide both initialData and snapshot");lF(c,o.snapshot)}return c}function EA(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const Qne=(n,e)=>e.some(t=>n instanceof t);let TA,IA;function ese(){return TA||(TA=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function tse(){return IA||(IA=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const xF=new WeakMap,t_=new WeakMap,SF=new WeakMap,hw=new WeakMap,QE=new WeakMap;function nse(n){const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(uo(n.result)),i()},o=()=>{s(n.error),i()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&xF.set(t,n)}).catch(()=>{}),QE.set(e,n),e}function sse(n){if(t_.has(n))return;const e=new Promise((t,s)=>{const i=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),i()},o=()=>{s(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});t_.set(n,e)}let n_={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return t_.get(n);if(e==="objectStoreNames")return n.objectStoreNames||SF.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return uo(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function ise(n){n_=n(n_)}function rse(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=n.call(pw(this),e,...t);return SF.set(s,e.sort?e.sort():[e]),uo(s)}:tse().includes(n)?function(...e){return n.apply(pw(this),e),uo(xF.get(this))}:function(...e){return uo(n.apply(pw(this),e))}}function ose(n){return typeof n=="function"?rse(n):(n instanceof IDBTransaction&&sse(n),Qne(n,ese())?new Proxy(n,n_):n)}function uo(n){if(n instanceof IDBRequest)return nse(n);if(hw.has(n))return hw.get(n);const e=ose(n);return e!==n&&(hw.set(n,e),QE.set(e,n)),e}const pw=n=>QE.get(n);function e1(n,e,{blocked:t,upgrade:s,blocking:i,terminated:r}={}){const o=indexedDB.open(n,e),l=uo(o);return s&&o.addEventListener("upgradeneeded",c=>{s(uo(o.result),c.oldVersion,c.newVersion,uo(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),l.then(c=>{r&&c.addEventListener("close",()=>r()),i&&c.addEventListener("versionchange",d=>i(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}function wF(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",s=>e(s.oldVersion,s)),uo(t).then(()=>{})}const ase=["get","getKey","getAll","getAllKeys","count"],lse=["put","add","delete","clear"],fw=new Map;function PA(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(fw.get(e))return fw.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,i=lse.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(i||ase.includes(t)))return;const r=async function(o,...l){const c=this.transaction(o,i?"readwrite":"readonly");let d=c.store;return s&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),i&&c.done]))[0]};return fw.set(e,r),r}ise(n=>({...n,get:(e,t,s)=>PA(e,t)||n.get(e,t,s),has:(e,t)=>!!PA(e,t)||n.has(e,t)}));const cse="TLDRAW_DOCUMENT_v2",dse="TLDRAW_ASSET_STORE_v1",bF="TLDRAW_DB_NAME_INDEX_v2",Be={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function _F(n){const e=cse+n;return hse(e),await e1(e,4,{upgrade(t){t.objectStoreNames.contains(Be.Records)||t.createObjectStore(Be.Records),t.objectStoreNames.contains(Be.Schema)||t.createObjectStore(Be.Schema),t.objectStoreNames.contains(Be.SessionState)||t.createObjectStore(Be.SessionState),t.objectStoreNames.contains(Be.Assets)||t.createObjectStore(Be.Assets)}})}async function use(n){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(p=>p.name):t1(),t=dse+n;if(!e.find(p=>p===t))return;const i=await e1(t,1,{upgrade(p){p.objectStoreNames.contains("assets")||p.createObjectStore("assets")}}),r=i.transaction(["assets"],"readonly"),o=r.objectStore("assets"),l=await o.getAllKeys(),c=await Promise.all(l.map(async p=>[p,await o.get(p)]));await r.done;const d=await _F(n),u=d.transaction([Be.Assets],"readwrite"),h=u.objectStore(Be.Assets);for(const[p,f]of c)h.put(f,p);await u.done,i.close(),d.close(),await wF(t)}const Mh=class Mh{constructor(e){w(this,"getDbPromise");w(this,"isClosed",!1);w(this,"pendingTransactionSet",new Set);Mh.connectedInstances.add(this),this.getDbPromise=(async()=>(await use(e),await _F(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(Qh)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),Mh.connectedInstances.delete(this))}tx(e,t,s){const i=(async()=>{mt(!this.isClosed,"db is closed");const o=(await this.getDb()).transaction(t,e),l=o.done.catch(c=>{if(!this.isClosed)throw c});try{return await s(o)}finally{this.isClosed?o.abort():await l}})();return this.pendingTransactionSet.add(i),i.finally(()=>this.pendingTransactionSet.delete(i)),i}async load({sessionId:e}={}){return await this.tx("readonly",[Be.Records,Be.Schema,Be.SessionState],async t=>{var c,d;const s=t.objectStore(Be.Records),i=t.objectStore(Be.Schema),r=t.objectStore(Be.SessionState);let o=e?(c=await r.get(e))==null?void 0:c.snapshot:null;return o||(o=(d=(await r.getAll()).sort((h,p)=>h.updatedAt-p.updatedAt).pop())==null?void 0:d.snapshot),{records:await s.getAll(),schema:await i.get(Be.Schema),sessionStateSnapshot:o}})}async storeChanges({schema:e,changes:t,sessionId:s,sessionStateSnapshot:i}){await this.tx("readwrite",[Be.Records,Be.Schema,Be.SessionState],async r=>{const o=r.objectStore(Be.Records),l=r.objectStore(Be.Schema),c=r.objectStore(Be.SessionState);for(const[d,u]of Object.entries(t.added))await o.put(u,d);for(const[d,u]of Object.values(t.updated))await o.put(u,u.id);for(const d of Object.keys(t.removed))await o.delete(d);l.put(e.serialize(),Be.Schema),i&&s?c.put({snapshot:i,updatedAt:Date.now(),id:s},s):(i||s)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:s,sessionStateSnapshot:i}){await this.tx("readwrite",[Be.Records,Be.Schema,Be.SessionState],async r=>{const o=r.objectStore(Be.Records),l=r.objectStore(Be.Schema),c=r.objectStore(Be.SessionState);await o.clear();for(const[d,u]of Object.entries(t))await o.put(u,d);l.put(e.serialize(),Be.Schema),i&&s?c.put({snapshot:i,updatedAt:Date.now(),id:s},s):(i||s)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Be.SessionState],async e=>{const t=e.objectStore(Be.SessionState),s=(await t.getAll()).sort((r,o)=>r.updatedAt-o.updatedAt);if(s.length<10){await e.done;return}const i=s.slice(0,s.length-10);for(const{id:r}of i)await t.delete(r)})}async getAsset(e){return await this.tx("readonly",[Be.Assets],async t=>await t.objectStore(Be.Assets).get(e))}async storeAsset(e,t){await this.tx("readwrite",[Be.Assets],async s=>{await s.objectStore(Be.Assets).put(t,e)})}};w(Mh,"connectedInstances",new Set);let My=Mh;function t1(){const n=JSON.parse(IE(bF)||"[]")??[];return Array.isArray(n)?n:[]}function hse(n){const e=new Set(t1());e.add(n),PE(bF,JSON.stringify([...e]))}function pse(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
 If your hard disk is full, try clearing up some space and then reload the page.`)}function fse(){window.alert(`Oops! We could not access your browser's storageand the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const gse=350,mse=1e4,kA=Symbol("UPDATE_INSTANCE_STATE"),yse=n=>n;class vse{constructor(e){w(this,"onmessage")}postMessage(e){}close(){}}const xse=typeof BroadcastChannel>"u"?vse:BroadcastChannel;class Sse{constructor(e,{persistenceKey:t,sessionId:s=Ny,onLoad:i,onLoadError:r},o=new xse(`tldraw-tab-sync-${t}`)){w(this,"disposables",new Set);w(this,"diffQueue",[]);w(this,"didDispose",!1);w(this,"shouldDoFullDBWrite",!0);w(this,"isReloading",!1);w(this,"persistenceKey");w(this,"sessionId");w(this,"serializedSchema");w(this,"isDebugging",!1);w(this,"documentTypes");w(this,"$sessionStateSnapshot");w(this,"db");w(this,"initTime",Date.now());w(this,"isPersisting",!1);w(this,"didLastWriteError",!1);w(this,"scheduledPersistTimeout",null);this.store=e,this.channel=o,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=s,this.db=new My(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=oF(this.store),this.disposables.add(e.listen(({changes:l})=>{this.diffQueue.push(l),this.channel.postMessage(yse({type:"diff",storeId:this.store.id,changes:l,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(kA),this.schedulePersist()},{scope:"session"})),this.connect(i,r),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(l=>l.scope==="document").map(l=>l.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let s;try{s=await this.db.load({sessionId:this.sessionId})}catch(i){t(i),fse();return}if(this.debug("loaded data from store",s,"didDispose",this.didDispose),!this.didDispose)try{if(s){const i=Object.fromEntries(s.records.map(l=>[l.id,l])),r=s.sessionStateSnapshot??zte(i),o=this.store.schema.migrateStoreSnapshot({store:i,schema:s.schema??this.store.schema.serializeEarliestVersion()});if(o.type==="error"){console.error("failed to migrate store",o),t(new Error(`Failed to migrate store: ${o.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(o.value).filter(l=>this.documentTypes.has(l.typeName)),"initialize")}),r&&aF(this.store,r)}this.channel.onmessage=({data:i})=>{var l,c;this.debug("got message",i);const r=i,o=this.store.schema.getMigrationsSince(r.schema);if(o.ok){if(o.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(c=(l=window==null?void 0:window.location)==null?void 0:l.reload)==null||c.call(l);return}r.type==="diff"&&(this.debug("applying diff"),_r(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(r.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;t(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?mse:gse))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(mt(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=jE(e.filter(s=>s!==kA));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),pse(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function CF(n){const e=b.useRef(n),[t,s]=b.useState(n);t!==e.current&&s(e.current);const i=b.useCallback(r=>{typeof r=="function"?e.current=r(e.current):e.current=r,s(e.current)},[]);return[t,i]}function wse(n){const[e,t]=CF({status:"loading"});return n=tx(n),b.useEffect(()=>{const{persistenceKey:s,sessionId:i,...r}=n;if(!s){t({status:"not-synced",store:Ry(r)});return}t({status:"loading"});const o=new xo,l={upload:async(h,p)=>(await u.db.storeAsset(h.id,p),h.id),resolve:async h=>h.props.src?h.props.src.startsWith("asset:")?await o.get(h,async()=>{const p=await u.db.getAsset(h.id);return p?URL.createObjectURL(p):null}):h.props.src:null,...r.assets},c=Ry({...r,assets:l});let d=!1;const u=new Sse(c,{sessionId:i,persistenceKey:s,onLoad(){d||t({store:c,status:"synced-local"})},onLoadError(h){d||t({status:"error",error:h})}});return()=>{d=!0,u.close()}},[n,t]),e}function bse(){const n=G(),e=fn();b.useEffect(()=>{const t=r=>e.style.setProperty("--tl-zoom",r.toString()),s=dD(t,100),i=new Fd("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?t(n.getZoomLevel()):s(n.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach(),s.cancel()}},[n,e])}function s_(n){const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let s=0,i=n.length;s<i;s++)t[s]=n.charCodeAt(s);return e}function _se(n){const e=atob(n),t=s_(e);return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const Cse=5,nm={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4},Ese=Math.max(...Object.values(nm)),Yu={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},Tse=Object.keys(Yu).length,ng="sales@tldraw.com";class n1{constructor(e,t,s){w(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");w(this,"isDevelopment");w(this,"isTest");w(this,"isCryptoAvailable");w(this,"state",an("license state","pending"));this.isTest=!1,this.isDevelopment=this.getIsDevelopment(s),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,AE.enableLicensing.get()?this.getLicenseFromKey(e).then(i=>{const r=Ise(i);this.state.set(r?"unlicensed":"licensed")}):this.state.set("licensed")}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[t,s]=e.split("."),[i,r]=t.split("/");if(!i.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${i}'`);const o=await _se(this.publicKey);let l;try{l=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,new Uint8Array(s_(atob(s))),new Uint8Array(s_(atob(r))))}catch(d){throw console.error(d),new Error("Could not perform signature validation")}if(!l)throw new Error("Invalid signature");let c;try{c=JSON.parse(atob(r))}catch{throw new Error("Could not parse object")}return c.length>Tse&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:c[Yu.ID],hosts:c[Yu.HOSTS],flags:c[Yu.FLAGS],expiryDate:c[Yu.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately."),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{const s=await this.extractLicenseKey(t),i=new Date(s.expiryDate),r=this.isFlagEnabled(s.flags,nm.ANNUAL_LICENSE),o=this.isFlagEnabled(s.flags,nm.PERPETUAL_LICENSE),l={license:s,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(s),expiryDate:i,isAnnualLicense:r,isAnnualLicenseExpired:r&&this.isAnnualLicenseExpired(i),isPerpetualLicense:o,isPerpetualLicenseExpired:o&&this.isPerpetualLicenseExpired(i),isInternalLicense:this.isFlagEnabled(s.flags,nm.INTERNAL_LICENSE)};return this.outputLicenseInfoIfNeeded(l),l}catch(s){return this.outputInvalidLicenseKey(s.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const t=window.location.hostname.toLowerCase();return e.hosts.some(s=>{const i=s.toLowerCase().trim();return i===t||`www.${i}`===t||i===`www.${t}`||s==="*"?!0:s.includes("*")?new RegExp(s.replace(/\*/g,".*?")).test(t):!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+Cse+1)}isAnnualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),s=new Date>=t;return!s&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${ng} if you would like to renew your license.`]),s}isPerpetualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),s={major:new Date(Gk.major),minor:new Date(Gk.minor)};return s.major>=t||s.minor>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){this.outputMessages(["No tldraw license key provided!",`Please reach out to ${ng} if you would like to license tldraw or if you'd like a trial.`])}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${ng} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${ng} if you would like to use tldraw on other domains.`]),e.license.flags>=Ese*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest){this.outputDelimiter();for(const t of e)console.log(`%c${t}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}w(n1,"className","tl-watermark_SEE-LICENSE");function Ise(n){if(!n.isLicenseParseable||!n.isDomainValid&&!n.isDevelopment)return!0;if(n.isPerpetualLicenseExpired||n.isAnnualLicenseExpired){if(n.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const EF=b.createContext({}),Pse=()=>b.useContext(EF);function kse({licenseKey:n,children:e}){const[t]=b.useState(()=>new n1(n));return a.jsx(EF.Provider,{value:t,children:e})}const Ase='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',jse=`${la()}/watermarks/watermark-desktop.svg`,sg=`data:image/svg+xml;utf8,${encodeURIComponent(Ase)}`;let gw=null;async function Nse(n){return n?sg:(gw||(gw=Promise.race([(async()=>{try{const e=await Ar(jse);if(!e.ok)return sg;const t=await e.blob();return URL.createObjectURL(t)}catch{return sg}})(),new Promise(e=>{setTimeout(()=>{e(sg)},3e3)})])),gw)}const Rse=Oe.memo(function({forceLocal:e=!1}){const t=CL(),s=G(),i=Pse(),r=q("show watermark",()=>AE.enableLicensing.get()&&s.getViewportScreenBounds().width>760&&i.state.get()==="unlicensed",[s,i]),o=q("debug mode",()=>s.getInstanceState().isDebugMode,[s]),l=q("is menu open",()=>s.getIsMenuOpen(),[s]),[c,d]=b.useState(null),u=e||i.isDevelopment;if(b.useEffect(()=>{if(!r)return;let f=!1;return(async()=>{const g=await Nse(u);f||d(g)})(),()=>{f=!0}},[u,r]),!r||!c)return null;const h=n1.className,p=`url('${c}') center 100% / 100% no-repeat`;return a.jsxs(a.Fragment,{children:[a.jsx("style",{children:`
/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
users. By using this library, you agree to keep the watermark's behavior, 
keeping it visible, unobscured, and available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

.${h} {
	position: absolute;
	bottom: var(--space-2);
	right: var(--space-2);
	width: 96px;
	height: 32px;
	z-index: 2147483647 !important;
	pointer-events: ${l?"none":"all"};
	background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
	border-radius: 5px;
	padding: 2px;
	box-sizing: content-box;
}

.${h}[data-debug='true'] {
	bottom: 46px;
}

.${h} > a {
	position: absolute;
	width: 96px;
	height: 32px;
	pointer-events: none;
	cursor: inherit;
	color: var(--color-text);
	background-color: currentColor;
	opacity: .28;
}

@media (hover: hover) {
	.${h}:hover {
		background-color: var(--color-background);
		transition: background-color 0.2s ease-in-out;
		transition-delay: 0.32s;
	}
	.${h}:hover > a {
		animation: delayed_link 0.2s forwards ease-in-out;
		animation-delay: 0.32s;
	}
}

@keyframes delayed_link {
	0% {
		cursor: inherit;
		opacity: .38;
		pointer-events: none;
	}
	100% {
		cursor: pointer;
		opacity: 1;
		pointer-events: all;
	}
}
`}),a.jsx("div",{className:h,"data-debug":o,draggable:!1,...t,children:a.jsx("a",{href:"https://tldraw.dev",target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:un,style:{mask:p,WebkitMask:p}})})]})}),Mse=[],Ose=[],Dse=[],Lse="tl-container",Fse=b.memo(function({store:e,components:t,className:s,user:i,...r}){const[o,l]=Oe.useState(null),c=b.useMemo(()=>i??nF(),[i]),d=(t==null?void 0:t.ErrorFallback)===void 0?KL:t==null?void 0:t.ErrorFallback,u={...r,shapeUtils:r.shapeUtils??Mse,bindingUtils:r.bindingUtils??Ose,tools:r.tools??Dse,components:t};return a.jsx("div",{ref:l,"data-tldraw":xL,draggable:!1,className:Se(`${Lse} tl-theme__light`,s),onPointerDown:un,tabIndex:-1,children:a.jsx(ip,{fallback:d,onError:h=>EE(h,{tags:{origin:"react.tldraw-before-app"}}),children:o&&a.jsx(kse,{licenseKey:r.licenseKey,children:a.jsx(CQ,{container:o,children:a.jsx(Pte,{overrides:t,children:e?e instanceof NE?a.jsx(IF,{...u,store:e,user:c}):a.jsx(TF,{...u,store:e,user:c}):a.jsx(Bse,{...u,store:e,user:c})})})})})})});function Bse(n){const{defaultName:e,snapshot:t,initialData:s,shapeUtils:i,bindingUtils:r,persistenceKey:o,sessionId:l,user:c,assets:d}=n,u=wse({shapeUtils:i,bindingUtils:r,initialData:s,persistenceKey:o,sessionId:l,defaultName:e,snapshot:t,assets:d});return a.jsx(TF,{...n,store:u,user:c})}const TF=b.memo(function({store:e,user:t,...s}){const i=fn();b.useLayoutEffect(()=>{t.userPreferences.get().colorScheme==="dark"&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))},[i,t]);const{LoadingScreen:r}=kt();switch(e.status){case"error":throw e.error;case"loading":return r?a.jsx(r,{}):null}return a.jsx(IF,{...s,store:e.store,user:t})}),mw=()=>document.location.search.includes("tldraw_preserve_focus");function IF({onMount:n,children:e,store:t,tools:s,shapeUtils:i,bindingUtils:r,user:o,initialState:l,autoFocus:c=!0,inferDarkMode:d,cameraOptions:u,options:h,licenseKey:p}){const{ErrorFallback:f}=kt(),g=fn(),[m,x]=CF(null),y=b.useRef({autoFocus:c&&!mw(),inferDarkMode:d,initialState:l,cameraOptions:u});b.useLayoutEffect(()=>{y.current={autoFocus:c&&!mw(),inferDarkMode:d,initialState:l,cameraOptions:u}},[c,d,l,u]),b.useLayoutEffect(()=>{const{autoFocus:C,inferDarkMode:T,initialState:I,cameraOptions:E}=y.current,P=new le({store:t,shapeUtils:i,bindingUtils:r,tools:s,getContainer:()=>g,user:o,initialState:I,autoFocus:C,inferDarkMode:T,cameraOptions:E,options:h,licenseKey:p});return x(P),()=>{P.dispose()}},[r,g,h,i,t,s,o,x,p]),b.useLayoutEffect(()=>{m&&u&&m.setCameraOptions(u)},[m,u]);const S=b.useSyncExternalStore(b.useCallback(C=>m?(m.on("crash",C),()=>m.off("crash",C)):()=>{},[m]),()=>(m==null?void 0:m.getCrashingError())??null);b.useEffect(function(){if(!m)return;function T(){m&&m.focus()}function I(){m&&m.blur()}if(c&&mw())return m.getContainer().addEventListener("pointerdown",T),document.body.addEventListener("pointerdown",I),()=>{var E;(E=m.getContainer())==null||E.removeEventListener("pointerdown",T),document.body.removeEventListener("pointerdown",I)}},[m,c]);const{Canvas:v}=kt();return m?a.jsx(ip,{fallback:f,onError:C=>m.annotateError(C,{origin:"react.tldraw",willCrashApp:!0}),children:S?a.jsx($se,{crashingError:S}):a.jsx(Qv.Provider,{value:m,children:a.jsxs(Use,{onMount:n,children:[e??(v?a.jsx(v,{}):null),a.jsx(Rse,{})]})})}):null}function Use({children:n,onMount:e}){return bse(),Kne(),Yne(),Xne(),kF(t=>{const s=t.store.props.onMount(t),i=e==null?void 0:e(t);return()=>{s==null||s(),i==null||i()}}),n}function $se({crashingError:n}){throw n}function s1({children:n}){return a.jsx("div",{className:"tl-loading",children:n})}function PF({children:n}){return a.jsx("div",{className:"tl-loading",children:n})}function kF(n){const e=G(),t=vF(s=>{let i;return s.run(()=>{i=n==null?void 0:n(s),s.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,i});Oe.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function Ml({children:n,className:e="",...t}){return a.jsx("div",{...t,className:Se("tl-html-container",e),children:n})}class sm{constructor(e){this.editor=e}}w(sm,"props"),w(sm,"migrations"),w(sm,"type");function i1(n,e,t={}){const{newPoint:s,handle:i,scaleX:r,scaleY:o}=e,{minWidth:l=1,maxWidth:c=1/0,minHeight:d=1,maxHeight:u=1/0}=t;let h=n.props.w*r,p=n.props.h*o;const f=new _(0,0);if(h>0){if(h<l){switch(i){case"top_left":case"left":case"bottom_left":{f.x=h-l;break}case"top":case"bottom":{f.x=(h-l)/2;break}default:f.x=0}h=l}}else if(f.x=h,h=-h,h<l){switch(i){case"top_left":case"left":case"bottom_left":{f.x=-h;break}default:f.x=-l}h=l}if(p>0){if(p<d){switch(i){case"top_left":case"top":case"top_right":{f.y=p-d;break}case"right":case"left":{f.y=(p-d)/2;break}default:f.y=0}p=d}}else if(f.y=p,p=-p,p<d){switch(i){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-d}p=d}const{x:g,y:m}=f.rot(n.rotation).add(s);return{...n,x:g,y:m,props:{w:Math.min(c,h),h:Math.min(u,p)}}}class Wd extends Wi{constructor(){super(...arguments);w(this,"onResize",(t,s)=>i1(t,s))}getGeometry(t){return new wo({width:t.props.w,height:t.props.h,isFilled:!0})}getHandleSnapGeometry(t){return{points:this.getGeometry(t).bounds.cornersAndCenter}}getInterpolatedProps(t,s,i){return{...s.props,w:bs(t.props.w,s.props.w,i),h:bs(t.props.h,s.props.h,i)}}}var db;let zse=(db=class extends ye{constructor(){super(...arguments);w(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(db,"id","idle"),db);var ub;let Wse=(ub=class extends ye{constructor(){super(...arguments);w(this,"markId","");w(this,"wasFocusedOnEnter",!1);w(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()});w(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){const{originPagePoint:s}=this.editor.inputs,i=this.parent.shapeType,r=st();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:i,x:s.x,y:s.y,props:{w:1,h:1}}]).select(r),this.editor.setCurrentTool("select.resizing",{...t,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:t}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const s=this.parent.shapeType,i=st();this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:s,x:t.x,y:t.y}]);const r=this.editor.getShape(i);if(!r){this.cancel();return}let{w:o,h:l}=r.props;const c=new _(o/2,l/2),d=this.editor.getShapeParentTransform(r);d&&c.rot(-d.rotation());let u=1;this.editor.user.getIsDynamicResizeMode()&&(u=1/this.editor.getZoomLevel(),o*=u,l*=u,c.mul(u));const h=ft(r);h.x=r.x-c.x,h.y=r.y-c.y,h.props.w=o,h.props.h=l,"scale"in r.props&&(h.props.scale=u),this.editor.updateShape(h),this.editor.setSelectedShapes([i]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},w(ub,"id","pointing"),ub);class im extends ye{constructor(){super(...arguments);w(this,"onCreate")}}w(im,"id","box"),w(im,"initial","idle"),w(im,"children",()=>[zse,Wse]);function ox(n){const e=G();return q("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function dr(n){const e=G();return b.useMemo(function(){const i=d=>{if(d.isKilled)return;if(d.button===zE){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...Is(d)});return}if(d.button!==0)return;const u=Ay(d.currentTarget);function h(){u.removeEventListener("pointerup",h),Fp(u,d)}Lp(u,d),u.addEventListener("pointerup",h),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...Is(d)}),un(d)};let r,o;function l(d){d.isKilled||d.button===0&&(d.clientX===r&&d.clientY===o||(r=d.clientX,o=d.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...Is(d)})))}return{onPointerDown:i,onPointerMove:l,onPointerUp:d=>{d.isKilled||d.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...Is(d)})}}},[e,n])}function Hse(n){const[e,t]=b.useState(()=>({store:Ry(n),opts:n}));if(!mD(e.opts,n)){const s={store:Ry(n),opts:n};return t(s),s.store}return e.store}const Gse=20,Vse=8;function r1(n,e=Gse){return Math.max(Vse,Math.ceil(n/e))}class Bc extends za{constructor(t){super({...t,isFilled:!1,isClosed:!1});w(this,"_center");w(this,"radius");w(this,"start");w(this,"end");w(this,"largeArcFlag");w(this,"sweepFlag");w(this,"measure");w(this,"angleStart");w(this,"angleEnd");const{center:s,sweepFlag:i,largeArcFlag:r,start:o,end:l}=t;if(o.equals(l))throw Error("Arc must have different start and end points.");this.angleStart=_.Angle(s,o),this.angleEnd=_.Angle(s,l),this.radius=_.Dist(s,o),this.measure=xQ(this.angleStart,this.angleEnd,i,r),this.start=o,this.end=l,this.sweepFlag=i,this.largeArcFlag=r,this._center=s}nearestPoint(t){const{_center:s,measure:i,radius:r,angleEnd:o,angleStart:l,start:c,end:d}=this,u=X0(i,l,o,s.angle(t));if(u<=0)return c;if(u>=1)return d;const h=s.clone().add(t.clone().sub(s).uni().mul(r));let p,f=1/0,g;for(const m of[c,d,h])g=_.Dist2(t,m),g<f&&(p=m,f=g);if(!p)throw Error("nearest point not found");return p}hitTestLineSegment(t,s){const{_center:i,radius:r,measure:o,angleStart:l,angleEnd:c}=this,d=$p(t,s,i,r);return d===null?!1:d.some(u=>{const h=X0(o,l,c,i.angle(u));return h>=0&&h<=1})}getVertices(){const{_center:t,measure:s,length:i,radius:r,angleStart:o}=this,l=[];for(let c=0,d=r1(Math.abs(i));c<d+1;c++){const u=c/d*s,h=o+u;l.push(Rl(t,r,h))}return l}getSvgPathData(t=!0){const{start:s,end:i,radius:r,largeArcFlag:o,sweepFlag:l}=this;return`${t?`M${s.toFixed()}`:""} A${r} ${r} 0 ${o} ${l} ${i.toFixed()}`}getLength(){return this.measure*this.radius}}class o1 extends za{constructor(t){super({isClosed:!0,...t});w(this,"_center");w(this,"radius");w(this,"x");w(this,"y");this.config=t;const{x:s=0,y:i=0,radius:r}=t;this.x=s,this.y=i,this._center=new _(r+s,r+i),this.radius=r}getBounds(){return new ue(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:s}=this,i=et*s,r=[];for(let o=0,l=r1(i);o<l;o++){const c=o/l*et;r.push(Rl(t,s,c))}return r}nearestPoint(t){const{_center:s,radius:i}=this;return s.equals(t)?_.AddXY(s,i,0):s.clone().add(t.clone().sub(s).uni().mul(i))}hitTestLineSegment(t,s,i=0){const{_center:r,radius:o}=this;return $p(t,s,r,o+i)!==null}getSvgPathData(){const{_center:t,radius:s}=this;return`M${t.x+s},${t.y} a${s},${s} 0 1,0 ${s*2},0a${s},${s} 0 1,0 -${s*2},0`}}class Bn extends zd{constructor(t){const{start:s,cp1:i,cp2:r,end:o}=t;super({...t,points:[s,o]});w(this,"a");w(this,"b");w(this,"c");w(this,"d");this.a=s,this.b=i,this.c=r,this.d=o}getVertices(){const t=[],{a:s,b:i,c:r,d:o}=this;for(let l=0,c=10;l<=c;l++){const d=l/c;t.push(new _((1-d)*(1-d)*(1-d)*s.x+3*((1-d)*(1-d))*d*i.x+3*(1-d)*(d*d)*r.x+d*d*d*o.x,(1-d)*(1-d)*(1-d)*s.y+3*((1-d)*(1-d))*d*i.y+3*(1-d)*(d*d)*r.y+d*d*d*o.y))}return t}midPoint(){return Bn.GetAtT(this,.5)}nearestPoint(t){let s,i=1/0,r,o;for(const l of this.segments)o=l.nearestPoint(t),r=_.Dist2(o,t),r<i&&(s=o,i=r);if(!s)throw Error("nearest point not found");return s}getSvgPathData(t=!0){const{a:s,b:i,c:r,d:o}=this;return`${t?`M ${s.toFixed()} `:""} C${i.toFixed()} ${r.toFixed()} ${o.toFixed()}`}static GetAtT(t,s){const{a:i,b:r,c:o,d:l}=t;return new _((1-s)*(1-s)*(1-s)*i.x+3*((1-s)*(1-s))*s*r.x+3*(1-s)*(s*s)*o.x+s*s*s*l.x,(1-s)*(1-s)*(1-s)*i.y+3*((1-s)*(1-s))*s*r.y+3*(1-s)*(s*s)*o.y+s*s*s*l.y)}getLength(t=32){let s,i=this.a,r=0;for(let o=1;o<=t;o++)s=Bn.GetAtT(this,o/t),r+=_.Dist(i,s),i=s;return r}}class Kse extends za{constructor(t){super({...t,isClosed:!1,isFilled:!1});w(this,"points");w(this,"_segments");const{points:s}=t;this.points=s}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,s=t.length,i=s-2,r=1.25;for(let o=0;o<s-1;o++){const l=o===0?t[0]:t[o-1],c=t[o],d=t[o+1],u=o===i?d:t[o+2],h=c,p=o===0?l:new _(c.x+(d.x-l.x)/6*r,c.y+(d.y-l.y)/6*r),f=o===i?d:new _(d.x-(u.x-c.x)/6*r,d.y-(u.y-c.y)/6*r),g=d;this._segments.push(new Bn({start:h,cp1:p,cp2:f,end:g}))}}return this._segments}getLength(){return this.segments.reduce((t,s)=>t+s.length,0)}getVertices(){const t=this.segments.reduce((s,i)=>s.concat(i.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let s,i=1/0,r,o;for(const l of this.segments)o=l.nearestPoint(t),r=_.Dist2(o,t),r<i&&(s=o,i=r);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(t,s){return this.segments.some(i=>i.hitTestLineSegment(t,s))}getSvgPathData(){let t=this.segments.reduce((s,i,r)=>s+i.getSvgPathData(r===0),"");return this.isClosed&&(t+="Z"),t}}class Yse extends za{constructor(t){super({...t,isClosed:!0});w(this,"w");w(this,"h");w(this,"_edges");this.config=t;const{width:s,height:i}=t;this.w=s,this.h=i}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let s=0,i=t.length;s<i;s++){const r=t[s],o=t[(s+1)%i];this._edges.push(new no({start:r,end:o}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),s=Math.max(1,this.h),i=t/2,r=s/2,o=Math.pow(i-r,2)/Math.pow(i+r,2),l=qe*(i+r)*(1+3*o/(10+Math.sqrt(4-3*o))),c=r1(l),d=et/c,u=Math.cos(d),h=Math.sin(d);let p=0,f=1,g=0,m=1;const x=Array(c);for(let y=0;y<c;y++)x[y]=new _(i+i*f,r+r*p),g=h*f+u*p,m=u*f-h*p,p=g,f=m;return x}nearestPoint(t){let s,i=1/0,r,o;for(const l of this.edges)o=l.nearestPoint(t),r=_.Dist2(o,t),r<i&&(s=o,i=r);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(t,s){return this.edges.some(i=>i.hitTestLineSegment(t,s))}getBounds(){return new ue(0,0,this.w,this.h)}getLength(){const{w:t,h:s}=this,i=t/2,r=s/2,o=Math.max(0,i),l=Math.max(0,r);return wL(o,l)}getSvgPathData(t=!1){const{w:s,h:i}=this,r=s/2,o=i/2,l=Math.max(0,r),c=Math.max(0,o);return`${t?`M${r-l},${o}`:""} a${l},${c},0,1,1,${l*2},0a${l},${c},0,1,1,-${l*2},0`}}class Xse extends za{constructor(t){super({...t,isClosed:!0});w(this,"w");w(this,"h");w(this,"a");w(this,"b");w(this,"c");w(this,"d");this.config=t;const{width:s,height:i}=t;if(this.w=s,this.h=i,i>s){const r=s/2;this.a=new Bc({start:new _(0,r),end:new _(s,r),center:new _(s/2,r),sweepFlag:1,largeArcFlag:1}),this.b=new no({start:new _(s,r),end:new _(s,i-r)}),this.c=new Bc({start:new _(s,i-r),end:new _(0,i-r),center:new _(s/2,i-r),sweepFlag:1,largeArcFlag:1}),this.d=new no({start:new _(0,i-r),end:new _(0,r)})}else{const r=i/2;this.a=new Bc({start:new _(r,i),end:new _(r,0),center:new _(r,r),sweepFlag:1,largeArcFlag:1}),this.b=new no({start:new _(r,0),end:new _(s-r,0)}),this.c=new Bc({start:new _(s-r,0),end:new _(s-r,i),center:new _(s-r,r),sweepFlag:1,largeArcFlag:1}),this.d=new no({start:new _(s-r,i),end:new _(r,i)})}}nearestPoint(t){let s,i=1/0,r,o;const{a:l,b:c,c:d,d:u}=this;for(const h of[l,c,d,u])o=h.nearestPoint(t),r=_.Dist2(o,t),r<i&&(s=o,i=r);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(t,s){const{a:i,b:r,c:o,d:l}=this;return[i,r,o,l].some(c=>c.hitTestLineSegment(t,s))}getVertices(){const{a:t,b:s,c:i,d:r}=this;return[t,s,i,r].reduce((o,l)=>(o.push(...l.vertices),o),[])}getBounds(){return new ue(0,0,this.w,this.h)}getLength(){const{h:t,w:s}=this;return t>s?(qe*(s/2)+(t-s))*2:(qe*(t/2)+(s-t))*2}getSvgPathData(){const{a:t,b:s,c:i,d:r}=this;return[t,s,i,r].map((o,l)=>o.getSvgPathData(l===0)).join(" ")+" Z"}}async function qse({shouldReload:n=!0}={}){kZ();for(const e of My.connectedInstances)await e.close();await Promise.all(t1().map(e=>wF(e))),PZ(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=qse);function Zse(n,e="_blank"){VE.openWindow(n,e)}function Jse({children:n}){const e=G();return q("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const s=e.getOnlySelectedShape();return s&&e.isShapeOfType(s,"note")}return!1},[e])?a.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null}const{PI:Qse}=Math,td=Qse+1e-4;function AF(n,e={}){const{size:t=16,smoothing:s=.5}=e;if(n.length===0||t<=0)return{left:[],right:[]};const i=n[0],r=n[n.length-1],o=r.runningLength,l=Math.pow(t*s,2),c=[],d=[];let u=n[0].vector,h=n[0].point,p=h,f=h,g=p,m=!1,x;for(let y=0;y<n.length;y++){x=n[y];const{point:S,vector:v}=n[y],C=x.vector.dpr(u),T=(y<n.length-1?n[y+1]:n[y]).vector,I=y<n.length-1?T.dpr(x.vector):1,E=C<0&&!m,P=I!==null&&I<.2;if(E||P){if(I>-.62&&o-x.runningLength>x.radius){const j=u.clone().mul(x.radius);u.clone().cpr(T)<0?(f=_.Add(S,j),g=_.Sub(S,j)):(f=_.Sub(S,j),g=_.Add(S,j)),c.push(f),d.push(g)}else{const j=u.clone().mul(x.radius).per(),D=_.Sub(x.input,j);for(let R=1/13,A=0;A<1;A+=R)f=_.RotWith(D,x.input,td*A),c.push(f),g=_.RotWith(D,x.input,td+td*-A),d.push(g)}h=f,p=g,P&&(m=!0);continue}if(m=!1,x===i||x===r){const j=_.Per(v).mul(x.radius);c.push(_.Sub(S,j)),d.push(_.Add(S,j));continue}const k=_.Lrp(T,v,I).per().mul(x.radius);f=_.Sub(S,k),(y<=1||_.Dist2(h,f)>l)&&(c.push(f),h=f),g=_.Add(S,k),(y<=1||_.Dist2(p,g)>l)&&(d.push(g),p=g),u=v}return{left:c,right:d}}function a1(n,e={}){const{size:t=16,start:s={},end:i={},last:r=!1}=e,{cap:o=!0}=s,{cap:l=!0}=i;if(n.length===0||t<=0)return[];const c=n[0],d=n[n.length-1],u=d.runningLength,h=s.taper===!1?0:s.taper===!0?Math.max(t,u):s.taper,p=i.taper===!1?0:i.taper===!0?Math.max(t,u):i.taper,{left:f,right:g}=AF(n,e),m=c.point,x=n.length>1?n[n.length-1].point:_.AddXY(c.point,1,1);if(n.length===1&&(!(h||p)||r)){const C=_.Add(m,_.Sub(m,x).uni().per().mul(-c.radius)),T=[];for(let I=1/13,E=I;E<=1;E+=I)T.push(_.RotWith(C,m,td*2*E));return T}const y=[];if(!(h||p&&n.length===1))if(o)for(let C=1/8,T=C;T<=1;T+=C){const I=_.RotWith(g[0],m,td*T);y.push(I)}else{const C=_.Sub(f[0],g[0]),T=_.Mul(C,.5),I=_.Mul(C,.51);y.push(_.Sub(m,T),_.Sub(m,I),_.Add(m,I),_.Add(m,T))}const S=[],v=d.vector.clone().per().neg();if(p||h&&n.length===1)S.push(x);else if(l){const C=_.Add(x,_.Mul(v,d.radius));for(let T=1/29,I=T;I<1;I+=T)S.push(_.RotWith(C,x,td*3*I))}else S.push(_.Add(x,_.Mul(v,d.radius)),_.Add(x,_.Mul(v,d.radius*.99)),_.Sub(x,_.Mul(v,d.radius*.99)),_.Sub(x,_.Mul(v,d.radius)));return f.concat(S,g.reverse(),y)}const eie=.025,tie=.01;function Rr(n,e={}){var x;const{streamline:t=.5,size:s=16,simulatePressure:i=!1}=e;if(n.length===0)return[];const r=.15+(1-t)*.85;let o=n.map(_.From),l=0;if(!i){let y=o[0];for(;y&&!(y.z>=eie);)o.shift(),y=o[0]}if(!i){let y=o[o.length-1];for(;y&&!(y.z>=tie);)o.pop(),y=o[o.length-1]}if(o.length===0)return[{point:_.From(n[0]),input:_.From(n[0]),pressure:i?.5:.15,vector:new _(1,1),distance:0,runningLength:0,radius:1}];let c=o[1];for(;c&&!(_.Dist2(c,o[0])>(s/3)**2);)o[0].z=Math.max(o[0].z,c.z),o.splice(1,1),c=o[1];const d=o.pop();for(c=o[o.length-1];c&&!(_.Dist2(c,d)>(s/3)**2);)o.pop(),c=o[o.length-1],l++;o.push(d);const u=e.last||!e.simulatePressure||o.length>1&&_.Dist2(o[o.length-1],o[o.length-2])<s**2||l>0;if(o.length===2&&e.simulatePressure){const y=o[1];o=o.slice(0,-1);for(let S=1;S<5;S++){const v=_.Lrp(o[0],y,S/4);v.z=(o[0].z+(y.z-o[0].z))*S/4,o.push(v)}}const h=[{point:o[0],input:o[0],pressure:i?.5:o[0].z,vector:new _(1,1),distance:0,runningLength:0,radius:1}];let p=0,f=h[0],g,m;u&&t>0&&o.push(o[o.length-1].clone());for(let y=1,S=o.length;y<S;y++)g=!r||e.last&&y===S-1?o[y].clone():o[y].clone().lrp(f.point,1-r),!f.point.equals(g)&&(m=_.Dist(g,f.point),p+=m,!(y<4&&p<s)&&(f={input:o[y],point:g,pressure:i?.5:o[y].z,vector:_.Sub(f.point,g).uni(),distance:m,runningLength:p,radius:1},h.push(f)));if((x=h[1])!=null&&x.vector&&(h[0].vector=h[1].vector.clone()),p<1){const y=Math.max(.5,...h.map(S=>S.pressure));h.forEach(S=>S.pressure=y)}return h}const{min:Ho}=Math,yw=.275;function ax(n,e){const{size:t=16,thinning:s=.5,simulatePressure:i=!0,easing:r=x=>x,start:o={},end:l={}}=e,{easing:c=ln.easeOutQuad}=o,{easing:d=ln.easeOutCubic}=l,u=n[n.length-1].runningLength;let h,p=n[0].pressure,f;if(!i&&u<t){const x=n.reduce((y,S)=>Math.max(y,S.pressure),.5);return n.forEach(y=>{y.pressure=x,y.radius=t*r(.5-s*(.5-y.pressure))}),n}else{let x;for(let y=0,S=n.length;y<S&&(f=n[y],!(f.runningLength>t*5));y++){const v=Ho(1,f.distance/t);if(i){const C=Ho(1,1-v);x=Ho(1,p+(C-p)*(v*yw))}else x=Ho(1,p+(f.pressure-p)*.5);p=p+(x-p)*.5}for(let y=0;y<n.length;y++){if(f=n[y],s){let{pressure:S}=f;const v=Ho(1,f.distance/t);if(i){const C=Ho(1,1-v);S=Ho(1,p+(C-p)*(v*yw))}else S=Ho(1,p+(S-p)*(v*yw));f.radius=t*r(.5-s*(.5-S)),p=S}else f.radius=t/2;h===void 0&&(h=f.radius)}}const g=o.taper===!1?0:o.taper===!0?Math.max(t,u):o.taper,m=l.taper===!1?0:l.taper===!0?Math.max(t,u):l.taper;if(g||m)for(let x=0;x<n.length;x++){f=n[x];const{runningLength:y}=f,S=y<g?c(y/g):1,v=u-y<m?d((u-y)/m):1;f.radius=Math.max(.01,f.radius*Math.min(S,v))}return n}function nie(n,e={}){return a1(ax(Rr(n,e),e),e)}function AA({scribble:n,zoom:e,color:t,opacity:s,className:i}){if(!n.points.length)return null;const r=nie(n.points,{size:n.size/e,start:{taper:n.taper,easing:ln.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let o;if(r.length<4){const l=n.size/e/2,{x:c,y:d}=n.points[n.points.length-1];o=`M ${c-l},${d} a ${l},${l} 0 1,0 ${l*2},0 a ${l},${l} 0 1,0 ${-l*2},0`}else o=HE(r);return a.jsx("svg",{className:i&&Se("tl-overlays__item",i),children:a.jsx("path",{className:"tl-scribble",d:o,fill:t??`var(--color-${n.color})`,opacity:s??n.opacity})})}const sie=({bounds:n,rotation:e})=>{const t=G();return q("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?a.jsx(zL,{bounds:n,rotation:e}):null};function Ro(){const n=G();return q("isReadonlyMode",()=>n.getInstanceState().isReadonly,[n])}function iie({size:n,width:e,height:t,hideAlternateHandles:s}){const i=H(n/3),r=i/2;return a.jsxs("svg",{className:"tl-overlays__item",children:[a.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${H(0-r)},${H(n)} 
						${H(0-r)},${H(0-r)} 
						${H(n)},${H(0-r)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),a.jsx("line",{className:Se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:H(e/2-n),y1:H(0-r),x2:H(e/2+n),y2:H(0-r),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),a.jsx("polyline",{className:Se("tl-corner-crop-handle",{"tl-hidden":s}),points:`
						${H(e-n)},${H(0-r)} 
						${H(e+r)},${H(0-r)} 
						${H(e+r)},${H(n)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),a.jsx("line",{className:Se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:H(e+r),y1:H(t/2-n),x2:H(e+r),y2:H(t/2+n),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),a.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${H(e+r)},${H(t-n)} 
						${H(e+r)},${H(t+r)}
						${H(e-n)},${H(t+r)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),a.jsx("line",{className:Se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:H(e/2-n),y1:H(t+r),x2:H(e/2+n),y2:H(t+r),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),a.jsx("polyline",{className:Se("tl-corner-crop-handle",{"tl-hidden":s}),points:`
						${H(0+n)},${H(t+r)} 
						${H(0-r)},${H(t+r)}
						${H(0-r)},${H(t-n)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),a.jsx("line",{className:Se("tl-corner-crop-edge-handle",{"tl-hidden":s}),x1:H(0-r),y1:H(t/2-n),x2:H(0-r),y2:H(t/2+n),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const rie=pn(function({bounds:e,rotation:t}){const s=G(),i=b.useRef(null),r=Ro(),o=dr("top"),l=dr("right"),c=dr("bottom"),d=dr("left"),u=dr("top_left"),h=dr("top_right"),p=dr("bottom_right"),f=dr("bottom_left"),g=!s.getIsMenuOpen()&&s.getInstanceState().cursor.type==="default",m=s.getInstanceState().isCoarsePointer,x=s.getOnlySelectedShape(),y=x&&s.isShapeOrAncestorLocked(x),S=x?s.getShapeUtil(x).expandSelectionOutlinePx(x):0;if($d(i,e==null?void 0:e.x,e==null?void 0:e.y,1,s.getSelectionRotation(),{x:-S,y:-S}),!e)return null;e=e.clone().expandBy(S).zeroFix();const v=s.getZoomLevel(),C=s.getInstanceState().isChangingStyle,T=e.width,I=e.height,E=8/v,P=T<E*2,k=I<E*2,j=T<E*4,D=I<E*4,R=T<E*5,A=I<E*5,N=m?1.75:1,B=6/v*N,L=(j?B/2:B)*(N*.75),O=(D?B/2:B)*(N*.75),F=(x?!s.getShapeUtil(x).hideSelectionBoundsFg(x):!0)&&!C;let W=F&&s.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||F&&s.isIn("select.resizing")&&x&&s.isShapeOfType(x,"text");x&&W&&s.environment.isFirefox&&s.isShapeOfType(x,"embed")&&(W=!1);const $=s.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!C&&!r,K=s.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!C&&!r,Y=!m&&!(P||k)&&(K||$)&&(x?!s.getShapeUtil(x).hideRotateHandle(x):!0)&&!y,U=m&&(!j||!D)&&(K||$)&&(x?!s.getShapeUtil(x).hideRotateHandle(x):!0)&&!y,J=K&&(x?s.getShapeUtil(x).canResize(x)&&!s.getShapeUtil(x).hideResizeHandles(x):!0)&&!$&&!y,te=P||k,ee=P&&k,ae=R||A,ce=J||$,he=!Y,Ee=!K||!U,ke=!K||!ce,Jt=!K||!ce||te,tt=!K||!ce||te,re=!K||!ce||ee&&!$;let $e=!0,At=!0;if($)$e=ae,At=ae;else if(J){$e=te||ee||m;const Fo=m&&x&&x.type==="text";At=$e&&!Fo}const gn=Math.min(24/v,I-O*3),nu=K&&m&&x&&s.isShapeOfType(x,"text")&&gn*v>=4;return a.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:a.jsxs("g",{ref:i,children:[W&&a.jsx("rect",{className:"tl-selection__fg__outline",width:H(T),height:H(I)}),a.jsx(ig,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:B,corner:"top_left_rotate",cursor:g?Bs("nwse-rotate",t):void 0,isHidden:he}),a.jsx(ig,{"data-testid":"selection.rotate.top-right",cx:T+B*3,cy:0,targetSize:B,corner:"top_right_rotate",cursor:g?Bs("nesw-rotate",t):void 0,isHidden:he}),a.jsx(ig,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:I+B*3,targetSize:B,corner:"bottom_left_rotate",cursor:g?Bs("swne-rotate",t):void 0,isHidden:he}),a.jsx(ig,{"data-testid":"selection.rotate.bottom-right",cx:T+B*3,cy:I+B*3,targetSize:B,corner:"bottom_right_rotate",cursor:g?Bs("senw-rotate",t):void 0,isHidden:he}),a.jsx(aie,{"data-testid":"selection.rotate.mobile",cx:j?-B*1.5:T/2,cy:j?I/2:-B*1.5,size:E,isHidden:Ee}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":$e}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:H(0-(D?O*2:O)),width:H(T),height:H(Math.max(1,O*2)),style:g?{cursor:Bs("ns-resize",t)}:void 0,...o}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":At}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:H(T-(j?0:L)),y:0,height:H(I),width:H(Math.max(1,L*2)),style:g?{cursor:Bs("ew-resize",t)}:void 0,...l}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":$e}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:H(I-(D?0:O)),width:H(T),height:H(Math.max(1,O*2)),style:g?{cursor:Bs("ns-resize",t)}:void 0,...c}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":At}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:H(0-(j?L*2:L)),y:0,height:H(I),width:H(Math.max(1,L*2)),style:g?{cursor:Bs("ew-resize",t)}:void 0,...d}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":ke}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:H(0-(j?L*2:L*1.5)),y:H(0-(D?O*2:O*1.5)),width:H(L*3),height:H(O*3),style:g?{cursor:Bs("nwse-resize",t)}:void 0,...u}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":Jt}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:H(T-(j?0:L*1.5)),y:H(0-(D?O*2:O*1.5)),width:H(L*3),height:H(O*3),style:g?{cursor:Bs("nesw-resize",t)}:void 0,...h}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":re}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:H(T-(j?L:L*1.5)),y:H(I-(D?O:O*1.5)),width:H(L*3),height:H(O*3),style:g?{cursor:Bs("nwse-resize",t)}:void 0,...p}),a.jsx("rect",{className:Se("tl-transparent",{"tl-hidden":tt}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:H(0-(j?L*3:L*1.5)),y:H(I-(D?0:O*1.5)),width:H(L*3),height:H(O*3),style:g?{cursor:Bs("nesw-resize",t)}:void 0,...f}),J&&a.jsxs(a.Fragment,{children:[a.jsx("rect",{"data-testid":"selection.resize.top-left",className:Se("tl-corner-handle",{"tl-hidden":ke}),"aria-label":"top_left handle",x:H(0-E/2),y:H(0-E/2),width:H(E),height:H(E)}),a.jsx("rect",{"data-testid":"selection.resize.top-right",className:Se("tl-corner-handle",{"tl-hidden":Jt}),"aria-label":"top_right handle",x:H(T-E/2),y:H(0-E/2),width:H(E),height:H(E)}),a.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:Se("tl-corner-handle",{"tl-hidden":re}),"aria-label":"bottom_right handle",x:H(T-E/2),y:H(I-E/2),width:H(E),height:H(E)}),a.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:Se("tl-corner-handle",{"tl-hidden":tt}),"aria-label":"bottom_left handle",x:H(0-E/2),y:H(I-E/2),width:H(E),height:H(E)})]}),nu&&a.jsxs(a.Fragment,{children:[a.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:H(0-E/4),y:H(I/2-gn/2),rx:E/4,width:H(E/2),height:H(gn)}),a.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:E/4,x:H(T-E/4),y:H(I/2-gn/2),width:H(E/2),height:H(gn)})]}),$&&a.jsx(iie,{size:E,width:T,height:I,hideAlternateHandles:ae})]})})}),ig=function({cx:e,cy:t,targetSize:s,corner:i,cursor:r,isHidden:o,"data-testid":l}){const c=dr(i);return a.jsx("rect",{className:Se("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":l,"aria-label":`${i} target`,pointerEvents:"all",x:H(e-s*3),y:H(t-s*3),width:H(Math.max(1,s*3)),height:H(Math.max(1,s*3)),cursor:r,...c})},oie=Math.sqrt(Math.PI),aie=function({cx:e,cy:t,size:s,isHidden:i,"data-testid":r}){const o=dr("mobile_rotate"),l=G(),c=q("zoom level",()=>l.getZoomLevel(),[l]),d=Math.max(14*(1/c),20/Math.max(1,c));return a.jsxs("g",{children:[a.jsx("circle",{"data-testid":r,pointerEvents:"all",className:Se("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:e,cy:t,r:d,...o}),a.jsx("circle",{className:Se("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:e,cy:t,r:s/oie})]})};function lie(){const n=G();return q("is in a valid select state",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[n])?a.jsx(WL,{}):null}function i_(n,e,t){const{arrowheadStart:s,arrowheadEnd:i}=e.props,r=Uc(n,e,t),o=r.start.clone(),l=r.end.clone(),c=_.Med(o,l);if(_.Equals(o,l))return{bindings:t,isStraight:!0,start:{handle:o,point:o,arrowhead:e.props.arrowheadStart},end:{handle:l,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const d=_.Sub(l,o).uni(),u=Oy(n,e,"start"),h=Oy(n,e,"end"),p=n.getShapePageTransform(e);jA(l,r.start,p,h),jA(o,r.end,p,u);let f=0,g=0,m=0,x=0,y=$c*e.props.scale;const S=u&&h&&u.shape===h.shape,v=u&&h?l1(n,u.shape.id,h.shape.id):"safe";v==="safe"&&u&&h&&!S&&!u.isExact&&!h.isExact&&(h.didIntersect&&!u.didIntersect?u.isClosed&&o.setTo(l.clone().add(d.clone().mul($c*e.props.scale))):h.didIntersect||h.isClosed&&l.setTo(o.clone().sub(d.clone().mul($c*e.props.scale))));const C=_.Sub(l,o),T=_.Len(C)?C.uni():_.From(C),I=!_.Equals(T,d);S||(v!=="start-contains-end"&&u&&s!=="none"&&!u.isExact&&(m=ca[e.props.size]/2+("size"in u.shape.props?ca[u.shape.props.size]/2:0),f=(Dy+m)*e.props.scale,y+=m*e.props.scale),v!=="end-contains-start"&&h&&i!=="none"&&!h.isExact&&(x=ca[e.props.size]/2+("size"in h.shape.props?ca[h.shape.props.size]/2:0),g=(Dy+x)*e.props.scale,y+=x*e.props.scale));const E=o.clone().add(T.clone().mul(f*(I?-1:1))),P=l.clone().sub(T.clone().mul(g*(I?-1:1)));_.DistMin(E,P,y)&&(f!==0&&g!==0?(f*=-1.5,g*=-1.5):f!==0?f*=-1:g!==0&&(g*=-1)),o.add(T.clone().mul(f*(I?-1:1))),l.sub(T.clone().mul(g*(I?-1:1))),I?(u&&h&&l.setTo(_.Add(o,T.clone().mul(-$c*e.props.scale))),c.setTo(_.Med(r.start,r.end))):c.setTo(_.Med(o,l));const k=_.Dist(o,l);return{bindings:t,isStraight:!0,start:{handle:r.start,point:o,arrowhead:e.props.arrowheadStart},end:{handle:r.end,point:l,arrowhead:e.props.arrowheadEnd},middle:c,isValid:k>0,length:k}}function jA(n,e,t,s){if(s===void 0||s.isExact)return;const i=ve.applyToPoint(t,e),r=ve.applyToPoint(t,n),o=ve.applyToPoint(ve.Inverse(s.transform),i),l=ve.applyToPoint(ve.Inverse(s.transform),r),c=s.isClosed,u=(c?XE:Gte)(o,l,s.outline);let h;if(u!==null&&(h=u.sort((g,m)=>_.Dist2(g,o)-_.Dist2(m,o))[0]??(c?void 0:l)),h===void 0)return;const p=ve.applyToPoint(s.transform,h),f=ve.applyToPoint(ve.Inverse(t),p);n.setTo(f),s.didIntersect=!0}function cie(n,e,t){const{arrowheadEnd:s,arrowheadStart:i}=e.props,r=e.props.bend;if(Math.abs(r)>Math.abs(e.props.bend*(fie*e.props.scale)))return i_(n,e,t);const o=Uc(n,e,t),l=_.Med(o.start,o.end),c=_.Sub(o.end,o.start),d=_.Len(c)?c.uni():_.From(c),u=_.Add(l,d.per().mul(-r)),h=Oy(n,e,"start"),p=Oy(n,e,"end"),f=o.start.clone(),g=o.end.clone(),m=u.clone();if(_.Equals(f,g))return{bindings:t,isStraight:!0,start:{handle:f,point:f,arrowhead:e.props.arrowheadStart},end:{handle:g,point:g,arrowhead:e.props.arrowheadEnd},middle:m,isValid:!1,length:0};const x=e.props.bend<0,y=x?Dp:bL,S=NA(f,g,m),v=_.Angle(S.center,f),C=_.Angle(S.center,g),T=y(v,C);if(S.length===0||S.size===0||!Kk(S.length)||!Kk(S.size))return i_(n,e,t);const I=f.clone(),E=g.clone(),P=m.clone(),k=n.getShapePageTransform(e);let j=0,D=0,R=$c*e.props.scale;if(h&&!h.isExact){const $=ve.applyToPoint(k,I),K=ve.applyToPoint(k,S.center),Y=ve.applyToPoint(k,E),U=ve.Inverse(h.transform),J=ve.applyToPoint(U,$),te=ve.applyToPoint(U,K),ee=ve.applyToPoint(U,Y),{isClosed:ae}=h,ce=ae?Q0:fA;let he,Ee=ce(te,S.radius,h.outline);if(Ee){const ke=te.angle(J),Jt=te.angle(ee),tt=y(ke,Jt);Ee=Ee.filter($e=>y(ke,te.angle($e))<=tt);const re=tt*.25;Ee.sort(ae?($e,At)=>Math.abs(y(ke,te.angle($e))-re)<Math.abs(y(ke,te.angle(At))-re)?-1:1:($e,At)=>y(ke,te.angle($e))<y(ke,te.angle(At))?-1:1),he=Ee[0]??(ae?void 0:J)}else he=ae?void 0:J;if(he&&(I.setTo(n.getPointInShapeSpace(e,ve.applyToPoint(h.transform,he))),h.didIntersect=!0,i!=="none")){const ke=ca[e.props.size]/2+("size"in h.shape.props?ca[h.shape.props.size]/2:0);j=(Dy+ke)*e.props.scale,R+=ke*e.props.scale}}if(p&&!p.isExact){const $=ve.applyToPoint(k,I),K=ve.applyToPoint(k,E),Y=ve.applyToPoint(k,S.center),U=ve.Inverse(p.transform),J=ve.applyToPoint(U,$),te=ve.applyToPoint(U,Y),ee=ve.applyToPoint(U,K),ae=p.isClosed,ce=ae?Q0:fA;let he,Ee=ce(te,S.radius,p.outline);if(Ee){const ke=te.angle(J),Jt=te.angle(ee),tt=y(ke,Jt),re=tt*.75;Ee=Ee.filter($e=>y(ke,te.angle($e))<=tt),Ee.sort(ae?($e,At)=>Math.abs(y(ke,te.angle($e))-re)<Math.abs(y(ke,te.angle(At))-re)?-1:1:($e,At)=>y(ke,te.angle($e))<y(ke,te.angle(At))?-1:1),Ee[0]?he=Ee[0]:he=ae?void 0:ee}else he=ae?void 0:ee;if(he&&(E.setTo(n.getPointInShapeSpace(e,ve.applyToPoint(p.transform,he))),p.didIntersect=!0,s!=="none")){const ke=ca[e.props.size]/2+("size"in p.shape.props?ca[p.shape.props.size]/2:0);D=(Dy+ke)*e.props.scale,R+=ke*e.props.scale}}let A=_.Angle(S.center,I),N=_.Angle(S.center,E),B=y(A,N),L=B*S.radius;const O=I.clone(),F=E.clone();if(j!==0&&O.setTo(S.center).add(_.FromAngle(A+B*(j/L*(x?1:-1))).mul(S.radius)),D!==0&&F.setTo(S.center).add(_.FromAngle(N+B*(D/L*(x?-1:1))).mul(S.radius)),_.DistMin(O,F,R)&&(j!==0&&D!==0?(j*=-1.5,D*=-1.5):j!==0?j*=-2:D!==0&&(D*=-2)),j!==0&&I.setTo(S.center).add(_.FromAngle(A+B*(j/L*(x?1:-1))).mul(S.radius)),D!==0&&E.setTo(S.center).add(_.FromAngle(N+B*(D/L*(x?-1:1))).mul(S.radius)),h&&p&&!h.isExact&&!p.isExact){A=_.Angle(S.center,I),N=_.Angle(S.center,E),B=y(A,N),L=B*S.radius;const $=l1(n,h.shape.id,p.shape.id);$==="double-bound"&&L<30?(I.setTo(f),E.setTo(g),P.setTo(m)):$==="safe"&&(h&&!h.didIntersect&&I.setTo(f),(p&&!p.didIntersect||y(v,A)>y(v,N))&&E.setTo(S.center).add(_.FromAngle(A+B*(Math.min(.9,$c*e.props.scale/L)*(x?1:-1))).mul(S.radius)))}die(S.center,S.radius,I,E,P,T,x),I.equals(E)&&(I.setTo(P.clone().addXY(1,1)),E.setTo(P.clone().subXY(1,1))),f.setTo(I),g.setTo(E),m.setTo(P);const W=NA(f,g,m);return{bindings:t,isStraight:!1,start:{point:f,handle:o.start,arrowhead:e.props.arrowheadStart},end:{point:g,handle:o.end,arrowhead:e.props.arrowheadEnd},middle:m,handleArc:S,bodyArc:W,isValid:W.length!==0&&isFinite(W.center.x)&&isFinite(W.center.y)}}function NA(n,e,t){const s=$E(n,e,t),i=_.Dist(s,n),r=+_.Clockwise(n,t,e),o=((n.y-e.y)**2+(n.x-e.x)**2)**.5,l=((e.y-t.y)**2+(e.x-t.x)**2)**.5,c=((t.y-n.y)**2+(t.x-n.x)**2)**.5,d=Math.acos((l*l+c*c-o*o)/(2*l*c))*2,u=+(qe>d),h=(et-d)*(r?1:-1),p=h*i;return{center:s,radius:i,size:h,length:p,largeArcFlag:u,sweepFlag:r}}function die(n,e,t,s,i,r,o){const l=_.Angle(n,t),c=_.Angle(n,s);let d=Dp(l,c);if(o||(d=et-d),i.setTo(n).add(_.FromAngle(l+d*(.5*(o?1:-1))).mul(e)),d>r){i.rotWith(n,qe);const u=s.clone();s.setTo(t),t.setTo(u)}}const uie=8;function hie(n){return Math.abs(n.props.bend)<uie*n.props.scale}function Oy(n,e,t){const s=n.getBindingsFromShape(e,"arrow").find(c=>c.props.terminal===t);if(!s)return;const i=n.getShape(s.toId);if(!i)return;const r=n.getShapePageTransform(i),o=n.getShapeGeometry(i),l=o instanceof Yi?o.children[0].vertices:o.vertices;return{shape:i,transform:r,isClosed:o.isClosed,isExact:s.props.isExact,didIntersect:!1,outline:l}}function RA(n,e,t,s){const i=n.getShape(t.toId);if(i){const{point:r,size:o}=n.getShapeGeometry(i).bounds,l=_.Add(r,_.MulV(t.props.isPrecise||s?t.props.normalizedAnchor:{x:.5,y:.5},o)),c=ve.applyToPoint(n.getShapePageTransform(i),l);return ve.applyToPoint(ve.Inverse(e),c)}else return new _(0,0)}function Cs(n,e){const t=n.getBindingsFromShape(e,"arrow");return{start:t.find(s=>s.props.terminal==="start"),end:t.find(s=>s.props.terminal==="end")}}const pie=KZ("arrow info",(n,e)=>{const t=Cs(n,e);return hie(e)?i_(n,e,t):cie(n,e,t)});function yr(n,e){const t=typeof e=="string"?e:e.id;return pie.get(n,t)}function Uc(n,e,t){var l,c;const s=n.getShapePageTransform(e),i=l1(n,(l=t.start)==null?void 0:l.toId,(c=t.end)==null?void 0:c.toId),r=t.start?RA(n,s,t.start,i==="double-bound"||i==="start-contains-end"):_.From(e.props.start),o=t.end?RA(n,s,t.end,i==="double-bound"||i==="end-contains-start"):_.From(e.props.end);return{start:r,end:o}}function Tu(n,e,t,s){const i=typeof e=="string"?e:e.id,r=typeof t=="string"?t:t.id,o=n.getBindingsFromShape(i,"arrow").filter(c=>c.props.terminal===s.terminal);o.length>1&&n.deleteBindings(o.slice(1));const l=o[0];l?n.updateBinding({...l,toId:r,props:s}):n.createBinding({type:"arrow",fromId:i,toId:r,props:s})}function rm(n,e,t){const s=n.getBindingsFromShape(e,"arrow").filter(i=>i.props.terminal===t);n.deleteBindings(s)}const $c=10,Dy=10,fie=10,ca={s:2,m:3.5,l:5,xl:10};function l1(n,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const s=n.getShapePageBounds(e),i=n.getShapePageBounds(t);if(s&&i){if(s.contains(i))return"start-contains-end";if(i.contains(s))return"end-contains-start"}return"safe"}class om extends sm{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){vw(this.editor,this.editor.getShape(e.fromId))}onAfterChange({bindingAfter:e}){vw(this.editor,this.editor.getShape(e.fromId))}onAfterChangeFromShape({shapeAfter:e}){vw(this.editor,e)}onAfterChangeToShape({binding:e}){jF(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const t=this.editor.getShape(e.fromId);t&&Ly({editor:this.editor,arrow:t,terminal:e.props.terminal})}}w(om,"type","arrow"),w(om,"props",zD),w(om,"migrations",WD);function jF(n,e){var x;const t=n.getShape(e);if(!t)return;const s=Cs(n,t),{start:i,end:r}=s,o=i?n.getShape(i.toId):void 0,l=r?n.getShape(r.toId):void 0,c=n.getAncestorPageId(t);if(!c)return;let d;if(o&&l)d=n.findCommonAncestor([o,l])??c;else if(o||l){const y=(x=o||l)==null?void 0:x.parentId;y&&y===t.parentId?d=t.parentId:d=c}else return;d&&d!==t.parentId&&n.reparentShapes([e],d);const u=n.getShape(e);if(!u)throw Error("no reparented arrow");const h=n.getShapeNearestSibling(u,o),p=n.getShapeNearestSibling(u,l);let f;if(h&&p)f=h.index>p.index?h:p;else if(h&&!p)f=h;else if(p&&!h)f=p;else return;let g;const m=n.getSortedChildIdsForParent(f.parentId).map(y=>n.getShape(y)).filter(y=>y.index>f.index);if(m.length){const y=m.find(S=>S.type!=="arrow");if(u.index>f.index&&(!y||u.index<y.index))return;g=ep(f.index,m[0].index)}else g=Li(f.index);g!==u.index&&n.updateShapes([{id:e,type:"arrow",index:g}])}function vw(n,e){const t=Cs(n,e);for(const s of["start","end"]){const i=t[s];if(!i)continue;const r=n.getShape(i.toId),o=n.getAncestorPageId(e)===n.getAncestorPageId(r);(!r||!o)&&Ly({editor:n,arrow:e,terminal:s,unbind:!0})}jF(n,e.id)}function Ly({editor:n,arrow:e,terminal:t,unbind:s=!1,useHandle:i=!1}){const r=yr(n,e);if(!r)throw new Error("expected arrow info");const o=i?r.start.handle:r.start.point,l=i?r.end.handle:r.end.point,c=t==="start"?o:l,d={id:e.id,type:"arrow",props:{[t]:{x:c.x,y:c.y},bend:e.props.bend}};if(!r.isStraight){const u=t==="start"?o:r.start.handle,h=t==="end"?l:r.end.handle,p=_.Med(u,h),f=_.Sub(u,h).per().uni().mul(r.handleArc.radius*2*Math.sign(e.props.bend)),g=$p(r.handleArc.center,_.Add(p,f),r.handleArc.center,r.handleArc.radius);mt((g==null?void 0:g.length)===1);const m=_.Dist(p,g[0])*Math.sign(e.props.bend);wa(m,d.props.bend)||(d.props.bend=m)}n.updateShape(d),s&&rm(n,e,t)}const NF=[om],In={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},cn={s:2,m:3.5,l:5,xl:10},xd={s:18,m:24,l:36,xl:44},ho={s:18,m:22,l:26,xl:32},gie={s:18,m:20,l:24,xl:28},Tr={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},mie=20,yie=4.25,di=16;/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function vie(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var s,i,r,o,l=[],c=!0,d=!1;try{if(r=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(s=r.call(t)).done)&&(l.push(s.value),l.length!==e);c=!0);}catch(u){d=!0,i=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(d)throw i}}return l}}function MA(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,s)}return t}function Us(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?MA(Object(t),!0).forEach(function(s){xie(n,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):MA(Object(t)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(t,s))})}return n}function xie(n,e,t){return e=Pie(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Sie(n,e){if(n==null)return{};var t={},s=Object.keys(n),i,r;for(r=0;r<s.length;r++)i=s[r],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function wie(n,e){if(n==null)return{};var t=Sie(n,e),s,i;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(n,s)&&(t[s]=n[s])}return t}function OA(n,e){return _ie(n)||vie(n,e)||RF(n,e)||Tie()}function rg(n){return bie(n)||Cie(n)||RF(n)||Eie()}function bie(n){if(Array.isArray(n))return r_(n)}function _ie(n){if(Array.isArray(n))return n}function Cie(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function RF(n,e){if(n){if(typeof n=="string")return r_(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return r_(n,e)}}function r_(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,s=new Array(e);t<e;t++)s[t]=n[t];return s}function Eie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Iie(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var s=t.call(n,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Pie(n){var e=Iie(n,"string");return typeof e=="symbol"?e:String(e)}function Ch(n){var e=n.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),s=Math.max(Math.ceil(e[1]),1),i=[t-1,s-1,1,1],r=Date.now(),o=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,l,c;o?(l=new OffscreenCanvas(1,1),c=new OffscreenCanvas(t,s)):(l=document.createElement("canvas"),l.width=1,l.height=1,c=document.createElement("canvas"),c.width=t,c.height=s);var d=l.getContext("2d"),u=c.getContext("2d");u&&(u.fillRect.apply(u,i),d.drawImage(c,t-1,s-1,1,1,0,0,1,1));var h=d&&d.getImageData(0,0,1,1).data[3]!==0,p=Date.now()-r;return[l,c].forEach(function(f){f.height=0,f.width=0}),o?(postMessage({width:t,height:s,benchmark:p,isTestPass:h}),!h&&n.sizes.length&&Ch(n)):h?n.onSuccess(t,s,p):(n.onError(t,s,p),n.sizes.length&&Ch(n)),h}var xw={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},kie=["onError","onSuccess"],zc={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Iu={};function Sw(n){var e=n.width===n.height,t=n.height===1,s=n.width===1,i=[];if(!n.width||!n.height)n.sizes.forEach(function(u){var h=e||t?u:1,p=e||s?u:1;i.push([h,p])});else for(var r=n.min||zc.min,o=n.step||zc.step,l=Math.max(n.width,n.height);l>=r;){var c=e||t?l:1,d=e||s?l:1;i.push([c,d]),l-=o}return i}function og(n){var e=window&&"HTMLCanvasElement"in window,t=window&&"OffscreenCanvas"in window,s=Date.now(),i=n.onError,r=n.onSuccess,o=wie(n,kie),l=null;if(!e)return!1;if(n.useWorker&&t){var c=`
            var canvasTest = `.concat(Ch.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),d=new Blob([c],{type:"application/javascript"}),u=URL.createObjectURL(d);l=new Worker(u),URL.revokeObjectURL(u),l.onmessage=function(h){var p=h.data,f=p.width,g=p.height,m=p.benchmark,x=p.isTestPass;x?(Iu[s].onSuccess(f,g,m),delete Iu[s]):Iu[s].onError(f,g,m)}}if(n.usePromise)return new Promise(function(h,p){var f=Us(Us({},n),{},{onError:function(y,S,v){var C;if(n.sizes.length===0)C=!0;else{var T=n.sizes.slice(-1),I=OA(T,1),E=OA(I[0],2),P=E[0],k=E[1];C=y===P&&S===k}i(y,S,v),C&&p({width:y,height:S,benchmark:v})},onSuccess:function(y,S,v){r(y,S,v),h({width:y,height:S,benchmark:v})}});if(l){var g=f.onError,m=f.onSuccess;Iu[s]={onError:g,onSuccess:m},l.postMessage(o)}else Ch(f)});if(l)Iu[s]={onError:i,onSuccess:r},l.postMessage(o);else return Ch(n)}var ww={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Sw({width:e.max,height:e.max,min:e.min,step:e.step,sizes:rg(xw.area)}),s=Us(Us(Us({},zc),e),{},{sizes:t});return og(s)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Sw({width:1,height:e.max,min:e.min,step:e.step,sizes:rg(xw.height)}),s=Us(Us(Us({},zc),e),{},{sizes:t});return og(s)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Sw({width:e.max,height:1,min:e.min,step:e.step,sizes:rg(xw.width)}),s=Us(Us(Us({},zc),e),{},{sizes:t});return og(s)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Us(Us({},zc),e);return t.sizes=rg(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),og(t)}};let bw=null;function Aie(){return bw||(bw=jie()),bw}async function jie(){const n=await ww.maxWidth({usePromise:!0}),e=await ww.maxHeight({usePromise:!0}),t=await ww.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:t.width*t.height}}const DA=8192,Nie=4096*4096;async function Rie(n,e){if(n<=DA&&e<=DA&&n*e<=Nie)return[n,e];const{maxWidth:t,maxHeight:s,maxArea:i}=await Aie(),r=n/e;if(n>t&&(n=t,e=n/r),e>s&&(e=s,n=e*r),n*e>i){const o=Math.sqrt(i/(n*e));n*=o,e*=o}return[n,e]}function Mie(n,e){const t=n.w/e.w,s=n.h/e.h;return t<=1&&s<=1?n:t>s?{w:n.w/t,h:n.h/t}:{w:n.w/s,h:n.h/s}}function Oie(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Die(n){const e=new URL(n).host.replace("www.","");for(const t of Op)if(MF(t.hostnames,e)){const s=t.fromEmbedUrl(n);if(s)return{definition:t,url:s,embedUrl:n}}}const Lie=n=>n.split("*").map(e=>Oie(e)).join(".+"),MF=(n,e)=>!!n.find(t=>{const s=new RegExp(Lie(t));return e.match(s)});function Fie(n){const e=new URL(n).host.replace("www.","");for(const t of Op)if(MF(t.hostnames,e)){const s=t.toEmbedUrl(n);if(s)return{definition:t,embedUrl:s,url:n}}}function OF(n){return Fie(n)??Die(n)}function da(n){try{return OF(n)}catch(e){console.error(e)}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const Wc="  ",es=class es{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const s=e.ownerDocument,i=s.activeElement;i!==e&&e.focus(),s.execCommand("insertText",!1,t)||es.insertTextFirefox(e,t),i===s.body?e.blur():i instanceof HTMLElement&&i!==e&&i.focus()}static set(e,t){e.select(),es.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:s}=e;return e.value.slice(t||void 0,s||void 0)}static wrapSelection(e,t,s){const{selectionStart:i,selectionEnd:r}=e,o=es.getSelection(e);es.insert(e,t+o+(s??t)),e.selectionStart=(i||0)+t.length,e.selectionEnd=(r||0)+t.length}static replace(e,t,s){let i=0;e.value.replace(t,(...r)=>{const o=i+r[r.length-2],l=r[0].length;e.selectionStart=o,e.selectionEnd=o+l;const c=typeof s=="string"?s:s(...r);return es.insert(e,c),e.selectionStart=o,i+=c.length-l,c})}static findLineEnd(e,t){const s=e.lastIndexOf(`
`,t-1)+1;return e.charAt(s)!=="	"?t:s+1}static indent(e){var l;const{selectionStart:t,selectionEnd:s,value:i}=e,r=i.slice(t,s),o=(l=/\n/g.exec(r))==null?void 0:l.length;if(o&&o>0){const c=i.lastIndexOf(`
`,t-1)+1,d=e.value.slice(c,s-1),u=d.replace(/^|\n/g,`$&${Wc}`),h=u.length-d.length;e.setSelectionRange(c,s-1),es.insert(e,u),e.setSelectionRange(t+1,s+h)}else es.insert(e,Wc)}static unindent(e){const{selectionStart:t,selectionEnd:s,value:i}=e,r=i.lastIndexOf(`
`,t-1)+1,o=es.findLineEnd(i,s),l=e.value.slice(r,o),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=l.length-c.length;e.setSelectionRange(r,o),es.insert(e,c);const u=/\t| {1,2}/.exec(i.slice(r,t)),h=u?u[0].length:0,p=t-h;e.setSelectionRange(t-h,Math.max(p,s-d))}static indentCE(e){var c;const t=window.getSelection(),s=e.innerText,i=ag(e)??0,r=ag(e)??0,o=s.slice(i,r),l=(c=/\n/g.exec(o))==null?void 0:c.length;if(l&&l>0){const d=s.lastIndexOf(`
`,i-1)+1,u=s.slice(d,r-1),p=u.replace(/^|\n/g,`$&${Wc}`).length-u.length;t&&t.setBaseAndExtent(e,i+1,e,r+p)}else{const d=window.getSelection();e.innerText=s.slice(0,i)+Wc+s.slice(i),d==null||d.setBaseAndExtent(e,i+1,e,i+2)}}static unindentCE(e){const t=window.getSelection(),s=e.innerText,i=ag(e)??0,r=ag(e)??0,o=s.lastIndexOf(`
`,i-1)+1,l=es.findLineEnd(s,r),c=s.slice(o,l),d=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=c.length-d.length;if(t){t.setBaseAndExtent(e,o,e,l);const h=/\t| {1,2}/.exec(s.slice(o,i)),p=h?h[0].length:0,f=i-p;t.setBaseAndExtent(e,i-p,e,Math.max(f,r-u))}}static normalizeText(e){return e.replace(es.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(es.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};w(es,"fixNewLines",/\r?\n|\r/g);let Sd=es;function ag(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const s=e.getRangeAt(0),i=s.cloneRange();i.selectNodeContents(n),i.setEnd(s.endContainer,s.endOffset),t=i.toString().length}return t}const Bie=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function DF(n){return Bie.test(n)}function Uie(n){return n.replace(/\t/g,Wc)}function $ie(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const s of e)if(s.trim().length>0){const i=s.length-s.trimStart().length;t=Math.min(t,i)}return e.map(s=>s.slice(t)).join(`
`)}function zie(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function Wie(n){return zie($ie(Uie(n)))}function Hie(n,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:i},{toasts:r,msg:o}){n.registerExternalAssetHandler("file",async({file:l})=>{const c=l.name;let d=l;const u=s.includes(d.type),h=i.includes(d.type);!u&&!h&&r.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),mt(u||h,`File type not allowed: ${d.type}`),d.size>t&&r.addToast({title:o("assets.files.size-too-big"),severity:"error"}),mt(d.size<=t,`File size too big: ${(d.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),d.type==="video/quicktime"&&(d=new File([d],d.name,{type:"video/mp4"}));let p=u?await gr.getImageSize(d):await gr.getVideoSize(d);const f=await gr.isAnimated(d)||h,g=gZ(await d.arrayBuffer());if(isFinite(e)){const y=Mie(p,{w:e,h:e});p!==y&&gr.isStaticImageType(d.type)&&(p=y)}const x={id:fl.createId(g),type:u?"image":"video",typeName:"asset",props:{name:c,src:"",w:p.w,h:p.h,fileSize:d.size,mimeType:d.type,isAnimated:f}};return x.props.src=await n.uploadAsset(x,d),fl.create(x)}),n.registerExternalAssetHandler("url",async({url:l})=>{var d,u,h,p,f;let c;try{const m=await(await Ar(l,{method:"GET",mode:"no-cors"})).text(),x=new DOMParser().parseFromString(m,"text/html");c={image:((d=x.head.querySelector('meta[property="og:image"]'))==null?void 0:d.getAttribute("content"))??"",favicon:((u=x.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:u.getAttribute("href"))??((h=x.head.querySelector('link[rel="icon"]'))==null?void 0:h.getAttribute("href"))??"",title:((p=x.head.querySelector('meta[property="og:title"]'))==null?void 0:p.getAttribute("content"))??l,description:((f=x.head.querySelector('meta[property="og:description"]'))==null?void 0:f.getAttribute("content"))??""},c.image.startsWith("http")||(c.image=new URL(c.image,l).href),c.favicon.startsWith("http")||(c.favicon=new URL(c.favicon,l).href)}catch(g){console.error(g),r.addToast({title:o("assets.url.failed"),severity:"error"}),c={image:"",favicon:"",title:"",description:""}}return{id:fl.createId(B0(l)),typeName:"asset",type:"bookmark",props:{src:l,description:c.description,image:c.image,favicon:c.favicon,title:c.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:l,text:c})=>{const d=l??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=new DOMParser().parseFromString(c,"image/svg+xml").querySelector("svg");if(!u)throw new Error("No <svg/> element present");let h=parseFloat(u.getAttribute("width")||"0"),p=parseFloat(u.getAttribute("height")||"0");if(!(h&&p)){document.body.appendChild(u);const g=u.getBoundingClientRect();document.body.removeChild(u),h=g.width,p=g.height}const f=await n.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});if(!f)throw Error("Could not create an asset");LA(n,[f],d)}),n.registerExternalContentHandler("embed",({point:l,url:c,embed:d})=>{const u=l??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),{width:h,height:p}=d,f=st(),g={id:f,type:"embed",x:u.x-(h||450)/2,y:u.y-(p||450)/2,props:{w:h,h:p,url:c}};n.createShapes([g]).select(f)}),n.registerExternalContentHandler("files",async({point:l,files:c})=>{const d=l??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=new _(d.x,d.y),h=[];await Promise.all(c.map(async(p,f)=>{if(p.size>t)return r.addToast({title:o("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(p.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`),null;if(!p.type)throw new Error("No mime type");if(!s.concat(i).includes(p.type))return r.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${p.name} not loaded - Extension not allowed.`),null;try{const g=await n.getAssetForExternalContent({type:"file",file:p});if(!g)throw Error("Could not create an asset");h[f]=g}catch(g){return r.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(g),null}})),LA(n,Ne(h),u)}),n.registerExternalContentHandler("text",async({point:l,text:c})=>{const d=l??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=n.getShapeUtil("text").getDefaultProps(),h=Wie(c),p=n.getOnlySelectedShape();if(p&&"text"in p.props){n.updateShapes([{id:p.id,type:p.type,props:{text:h}}]);return}let f,g,m,x="middle";const y=h.split(`
`).length>1,S=DF(h);y&&(x=y?S?"end":"start":"middle");const v=n.textMeasure.measureText(h,{...In,fontFamily:Tr[u.font],fontSize:xd[u.size],maxWidth:null}),C=Math.min(y?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(v.w>C){const T=n.textMeasure.measureText(h,{...In,fontFamily:Tr[u.font],fontSize:xd[u.size],maxWidth:C});f=T.w,g=T.h,m=!1,x=S?"end":"start"}else f=v.w,g=v.h,m=!0;d.y-g/2<n.getViewportPageBounds().minY+40&&(d.y=n.getViewportPageBounds().minY+40+g/2),n.createShapes([{id:st(),type:"text",x:d.x-f/2,y:d.y-g/2,props:{text:h,textAlign:x,autoSize:m,w:f}}])}),n.registerExternalContentHandler("url",async({point:l,url:c})=>{const d=da(c);if(d)return n.putExternalContent({type:"embed",url:d.url,point:l,embed:d.definition});const u=l??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),h=fl.createId(B0(c)),p=Gie(n,c,u);let f=n.getAsset(h),g=!1;if(!f){g=!0;try{const m=await n.getAssetForExternalContent({type:"url",url:c});if(!m)throw Error("Could not create an asset");f=m}catch{r.addToast({title:o("assets.url.failed"),severity:"error"});return}}n.run(()=>{g&&n.createAssets([f]),n.updateShapes([{id:p.id,type:p.type,props:{assetId:f.id}}])})})}async function LA(n,e,t){if(!e.length)return[];const s=_.From(t),i=[];for(let r=0;r<e.length;r++){const o=e[r];switch(o.type){case"bookmark":{i.push({id:st(),type:"bookmark",x:s.x,y:s.y,opacity:1,props:{assetId:o.id,url:o.props.src}}),s.x+=300;break}case"image":{i.push({id:st(),type:"image",x:s.x,y:s.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),s.x+=o.props.w;break}case"video":i.push({id:st(),type:"video",x:s.x,y:s.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),s.x+=o.props.w}}return n.run(()=>{const r=e.filter(o=>!n.getAsset(o.id));r.length&&n.createAssets(r),n.createShapes(i).select(...i.map(o=>o.id)),LF(n,t)}),i.map(r=>r.id)}function LF(n,e){const t=n.getViewportPageBounds();let s=n.getSelectionPageBounds();if(s){const i=s.center.sub(e);n.updateShapes(n.getSelectedShapes().map(r=>{const o=n.getShapeParentTransform(r).decompose().rotation,l=_.Rot(i,-o);return{id:r.id,type:r.type,x:r.x-l.x,y:r.y-l.y}}))}s=n.getSelectionPageBounds(),s&&!t.contains(s)&&n.zoomToSelection()}function Gie(n,e,t){const s={id:st(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return n.run(()=>{n.createShapes([s]).select(s.id),LF(n,t)}),n.getShape(s.id)}var hb;let Vie=(hb=class extends ye{constructor(){super(...arguments);w(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")});w(this,"onKeyUp",t=>{var s;if(t.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape",{...t,target:"shape",shape:i}))}})}},w(hb,"id","idle"),hb);var pb;let Kie=(pb=class extends ye{constructor(){super(...arguments);w(this,"shape");w(this,"markId","");w(this,"onEnter",()=>{this.didTimeout=!1;const t=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:s=>!s.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:s,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});t?this.editor.setHintingShapes([t.id]):this.createArrowShape(),this.startPreciseTimeout()});w(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()});w(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,onInteractionEnd:"arrow"})}});w(this,"onPointerUp",()=>{this.cancel()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()});w(this,"preciseTimeout",-1);w(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var u;const{originPagePoint:t}=this.editor.inputs,s=st();this.markId=`creating:${s}`,this.editor.mark(this.markId),this.editor.createShape({id:s,type:"arrow",x:t.x,y:t.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(s);if(!i)throw Error("expected shape");const r=this.editor.getShapeHandles(i);if(!r)throw Error("expected handles for arrow");const o=this.editor.getShapeUtil("arrow"),l=this.shape,c=r.find(h=>h.id==="start"),d=(u=o.onHandleDrag)==null?void 0:u.call(o,i,{handle:{...c,x:0,y:0},isPrecise:!0,initial:l});d&&this.editor.updateShapes([d]),this.shape=this.editor.getShape(s),this.editor.select(s)}updateArrowShapeEndHandle(){var i,r;const t=this.shape;if(!t)throw Error("expected shape");const s=this.editor.getShapeHandles(t);if(!s)throw Error("expected handles for arrow");{const o=this.editor.getShapeUtil("arrow"),l=this.shape,c=s.find(u=>u.id==="start"),d=(i=o.onHandleDrag)==null?void 0:i.call(o,t,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:l});d&&this.editor.updateShapes([d])}{const o=this.editor.getShapeUtil("arrow"),l=this.shape,c=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),d=s.find(h=>h.id==="end"),u=(r=o.onHandleDrag)==null?void 0:r.call(o,this.editor.getShape(t),{handle:{...d,x:c.x,y:c.y},isPrecise:!1,initial:l});u&&this.editor.updateShapes([u])}this.shape=this.editor.getShape(t.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},w(pb,"id","pointing"),pb);class am extends ye{constructor(){super(...arguments);w(this,"shapeType","arrow")}}w(am,"id","arrow"),w(am,"initial","idle"),w(am,"children",()=>[Vie,Kie]);class c1 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"initialShape");w(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");w(this,"util",this.editor.getShapeUtil(this.shapeType));w(this,"isPen",!1);w(this,"isPenOrStylus",!1);w(this,"segmentMode","free");w(this,"didJustShiftClickToExtendPreviousShapeLine",!1);w(this,"pagePointWhereCurrentSegmentChanged",{});w(this,"pagePointWhereNextSegmentChanged",null);w(this,"lastRecordedPoint",{});w(this,"mergeNextPoint",!1);w(this,"currentLineLength",0);w(this,"canDraw",!1);w(this,"markId",null);w(this,"onEnter",t=>{this.markId=null,this.info=t,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});w(this,"onPointerMove",()=>{const{inputs:t}=this.editor;if(this.isPen&&!t.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&t.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(this.isPenOrStylus?_.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape())});w(this,"onKeyDown",t=>{if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()});w(this,"onKeyUp",t=>{if(t.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()});w(this,"onExit",()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,s,i){if(!this.canClose())return!1;const r=cn[s],o=t[0].points[0],l=t[t.length-1],c=l.points[l.points.length-1];return o!==c&&this.currentLineLength>r*4*i&&_.DistMin(o,c,r*2*i)}startShape(){const{inputs:{originPagePoint:t,isPen:s}}=this.editor;this.markId="draw start "+Rt(),this.editor.mark(this.markId);const{z:i=.5}=this.info.point;this.isPen=s,this.isPenOrStylus=s||i>0&&i<.5||i>.5&&i<1;const r=this.isPenOrStylus?i*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const l=this.editor.getShape(this.initialShape.id);if(l&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const c=wn(l.props.segments);if(!c)throw Error("Expected a previous segment!");const d=wn(c.points);if(!d)throw Error("Expected a previous point!");const{x:u,y:h}=this.editor.getPointInShapeSpace(l,t).toFixed(),p={type:this.segmentMode,points:[{x:d.x,y:d.y,z:+r.toFixed(2)},{x:u,y:h,z:+r.toFixed(2)}]},f=ve.applyToPoint(this.editor.getShapePageTransform(l.id),d);this.pagePointWhereCurrentSegmentChanged=f,this.pagePointWhereNextSegmentChanged=null;const g=[...l.props.segments,p];this.currentLineLength<cn[l.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const m={id:l.id,type:this.shapeType,props:{segments:g}};this.canClose()&&(m.props.isClosed=this.getIsClosed(g,l.props.size,l.props.scale)),this.editor.updateShapes([m]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const o=st();this.editor.createShapes([{id:o,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+r.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateDrawingShape(){const{initialShape:t}=this,{inputs:s}=this.editor;if(!t)return;const{id:i,props:{size:r,scale:o}}=t,l=this.editor.getShape(i);if(!l)return;const{segments:c}=l.props,{x:d,y:u,z:h}=this.editor.getPointInShapeSpace(l,s.currentPagePoint).toFixed(),p=this.isPenOrStylus?+(s.currentPagePoint.z*1.25).toFixed(2):.5,f={x:d,y:u,z:p};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(_.Dist2(g,s.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const x=wn(c);if(!x)throw Error("Expected a previous segment!");const y=wn(x.points);if(!y)throw Error("Expected a previous last point!");let S;const v=this.editor.getPointInShapeSpace(l,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(x.type==="straight"){this.currentLineLength+=_.Dist(y,v),S={type:"straight",points:[{...y},v]};const T=this.editor.getShapePageTransform(l);this.pagePointWhereCurrentSegmentChanged=ve.applyToPoint(T,y)}else S={type:"straight",points:[v,f]};const C={id:i,type:this.shapeType,props:{segments:[...c,S]}};this.canClose()&&(C.props.isClosed=this.getIsClosed(c,r,o)),this.editor.updateShapes([C])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(_.Dist2(g,s.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const x=c.slice(),y=x[x.length-1],S=wn(y.points);if(!S)throw Error("No previous point!");const v={type:"free",points:[..._.PointsBetween(S,f,6).map(I=>({x:qr(I.x),y:qr(I.y),z:qr(I.z)}))]},C=[...x,v];this.currentLineLength<cn[l.props.size]*4&&(this.currentLineLength=this.getLineLength(C));const T={id:i,type:this.shapeType,props:{segments:C}};this.canClose()&&(T.props.isClosed=this.getIsClosed(C,r,o)),this.editor.updateShapes([T])}break}case"straight":{const g=c.slice(),m=g[g.length-1],{pagePointWhereCurrentSegmentChanged:x}=this,{ctrlKey:y,currentPagePoint:S}=this.editor.inputs;if(!x)throw Error("We should have a point where the segment changed");let v,C=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(C=!y,this.didJustShiftClickToExtendPreviousShapeLine=!1):C=!y;let T=this.editor.getPointInShapeSpace(l,S).toFixed().toJson(),I=!1,E;if((this.editor.user.getIsSnapMode()?!y:y)&&g.length>2){let j,D=8/this.editor.getZoomLevel();for(let R=0,A=c.length-2;R<A;R++){const N=c[R];if(!N)break;if(N.type==="free")continue;const B=N.points[0],L=wn(N.points);if(!(B&&L))continue;const O=_.NearestPointOnLineSegment(B,L,T);if(_.DistMin(O,T,D)){j=O.toFixed().toJson(),D=_.Dist(O,T),E=N;break}}j&&(I=!0,T=j)}if(I&&E){const j=this.editor.getShapePageTransform(l),D=E.points[0],R=wn(E.points);if(!R)throw Error("Expected a last point!");const A=ve.applyToPoint(j,D),N=ve.applyToPoint(j,R),B=ve.applyToPoint(j,T);this.editor.snaps.setIndicators([{id:Rt(),type:"points",points:[A,B,N]}])}else{if(this.editor.snaps.clearIndicators(),C){const j=_.Angle(x,S),R=ky(j,24)-j;v=_.RotWith(S,x,R)}else v=S;T=this.editor.getPointInShapeSpace(l,v).toFixed().toJson()}this.currentLineLength+=_.Dist(m.points[0],T),g[g.length-1]={...m,type:"straight",points:[m.points[0],T]};const k={id:i,type:this.shapeType,props:{segments:g}};this.canClose()&&(k.props.isClosed=this.getIsClosed(c,r,o)),this.editor.updateShapes([k]);break}case"free":{const g=c.slice(),m=g[g.length-1],x=[...m.points];if(x.length&&this.mergeNextPoint){const{z:S}=x[x.length-1];x[x.length-1]={x:f.x,y:f.y,z:S?Math.max(S,f.z):f.z}}else this.currentLineLength+=_.Dist(x[x.length-1],f),x.push(f);g[g.length-1]={...m,points:x},this.currentLineLength<cn[l.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const y={id:i,type:this.shapeType,props:{segments:g}};if(this.canClose()&&(y.props.isClosed=this.getIsClosed(g,r,o)),this.editor.updateShapes([y]),x.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const S=st(),v=this.editor.getShape(i).props;this.editor.createShapes([{id:S,type:this.shapeType,x:qr(s.currentPagePoint.x),y:qr(s.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:v.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(h*1.25).toFixed():.5}]}]}}]),this.initialShape=ft(this.editor.getShape(S)),this.mergeNextPoint=!1,this.lastRecordedPoint=s.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let s=0;for(const i of t)for(let r=0;r<i.points.length-1;r++){const o=i.points[r],l=i.points[r+1];s+=_.Dist2(l,o)}return Math.sqrt(s)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}w(c1,"id","drawing");var fb;let FF=(fb=class extends ye{constructor(){super(...arguments);w(this,"onPointerDown",t=>{this.parent.transition("drawing",t)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(fb,"id","idle"),fb);class Xu extends ye{constructor(){super(...arguments);w(this,"shapeType","draw");w(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}w(Xu,"id","draw"),w(Xu,"initial","idle"),w(Xu,"isLockable",!1),w(Xu,"children",()=>[FF,c1]);class o_ extends im{constructor(){super(...arguments);w(this,"shapeType","frame");w(this,"onCreate",t=>{if(!t)return;const s=this.editor.getShapePageBounds(t),i=[],r=this.editor.getShapeAncestors(t).map(o=>o.id);this.editor.getSortedChildIdsForParent(t.parentId).map(o=>{const l=this.editor.getShape(o);if(!l||l.id===t.id||l.isLocked)return;const c=this.editor.getShapePageBounds(l);c&&s.contains(c)&&Yie(l,r,t)&&i.push(l.id)}),this.editor.reparentShapes(i,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")})}}w(o_,"id","frame"),w(o_,"initial","idle");function Yie(n,e,t){return e.includes(n.id)?!1:n.parentId===t.parentId}var gb;let Xie=(gb=class extends ye{constructor(){super(...arguments);w(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onKeyUp",t=>{var s;if(t.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape",{...t,target:"shape",shape:i}))}});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(gb,"id","idle"),gb);var mb;let qie=(mb=class extends ye{constructor(){super(...arguments);w(this,"markId","");w(this,"onPointerUp",()=>{this.complete()});w(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){const{originPagePoint:s}=this.editor.inputs,i=st();this.markId=`creating:${i}`,this.editor.mark(this.markId),this.editor.createShapes([{id:i,type:"geo",x:s.x,y:s.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(mi),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(i).setCurrentTool("select.resizing",{...t,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:t}=this.editor.inputs,s=st();this.markId=`creating:${s}`,this.editor.mark(this.markId);const i=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,r=this.editor.getStyleForNextShape(mi),o=r==="star"?{w:200,h:190}:r==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:s,type:"geo",x:t.x,y:t.y,props:{geo:this.editor.getStyleForNextShape(mi),scale:i,...o}}]);const l=this.editor.getShape(s);if(!l)return;const{w:c,h:d}=l.props,u=new _(c/2,d/2).mul(i),h=this.editor.getShapeParentTransform(l);h&&u.rot(-h.rotation()),this.editor.select(s),this.editor.updateShape({id:l.id,type:"geo",x:l.x-u.x,y:l.y-u.y,props:{geo:this.editor.getStyleForNextShape(mi),w:c*i,h:d*i}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},w(mb,"id","pointing"),mb);class lm extends ye{constructor(){super(...arguments);w(this,"shapeType","geo")}}w(lm,"id","geo"),w(lm,"initial","idle"),w(lm,"children",()=>[Xie,qie]);class qu extends ye{constructor(){super(...arguments);w(this,"shapeType","highlight");w(this,"onExit",()=>{const t=this.children.drawing;t.initialShape=void 0})}}w(qu,"id","highlight"),w(qu,"initial","idle"),w(qu,"children",()=>[FF,c1]),w(qu,"isLockable",!1);var yb;let Zie=(yb=class extends ye{constructor(){super(...arguments);w(this,"shapeId","");w(this,"onEnter",t=>{this.shapeId=t.shapeId,this.editor.setCursor({type:"cross",rotation:0})});w(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(yb,"id","idle"),yb);const FA=2;var vb;let Jie=(vb=class extends ye{constructor(){super(...arguments);w(this,"shape",{});w(this,"markId");w(this,"onEnter",t=>{const{inputs:s}=this.editor,{currentPagePoint:i}=s;this.markId=void 0;const r=t.shapeId&&this.editor.getShape(t.shapeId);if(r&&s.shiftKey){this.markId=`creating:${r.id}`,this.editor.mark(this.markId),this.shape=r;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const l=o.filter(f=>f.type==="vertex").sort(Hn),c=l[l.length-1],d=l[l.length-2],u=ve.applyToPoint(this.editor.getShapeParentTransform(this.shape),new _(this.shape.x,this.shape.y)),h=_.Sub(i,u).addXY(.1,.1),p=ft(this.shape.props.points);if(_.DistMin(c,d,FA)||_.DistMin(h,c,FA))p[c.id]={id:c.id,index:c.index,x:h.x,y:h.y};else{const f=Li(c.index);p[f]={id:f,index:f,x:h.x,y:h.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:p}}])}else{const o=st();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:"line",x:i.x,y:i.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(o),this.shape=this.editor.getShape(o)}});w(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const t=this.editor.getShapeHandles(this.shape);if(!t)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const s=wn(t);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...s,x:s.x-.1,y:s.y-.1},onInteractionEnd:"line"})}});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},w(vb,"id","pointing"),vb);class cm extends ye{constructor(){super(...arguments);w(this,"shapeType","line")}}w(cm,"id","line"),w(cm,"initial","idle"),w(cm,"children",()=>[Zie,Jie]);var xb;let Qie=(xb=class extends ye{constructor(){super(...arguments);w(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(xb,"id","idle"),xb);function ht(n,e){var i;const t=new Set;for(const r of e){const o=n.getShape(r);if(!o)continue;n.getShapeUtil(o).onDragShapesOut&&t.add(o);const l=n.getShape(o.parentId);l&&n.getShapeUtil(l).onDragShapesOut&&t.add(l)}const s=new Map;for(const r of t){const o=BF(n,r);o.length&&s.set(r,o)}for(const[r,o]of s){const l=n.getShapeUtil(r),c=Ne(o.map(d=>n.getShape(d)));(i=l.onDragShapesOut)==null||i.call(l,r,c)}}function BF(n,e){const t=n.getSortedChildIdsForParent(e.id);if(t.length===0)return[];const s=n.getShapePageBounds(e);if(!s)return[];let i,r,o;const l=[];for(const c of t){const d=n.getShapePageBounds(c);if(!d)continue;if(!s.includes(d)){l.push(c);continue}i??(i=n.getShapeGeometry(e)),r??(r=n.getShapePageTransform(e)),o??(o=r.applyToPoints(i.vertices));const u=n.getShapePageTransform(c).clone().invert().applyToPoints(o),{vertices:h,isClosed:p}=n.getShapeGeometry(c);if(!h.some(f=>Xs(f,u))){if(p){if(dF(u,h))continue}else if(Yte(u,h))continue;l.push(c)}}return l}function Fy(n,e,t=!1){n.select(e),n.setEditingShape(e),n.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),t&&n.emit("select-all-text",{shapeId:e.id}),UF(n)}const ere=16;function UF(n){const e=n.getSelectionPageBounds(),t=n.getViewportPageBounds();if(e&&!t.contains(e)){const s=e.clone().expandBy(ere/n.getZoomLevel()).expand(t),i=t.clone().translate({x:(s.center.x-t.center.x)*2,y:(s.center.y-t.center.y)*2});n.zoomToBounds(i,{animation:{duration:n.options.animationMediumMs},inset:0})}}const tre=0,at=200,lx=new _(at/2,at/2),$F=10,nre=n=>[[["a1"],new _(at*.5,at*-.5-n.options.adjacentShapeMargin)],[["a2"],new _(at*1.5+n.options.adjacentShapeMargin,at*.5)],[["a3"],new _(at*.5,at*1.5+n.options.adjacentShapeMargin)],[["a4"],new _(at*-.5-n.options.adjacentShapeMargin,at*.5)]];function sre(n,e){if(e===1)return nre(n);const t=at*e,s=n.options.adjacentShapeMargin*e;return[[["a1"],new _(t*.5,t*-.5-s)],[["a2"],new _(t*1.5+s,t*.5)],[["a3"],new _(t*.5,t*1.5+s)],[["a4"],new _(t*-.5-s,t*.5)]]}function zF(n,e,t,s,i,r){return Object.fromEntries(sre(n,r).map(([o,l],c)=>{const d=l.clone();return c===0&&i?d.y-=i:c===2&&s&&(d.y+=s),[o,d.rot(t).add(e)]}))}function WF(n,e,t,s){const i=new Set(n.getSelectedShapeIds()),r=(at+n.options.adjacentShapeMargin+s)**2,o=new Map,l=[];for(const u of n.getCurrentPageShapes()){if(!n.isShapeOfType(u,"note")||t!==u.props.scale||i.has(u.id))continue;const h=n.getShapePageTransform(u.id);e===h.rotation()&&(o.set(u,n.getShapePageBounds(u).center),l.push(...Object.values(zF(n,h.point(),e,u.props.growY,s,t))))}const c=l.length;let d;for(const[u,h]of o)for(let p=0;p<c;p++)d=l[p],d&&(_.Dist2(h,d)>r||n.isPointInShape(u,d)&&(l[p]=void 0));return Ne(l)}function HF(n,e,t,s,i=!1){let r;const o=n.getCurrentPageShapesSorted(),l=(at+n.options.adjacentShapeMargin**2)**e.props.scale;for(let c=o.length-1;c>=0;c--){const d=o[c];if(d.type==="note"&&d.id!==e.id){const u=n.getShapePageBounds(d);if(u&&_.Dist2(u.center,t)<l&&n.isPointInShape(d,t)){r=d;break}}}if(n.complete(),!r||i){n.mark("creating note shape");const c=st();n.createShape({id:c,type:"note",x:t.x,y:t.y,rotation:s,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const d=n.getShape(c);if(!d)return;const u=n.getPointInParentSpace(d,_.Sub(t,_.Rot(lx.clone().mul(d.props.scale),s)));n.updateShape({id:c,type:"note",x:u.x,y:u.y}),r=n.getShape(c)}return UF(n),r}var Sb;let ire=(Sb=class extends ye{constructor(){super(...arguments);w(this,"dragged",!1);w(this,"info",{});w(this,"wasFocusedOnEnter",!1);w(this,"markId","");w(this,"shape",{});w(this,"onEnter",()=>{const{editor:t}=this;if(this.wasFocusedOnEnter=!t.getIsMenuOpen(),this.wasFocusedOnEnter){const s=st();this.markId=`creating:${s}`,t.mark(this.markId);const i=this.editor.inputs.originPagePoint.clone(),r=BA(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);r&&i.sub(r),this.shape=UA(this.editor,s,i)}});w(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){if(!this.wasFocusedOnEnter){const s=st(),i=this.editor.inputs.originPagePoint.clone(),r=BA(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);r&&i.sub(r),this.shape=UA(this.editor,s,i)}this.editor.setCurrentTool("select.translating",{...t,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}});w(this,"onPointerUp",()=>{this.complete()});w(this,"onInterrupt",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},w(Sb,"id","pointing"),Sb);function BA(n,e,t){let s=$F/n.getZoomLevel(),i;for(const r of WF(n,0,t,0)){const o=_.Sub(e,r),l=o.len();l<s&&(s=l,i=o)}return i}function UA(n,e,t){n.createShape({id:e,type:"note",x:t.x,y:t.y,props:{scale:n.user.getIsDynamicResizeMode()?1/n.getZoomLevel():1}}).select(e);const s=n.getShape(e),i=n.getShapeGeometry(s).bounds;return n.updateShapes([{id:e,type:"note",x:s.x-i.width/2,y:s.y-i.height/2}]),n.getShape(e)}class dm extends ye{constructor(){super(...arguments);w(this,"shapeType","note")}}w(dm,"id","note"),w(dm,"initial","idle"),w(dm,"children",()=>[Qie,ire]);function rre(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let t;const s=n.getOutermostSelectableShape(e);return s===e||s.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(s.id)?t=e:t=s,n.setHoveredShape(t.id)}const so=sD(rre,32);var wb;let ore=(wb=class extends ye{constructor(){super(...arguments);w(this,"onPointerMove",t=>{switch(t.target){case"shape":case"canvas":so(this.editor)}});w(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})});w(this,"onExit",()=>{so.cancel()});w(this,"onKeyDown",t=>{var s;if(t.key==="Enter"){if(this.editor.getInstanceState().isReadonly)return null;const i=this.editor.getOnlySelectedShape();i&&this.editor.getShapeUtil(i).canEdit(i)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(i.id),(s=this.editor.root.getCurrent())==null||s.transition("editing_shape",{...t,target:"shape",shape:i}))}});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(wb,"id","idle"),wb);var bb;let are=(bb=class extends ye{constructor(){super(...arguments);w(this,"shape");w(this,"markId","");w(this,"onExit",()=>{this.editor.setHintingShapes([])});w(this,"onPointerMove",t=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:s}}=this.editor,i=st();this.markId=`creating:${i}`,this.editor.mark(this.markId);const r=this.createTextShape(i,s,!1);if(!r){this.cancel();return}this.shape=this.editor.getShape(r),this.editor.select(i),this.editor.setCurrentTool("select.resizing",{...t,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:18,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(r.id),this.editor.setCurrentTool("select.editing_shape")}})}});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.cancel()});w(this,"onCancel",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}complete(){var r;this.editor.mark("creating text shape");const t=st(),{currentPagePoint:s}=this.editor.inputs;this.createTextShape(t,s,!0)&&(this.editor.select(t),this.editor.setEditingShape(t),this.editor.setCurrentTool("select"),(r=this.editor.root.getCurrent())==null||r.transition("editing_shape"))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(t,s,i){this.editor.createShape({id:t,type:"text",x:s.x,y:s.y,props:{text:"",autoSize:i,w:20,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const r=this.editor.getShape(t);if(!r){this.cancel();return}const o=this.editor.getShapePageBounds(r),l=new _;if(i)switch(r.props.textAlign){case"start":{l.x=0;break}case"middle":{l.x=-o.width/2;break}case"end":{l.x=-o.width;break}}else l.x=0;if(l.y=-o.height/2,Ss(r.parentId)){const c=this.editor.getShapeParentTransform(r);l.rot(-c.rotation())}return this.editor.updateShape({...r,x:r.x+l.x,y:r.y+l.y}),r}},w(bb,"id","pointing"),bb);class Zu extends ye{constructor(){super(...arguments);w(this,"shapeType","text")}}w(Zu,"id","text"),w(Zu,"initial","idle"),w(Zu,"children",()=>[ore,are]),w(Zu,"isLockable",!1);const lre=[Zu,Xu,lm,dm,cm,o_,am,qu];function Pi(){return No({isDarkMode:Wp()})}function cx(n){return{key:`${jr.id}:${n}`,getElement:async()=>{const e=cre(n);if(!e)return null;const t=e.$$_url,s=e.$$_fontface;if(!t||!s)return null;const i=await(await Ar(t)).blob(),r=await wl.blobToDataUrl(i),o=s.replace(t,r);return a.jsx("style",{children:o})}}}function cre(n){const e=FD[n];for(const t of document.fonts)if(e.includes(t.family))return t;return null}function d1(n){return{key:`${jr.id}:${n}`,getElement:async()=>n!=="pattern"?null:a.jsx(dre,{})}}function dre(){const n=Pi(),e=8/12;return a.jsxs(a.Fragment,{children:[a.jsxs("mask",{id:"hash_pattern_mask",children:[a.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),a.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[a.jsx("line",{x1:e*1,y1:e*3,x2:e*3,y2:e*1}),a.jsx("line",{x1:e*5,y1:e*7,x2:e*7,y2:e*5}),a.jsx("line",{x1:e*9,y1:e*11,x2:e*11,y2:e*9})]})]}),a.jsx("pattern",{id:By(1,n.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:a.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:n.solid,mask:"url(#hash_pattern_mask)"})})]})}function u1(){return{key:`${jr.id}:pattern`,component:fre}}const Ju=8,$A=(n,e,t)=>new Promise((s,i)=>{const r=Ju*e*n,o=document.createElement("canvas");o.width=r,o.height=r;const l=o.getContext("2d");if(!l)return;l.fillStyle=t?by.darkMode.solid:by.lightMode.solid,l.fillRect(0,0,r,r),l.globalCompositeOperation="destination-out",l.lineCap="round",l.lineWidth=1.25*e*n;const c=8/12,d=u=>u*e*n;l.beginPath(),l.moveTo(d(c*1),d(c*3)),l.lineTo(d(c*3),d(c*1)),l.moveTo(d(c*5),d(c*7)),l.lineTo(d(c*7),d(c*5)),l.moveTo(d(c*9),d(c*11)),l.lineTo(d(c*11),d(c*9)),l.stroke(),o.toBlob(u=>{!u||Gt.throwToBlob.get()?i():s(u)})}),zA=(n,e)=>{const t=document.createElement("canvas");t.width=n[0],t.height=n[1];const s=t.getContext("2d");return s?(e(s),t.toDataURL()):""};let _w=null;function ure(){return _w||(_w={white:zA([1,1],n=>{n.fillStyle="#f8f9fa",n.fillRect(0,0,1,1)}),black:zA([1,1],n=>{n.fillStyle="#212529",n.fillRect(0,0,1,1)})}),_w}function GF(n){return Math.ceil(Math.log2(Math.max(1,n)))}function By(n,e){const t=GF(n);return`tldraw_hash_pattern_${e}_${t}`}function VF(n){const e=[],s=GF(n);for(let i=0;i<=s;i++)e.push(Math.pow(2,i));return e}function hre(n){const e=ure();return VF(n).flatMap(t=>[{zoom:t,url:e.white,theme:"light"},{zoom:t,url:e.black,theme:"dark"}])}function pre(){const n=G(),e=q("devicePixelRatio",()=>n.getInstanceState().devicePixelRatio,[n]),t=q("maxZoom",()=>Math.ceil(wn(n.getCameraOptions().zoomSteps)),[n]),[s,i]=b.useState(!1),[r,o]=b.useState(()=>hre(t));return b.useEffect(()=>{const c=Promise.all(VF(t).flatMap(u=>[$A(e,u,!1).then(h=>({zoom:u,theme:"light",url:URL.createObjectURL(h)})),$A(e,u,!0).then(h=>({zoom:u,theme:"dark",url:URL.createObjectURL(h)}))]));let d=!1;return c.then(u=>{d||(o(u),i(!0))}),()=>{d=!0,i(!1),c.then(u=>{for(const{url:h}of u)URL.revokeObjectURL(h)})}},[e,t]),{defs:a.jsx(a.Fragment,{children:r.map(c=>{const d=By(c.zoom,c.theme);return a.jsx("pattern",{id:d,width:Ju,height:Ju,patternUnits:"userSpaceOnUse",children:a.jsx("image",{href:c.url,width:Ju,height:Ju})},d)})}),isReady:s}}function fre(){const n=G(),e=b.useRef(null),{defs:t,isReady:s}=pre();return b.useEffect(()=>{if(s&&n.environment.isSafari){const i=KF(e.current);i&&n.timers.requestAnimationFrame(()=>{i.style.display="none",n.timers.requestAnimationFrame(()=>{i.style.display=""})})}},[n,s]),a.jsx("g",{ref:e,"data-testid":s?"ready-pattern-fill-defs":void 0,children:t})}function KF(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?KF(n.parentElement):null}const Ln=Oe.memo(function({theme:e,d:t,color:s,fill:i,scale:r}){switch(i){case"none":return null;case"solid":return a.jsx("path",{fill:e[s].semi,d:t});case"semi":return a.jsx("path",{fill:e.solid,d:t});case"fill":return a.jsx("path",{fill:e[s].fill,d:t});case"pattern":return a.jsx(gre,{theme:e,color:s,fill:i,d:t,scale:r})}});function gre({d:n,color:e,theme:t}){const s=G(),i=gF(),r=q("zoomLevel",()=>s.getZoomLevel(),[s]),o=s.getZoomLevel()<=.18;return a.jsxs(a.Fragment,{children:[a.jsx("path",{fill:t[e].pattern,d:n}),a.jsx("path",{fill:i?`url(#${By(1,t.id)})`:o?t[e].semi:`url(#${By(r,t.id)})`,d:n})]})}function mre(n){return n.replace(/\s/g,"")}function a_(n,e,t){const{padding:s=0}=t;if(e.length===0)return null;const i=ue.From(e[0].box);for(const{box:d}of e)i.union(d);const r=s+(t.offsetX??0),o=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?s:t.verticalTextAlign==="end"?t.height-s-i.height:(Math.ceil(t.height)-i.height)/2);let l=null;const c=[];for(const{text:d,box:u}of e)l!==null&&u.y>l&&c.push(a.jsx("tspan",{alignmentBaseline:"mathematical",x:r,y:u.y+o,children:`
`},c.length)),c.push(a.jsx("tspan",{alignmentBaseline:"mathematical",x:u.x+r,y:u.y+o,unicodeBidi:"plaintext",children:mre(d)},c.length)),l=u.y;return a.jsx("text",{fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,children:c})}function yre(n,e,t,s){if((n==="start-legacy"||n==="end-legacy")&&t.length!==0){const i=ue.From(t[0].box);for(const{box:r}of t)i.union(r);if(n==="start-legacy")return(s-2*e-i.width)/2;if(n==="end-legacy")return-(s-2*e-i.width)/2}}function vre(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}function dx({fontSize:n,font:e,align:t,verticalAlign:s,text:i,labelColor:r,bounds:o,padding:l=16,stroke:c=!0}){const d=G(),u=Pi(),h={fontSize:n,fontFamily:FD[e],textAlign:t,verticalTextAlign:s,width:Math.ceil(o.width),height:Math.ceil(o.height),padding:l,lineHeight:In.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:r,stroke:void 0,strokeWidth:void 0},p=d.textMeasure.measureTextSpans(i,h),f=yre(t,l,p,o.width);f&&(h.offsetX=f),h.offsetX+=o.x,h.offsetY+=o.y;const g=a_(d,p,h);let m=null;return c&&(h.fill=u.background,h.stroke=u.background,h.strokeWidth=2,m=a_(d,p,h)),a.jsxs(a.Fragment,{children:[m,g]})}const xre=b.forwardRef(function({isEditing:e,text:t,handleFocus:s,handleChange:i,handleKeyDown:r,handleBlur:o,handleInputPointerDown:l,handleDoubleClick:c},d){return a.jsx("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:s,onChange:i,onKeyDown:r,onBlur:o,onTouchEnd:un,onContextMenu:e?un:void 0,onPointerDown:l,onDoubleClick:c,onDragStart:ze})});function Sre(n,e,t){const s=G(),i=b.useRef(null),r=q("isEditing",()=>s.getEditingShapeId()===n,[s]),o=q("isEditingAnything",()=>!!s.getEditingShapeId(),[s]);b.useEffect(()=>{function u({shapeId:h}){var p;h===n&&((p=i.current)==null||p.select())}return s.on("select-all-text",u),()=>{s.off("select-all-text",u)}},[s,n,r]),b.useEffect(()=>{var u,h,p,f;r&&(document.activeElement!==i.current&&((u=i.current)==null||u.focus()),s.getInstanceState().isCoarsePointer&&((h=i.current)==null||h.select()),s.environment.isSafari&&((p=i.current)==null||p.blur(),(f=i.current)==null||f.focus()))},[s,r]);const l=b.useCallback(u=>{if(s.getEditingShapeId()===n)switch(u.key){case"Enter":{(u.ctrlKey||u.metaKey)&&s.complete();break}}},[s,n]),c=b.useCallback(u=>{if(s.getEditingShapeId()!==n)return;let h=Sd.normalizeText(u.currentTarget.value);const p=h.replace(/\t/g,Wc);if(p!==h){const f=u.currentTarget.selectionStart;u.currentTarget.value=p,u.currentTarget.selectionStart=f+(p.length-h.length),u.currentTarget.selectionEnd=f+(p.length-h.length),h=p}s.updateShape({id:n,type:e,props:{text:h}})},[s,n,e]),d=b.useCallback(u=>{s.dispatch({...Is(u),type:"pointer",name:"pointer_down",target:"shape",shape:s.getShape(n)}),un(u)},[s,n]);return{rInput:i,handleFocus:Qh,handleBlur:Qh,handleKeyDown:l,handleChange:c,handleInputPointerDown:d,handleDoubleClick:un,isEmpty:t.trim().length===0,isEditing:r,isEditingAnything:o}}const ux=Oe.memo(function({id:e,type:t,text:s,labelColor:i,font:r,fontSize:o,lineHeight:l,align:c,verticalAlign:d,wrap:u,isSelected:h,padding:p=0,onKeyDown:f,classNamePrefix:g,style:m,textWidth:x,textHeight:y}){const{rInput:S,isEmpty:v,isEditing:C,isEditingAnything:T,...I}=Sre(e,t,s),[E,P]=b.useState(s);b.useEffect(()=>{C||P(s)},[C,s]);const k=Sd.normalizeTextForDom(s),j=k.length>0,D=vre(c);if(!C&&!j)return null;const R=g||"tl-text";return a.jsx("div",{className:`${R}-label tl-text-wrapper`,"data-font":r,"data-align":c,"data-hastext":!v,"data-isediting":C,"data-iseditinganything":T,"data-textwrap":!!u,"data-isselected":h,style:{justifyContent:c==="middle"||D?"center":c,alignItems:d==="middle"?"center":d,padding:p,...m},children:a.jsxs("div",{className:`${R}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:Math.floor(o*l)+"px",minHeight:Math.floor(o*l)+"px",minWidth:Math.ceil(x||0),color:i,width:x?Math.ceil(x):void 0,height:y?Math.ceil(y):void 0},children:[a.jsx("div",{className:`${R} tl-text tl-text-content`,dir:"auto",children:k.split(`
`).map((A,N)=>a.jsx("div",{dir:"auto",children:A},N))}),(T||h)&&a.jsx(xre,{ref:S,text:s,isEditing:C,...I,handleKeyDown:f??I.handleKeyDown},E)]})})});function ur(n,e,t={}){const{closed:s=!1,snap:i=1,start:r="outset",end:o="outset",lengthRatio:l=2,style:c="dashed"}=t;let d=0,u=0,h=1,p=0,f=0;switch(c){case"dashed":{h=1,d=Math.min(e*l,n/4);break}case"dotted":{h=100,d=e/h;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return s||(r==="outset"?(n+=d/2,f+=d/2):r==="skip"&&(n-=d,f-=d),o==="outset"?n+=d/2:o==="skip"&&(n-=d)),u=Math.floor(n/d/(2*h)),u-=u%i,u<3&&c==="dashed"?n/e<4?(d=n,u=1,p=0):(d=n*(1/3),p=n*(1/3)):(d=n/u/(2*h),s?(f=d/2,p=(n-u*d)/u):p=(n-u*d)/Math.max(1,u-1)),{strokeDasharray:[d,p].join(" "),strokeDashoffset:f.toString()}}const WA=new WeakMap;function h1(n,e){const t=WA.get(e);if(t)return t;const s=yr(n,e);let i=0,r=0;const o=s.isStraight?new no({start:_.From(s.start.point),end:_.From(s.end.point)}):new Bc({center:_.Cast(s.handleArc.center),start:_.Cast(s.start.point),end:_.Cast(s.end.point),sweepFlag:s.bodyArc.sweepFlag,largeArcFlag:s.bodyArc.largeArcFlag});if(e.props.text.trim()){const c=o.bounds,d=l_(e),{w:u,h}=n.textMeasure.measureText(e.props.text,{...In,fontFamily:Tr[e.props.font],fontSize:d,maxWidth:null});if(i=u,r=h,c.width>c.height){i=Math.max(Math.min(u,64),Math.min(c.width-64,u));const{w:p,h:f}=n.textMeasure.measureText(e.props.text,{...In,fontFamily:Tr[e.props.font],fontSize:d,maxWidth:i});i=p,r=f}if(i>16*d){i=16*d;const{w:p,h:f}=n.textMeasure.measureText(e.props.text,{...In,fontFamily:Tr[e.props.font],fontSize:d,maxWidth:i});i=p,r=f}}const l=new _(i,r).addScalar(yie*2*e.props.scale);return WA.set(e,l),l}function YF(n){const e=cn[n.props.size];return(mie+(e-cn.s)*2+(e===cn.xl?20:0))*n.props.scale}function wre(n,e,t){const s=h1(n,e),i=YF(e),r=_.Nudge(t.start.point,t.end.point,i),o=_.Nudge(t.end.point,t.start.point,i),l=XE(r,o,ue.FromCenter(t.middle,s).corners);if(!l||l.length!==2)return{start:.5,end:.5};let[c,d]=l;_.Dist2(c,r)>_.Dist2(d,r)&&([d,c]=l);const u=r.add(_.Sub(t.middle,c)),h=o.add(_.Sub(t.middle,d)),p=_.Dist(t.start.point,u)/t.length,f=_.Dist(t.start.point,h)/t.length;return{start:p,end:f}}function bre(n,e,t){const s=h1(n,e),i=YF(e),r=Math.sign(e.props.bend),o=i/t.handleArc.radius*r,l=_.Angle(t.bodyArc.center,t.start.point)-o,c=_.Angle(t.bodyArc.center,t.end.point)+o,d=Rl(t.bodyArc.center,t.bodyArc.radius,l),u=Rl(t.bodyArc.center,t.bodyArc.radius,c),h=[],p=HA(t.bodyArc.center,t.bodyArc.radius,l,c,r,ue.FromCenter(d,s).corners);h.push(new Wt({points:ue.FromCenter(d,s).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const f=HA(t.bodyArc.center,t.bodyArc.radius,l,c,r,ue.FromCenter(u,s).corners);h.push(new Wt({points:ue.FromCenter(u,s).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const E of[...p??[],...f??[],d,u])h.push(new o1({x:E.x-3,y:E.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const g=(p&&GA(t.start.point,p))??t.middle,m=(f&&GA(t.end.point,f))??t.middle,x=_.Angle(t.bodyArc.center,t.start.point),y=_.Angle(t.bodyArc.center,t.end.point),S=_.Angle(t.bodyArc.center,g),v=_.Angle(t.bodyArc.center,m);if(ta(x,S,r)>ta(x,v,r))return{start:.5,end:.5,dbg:h};const C=ta(x,y,r),T=ta(x,S,r)/C,I=ta(x,v,r)/C;return{start:T,end:I,dbg:h}}function um(n,e){let t;const s=[],i=yr(n,e),r=!!i.bindings.start,o=!!i.bindings.end,l=i.start.arrowhead!=="none",c=i.end.arrowhead!=="none";if(i.isStraight){const u=wre(n,e,i);let h=tn(e.props.labelPosition,l||r?u.start:0,c||o?u.end:1);h=h>=.48&&h<=.52?.5:h,t=_.Lrp(i.start.point,i.end.point,h)}else{const u=bre(n,e,i);u.dbg&&s.push(...u.dbg);let h=tn(e.props.labelPosition,l||r?u.start:0,c||o?u.end:1);h=h>=.48&&h<=.52?.5:h;const p=_re(_.Angle(i.bodyArc.center,i.start.point),_.Angle(i.bodyArc.center,i.end.point),Math.sign(e.props.bend),h);t=Rl(i.bodyArc.center,i.bodyArc.radius,p)}const d=h1(n,e);return{box:ue.FromCenter(t,d),debugGeom:s}}function HA(n,e,t,s,i,r){const o=Q0(n,e,r),l=ta(t,s,i);return o==null?void 0:o.filter(c=>{const d=ta(t,_.Angle(n,c),i);return d>=0&&d<=l})}function GA(n,e){let t=null,s=-1/0;for(const i of e){const r=_.Dist2(n,i);r>s&&(t=i,s=r)}return t}function _re(n,e,t,s){const i=ta(n,e,t);return n+i*s*t*-1}function l_(n){return gie[n.props.size]*n.props.scale}function Cre(n,e,t){const s=e==="end"?n.end.point:n.start.point,i=e==="end"?n.start.point:n.end.point,r=n.isStraight?_.Dist(i,s):Math.abs(n.bodyArc.length),o=Math.max(Math.min(r/5,t*3),t);let l;if(n.isStraight)l=_.Nudge(s,i,o);else{const c=Vte(s,o,n.handleArc.center,n.handleArc.radius);l=e==="end"?n.handleArc.sweepFlag?c[0]:c[1]:n.handleArc.sweepFlag?c[1]:c[0]}return _.IsNaN(l)&&(l=n.start.point),{point:s,int:l}}function Ere({point:n,int:e}){const t=_.RotWith(e,n,qe/6),s=_.RotWith(e,n,-qe/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${s.x} ${s.y}`}function Tre({point:n,int:e}){const t=_.RotWith(e,n,qe/6),s=_.RotWith(e,n,-qe/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${s.x} ${s.y} Z`}function Ire({point:n,int:e}){const t=_.Sub(e,n).div(2),s=_.Add(n,_.Rot(t,gt)),i=_.Sub(n,_.Rot(t,gt));return`M ${s.x} ${s.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function Pre({point:n,int:e}){const t=_.Lrp(n,e,.45),s=_.Dist(t,n);return`M ${t.x-s},${t.y}
  a ${s},${s} 0 1,0 ${s*2},0
  a ${s},${s} 0 1,0 -${s*2},0 `}function kre({point:n,int:e}){const t=_.Lrp(n,e,.75),s=_.RotWith(t,n,qe/4),i=_.RotWith(t,n,-qe/4),r=_.Lrp(s,i,.5);return r.add(_.Sub(r,n)),`M ${r.x} ${r.y} L ${s.x} ${s.y} ${n.x} ${n.y} L ${i.x} ${i.y} Z`}function Are({int:n,point:e}){const t=_.Lrp(e,n,.85),s=_.Sub(t,e).div(2),i=_.Add(e,_.Rot(s,gt)),r=_.Sub(e,_.Rot(s,gt)),o=_.Add(t,_.Rot(s,gt)),l=_.Sub(t,_.Rot(s,gt));return`M ${i.x} ${i.y} L ${o.x} ${o.y} L ${l.x} ${l.y} L ${r.x} ${r.y} Z`}function jre({int:n,point:e}){const t=_.Sub(n,e).div(2),s=_.Add(e,_.Rot(t,gt)),i=_.Sub(e,_.Rot(t,gt));return`M ${s.x} ${s.y} L ${i.x} ${i.y}`}function Uy(n,e,t){const s=e==="end"?n.end.arrowhead:n.start.arrowhead;if(s==="none")return;const i=Cre(n,e,t);if(i){switch(s){case"bar":return jre(i);case"square":return Are(i);case"diamond":return kre(i);case"dot":return Pre(i);case"inverted":return Ire(i);case"arrow":return Ere(i);case"triangle":return Tre(i)}return""}}function Nre(n){const{start:e,end:t,handleArc:{radius:s,largeArcFlag:i,sweepFlag:r}}=n;return`M${e.handle.x},${e.handle.y} A${s} ${s} 0 ${i} ${r} ${t.handle.x},${t.handle.y}`}function XF(n){const{start:e,end:t,bodyArc:{radius:s,largeArcFlag:i,sweepFlag:r}}=n;return`M${e.point.x},${e.point.y} A${s} ${s} 0 ${i} ${r} ${t.point.x},${t.point.y}`}function qF(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function Rre(n){return qF(n.start.handle,n.end.handle)}function ZF(n){return qF(n.start.point,n.end.point)}let Mre=0;class hm extends Wi{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"canSnap",()=>!1);w(this,"hideResizeHandles",()=>!0);w(this,"hideRotateHandle",()=>!0);w(this,"hideSelectionBoundsBg",()=>!0);w(this,"hideSelectionBoundsFg",()=>!0);w(this,"canBeLaidOut",t=>{const s=Cs(this.editor,t);return!s.start&&!s.end});w(this,"onHandleDrag",(t,{handle:s,isPrecise:i})=>{const r=s.id,o=Cs(this.editor,t);if(r==="middle"){const{start:I,end:E}=Uc(this.editor,t,o),P=_.Sub(E,I),k=_.Per(P),j=_.Med(E,I),D=_.Sub(j,k),R=_.Add(j,k),A=_.NearestPointOnLineSegment(D,R,s,!1);let N=_.Dist(A,j);return _.Clockwise(A,E,j)&&(N*=-1),{id:t.id,type:t.type,props:{bend:N}}}const l={id:t.id,type:"arrow",props:{}},c=o[r],u=o[r==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return rm(this.editor,t,r),l.props[r]={x:s.x,y:s.y},l;const h=this.editor.getShapePageTransform(t.id).applyToPoint(s),p=this.editor.getShapeAtPoint(h,{hitInside:!0,hitFrameInside:!0,margin:0,filter:I=>!I.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:I,binding:"arrow"})});if(!p)return rm(this.editor,t,r),l.props[r]={x:s.x,y:s.y},l;const f=this.editor.getShapeGeometry(p),g=ue.ZeroFix(f.bounds),x=this.editor.getShapePageTransform(l.id).applyToPoint(s),y=this.editor.getPointInShapeSpace(p,x);let S=i;S||(!c||c&&p.id!==c.toId)&&(S=this.editor.inputs.pointerVelocity.len()<.5),i||(f.isClosed||(S=!0),u&&p.id===u.toId&&u.props.isPrecise&&(S=!0));const v={x:(y.x-g.minX)/g.width,y:(y.y-g.minY)/g.height};S&&_.Dist(y,g.center)<Math.max(4,Math.min(Math.min(g.width,g.height)*.15,16))/this.editor.getZoomLevel()&&(v.x=.5,v.y=.5);const C={terminal:r,normalizedAnchor:v,isPrecise:S,isExact:this.editor.inputs.altKey};Tu(this.editor,t,p.id,C),this.editor.setHintingShapes([p.id]);const T=Cs(this.editor,t);return T.start&&T.end&&T.start.toId===T.end.toId&&_.Equals(T.start.props.normalizedAnchor,T.end.props.normalizedAnchor)&&Tu(this.editor,t,T.end.toId,{...T.end.props,normalizedAnchor:{x:T.end.props.normalizedAnchor.x+.05,y:T.end.props.normalizedAnchor.y}}),l});w(this,"onTranslateStart",t=>{const s=Cs(this.editor,t),i=Uc(this.editor,t,s),r=this.editor.getShapePageTransform(t.id),o=this.editor.getSelectedShapeIds();if(!(s.start&&(o.includes(s.start.toId)||this.editor.isAncestorSelected(s.start.toId))||s.end&&(o.includes(s.end.toId)||this.editor.isAncestorSelected(s.end.toId)))){KA.set(t,{pagePosition:r.applyToPoint(t),terminalBindings:Rp(i,(l,c)=>{const d=s[l];return d?{binding:d,shapePosition:c,pagePosition:r.applyToPoint(c)}:null})}),s.start&&(Ly({editor:this.editor,arrow:t,terminal:"start",useHandle:!0}),t=this.editor.getShape(t.id)),s.end&&Ly({editor:this.editor,arrow:t,terminal:"end",useHandle:!0});for(const l of["start","end"]){const c=s[l];c&&this.editor.updateBinding({...c,props:{...c.props,isPrecise:!0}})}}});w(this,"onTranslate",(t,s)=>{const i=KA.get(t);if(!i)return;const r=this.editor.getShapePageTransform(s.id),o=_.Sub(r.applyToPoint(s),i.pagePosition);for(const l of Object.values(i.terminalBindings)){if(!l)continue;const c=_.Add(l.pagePosition,_.Mul(o,.5)),d=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:u=>!u.isLocked&&this.editor.canBindShapes({fromShape:s,toShape:u,binding:"arrow"})});if((d==null?void 0:d.id)===l.binding.toId){const u=ue.ZeroFix(this.editor.getShapeGeometry(d).bounds),h=this.editor.getPointInShapeSpace(d,c),p={x:(h.x-u.minX)/u.width,y:(h.y-u.minY)/u.height};Tu(this.editor,s,d.id,{...l.binding.props,normalizedAnchor:p,isPrecise:!0})}else rm(this.editor,s,l.binding.props.terminal)}});w(this,"_resizeInitialBindings",new xo);w(this,"onResize",(t,s)=>{const{scaleX:i,scaleY:r}=s,o=this._resizeInitialBindings.get(t,()=>Cs(this.editor,t)),l=Uc(this.editor,t,o),{start:c,end:d}=ft(t.props);let{bend:u}=t.props;o.start||(c.x=l.start.x*i,c.y=l.start.y*r),o.end||(d.x=l.end.x*i,d.y=l.end.y*r);const h=Math.abs(i),p=Math.abs(r),f=o!=null&&o.start?_.From(o.start.props.normalizedAnchor):null,g=o!=null&&o.end?_.From(o.end.props.normalizedAnchor):null;return i<0&&r>=0?(u!==0&&(u*=-1,u*=Math.max(h,p)),f&&(f.x=1-f.x),g&&(g.x=1-g.x)):i>=0&&r<0?(u!==0&&(u*=-1,u*=Math.max(h,p)),f&&(f.y=1-f.y),g&&(g.y=1-g.y)):i>=0&&r>=0?u!==0&&(u*=Math.max(h,p)):i<0&&r<0&&(u!==0&&(u*=Math.max(h,p)),f&&(f.x=1-f.x,f.y=1-f.y),g&&(g.x=1-g.x,g.y=1-g.y)),o.start&&f&&Tu(this.editor,t,o.start.toId,{...o.start.props,normalizedAnchor:f.toJson()}),o.end&&g&&Tu(this.editor,t,o.end.toId,{...o.end.props,normalizedAnchor:g.toJson()}),{props:{start:c,end:d,bend:u}}});w(this,"onDoubleClickHandle",(t,s)=>{switch(s.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}});w(this,"onEditEnd",t=>{const{id:s,type:i,props:{text:r}}=t;r.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:s,type:i,props:{text:r.trimEnd()}}])})}canBind({toShapeType:t}){return t!=="arrow"}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(t){const s=yr(this.editor,t),i=[],r=s.isStraight?new no({start:_.From(s.start.point),end:_.From(s.end.point)}):new Bc({center:_.Cast(s.handleArc.center),start:_.Cast(s.start.point),end:_.Cast(s.end.point),sweepFlag:s.bodyArc.sweepFlag,largeArcFlag:s.bodyArc.largeArcFlag});let o;if(t.props.text.trim()){const l=um(this.editor,t);i.push(...l.debugGeom),o=new wo({x:l.box.x,y:l.box.y,width:l.box.w,height:l.box.h,isFilled:!0,isLabel:!0})}return new Yi({children:[...o?[r,o]:[r],...i]})}getHandles(t){const s=yr(this.editor,t);return[{id:"start",type:"vertex",index:"a0",x:s.start.handle.x,y:s.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:s.middle.x,y:s.middle.y},{id:"end",type:"vertex",index:"a3",x:s.end.handle.x,y:s.end.handle.y}].filter(Boolean)}component(t){const s=Pi(),i=this.editor.getOnlySelectedShape(),r=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,o=yr(this.editor,t);if(!(o!=null&&o.isValid))return null;const l=um(this.editor,t),c=t.id===this.editor.getOnlySelectedShapeId(),u=this.editor.getEditingShapeId()===t.id||t.props.text;return a.jsxs(a.Fragment,{children:[a.jsx(ja,{id:t.id,style:{minWidth:50,minHeight:50},children:a.jsx(VA,{shape:t,shouldDisplayHandles:r&&(i==null?void 0:i.id)===t.id})}),u&&a.jsx(ux,{id:t.id,classNamePrefix:"tl-arrow",type:"arrow",font:t.props.font,fontSize:l_(t),lineHeight:In.lineHeight,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:s[t.props.labelColor].solid,textWidth:l.box.w,isSelected:c,padding:0,style:{transform:`translate(${l.box.center.x}px, ${l.box.center.y}px)`}})]})}indicator(t){const s=ox(t.id),i=yr(this.editor,t);if(!i)return null;const{start:r,end:o}=Uc(this.editor,t,i==null?void 0:i.bindings),l=this.editor.getShapeGeometry(t),c=l.bounds,d=t.props.text.trim()?l.children[1]:null;if(_.Equals(r,o))return null;const u=cn[t.props.size]*t.props.scale,h=i.start.arrowhead&&Uy(i,"start",u),p=i.end.arrowhead&&Uy(i,"end",u),f=i.isStraight?ZF(i):XF(i),g=h&&i.start.arrowhead!=="arrow"||p&&i.end.arrowhead!=="arrow"||!!d,m=(t.id+"_clip").replace(":","_");return s&&d?a.jsx("rect",{x:H(d.x),y:H(d.y),width:d.w,height:d.h,rx:3.5*t.props.scale,ry:3.5*t.props.scale}):a.jsxs("g",{children:[g&&a.jsx("defs",{children:a.jsxs("mask",{id:m,children:[a.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.w+200,height:c.h+200,fill:"white"}),d&&a.jsx("rect",{x:H(d.x),y:H(d.y),width:d.w,height:d.h,fill:"black",rx:3.5*t.props.scale,ry:3.5*t.props.scale}),h&&a.jsx("path",{d:h,fill:i.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),p&&a.jsx("path",{d:p,fill:i.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),a.jsxs("g",{...g?{mask:`url(#${m})`}:void 0,children:[g&&a.jsx("rect",{x:c.minX-100,y:c.minY-100,width:c.width+200,height:c.height+200,opacity:0}),a.jsx("path",{d:f})]}),h&&a.jsx("path",{d:h}),p&&a.jsx("path",{d:p}),d&&a.jsx("rect",{x:H(d.x),y:H(d.y),width:d.w,height:d.h,rx:3.5,ry:3.5})]})}toSvg(t,s){s.addExportDef(d1(t.props.fill)),t.props.text&&s.addExportDef(cx(t.props.font));const i=No(s),r=1/t.props.scale;return a.jsxs("g",{transform:`scale(${r})`,children:[a.jsx(VA,{shape:t,shouldDisplayHandles:!1}),a.jsx(dx,{fontSize:l_(t),font:t.props.font,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:i[t.props.labelColor].solid,bounds:um(this.editor,t).box,padding:4*t.props.scale})]})}getCanvasSvgDefs(){return[u1(),{key:"arrow:dot",component:Dre},{key:"arrow:cross",component:Lre}]}getInterpolatedProps(t,s,i){return{...s.props,start:{x:bs(t.props.start.x,s.props.start.x,i),y:bs(t.props.start.y,s.props.start.y,i)},end:{x:bs(t.props.end.x,s.props.end.x,i),y:bs(t.props.end.y,s.props.end.y,i)},bend:bs(t.props.bend,s.props.bend,i),labelPosition:bs(t.props.labelPosition,s.props.labelPosition,i)}}}w(hm,"type","arrow"),w(hm,"props",UD),w(hm,"migrations",$D);function Ore(n,e){const t=yr(n,e);return t.isStraight?_.Dist(t.start.handle,t.end.handle):Math.abs(t.handleArc.length)}const VA=pn(function({shape:e,shouldDisplayHandles:t}){const s=G(),i=Pi(),r=yr(s,e),o=ue.ZeroFix(s.getShapeGeometry(e).bounds),l=Cs(s,e),c=Oe.useMemo(()=>s.environment.isSafari?Mre+=1:0,[e]);if(!(r!=null&&r.isValid))return null;const d=cn[e.props.size]*e.props.scale,u=r.start.arrowhead&&Uy(r,"start",d),h=r.end.arrowhead&&Uy(r,"end",d),p=r.isStraight?ZF(r):XF(r);let f=null;if(t){const C=2/s.getZoomLevel(),{strokeDasharray:T,strokeDashoffset:I}=ur(Ore(s,e),C,{end:"skip",start:"skip",lengthRatio:2.5});f=l.start||l.end?a.jsx("path",{className:"tl-arrow-hint",d:r.isStraight?Rre(r):Nre(r),strokeDasharray:T,strokeDashoffset:I,strokeWidth:C,markerStart:l.start?l.start.props.isExact?"":l.start.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:l.end?l.end.props.isExact?"":l.end.props.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:g,strokeDashoffset:m}=ur(r.isStraight?r.length:Math.abs(r.bodyArc.length),d,{style:e.props.dash}),x=um(s,e),y=!(r.start.arrowhead==="none"||r.start.arrowhead==="arrow"),S=!(r.end.arrowhead==="none"||r.end.arrowhead==="arrow"),v=(e.id+"_clip_"+c).replace(":","_");return a.jsxs(a.Fragment,{children:[a.jsx("defs",{children:a.jsxs("mask",{id:v,children:[a.jsx("rect",{x:H(-100+o.minX),y:H(-100+o.minY),width:H(o.width+200),height:H(o.height+200),fill:"white"}),e.props.text.trim()&&a.jsx("rect",{x:x.box.x,y:x.box.y,width:x.box.w,height:x.box.h,fill:"black",rx:4,ry:4}),u&&y&&a.jsx("path",{d:u,fill:r.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),h&&S&&a.jsx("path",{d:h,fill:r.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),a.jsxs("g",{fill:"none",stroke:i[e.props.color].solid,strokeWidth:d,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[f,a.jsxs("g",{mask:`url(#${v})`,children:[a.jsx("rect",{x:H(o.minX-100),y:H(o.minY-100),width:H(o.width+200),height:H(o.height+200),opacity:0}),a.jsx("path",{d:p,strokeDasharray:g,strokeDashoffset:m})]}),u&&y&&e.props.fill!=="none"&&a.jsx(Ln,{theme:i,d:u,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),h&&S&&e.props.fill!=="none"&&a.jsx(Ln,{theme:i,d:h,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),u&&a.jsx("path",{d:u}),h&&a.jsx("path",{d:h})]})]})}),KA=new WeakMap;function Dre(){return a.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:a.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Lre(){return a.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[a.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),a.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const YA="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function wd({url:n,zoomLevel:e}){return a.jsx("a",{className:Se("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:un,onPointerUp:un,title:n,draggable:!1,children:a.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${YA}") center 100% / 100% no-repeat`,WebkitMask:`url("${YA}") center 100% / 100% no-repeat`}})})}const XA="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",Fre=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function p1(n){return Fre.map(t=>{const{offsetX:s,offsetY:i,blur:r,spread:o,color:l}=t,c=new _(s,i),{x:d,y:u}=c.rot(-n);return`${d}px ${u}px ${r}px ${o}px ${l}`}).join(", ")}const Bre=300,JF=320,Ure=46,$re=101;class pm extends Wd{constructor(){super(...arguments);w(this,"canResize",()=>!1);w(this,"hideSelectionBoundsFg",()=>!0);w(this,"onBeforeCreate",t=>qA(this.editor,t));w(this,"onBeforeUpdate",(t,s)=>{if(t.props.url!==s.props.url)if(Qs.isValid(s.props.url))Wre(this.editor,s);else return{...s,props:{...s.props,url:t.props.url}};if(t.props.assetId!==s.props.assetId)return qA(this.editor,s)})}getDefaultProps(){return{url:"",w:Bre,h:JF,assetId:null}}component(t){const s=t.props.assetId?this.editor.getAsset(t.props.assetId):null,i=this.editor.getShapePageTransform(t).rotation(),r=zre(t);return a.jsx(Ml,{children:a.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:p1(i),maxHeight:t.props.h},children:[(!s||s.props.image)&&a.jsxs("div",{className:"tl-bookmark__image_container",children:[s?a.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:s==null?void 0:s.props.image,alt:(s==null?void 0:s.props.title)||""}):a.jsx("div",{className:"tl-bookmark__placeholder"}),(s==null?void 0:s.props.image)&&a.jsx(wd,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]}),a.jsxs("div",{className:"tl-bookmark__copy_container",children:[s!=null&&s.props.title?a.jsx("h2",{className:"tl-bookmark__heading",children:s.props.title}):null,s!=null&&s.props.description&&(s!=null&&s.props.image)?a.jsx("p",{className:"tl-bookmark__description",children:s.props.description}):null,a.jsxs("a",{className:"tl-bookmark__link",href:t.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:un,onPointerUp:un,onClick:un,children:[s!=null&&s.props.favicon?a.jsx("img",{className:"tl-bookmark__favicon",src:s==null?void 0:s.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",alt:`favicon of ${r}`}):a.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${XA}") center 100% / 100% no-repeat`,WebkitMask:`url("${XA}") center 100% / 100% no-repeat`}}),a.jsx("span",{children:r})]})]})]})})}indicator(t){return a.jsx("rect",{width:H(t.props.w),height:H(t.props.h),rx:"6",ry:"6"})}}w(pm,"type","bookmark"),w(pm,"props",KD),w(pm,"migrations",YD);function qA(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):null;let s=JF;return t&&(t.props.image||(t.props.title?s=$re:s=Ure)),{...e,props:{...e.props,h:s}}}const zre=n=>{try{return new URL(n.props.url).hostname.replace(/^www\./,"")}catch{return n.props.url}};function Wre(n,e){const{url:t}=e.props,s=fl.createId(B0(t));n.getAsset(s)?e.props.assetId!==s&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:s}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),Hre(n,e))}const Hre=dD(async(n,e)=>{if(n.isDisposed)return;const{url:t}=e.props,s=await n.getAssetForExternalContent({type:"url",url:t});s&&n.run(()=>{n.createAssets([s]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:s.id}}])})},500);function Ol(n,e=!1){const t=n.length;if(t<2)return"";let s=n[0].point,i=n[1].point;if(t===2)return`M${Ye(s)}L${Ye(i)}`;let r="";for(let o=2,l=t-1;o<l;o++)s=n[o].point,i=n[o+1].point,r+=_s(s,i);return e?`M${_s(n[0].point,n[1].point)}Q${Ye(n[1].point)}${_s(n[1].point,n[2].point)}T${r}${_s(n[t-1].point,n[0].point)}${_s(n[0].point,n[1].point)}Z`:`M${Ye(n[0].point)}Q${Ye(n[1].point)}${_s(n[1].point,n[2].point)}${n.length>3?"T":""}${r}L${Ye(n[t-1].point)}`}function Gre(n,e={}){const{start:t={},end:s={}}=e,{cap:i=!0}=t,{cap:r=!0}=s;mt(!t.taper&&!s.taper,"cap taper not supported here"),mt(!t.easing&&!s.easing,"cap easing not supported here"),mt(i&&r,"cap must be true");const o=Rr(n,e);ax(o,e);const l=Vre(o);let c="";for(const d of l)c+=Yre(d,e);return c}function Vre(n){if(n.length<=2)return[n];const e=[];let t=[n[0]],s=_.Sub(n[1].point,n[0].point).uni(),i,r,o,l,c;for(let d=1,u=n.length;d<u-1;d++){if(o=n[d-1],l=n[d],c=n[d+1],i=_.Sub(c.point,l.point).uni(),r=_.Dpr(s,i),s=i,r<-.8){const h={...l,point:l.input};t.push(h),e.push(Cw(t)),t=[h];continue}if(t.push(l),!(r>.7)&&(_.Dist2(o.point,l.point)+_.Dist2(l.point,c.point))/((o.radius+l.radius+c.radius)/3)**2<1.5){t.push(l),e.push(Cw(t)),t=[l];continue}}return t.push(n[n.length-1]),e.push(Cw(t)),e}function Cw(n){const e=n[0];let t;for(;n.length>2&&(t=n[1],_.Dist2(e.point,t.point)<((e.radius+t.radius)/2*.5)**2);)n.splice(1,1);const s=n[n.length-1];let i;for(;n.length>2&&(i=n[n.length-2],_.Dist2(s.point,i.point)<((s.radius+i.radius)/2*.5)**2);)n.splice(n.length-2,1);return n.length>1&&(n[0]={...n[0],vector:_.Sub(n[0].point,n[1].point).uni()},n[n.length-1]={...n[n.length-1],vector:_.Sub(n[n.length-2].point,n[n.length-1].point).uni()}),n}function Kre(n,e,t){return"M "+n+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function Yre(n,e={}){if(n.length===0)return"";if(n.length===1)return Kre(n[0].point.x,n[0].point.y,n[0].radius);const{left:t,right:s}=AF(n,e);s.reverse();let i=`M${Ye(t[0])}T`;for(let r=1;r<t.length;r++)i+=_s(t[r-1],t[r]);{const r=n[n.length-1],o=r.radius,l=r.vector.clone().per().neg(),c=_.Add(r.point,_.Mul(l,o)),d=_.Add(r.point,_.Mul(l,-o));i+=`${Ye(c)}A${H(o)},${H(o)} 0 0 1 ${Ye(d)}T`}for(let r=1;r<s.length;r++)i+=_s(s[r-1],s[r]);{const r=n[0],o=r.radius,l=r.vector.clone().per(),c=_.Add(r.point,_.Mul(l,o)),d=_.Add(r.point,_.Mul(l,-o));i+=`${Ye(c)}A${H(o)},${H(o)} 0 0 1 ${Ye(d)}Z`}return i}const Xre=n=>n*.65+mQ(n*qe/2)*.35,qre=n=>({size:n,thinning:.5,streamline:yd(n,[9,16],[.64,.74],!0),smoothing:.62,easing:ln.easeOutSine,simulatePressure:!0}),Zre=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Xre}),ZA=n=>({size:n,thinning:0,streamline:yd(n,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:ln.linear}),Jre=n=>({size:n,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:ln.linear});function f1({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:ln.easeOutSine,last:e}}function c_(n,e,t,s){const i=n.isComplete||t;return s?n.isPen?{...Jre(e),last:i}:{...ZA(e),last:i}:n.dash==="draw"?n.isPen?{...Zre(e),last:i}:{...qre(e),last:i}:{...ZA(e),last:i}}function bd(n){const e=[];for(const t of n)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(_.Cast));else{const s=Math.max(4,Math.floor(_.Dist(t.points[0],t.points[1])/16));e.push(..._.PointsBetween(t.points[0],t.points[1],s))}return e}function Qre(n,e){return{draw:"none",solid:"none",dotted:`0.1 ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class fm extends Wi{constructor(){super(...arguments);w(this,"hideResizeHandles",t=>Ew(t));w(this,"hideRotateHandle",t=>Ew(t));w(this,"hideSelectionBoundsFg",t=>Ew(t));w(this,"onResize",(t,s)=>{const{scaleX:i,scaleY:r}=s,o=[];for(const l of t.props.segments)o.push({...l,points:l.points.map(({x:c,y:d,z:u})=>({x:qr(i*c),y:qr(r*d),z:u}))});return{props:{segments:o}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(t){const s=bd(t.props.segments),i=(cn[t.props.size]+1)*t.props.scale;if(t.props.segments.length===1){const o=ue.FromPoints(s);if(o.width<i*2&&o.height<i*2)return new o1({x:-i,y:-i,radius:i,isFilled:!0})}const r=Rr(s,c_(t.props,i,t.props.isPen,!0)).map(o=>o.point);return t.props.isClosed?new Wt({points:r,isFilled:t.props.fill!=="none"}):new zd({points:r})}component(t){return a.jsx(ja,{id:t.id,children:a.jsx(JA,{shape:t,zoomLevel:this.editor.getZoomLevel()})})}indicator(t){var h;const s=bd(t.props.segments);let i=(cn[t.props.size]+1)*t.props.scale;const r=this.editor.getZoomLevel();!(r<.5&&r<1.5/i)&&!t.props.isPen&&t.props.dash==="draw"&&s.length===1&&(i+=Zi(t.id)()*(i/6));const l=t.props.isComplete||((h=wn(t.props.segments))==null?void 0:h.type)==="straight",c=c_(t.props,i,l,!0),d=Rr(s,c),u=d.length>1?Ol(d,t.props.isClosed):QF(s[0],i);return a.jsx("path",{d:u})}toSvg(t,s){s.addExportDef(d1(t.props.fill));const i=1/t.props.scale;return a.jsx("g",{transform:`scale(${i})`,children:a.jsx(JA,{shape:t,zoomLevel:1})})}getCanvasSvgDefs(){return[u1()]}expandSelectionOutlinePx(t){const s=t.props.dash==="draw"?1.6:1;return cn[t.props.size]*s/2*t.props.scale}}w(fm,"type","draw"),w(fm,"props",qD),w(fm,"migrations",ZD);function QF(n,e){const t=(e+1)*.5;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function Ew(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function JA({shape:n,zoomLevel:e}){var h;const t=Pi(),s=bd(n.props.segments),i=n.props.isComplete||((h=wn(n.props.segments))==null?void 0:h.type)==="straight";let r=(cn[n.props.size]+1)*n.props.scale;const o=e<.5&&e<1.5/r;!o&&!n.props.isPen&&n.props.dash==="draw"&&s.length===1&&(r+=Zi(n.id)()*(r/6));const l=c_(n.props,r,i,o);if(!o&&n.props.dash==="draw")return a.jsxs(a.Fragment,{children:[n.props.isClosed&&n.props.fill&&s.length>1?a.jsx(Ln,{d:Ol(Rr(s,l),n.props.isClosed),theme:t,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",scale:n.props.scale}):null,a.jsx("path",{d:Gre(s,l),strokeLinecap:"round",fill:t[n.props.color].solid})]});const c=Rr(s,l),d=c.length<2,u=d?QF(s[0],0):Ol(c,n.props.isClosed);return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{d:u,theme:t,color:n.props.color,fill:d||n.props.isClosed?n.props.fill:"none",scale:n.props.scale}),a.jsx("path",{d:u,strokeLinecap:"round",fill:d?t[n.props.color].solid:"none",stroke:t[n.props.color].solid,strokeWidth:r,strokeDasharray:d?"none":Qre(n,r),strokeDashoffset:"0"})]})}function eoe(n,e,t={}){const{newPoint:s,handle:i,scaleX:r,scaleY:o}=e,{minWidth:l=1,maxWidth:c=1/0,minHeight:d=1,maxHeight:u=1/0}=t;let h=n.props.w*r,p=n.props.h*o;const f=new _(0,0);if(h>0){if(h<l){switch(i){case"top_left":case"left":case"bottom_left":{f.x=h-l;break}case"top":case"bottom":{f.x=(h-l)/2;break}default:f.x=0}h=l}}else if(f.x=h,h=-h,h<l){switch(i){case"top_left":case"left":case"bottom_left":{f.x=-h;break}default:f.x=-l}h=l}if(p>0){if(p<d){switch(i){case"top_left":case"top":case"top_right":{f.y=p-d;break}case"right":case"left":{f.y=(p-d)/2;break}default:f.y=0}p=d}}else if(f.y=p,p=-p,p<d){switch(i){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-d}p=d}const{x:g,y:m}=f.rot(n.rotation).add(s);return{x:g,y:m,props:{w:Math.min(c,h),h:Math.min(u,p)}}}const toe=n=>Object.entries(n).filter(([e,t])=>t).map(([e])=>e).join(" ");class gm extends Wd{constructor(){super(...arguments);w(this,"hideSelectionBoundsFg",t=>!this.canResize(t));w(this,"canEdit",()=>!0);w(this,"canResize",t=>{var s,i;return!!((i=(s=da(t.props.url))==null?void 0:s.definition)!=null&&i.doesResize)});w(this,"canEditInReadOnly",()=>!0);w(this,"isAspectRatioLocked",t=>{const s=da(t.props.url);return(s==null?void 0:s.definition.isAspectRatioLocked)??!1});w(this,"onResize",(t,s)=>{const i=this.isAspectRatioLocked(t),r=da(t.props.url);let o=(r==null?void 0:r.definition.minWidth)??200,l=(r==null?void 0:r.definition.minHeight)??200;if(i){const c=t.props.w/t.props.h;c>1?o*=c:l/=c}return eoe(t,s,{minWidth:o,minHeight:l})})}getDefaultProps(){return{w:300,h:300,url:""}}component(t){const{w:s,h:i,url:r}=t.props,o=ox(t.id),l=b.useMemo(()=>OF(r),[r]),c=q("is hovering",()=>{const{editingShapeId:f,hoveredShapeId:g}=this.editor.getCurrentPageState();if(f&&g!==f){const m=this.editor.getShape(f);if(m&&this.editor.isShapeOfType(m,"embed"))return!0}return!1},[]),d=this.editor.getShapePageTransform(t).rotation(),u=o||c;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(l==null?void 0:l.definition.type)==="tldraw")return null;if((l==null?void 0:l.definition.type)==="github_gist"){const f=l.url.split("/").pop();if(!f)throw Error("No gist id!");return a.jsx(Ml,{className:"tl-embed-container",id:t.id,children:a.jsx(noe,{id:f,width:H(s),height:H(i),isInteractive:u,pageRotation:d})})}const p=toe({...JJ,...(l==null?void 0:l.definition.overridePermissions)??{}});return a.jsx(Ml,{className:"tl-embed-container",id:t.id,children:l!=null&&l.definition?a.jsx("iframe",{className:"tl-embed",sandbox:p,src:l.embedUrl,width:H(s),height:H(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:p1(d),borderRadius:(l==null?void 0:l.definition.overrideOutlineRadius)??8,background:l==null?void 0:l.definition.backgroundColor}}):null})}indicator(t){const s=b.useMemo(()=>da(t.props.url),[t.props.url]);return a.jsx("rect",{width:H(t.props.w),height:H(t.props.h),rx:(s==null?void 0:s.definition.overrideOutlineRadius)??8,ry:(s==null?void 0:s.definition.overrideOutlineRadius)??8})}}w(gm,"type","embed"),w(gm,"props",JD),w(gm,"migrations",QD);function noe({id:n,file:e,isInteractive:t,width:s,height:i,style:r,pageRotation:o}){return a.jsx("iframe",{className:"tl-embed",draggable:!1,width:H(s),height:H(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...r,pointerEvents:t?"all":"none",zIndex:t?"":"-1",boxShadow:p1(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const soe=b.forwardRef(({id:n,name:e,isEditing:t},s)=>{const i=G(),r=b.useCallback(c=>{c.key==="Enter"&&!c.nativeEvent.isComposing&&(un(c),c.currentTarget.blur(),i.setEditingShape(null))},[i]),o=b.useCallback(c=>{const d=i.getShape(n);if(!d)return;const u=d.props.name,h=c.currentTarget.value.trim();u!==h&&i.updateShapes([{id:n,type:"frame",props:{name:h}}])},[n,i]),l=b.useCallback(c=>{const d=i.getShape(n);if(!d)return;const u=d.props.name,h=c.currentTarget.value;u!==h&&i.updateShapes([{id:n,type:"frame",props:{name:h}}])},[n,i]);return a.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[a.jsx("input",{className:"tl-frame-name-input",ref:s,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:r,onBlur:o,onChange:l}),e5(e,"Frame")+""]})}),ioe=function({id:e,name:t,width:s,height:i}){const r=G(),o=q("shape rotation",()=>ba(r.getShapePageTransform(e).rotation()),[r,e]),l=ox(e),c=b.useRef(null),d=b.useCallback(g=>{const m=Is(g);g.preventDefault(),r.getEditingShapeId()!==e&&r.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(e),...m})},[r,e]);b.useEffect(()=>{const g=c.current;g&&l&&(g.focus(),g.select())},[c,l]);const h=((o+Math.PI/4)*(2/Math.PI)+4)%4,p=["top","left","bottom","right"][Math.floor(h)];let f;switch(p){case"top":f="";break;case"right":f=`translate(${H(s)}px, 0px) rotate(90deg)`;break;case"bottom":f=`translate(${H(s)}px, ${H(i)}px) rotate(180deg)`;break;case"left":f=`translate(0px, ${H(i)}px) rotate(270deg)`;break}return a.jsx("div",{className:"tl-frame-heading",style:{overflow:l?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(p==="top"||p==="bottom"?s:i)}px + var(--space-5))`,bottom:"100%",transform:`${f} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:d,children:a.jsx("div",{className:"tl-frame-heading-hit-area",children:a.jsx(soe,{ref:c,id:e,name:t,isEditing:l})})})};function e5(n,e){return n.match(/^\s*$/)?e:n}class mm extends Wd{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"canReceiveNewChildrenOfType",(t,s)=>!t.isLocked);w(this,"canDropShapes",(t,s)=>!t.isLocked);w(this,"onDragShapesOver",(t,s)=>{s.every(i=>i.parentId===t.id)||this.editor.reparentShapes(s,t.id)});w(this,"onDragShapesOut",(t,s)=>{const i=this.editor.getShape(t.parentId);i&&this.editor.isShapeOfType(i,"group")?this.editor.reparentShapes(s,i.id):this.editor.reparentShapes(s,this.editor.getCurrentPageId())});w(this,"onResize",(t,s)=>i1(t,s))}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(t){return new wo({width:t.props.w,height:t.props.h,isFilled:!1})}component(t){const s=this.editor.getShapeGeometry(t).bounds,i=Pi(),r=q("is creating this shape",()=>{const o=this.editor.getStateDescendant("select.resizing");if(!o||!o.getIsActive())return!1;const l=o==null?void 0:o.info;return l?l.isCreating&&this.editor.getOnlySelectedShapeId()===t.id:!1},[t.id]);return a.jsxs(a.Fragment,{children:[a.jsx(ja,{children:a.jsx("rect",{className:Se("tl-frame__body",{"tl-frame__creating":r}),width:s.width,height:s.height,fill:i.solid,stroke:i.text})}),r?null:a.jsx(ioe,{id:t.id,name:t.props.name,width:s.width,height:s.height})]})}toSvg(t,s){const i=No({isDarkMode:s.isDarkMode}),l=((ba(this.editor.getShapePageTransform(t.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,c=Math.floor(l);let d;switch(c){case 0:d="";break;case 3:d=`translate(${H(t.props.w)}, 0) rotate(90)`;break;case 2:d=`translate(${H(t.props.w)}, ${H(t.props.h)}) rotate(180)`;break;case 1:d=`translate(0, ${H(t.props.h)}) rotate(270)`;break;default:throw Error("labelSide out of bounds")}const u={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:t.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},h=this.editor.textMeasure.measureTextSpans(e5(t.props.name,"Frame")+"",u),p=h[0],f=wn(h),g=f.box.w+f.box.x-p.box.x,m=a_(this.editor,h,{offsetY:-u.height-2,...u});return a.jsxs(a.Fragment,{children:[a.jsx("rect",{width:t.props.w,height:t.props.h,fill:i.solid,stroke:i.black.solid,strokeWidth:1,rx:1,ry:1}),a.jsxs("g",{transform:d,children:[a.jsx("rect",{x:-8,y:-u.height-4,width:g+16,height:u.height,fill:i.background,rx:4,ry:4}),m]})]})}indicator(t){const s=this.editor.getShapeGeometry(t).bounds;return a.jsx("rect",{width:H(s.width),height:H(s.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}w(mm,"type","frame"),w(mm,"props",eL),w(mm,"migrations",tL);function QA(n,e){return n>e?(qe*(e/2)+(n-e))*2:(qe*(n/2)+(e-n))*2}function t5(n,e){return g1(n,e).map((t,s)=>t.getSvgPathData(s===0)).join(" ")+" Z"}function roe(n,e,t,s){const i=n/4,r=e/4,o=Zi(s),l=t*.75,c=S=>S.addXY(o()*l,o()*l),d=new _(n/2,e),u=new _(0,r*1.2),h=new _(n/2,r*.9),p=new _(n,r*1.2),f=c(new _(n/2,e)),g=c(new _(0,r*1.2)),m=c(new _(n/2,r*.9)),x=c(new _(n,r*1.2));return[new Bn({start:d,cp1:new _(i*1.5,r*3),cp2:new _(0,r*2.5),end:u}),new Bn({start:u,cp1:new _(0,-r*.32),cp2:new _(i*1.85,-r*.32),end:h}),new Bn({start:h,cp1:new _(i*2.15,-r*.32),cp2:new _(n,-r*.32),end:p}),new Bn({start:p,cp1:new _(n,r*2.5),cp2:new _(i*2.5,r*3),end:f}),new Bn({start:f,cp1:new _(i*1.5,r*3),cp2:new _(0,r*2.5),end:g}),new Bn({start:g,cp1:new _(0,-r*.32),cp2:new _(i*1.85,-r*.32),end:m}),new Bn({start:m,cp1:new _(i*2.15,-r*.32),cp2:new _(n,-r*.32),end:x}),new Bn({start:x,cp1:new _(n,r*2.5),cp2:new _(i*2.5,r*3),end:d})].map((S,v)=>S.getSvgPathData(v===0)).join(" ")+" Z"}function g1(n,e){const t=n/4,s=e/4;return[new Bn({start:new _(n/2,e),cp1:new _(t*1.5,s*3),cp2:new _(0,s*2.5),end:new _(0,s*1.2)}),new Bn({start:new _(0,s*1.2),cp1:new _(0,-s*.32),cp2:new _(t*1.85,-s*.32),end:new _(n/2,s*.9)}),new Bn({start:new _(n/2,s*.9),cp1:new _(t*2.15,-s*.32),cp2:new _(n,-s*.32),end:new _(n,s*1.2)}),new Bn({start:new _(n,s*1.2),cp1:new _(n,s*2.5),cp2:new _(t*2.5,s*3),end:new _(n/2,e)})]}function ooe(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function aoe(n,e,t,s){const i=Zi(n),r=e/2,o=t/2,l=wL(r,o),c=[],d=et*i(),u=et+gt/2+Math.abs(i())*gt,h=Math.max(16,l/10);for(let p=0;p<h;p++){const f=p/(h-1),g=d+f*u,m=Math.cos(g),x=Math.sin(g);c.push(new _(r*m+e*.5+.05*i(),o*x+t/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?ln.easeInOutSine(f):ln.easeInExpo(f)))/2)))}return Rr(c,ooe(s))}function loe(n,e,t,s){return Ol(aoe(n,e,t,s))}function d_(n){let e="M";const t=n.length;let s,i,r;for(let o=0,l=t;o<l;o+=3)s=n[o],i=n[o+1],r=n[o+2],e+=`${Ye(s)}L${Ye(i)}Q${Ye(r)}`;return e+=`${Ye(n[0])}`,e}function u_(n,e,t,s,i){const r=[],o=Zi(n);let l=e[0],c;const d=e.length;for(let u=0,h=d*i;u<h;u++){c=_.AddXY(e[(u+1)%d],o()*t,o()*t);const p=_.Sub(c,l),f=_.Len(p),g=_.Div(p,f).mul(Math.min(f/4,s));r.push(_.Add(l,g),_.Add(c,g.neg()),c),l=c}return r}function coe(n,e,t){const s=Math.min(n,e)/2,i=Math.max(n,e)-s*2,o=(Math.PI*(s*2)+2*i)/t,l=n>e?[{type:"straight",start:new _(s,0),delta:new _(1,0)},{type:"arc",center:new _(n-s,s),startAngle:-qe/2},{type:"straight",start:new _(n-s,e),delta:new _(-1,0)},{type:"arc",center:new _(s,s),startAngle:qe/2}]:[{type:"straight",start:new _(n,s),delta:new _(0,1)},{type:"arc",center:new _(s,e-s),startAngle:0},{type:"straight",start:new _(0,e-s),delta:new _(0,-1)},{type:"arc",center:new _(s,s),startAngle:qe}];let c=0;const d=[];for(let u=0;u<t;u++){const h=l[0];h.type==="straight"?d.push(_.Add(h.start,_.Mul(h.delta,c))):d.push(Rl(h.center,s,h.startAngle+c/s)),c+=o;let p=h.type==="straight"?i:qe*s;for(;c>p;)c-=p,l.push(l.shift()),p=l[0].type==="straight"?i:qe*s}return d}const doe={s:50,m:70,l:100,xl:130},uoe=.2;function hx(n,e,t,s){const i=Zi(t),r=QA(n,e),o=Math.max(Math.ceil(r/doe[s]),6,Math.ceil(r/Math.min(n,e))),l=r/o*uoe,c=Math.max(n-l*2,1),d=Math.max(e-l*2,1),h=QA(c,d)/o,p=(n-c)/2,f=(e-d)/2,g=coe(c,d,o).map(v=>v.addXY(p,f)),m=n<20?0:l*.3,x=e<20?0:l*.3,y=g.slice(0);for(let v=0;v<Math.floor(o/2);v++)y[v]=_.AddXY(y[v],i()*m,i()*x),y[o-v-1]=_.AddXY(y[o-v-1],i()*m,i()*x);const S=[];for(let v=0;v<y.length;v++){const C=v===y.length-1?0:v+1,T=y[v],I=y[C],E=g[v],P=g[C],k=_.Dist(E,P),j=h-k,R=_.Dist(T,I)/k,A=(Math.max(p,f)+j)*R,N=_.Lrp(E,P,.5).add(_.Sub(P,E).uni().per().mul(A));N.x<0?N.x=0:N.x>n&&(N.x=n),N.y<0?N.y=0:N.y>e&&(N.y=e);const B=$E(T,I,N),L=_.Dist(B||_.Average([T,I]),T);S.push({leftPoint:T,rightPoint:I,arcPoint:N,center:B,radius:L})}return S}function hoe(n,e,t,s){const i=[],r=hx(n,e,t,s);for(const{center:o,radius:l,leftPoint:c,rightPoint:d}of r)i.push(...SQ(c,d,o,l,10));return i}function h_(n,e,t,s){const i=hx(n,e,t,s);let r=`M${i[0].leftPoint.toFixed()}`;for(const{leftPoint:o,rightPoint:l,radius:c,center:d}of i){if(d===null){r+=` L${l.toFixed()}`;continue}const u=_.Clockwise(o,l,d)?"0":"1";r+=` A${H(c)},${H(c)} 0 ${u},1 ${l.toFixed()}`}return r+=" Z",r}const poe={s:.5,m:.7,l:.9,xl:1.6};function foe(n,e,t,s){const i=Zi(t),r=poe[s],o=hx(n,e,t,s),d=o.reduce((f,g)=>f+_.Dist2(g.leftPoint,g.rightPoint),0)/o.length>(r*15)**2?f=>f.addXY(i()*r*2,i()*r*2):f=>f;let u=`M${o[0].leftPoint.toFixed()}`,h=d(o[0].leftPoint),p=`M${h.toFixed()}`;for(const{leftPoint:f,center:g,rightPoint:m,radius:x,arcPoint:y}of o){if(g===null){u+=` L${m.toFixed()}`;const E=d(m);p+=` L${E.toFixed()}`,h=E;continue}const S=_.Clockwise(f,m,g)?"0":"1";u+=` A${H(x)},${H(x)} 0 ${S},1 ${m.toFixed()}`;const v=d(m),C=d(y),T=$E(h,v,C);if(!Number.isFinite(T.x)||!Number.isFinite(T.y)){p+=` L${v.toFixed()}`,h=v;continue}const I=Math.abs(_.Dist(T,h));p+=` A${H(I)},${H(I)} 0 ${S},1 ${v.toFixed()}`,h=v}return u+p+" Z"}function p_(n,e){switch(n.geo){case"x-box":return goe(n.w,n.h,e,n.dash);case"check-box":return moe(n.w,n.h);default:return}}function goe(n,e,t,s){const i=s==="draw"?.62:0;if(s==="dashed")return[[new _(0,0),new _(n/2,e/2)],[new _(n,e),new _(n/2,e/2)],[new _(0,e),new _(n/2,e/2)],[new _(n,0),new _(n/2,e/2)]];const r=l=>Math.max(0,Math.min(n,l)),o=l=>Math.max(0,Math.min(e,l));return[[new _(r(t*i),o(t*i)),new _(r(n-t*i),o(e-t*i))],[new _(r(t*i),o(e-t*i)),new _(r(n-t*i),o(t*i))]]}function moe(n,e){const t=Math.min(n,e)*.82,s=(n-t)/2,i=(e-t)/2,r=l=>Math.max(0,Math.min(n,l)),o=l=>Math.max(0,Math.min(e,l));return[[new _(r(s+t*.25),o(i+t*.52)),new _(r(s+t*.45),o(i+t*.82))],[new _(r(s+t*.45),o(i+t*.82)),new _(r(s+t*.82),o(i+t*.22))]]}function ej({shape:n,shouldScale:e}){const t=e?n.props.scale:1,s=G(),i=Pi(),{id:r,props:o}=n,{w:l,color:c,fill:d,dash:u,growY:h,size:p}=o,f=cn[p]*t,g=o.h+h;switch(o.geo){case"cloud":if(u==="solid"){const m=h_(l,g,r,p);return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:m,color:c,fill:d,scale:t}),a.jsx("path",{d:m,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}else if(u==="draw"){const m=foe(l,g,r,p);return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:m,color:c,fill:d,scale:t}),a.jsx("path",{d:m,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}else{const m=h_(l,g,r,p),x=hx(l,g,r,p);return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:m,color:c,fill:d,scale:t}),a.jsx("g",{strokeWidth:f,stroke:i[c].solid,fill:"none",pointerEvents:"all",children:x.map(({leftPoint:y,rightPoint:S,center:v,radius:C},T)=>{const I=v?C*ba(ba(_.Angle(v,S))-ba(_.Angle(v,y))):_.Dist(y,S),{strokeDasharray:E,strokeDashoffset:P}=ur(I,f,{style:u,start:"outset",end:"outset"});return a.jsx("path",{d:v?`M${y.x},${y.y}A${C},${C},0,0,1,${S.x},${S.y}`:`M${y.x},${y.y}L${S.x},${S.y}`,strokeDasharray:E,strokeDashoffset:P},T)})})]})}case"ellipse":{const m=e?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n),x=m.getSvgPathData(!0);if(u==="dashed"||u==="dotted"){const y=m.length,{strokeDasharray:S,strokeDashoffset:v}=ur(y<64?y*2:y,f,{style:u,snap:4,closed:!0});return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:x,color:c,fill:d,scale:t}),a.jsx("path",{d:x,strokeWidth:f,fill:"none",stroke:i[c].solid,strokeDasharray:S,strokeDashoffset:v})]})}else{const S=(e?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n)).getSvgPathData(!0);return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:S,color:c,fill:d,scale:t}),a.jsx("path",{d:S,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}}case"oval":{const m=e?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n),x=m.getSvgPathData(!0);if(u==="dashed"||u==="dotted"){const y=m.getLength(),{strokeDasharray:S,strokeDashoffset:v}=ur(y<64?y*2:y,f,{style:u,snap:4,start:"outset",end:"outset",closed:!0});return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:x,color:c,fill:d,scale:t}),a.jsx("path",{d:x,strokeWidth:f,fill:"none",stroke:i[c].solid,strokeDasharray:S,strokeDashoffset:v})]})}else return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:x,color:c,fill:d,scale:t}),a.jsx("path",{d:x,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}case"heart":if(u==="dashed"||u==="dotted"||u==="solid"){const m=t5(l,g),x=g1(l,g);return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:m,color:c,fill:d,scale:t}),x.map((y,S)=>{const{strokeDasharray:v,strokeDashoffset:C}=ur(y.length,f,{style:u,snap:1,start:"outset",end:"outset",closed:!0});return a.jsx("path",{d:y.getSvgPathData(),strokeWidth:f,fill:"none",stroke:i[c].solid,strokeDasharray:v,strokeDashoffset:C,pointerEvents:"all"},`curve_${S}`)})]})}else{const m=roe(l,g,f,n.id);return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:m,color:c,fill:d,scale:t}),a.jsx("path",{d:m,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}default:{const m=e?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n),x=m instanceof Yi?m.children[0].vertices:m.vertices,y=p_(n.props,f);if(u==="solid"){let S="M"+x[0]+"L"+x.slice(1)+"Z";if(y)for(const[v,C]of y)S+=`M${v.x},${v.y}L${C.x},${C.y}`;return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:S,color:c,fill:d,scale:t}),a.jsx("path",{d:S,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}else if(u==="dashed"||u==="dotted"){const S="M"+x[0]+"L"+x.slice(1)+"Z";return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:S,color:c,fill:d,scale:t}),a.jsxs("g",{strokeWidth:f,stroke:i[c].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(x.length)).map((v,C)=>{const T=_.ToFixed(x[C]),I=_.ToFixed(x[(C+1)%x.length]),E=_.Dist(T,I),{strokeDasharray:P,strokeDashoffset:k}=ur(E,f,{style:u,start:"outset",end:"outset"});return a.jsx("line",{x1:T.x,y1:T.y,x2:I.x,y2:I.y,strokeDasharray:P,strokeDashoffset:k},C)}),y&&y.map(([v,C],T)=>{const I=_.Dist(v,C),{strokeDasharray:E,strokeDashoffset:P}=ur(I,f,{style:u,start:"skip",end:"skip",snap:u==="dotted"?4:void 0});return a.jsx("path",{d:`M${v.x},${v.y}L${C.x},${C.y}`,stroke:i[c].solid,strokeWidth:f,fill:"none",strokeDasharray:E,strokeDashoffset:P},`line_fg_${T}`)})]})]})}else if(u==="draw"){let S=d_(u_(r,x,f/3,f*2,2));if(y)for(const[C,T]of y)S+=`M${C.toFixed()}L${T.toFixed()}`;const v=d_(u_(r,x,0,f*2,1));return a.jsxs(a.Fragment,{children:[a.jsx(Ln,{theme:i,d:v,color:c,fill:d,scale:t}),a.jsx("path",{d:S,stroke:i[c].solid,strokeWidth:f,fill:"none"})]})}}}}const tj=17*3;class ym extends Wd{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"onEditEnd",t=>{const{id:s,type:i,props:{text:r}}=t;r.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:s,type:i,props:{text:r.trimEnd()}}])});w(this,"onResize",(t,{handle:s,newPoint:i,scaleX:r,scaleY:o,initialShape:l})=>{const c=l.props.w/l.props.scale,d=l.props.h/l.props.scale,u=l.props.growY/l.props.scale;let h=c*r,p=(d+u)*o,f=0,g=0;const m=tj;if(t.props.text.trim()){let T=Math.max(Math.abs(h),m),I=Math.max(Math.abs(p),m);T<m&&I===m&&(T=m),T===m&&I<m&&(I=m);const E=lg(this.editor,{...t,props:{...t.props,w:T*t.props.scale,h:I*t.props.scale}}),P=Math.max(Math.abs(h),E.w)*Math.sign(h),k=Math.max(Math.abs(p),E.h)*Math.sign(p);f=Math.abs(P)-Math.abs(h),g=Math.abs(k)-Math.abs(p),h=P,p=k}const x=h*t.props.scale,y=p*t.props.scale,S=new _(0,0);r<0&&(S.x+=x),(s==="left"||s==="top_left"||s==="bottom_left")&&(S.x+=r<0?f:-f),o<0&&(S.y+=y),(s==="top"||s==="top_left"||s==="top_right")&&(S.y+=o<0?g:-g);const{x:v,y:C}=S.rot(t.rotation).add(i);return{x:v,y:C,props:{w:Math.max(Math.abs(x),1),h:Math.max(Math.abs(y),1),growY:0}}});w(this,"onBeforeCreate",t=>{if(!t.props.text)return t.props.growY?{...t,props:{...t.props,growY:0}}:void 0;const s=t.props.h/t.props.scale,i=lg(this.editor,t).h;let r=null;if(i>s?r=i-s:t.props.growY&&(r=0),r!==null)return{...t,props:{...t.props,growY:r*t.props.scale}}});w(this,"onBeforeUpdate",(t,s)=>{const i=t.props.text,r=s.props.text;if(i===r&&t.props.font===s.props.font&&t.props.size===s.props.size)return;if(i&&!r)return{...s,props:{...s.props,growY:0}};const o=t.props.w/t.props.scale,l=t.props.h/t.props.scale,c=t.props.growY/t.props.scale,d=lg(this.editor,s);if(!i&&r&&r.length===1){let h=Math.max(o,d.w),p=Math.max(l,d.h);const f=tj;return o<f&&l<f&&(h=Math.max(h,f),p=Math.max(p,f),h=Math.max(h,p),p=Math.max(h,p)),{...s,props:{...s.props,w:h*s.props.scale,h:p*s.props.scale,growY:0}}}let u=null;if(d.h>l?u=d.h-l:c&&(u=0),u!==null){const h=s.props.w/s.props.scale;return{...s,props:{...s.props,growY:u*s.props.scale,w:Math.max(h,d.w)*s.props.scale}}}if(d.w>o)return{...s,props:{...s.props,w:d.w*s.props.scale}}});w(this,"onDoubleClick",t=>{if(this.editor.inputs.altKey)switch(t.props.geo){case"rectangle":return{...t,props:{geo:"check-box"}};case"check-box":return{...t,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(t){const s=Math.max(1,t.props.w),i=Math.max(1,t.props.h+t.props.growY),r=s/2,o=i/2,l=t.props.fill!=="none";let c;switch(t.props.geo){case"cloud":{c=new Wt({points:hoe(s,i,t.id,t.props.size),isFilled:l});break}case"triangle":{c=new Wt({points:[new _(r,0),new _(s,i),new _(0,i)],isFilled:l});break}case"diamond":{c=new Wt({points:[new _(r,0),new _(s,o),new _(r,i),new _(0,o)],isFilled:l});break}case"pentagon":{c=new Wt({points:iw(s,i,5),isFilled:l});break}case"hexagon":{c=new Wt({points:iw(s,i,6),isFilled:l});break}case"octagon":{c=new Wt({points:iw(s,i,8),isFilled:l});break}case"ellipse":{c=new Yse({width:s,height:i,isFilled:l});break}case"oval":{c=new Xse({width:s,height:i,isFilled:l});break}case"star":{const v=et/5/2,C=Math.floor(5/4)*2,T=5*2-C,I=0,E=Math.floor(5/2)*2,P=Math.cos(-gt+C*v)*s/2,k=Math.cos(-gt+T*v)*s/2,j=Math.sin(-gt+I*v)*i/2,D=Math.sin(-gt+E*v)*i/2,R=s-Math.abs(P-k),A=i-Math.abs(D-j),N=s/2+k-(s/2-P),B=i/2+j-(i/2-D),L=1,O=(s-N)/2,F=(i-B)/2,W=(s+R)/2,$=(i+A)/2,K=W*L/2,Y=$*L/2;c=new Wt({points:Array.from(Array(5*2)).map((U,J)=>{const te=-gt+J*v;return new _(O+(J%2?K:W)*Math.cos(te),F+(J%2?Y:$)*Math.sin(te))}),isFilled:l});break}case"rhombus":{const S=Math.min(s*.38,i*.38);c=new Wt({points:[new _(S,0),new _(s,0),new _(s-S,i),new _(0,i)],isFilled:l});break}case"rhombus-2":{const S=Math.min(s*.38,i*.38);c=new Wt({points:[new _(0,0),new _(s-S,0),new _(s,i),new _(S,i)],isFilled:l});break}case"trapezoid":{const S=Math.min(s*.38,i*.38);c=new Wt({points:[new _(S,0),new _(s-S,0),new _(s,i),new _(0,i)],isFilled:l});break}case"arrow-right":{const S=Math.min(s,i)*.38,v=i*.16;c=new Wt({points:[new _(0,v),new _(s-S,v),new _(s-S,0),new _(s,i/2),new _(s-S,i),new _(s-S,i-v),new _(0,i-v)],isFilled:l});break}case"arrow-left":{const S=Math.min(s,i)*.38,v=i*.16;c=new Wt({points:[new _(S,0),new _(S,v),new _(s,v),new _(s,i-v),new _(S,i-v),new _(S,i),new _(0,i/2)],isFilled:l});break}case"arrow-up":{const S=s*.16,v=Math.min(s,i)*.38;c=new Wt({points:[new _(s/2,0),new _(s,v),new _(s-S,v),new _(s-S,i),new _(S,i),new _(S,v),new _(0,v)],isFilled:l});break}case"arrow-down":{const S=s*.16,v=Math.min(s,i)*.38;c=new Wt({points:[new _(S,0),new _(s-S,0),new _(s-S,i-v),new _(s,i-v),new _(s/2,i),new _(0,i-v),new _(S,i-v)],isFilled:l});break}case"check-box":case"x-box":case"rectangle":{c=new wo({width:s,height:i,isFilled:l});break}case"heart":{const v=g1(s,i).reduce((C,T)=>(C.push(...T.vertices),C),[]);c=new Wt({points:v,isFilled:l});break}default:Vn(t.props.geo)}const d=lg(this.editor,t),u=s/t.props.scale,h=i/t.props.scale,p=Math.min(100,u/2),f=Math.min(ho[t.props.size]*In.lineHeight+di*2,h/2),g=Math.min(u,Math.max(d.w,Math.min(p,Math.max(1,u-8)))),m=Math.min(h,Math.max(d.h,Math.min(f,Math.max(1,h-8)))),x=p_(t.props,cn[t.props.size]*t.props.scale),y=x?x.map(S=>new zd({points:S})):[];return new Yi({children:[c,new wo({x:t.props.align==="start"?0:t.props.align==="end"?(u-g)*t.props.scale:(u-g)/2*t.props.scale,y:t.props.verticalAlign==="start"?0:t.props.verticalAlign==="end"?(h-m)*t.props.scale:(h-m)/2*t.props.scale,width:g*t.props.scale,height:m*t.props.scale,isFilled:!0,isLabel:!0}),...y]})}getHandleSnapGeometry(t){const s=this.getGeometry(t),i=s.children[0];switch(t.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:i,points:[...i.getVertices(),s.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:i,points:[s.bounds.center]};default:Vn(t.props.geo)}}component(t){const{id:s,type:i,props:r}=t,{fill:o,font:l,align:c,verticalAlign:d,size:u,text:h}=r,p=Pi(),f=this.editor.getEditingShapeId()!==null,g=q("isGeoOnlySelected",()=>t.id===this.editor.getOnlySelectedShapeId(),[]),m=f||t.props.text;return a.jsxs(a.Fragment,{children:[a.jsx(ja,{id:s,children:a.jsx(ej,{shape:t,shouldScale:!0})}),m&&a.jsx(Ml,{style:{overflow:"hidden",width:t.props.w,height:t.props.h+r.growY},children:a.jsx(ux,{id:s,type:i,font:l,fontSize:ho[u]*t.props.scale,lineHeight:In.lineHeight,padding:di*t.props.scale,fill:o,align:c,verticalAlign:d,text:h,isSelected:g,labelColor:p[r.labelColor].solid,wrap:!0})}),t.props.url&&a.jsx(wd,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(t){const{id:s,props:i}=t,{w:r,size:o}=i,l=i.h+i.growY,c=cn[o],d=this.editor.getShapeGeometry(t);switch(i.geo){case"ellipse":return i.dash==="draw"?a.jsx("path",{d:loe(s,r,l,c)}):a.jsx("path",{d:d.getSvgPathData(!0)});case"heart":return a.jsx("path",{d:t5(r,l)});case"oval":return a.jsx("path",{d:d.getSvgPathData(!0)});case"cloud":return a.jsx("path",{d:h_(r,l,s,o)});default:{const u=this.editor.getShapeGeometry(t),h=u instanceof Yi?u.children[0].vertices:u.vertices;let p;if(i.dash==="draw"){const g=u_(s,h,0,c*2*t.props.scale,1);p=d_(g)}else p="M"+h[0]+"L"+h.slice(1)+"Z";const f=p_(t.props,c);if(f)for(const[g,m]of f)p+=`M${g.x},${g.y}L${m.x},${m.y}`;return a.jsx("path",{d:p})}}}toSvg(t,s){const i={...t,props:{...t.props,w:t.props.w/t.props.scale,h:t.props.h/t.props.scale}},r=i.props;s.addExportDef(d1(r.fill));let o;if(r.text){s.addExportDef(cx(r.font));const l=No(s),c=new ue(0,0,r.w,r.h+r.growY);o=a.jsx(dx,{fontSize:ho[r.size],font:r.font,align:r.align,verticalAlign:r.verticalAlign,text:r.text,labelColor:l[r.labelColor].solid,bounds:c,padding:16})}return a.jsxs(a.Fragment,{children:[a.jsx(ej,{shouldScale:!1,shape:i}),o]})}getCanvasSvgDefs(){return[u1()]}}w(ym,"type","geo"),w(ym,"props",nL),w(ym,"migrations",sL);function lg(n,e){const{text:t,font:s,size:i,w:r}=e.props;if(!t)return{w:0,h:0};const o=n.textMeasure.measureText("w",{...In,fontFamily:Tr[s],fontSize:ho[i],maxWidth:100}),l={s:2,m:3.5,l:5,xl:10},c=n.textMeasure.measureText(t,{...In,fontFamily:Tr[s],fontSize:ho[i],minWidth:o.w,maxWidth:Math.max(0,Math.ceil(o.w+l[i]),Math.ceil(r/e.props.scale-di*2))});return{w:c.w+di*2,h:c.h+di*2}}function yoe(){const[n,e]=b.useState(!1);return b.useEffect(()=>{const s=CSS.supports("color","color(display-p3 1 1 1)"),i=matchMedia("(color-gamut: p3)");e(s&&i.matches);const r=()=>e(s&&i.matches);return i.addEventListener("change",r),()=>i.removeEventListener("change",r)},[]),q(Gt.forceSrgb)||!n?"srgb":"p3"}const nj=.35,sj=.82;class vm extends Wi{constructor(){super(...arguments);w(this,"hideResizeHandles",t=>cg(t));w(this,"hideRotateHandle",t=>cg(t));w(this,"hideSelectionBoundsFg",t=>cg(t));w(this,"onResize",(t,s)=>{const{scaleX:i,scaleY:r}=s,o=[];for(const l of t.props.segments)o.push({...l,points:l.points.map(({x:c,y:d,z:u})=>({x:i*c,y:r*d,z:u}))});return{props:{segments:o}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(t){const s=al(t);if(cg(t))return new o1({x:-s/2,y:-s/2,radius:s/2,isFilled:!0});const{strokePoints:i,sw:r}=ij(t,s,!0),o=f1({strokeWidth:r,showAsComplete:!0});return ax(i,o),new Wt({points:a1(i,o),isFilled:!0})}component(t){const s=Tw(this.editor,t),i=al(t);return a.jsx(ja,{id:t.id,children:a.jsx(dg,{shape:t,forceSolid:s,strokeWidth:i,opacity:nj})})}backgroundComponent(t){const s=Tw(this.editor,t),i=al(t);return a.jsx(ja,{id:t.id,children:a.jsx(dg,{shape:t,forceSolid:s,strokeWidth:i,opacity:sj})})}indicator(t){const s=Tw(this.editor,t),i=al(t),{strokePoints:r,sw:o}=ij(t,i,s),l=bd(t.props.segments);let c;return r.length<2?c=xoe(l[0],o):c=Ol(r,!1),a.jsx("path",{d:c})}toSvg(t){const s=al(t),i=s<1.5,r=1/t.props.scale;return a.jsx("g",{transform:`scale(${r})`,children:a.jsx(dg,{forceSolid:i,strokeWidth:s,shape:t,opacity:nj})})}toBackgroundSvg(t){const s=al(t),i=s<1.5,r=1/t.props.scale;return a.jsx("g",{transform:`scale(${r})`,children:a.jsx(dg,{forceSolid:i,strokeWidth:s,shape:t,opacity:sj})})}}w(vm,"type","highlight"),w(vm,"props",oL),w(vm,"migrations",aL);function voe(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function xoe(n,e){const t=e/2;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function ij(n,e,t){var c;const s=bd(n.props.segments),i=n.props.isComplete||((c=wn(n.props.segments))==null?void 0:c.type)==="straight";let r=e;!t&&!n.props.isPen&&s.length===1&&(r+=Zi(n.id)()*(e/6));const o=f1({strokeWidth:r,showAsComplete:i});return{strokePoints:Rr(s,o),sw:r}}function al(n){return xd[n.props.size]*1.12*n.props.scale}function cg(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function dg({strokeWidth:n,forceSolid:e,shape:t,opacity:s}){var p;const i=Pi(),r=bd(t.props.segments);let o=n;!e&&!t.props.isPen&&r.length===1&&(o+=Zi(t.id)()*(o/6));const l=f1({strokeWidth:o,showAsComplete:t.props.isComplete||((p=wn(t.props.segments))==null?void 0:p.type)==="straight"}),c=Rr(r,l),d=c.length>1?Ol(c,!1):voe(t.props.segments[0].points[0]),u=yoe(),h=i[t.props.color].highlight[u];return a.jsx("path",{d,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:h,strokeWidth:o,opacity:s})}function Tw(n,e){return q("forceSolid",()=>{const t=al(e),s=n.getZoomLevel();return t/s<1.5},[n])}function n5(){return a.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[a.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),a.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),a.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function s5(n,e,t){const s=G(),[i,r]=b.useState(null),o=e?s.getAsset(e):null,c=s.getCulledShapes().has(n),d=b.useRef(!1);b.useEffect(()=>{i&&(d.current=!0)},[i]);const u=o&&"w"in o.props?t/o.props.w:1,h=q("zoom level",()=>s.getZoomLevel()*u,[s,u]);return b.useEffect(()=>{if(c)return;let p=!1;const f=s.timers.setTimeout(async()=>{const g=await s.resolveAssetUrl(e,{screenScale:h});p||r(g)},d.current?500:0);return()=>{clearTimeout(f),p=!0}},[e,o==null?void 0:o.props.src,c,h,s]),{asset:o,url:i}}function i5(){const[n,e]=b.useState(!1);return b.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),s=()=>{e(t.matches)};return s(),t.addEventListener("change",s),()=>t.removeEventListener("change",s)},[]),n}async function Soe(n){const t=await(await Ar(n)).blob();return wl.blobToDataUrl(t)}class xm extends Wd{constructor(){super(...arguments);w(this,"isAspectRatioLocked",()=>!0);w(this,"canCrop",()=>!0);w(this,"onResize",(t,s)=>{let i=i1(t,s);const{flipX:r,flipY:o}=s.initialShape.props;return i={...i,props:{...i.props,flipX:s.scaleX<0!==r,flipY:s.scaleY<0!==o}},i});w(this,"onDoubleClick",t=>{const s=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;!s||!(s.props.src&&this.isAnimated(t))||this.editor.updateShapes([{type:"image",id:t.id,props:{playing:!t.props.playing}}])});w(this,"onDoubleClickEdge",t=>{const s=t.props;if(!s||this.editor.getCroppingShapeId()!==t.id)return;const i=ft(s.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},r=1/(i.bottomRight.x-i.topLeft.x)*t.props.w,o=1/(i.bottomRight.y-i.topLeft.y)*t.props.h,l=new _(i.topLeft.x*r,i.topLeft.y*o).rot(t.rotation),c={id:t.id,type:t.type,x:t.x-l.x,y:t.y-l.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:r,h:o}};this.editor.updateShapes([c])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}isAnimated(t){const s=t.props.assetId?this.editor.getAsset(t.props.assetId):void 0;return s?"mimeType"in s.props&&gr.isAnimatedImageType(s==null?void 0:s.props.mimeType)||"isAnimated"in s.props&&s.props.isAnimated:!1}component(t){var m;const s=this.editor.getCroppingShapeId()===t.id,i=i5(),[r,o]=b.useState(""),[l,c]=b.useState(""),d=t.id===this.editor.getOnlySelectedShapeId(),{asset:u,url:h}=s5(t.id,t.props.assetId,t.props.w);if(b.useEffect(()=>{if(h){let x=!1;const y=md();return y.onload=()=>{x||c(h)},y.src=h,()=>{x=!0}}},[h,t]),b.useEffect(()=>{if(h&&this.isAnimated(t)){let x=!1;const y=md();return y.onload=()=>{if(x)return;const S=document.createElement("canvas");S.width=y.width,S.height=y.height;const v=S.getContext("2d");v&&(v.drawImage(y,0,0),o(S.toDataURL()),c(h))},y.crossOrigin="anonymous",y.src=h,()=>{x=!0}}},[i,h,t]),(u==null?void 0:u.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const p=d&&s&&this.editor.isIn("select.crop"),f=i&&(((m=u==null?void 0:u.props.mimeType)==null?void 0:m.includes("video"))||this.isAnimated(t)),g=rj(t);return u!=null&&u.props.src?l?a.jsxs(a.Fragment,{children:[p&&a.jsx("div",{style:g,children:a.jsx("img",{className:"tl-image",crossOrigin:this.isAnimated(t)?"anonymous":void 0,src:!t.props.playing||f?r:l,referrerPolicy:"strict-origin-when-cross-origin",style:{opacity:.1},draggable:!1})}),a.jsxs(Ml,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h},children:[a.jsxs("div",{className:"tl-image-container",style:g,children:[a.jsx("img",{className:Se("tl-image",{"tl-flip-x":t.props.flipX&&!t.props.flipY,"tl-flip-y":t.props.flipY&&!t.props.flipX,"tl-flip-xy":t.props.flipY&&t.props.flipX}),crossOrigin:this.isAnimated(t)?"anonymous":void 0,src:!t.props.playing||f?r:l,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1}),this.isAnimated(t)&&!t.props.playing&&a.jsx("div",{className:"tl-image__tg",children:"GIF"})]}),t.props.url&&a.jsx(wd,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})]}):null:a.jsxs(Ml,{id:t.id,style:{overflow:"hidden",width:t.props.w,height:t.props.h,color:"var(--color-text-3)",backgroundColor:u?"transparent":"var(--color-low)",border:u?"none":"1px solid var(--color-low-border)"},children:[a.jsx("div",{className:"tl-image-container",style:g,children:u?null:a.jsx(n5,{})}),"url"in t.props&&t.props.url&&a.jsx(wd,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(t){return this.editor.getCroppingShapeId()===t.id?null:a.jsx("rect",{width:H(t.props.w),height:H(t.props.h)})}async toSvg(t){if(!t.props.assetId||!this.editor.getAsset(t.props.assetId))return null;let i=await this.editor.resolveAssetUrl(t.props.assetId,{shouldResolveToOriginal:!0});if(!i)return null;(i.startsWith("blob:")||i.startsWith("http")||i.startsWith("/")||i.startsWith("./"))&&(i=await Soe(i)||"");const r=rj(t),o=t.props.crop;if(r.transform&&o){const{transform:l,width:c,height:d}=r,u=(o.bottomRight.x-o.topLeft.x)*c,h=(o.bottomRight.y-o.topLeft.y)*d,p=[new _(0,0),new _(u,0),new _(u,h),new _(0,h)],f=`cropClipPath_${t.id.replace(":","_")}`;return a.jsxs(a.Fragment,{children:[a.jsx("defs",{children:a.jsx("clipPath",{id:f,children:a.jsx("polygon",{points:p.map(g=>`${g.x},${g.y}`).join(" ")})})}),a.jsx("g",{clipPath:`url(#${f})`,children:a.jsx("image",{href:i,width:c,height:d,style:{transform:l}})})]})}else return a.jsx("image",{href:i,width:t.props.w,height:t.props.h})}}w(xm,"type","image"),w(xm,"props",lL),w(xm,"migrations",cL);function rj(n){const e=n.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:n.props.w,height:n.props.h};const s=1/(e.bottomRight.x-e.topLeft.x)*n.props.w,i=1/(e.bottomRight.y-e.topLeft.y)*n.props.h,r=-t.x*s,o=-t.y*i;return{transform:`translate(${r}px, ${o}px)`,width:s,height:i}}function r5(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function o5(n,e,t){const s=e.vertices,i=r5(t);return Rr(s,i)}function woe(n,e,t){const s=r5(t);return a1(ax(o5(n,e,t),s),s)}function boe(n,e,t){const s=woe(n,e,t);return HE(s)}function _oe(n,e,t){if(n.props.dash==="draw"){const s=o5(n,e,t);return Ol(s)}return e.getSvgPathData()}function a5(n,e,t){let s=`M ${Ye(e[0])}L`,i=`M ${Ye(e[0])}L`;const r=t/3,o=t*2,l=Zi(n);let c=e[0],d,u=e[0],h;const p=e.length;for(let f=0,g=p-1;f<g;f++){d=e[f+1],h=_.AddXY(e[f+1],l()*r,l()*r);const m=_.Sub(d,c),x=_.Len(m),y=_.Div(m,x).mul(Math.min(x/4,o)),S=_.Add(c,y),v=_.Add(d,y.neg()),C=_.Sub(h,u),T=_.Len(C),I=_.Div(C,T).mul(Math.min(T/4,o)),E=_.Add(u,I),P=_.Add(h,I.neg());f===g-1?(s+=`${Ye(S)}L ${Ye(d)}`,i+=`${Ye(E)}L ${Ye(h)}`):(s+=`${Ye(S)}L ${Ye(v)}Q ${Ye(d)}`,i+=`${Ye(E)}L ${Ye(P)}Q ${Ye(h)}`,c=d,u=h)}return[s,s+i]}const Coe=new xo;class Sm extends Wi{constructor(){super(...arguments);w(this,"hideResizeHandles",()=>!0);w(this,"hideRotateHandle",()=>!0);w(this,"hideSelectionBoundsFg",()=>!0);w(this,"hideSelectionBoundsBg",()=>!0);w(this,"onResize",(t,s)=>{const{scaleX:i,scaleY:r}=s;return{props:{points:Rp(t.props.points,(o,{id:l,index:c,x:d,y:u})=>({id:l,index:c,x:d*i,y:u*r}))}}});w(this,"onHandleDrag",(t,{handle:s})=>{if(s.type==="vertex")return{...t,props:{...t.props,points:{...t.props.points,[s.id]:{id:s.id,index:s.index,x:s.x,y:s.y}}}}})}getDefaultProps(){const[t,s]=tp(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[t]:{id:t,index:t,x:0,y:0},[s]:{id:s,index:s,x:.1,y:.1}},scale:1}}getGeometry(t){return eh(t)}getHandles(t){return Coe.get(t.props,()=>{const s=eh(t),i=Qu(t),r=i.map(o=>({...o,id:o.index,type:"vertex",canSnap:!0}));for(let o=0;o<i.length-1;o++){const l=ep(i[o].index,i[o+1].index),d=s.segments[o].midPoint();r.push({id:l,type:"create",index:l,x:d.x,y:d.y,canSnap:!0})}return r.sort(Hn)})}component(t){return a.jsx(ja,{id:t.id,children:a.jsx(oj,{shape:t})})}indicator(t){const s=cn[t.props.size]*t.props.scale,i=eh(t),{dash:r}=t.props;let o;if(t.props.spline==="line"){const l=i.points;if(r==="solid"||r==="dotted"||r==="dashed")o="M"+l[0]+"L"+l.slice(1);else{const[c]=a5(t.id,l,s);o=c}}else o=_oe(t,i,s);return a.jsx("path",{d:o})}toSvg(t){return a.jsx(oj,{shouldScale:!0,shape:t})}getHandleSnapGeometry(t){const s=Qu(t);return{points:s,getSelfSnapPoints:i=>{const r=this.getHandles(t).filter(o=>o.type==="vertex").findIndex(o=>o.id===i.id);return s.filter((o,l)=>Math.abs(l-r)>1).map(_.From)},getSelfSnapOutline:i=>{const r=this.getHandles(t).filter(l=>l.type==="vertex").findIndex(l=>l.id===i.id),o=eh(t).segments.filter((l,c)=>c!==r-1&&c!==r);return o.length?new Yi({children:o}):null}}}getInterpolatedProps(t,s,i){const r=Qu(t),o=Qu(s),l=[],c=[];let d=wD;if(r.length>o.length)for(let u=0;u<r.length;u++)l[u]={...r[u]},o[u]===void 0?c[u]={...o[o.length-1],id:d}:c[u]={...o[u],id:d},d=Li(d);else if(o.length>r.length)for(let u=0;u<o.length;u++)c[u]={...o[u]},r[u]===void 0?l[u]={...r[r.length-1],id:d}:l[u]={...r[u],id:d},d=Li(d);else for(let u=0;u<o.length;u++)l[u]=r[u],c[u]=o[u];return{...s.props,points:Object.fromEntries(l.map((u,h)=>{const p=c[h];return[u.id,{...u,x:bs(u.x,p.x,i),y:bs(u.y,p.y,i)}]}))}}}w(Sm,"type","line"),w(Sm,"props",dL),w(Sm,"migrations",uL);function Qu(n){return Object.values(n.props.points).sort(Hn)}function eh(n){const e=Qu(n).map(_.From);switch(n.props.spline){case"cubic":return new Kse({points:e});case"line":return new zd({points:e})}}function oj({shape:n,shouldScale:e=!1}){const t=Pi(),s=eh(n),{dash:i,color:r,size:o}=n.props,l=1/n.props.scale,c=e?l:1,d=cn[o]*n.props.scale;if(n.props.spline==="line"){if(i==="solid"){const u=s.points,h="M"+u[0]+"L"+u.slice(1);return a.jsx("path",{d:h,stroke:t[r].solid,strokeWidth:d,fill:"none",transform:`scale(${c})`})}if(i==="dashed"||i==="dotted")return a.jsx("g",{stroke:t[r].solid,strokeWidth:d,transform:`scale(${c})`,children:s.segments.map((u,h)=>{const{strokeDasharray:p,strokeDashoffset:f}=ur(u.length,d,{style:i,start:h>0?"outset":"none",end:h<s.segments.length-1?"outset":"none"});return a.jsx("path",{strokeDasharray:p,strokeDashoffset:f,d:u.getSvgPathData(!0),fill:"none"},h)})});if(i==="draw"){const u=s.points,[h,p]=a5(n.id,u,d);return a.jsx("path",{d:p,stroke:t[r].solid,strokeWidth:d,fill:"none",transform:`scale(${c})`})}}if(n.props.spline==="cubic"){const u=s.getSvgPathData();if(i==="solid")return a.jsx("path",{strokeWidth:d,stroke:t[r].solid,fill:"none",d:u,transform:`scale(${c})`});if(i==="dashed"||i==="dotted")return a.jsx("g",{stroke:t[r].solid,strokeWidth:d,transform:`scale(${c})`,children:s.segments.map((h,p)=>{const{strokeDasharray:f,strokeDashoffset:g}=ur(h.length,d,{style:i,start:p>0?"outset":"none",end:p<s.segments.length-1?"outset":"none"});return a.jsx("path",{strokeDasharray:f,strokeDashoffset:g,d:h.getSvgPathData(),fill:"none"},p)})});if(i==="draw")return a.jsx("path",{d:boe(n,s,d),strokeWidth:1,stroke:t[r].solid,fill:t[r].solid,transform:`scale(${c})`})}}const l5=b.createContext(null);function Eoe({assetUrls:n,children:e}){return b.useEffect(()=>{for(const t of Object.values(n.icons)){const s=md();s.src=t,s.decode()}for(const t of Object.values(n.embedIcons)){const s=md();s.src=t,s.decode()}},[n]),a.jsx(l5.Provider,{value:n,children:e})}function m1(){const n=b.useContext(l5);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const f_={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project","share-menu.copied":"Copied link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},Toe=new Set(["ar","fa","he","ur","ku"]),uc={locale:"en",label:"English",messages:f_,dir:"ltr"};async function Ioe(n,e){if(!(await Ar(e.translations.en)).ok)return console.warn("No main translations found."),uc;if(n==="en")return uc;const s=sp.find(o=>o.locale===n);if(!s)return console.warn(`No translation found for locale ${n}`),uc;const r=await(await Ar(e.translations[s.locale])).json();if(!r)return console.warn(`No messages found for locale ${n}`),uc;for(const o in uc.messages)r[o];return{locale:n,label:s.label,dir:Toe.has(s.locale)?"rtl":"ltr",messages:{...uc.messages,...r}}}const c5=b.createContext(null);function d5(){const n=b.useContext(c5);if(!n)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return n}const Poe=pn(function({overrides:e,children:t}){const i=G().user.getLocale(),r=m1(),[o,l]=b.useState(()=>e&&e.en?{locale:"en",label:"English",dir:"ltr",messages:{...f_,...e.en}}:{locale:"en",label:"English",dir:"ltr",messages:f_});return b.useEffect(()=>{let c=!1;async function d(){const u=await Ioe(i,r);u&&!c&&(e&&e[i]?l({...u,messages:{...u.messages,...e[i]}}):l(u))}return d(),()=>{c=!0}},[r,i,e]),a.jsx(c5.Provider,{value:o,children:t})});function Fe(){const n=d5();return b.useCallback(function(t){return n.messages[t]??t},[n])}class wm extends Wi{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"hideResizeHandles",()=>!0);w(this,"hideSelectionBoundsFg",()=>!1);w(this,"onBeforeCreate",t=>aj(this.editor,t));w(this,"onBeforeUpdate",(t,s)=>{if(!(t.props.text===s.props.text&&t.props.font===s.props.font&&t.props.size===s.props.size))return aj(this.editor,s)});w(this,"onEditEnd",t=>{const{id:s,type:i,props:{text:r}}=t;r.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:s,type:i,props:{text:r.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(t){const{labelHeight:s,labelWidth:i}=u5(this.editor,t),{scale:r}=t.props,o=s*r,l=i*r,c=at*r,d=ug(t);return new Yi({children:[new wo({width:c,height:d,isFilled:!0}),new wo({x:t.props.align==="start"?0:t.props.align==="end"?c-l:(c-l)/2,y:t.props.verticalAlign==="start"?0:t.props.verticalAlign==="end"?d-o:(d-o)/2,width:l,height:o,isFilled:!0,isLabel:!0})]})}getHandles(t){const{scale:s}=t.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const r=this.editor.getZoomLevel();if(r*s<.25)return[];const o=ug(t),l=at*s,c=tre/r*s;return r*s<.5?[{id:"bottom",index:"a3",type:"clone",x:l/2,y:o+c}]:[{id:"top",index:"a1",type:"clone",x:l/2,y:-c},{id:"right",index:"a2",type:"clone",x:l+c,y:o/2},{id:"bottom",index:"a3",type:"clone",x:l/2,y:o+c},{id:"left",index:"a4",type:"clone",x:-c,y:o/2}]}component(t){const{id:s,type:i,props:{scale:r,color:o,font:l,size:c,align:d,text:u,verticalAlign:h,fontSizeAdjustment:p}}=t,f=joe(s),g=Pi(),m=at*r,x=ug(t),y=q("shape rotation",()=>{var C;return((C=this.editor.getShapePageTransform(s))==null?void 0:C.rotation())??0},[this.editor]),S=q("zoom",()=>this.editor.getZoomLevel()<.35/r,[r,this.editor]),v=t.id===this.editor.getOnlySelectedShapeId();return a.jsxs(a.Fragment,{children:[a.jsx("div",{id:s,className:"tl-note__container",style:{width:m,height:x,backgroundColor:g[o].note.fill,borderBottom:S?`${3*r}px solid rgb(15, 23, 31, .2)`:"none",boxShadow:S?"none":Noe(t.id,y,r)},children:a.jsx(ux,{id:s,type:i,font:l,fontSize:(p||ho[c])*r,lineHeight:In.lineHeight,align:d,verticalAlign:h,text:u,isNote:!0,isSelected:v,labelColor:g[o].note.text,wrap:!0,padding:16*r,onKeyDown:f})}),"url"in t.props&&t.props.url&&a.jsx(wd,{url:t.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(t){const{scale:s}=t.props;return a.jsx("rect",{rx:s,width:H(at*s),height:H(ug(t))})}toSvg(t,s){t.props.text&&s.addExportDef(cx(t.props.font));const i=No({isDarkMode:s.isDarkMode}),r=Roe(t);return a.jsxs(a.Fragment,{children:[a.jsx("rect",{x:5,y:5,rx:1,width:at-10,height:r.h,fill:"rgba(0,0,0,.1)"}),a.jsx("rect",{rx:1,width:at,height:r.h,fill:i[t.props.color].note.fill}),a.jsx(dx,{fontSize:t.props.fontSizeAdjustment||ho[t.props.size],font:t.props.font,align:t.props.align,verticalAlign:t.props.verticalAlign,text:t.props.text,labelColor:i[t.props.color].note.text,bounds:r,stroke:!1})]})}}w(wm,"type","note"),w(wm,"props",hL),w(wm,"migrations",pL);function aj(n,e){const{labelHeight:t,fontSizeAdjustment:s}=u5(n,e),i=Math.max(0,t-at);if(i!==e.props.growY||s!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:i,fontSizeAdjustment:s}}}function koe(n,e){const{text:t}=e.props;if(!t)return{labelHeight:ho[e.props.size]*In.lineHeight+di*2,labelWidth:100,fontSizeAdjustment:0};const s=ho[e.props.size];let i=0,r=0,o=at,l=at;const c=1;do{i=Math.min(s,s-r);const d=n.textMeasure.measureText(t,{...In,fontFamily:Tr[e.props.font],fontSize:i,maxWidth:at-di*2-c,disableOverflowWrapBreaking:!0});if(o=d.h+di*2,l=d.w+di*2,i<=14){const u=n.textMeasure.measureText(t,{...In,fontFamily:Tr[e.props.font],fontSize:i,maxWidth:at-di*2-c});o=u.h+di*2,l=u.w+di*2;break}if(d.scrollWidth.toFixed(0)===d.w.toFixed(0))break}while(r++<50);return{labelHeight:o,labelWidth:l,fontSizeAdjustment:i}}const Aoe=new xo;function u5(n,e){return Aoe.get(e,()=>koe(n,e))}function joe(n){const e=G(),t=d5();return b.useCallback(s=>{const i=e.getShape(n);if(!i)return;const r=s.key==="Tab",o=(s.metaKey||s.ctrlKey)&&s.key==="Enter";if(r||o){s.preventDefault();const l=e.getShapePageTransform(n),c=l.rotation(),d=!!(t.dir==="rtl"||DF(i.props.text)),u=(at+e.options.adjacentShapeMargin+(o&&!s.shiftKey?i.props.growY:0))*i.props.scale,h=new _(r?s.shiftKey!=d?-1:1:0,o?s.shiftKey?-1:1:0).mul(u).add(lx.clone().mul(i.props.scale)).rot(c).add(l.point()),p=HF(e,i,h,c);p&&(e.mark("editing adjacent shape"),Fy(e,p,!0))}},[n,e,t.dir])}function ug(n){return(at+n.props.growY)*n.props.scale}function Noe(n,e,t){const s=Zi(n),i=Math.abs(s())+.5,r=Math.cos(e),o=5*t,l=4*t,c=6*t,d=7*t;return`0px ${o-i}px ${o}px -${o}px rgba(15, 23, 31, .6),
	0px ${(l+i*d)*Math.max(0,r)}px ${c+i*d}px -${l+i*c}px rgba(15, 23, 31, ${(.3+i*.1).toFixed(2)}), 
	0px ${48*t}px ${10*t}px -${10*t}px inset rgba(15, 23, 44, ${((.022+s()*.005)*((1+r)/2)).toFixed(2)})`}function Roe(n){return new ue(0,0,at,at+n.props.growY)}function Moe(n,{initialBounds:e,scaleX:t,scaleY:s,newPoint:i}){const r=Math.max(.01,Math.min(Math.abs(t),Math.abs(s))),o=new _(0,0);t<0&&(o.x=-(e.width*r)),s<0&&(o.y=-(e.height*r));const{x:l,y:c}=_.Add(i,o.rot(n.rotation));return{x:l,y:c,props:{scale:r*n.props.scale}}}const Ooe=new xo;class bm extends Wi{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"isAspectRatioLocked",()=>!0);w(this,"onResize",(t,s)=>{const{newPoint:i,initialBounds:r,initialShape:o,scaleX:l,handle:c}=s;if(s.mode==="scale_shape"||c!=="right"&&c!=="left")return{id:t.id,type:t.type,...Moe(t,s)};{const d=Math.max(1,Math.abs(r.width*l)),{x:u,y:h}=l<0?_.Sub(i,_.FromAngle(t.rotation).mul(d)):i;return{id:t.id,type:t.type,x:u,y:h,props:{w:d/o.props.scale,autoSize:!1}}}});w(this,"onEditEnd",t=>{const{id:s,type:i,props:{text:r}}=t,o=t.props.text.trimEnd();o.length===0?this.editor.deleteShapes([t.id]):o!==t.props.text&&this.editor.updateShapes([{id:s,type:i,props:{text:r.trimEnd()}}])});w(this,"onBeforeUpdate",(t,s)=>{if(!s.props.autoSize)return;const i=t.props.size!==s.props.size||t.props.textAlign!==s.props.textAlign||t.props.font!==s.props.font||t.props.scale!==1&&s.props.scale===1,r=t.props.text!==s.props.text;if(!i&&!r)return;const o=this.getMinDimensions(t),l=lj(this.editor,s.props),c=o.width*t.props.scale,d=o.height*t.props.scale,u=l.width*s.props.scale,h=l.height*s.props.scale;let p;switch(s.props.textAlign){case"middle":{p=new _((u-c)/2,r?0:(h-d)/2);break}case"end":{p=new _(u-c,r?0:(h-d)/2);break}default:{if(r)break;p=new _(0,(h-d)/2);break}}if(p){p.rot(s.rotation);const{x:f,y:g}=s;return{...s,x:f-p.x,y:g-p.y,props:{...s.props,w:u}}}else return{...s,props:{...s.props,w:u}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(t){return Ooe.get(t.props,s=>lj(this.editor,s))}getGeometry(t){const{scale:s}=t.props,{width:i,height:r}=this.getMinDimensions(t);return new wo({width:i*s,height:r*s,isFilled:!0,isLabel:!0})}component(t){const{id:s,props:{font:i,size:r,text:o,color:l,scale:c,textAlign:d}}=t,{width:u,height:h}=this.getMinDimensions(t),p=t.id===this.editor.getOnlySelectedShapeId(),f=Pi(),g=Doe(s);return a.jsx(ux,{id:s,classNamePrefix:"tl-text-shape",type:"text",font:i,fontSize:xd[r],lineHeight:In.lineHeight,align:d,verticalAlign:"middle",text:o,labelColor:f[l].solid,isSelected:p,textWidth:u,textHeight:h,style:{transform:`scale(${c})`,transformOrigin:"top left"},wrap:!0,onKeyDown:g})}indicator(t){const s=this.editor.getShapeGeometry(t).bounds,i=G();return t.props.autoSize&&i.getEditingShapeId()===t.id?null:a.jsx("rect",{width:H(s.width),height:H(s.height)})}toSvg(t,s){t.props.text&&s.addExportDef(cx(t.props.font));const i=this.editor.getShapeGeometry(t).bounds,r=i.width/(t.props.scale??1),o=i.height/(t.props.scale??1),l=No(s);return a.jsx(dx,{fontSize:xd[t.props.size],font:t.props.font,align:t.props.textAlign,verticalAlign:"middle",text:t.props.text,labelColor:l[t.props.color].solid,bounds:new ue(0,0,r,o),padding:0})}}w(bm,"type","text"),w(bm,"props",fL),w(bm,"migrations",gL);function lj(n,e){const{font:t,text:s,autoSize:i,size:r,w:o}=e,l=i?16:Math.max(16,o),c=xd[r],d=i?null:Math.floor(Math.max(l,o)),u=n.textMeasure.measureText(s,{...In,fontFamily:Tr[t],fontSize:c,maxWidth:d});return i&&(u.w+=1),{width:Math.max(l,u.w),height:Math.max(c,u.h)}}function Doe(n){const e=G();return b.useCallback(t=>{if(e.getEditingShapeId()===n)switch(t.key){case"Enter":{(t.ctrlKey||t.metaKey)&&e.complete();break}case"Tab":{ze(t),t.shiftKey?Sd.unindent(t.currentTarget):Sd.indent(t.currentTarget);break}}},[e,n])}class _m extends Wd{constructor(){super(...arguments);w(this,"canEdit",()=>!0);w(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(t){const{editor:s}=this,i=s.getShapeGeometry(t).bounds.w*s.getZoomLevel()>=110,{asset:r,url:o}=s5(t.id,t.props.assetId,t.props.w),{time:l,playing:c}=t.props,d=ox(t.id),u=i5(),h=b.useRef(null),p=b.useCallback(S=>{const v=S.currentTarget;v&&s.updateShapes([{type:"video",id:t.id,props:{playing:!0,time:v.currentTime}}])},[t.id,s]),f=b.useCallback(S=>{const v=S.currentTarget;v&&s.updateShapes([{type:"video",id:t.id,props:{playing:!1,time:v.currentTime}}])},[t.id,s]),g=b.useCallback(S=>{const v=S.currentTarget;v&&d&&s.updateShapes([{type:"video",id:t.id,props:{time:v.currentTime}}])},[d,t.id,s]),[m,x]=b.useState(!1),y=b.useCallback(S=>{const v=S.currentTarget;v&&(l!==v.currentTime&&(v.currentTime=l),c||v.pause(),x(!0))},[c,l]);return b.useEffect(()=>{const S=h.current;S&&(m&&!d&&l!==S.currentTime&&(S.currentTime=l),d&&document.activeElement!==S&&S.focus())},[d,m,l]),b.useEffect(()=>{if(u){const S=h.current;if(!S)return;S.pause(),S.currentTime=0}},[h,u]),a.jsxs(a.Fragment,{children:[a.jsx(Ml,{id:t.id,style:{color:"var(--color-text-3)",backgroundColor:r?"transparent":"var(--color-low)",border:r?"none":"1px solid var(--color-low-border)"},children:a.jsx("div",{className:"tl-counter-scaled",children:a.jsx("div",{className:"tl-video-container",children:r!=null&&r.props.src?o?a.jsx("video",{ref:h,style:d?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${t.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:d&&i,onPlay:p,onPause:f,onTimeUpdate:g,onLoadedData:y,hidden:!m,children:a.jsx("source",{src:o})}):null:a.jsx(n5,{})})})}),"url"in t.props&&t.props.url&&a.jsx(wd,{url:t.props.url,zoomLevel:s.getZoomLevel()})]})}indicator(t){return a.jsx("rect",{width:H(t.props.w),height:H(t.props.h)})}toSvg(t){return a.jsx("image",{href:Loe(t.id),width:t.props.w,height:t.props.h})}}w(_m,"type","video"),w(_m,"props",mL),w(_m,"migrations",yL);function Loe(n){const e=n.split(":")[1],t=document.querySelector(`.tl-video-shape-${e}`);if(t){const s=document.createElement("canvas");return s.width=t.videoWidth,s.height=t.videoHeight,s.getContext("2d").drawImage(t,0,0),s.toDataURL("image/png")}else throw new Error("Video with not found when attempting serialization.")}const h5=[bm,pm,fm,ym,wm,Sm,mm,hm,vm,gm,xm,_m];function Foe(n){return n.sideEffects.register({instance_page_state:{afterChange:(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const s=n.isIn("select.crop");!e.croppingShapeId&&t.croppingShapeId?s||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&s&&n.setCurrentTool("select.idle")}e.editingShapeId!==t.editingShapeId&&(!e.editingShapeId&&t.editingShapeId?n.isIn("select.editing_shape")||n.setCurrentTool("select.editing_shape"):e.editingShapeId&&!t.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle"))}}})}class p5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"scribbleId","id");w(this,"markId","");w(this,"excludedShapeIds",new Set);w(this,"onEnter",t=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=t;const{originPagePoint:s}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(r=>{if(this.editor.isShapeOrAncestorLocked(r))return!0;if(this.editor.isShapeOfType(r,"group")||this.editor.isShapeOfType(r,"frame")){const o=this.editor.getPointInShapeSpace(r,s);return this.editor.getShapeGeometry(r).bounds.containsPoint(o)}return!1}).map(r=>r.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()});w(this,"pushPointToScribble",()=>{const{x:t,y:s}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,s)});w(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});w(this,"onPointerMove",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()})}update(){const{editor:t,excludedShapeIds:s}=this,i=t.getErasingShapeIds(),r=t.getZoomLevel(),o=t.getCurrentPageShapes(),{inputs:{currentPagePoint:l,previousPagePoint:c}}=t;this.pushPointToScribble();const d=new Set(i),u=this.editor.options.hitTestMargin/r;for(const h of o){if(t.isShapeOfType(h,"group"))continue;const p=t.getShapeMask(h.id);if(p&&!Xs(l,p))continue;const f=t.getShapeGeometry(h),g=t.getShapePageTransform(h);if(!f||!g)continue;const m=g.clone().invert(),x=m.applyToPoint(c),y=m.applyToPoint(l),{bounds:S}=f;S.minX-u>Math.max(x.x,y.x)||S.minY-u>Math.max(x.y,y.y)||S.maxX+u<Math.min(x.x,y.x)||S.maxY+u<Math.min(x.y,y.y)||f.hitTestLineSegment(x,y,u)&&d.add(t.getOutermostSelectableShape(h).id)}this.editor.setErasingShapes([...d].filter(h=>!s.has(h)))}complete(){const{editor:t}=this;t.deleteShapes(t.getCurrentPageState().erasingShapeIds),t.setErasingShapes([]),this.parent.transition("idle")}cancel(){const{editor:t}=this;t.setErasingShapes([]),t.bailToMark(this.markId),this.parent.transition("idle",this.info)}}w(p5,"id","erasing");var _b;let Boe=(_b=class extends ye{constructor(){super(...arguments);w(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(_b,"id","idle"),_b);var Cb;let Uoe=(Cb=class extends ye{constructor(){super(...arguments);w(this,"onEnter",()=>{const t=this.editor.getZoomLevel(),s=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:i}}=this.editor,r=new Set,o=r.size;for(let l=s.length,c=l-1;c>=0;c--){const d=s[c];if(!(this.editor.isShapeOrAncestorLocked(d)||this.editor.isShapeOfType(d,"group"))&&this.editor.isPointInShape(d,i,{hitInside:!1,margin:this.editor.options.hitTestMargin/t})){const u=this.editor.getOutermostSelectableShape(d);if(this.editor.isShapeOfType(u,"frame")&&r.size>o)break;r.add(u.id)}}this.editor.setErasingShapes([...r])});w(this,"onLongPress",t=>{this.startErasing(t)});w(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.startErasing(t)});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.cancel()})}startErasing(t){this.parent.transition("erasing",t)}complete(){const t=this.editor.getErasingShapeIds();t.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(t)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}},w(Cb,"id","pointing"),Cb);class th extends ye{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}w(th,"id","eraser"),w(th,"initial","idle"),w(th,"isLockable",!1),w(th,"children",()=>[Boe,Uoe,p5]);class f5 extends ye{constructor(){super(...arguments);w(this,"initialCamera",new _);w(this,"onEnter",()=>{this.initialCamera=_.From(this.editor.getCamera()),this.update()});w(this,"onPointerMove",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.parent.transition("idle")});w(this,"onComplete",()=>{this.complete()})}update(){const{initialCamera:t,editor:s}=this,{currentScreenPoint:i,originScreenPoint:r}=s.inputs,o=_.Sub(i,r).div(s.getZoomLevel());o.len2()!==0&&s.setCamera(t.clone().add(o))}complete(){const{editor:t}=this,{pointerVelocity:s}=t.inputs,i=Math.min(s.len(),2);i>.1&&this.editor.slideCamera({speed:i,direction:s}),this.parent.transition("idle")}}w(f5,"id","dragging");var Eb;let $oe=(Eb=class extends ye{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.setCursor({type:"grab",rotation:0})});w(this,"onPointerDown",t=>{this.parent.transition("pointing",t)});w(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},w(Eb,"id","idle"),Eb);var Tb;let zoe=(Tb=class extends ye{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})});w(this,"onLongPress",()=>{this.startDragging()});w(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startDragging()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.complete()})}startDragging(){this.parent.transition("dragging")}complete(){this.parent.transition("idle")}},w(Tb,"id","pointing"),Tb);class nh extends ye{constructor(){super(...arguments);w(this,"onDoubleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:s}=this.editor.inputs;this.editor.zoomIn(s,{animation:{duration:220,easing:ln.easeOutQuint}})}});w(this,"onTripleClick",t=>{if(t.phase==="settle"){const{currentScreenPoint:s}=this.editor.inputs;this.editor.zoomOut(s,{animation:{duration:320,easing:ln.easeOutQuint}})}});w(this,"onQuadrupleClick",t=>{if(t.phase==="settle"){const s=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:i}}=this.editor;s===1?this.editor.zoomToFit({animation:{duration:400,easing:ln.easeOutQuint}}):this.editor.resetZoom(i,{animation:{duration:320,easing:ln.easeOutQuint}})}})}}w(nh,"id","hand"),w(nh,"initial","idle"),w(nh,"isLockable",!1),w(nh,"children",()=>[$oe,zoe,f5]);var Ib;let Woe=(Ib=class extends ye{constructor(){super(...arguments);w(this,"onPointerDown",t=>{this.parent.transition("lasering",t)})}},w(Ib,"id","idle"),Ib);class g5 extends ye{constructor(){super(...arguments);w(this,"scribbleId","id");w(this,"onEnter",()=>{const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()});w(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});w(this,"onPointerMove",()=>{this.pushPointToScribble()});w(this,"onPointerUp",()=>{this.complete()});w(this,"pushPointToScribble",()=>{const{x:t,y:s}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,s)});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}w(g5,"id","lasering");class sh extends ye{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.setCursor({type:"cross",rotation:0})})}}w(sh,"id","laser"),w(sh,"initial","idle"),w(sh,"children",()=>[Woe,g5]),w(sh,"isLockable",!1);class m5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"initialSelectedShapeIds",[]);w(this,"excludedShapeIds",new Set);w(this,"isWrapMode",!1);w(this,"initialStartShape",null);w(this,"onEnter",t=>{const{altKey:s,currentPagePoint:i}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),s){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(r=>this.editor.isShapeOfType(r,"group")||this.editor.isShapeOrAncestorLocked(r)).map(r=>r.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.hitTestShapes()});w(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});w(this,"onTick",({elapsed:t})=>{const{editor:s}=this;s.edgeScrollManager.updateEdgeScrolling(t)});w(this,"onPointerMove",()=>{this.hitTestShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",t=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",t)});w(this,"onKeyDown",t=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()});w(this,"onKeyUp",()=>{this.hitTestShapes()});w(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:t,excludedShapeIds:s,isWrapMode:i}=this,{inputs:{originPagePoint:r,currentPagePoint:o,shiftKey:l,ctrlKey:c}}=t,d=new Set(l?this.initialSelectedShapeIds:[]),u=i?!c:c,h=ue.FromPoints([r,o]),{corners:p}=h;let f,g,m,x,y,S;const v=t.getCurrentPageShapes(),C=t.getCurrentPageId();e:for(let E=0,P=v.length;E<P;E++){if(m=v[E],s.has(m.id)||d.has(m.id)||(x=t.getShapePageBounds(m),!x))continue e;if(h.contains(x)){this.handleHit(m,o,C,d,p);continue e}if(u||t.isShapeOfType(m,"frame"))continue e;if(h.collides(x)){if(y=t.getShapePageTransform(m),!y)continue e;S=y.clone().invert().applyToPoints(p);const k=t.getShapeGeometry(m);t:for(let j=0;j<4;j++)if(f=S[j],g=S[(j+1)%4],k.hitTestLineSegment(f,g,0)){this.handleHit(m,o,C,d,p);break t}}}t.getInstanceState().isCoarsePointer;const T=t.getInstanceState().brush;(!T||!h.equals(T))&&t.updateInstanceState({brush:{...h.toJson()}});const I=t.getSelectedShapeIds();(I.length!==d.size||I.some(E=>!d.has(E)))&&t.setSelectedShapes(Array.from(d))}handleHit(t,s,i,r,o){if(t.parentId===i){r.add(t.id);return}const l=this.editor.getOutermostSelectableShape(t),c=this.editor.getShapeMask(l.id);c&&!dF(c,o)&&!Xs(s,c)||r.add(l.id)}}w(m5,"id","brushing");const _d={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class y5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t,this.updateCursor()});w(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startResizing()});w(this,"onLongPress",()=>{this.startResizing()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const t=this.editor.getSelectedShapes(),s=_d[this.info.handle];this.editor.setCursor({type:s,rotation:t.length===1?this.editor.getSelectionRotation():0})}startResizing(){this.editor.getInstanceState().isReadonly||this.parent.transition("resizing",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}w(y5,"id","pointing_resize_handle");const ai=8;class y1 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"markId","");w(this,"snapshot",{});w(this,"onEnter",t=>{this.info=t,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()});w(this,"onPointerMove",()=>{this.updateShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const s=_d[this.info.handle];this.editor.setCursor({type:s,rotation:this.editor.getSelectionRotation()})}updateShapes(){const{shape:t,cursorHandleOffset:s}=this.snapshot;if(!t||!this.editor.getShapeUtil("image"))return;const r=t.props,o=this.editor.inputs.currentPagePoint.clone().sub(s),l=this.editor.inputs.originPagePoint.clone().sub(s),c=o.clone().sub(l).rot(-t.rotation),d=r.crop??this.getDefaultCrop(),u=ft(d),h=new _(t.x,t.y),p=new _(0,0),f=1/(d.bottomRight.x-d.topLeft.x)*r.w,g=1/(d.bottomRight.y-d.topLeft.y)*r.h;let m=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(g<ai)break;m=!0,u.topLeft.y=u.topLeft.y+c.y/g,g*(u.bottomRight.y-u.topLeft.y)<ai?(u.topLeft.y=u.bottomRight.y-ai/g,p.y=(u.topLeft.y-d.topLeft.y)*g):u.topLeft.y<=0?(u.topLeft.y=0,p.y=(u.topLeft.y-d.topLeft.y)*g):p.y=c.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(g<ai)break;m=!0,u.bottomRight.y=Math.min(1,u.bottomRight.y+c.y/g),g*(u.bottomRight.y-u.topLeft.y)<ai&&(u.bottomRight.y=u.topLeft.y+ai/g);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(f<ai)break;m=!0,u.topLeft.x=u.topLeft.x+c.x/f,f*(u.bottomRight.x-u.topLeft.x)<ai?(u.topLeft.x=u.bottomRight.x-ai/f,p.x=(u.topLeft.x-d.topLeft.x)*f):u.topLeft.x<=0?(u.topLeft.x=0,p.x=(u.topLeft.x-d.topLeft.x)*f):p.x=c.x;break}case"right":case"top_right":case"bottom_right":{if(f<ai)break;m=!0,u.bottomRight.x=Math.min(1,u.bottomRight.x+c.x/f),f*(u.bottomRight.x-u.topLeft.x)<ai&&(u.bottomRight.x=u.topLeft.x+ai/f);break}}if(!m)return;h.add(p.rot(t.rotation));const x={id:t.id,type:t.type,x:h.x,y:h.y,props:{crop:u,w:(u.bottomRight.x-u.topLeft.x)*f,h:(u.bottomRight.y-u.topLeft.y)*g}};this.editor.updateShapes([x]),this.updateCursor()}complete(){this.updateShapes(),ht(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:s}}=this.editor,i=this.editor.getOnlySelectedShape(),r=this.editor.getSelectionRotatedPageBounds(),o=_.RotWith(r.getHandlePoint(this.info.handle),r.point,t),l=_.Sub(s,o);return{shape:i,cursorHandleOffset:l}}}w(y1,"id","cropping");function v5(n,e=!1){const t=n.getZoomLevel(),{inputs:{currentPagePoint:s}}=n;return n.getShapeAtPoint(s,{hitInside:!1,hitLabels:e,margin:n.options.hitTestMargin/t,renderingOnly:!0})??n.getSelectedShapeAtPoint(s)}function x5(n,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:s}=e.props;if(!s)return;const i=n.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;i==="x"?t.x=0:i==="y"&&(t.y=0),t.rot(-e.rotation);const r=1/(s.bottomRight.x-s.topLeft.x)*e.props.w,o=1/(s.bottomRight.y-s.topLeft.y)*e.props.h,l=s.bottomRight.y-s.topLeft.y,c=s.bottomRight.x-s.topLeft.x,d=ft(s);return d.topLeft.x=Math.min(1-c,Math.max(0,d.topLeft.x-t.x/r)),d.topLeft.y=Math.min(1-l,Math.max(0,d.topLeft.y-t.y/o)),d.bottomRight.x=d.topLeft.x+c,d.bottomRight.y=d.topLeft.y+l,{id:e.id,type:e.type,props:{crop:d}}}var Pb;let Hoe=(Pb=class extends ye{constructor(){super(...arguments);w(this,"onEnter",()=>{this.editor.setCursor({type:"default",rotation:0});const t=this.editor.getOnlySelectedShape();t&&this.editor.setCroppingShape(t.id)});w(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0})});w(this,"onCancel",()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})});w(this,"onPointerDown",t=>{var s;if(!this.editor.getIsMenuOpen()){if(t.ctrlKey){this.cancel(),this.editor.root.handleEvent(t);return}switch(t.target){case"canvas":{const i=v5(this.editor);if(i&&!this.editor.isShapeOfType(i,"group")){this.onPointerDown({...t,shape:i,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(t);break}case"shape":{if(t.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",t);return}else(s=this.editor.getShapeUtil(t.shape))!=null&&s.canCrop(t.shape)?(this.editor.setCroppingShape(t.shape.id),this.editor.setSelectedShapes([t.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",t)):(this.cancel(),this.editor.root.handleEvent(t));break}case"selection":{switch(t.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...t,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...t,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}});w(this,"onDoubleClick",t=>{var o;if(this.editor.inputs.shiftKey||t.phase!=="up")return;const s=this.editor.getCroppingShapeId();if(!s)return;const i=this.editor.getShape(s);if(!i)return;const r=this.editor.getShapeUtil(i);if(r){if(t.target==="selection"){(o=r.onDoubleClickEdge)==null||o.call(r,i);return}this.cancel(),this.editor.root.handleEvent(t)}});w(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});w(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});w(this,"onKeyUp",t=>{switch(t.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}})}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(t=!1){const{editor:{inputs:{keys:s}}}=this,i=s.has("ShiftLeft"),r=new _(0,0);if(s.has("ArrowLeft")&&(r.x+=1),s.has("ArrowRight")&&(r.x-=1),s.has("ArrowUp")&&(r.y+=1),s.has("ArrowDown")&&(r.y-=1),r.equals(new _(0,0)))return;i&&r.mul(10);const o=this.editor.getShape(this.editor.getCroppingShapeId());if(!o)return;const l=x5(this.editor,o,r);l&&(t||this.editor.mark("translate crop"),this.editor.updateShapes([l]))}},w(Pb,"id","idle"),Pb);class S5 extends ye{constructor(){super(...arguments);w(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});w(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",t)});w(this,"onPointerUp",t=>{this.editor.setCurrentTool("select.crop.idle",t)})}}w(S5,"id","pointing_crop");class v1 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const s=this.editor.getSelectedShapes()[0];if(!s)return;const i=_d[this.info.handle];this.editor.setCursor({type:i,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(s.id)});w(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)});w(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startCropping()});w(this,"onLongPress",()=>{this.startCropping()});w(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}startCropping(){this.editor.getInstanceState().isReadonly||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}w(v1,"id","pointing_crop_handle");class w5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"markId","translating crop");w(this,"snapshot",{});w(this,"onEnter",t=>{this.info=t,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()});w(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0})});w(this,"onPointerMove",()=>{this.updateShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onKeyDown",t=>{switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}});w(this,"onKeyUp",t=>{switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:s,currentPagePoint:i}=this.editor.inputs,r=i.clone().sub(s),o=x5(this.editor,t,r);o&&this.editor.updateShapes([o])}}w(w5,"id","translating_crop");class Cm extends ye{constructor(){super(...arguments);w(this,"markId","");w(this,"onEnter",()=>{this.didCancel=!1,this.markId="crop",this.editor.mark(this.markId)});w(this,"didCancel",!1);w(this,"onExit",()=>{this.didCancel?this.editor.bailToMark(this.markId):this.editor.squashToMark(this.markId)});w(this,"onCancel",()=>{this.didCancel=!0})}}w(Cm,"id","crop"),w(Cm,"initial","idle"),w(Cm,"children",()=>[Hoe,w5,S5,v1,y1]);class b5 extends ye{constructor(){super(...arguments);w(this,"shapeId","");w(this,"initialHandle",{});w(this,"initialAdjacentHandle",null);w(this,"initialPagePoint",{});w(this,"markId","");w(this,"initialPageTransform");w(this,"initialPageRotation");w(this,"info",{});w(this,"isPrecise",!1);w(this,"isPreciseId",null);w(this,"pointingId",null);w(this,"onEnter",t=>{const{shape:s,isCreating:i,handle:r}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=s.id,this.markId=i?`creating:${s.id}`:"dragging handle",i||this.editor.mark(this.markId),this.initialHandle=ft(r),this.editor.isShapeOfType(s,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...s,props:{points:{...s.props.points,[r.index]:{id:r.index,index:r.index,x:r.x,y:r.y}}}});const d=this.editor.getShapeHandles(s).find(u=>u.index===r.index);this.initialHandle=ft(d)}this.initialPageTransform=this.editor.getShapePageTransform(s),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:i?"cross":"grabbing",rotation:0});const o=this.editor.getShapeHandles(s).sort(Hn),l=o.findIndex(c=>c.id===t.handle.id);this.initialAdjacentHandle=null;for(let c=l+1;c<o.length;c++){const d=o[c];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==t.handle.id){this.initialAdjacentHandle=d;break}}if(!this.initialAdjacentHandle)for(let c=o.length-1;c>=0;c--){const d=o[c];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==t.handle.id){this.initialAdjacentHandle=d;break}}if(this.editor.isShapeOfType(s,"arrow")){const c=Cs(this.editor,s)[t.handle.id];this.isPrecise=!1,c?(this.editor.setHintingShapes([c.toId]),this.isPrecise=c.props.isPrecise,this.isPrecise?this.isPreciseId=c.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)});w(this,"exactTimeout",-1);w(this,"onPointerMove",()=>{this.update()});w(this,"onKeyDown",()=>{this.update()});w(this,"onKeyUp",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.update(),this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clearIndicators(),ht(this.editor,[this.shapeId]);const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var E;const{editor:t,shapeId:s,initialPagePoint:i}=this,{initialHandle:r,initialPageRotation:o,initialAdjacentHandle:l}=this,c=this.editor.getHintingShapeIds(),d=this.editor.user.getIsSnapMode(),{snaps:u,inputs:{currentPagePoint:h,shiftKey:p,ctrlKey:f,altKey:g,pointerVelocity:m}}=t,x=this.info.shape,y=t.getShape(s);if(!y)return;const S=t.getShapeUtil(y);let v=h.clone().sub(i).rot(-o).add(r);if(p&&l&&r.id!=="middle"){const P=_.Angle(l,v),j=ky(P,24)-P;v=_.RotWith(v,l,j)}t.snaps.clearIndicators();let C={...r,x:v.x,y:v.y};if(r.canSnap&&(d?!f:f)){if(!t.getShapePageTransform(y.id))throw Error("Expected a page transform");const k=u.handles.snapHandle({currentShapeId:s,handle:C});k&&(k.nudge.rot(-t.getShapeParentTransform(y).rotation()),v.add(k.nudge),C={...r,x:v.x,y:v.y})}const T=(E=S.onHandleDrag)==null?void 0:E.call(S,y,{handle:C,isPrecise:this.isPrecise||g,initial:x}),I={id:y.id,type:y.type,...T};if(r.type==="vertex"&&this.editor.isShapeOfType(y,"arrow")){const P=Cs(t,y)[r.id];P?c[0]!==P.toId&&(t.setHintingShapes([P.toId]),this.pointingId=P.toId,this.isPrecise=m.len()<.5||g,this.isPreciseId=this.isPrecise?P.toId:null,this.resetExactTimeout()):c.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}T&&t.updateShapes([I])}}w(b5,"id","dragging_handle");function _5(n){return n.isLabel?[n]:n instanceof Yi?n.children.filter(e=>e.isLabel):[]}class C5 extends ye{constructor(){super(...arguments);w(this,"hitShapeForPointerUp",null);w(this,"onEnter",()=>{const t=this.editor.getEditingShape();if(!t)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,so(this.editor),this.editor.select(t)});w(this,"onExit",()=>{var r;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null),so.cancel();const s=this.editor.getShape(t),i=this.editor.getShapeUtil(s);(r=i.onEditEnd)==null||r.call(i,s)});w(this,"onPointerMove",t=>{if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getInstanceState().isReadonly||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",t),this.hitShapeForPointerUp=null;return}switch(t.target){case"shape":case"canvas":{so(this.editor);return}}});w(this,"onPointerDown",t=>{switch(this.hitShapeForPointerUp=null,t.target){case"shape":{const{shape:s}=t,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");const r=this.editor.getShapeUtil(s).getGeometry(s),o=_5(r),l=o.length===1?o[0]:void 0,c=this.editor.isShapeOfType(i,"text")&&i.props.text.trim()==="";if(l&&!c){const d=this.editor.getPointInShapeSpace(s,this.editor.inputs.currentPagePoint);if(l.bounds.containsPoint(d,0)&&l.hitTestPoint(d)){if(s.id===i.id)return;this.hitShapeForPointerUp=s,this.editor.mark("editing on pointer up"),this.editor.select(s.id);return}}else{if(s.id===i.id)this.editor.isShapeOfType(s,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",t));else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)});w(this,"onPointerUp",t=>{const s=this.hitShapeForPointerUp;if(!s)return;this.hitShapeForPointerUp=null;const i=this.editor.getShapeUtil(s);if(!s.isLocked){if(this.editor.getInstanceState().isReadonly&&!i.canEditInReadOnly(s)){this.parent.transition("pointing_shape",t);return}this.editor.select(s.id),this.editor.setEditingShape(s.id),so(this.editor)}});w(this,"onComplete",t=>{this.parent.transition("idle",t)});w(this,"onCancel",t=>{this.parent.transition("idle",t)})}}w(C5,"id","editing_shape");function cj(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function $y(n){const e=n.getSelectedShapeIds(),{shiftKey:t,altKey:s,currentPagePoint:i}=n.inputs,r=n.getShapeAtPoint(i,{hitInside:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:o=>!o.isLocked});if(r){const o=n.getOutermostSelectableShape(r);if(t&&!s)n.cancelDoubleClick(),e.includes(o.id)?(n.mark("deselecting shape"),n.deselect(o)):(n.mark("shift selecting shape"),n.setSelectedShapes([...e,o.id]));else{let l;o===r||o.id===n.getFocusedGroupId()||e.includes(o.id)?l=r:l=o,l&&!e.includes(l.id)&&(n.mark("selecting shape"),n.select(l.id))}}else{if(t)return;{e.length>0&&(n.mark("selecting none"),n.selectNone());const o=n.getFocusedGroupId();if(Ss(o)){const l=n.getShape(o);n.isPointInShape(l,i,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}const Goe=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var kb;let Voe=(kb=class extends ye{constructor(){super(...arguments);w(this,"onEnter",()=>{this.parent.setCurrentToolIdMask(void 0),so(this.editor),this.editor.setCursor({type:"default",rotation:0})});w(this,"onExit",()=>{so.cancel()});w(this,"onPointerMove",()=>{so(this.editor)});w(this,"onPointerDown",t=>{if(this.editor.getIsMenuOpen())return;const s=t.ctrlKey&&cj(this.editor);if(t.ctrlKey&&!s){if(t.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(t.shape)){this.parent.transition("pointing_shape",t);return}this.parent.transition("brushing",t);return}switch(t.target){case"canvas":{const i=v5(this.editor);if(i&&!i.isLocked){this.onPointerDown({...t,shape:i,target:"shape"});return}const r=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:l}}=this.editor;if((r.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&dj(this.editor,l)){this.onPointerDown({...t,target:"selection"});return}this.parent.transition("pointing_canvas",t);break}case"shape":{const{shape:i}=t;if(this.isOverArrowLabelTest(i)){this.parent.transition("pointing_arrow_label",t);break}if(this.editor.isShapeOrAncestorLocked(i)){this.parent.transition("pointing_canvas",t);break}this.parent.transition("pointing_shape",t);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",t):this.parent.transition("pointing_handle",t);break}case"selection":{switch(t.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",t);break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{s?this.parent.transition("crop.pointing_crop_handle",t):this.parent.transition("pointing_resize_handle",t);break}default:{const i=this.editor.getHoveredShape();if(i&&!this.editor.getSelectedShapeIds().includes(i.id)&&!i.isLocked){this.onPointerDown({...t,shape:i,target:"shape"});return}this.parent.transition("pointing_selection",t)}}break}}});w(this,"onDoubleClick",t=>{var s,i,r,o;if(!(this.editor.inputs.shiftKey||t.phase!=="up"))switch(t.target){case"canvas":{const l=this.editor.getHoveredShape(),c=l&&!this.editor.isShapeOfType(l,"group")?l:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),d=this.editor.getFocusedGroupId();if(c){if(this.editor.isShapeOfType(c,"group")){$y(this.editor);return}else{const u=this.editor.getShape(c.parentId);if(u&&this.editor.isShapeOfType(u,"group")&&!(d&&u.id===d)){$y(this.editor);return}}this.onDoubleClick({...t,shape:c,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(t);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;const l=this.editor.getOnlySelectedShape();if(l){const c=this.editor.getShapeUtil(l);if(!this.canInteractWithShapeInReadOnly(l))return;if(t.handle==="right"||t.handle==="left"||t.handle==="top"||t.handle==="bottom"){const d=(s=c.onDoubleClickEdge)==null?void 0:s.call(c,l);if(d){this.editor.mark("double click edge"),this.editor.updateShapes([d]),ht(this.editor,[l.id]);return}}if(c.canCrop(l)&&!this.editor.isShapeOrAncestorLocked(l)){this.parent.transition("crop",t);return}this.shouldStartEditingShape(l)&&this.startEditingShape(l,t,!0)}break}case"shape":{const{shape:l}=t,c=this.editor.getShapeUtil(l);if(l.type!=="video"&&l.type!=="embed"&&this.editor.getInstanceState().isReadonly)break;if(c.onDoubleClick){const d=(i=c.onDoubleClick)==null?void 0:i.call(c,l);if(d){this.editor.updateShapes([d]);return}else if(c.canCrop(l)&&!this.editor.isShapeOrAncestorLocked(l)){this.editor.mark("select and crop"),this.editor.select((r=t.shape)==null?void 0:r.id),this.parent.transition("crop",t);return}}this.shouldStartEditingShape(l)?this.startEditingShape(l,t,!0):this.handleDoubleClickOnCanvas(t);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;const{shape:l,handle:c}=t,d=this.editor.getShapeUtil(l),u=(o=d.onDoubleClickHandle)==null?void 0:o.call(d,l,c);u?this.editor.updateShapes([u]):this.shouldStartEditingShape(l)&&this.startEditingShape(l,t,!0)}}});w(this,"onRightClick",t=>{switch(t.target){case"canvas":{const s=this.editor.getHoveredShape(),i=s&&!this.editor.isShapeOfType(s,"group")?s:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!1,renderingOnly:!0});if(i){this.onRightClick({...t,shape:i,target:"shape"});return}const r=this.editor.getSelectedShapeIds(),o=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:l}}=this.editor;if((r.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&dj(this.editor,l)){this.onRightClick({...t,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:s}=this.editor.getCurrentPageState(),{shape:i}=t,r=this.editor.getOutermostSelectableShape(i,o=>!s.includes(o.id));!s.includes(r.id)&&!this.editor.findShapeAncestor(r,o=>s.includes(o.id))&&(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([r.id]));break}}});w(this,"onCancel",()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())});w(this,"onKeyDown",t=>{switch(t.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(Gt.editOnType.get()&&!Goe.includes(t.key)&&!t.altKey&&!t.ctrlKey){const s=this.editor.getOnlySelectedShape();if(s&&this.editor.isShapeOfType(s,"note")&&this.shouldStartEditingShape(s)){this.startEditingShape(s,{...t,target:"shape",shape:s},!0);return}}});w(this,"onKeyRepeat",t=>{switch(t.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});w(this,"onKeyUp",t=>{switch(t.code){case"Enter":{const s=this.editor.getSelectedShapes();if(s.every(r=>this.editor.isShapeOfType(r,"group"))){this.editor.setSelectedShapes(s.flatMap(r=>this.editor.getSortedChildIdsForParent(r.id)));return}const i=this.editor.getOnlySelectedShape();if(i&&this.shouldStartEditingShape(i)){this.startEditingShape(i,{...t,target:"shape",shape:i},!0);return}cj(this.editor)&&this.parent.transition("crop",t);break}}});w(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(t=this.editor.getOnlySelectedShape()){return!t||this.editor.isShapeOrAncestorLocked(t)&&t.type!=="embed"||!this.canInteractWithShapeInReadOnly(t)?!1:this.editor.getShapeUtil(t).canEdit(t)}startEditingShape(t,s,i){this.editor.isShapeOrAncestorLocked(t)&&t.type!=="embed"||(this.editor.mark("editing shape"),Fy(this.editor,t,i),this.parent.transition("editing_shape",s))}isOverArrowLabelTest(t){if(!t)return!1;const s=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(t,"arrow")){const i=this.editor.getShapeGeometry(t).children[1];if(i&&Xs(s,i.vertices))return!0}return!1}handleDoubleClickOnCanvas(t){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");const s=st(),{x:i,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:s,type:"text",x:i,y:r,props:{text:"",autoSize:!0}}]);const o=this.editor.getShape(s);if(!o)return;const l=this.editor.getShapeUtil(o);this.editor.getInstanceState().isReadonly&&!l.canEditInReadOnly(o)||(this.editor.setEditingShape(s),this.editor.select(s),this.parent.transition("editing_shape",t))}nudgeSelectedShapes(t=!1){const{editor:{inputs:{keys:s}}}=this,i=s.has("ShiftLeft"),r=new _(0,0);if(s.has("ArrowLeft")&&(r.x-=1),s.has("ArrowRight")&&(r.x+=1),s.has("ArrowUp")&&(r.y-=1),s.has("ArrowDown")&&(r.y+=1),r.equals(new _(0,0)))return;t||this.editor.mark("nudge shapes");const{gridSize:o}=this.editor.getDocumentSettings(),l=this.editor.getInstanceState().isGridMode?i?o*Xoe:o:i?Koe:Yoe,c=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(c,r.mul(l)),ht(this.editor,c)}canInteractWithShapeInReadOnly(t){return!!(!this.editor.getInstanceState().isReadonly||this.editor.getShapeUtil(t).canEditInReadOnly(t))}},w(kb,"id","idle"),kb);const Koe=10,Yoe=1,Xoe=5;function dj(n,e){const t=n.getSelectionRotatedPageBounds();if(!t)return!1;const s=n.getSelectionRotation();return s?Xs(e,t.corners.map(i=>_.RotWith(i,t.point,s))):t.containsPoint(e)}class E5 extends ye{constructor(){super(...arguments);w(this,"shapeId","");w(this,"markId","");w(this,"wasAlreadySelected",!1);w(this,"didDrag",!1);w(this,"info",{});w(this,"onEnter",t=>{const{shape:s}=t;this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.shapeId=s.id,this.didDrag=!1,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===s.id,this.updateCursor();const r=this.editor.getShapeGeometry(s).children[1];if(!r)throw Error(`Expected to find an arrow label geometry for shape: ${s.id}`);const{currentPagePoint:o}=this.editor.inputs,l=this.editor.getPointInShapeSpace(s,o);this._labelDragOffset=_.Sub(r.center,l),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})});w(this,"_labelDragOffset",new _(0,0));w(this,"onPointerMove",()=>{const{isDragging:t}=this.editor.inputs;if(!t)return;const s=this.editor.getShape(this.shapeId);if(!s)return;const i=yr(this.editor,s),r=this.editor.getShapeGeometry(s),o=r.children[0],l=this.editor.getPointInShapeSpace(s,this.editor.inputs.currentPagePoint),c=o.nearestPoint(_.Add(l,this._labelDragOffset));let d;if(i.isStraight){const u=_.Dist(i.start.point,i.end.point);d=1-_.Dist(i.end.point,c)/u}else{const{_center:u,measure:h,angleEnd:p,angleStart:f}=r.children[0];d=X0(h,f,p,u.angle(c))}isNaN(d)&&(d=.5),this.didDrag=!0,this.editor.updateShape({id:s.id,type:s.type,props:{labelPosition:d}})});w(this,"onPointerUp",()=>{const t=this.editor.getShape(this.shapeId);t&&(this.didDrag||!this.wasAlreadySelected?this.complete():(this.editor.setEditingShape(t.id),this.editor.setCurrentTool("select.editing_shape")))});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}w(E5,"id","pointing_arrow_label");class T5 extends ye{constructor(){super(...arguments);w(this,"onEnter",()=>{const{inputs:t}=this.editor;t.shiftKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});w(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",t)});w(this,"onPointerUp",()=>{$y(this.editor),this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onInterrupt",()=>{this.parent.transition("idle")})}complete(){this.parent.transition("idle")}}w(T5,"id","pointing_canvas");class I5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t;const{shape:s}=t;if(this.editor.isShapeOfType(s,"arrow")){const i=Cs(this.editor,s)[t.handle.id];i&&this.editor.setHintingShapes([i.toId])}this.editor.setCursor({type:"grabbing",rotation:0})});w(this,"onExit",()=>{this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})});w(this,"onPointerUp",()=>{const{shape:t,handle:s}=this.info;if(this.editor.isShapeOfType(t,"note")){const{editor:i}=this,r=uj(i,t,s,!1);if(r){Fy(i,r,!0);return}}this.parent.transition("idle",this.info)});w(this,"onPointerMove",()=>{const{editor:t}=this;t.inputs.isDragging&&this.startDraggingHandle()});w(this,"onLongPress",()=>{this.startDraggingHandle()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}startDraggingHandle(){const{editor:t}=this;if(t.getInstanceState().isReadonly)return;const{shape:s,handle:i}=this.info;if(t.isShapeOfType(s,"note")){const r=uj(t,s,i,!0);if(r){const o=t.getPointInParentSpace(r,t.inputs.originPagePoint).sub(_.Rot(lx.clone().mul(s.props.scale),r.rotation));t.updateShape({...r,x:o.x,y:o.y}),t.setHoveredShape(r.id).select(r.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:t.getShape(r),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{Fy(t,r,!0)}});return}}this.parent.transition("dragging_handle",this.info)}cancel(){this.parent.transition("idle")}}w(I5,"id","pointing_handle");function uj(n,e,t,s){const i=n.getShapePageTransform(e.id),r=i.point(),o=i.rotation(),c=zF(n,r,o,e.props.growY,0,e.props.scale)[t.index];if(c)return HF(n,e,c,o,s)}class P5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})});w(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.startRotating()});w(this,"onLongPress",()=>{this.startRotating()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){this.editor.setCursor({type:_d[this.info.handle],rotation:this.editor.getSelectionRotation()})}startRotating(){this.editor.getInstanceState().isReadonly||this.parent.transition("rotating",this.info)}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}w(P5,"id","pointing_rotate_handle");class k5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t});w(this,"onPointerUp",t=>{$y(this.editor),this.parent.transition("idle",t)});w(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.startTranslating(t)});w(this,"onLongPress",t=>{this.startTranslating(t)});w(this,"onDoubleClick",t=>{var r,o;const s=this.editor.getHoveredShape(),i=s&&!this.editor.isShapeOfType(s,"group")?s:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(o=(r=this.parent).onDoubleClick)==null||o.call(r,{...t,target:"shape",shape:this.editor.getShape(i)});return}});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}startTranslating(t){this.editor.getInstanceState().isReadonly||this.parent.transition("translating",t)}cancel(){this.parent.transition("idle")}}w(k5,"id","pointing_selection");class A5 extends ye{constructor(){super(...arguments);w(this,"hitShape",{});w(this,"hitShapeForPointerUp",{});w(this,"isDoubleClick",!1);w(this,"didSelectOnEnter",!1);w(this,"onEnter",t=>{const s=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),r=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:o,shiftKey:l,altKey:c}}=this.editor;this.hitShape=t.shape,this.isDoubleClick=!1;const d=this.editor.getOutermostSelectableShape(t.shape),u=this.editor.findShapeAncestor(d,h=>s.includes(h.id));if(this.editor.getShapeUtil(t.shape).onClick||d.id===r||s.includes(d.id)||u||s.length>1&&(i!=null&&i.containsPoint(o))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=d;return}this.didSelectOnEnter=!0,l&&!c?(this.editor.cancelDoubleClick(),s.includes(d.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...s,d.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([d.id]))});w(this,"onPointerUp",t=>{var u;const s=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),r=this.editor.getZoomLevel(),{inputs:{currentPagePoint:o,shiftKey:l}}=this.editor,c=this.editor.getShapeAtPoint(o,{margin:this.editor.options.hitTestMargin/r,hitInside:!0,renderingOnly:!0})??this.hitShape,d=c?this.editor.getOutermostSelectableShape(c):this.hitShapeForPointerUp;if(d){const h=this.editor.getShapeUtil(d);if(h.onClick){const p=(u=h.onClick)==null?void 0:u.call(h,d);if(p){this.editor.mark("shape on click"),this.editor.updateShapes([p]),this.parent.transition("idle",t);return}}if(d.id===i){s.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const h=this.editor.getOutermostSelectableShape(c,p=>!s.includes(p.id));if(s.includes(h.id))if(l)this.editor.mark("deselecting on pointer up"),this.editor.deselect(d);else if(s.includes(d.id)){if(s.length===1){const p=this.editor.getShapeUtil(d).getGeometry(d),f=_5(p),g=f.length===1?f[0]:void 0;if(g){const m=this.editor.getPointInShapeSpace(d,o);if(g.bounds.containsPoint(m,0)&&g.hitTestPoint(m)){this.editor.run(()=>{this.editor.mark("editing on pointer up"),this.editor.select(d.id);const x=this.editor.getShapeUtil(d);this.editor.getInstanceState().isReadonly&&!x.canEditInReadOnly(d)||(this.editor.setEditingShape(d.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:d.id}))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(d.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(d);else if(l){const p=this.editor.getShapeAncestors(h);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(f=>!p.find(g=>g.id===f)),h.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([h.id])}this.parent.transition("idle",t)});w(this,"onDoubleClick",()=>{this.isDoubleClick=!0});w(this,"onPointerMove",t=>{this.editor.inputs.isDragging&&this.startTranslating(t)});w(this,"onLongPress",t=>{this.startTranslating(t)});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.cancel()});w(this,"onInterrupt",()=>{this.cancel()})}startTranslating(t){this.editor.getInstanceState().isReadonly||(this.editor.focus(),this.parent.transition("translating",t))}cancel(){this.parent.transition("idle")}}w(A5,"id","pointing_shape");class j5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"markId","");w(this,"didHoldCommand",!1);w(this,"creationCursorOffset",{x:0,y:0});w(this,"snapshot",{});w(this,"onEnter",t=>{const{isCreating:s=!1,creationCursorOffset:i={x:0,y:0}}=t;this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),s?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.setCursor({type:"cross",rotation:0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()});w(this,"onTick",({elapsed:t})=>{const{editor:s}=this;s.edgeScrollManager.updateEdgeScrolling(t)});w(this,"onPointerMove",()=>{this.updateShapes()});w(this,"onKeyDown",()=>{this.updateShapes()});w(this,"onKeyUp",()=>{this.updateShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()});w(this,"_createSnapshot",()=>{const t=this.editor.getSelectedShapeIds(),s=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,r=this.editor.getSelectionRotatedPageBounds(),o=_.RotWith(r.getHandlePoint(this.info.handle),r.point,s),l=_.Sub(i,o),c=new Map,d=[];t.forEach(h=>{const p=this.editor.getShape(h);if(p){if(p.type==="frame"&&d.push({id:h,children:Ne(this.editor.getSortedChildIdsForParent(p).map(f=>this.editor.getShape(f)))}),c.set(p.id,this._createShapeSnapshot(p)),this.editor.isShapeOfType(p,"frame")&&t.length===1)return;this.editor.visitDescendants(p.id,f=>{const g=this.editor.getShape(f);if(g&&(c.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")))return!1})}});const u=![...c.values()].some(h=>!_L(h.pageRotation,s)||h.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:r,cursorHandleOffset:l,selectionRotation:s,selectedShapeIds:t,canShapesDeform:u,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:d}});w(this,"_createShapeSnapshot",t=>{const s=this.editor.getShapePageTransform(t),i=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:s,pageRotation:ve.Decompose(s).rotation,isAspectRatioLocked:i.isAspectRatioLocked(t)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,s;if(ht(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(s=(t=this.info).onCreate)==null||s.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,s=[];t.forEach(({shape:i})=>{var l;const r=this.editor.getShapeUtil(i),o=(l=r.onResizeStart)==null?void 0:l.call(r,i);o&&s.push(o)}),s.length>0&&this.editor.updateShapes(s)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,s=[];t.forEach(({shape:i})=>{var c;const r=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),l=(c=o.onResizeEnd)==null?void 0:c.call(o,i,r);l&&s.push(l)}),s.length>0&&this.editor.updateShapes(s)}updateShapes(){const{altKey:t,shiftKey:s}=this.editor.inputs,{frames:i,shapeSnapshots:r,selectionBounds:o,cursorHandleOffset:l,selectedShapeIds:c,selectionRotation:d,canShapesDeform:u}=this.snapshot;let h=s||!u;if(r.size===1){const P=[...r.values()][0];this.editor.isShapeOfType(P.shape,"text")&&(h=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:p}=this.editor.inputs,f=this.editor.inputs.currentPagePoint.clone().sub(l).sub(this.creationCursorOffset),g=this.editor.inputs.originPagePoint.clone().sub(l);if(this.editor.getInstanceState().isGridMode&&!p){const{gridSize:P}=this.editor.getDocumentSettings();f.snapToGrid(P)}const m=this.info.handle,x=hj(m,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!p:p)&&d%gt===0){const{nudge:P}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:_.Sub(f,g),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:hj(m,d),isAspectRatioLocked:h,isResizingFromCenter:t});f.add(P)}const S=_.RotWith(t?o.center:o.getHandlePoint(x),o.point,d),v=_.Sub(f,S).rot(-d),C=_.Sub(g,S).rot(-d),T=_.DivV(v,C);Number.isFinite(T.x)||(T.x=1),Number.isFinite(T.y)||(T.y=1);const I=m==="top"||m==="bottom",E=m==="left"||m==="right";h?E?T.y=Math.abs(T.x):I?T.x=Math.abs(T.y):Math.abs(T.x)>Math.abs(T.y)?T.y=Math.abs(T.x)*(T.y<0?-1:1):T.x=Math.abs(T.y)*(T.x<0?-1:1):(I&&(T.x=1),E&&(T.y=1)),this.info.isCreating||this.updateCursor({dragHandle:m,isFlippedX:T.x<0,isFlippedY:T.y<0,rotation:d});for(const P of r.keys()){const k=r.get(P);this.editor.resizeShape(P,T,{initialShape:k.shape,initialBounds:k.bounds,initialPageTransform:k.pageTransform,dragHandle:m,mode:c.length===1&&P===c[0]?"resize_bounds":"scale_shape",scaleOrigin:S,isAspectRatioLocked:h,scaleAxisRotation:d,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:P,children:k}of i){if(!k.length)continue;const j=r.get(P).shape,D=this.editor.getShape(P);if(!(j&&D))continue;const R=D.x-j.x,A=D.y-j.y,N=new _(R,A).rot(-j.rotation);if(N.x!==0||N.y!==0)for(const B of k)this.editor.updateShape({id:B.id,type:B.type,x:B.x-N.x,y:B.y-N.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:P}of i)if(P.length)for(const k of P)this.editor.updateShape({id:k.id,type:k.type,x:k.x,y:k.y})}}updateCursor({dragHandle:t,isFlippedX:s,isFlippedY:i,rotation:r}){const o={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{o.type="nwse-resize",s!==i&&(o.type="nesw-resize");break}case"top_right":case"bottom_left":{o.type="nesw-resize",s!==i&&(o.type="nwse-resize");break}}o.rotation=r,this.editor.setCursor(o)}}w(j5,"id","resizing");const Iw=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function hj(n,e){e=e%et;const t=Math.round(e/(qe/4)),s=Iw.indexOf(n);return Iw[(s+t)%Iw.length]}const pj=Math.PI/180;class N5 extends ye{constructor(){super(...arguments);w(this,"snapshot",{});w(this,"info",{});w(this,"markId","");w(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);const s=pF({editor:this.editor});if(!s)return this.parent.transition("idle",this.info);this.snapshot=s;const i=this._getRotationFromPointerPosition({snapToNearestDegree:!1});em({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:_d[this.info.handle],rotation:i+this.snapshot.initialSelectionRotation})});w(this,"onExit",()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}});w(this,"onPointerMove",()=>{this.update()});w(this,"onKeyDown",()=>{this.update()});w(this,"onKeyUp",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"update",()=>{const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});em({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:_d[this.info.handle],rotation:t+this.snapshot.initialSelectionRotation})});w(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});w(this,"complete",()=>{em({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),ht(this.editor,this.snapshot.shapeSnapshots.map(t=>t.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}_getRotationFromPointerPosition({snapToNearestDegree:t}){const s=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:r,currentPagePoint:o}}=this.editor,{initialCursorAngle:l,initialSelectionRotation:c}=this.snapshot;if(!i)return c;const u=i.center.clone().rotWith(i.point,s).angle(o)-l;let h=c+u;if(r)h=ky(h,24);else if(t&&(h=Math.round(h/pj)*pj,this.editor.getInstanceState().isCoarsePointer)){const p=ky(h,4),f=Zg(h,p);Math.abs(f)<yQ(5)&&(h=p)}return h-c}}w(N5,"id","rotating");class R5 extends ye{constructor(){super(...arguments);w(this,"hits",new Set);w(this,"size",0);w(this,"scribbleId","id");w(this,"initialSelectedShapeIds",new Set);w(this,"newlySelectedShapeIds",new Set);w(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})});w(this,"onExit",()=>{this.editor.scribbles.stop(this.scribbleId)});w(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});w(this,"onPointerUp",()=>{this.complete()});w(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});w(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")});w(this,"onCancel",()=>{this.cancel()});w(this,"onComplete",()=>{this.complete()});w(this,"pushPointToScribble",()=>{const{x:t,y:s}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,s)})}updateScribbleSelection(t){const{editor:s}=this,i=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:r,originPagePoint:o,previousPagePoint:l,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:d,initialSelectedShapeIds:u}=this;t&&this.pushPointToScribble();const h=i;let p,f,g,m;const x=0;for(let v=0,C=h.length;v<C;v++){if(p=h[v],s.isShapeOfType(p,"group")||d.has(p.id)||s.isShapeOrAncestorLocked(p)||(f=s.getShapeGeometry(p),s.isShapeOfType(p,"frame")&&f.bounds.containsPoint(s.getPointInShapeSpace(p,o))))continue;const T=s.getShapePageTransform(p);if(!f||!T)continue;const I=T.clone().invert();g=I.applyToPoint(l),m=I.applyToPoint(c);const{bounds:E}=f;if(!(E.minX-x>Math.max(g.x,m.x)||E.minY-x>Math.max(g.y,m.y)||E.maxX+x<Math.min(g.x,m.x)||E.maxY+x<Math.min(g.y,m.y))&&f.hitTestLineSegment(g,m,x)){const P=this.editor.getOutermostSelectableShape(p),k=this.editor.getShapeMask(P.id);if(k&&XE(l,c,k)!==null&&!Xs(c,k))continue;d.add(P.id)}}const y=s.getSelectedShapeIds(),S=new Set(r?[...d,...u]:[...d]);(y.length!==S.size||y.some(v=>!S.has(v)))&&this.editor.setSelectedShapes(Array.from(S))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}w(R5,"id","scribble_brushing");const qoe=20,Zoe=100;class Joe{constructor(e){w(this,"prevDroppingShapeId",null);w(this,"droppingNodeTimer",null);w(this,"first",!0);w(this,"dispose",()=>{this.clear()});this.editor=e,e.disposables.add(this.dispose)}updateDroppingNode(e,t){var s;this.first&&(this.editor.setHintingShapes(e.map(i=>this.editor.findShapeAncestor(i,r=>r.type!=="group")).filter(i=>i)),this.prevDroppingShapeId=((s=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:s.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,qoe,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,Zoe,t))}setDragTimer(e,t,s){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,s)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,s){var c,d,u,h,p;t=Ne(t.map(f=>this.editor.getShape(f.id)));const i=((c=this.editor.getDroppingOverShape(e,t))==null?void 0:c.id)??null;if(i===this.prevDroppingShapeId){this.hintParents(t);return}const{prevDroppingShapeId:r}=this,o=r&&this.editor.getShape(r),l=i&&this.editor.getShape(i);o&&((u=(d=this.editor.getShapeUtil(o)).onDragShapesOut)==null||u.call(d,o,t)),l&&((p=(h=this.editor.getShapeUtil(l)).onDragShapesOver)==null||p.call(h,l,t)),this.hintParents(t),s==null||s(),this.prevDroppingShapeId=i}hintParents(e){const t=new Map;for(const i of e){const r=this.editor.findShapeAncestor(i,o=>o.type!=="group");r&&(t.has(r.id)||t.set(r.id,[]),t.get(r.id).push(i.id))}const s=[];for(const[i,r]of t){const o=this.editor.getShape(i);o&&BF(this.editor,o).length<r.length&&s.push(o.id)}this.editor.setHintingShapes(s)}dropShapes(e){var s,i;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const r=this.editor.getShape(t);if(!r)return;(i=(s=this.editor.getShapeUtil(r)).onDropShapesOver)==null||i.call(s,r,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}}class M5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"selectionSnapshot",{});w(this,"snapshot",{});w(this,"markId","");w(this,"isCloning",!1);w(this,"isCreating",!1);w(this,"onCreate",()=>{});w(this,"dragAndDropManager",new Joe(this.editor));w(this,"onEnter",t=>{var r;const{isCreating:s=!1,onCreate:i=()=>{}}=t;if(!((r=this.editor.getSelectedShapeIds())!=null&&r.length)){this.parent.transition("idle");return}if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.isCreating=s,this.onCreate=i,s?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=t,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=fj(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()});w(this,"onTick",({elapsed:t})=>{const{editor:s}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),s.edgeScrollManager.updateEdgeScrolling(t)});w(this,"onPointerMove",()=>{this.updateShapes()});w(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});w(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onComplete",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()});w(this,"updateParentTransforms",()=>{const{editor:t,snapshot:{shapeSnapshots:s}}=this;s.forEach(i=>{const r=t.getShape(i.shape.id);if(!r)return null;const o=vs(r.parentId)?null:ve.Inverse(t.getShapePageTransform(r.parentId));i.parentTransform=o})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=fj(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var t;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),ht(this.editor,this.snapshot.movingShapes.map(s=>s.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(t=this.onCreate)==null||t.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:t}=this.snapshot,s=[];t.forEach(i=>{var l;const r=this.editor.getShapeUtil(i),o=(l=r.onTranslateStart)==null?void 0:l.call(r,i);o&&s.push(o)}),s.length>0&&this.editor.updateShapes(s),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:t}=this.snapshot;if(this.isCloning&&t.length>0){const i=_.Average(t.map(o=>this.editor.getShapePageTransform(o.id).point())),r=_.Sub(i,this.selectionSnapshot.averagePagePoint);_.IsNaN(r)||this.editor.updateInstanceState({duplicateProps:{shapeIds:t.map(o=>o.id),offset:{x:r.x,y:r.y}}})}const s=[];t.forEach(i=>{var c;const r=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),l=(c=o.onTranslateEnd)==null?void 0:c.call(o,i,r);l&&s.push(l)}),s.length>0&&this.editor.updateShapes(s)}updateShapes(){const{snapshot:t}=this;this.dragAndDropManager.updateDroppingNode(t.movingShapes,this.updateParentTransforms),Qoe({editor:this.editor,snapshot:t});const{movingShapes:s}=t,i=[];s.forEach(r=>{var d;const o=this.editor.getShape(r.id),l=this.editor.getShapeUtil(r),c=(d=l.onTranslate)==null?void 0:d.call(l,r,o);c&&i.push(c)}),i.length>0&&this.editor.updateShapes(i)}}w(M5,"id","translating");function fj(n){var h;const e=[],t=[],s=n.getSelectedShapeIds(),i=Ne(s.map(p=>{const f=n.getShape(p);if(!f)return null;e.push(f);const g=n.getShapePageTransform(p),m=g.point(),x=g.rotation();t.push(m);const y=So.isId(f.parentId)?null:ve.Inverse(n.getShapePageTransform(f.parentId));return{shape:f,pagePoint:m,pageRotation:x,parentTransform:y}})),r=n.getOnlySelectedShape();let o=[];if(r)o=n.snaps.shapeBounds.getSnapPoints(r.id);else{const p=n.getSelectionPageBounds();p&&(o=p.cornersAndCenter.map((f,g)=>({id:"selection:"+g,x:f.x,y:f.y})))}let l,c;const{originPagePoint:d}=n.inputs,u=i.filter(p=>n.isShapeOfType(p.shape,"note")&&n.isPointInShape(p.shape,d));if(u.length!==0)if(u.length===1)c=u[0];else{const p=n.getCurrentPageShapesSorted();c=(h=u.map(f=>({snapshot:f,index:p.findIndex(g=>g.id===f.shape.id)})).sort((f,g)=>g.index-f.index)[0])==null?void 0:h.snapshot}return c&&(l=WF(n,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:_.Average(t),movingShapes:e,shapeSnapshots:i,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:o,noteAdjacentPositions:l,noteSnapshot:c}}function Qoe({editor:n,snapshot:e}){const{inputs:t}=n,{noteSnapshot:s,noteAdjacentPositions:i,initialPageBounds:r,initialSnapPoints:o,shapeSnapshots:l,averagePagePoint:c}=e,d=n.getInstanceState().isGridMode,u=n.getDocumentSettings().gridSize,h=_.Sub(t.currentPagePoint,t.originPagePoint),p=n.inputs.shiftKey?Math.abs(h.x)<Math.abs(h.y)?"x":"y":null;if(p==="x"?h.x=0:p==="y"&&(h.y=0),n.snaps.clearIndicators(),(n.user.getIsSnapMode()?!t.ctrlKey:t.ctrlKey)&&n.inputs.pointerVelocity.len()<.5){const{nudge:x}=n.snaps.shapeBounds.snapTranslateShapes({dragDelta:h,initialSelectionPageBounds:r,lockedAxis:p,initialSelectionSnapPoints:o});h.add(x)}else if(s&&i){const{scale:x}=s.shape.props,y=s.pagePoint.clone().add(h).add(lx.clone().mul(x).rot(s.pageRotation));let S=$F/n.getZoomLevel(),v=new _(0,0);for(const C of i){const T=_.Sub(y,C),I=T.len();I<S&&(S=I,v=T)}h.sub(v)}const g=_.Add(c,h);d&&!t.ctrlKey&&g.snapToGrid(u);const m=_.Sub(g,c);n.updateShapes(Ne(l.map(({shape:x,pagePoint:y,parentTransform:S})=>{const v=_.Add(y,m),C=S?ve.applyToPoint(S,v):v;return{id:x.id,type:x.type,x:C.x,y:C.y}})))}class ih extends ye{constructor(){super(...arguments);w(this,"reactor");w(this,"cleanUpDuplicateProps",()=>{const t=this.editor.getSelectedShapeIds(),s=this.editor.getInstanceState();if(!s.duplicateProps)return;const i=new Set(s.duplicateProps.shapeIds);t.length===i.size&&t.every(r=>i.has(r))||this.editor.updateInstanceState({duplicateProps:null})});w(this,"onEnter",()=>{this.reactor=Zl("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(t){console.error(t)}})});w(this,"onExit",()=>{var t;(t=this.reactor)==null||t.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)})}}w(ih,"id","select"),w(ih,"initial","idle"),w(ih,"isLockable",!1),w(ih,"children",()=>[Cm,y1,Voe,T5,A5,M5,m5,R5,v1,k5,y5,C5,j5,N5,P5,E5,I5,b5]);class O5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t});w(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}w(O5,"id","idle");class D5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t});w(this,"onPointerUp",()=>{this.complete()});w(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});w(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{animation:{duration:220}}):this.editor.zoomIn(t,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}w(D5,"id","pointing");class L5 extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"zoomBrush",new ue);w(this,"onEnter",t=>{this.info=t,this.update()});w(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});w(this,"onPointerMove",()=>{this.update()});w(this,"onPointerUp",()=>{this.complete()});w(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:t,currentPagePoint:s}}=this.editor;this.zoomBrush.setTo(ue.FromPoints([t,s])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,s=8/this.editor.getZoomLevel();if(t.width<s&&t.height<s){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{animation:{duration:220}}):this.editor.zoomIn(i,{animation:{duration:220}})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,{targetZoom:i,animation:{duration:220}})}this.parent.transition("idle",this.info)}}w(L5,"id","zoom_brushing");class rh extends ye{constructor(){super(...arguments);w(this,"info",{});w(this,"onEnter",t=>{this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()});w(this,"onExit",()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)});w(this,"onKeyDown",()=>{this.updateCursor()});w(this,"onKeyUp",t=>{this.updateCursor(),t.code==="KeyZ"&&this.complete()});w(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}w(rh,"id","zoom"),w(rh,"initial","idle"),w(rh,"children",()=>[O5,L5,D5]),w(rh,"isLockable",!1);const eae=[th,nh,sh,rh,ih];function me(n,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(n==null||n(i),t===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function gj(n,e){if(typeof n=="function")return n(e);n!=null&&(n.current=e)}function px(...n){return e=>{let t=!1;const s=n.map(i=>{const r=gj(i,e);return!t&&typeof r=="function"&&(t=!0),r});if(t)return()=>{for(let i=0;i<s.length;i++){const r=s[i];typeof r=="function"?r():gj(n[i],null)}}}}function dt(...n){return b.useCallback(px(...n),n)}function tae(n,e){const t=b.createContext(e),s=r=>{const{children:o,...l}=r,c=b.useMemo(()=>l,Object.values(l));return a.jsx(t.Provider,{value:c,children:o})};s.displayName=n+"Provider";function i(r){const o=b.useContext(t);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${r}\` must be used within \`${n}\``)}return[s,i]}function Fr(n,e=[]){let t=[];function s(r,o){const l=b.createContext(o),c=t.length;t=[...t,o];const d=h=>{var y;const{scope:p,children:f,...g}=h,m=((y=p==null?void 0:p[n])==null?void 0:y[c])||l,x=b.useMemo(()=>g,Object.values(g));return a.jsx(m.Provider,{value:x,children:f})};d.displayName=r+"Provider";function u(h,p){var m;const f=((m=p==null?void 0:p[n])==null?void 0:m[c])||l,g=b.useContext(f);if(g)return g;if(o!==void 0)return o;throw new Error(`\`${h}\` must be used within \`${r}\``)}return[d,u]}const i=()=>{const r=t.map(o=>b.createContext(o));return function(l){const c=(l==null?void 0:l[n])||r;return b.useMemo(()=>({[`__scope${n}`]:{...l,[n]:c}}),[l,c])}};return i.scopeName=n,[s,nae(i,...e)]}function nae(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const s=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(r){const o=s.reduce((l,{useScope:c,scopeName:d})=>{const h=c(r)[`__scope${d}`];return{...l,...h}},{});return b.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}var bo=globalThis!=null&&globalThis.document?b.useLayoutEffect:()=>{},sae=YR[" useId ".trim().toString()]||(()=>{}),iae=0;function po(n){const[e,t]=b.useState(sae());return bo(()=>{t(s=>s??String(iae++))},[n]),n||(e?`radix-${e}`:"")}var rae=YR[" useInsertionEffect ".trim().toString()]||bo;function Wa({prop:n,defaultProp:e,onChange:t=()=>{},caller:s}){const[i,r,o]=oae({defaultProp:e,onChange:t}),l=n!==void 0,c=l?n:i;{const u=b.useRef(n!==void 0);b.useEffect(()=>{const h=u.current;h!==l&&console.warn(`${s} is changing from ${h?"controlled":"uncontrolled"} to ${l?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),u.current=l},[l,s])}const d=b.useCallback(u=>{var h;if(l){const p=aae(u)?u(n):u;p!==n&&((h=o.current)==null||h.call(o,p))}else r(u)},[l,n,r,o]);return[c,d]}function oae({defaultProp:n,onChange:e}){const[t,s]=b.useState(n),i=b.useRef(t),r=b.useRef(e);return rae(()=>{r.current=e},[e]),b.useEffect(()=>{var o;i.current!==t&&((o=r.current)==null||o.call(r,t),i.current=t)},[t,i]),[t,s,r]}function aae(n){return typeof n=="function"}function Cd(n){const e=lae(n),t=b.forwardRef((s,i)=>{const{children:r,...o}=s,l=b.Children.toArray(r),c=l.find(dae);if(c){const d=c.props.children,u=l.map(h=>h===c?b.Children.count(d)>1?b.Children.only(null):b.isValidElement(d)?d.props.children:null:h);return a.jsx(e,{...o,ref:i,children:b.isValidElement(d)?b.cloneElement(d,void 0,u):null})}return a.jsx(e,{...o,ref:i,children:r})});return t.displayName=`${n}.Slot`,t}function lae(n){const e=b.forwardRef((t,s)=>{const{children:i,...r}=t;if(b.isValidElement(i)){const o=hae(i),l=uae(r,i.props);return i.type!==b.Fragment&&(l.ref=s?px(s,o):o),b.cloneElement(i,l)}return b.Children.count(i)>1?b.Children.only(null):null});return e.displayName=`${n}.SlotClone`,e}var cae=Symbol("radix.slottable");function dae(n){return b.isValidElement(n)&&typeof n.type=="function"&&"__radixId"in n.type&&n.type.__radixId===cae}function uae(n,e){const t={...e};for(const s in e){const i=n[s],r=e[s];/^on[A-Z]/.test(s)?i&&r?t[s]=(...l)=>{const c=r(...l);return i(...l),c}:i&&(t[s]=i):s==="style"?t[s]={...i,...r}:s==="className"&&(t[s]=[i,r].filter(Boolean).join(" "))}return{...n,...t}}function hae(n){var s,i;let e=(s=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var pae=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ge=pae.reduce((n,e)=>{const t=Cd(`Primitive.${e}`),s=b.forwardRef((i,r)=>{const{asChild:o,...l}=i,c=o?t:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),a.jsx(c,{...l,ref:r})});return s.displayName=`Primitive.${e}`,{...n,[e]:s}},{});function x1(n,e){n&&kr.flushSync(()=>n.dispatchEvent(e))}function os(n){const e=b.useRef(n);return b.useEffect(()=>{e.current=n}),b.useMemo(()=>(...t)=>{var s;return(s=e.current)==null?void 0:s.call(e,...t)},[])}function fae(n,e=globalThis==null?void 0:globalThis.document){const t=os(n);b.useEffect(()=>{const s=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",s,{capture:!0}),()=>e.removeEventListener("keydown",s,{capture:!0})},[t,e])}var gae="DismissableLayer",g_="dismissableLayer.update",mae="dismissableLayer.pointerDownOutside",yae="dismissableLayer.focusOutside",mj,F5=b.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Hp=b.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:s,onPointerDownOutside:i,onFocusOutside:r,onInteractOutside:o,onDismiss:l,...c}=n,d=b.useContext(F5),[u,h]=b.useState(null),p=(u==null?void 0:u.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,f]=b.useState({}),g=dt(e,E=>h(E)),m=Array.from(d.layers),[x]=[...d.layersWithOutsidePointerEventsDisabled].slice(-1),y=m.indexOf(x),S=u?m.indexOf(u):-1,v=d.layersWithOutsidePointerEventsDisabled.size>0,C=S>=y,T=xae(E=>{const P=E.target,k=[...d.branches].some(j=>j.contains(P));!C||k||(i==null||i(E),o==null||o(E),E.defaultPrevented||l==null||l())},p),I=Sae(E=>{const P=E.target;[...d.branches].some(j=>j.contains(P))||(r==null||r(E),o==null||o(E),E.defaultPrevented||l==null||l())},p);return fae(E=>{S===d.layers.size-1&&(s==null||s(E),!E.defaultPrevented&&l&&(E.preventDefault(),l()))},p),b.useEffect(()=>{if(u)return t&&(d.layersWithOutsidePointerEventsDisabled.size===0&&(mj=p.body.style.pointerEvents,p.body.style.pointerEvents="none"),d.layersWithOutsidePointerEventsDisabled.add(u)),d.layers.add(u),yj(),()=>{t&&d.layersWithOutsidePointerEventsDisabled.size===1&&(p.body.style.pointerEvents=mj)}},[u,p,t,d]),b.useEffect(()=>()=>{u&&(d.layers.delete(u),d.layersWithOutsidePointerEventsDisabled.delete(u),yj())},[u,d]),b.useEffect(()=>{const E=()=>f({});return document.addEventListener(g_,E),()=>document.removeEventListener(g_,E)},[]),a.jsx(Ge.div,{...c,ref:g,style:{pointerEvents:v?C?"auto":"none":void 0,...n.style},onFocusCapture:me(n.onFocusCapture,I.onFocusCapture),onBlurCapture:me(n.onBlurCapture,I.onBlurCapture),onPointerDownCapture:me(n.onPointerDownCapture,T.onPointerDownCapture)})});Hp.displayName=gae;var vae="DismissableLayerBranch",B5=b.forwardRef((n,e)=>{const t=b.useContext(F5),s=b.useRef(null),i=dt(e,s);return b.useEffect(()=>{const r=s.current;if(r)return t.branches.add(r),()=>{t.branches.delete(r)}},[t.branches]),a.jsx(Ge.div,{...n,ref:i})});B5.displayName=vae;function xae(n,e=globalThis==null?void 0:globalThis.document){const t=os(n),s=b.useRef(!1),i=b.useRef(()=>{});return b.useEffect(()=>{const r=l=>{if(l.target&&!s.current){let c=function(){U5(mae,t,d,{discrete:!0})};const d={originalEvent:l};l.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=c,e.addEventListener("click",i.current,{once:!0})):c()}else e.removeEventListener("click",i.current);s.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",r)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",r),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>s.current=!0}}function Sae(n,e=globalThis==null?void 0:globalThis.document){const t=os(n),s=b.useRef(!1);return b.useEffect(()=>{const i=r=>{r.target&&!s.current&&U5(yae,t,{originalEvent:r},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function yj(){const n=new CustomEvent(g_);document.dispatchEvent(n)}function U5(n,e,t,{discrete:s}){const i=t.originalEvent.target,r=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),s?x1(i,r):i.dispatchEvent(r)}var wae=Hp,bae=B5,Pw="focusScope.autoFocusOnMount",kw="focusScope.autoFocusOnUnmount",vj={bubbles:!1,cancelable:!0},_ae="FocusScope",fx=b.forwardRef((n,e)=>{const{loop:t=!1,trapped:s=!1,onMountAutoFocus:i,onUnmountAutoFocus:r,...o}=n,[l,c]=b.useState(null),d=os(i),u=os(r),h=b.useRef(null),p=dt(e,m=>c(m)),f=b.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;b.useEffect(()=>{if(s){let m=function(v){if(f.paused||!l)return;const C=v.target;l.contains(C)?h.current=C:Xo(h.current,{select:!0})},x=function(v){if(f.paused||!l)return;const C=v.relatedTarget;C!==null&&(l.contains(C)||Xo(h.current,{select:!0}))},y=function(v){if(document.activeElement===document.body)for(const T of v)T.removedNodes.length>0&&Xo(l)};document.addEventListener("focusin",m),document.addEventListener("focusout",x);const S=new MutationObserver(y);return l&&S.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",m),document.removeEventListener("focusout",x),S.disconnect()}}},[s,l,f.paused]),b.useEffect(()=>{if(l){Sj.add(f);const m=document.activeElement;if(!l.contains(m)){const y=new CustomEvent(Pw,vj);l.addEventListener(Pw,d),l.dispatchEvent(y),y.defaultPrevented||(Cae(kae($5(l)),{select:!0}),document.activeElement===m&&Xo(l))}return()=>{l.removeEventListener(Pw,d),setTimeout(()=>{const y=new CustomEvent(kw,vj);l.addEventListener(kw,u),l.dispatchEvent(y),y.defaultPrevented||Xo(m??document.body,{select:!0}),l.removeEventListener(kw,u),Sj.remove(f)},0)}}},[l,d,u,f]);const g=b.useCallback(m=>{if(!t&&!s||f.paused)return;const x=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,y=document.activeElement;if(x&&y){const S=m.currentTarget,[v,C]=Eae(S);v&&C?!m.shiftKey&&y===C?(m.preventDefault(),t&&Xo(v,{select:!0})):m.shiftKey&&y===v&&(m.preventDefault(),t&&Xo(C,{select:!0})):y===S&&m.preventDefault()}},[t,s,f.paused]);return a.jsx(Ge.div,{tabIndex:-1,...o,ref:p,onKeyDown:g})});fx.displayName=_ae;function Cae(n,{select:e=!1}={}){const t=document.activeElement;for(const s of n)if(Xo(s,{select:e}),document.activeElement!==t)return}function Eae(n){const e=$5(n),t=xj(e,n),s=xj(e.reverse(),n);return[t,s]}function $5(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const i=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||i?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function xj(n,e){for(const t of n)if(!Tae(t,{upTo:e}))return t}function Tae(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function Iae(n){return n instanceof HTMLInputElement&&"select"in n}function Xo(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&Iae(n)&&e&&n.select()}}var Sj=Pae();function Pae(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=wj(n,e),n.unshift(e)},remove(e){var t;n=wj(n,e),(t=n[0])==null||t.resume()}}}function wj(n,e){const t=[...n],s=t.indexOf(e);return s!==-1&&t.splice(s,1),t}function kae(n){return n.filter(e=>e.tagName!=="A")}var Aae="Portal",Gp=b.forwardRef((n,e)=>{var l;const{container:t,...s}=n,[i,r]=b.useState(!1);bo(()=>r(!0),[]);const o=t||i&&((l=globalThis==null?void 0:globalThis.document)==null?void 0:l.body);return o?M9.createPortal(a.jsx(Ge.div,{...s,ref:e}),o):null});Gp.displayName=Aae;function jae(n,e){return b.useReducer((t,s)=>e[t][s]??t,n)}var Qi=n=>{const{present:e,children:t}=n,s=Nae(e),i=typeof t=="function"?t({present:s.isPresent}):b.Children.only(t),r=dt(s.ref,Rae(i));return typeof t=="function"||s.isPresent?b.cloneElement(i,{ref:r}):null};Qi.displayName="Presence";function Nae(n){const[e,t]=b.useState(),s=b.useRef(null),i=b.useRef(n),r=b.useRef("none"),o=n?"mounted":"unmounted",[l,c]=jae(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return b.useEffect(()=>{const d=hg(s.current);r.current=l==="mounted"?d:"none"},[l]),bo(()=>{const d=s.current,u=i.current;if(u!==n){const p=r.current,f=hg(d);n?c("MOUNT"):f==="none"||(d==null?void 0:d.display)==="none"?c("UNMOUNT"):c(u&&p!==f?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,c]),bo(()=>{if(e){let d;const u=e.ownerDocument.defaultView??window,h=f=>{const m=hg(s.current).includes(CSS.escape(f.animationName));if(f.target===e&&m&&(c("ANIMATION_END"),!i.current)){const x=e.style.animationFillMode;e.style.animationFillMode="forwards",d=u.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=x)})}},p=f=>{f.target===e&&(r.current=hg(s.current))};return e.addEventListener("animationstart",p),e.addEventListener("animationcancel",h),e.addEventListener("animationend",h),()=>{u.clearTimeout(d),e.removeEventListener("animationstart",p),e.removeEventListener("animationcancel",h),e.removeEventListener("animationend",h)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:b.useCallback(d=>{s.current=d?getComputedStyle(d):null,t(d)},[])}}function hg(n){return(n==null?void 0:n.animationName)||"none"}function Rae(n){var s,i;let e=(s=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:s.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Aw=0;function S1(){b.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??bj()),document.body.insertAdjacentElement("beforeend",n[1]??bj()),Aw++,()=>{Aw===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),Aw--}},[])}function bj(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var fr=function(){return fr=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++){t=arguments[s];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},fr.apply(this,arguments)};function Vp(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(n);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(n,s[i])&&(t[s[i]]=n[s[i]]);return t}function Mae(n,e,t){if(t||arguments.length===2)for(var s=0,i=e.length,r;s<i;s++)(r||!(s in e))&&(r||(r=Array.prototype.slice.call(e,0,s)),r[s]=e[s]);return n.concat(r||Array.prototype.slice.call(e))}var Em="right-scroll-bar-position",Tm="width-before-scroll-bar",Oae="with-scroll-bars-hidden",Dae="--removed-body-scroll-bar-size";function jw(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function Lae(n,e){var t=b.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(s){var i=t.value;i!==s&&(t.value=s,t.callback(s,i))}}}})[0];return t.callback=e,t.facade}var Fae=typeof window<"u"?b.useLayoutEffect:b.useEffect,_j=new WeakMap;function Bae(n,e){var t=Lae(null,function(s){return n.forEach(function(i){return jw(i,s)})});return Fae(function(){var s=_j.get(t);if(s){var i=new Set(s),r=new Set(n),o=t.current;i.forEach(function(l){r.has(l)||jw(l,null)}),r.forEach(function(l){i.has(l)||jw(l,o)})}_j.set(t,n)},[n]),t}function Uae(n){return n}function $ae(n,e){e===void 0&&(e=Uae);var t=[],s=!1,i={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(r){var o=e(r,s);return t.push(o),function(){t=t.filter(function(l){return l!==o})}},assignSyncMedium:function(r){for(s=!0;t.length;){var o=t;t=[],o.forEach(r)}t={push:function(l){return r(l)},filter:function(){return t}}},assignMedium:function(r){s=!0;var o=[];if(t.length){var l=t;t=[],l.forEach(r),o=t}var c=function(){var u=o;o=[],u.forEach(r)},d=function(){return Promise.resolve().then(c)};d(),t={push:function(u){o.push(u),d()},filter:function(u){return o=o.filter(u),t}}}};return i}function zae(n){n===void 0&&(n={});var e=$ae(null);return e.options=fr({async:!0,ssr:!1},n),e}var z5=function(n){var e=n.sideCar,t=Vp(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=e.read();if(!s)throw new Error("Sidecar medium not found");return b.createElement(s,fr({},t))};z5.isSideCarExport=!0;function Wae(n,e){return n.useMedium(e),z5}var W5=zae(),Nw=function(){},gx=b.forwardRef(function(n,e){var t=b.useRef(null),s=b.useState({onScrollCapture:Nw,onWheelCapture:Nw,onTouchMoveCapture:Nw}),i=s[0],r=s[1],o=n.forwardProps,l=n.children,c=n.className,d=n.removeScrollBar,u=n.enabled,h=n.shards,p=n.sideCar,f=n.noRelative,g=n.noIsolation,m=n.inert,x=n.allowPinchZoom,y=n.as,S=y===void 0?"div":y,v=n.gapMode,C=Vp(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),T=p,I=Bae([t,e]),E=fr(fr({},C),i);return b.createElement(b.Fragment,null,u&&b.createElement(T,{sideCar:W5,removeScrollBar:d,shards:h,noRelative:f,noIsolation:g,inert:m,setCallbacks:r,allowPinchZoom:!!x,lockRef:t,gapMode:v}),o?b.cloneElement(b.Children.only(l),fr(fr({},E),{ref:I})):b.createElement(S,fr({},E,{className:c,ref:I}),l))});gx.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};gx.classNames={fullWidth:Tm,zeroRight:Em};var Hae=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Gae(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=Hae();return e&&n.setAttribute("nonce",e),n}function Vae(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function Kae(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var Yae=function(){var n=0,e=null;return{add:function(t){n==0&&(e=Gae())&&(Vae(e,t),Kae(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Xae=function(){var n=Yae();return function(e,t){b.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},H5=function(){var n=Xae(),e=function(t){var s=t.styles,i=t.dynamic;return n(s,i),null};return e},qae={left:0,top:0,right:0,gap:0},Rw=function(n){return parseInt(n||"",10)||0},Zae=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],s=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[Rw(t),Rw(s),Rw(i)]},Jae=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return qae;var e=Zae(n),t=document.documentElement.clientWidth,s=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,s-t+e[2]-e[0])}},Qae=H5(),nd="data-scroll-locked",ele=function(n,e,t,s){var i=n.left,r=n.top,o=n.right,l=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(Oae,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(l,"px ").concat(s,`;
  }
  body[`).concat(nd,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(s,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(r,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(s,`;
    `),t==="padding"&&"padding-right: ".concat(l,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Em,` {
    right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(Tm,` {
    margin-right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(Em," .").concat(Em,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(Tm," .").concat(Tm,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(nd,`] {
    `).concat(Dae,": ").concat(l,`px;
  }
`)},Cj=function(){var n=parseInt(document.body.getAttribute(nd)||"0",10);return isFinite(n)?n:0},tle=function(){b.useEffect(function(){return document.body.setAttribute(nd,(Cj()+1).toString()),function(){var n=Cj()-1;n<=0?document.body.removeAttribute(nd):document.body.setAttribute(nd,n.toString())}},[])},nle=function(n){var e=n.noRelative,t=n.noImportant,s=n.gapMode,i=s===void 0?"margin":s;tle();var r=b.useMemo(function(){return Jae(i)},[i]);return b.createElement(Qae,{styles:ele(r,!e,i,t?"":"!important")})},m_=!1;if(typeof window<"u")try{var pg=Object.defineProperty({},"passive",{get:function(){return m_=!0,!0}});window.addEventListener("test",pg,pg),window.removeEventListener("test",pg,pg)}catch{m_=!1}var hc=m_?{passive:!1}:!1,sle=function(n){return n.tagName==="TEXTAREA"},G5=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!sle(n)&&t[e]==="visible")},ile=function(n){return G5(n,"overflowY")},rle=function(n){return G5(n,"overflowX")},Ej=function(n,e){var t=e.ownerDocument,s=e;do{typeof ShadowRoot<"u"&&s instanceof ShadowRoot&&(s=s.host);var i=V5(n,s);if(i){var r=K5(n,s),o=r[1],l=r[2];if(o>l)return!0}s=s.parentNode}while(s&&s!==t.body);return!1},ole=function(n){var e=n.scrollTop,t=n.scrollHeight,s=n.clientHeight;return[e,t,s]},ale=function(n){var e=n.scrollLeft,t=n.scrollWidth,s=n.clientWidth;return[e,t,s]},V5=function(n,e){return n==="v"?ile(e):rle(e)},K5=function(n,e){return n==="v"?ole(e):ale(e)},lle=function(n,e){return n==="h"&&e==="rtl"?-1:1},cle=function(n,e,t,s,i){var r=lle(n,window.getComputedStyle(e).direction),o=r*s,l=t.target,c=e.contains(l),d=!1,u=o>0,h=0,p=0;do{if(!l)break;var f=K5(n,l),g=f[0],m=f[1],x=f[2],y=m-x-r*g;(g||y)&&V5(n,l)&&(h+=y,p+=g);var S=l.parentNode;l=S&&S.nodeType===Node.DOCUMENT_FRAGMENT_NODE?S.host:S}while(!c&&l!==document.body||c&&(e.contains(l)||e===l));return(u&&Math.abs(h)<1||!u&&Math.abs(p)<1)&&(d=!0),d},fg=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},Tj=function(n){return[n.deltaX,n.deltaY]},Ij=function(n){return n&&"current"in n?n.current:n},dle=function(n,e){return n[0]===e[0]&&n[1]===e[1]},ule=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},hle=0,pc=[];function ple(n){var e=b.useRef([]),t=b.useRef([0,0]),s=b.useRef(),i=b.useState(hle++)[0],r=b.useState(H5)[0],o=b.useRef(n);b.useEffect(function(){o.current=n},[n]),b.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var m=Mae([n.lockRef.current],(n.shards||[]).map(Ij),!0).filter(Boolean);return m.forEach(function(x){return x.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),m.forEach(function(x){return x.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var l=b.useCallback(function(m,x){if("touches"in m&&m.touches.length===2||m.type==="wheel"&&m.ctrlKey)return!o.current.allowPinchZoom;var y=fg(m),S=t.current,v="deltaX"in m?m.deltaX:S[0]-y[0],C="deltaY"in m?m.deltaY:S[1]-y[1],T,I=m.target,E=Math.abs(v)>Math.abs(C)?"h":"v";if("touches"in m&&E==="h"&&I.type==="range")return!1;var P=window.getSelection(),k=P&&P.anchorNode,j=k?k===I||k.contains(I):!1;if(j)return!1;var D=Ej(E,I);if(!D)return!0;if(D?T=E:(T=E==="v"?"h":"v",D=Ej(E,I)),!D)return!1;if(!s.current&&"changedTouches"in m&&(v||C)&&(s.current=T),!T)return!0;var R=s.current||T;return cle(R,x,m,R==="h"?v:C)},[]),c=b.useCallback(function(m){var x=m;if(!(!pc.length||pc[pc.length-1]!==r)){var y="deltaY"in x?Tj(x):fg(x),S=e.current.filter(function(T){return T.name===x.type&&(T.target===x.target||x.target===T.shadowParent)&&dle(T.delta,y)})[0];if(S&&S.should){x.cancelable&&x.preventDefault();return}if(!S){var v=(o.current.shards||[]).map(Ij).filter(Boolean).filter(function(T){return T.contains(x.target)}),C=v.length>0?l(x,v[0]):!o.current.noIsolation;C&&x.cancelable&&x.preventDefault()}}},[]),d=b.useCallback(function(m,x,y,S){var v={name:m,delta:x,target:y,should:S,shadowParent:fle(y)};e.current.push(v),setTimeout(function(){e.current=e.current.filter(function(C){return C!==v})},1)},[]),u=b.useCallback(function(m){t.current=fg(m),s.current=void 0},[]),h=b.useCallback(function(m){d(m.type,Tj(m),m.target,l(m,n.lockRef.current))},[]),p=b.useCallback(function(m){d(m.type,fg(m),m.target,l(m,n.lockRef.current))},[]);b.useEffect(function(){return pc.push(r),n.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:p}),document.addEventListener("wheel",c,hc),document.addEventListener("touchmove",c,hc),document.addEventListener("touchstart",u,hc),function(){pc=pc.filter(function(m){return m!==r}),document.removeEventListener("wheel",c,hc),document.removeEventListener("touchmove",c,hc),document.removeEventListener("touchstart",u,hc)}},[]);var f=n.removeScrollBar,g=n.inert;return b.createElement(b.Fragment,null,g?b.createElement(r,{styles:ule(i)}):null,f?b.createElement(nle,{noRelative:n.noRelative,gapMode:n.gapMode}):null)}function fle(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const gle=Wae(W5,ple);var mx=b.forwardRef(function(n,e){return b.createElement(gx,fr({},n,{ref:e,sideCar:gle}))});mx.classNames=gx.classNames;var mle=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},fc=new WeakMap,gg=new WeakMap,mg={},Mw=0,Y5=function(n){return n&&(n.host||Y5(n.parentNode))},yle=function(n,e){return e.map(function(t){if(n.contains(t))return t;var s=Y5(t);return s&&n.contains(s)?s:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},vle=function(n,e,t,s){var i=yle(e,Array.isArray(n)?n:[n]);mg[t]||(mg[t]=new WeakMap);var r=mg[t],o=[],l=new Set,c=new Set(i),d=function(h){!h||l.has(h)||(l.add(h),d(h.parentNode))};i.forEach(d);var u=function(h){!h||c.has(h)||Array.prototype.forEach.call(h.children,function(p){if(l.has(p))u(p);else try{var f=p.getAttribute(s),g=f!==null&&f!=="false",m=(fc.get(p)||0)+1,x=(r.get(p)||0)+1;fc.set(p,m),r.set(p,x),o.push(p),m===1&&g&&gg.set(p,!0),x===1&&p.setAttribute(t,"true"),g||p.setAttribute(s,"true")}catch(y){console.error("aria-hidden: cannot operate on ",p,y)}})};return u(e),l.clear(),Mw++,function(){o.forEach(function(h){var p=fc.get(h)-1,f=r.get(h)-1;fc.set(h,p),r.set(h,f),p||(gg.has(h)||h.removeAttribute(s),gg.delete(h)),f||h.removeAttribute(t)}),Mw--,Mw||(fc=new WeakMap,fc=new WeakMap,gg=new WeakMap,mg={})}},w1=function(n,e,t){t===void 0&&(t="data-aria-hidden");var s=Array.from(Array.isArray(n)?n:[n]),i=mle(n);return i?(s.push.apply(s,Array.from(i.querySelectorAll("[aria-live], script"))),vle(s,i,t,"aria-hidden")):function(){return null}},yx="Dialog",[X5]=Fr(yx),[xle,er]=X5(yx),q5=n=>{const{__scopeDialog:e,children:t,open:s,defaultOpen:i,onOpenChange:r,modal:o=!0}=n,l=b.useRef(null),c=b.useRef(null),[d,u]=Wa({prop:s,defaultProp:i??!1,onChange:r,caller:yx});return a.jsx(xle,{scope:e,triggerRef:l,contentRef:c,contentId:po(),titleId:po(),descriptionId:po(),open:d,onOpenChange:u,onOpenToggle:b.useCallback(()=>u(h=>!h),[u]),modal:o,children:t})};q5.displayName=yx;var Z5="DialogTrigger",Sle=b.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,i=er(Z5,t),r=dt(e,i.triggerRef);return a.jsx(Ge.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":C1(i.open),...s,ref:r,onClick:me(n.onClick,i.onOpenToggle)})});Sle.displayName=Z5;var b1="DialogPortal",[wle,J5]=X5(b1,{forceMount:void 0}),Q5=n=>{const{__scopeDialog:e,forceMount:t,children:s,container:i}=n,r=er(b1,e);return a.jsx(wle,{scope:e,forceMount:t,children:b.Children.map(s,o=>a.jsx(Qi,{present:t||r.open,children:a.jsx(Gp,{asChild:!0,container:i,children:o})}))})};Q5.displayName=b1;var zy="DialogOverlay",eB=b.forwardRef((n,e)=>{const t=J5(zy,n.__scopeDialog),{forceMount:s=t.forceMount,...i}=n,r=er(zy,n.__scopeDialog);return r.modal?a.jsx(Qi,{present:s||r.open,children:a.jsx(_le,{...i,ref:e})}):null});eB.displayName=zy;var ble=Cd("DialogOverlay.RemoveScroll"),_le=b.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,i=er(zy,t);return a.jsx(mx,{as:ble,allowPinchZoom:!0,shards:[i.contentRef],children:a.jsx(Ge.div,{"data-state":C1(i.open),...s,ref:e,style:{pointerEvents:"auto",...s.style}})})}),Dl="DialogContent",tB=b.forwardRef((n,e)=>{const t=J5(Dl,n.__scopeDialog),{forceMount:s=t.forceMount,...i}=n,r=er(Dl,n.__scopeDialog);return a.jsx(Qi,{present:s||r.open,children:r.modal?a.jsx(Cle,{...i,ref:e}):a.jsx(Ele,{...i,ref:e})})});tB.displayName=Dl;var Cle=b.forwardRef((n,e)=>{const t=er(Dl,n.__scopeDialog),s=b.useRef(null),i=dt(e,t.contentRef,s);return b.useEffect(()=>{const r=s.current;if(r)return w1(r)},[]),a.jsx(nB,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:me(n.onCloseAutoFocus,r=>{var o;r.preventDefault(),(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:me(n.onPointerDownOutside,r=>{const o=r.detail.originalEvent,l=o.button===0&&o.ctrlKey===!0;(o.button===2||l)&&r.preventDefault()}),onFocusOutside:me(n.onFocusOutside,r=>r.preventDefault())})}),Ele=b.forwardRef((n,e)=>{const t=er(Dl,n.__scopeDialog),s=b.useRef(!1),i=b.useRef(!1);return a.jsx(nB,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{var o,l;(o=n.onCloseAutoFocus)==null||o.call(n,r),r.defaultPrevented||(s.current||(l=t.triggerRef.current)==null||l.focus(),r.preventDefault()),s.current=!1,i.current=!1},onInteractOutside:r=>{var c,d;(c=n.onInteractOutside)==null||c.call(n,r),r.defaultPrevented||(s.current=!0,r.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=r.target;((d=t.triggerRef.current)==null?void 0:d.contains(o))&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&i.current&&r.preventDefault()}})}),nB=b.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:r,...o}=n,l=er(Dl,t),c=b.useRef(null),d=dt(e,c);return S1(),a.jsxs(a.Fragment,{children:[a.jsx(fx,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:i,onUnmountAutoFocus:r,children:a.jsx(Hp,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":C1(l.open),...o,ref:d,onDismiss:()=>l.onOpenChange(!1)})}),a.jsxs(a.Fragment,{children:[a.jsx(Ile,{titleId:l.titleId}),a.jsx(kle,{contentRef:c,descriptionId:l.descriptionId})]})]})}),_1="DialogTitle",sB=b.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,i=er(_1,t);return a.jsx(Ge.h2,{id:i.titleId,...s,ref:e})});sB.displayName=_1;var iB="DialogDescription",Tle=b.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,i=er(iB,t);return a.jsx(Ge.p,{id:i.descriptionId,...s,ref:e})});Tle.displayName=iB;var rB="DialogClose",oB=b.forwardRef((n,e)=>{const{__scopeDialog:t,...s}=n,i=er(rB,t);return a.jsx(Ge.button,{type:"button",...s,ref:e,onClick:me(n.onClick,()=>i.onOpenChange(!1))})});oB.displayName=rB;function C1(n){return n?"open":"closed"}var aB="DialogTitleWarning",[BEe,lB]=tae(aB,{contentName:Dl,titleName:_1,docsSlug:"dialog"}),Ile=({titleId:n})=>{const e=lB(aB),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return b.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},Ple="DialogDescriptionWarning",kle=({contentRef:n,descriptionId:e})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${lB(Ple).contentName}}.`;return b.useEffect(()=>{var r;const i=(r=n.current)==null?void 0:r.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(s))},[s,n,e]),null},Ale=q5,jle=Q5,Nle=eB,Rle=tB;const cB=()=>{},dB=b.createContext(null);function Mle({onEvent:n,children:e}){return a.jsx(dB.Provider,{value:n??cB,children:e})}function An(){return b.useContext(dB)??cB}const uB=b.createContext(null);function Ole({children:n}){const e=G(),t=An(),[s,i]=b.useState([]),r=b.useCallback(d=>{const u=d.id??Rt();return i(h=>[...h.filter(p=>p.id!==d.id),{...d,id:u}]),t("open-menu",{source:"dialog",id:u}),e.addOpenMenu(u),u},[e,t]),o=b.useCallback((d,u)=>(i(h=>h.map(p=>p.id===d?{...p,...u}:p)),t("open-menu",{source:"dialog",id:d}),e.addOpenMenu(d),d),[e,t]),l=b.useCallback(d=>(i(u=>u.filter(h=>{var p;return h.id===d?((p=h.onClose)==null||p.call(h),!1):!0})),t("close-menu",{source:"dialog",id:d}),e.deleteOpenMenu(d),d),[e,t]),c=b.useCallback(()=>{i(d=>(d.forEach(u=>{var h;(h=u.onClose)==null||h.call(u),t("close-menu",{source:"dialog",id:u.id}),e.deleteOpenMenu(u.id)}),[]))},[e,t]);return a.jsx(uB.Provider,{value:{dialogs:s,addDialog:r,removeDialog:l,clearDialogs:c,updateDialog:o},children:n})}function Jl(){const n=b.useContext(uB);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}const Dle=({id:n,component:e,onClose:t})=>{const{removeDialog:s}=Jl(),i=fn(),r=b.useCallback(o=>{if(!o){if(t)try{t()}catch(l){console.warn(l)}s(n)}},[n,t,s]);return a.jsx(Ale,{onOpenChange:r,defaultOpen:!0,children:a.jsx(jle,{container:i,children:a.jsx(Nle,{dir:"ltr",className:"tlui-dialog__overlay",onClick:o=>{o.target===o.currentTarget&&r(!1)},children:a.jsx(Rle,{dir:"ltr",className:"tlui-dialog__content",children:a.jsx(e,{onClose:()=>r(!1)})})})})})};function Lle(){const{dialogs:n}=Jl();return n.map(e=>a.jsx(Dle,{...e},e.id))}const Fle=Oe.memo(Lle);function Ble(){const n=G(),e=q("follow",()=>n.getInstanceState().followingUserId,[n]);return e?a.jsx(Ule,{userId:e}):null}function Ule({userId:n}){const e=ex(n);return e?a.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}function vx(n){const e=n+"CollectionProvider",[t,s]=Fr(e),[i,r]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=m=>{const{scope:x,children:y}=m,S=Oe.useRef(null),v=Oe.useRef(new Map).current;return a.jsx(i,{scope:x,itemMap:v,collectionRef:S,children:y})};o.displayName=e;const l=n+"CollectionSlot",c=Cd(l),d=Oe.forwardRef((m,x)=>{const{scope:y,children:S}=m,v=r(l,y),C=dt(x,v.collectionRef);return a.jsx(c,{ref:C,children:S})});d.displayName=l;const u=n+"CollectionItemSlot",h="data-radix-collection-item",p=Cd(u),f=Oe.forwardRef((m,x)=>{const{scope:y,children:S,...v}=m,C=Oe.useRef(null),T=dt(x,C),I=r(u,y);return Oe.useEffect(()=>(I.itemMap.set(C,{ref:C,...v}),()=>void I.itemMap.delete(C))),a.jsx(p,{[h]:"",ref:T,children:S})});f.displayName=u;function g(m){const x=r(n+"CollectionConsumer",m);return Oe.useCallback(()=>{const S=x.collectionRef.current;if(!S)return[];const v=Array.from(S.querySelectorAll(`[${h}]`));return Array.from(x.itemMap.values()).sort((I,E)=>v.indexOf(I.ref.current)-v.indexOf(E.ref.current))},[x.collectionRef,x.itemMap])}return[{Provider:o,Slot:d,ItemSlot:f},g,s]}var $le=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),zle="VisuallyHidden",E1=b.forwardRef((n,e)=>a.jsx(Ge.span,{...n,ref:e,style:{...$le,...n.style}}));E1.displayName=zle;var T1="ToastProvider",[I1,Wle,Hle]=vx("Toast"),[hB]=Fr("Toast",[Hle]),[Gle,xx]=hB(T1),pB=n=>{const{__scopeToast:e,label:t="Notification",duration:s=5e3,swipeDirection:i="right",swipeThreshold:r=50,children:o}=n,[l,c]=b.useState(null),[d,u]=b.useState(0),h=b.useRef(!1),p=b.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${T1}\`. Expected non-empty \`string\`.`),a.jsx(I1.Provider,{scope:e,children:a.jsx(Gle,{scope:e,label:t,duration:s,swipeDirection:i,swipeThreshold:r,toastCount:d,viewport:l,onViewportChange:c,onToastAdd:b.useCallback(()=>u(f=>f+1),[]),onToastRemove:b.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:h,isClosePausedRef:p,children:o})})};pB.displayName=T1;var fB="ToastViewport",Vle=["F8"],y_="toast.viewportPause",v_="toast.viewportResume",gB=b.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:s=Vle,label:i="Notifications ({hotkey})",...r}=n,o=xx(fB,t),l=Wle(t),c=b.useRef(null),d=b.useRef(null),u=b.useRef(null),h=b.useRef(null),p=dt(e,h,o.onViewportChange),f=s.join("+").replace(/Key/g,"").replace(/Digit/g,""),g=o.toastCount>0;b.useEffect(()=>{const x=y=>{var v;s.length!==0&&s.every(C=>y[C]||y.code===C)&&((v=h.current)==null||v.focus())};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[s]),b.useEffect(()=>{const x=c.current,y=h.current;if(g&&x&&y){const S=()=>{if(!o.isClosePausedRef.current){const I=new CustomEvent(y_);y.dispatchEvent(I),o.isClosePausedRef.current=!0}},v=()=>{if(o.isClosePausedRef.current){const I=new CustomEvent(v_);y.dispatchEvent(I),o.isClosePausedRef.current=!1}},C=I=>{!x.contains(I.relatedTarget)&&v()},T=()=>{x.contains(document.activeElement)||v()};return x.addEventListener("focusin",S),x.addEventListener("focusout",C),x.addEventListener("pointermove",S),x.addEventListener("pointerleave",T),window.addEventListener("blur",S),window.addEventListener("focus",v),()=>{x.removeEventListener("focusin",S),x.removeEventListener("focusout",C),x.removeEventListener("pointermove",S),x.removeEventListener("pointerleave",T),window.removeEventListener("blur",S),window.removeEventListener("focus",v)}}},[g,o.isClosePausedRef]);const m=b.useCallback(({tabbingDirection:x})=>{const S=l().map(v=>{const C=v.ref.current,T=[C,...rce(C)];return x==="forwards"?T:T.reverse()});return(x==="forwards"?S.reverse():S).flat()},[l]);return b.useEffect(()=>{const x=h.current;if(x){const y=S=>{var T,I,E;const v=S.altKey||S.ctrlKey||S.metaKey;if(S.key==="Tab"&&!v){const P=document.activeElement,k=S.shiftKey;if(S.target===x&&k){(T=d.current)==null||T.focus();return}const R=m({tabbingDirection:k?"backwards":"forwards"}),A=R.findIndex(N=>N===P);Ow(R.slice(A+1))?S.preventDefault():k?(I=d.current)==null||I.focus():(E=u.current)==null||E.focus()}};return x.addEventListener("keydown",y),()=>x.removeEventListener("keydown",y)}},[l,m]),a.jsxs(bae,{ref:c,role:"region","aria-label":i.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:g?void 0:"none"},children:[g&&a.jsx(x_,{ref:d,onFocusFromOutsideViewport:()=>{const x=m({tabbingDirection:"forwards"});Ow(x)}}),a.jsx(I1.Slot,{scope:t,children:a.jsx(Ge.ol,{tabIndex:-1,...r,ref:p})}),g&&a.jsx(x_,{ref:u,onFocusFromOutsideViewport:()=>{const x=m({tabbingDirection:"backwards"});Ow(x)}})]})});gB.displayName=fB;var mB="ToastFocusProxy",x_=b.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:s,...i}=n,r=xx(mB,t);return a.jsx(E1,{tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:o=>{var d;const l=o.relatedTarget;!((d=r.viewport)!=null&&d.contains(l))&&s()}})});x_.displayName=mB;var Kp="Toast",Kle="toast.swipeStart",Yle="toast.swipeMove",Xle="toast.swipeCancel",qle="toast.swipeEnd",yB=b.forwardRef((n,e)=>{const{forceMount:t,open:s,defaultOpen:i,onOpenChange:r,...o}=n,[l,c]=Wa({prop:s,defaultProp:i??!0,onChange:r,caller:Kp});return a.jsx(Qi,{present:t||l,children:a.jsx(Qle,{open:l,...o,ref:e,onClose:()=>c(!1),onPause:os(n.onPause),onResume:os(n.onResume),onSwipeStart:me(n.onSwipeStart,d=>{d.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:me(n.onSwipeMove,d=>{const{x:u,y:h}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","move"),d.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${h}px`)}),onSwipeCancel:me(n.onSwipeCancel,d=>{d.currentTarget.setAttribute("data-swipe","cancel"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:me(n.onSwipeEnd,d=>{const{x:u,y:h}=d.detail.delta;d.currentTarget.setAttribute("data-swipe","end"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),d.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),d.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),d.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${h}px`),c(!1)})})})});yB.displayName=Kp;var[Zle,Jle]=hB(Kp,{onClose(){}}),Qle=b.forwardRef((n,e)=>{const{__scopeToast:t,type:s="foreground",duration:i,open:r,onClose:o,onEscapeKeyDown:l,onPause:c,onResume:d,onSwipeStart:u,onSwipeMove:h,onSwipeCancel:p,onSwipeEnd:f,...g}=n,m=xx(Kp,t),[x,y]=b.useState(null),S=dt(e,N=>y(N)),v=b.useRef(null),C=b.useRef(null),T=i||m.duration,I=b.useRef(0),E=b.useRef(T),P=b.useRef(0),{onToastAdd:k,onToastRemove:j}=m,D=os(()=>{var B;(x==null?void 0:x.contains(document.activeElement))&&((B=m.viewport)==null||B.focus()),o()}),R=b.useCallback(N=>{!N||N===1/0||(window.clearTimeout(P.current),I.current=new Date().getTime(),P.current=window.setTimeout(D,N))},[D]);b.useEffect(()=>{const N=m.viewport;if(N){const B=()=>{R(E.current),d==null||d()},L=()=>{const O=new Date().getTime()-I.current;E.current=E.current-O,window.clearTimeout(P.current),c==null||c()};return N.addEventListener(y_,L),N.addEventListener(v_,B),()=>{N.removeEventListener(y_,L),N.removeEventListener(v_,B)}}},[m.viewport,T,c,d,R]),b.useEffect(()=>{r&&!m.isClosePausedRef.current&&R(T)},[r,T,m.isClosePausedRef,R]),b.useEffect(()=>(k(),()=>j()),[k,j]);const A=b.useMemo(()=>x?CB(x):null,[x]);return m.viewport?a.jsxs(a.Fragment,{children:[A&&a.jsx(ece,{__scopeToast:t,role:"status","aria-live":s==="foreground"?"assertive":"polite",children:A}),a.jsx(Zle,{scope:t,onClose:D,children:kr.createPortal(a.jsx(I1.ItemSlot,{scope:t,children:a.jsx(wae,{asChild:!0,onEscapeKeyDown:me(l,()=>{m.isFocusedToastEscapeKeyDownRef.current||D(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:a.jsx(Ge.li,{tabIndex:0,"data-state":r?"open":"closed","data-swipe-direction":m.swipeDirection,...g,ref:S,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:me(n.onKeyDown,N=>{N.key==="Escape"&&(l==null||l(N.nativeEvent),N.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,D()))}),onPointerDown:me(n.onPointerDown,N=>{N.button===0&&(v.current={x:N.clientX,y:N.clientY})}),onPointerMove:me(n.onPointerMove,N=>{if(!v.current)return;const B=N.clientX-v.current.x,L=N.clientY-v.current.y,O=!!C.current,F=["left","right"].includes(m.swipeDirection),W=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,$=F?W(0,B):0,K=F?0:W(0,L),Y=N.pointerType==="touch"?10:2,U={x:$,y:K},J={originalEvent:N,delta:U};O?(C.current=U,yg(Yle,h,J,{discrete:!1})):Pj(U,m.swipeDirection,Y)?(C.current=U,yg(Kle,u,J,{discrete:!1}),N.target.setPointerCapture(N.pointerId)):(Math.abs(B)>Y||Math.abs(L)>Y)&&(v.current=null)}),onPointerUp:me(n.onPointerUp,N=>{const B=C.current,L=N.target;if(L.hasPointerCapture(N.pointerId)&&L.releasePointerCapture(N.pointerId),C.current=null,v.current=null,B){const O=N.currentTarget,F={originalEvent:N,delta:B};Pj(B,m.swipeDirection,m.swipeThreshold)?yg(qle,f,F,{discrete:!0}):yg(Xle,p,F,{discrete:!0}),O.addEventListener("click",W=>W.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),ece=n=>{const{__scopeToast:e,children:t,...s}=n,i=xx(Kp,e),[r,o]=b.useState(!1),[l,c]=b.useState(!1);return sce(()=>o(!0)),b.useEffect(()=>{const d=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(d)},[]),l?null:a.jsx(Gp,{asChild:!0,children:a.jsx(E1,{...s,children:r&&a.jsxs(a.Fragment,{children:[i.label," ",t]})})})},tce="ToastTitle",vB=b.forwardRef((n,e)=>{const{__scopeToast:t,...s}=n;return a.jsx(Ge.div,{...s,ref:e})});vB.displayName=tce;var nce="ToastDescription",xB=b.forwardRef((n,e)=>{const{__scopeToast:t,...s}=n;return a.jsx(Ge.div,{...s,ref:e})});xB.displayName=nce;var SB="ToastAction",wB=b.forwardRef((n,e)=>{const{altText:t,...s}=n;return t.trim()?a.jsx(_B,{altText:t,asChild:!0,children:a.jsx(P1,{...s,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${SB}\`. Expected non-empty \`string\`.`),null)});wB.displayName=SB;var bB="ToastClose",P1=b.forwardRef((n,e)=>{const{__scopeToast:t,...s}=n,i=Jle(bB,t);return a.jsx(_B,{asChild:!0,children:a.jsx(Ge.button,{type:"button",...s,ref:e,onClick:me(n.onClick,i.onClose)})})});P1.displayName=bB;var _B=b.forwardRef((n,e)=>{const{__scopeToast:t,altText:s,...i}=n;return a.jsx(Ge.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":s||void 0,...i,ref:e})});function CB(n){const e=[];return Array.from(n.childNodes).forEach(s=>{if(s.nodeType===s.TEXT_NODE&&s.textContent&&e.push(s.textContent),ice(s)){const i=s.ariaHidden||s.hidden||s.style.display==="none",r=s.dataset.radixToastAnnounceExclude==="";if(!i)if(r){const o=s.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...CB(s))}}),e}function yg(n,e,t,{discrete:s}){const i=t.originalEvent.currentTarget,r=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),s?x1(i,r):i.dispatchEvent(r)}var Pj=(n,e,t=0)=>{const s=Math.abs(n.x),i=Math.abs(n.y),r=s>i;return e==="left"||e==="right"?r&&s>t:!r&&i>t};function sce(n=()=>{}){const e=os(n);bo(()=>{let t=0,s=0;return t=window.requestAnimationFrame(()=>s=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(s)}},[e])}function ice(n){return n.nodeType===n.ELEMENT_NODE}function rce(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const i=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||i?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function Ow(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var oce=yB,ace=vB,lce=xB,cce=wB,kj=P1;const EB=b.createContext(null);function dce({children:n}){const[e,t]=b.useState([]),s=b.useCallback(o=>{const l=o.id??Rt();return t(c=>[...c.filter(d=>d.id!==o.id),{...o,id:l}]),l},[]),i=b.useCallback(o=>(t(l=>l.filter(c=>c.id!==o)),o),[]),r=b.useCallback(()=>{t(()=>[])},[]);return a.jsx(pB,{children:a.jsx(EB.Provider,{value:{toasts:e,addToast:s,removeToast:i,clearToasts:r},children:n})})}function tr(){const n=b.useContext(EB);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}const we=b.forwardRef(function({children:e,disabled:t,type:s,...i},r){return a.jsx("button",{ref:r,type:"button",draggable:!1,disabled:t,...i,className:Se("tlui-button",`tlui-button__${s}`,i.className),children:e})});function Vt({children:n}){return a.jsx("span",{className:"tlui-button__label",children:n})}const Mr=b.memo(function({small:e,invertIcon:t,icon:s,color:i,className:r,...o}){const l=m1(),c=l.icons[s]??l.icons["question-mark-circle"],d=b.useRef(null);return b.useLayoutEffect(()=>{c||console.error(`Icon not found: ${s}. Add it to the assetUrls.icons object.`),d!=null&&d.current&&(d.current.style.webkitMask=`url(${c}) center 100% / 100% no-repeat`)},[d,c,s]),s==="none"?a.jsx("div",{className:Se("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},r)}):a.jsx("div",{...o,ref:d,className:Se("tlui-icon",{"tlui-icon__small":e},r),style:{color:i,mask:`url(${c}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})}),uce={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function hce({toast:n}){const{removeToast:e}=tr(),t=Fe(),s=o=>{o||e(n.id)},i=n.actions&&n.actions.length>0,r=n.icon||n.severity&&uce[n.severity];return a.jsxs(oce,{onOpenChange:s,className:"tlui-toast__container",duration:n.keepOpen?1/0:5e3,"data-severity":n.severity,children:[r&&a.jsx("div",{className:"tlui-toast__icon",children:a.jsx(Mr,{icon:r})}),a.jsxs("div",{className:"tlui-toast__main",children:[a.jsxs("div",{className:"tlui-toast__content",children:[n.title&&a.jsx(ace,{className:"tlui-toast__title",children:n.title}),n.description&&a.jsx(lce,{className:"tlui-toast__description",children:n.description})]}),n.actions&&a.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((o,l)=>a.jsx(cce,{altText:o.label,asChild:!0,onClick:o.onClick,children:a.jsx(we,{type:o.type,children:a.jsx(Vt,{children:o.label})})},l)),a.jsx(kj,{asChild:!0,children:a.jsx(we,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:a.jsx(Vt,{children:n.closeLabel??t("toast.close")})})})]})]}),!i&&a.jsx(kj,{asChild:!0,children:a.jsx(we,{type:"normal",className:"tlui-toast__close",children:a.jsx(Vt,{children:n.closeLabel??t("toast.close")})})})]})}function pce(){const{toasts:n}=tr();return n.map(e=>a.jsx(hce,{toast:e},e.id))}const fce=b.memo(pce);function gce(){const n=G(),{toasts:e}=tr(),[t,s]=b.useState(!1);return b.useEffect(()=>{let i=-1;return e.length?s(!0):i=n.timers.setTimeout(()=>{s(!1)},1e3),()=>{clearTimeout(i)}},[e.length,s,n]),t?a.jsx(gB,{className:"tlui-toast__viewport"}):null}function De({icon:n,small:e,invertIcon:t}){return a.jsx(Mr,{className:"tlui-button__icon",icon:n,small:e,invertIcon:t})}const Dw=[0,390,428,468,580,640,840,1023];var zt=(n=>(n[n.ZERO=0]="ZERO",n[n.MOBILE_XXS=1]="MOBILE_XXS",n[n.MOBILE_XS=2]="MOBILE_XS",n[n.MOBILE_SM=3]="MOBILE_SM",n[n.MOBILE=4]="MOBILE",n[n.TABLET_SM=5]="TABLET_SM",n[n.TABLET=6]="TABLET",n[n.DESKTOP=7]="DESKTOP",n))(zt||{});let S_={fonts:{draw:`${la()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${la()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${la()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${la()}/fonts/IBMPlexMono-Medium.woff2`}};function TB(n){return b.useMemo(()=>n?{fonts:{...S_.fonts,...n==null?void 0:n.fonts}}:S_,[n])}const mce=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let Pu={...S_,icons:Object.fromEntries(mce.map(n=>[n,`${la()}/icons/icon/${n}.svg`])),translations:Object.fromEntries(sp.map(n=>[n.locale,`${la()}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(Op.map(n=>[n.type,`${la()}/embed-icons/${n.type}.png`]))};function yce(n){return n?{fonts:Object.assign({...Pu.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...Pu.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...Pu.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...Pu.translations},{...n==null?void 0:n.translations})}:Pu}function Sx({className:n,children:e}){return a.jsx("div",{className:Se("tlui-dialog__header",n),children:e})}function wx({className:n,children:e}){return a.jsx(sB,{dir:"ltr",className:Se("tlui-dialog__header__title",n),children:e})}function bx(){return a.jsx("div",{className:"tlui-dialog__header__close",children:a.jsx(oB,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:a.jsx(we,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:a.jsx(De,{small:!0,icon:"cross-2"})})})})}function rp({className:n,children:e,style:t}){return a.jsx("div",{className:Se("tlui-dialog__body",n),style:t,children:e})}function k1({className:n,children:e}){return a.jsx("div",{className:Se("tlui-dialog__footer",n),children:e})}const _x=b.forwardRef(function({className:e,label:t,icon:s,iconLeft:i,autoSelect:r=!1,autoFocus:o=!1,defaultValue:l,placeholder:c,onComplete:d,onValueChange:u,onCancel:h,onFocus:p,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:g=!1,children:m,value:x},y){const S=G(),v=b.useRef(null);b.useImperativeHandle(y,()=>v.current);const C=Fe(),T=b.useRef(l??""),I=b.useRef(l??""),[E,P]=b.useState(!1),k=b.useCallback(A=>{P(!0);const N=A.currentTarget;I.current=N.value,S.timers.requestAnimationFrame(()=>{r&&N.select()}),p==null||p()},[r,p,S.timers]),j=b.useCallback(A=>{const N=A.currentTarget.value;I.current=N,u==null||u(N)},[u]),D=b.useCallback(A=>{switch(A.key){case"Enter":{A.currentTarget.blur(),un(A),d==null||d(A.currentTarget.value);break}case"Escape":{A.currentTarget.value=T.current,A.currentTarget.blur(),un(A),h==null||h(A.currentTarget.value);break}}},[d,h]),R=b.useCallback(A=>{P(!1);const N=A.currentTarget.value;f==null||f(N)},[f]);return b.useEffect(()=>{if(!S.environment.isIos)return;const A=window.visualViewport;if(E&&g&&A){const N=()=>{var B;(B=v.current)==null||B.scrollIntoView({block:"center"})};return A.addEventListener("resize",N),A.addEventListener("scroll",N),S.timers.requestAnimationFrame(()=>{var B;(B=v.current)==null||B.scrollIntoView({block:"center"})}),()=>{A.removeEventListener("resize",N),A.removeEventListener("scroll",N)}}},[S,E,g]),a.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[m,t&&a.jsx("label",{children:C(t)}),i&&a.jsx(Mr,{icon:i,className:"tlui-icon-left",small:!0}),a.jsx("input",{ref:v,className:Se("tlui-input",e),type:"text",defaultValue:l,onKeyUp:D,onChange:j,onFocus:k,onBlur:R,autoFocus:o,placeholder:c,value:x}),s&&a.jsx(Mr,{icon:s,small:!!t})]})}),IB=pn(function({onClose:e}){const t=G(),s=Fe(),i=m1(),[r,o]=b.useState(null),[l,c]=b.useState(""),[d,u]=b.useState(null),[h,p]=b.useState(!1),f=b.useRef(-1);return a.jsxs(a.Fragment,{children:[a.jsxs(Sx,{children:[a.jsx(wx,{children:r?`${s("embed-dialog.title")}  ${r.title}`:s("embed-dialog.title")}),a.jsx(bx,{})]}),r?a.jsxs(a.Fragment,{children:[a.jsxs(rp,{className:"tlui-embed-dialog__enter",children:[a.jsx(_x,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autoFocus:!0,onValueChange:g=>{c(g);const m=da(g);u(m&&m.definition.type===r.type?m:null),p(!1),clearTimeout(f.current),f.current=t.timers.setTimeout(()=>p(!m),320)}}),l===""?a.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[a.jsx("span",{children:s("embed-dialog.instruction")})," ",r.instructionLink&&a.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:r.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",a.jsx(Mr,{icon:"external-link",small:!0})]})]}):a.jsx("div",{className:"tlui-embed-dialog__warning",children:h?s("embed-dialog.invalid-url"):""})]}),a.jsxs(k1,{className:"tlui-dialog__footer__actions",children:[a.jsx(we,{type:"normal",onClick:()=>{o(null),u(null),c("")},children:a.jsx(Vt,{children:s("embed-dialog.back")})}),a.jsx("div",{className:"tlui-embed__spacer"}),a.jsx(we,{type:"normal",onClick:e,children:a.jsx(Vt,{children:s("embed-dialog.cancel")})}),a.jsx(we,{type:"primary",disabled:!d,onClick:()=>{d&&(t.putExternalContent({type:"embed",url:l,point:t.getViewportPageBounds().center,embed:d.definition}),e())},children:a.jsx(Vt,{children:s("embed-dialog.create")})})]})]}):a.jsx(a.Fragment,{children:a.jsx(rp,{className:"tlui-embed-dialog__list",children:Op.map(g=>a.jsxs(we,{type:"menu",onClick:()=>o(g),children:[a.jsx(Vt,{children:g.title}),a.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${i.embedIcons[g.type]})`}})]},g.type))})})]})});function PB(){const n=G(),e=b.useRef();return b.useEffect(()=>{const t=window.document.createElement("input");t.type="file",t.accept=_Z,t.multiple=!0,e.current=t;async function s(i){const r=i.target.files;!r||r.length===0||(n.mark("insert media"),await n.putExternalContent({type:"files",files:Array.from(r),point:n.getViewportPageBounds().center,ignoreParent:!1}),t.value="")}return t.addEventListener("change",s),()=>{e.current=void 0,t.removeEventListener("change",s)}},[n]),b.useCallback(()=>{var t;(t=e.current)==null||t.click()},[e])}const kB=b.createContext(null);function vce({overrides:n,children:e}){const t=G(),s=An(),{addDialog:i}=Jl(),r=PB(),o=b.useMemo(()=>{const l=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(d){t.setCurrentTool("select"),s("select-tool",{source:d,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(d){t.setCurrentTool("hand"),s("select-tool",{source:d,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(d){t.setCurrentTool("eraser"),s("select-tool",{source:d,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(d){t.setCurrentTool("draw"),s("select-tool",{source:d,id:"draw"})}},...[...mi.values].map(d=>({id:d,label:`tool.${d}`,meta:{geo:d},kbd:d==="rectangle"?"r":d==="ellipse"?"o":void 0,icon:"geo-"+d,onSelect(u){t.run(()=>{t.setStyleForNextShapes(mi,d),t.setCurrentTool("geo"),s("select-tool",{source:u,id:`geo-${d}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(d){t.setCurrentTool("arrow"),s("select-tool",{source:d,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(d){t.setCurrentTool("line"),s("select-tool",{source:d,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(d){t.setCurrentTool("frame"),s("select-tool",{source:d,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(d){t.setCurrentTool("text"),s("select-tool",{source:d,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(d){r(),s("select-tool",{source:d,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(d){t.setCurrentTool("note"),s("select-tool",{source:d,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(d){t.setCurrentTool("laser"),s("select-tool",{source:d,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(d){i({component:IB}),s("select-tool",{source:d,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(d){t.setCurrentTool("highlight"),s("select-tool",{source:d,id:"highlight"})}}];l.push();const c=Object.fromEntries(l.map(d=>[d.id,d]));return n?n(t,c,{insertMedia:r}):c},[n,t,s,r,i]);return a.jsx(kB.Provider,{value:o,children:e})}function Cx(){const n=b.useContext(kB);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}const AB=Oe.createContext(null);function xce({forceMobile:n=!1,children:e}){const t=G(),s=q("breakpoint",()=>{const{width:i}=t.getViewportScreenBounds(),r=n?zt.MOBILE_SM:Dw.length-1;for(let o=0;o<r;o++)if(i>Dw[o]&&i<=Dw[o+1])return o;return r},[t]);return a.jsx(AB.Provider,{value:s,children:e})}function hs(){const n=b.useContext(AB);if(n===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return n}function Sce(){const{addToast:n,removeToast:e,clearToasts:t}=tr(),{addDialog:s,clearDialogs:i,removeDialog:r,updateDialog:o}=Jl(),c=hs()<zt.TABLET_SM,d=Fe();return b.useMemo(()=>({addToast:n,removeToast:e,clearToasts:t,addDialog:s,clearDialogs:i,removeDialog:r,updateDialog:o,msg:d,isMobile:c}),[s,n,i,t,d,r,e,o,c])}function wce(n,e){const t={};for(const s of n)if(s.translations)for(const[i,r]of Rs(s.translations)){let o=t[i];o||(o=t[i]={}),Object.assign(o,r)}return{actions:(s,i)=>{for(const r of n)r.actions&&(i=r.actions(s,i,e));return i},tools:(s,i,r)=>{for(const o of n)o.tools&&(i=o.tools(s,i,{...e,...r}));return i},translations:t}}function jB(n){return b.useMemo(()=>n,n)}function bce(n){const e=jB(n==null?[]:Array.isArray(n)?n:[n]);return b.useMemo(()=>{const t={};for(const s of e)if(s.translations)for(const[i,r]of Rs(s.translations)){let o=t[i];o||(o=t[i]={}),Object.assign(o,r)}return t},[e])}function _ce(n){const e=Sce(),t=jB(n==null?[]:Array.isArray(n)?n:[n]);return b.useMemo(()=>wce(t,e),[t,e])}function Cce(n,e){const t=Ne(e.map(i=>n.getShape(i)).filter(i=>i&&n.isShapeOfType(i,"frame")));if(!t.length)return;const s=[];n.run(()=>{t.map(i=>{const r=n.getSortedChildIdsForParent(i.id);r.length&&(n.reparentShapes(r,i.parentId,i.index),s.push(...r))}),n.setSelectedShapes(s),n.deleteShapes(e)})}const Ece=50;function Tce(n,e,t={}){const s=n.getShape(e);if(!s)return;const i=n.getSortedChildIdsForParent(s.id),r=Ne(i.map(f=>n.getShape(f)));if(!r.length)return;const o=ue.FromPoints(r.flatMap(f=>{const g=n.getShapeGeometry(f.id);return n.getShapeLocalTransform(f).applyToPoints(g.vertices)})),{padding:l=Ece}=t,c=o.w+2*l,d=o.h+2*l,u=l-o.minX,h=l-o.minY;if(u===0&&h===0&&s.props.w===c&&s.props.h===d)return;const p=new _(u,h).rot(s.rotation);n.run(()=>{const f=i.map(g=>{const m=n.getShape(g);return{id:m.id,type:m.type,x:m.x+u,y:m.y+h}});f.push({id:s.id,type:s.type,x:s.x-p.x,y:s.y-p.y,props:{w:c,h:d}}),n.updateShapes(f)})}function Aj(n){return Qs.isValid(n)?{isValid:!0,hasProtocol:!0}:Qs.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const Ice=pn(function({onClose:e}){const s=G().getOnlySelectedShape();return s&&"url"in s.props&&typeof s.props.url=="string"?a.jsx(Pce,{onClose:e,selectedShape:s}):null}),Pce=pn(function({onClose:e,selectedShape:t}){const s=G(),i=Fe(),r=b.useRef(null);b.useEffect(()=>{s.timers.requestAnimationFrame(()=>{var g;return(g=r.current)==null?void 0:g.focus()})},[s]);const o=b.useRef(t.props.url),[l,c]=b.useState(()=>{const g=Aj(t.props.url),m=g.isValid===!0?g.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:m,safe:m,valid:!0}}),d=b.useCallback(g=>{const m=g.replace(/https?:\/\/(https?:\/\/)/,(S,v)=>v),x=Aj(m),y=x.isValid===!0?x.hasProtocol?m:"https://"+m:"https://";c({actual:m,safe:y,valid:x.isValid})},[]),u=b.useCallback(()=>{const g=s.getOnlySelectedShape();g&&(s.updateShapes([{id:g.id,type:g.type,props:{url:""}}]),e())},[s,e]),h=b.useCallback(()=>{const g=s.getOnlySelectedShape();g&&(g&&"url"in g.props&&g.props.url!==l.safe&&s.updateShapes([{id:g.id,type:g.type,props:{url:l.safe}}]),e())},[s,e,l]),p=b.useCallback(()=>{e()},[e]);if(!t)return e(),null;const f=o.current&&!l.valid;return a.jsxs(a.Fragment,{children:[a.jsxs(Sx,{children:[a.jsx(wx,{children:i("edit-link-dialog.title")}),a.jsx(bx,{})]}),a.jsx(rp,{children:a.jsxs("div",{className:"tlui-edit-link-dialog",children:[a.jsx(_x,{ref:r,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:l.actual,onValueChange:d,onComplete:h,onCancel:p}),a.jsx("div",{children:l.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),a.jsxs(k1,{className:"tlui-dialog__footer__actions",children:[a.jsx(we,{type:"normal",onClick:p,onTouchEnd:p,children:a.jsx(Vt,{children:i("edit-link-dialog.cancel")})}),f?a.jsx(we,{type:"danger",onTouchEnd:u,onClick:u,children:a.jsx(Vt,{children:i("edit-link-dialog.clear")})}):a.jsx(we,{type:"primary",disabled:!l.valid,onTouchEnd:h,onClick:h,children:a.jsx(Vt,{children:i("edit-link-dialog.save")})})]})]})});var NB={exports:{}};(function(n){var e=function(){var t=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function o(c,d){if(!r[c]){r[c]={};for(var u=0;u<c.length;u++)r[c][c.charAt(u)]=u}return r[c][d]}var l={compressToBase64:function(c){if(c==null)return"";var d=l._compress(c,6,function(u){return s.charAt(u)});switch(d.length%4){default:case 0:return d;case 1:return d+"===";case 2:return d+"==";case 3:return d+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:l._decompress(c.length,32,function(d){return o(s,c.charAt(d))})},compressToUTF16:function(c){return c==null?"":l._compress(c,15,function(d){return t(d+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:l._decompress(c.length,16384,function(d){return c.charCodeAt(d)-32})},compressToUint8Array:function(c){for(var d=l.compress(c),u=new Uint8Array(d.length*2),h=0,p=d.length;h<p;h++){var f=d.charCodeAt(h);u[h*2]=f>>>8,u[h*2+1]=f%256}return u},decompressFromUint8Array:function(c){if(c==null)return l.decompress(c);for(var d=new Array(c.length/2),u=0,h=d.length;u<h;u++)d[u]=c[u*2]*256+c[u*2+1];var p=[];return d.forEach(function(f){p.push(t(f))}),l.decompress(p.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":l._compress(c,6,function(d){return i.charAt(d)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),l._decompress(c.length,32,function(d){return o(i,c.charAt(d))}))},compress:function(c){return l._compress(c,16,function(d){return t(d)})},_compress:function(c,d,u){if(c==null)return"";var h,p,f={},g={},m="",x="",y="",S=2,v=3,C=2,T=[],I=0,E=0,P;for(P=0;P<c.length;P+=1)if(m=c.charAt(P),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=v++,g[m]=!0),x=y+m,Object.prototype.hasOwnProperty.call(f,x))y=x;else{if(Object.prototype.hasOwnProperty.call(g,y)){if(y.charCodeAt(0)<256){for(h=0;h<C;h++)I=I<<1,E==d-1?(E=0,T.push(u(I)),I=0):E++;for(p=y.charCodeAt(0),h=0;h<8;h++)I=I<<1|p&1,E==d-1?(E=0,T.push(u(I)),I=0):E++,p=p>>1}else{for(p=1,h=0;h<C;h++)I=I<<1|p,E==d-1?(E=0,T.push(u(I)),I=0):E++,p=0;for(p=y.charCodeAt(0),h=0;h<16;h++)I=I<<1|p&1,E==d-1?(E=0,T.push(u(I)),I=0):E++,p=p>>1}S--,S==0&&(S=Math.pow(2,C),C++),delete g[y]}else for(p=f[y],h=0;h<C;h++)I=I<<1|p&1,E==d-1?(E=0,T.push(u(I)),I=0):E++,p=p>>1;S--,S==0&&(S=Math.pow(2,C),C++),f[x]=v++,y=String(m)}if(y!==""){if(Object.prototype.hasOwnProperty.call(g,y)){if(y.charCodeAt(0)<256){for(h=0;h<C;h++)I=I<<1,E==d-1?(E=0,T.push(u(I)),I=0):E++;for(p=y.charCodeAt(0),h=0;h<8;h++)I=I<<1|p&1,E==d-1?(E=0,T.push(u(I)),I=0):E++,p=p>>1}else{for(p=1,h=0;h<C;h++)I=I<<1|p,E==d-1?(E=0,T.push(u(I)),I=0):E++,p=0;for(p=y.charCodeAt(0),h=0;h<16;h++)I=I<<1|p&1,E==d-1?(E=0,T.push(u(I)),I=0):E++,p=p>>1}S--,S==0&&(S=Math.pow(2,C),C++),delete g[y]}else for(p=f[y],h=0;h<C;h++)I=I<<1|p&1,E==d-1?(E=0,T.push(u(I)),I=0):E++,p=p>>1;S--,S==0&&(S=Math.pow(2,C),C++)}for(p=2,h=0;h<C;h++)I=I<<1|p&1,E==d-1?(E=0,T.push(u(I)),I=0):E++,p=p>>1;for(;;)if(I=I<<1,E==d-1){T.push(u(I));break}else E++;return T.join("")},decompress:function(c){return c==null?"":c==""?null:l._decompress(c.length,32768,function(d){return c.charCodeAt(d)})},_decompress:function(c,d,u){var h=[],p=4,f=4,g=3,m="",x=[],y,S,v,C,T,I,E,P={val:u(0),position:d,index:1};for(y=0;y<3;y+=1)h[y]=y;for(v=0,T=Math.pow(2,2),I=1;I!=T;)C=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),v|=(C>0?1:0)*I,I<<=1;switch(v){case 0:for(v=0,T=Math.pow(2,8),I=1;I!=T;)C=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),v|=(C>0?1:0)*I,I<<=1;E=t(v);break;case 1:for(v=0,T=Math.pow(2,16),I=1;I!=T;)C=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),v|=(C>0?1:0)*I,I<<=1;E=t(v);break;case 2:return""}for(h[3]=E,S=E,x.push(E);;){if(P.index>c)return"";for(v=0,T=Math.pow(2,g),I=1;I!=T;)C=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),v|=(C>0?1:0)*I,I<<=1;switch(E=v){case 0:for(v=0,T=Math.pow(2,8),I=1;I!=T;)C=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),v|=(C>0?1:0)*I,I<<=1;h[f++]=t(v),E=f-1,p--;break;case 1:for(v=0,T=Math.pow(2,16),I=1;I!=T;)C=P.val&P.position,P.position>>=1,P.position==0&&(P.position=d,P.val=u(P.index++)),v|=(C>0?1:0)*I,I<<=1;h[f++]=t(v),E=f-1,p--;break;case 2:return x.join("")}if(p==0&&(p=Math.pow(2,g),g++),h[E])m=h[E];else if(E===f)m=S+S.charAt(0);else return null;x.push(m),h[f++]=S+m.charAt(0),p--,S=m,p==0&&(p=Math.pow(2,g),g++)}}};return l}();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(NB);var kce=NB.exports;const RB=Oa(kce);async function Ace(n,e,t){var y,S,v;const{elements:s,files:i}=e,r={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},o=new Map,l=new Map,c=n.getCurrentPageId(),d=new Map,u=[],h=new Set;s.forEach(C=>{if(d.set(C.id,st()),C.boundElements!==null)for(const T of C.boundElements)T.type==="text"&&h.add(T.id)});let p=wD;for(const C of s){if(h.has(C.id))continue;const T=d.get(C.id),I={id:T,typeName:"shape",parentId:c,index:p,x:C.x,y:C.y,rotation:0,isLocked:C.locked,opacity:jce(C.opacity),meta:{}};switch(C.angle!==0&&l.set(T,C.angle),C.groupIds&&C.groupIds.length>0?o.has(C.groupIds[0])?(y=o.get(C.groupIds[0]))==null||y.push(T):o.set(C.groupIds[0],[T]):u.push(T),C.type){case"rectangle":case"ellipse":case"diamond":{let E="",P="middle";if(C.boundElements!==null){for(const j of C.boundElements)if(j.type==="text"){const D=s.find(R=>R.id===j.id);D&&(E=D.text,P=Lce[D.textAlign])}}const k=C.backgroundColor==="transparent"?C.strokeColor:C.backgroundColor;r.shapes.push({...I,type:"geo",props:{geo:C.type,url:C.link??"",w:C.width,h:C.height,size:vg[C.strokeWidth]??"draw",color:ku[k]??"black",text:E,align:P,dash:xg(C),fill:Uce(C)}});break}case"freedraw":{r.shapes.push({...I,type:"draw",props:{dash:xg(C),size:vg[C.strokeWidth],color:ku[C.strokeColor]??"black",segments:[{type:"free",points:C.points.map(([E,P,k=.5])=>({x:E,y:P,z:k}))}]}});break}case"line":{if(C.points.slice().length<2)break;const P=tp(C.points.length);r.shapes.push({...I,type:"line",props:{dash:xg(C),size:vg[C.strokeWidth],color:ku[C.strokeColor]??"black",spline:C.roundness?"cubic":"line",points:{...Object.fromEntries(C.points.map(([k,j],D)=>{const R=P[D];return[R,{id:R,index:R,x:k,y:j}]}))}}});break}case"arrow":{let E="";if(C.boundElements!==null){for(const R of C.boundElements)if(R.type==="text"){const A=s.find(N=>N.id===R.id);A&&(E=A.text)}}const P=C.points[0],k=C.points[C.points.length-1],j=d.get((S=C.startBinding)==null?void 0:S.elementId),D=d.get((v=C.endBinding)==null?void 0:v.elementId);r.shapes.push({...I,type:"arrow",props:{text:E,bend:Bce(C,P,k),dash:xg(C),size:vg[C.strokeWidth]??"m",color:ku[C.strokeColor]??"black",start:{x:P[0],y:P[1]},end:{x:k[0],y:k[1]},arrowheadEnd:jj[C.endArrowhead]??"none",arrowheadStart:jj[C.startArrowhead]??"none"}}),j&&r.bindings.push({id:bl(),typeName:"binding",type:"arrow",fromId:T,toId:j,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),D&&r.bindings.push({id:bl(),typeName:"binding",type:"arrow",fromId:T,toId:D,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:E,scale:P}=Rce(C.fontSize);r.shapes.push({...I,type:"text",props:{size:E,scale:P,font:Mce[C.fontFamily]??"draw",color:ku[C.strokeColor]??"black",text:C.text,textAlign:Fce[C.textAlign]}});break}case"image":{const E=i[C.fileId];if(!E)break;const P=fl.createId();r.assets.push({id:P,typeName:"asset",type:"image",props:{w:C.width,h:C.height,fileSize:E.size,name:C.id??"Untitled",isAnimated:!1,mimeType:E.mimeType,src:E.dataURL},meta:{}}),r.shapes.push({...I,type:"image",props:{w:C.width,h:C.height,assetId:P}})}}p=Li(p)}const f=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.mark("paste"),n.putContentOntoCurrentPage(r,{point:f,select:!1,preserveIds:!0});for(const C of o.values())if(C.length>1){n.groupShapes(C);const T=n.getShape(C[0]);T!=null&&T.parentId&&Ss(T.parentId)&&u.push(T.parentId)}for(const[C,T]of l)n.select(C),n.rotateShapesBy([C],T);const g=Ne(u.map(C=>n.getShape(C))),m=ue.Common(g.map(C=>n.getShapePageBounds(C))),x=n.getViewportPageBounds().center;n.updateShapes(g.map(C=>{const T={x:(C.x??0)-(m.x+m.w/2),y:(C.y??0)-(m.y+m.h/2)};return{id:C.id,type:C.type,x:x.x+T.x,y:x.y+T.y}})),n.setSelectedShapes(u)}const jce=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},vg={1:"s",2:"m",3:"l",4:"xl"},Nce={16:"s",20:"m",28:"l",36:"xl"};function Rce(n){const e=Nce[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const Mce={1:"draw",2:"sans",3:"mono"},ku={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},Oce={solid:"draw",dashed:"dashed",dotted:"dotted"},Dce={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},Lce={left:"start",center:"middle",right:"end"},Fce={left:"start",center:"middle",right:"end"},jj={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function Bce(n,e,t){let s=0;if(n.points.length>2){const i=new _(e[0],e[1]),r=new _(t[0],t[1]),o=new _(n.points[1][0],n.points[1][1]),l=_.Sub(r,i),c=_.Per(l),d=_.Med(r,i),u=_.Sub(d,c),h=_.Add(d,c),p=_.NearestPointOnLineSegment(u,h,o,!1);s=_.Dist(p,d),_.Clockwise(p,r,d)&&(s*=-1)}return s}const xg=n=>{let e=Oce[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},Uce=n=>n.backgroundColor==="transparent"?"none":Dce[n.fillStyle]??"solid";async function $ce(n,e,t,s){const r=(await Promise.all(e.map(async o=>await(await Ar(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));n.mark("paste"),await n.putExternalContent({type:"files",files:r,point:t,ignoreParent:!1,sources:s}),e.forEach(o=>URL.revokeObjectURL(o))}function zce(n,e,t){const s=n.getSelectionPageBounds();n.mark("paste"),n.putContentOntoCurrentPage(e,{point:t,select:!0});const i=n.getSelectionPageBounds();s&&i&&(s!=null&&s.collides(i))&&(n.updateInstanceState({isChangingStyle:!0}),n.timers.setTimeout(()=>{n.updateInstanceState({isChangingStyle:!1})},150))}async function w_(n,e,t,s){return n.mark("paste"),await n.putExternalContent({type:"url",point:t,url:e,sources:s})}function Wce(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const Hce=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},Gce=n=>{const e=n.split(/[\n\s]/);for(const t of e)try{const s=new URL(t);if(!(s.protocol==="http:"||s.protocol==="https:"))return}catch{return}return FL(e)},Vce=n=>/^<svg/.test(n),Kce=["input","select","textarea"];function Lw(n){const{activeElement:e}=document;return n.getIsMenuOpen()||e&&(e.getAttribute("contenteditable")||Kce.indexOf(e.tagName.toLowerCase())>-1)}const Yce=n=>n.types.find(e=>e.match(/^image\//)),Fw=(n,e,t,s)=>{const i=Gce(e);if(i)for(const r of i)w_(n,r,t);else Hce(e)?w_(n,e,t):Vce(e)?(n.mark("paste"),n.putExternalContent({type:"svg-text",text:e,point:t,sources:s})):(n.mark("paste"),n.putExternalContent({type:"text",text:e,point:t,sources:s}))},Xce=async(n,e,t)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const s=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{s.push({type:"file",source:new Promise(r=>r(i.getAsFile()))});break}case"string":{i.type==="text/html"?s.push({type:"html",source:new Promise(r=>i.getAsString(r))}):i.type==="text/plain"?s.push({type:"text",source:new Promise(r=>i.getAsString(r))}):s.push({type:i.type,source:new Promise(r=>i.getAsString(r))});break}}OB(n,s,t)},MB=async(n,e,t)=>{const s=[];for(const i of e){if(Yce(i))for(const r of i.types)r.match(/^image\//)&&s.push({type:"blob",source:i.getType(r)});i.types.includes("text/html")&&s.push({type:"html",source:(async()=>{const r=await i.getType("text/html");return await wl.blobToText(r)})()}),i.types.includes("text/uri-list")&&s.push({type:"url",source:(async()=>{const r=await i.getType("text/uri-list");return await wl.blobToText(r)})()}),i.types.includes("text/plain")&&s.push({type:"text",source:(async()=>{const r=await i.getType("text/plain");return await wl.blobToText(r)})()})}return await OB(n,s,t)};async function OB(n,e,t){const s=e.filter(r=>(r.type==="file"||r.type==="blob")&&r.source!==null);if(s.length){const o=(await Promise.all(s.map(l=>l.source))).filter(Boolean).map(l=>URL.createObjectURL(l));return await $ce(n,o,t)}const i=await Promise.all(e.filter(r=>r.type!=="file").map(r=>new Promise(o=>{const l=r;if(l.type==="file"){o({type:"error",data:null,reason:"unexpected file"});return}l.source.then(c=>{var u;const d=(u=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:u[1];if(d)try{const h=RB.decompressFromBase64(d);if(h===null){o({type:"error",data:h,reason:"found tldraw data comment but could not parse base64"});return}else{const p=JSON.parse(h);if(p.type!=="application/tldraw"&&o({type:"error",data:p,reason:`found tldraw data comment but JSON was of a different type: ${p.type}`}),typeof p.data=="string"){o({type:"error",data:p,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}o({type:"tldraw",data:p.data});return}}catch{o({type:"error",data:d,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(l.type==="html"){o({type:"text",data:c,subtype:"html"});return}if(l.type==="url"){o({type:"text",data:c,subtype:"url"});return}try{const h=JSON.parse(c);if(h.type==="excalidraw/clipboard"){o({type:"excalidraw",data:h});return}else{o({type:"text",data:c,subtype:"json"});return}}catch{o({type:"text",data:c,subtype:"text"});return}}o({type:"error",data:c,reason:"unhandled case"})})})));for(const r of i)if(r.type==="tldraw"){zce(n,r.data,t);return}for(const r of i)if(r.type==="excalidraw"){Ace(n,r.data,t);return}for(const r of i)if(r.type==="text"&&r.subtype==="html"){const l=new DOMParser().parseFromString(r.data,"text/html").querySelector("body");if(l&&Array.from(l.children).filter(d=>d.nodeType===1).length===1&&l.firstElementChild&&l.firstElementChild.tagName==="A"&&l.firstElementChild.hasAttribute("href")&&l.firstElementChild.getAttribute("href")!==""){const d=l.firstElementChild.getAttribute("href");Fw(n,d,t,i);return}if(!i.some(d=>d.type==="text"&&d.subtype!=="html")&&r.data.trim()){Fw(n,Wce(r.data),t,i);return}}for(const r of i)if(r.type==="text"&&r.subtype==="url"){w_(n,r.data,t,i);return}for(const r of i)if(r.type==="text"&&r.subtype==="text"&&r.data.trim()){Fw(n,r.data,t,i);return}}const Wy=async n=>{var s;const e=await n.resolveAssetsInContent(n.getContentFromCurrentPage(n.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=RB.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const i=e.shapes.map(r=>n.isShapeOfType(r,"text")||n.isShapeOfType(r,"geo")||n.isShapeOfType(r,"arrow")?r.props.text:n.isShapeOfType(r,"bookmark")||n.isShapeOfType(r,"embed")?r.props.url:null).filter(RZ);if((s=navigator.clipboard)!=null&&s.write){const r=new Blob([`<div data-tldraw>${t}</div>`],{type:"text/html"});let o=i.join(" ");o===""&&(o=" "),navigator.clipboard.write([new ClipboardItem({"text/html":r,"text/plain":new Blob([o],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${t}</div>`)}};function qce(){const n=G(),e=An(),t=b.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await Wy(n),e("copy",{source:o}))},[n,e]),s=b.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await Wy(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:o}))},[n,e]),i=b.useCallback(async function(o,l,c){n.getEditingShapeId()===null&&(Array.isArray(o)&&o[0]instanceof ClipboardItem?(MB(n,o,c),e("paste",{source:"menu"})):navigator.clipboard.read().then(d=>{i(d,l,c)}))},[n,e]);return{copy:t,cut:s,paste:i}}function Zce(){const n=G(),e=An(),t=q("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);b.useEffect(()=>{if(!t)return;const s=async c=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Lw(n)||(ze(c),await Wy(n),e("copy",{source:"kbd"}))};async function i(c){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Lw(n)||(ze(c),await Wy(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let r=!1;const o=c=>{c.button===1&&(r=!0,n.timers.requestAnimationFrame(()=>{r=!1}))},l=c=>{if(r){un(c);return}if(n.getEditingShapeId()!==null||Lw(n))return;let d,u=!1;n.inputs.shiftKey&&(u=!0),n.user.getIsPasteAtCursorMode()&&(u=!u),u&&(d=n.inputs.currentPagePoint),c.clipboardData&&!n.inputs.shiftKey?Xce(n,c.clipboardData,d):navigator.clipboard.read().then(h=>{Array.isArray(h)&&h[0]instanceof ClipboardItem&&MB(n,h,d)}),ze(c),e("paste",{source:"kbd"})};return document.addEventListener("copy",s),document.addEventListener("cut",i),document.addEventListener("paste",l),document.addEventListener("pointerup",o),()=>{document.removeEventListener("copy",s),document.removeEventListener("cut",i),document.removeEventListener("paste",l),document.removeEventListener("pointerup",o)}},[n,e,t])}async function DB(n,e,t){const{type:s,quality:i,scale:r,width:o,height:l}=t;let[c,d]=await Rie(o*r,l*r);c=Math.floor(c),d=Math.floor(d);const u=c/o,h=URL.createObjectURL(new Blob([e],{type:"image/svg+xml"})),p=await new Promise(g=>{const m=md();m.crossOrigin="anonymous",m.onload=async()=>{n.environment.isSafari&&await new Promise(S=>n.timers.setTimeout(S,250));const x=document.createElement("canvas"),y=x.getContext("2d");x.width=c,x.height=d,y.imageSmoothingEnabled=!0,y.imageSmoothingQuality="high",y.drawImage(m,0,0,c,d),URL.revokeObjectURL(h),g(x)},m.onerror=()=>{g(null)},m.src=h});if(!p)return null;const f=await new Promise(g=>p.toBlob(m=>{(!m||Gt.throwToBlob.get())&&g(null),g(m)},"image/"+s,i));if(!f)return null;if(s==="png"){const g=new DataView(await f.arrayBuffer());return pr.setPhysChunk(g,u,{type:"image/"+s})}else return f}async function LB(n,e,t){const s=await n.getSvgString(e!=null&&e.length?e:[...n.getCurrentPageShapeIds()],{scale:1,background:n.getInstanceState().exportBackground,...t});if(!s)throw new Error("Could not construct SVG.");return s}async function b_(n,e,t,s={}){var i;switch(t){case"svg":return(i=await LB(n,e,s))==null?void 0:i.svg;case"json":{const r=await n.resolveAssetsInContent(n.getContentFromCurrentPage(e));return JSON.stringify(r)}default:Vn(t)}}async function FB({editor:n,ids:e,format:t,opts:s={}}){switch(t){case"svg":return new Blob([await b_(n,e,"svg",s)],{type:"text/plain"});case"json":return new Blob([await b_(n,e,"json",s)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const i=await LB(n,e,s);if(!i)throw new Error("Could not construct image.");const r=await DB(n,i.svg,{type:t,quality:1,scale:2,width:i.width,height:i.height});if(!r)throw new Error("Could not construct image.");return r}default:Vn(t)}}const Jce={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function Qce(n,e,t,s={}){return{blobPromise:FB({editor:n,ids:e,format:t,opts:s}),mimeType:Jce[t]}}function ede(n,e,t="svg",s={}){if(!window.navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(window.navigator.clipboard.write){const{blobPromise:i,mimeType:r}=Qce(n,e,t,s);return window.navigator.clipboard.write([new ClipboardItem({[r]:i})]).catch(o=>(console.error(o),i.then(l=>window.navigator.clipboard.write([new ClipboardItem({[r]:l})]))))}switch(t){case"json":case"svg":return tde(async()=>b_(n,e,t,s));case"jpeg":case"png":throw new Error("Copy not supported");default:Vn(t)}}async function tde(n){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await n()))}function nde(){const n=G(),{addToast:e}=tr(),t=Fe();return b.useCallback((s,i="svg")=>{ede(n,s,i).catch(()=>{e({id:"copy-fail",severity:"warning",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[n,e,t])}async function sde(n,e,t="png",s,i={}){if(!s&&(s=`shapes at ${Nj()}`,e.length===1)){const l=n.getShape(e[0]);n.isShapeOfType(l,"frame")?s=l.props.name??"frame":s=`${l.id.replace(/:/,"_")} at ${Nj()}`}s+=`.${t}`;const r=await FB({editor:n,ids:e,format:t,opts:i}),o=new File([r],s,{type:r.type});ide(o)}function Nj(){const n=new Date,e=String(n.getFullYear()).slice(2),t=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),r=String(n.getMinutes()).padStart(2,"0"),o=String(n.getSeconds()).padStart(2,"0");return`${e}-${t}-${s} ${i}.${r}.${o}`}function ide(n){const e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download=n.name,e.click(),URL.revokeObjectURL(t)}function rde(){const n=G(),{addToast:e}=tr(),t=Fe();return b.useCallback((s,i="png",r)=>{sde(n,s,i,r,{scale:1,background:n.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc"),severity:"error"})})},[n,e,t])}async function ode(n,e,t){const s=Ne(e.map(l=>{const c=n.getShape(l);if(!(!c||n.getShapeUtil(c.type).toSvg===void 0))return c}));if(s.length===0)return;if(s.length===1){const l=s[0];if(!l||n.isShapeOfType(l,"image"))return}const i=[];if(t!==void 0){const l=s.map(c=>({shape:c,bounds:n.getShapeMaskedPageBounds(c).clone().expandBy(t)}));for(let c=0;c<l.length;c++){const d=l[c];if(c===0){i[0]={shapes:[d.shape],bounds:d.bounds};continue}let u=!1;for(const h of i)if(h.bounds.includes(d.bounds)){h.shapes.push(d.shape),h.bounds.expand(d.bounds),u=!0;break}u||i.push({shapes:[d.shape],bounds:d.bounds})}}else{const l=ue.Common(s.map(c=>n.getShapeMaskedPageBounds(c)));i.push({shapes:s,bounds:l})}const r=n.options.flattenImageBoundsPadding;for(const l of i){t!==void 0&&l.bounds.expandBy(-t);const c=await n.getSvgString(l.shapes,{padding:r});if(!(c!=null&&c.svg))continue;const d=new Blob([c.svg],{type:"image/svg+xml"}),u=await n.getAssetForExternalContent({type:"file",file:new File([d],"asset.svg",{type:"image/svg+xml"})});u&&(l.asset=u)}const o=[];return _r(()=>{for(const l of i){const{asset:c,bounds:d,shapes:u}=l;if(!c)continue;const h=n.findCommonAncestor(u)??n.getCurrentPageId();if(!h)continue;let p="a1";for(const y of u)if(y.parentId===h){y.index>p&&(p=y.index);break}let f,g,m;if(Ss(h)){const y=n.getShape(h);if(!y)continue;const S=n.getPointInShapeSpace(y,{x:d.x,y:d.y});m=n.getShapePageTransform(h).rotation(),S.sub(new _(r,r).rot(-m)),f=S.x,g=S.y}else f=d.x-r,g=d.y-r,m=0;n.deleteShapes(u),n.createAssets([{...c,id:c.id}]);const x=st();n.createShape({id:x,type:"image",index:p,parentId:h,x:f,y:g,rotation:-m,props:{assetId:c.id,w:d.w+r*2,h:d.h+r*2}}),o.push(x)}}),o}function Ex(){return G().store.props.collaboration!==void 0}function ade(){const n=G();return q("sync status",()=>{var e;return(e=n.store.props.collaboration)!=null&&e.status?n.store.props.collaboration.status.get():null},[n])}function lde(){const n=G(),e=b.useRef(null),t=b.useRef(null);return b.useCallback(async function(){const i=document.createElement("div"),r=document.createElement("style"),o=(y,S)=>{y&&(y.innerHTML=""),S&&document.head.contains(S)&&document.head.removeChild(S),y&&document.body.contains(y)&&document.body.removeChild(y)};o(e.current,t.current),e.current=i,t.current=r;const l=`tl-print-surface-${Rt()}`;i.className=l,r.innerHTML=`
			.${l} {
				display: none;
			}

			.${l} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${l} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${l}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${l}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${l}__item__header {
					display: none;
				}

				.${l}__item__footer {
					display: none;
					text-align: right;
				}

				.${l}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(r),document.body.appendChild(i)},d=()=>{n.once("tick",()=>{o(i,r)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",d);function u(y,S,v){try{i.innerHTML+=`<div class="${l}__item">
        <div class="${l}__item__header">
          ${y.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${l}__item__main">
          ${v}
        </div>
        <div class="${l}__item__footer ${l}__item__footer__${S?"":"hide"}">
          ${S??""}
        </div>
      </div>`}catch(C){console.error(C)}}function h(){n.environment.isChromeForIos?(c(),window.print()):n.environment.isSafari?(c(),document.execCommand("print",!1)):window.print()}const p=n.getSelectedShapeIds(),f=n.getCurrentPageId(),g=n.getPages(),x={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const y=await n.getSvgString(p,x);if(y){const S=g.find(v=>v.id===f);u(`tldraw  ${S==null?void 0:S.name}`,null,y.svg),h()}}else{const y=n.getCurrentPage(),S=await n.getSvgString(n.getSortedChildIdsForParent(y.id),x);S&&(u(`tldraw  ${y.name}`,null,S.svg),h())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",d)},[n])}const BB=b.createContext(null);function cde(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function gc(n,e){if(n.getSelectedShapes().length===0)return n.getDocumentSettings().name||e}function dde({overrides:n,children:e}){const t=G(),s=Ex(),{addDialog:i,clearDialogs:r}=Jl(),{clearToasts:o,addToast:l}=tr(),c=Fe(),d=PB(),u=lde(),{cut:h,copy:p,paste:f}=qce(),g=nde(),m=rde(),x=c("document.default-name"),y=An(),S=b.useMemo(()=>{function v(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function C(){return t.isIn("select")&&t.getSelectedShapeIds().length>0}const T=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(E){C()&&(v()||(y("edit-link",{source:E}),t.mark("edit-link"),i({component:Ice})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(E){y("insert-embed",{source:E}),i({component:IB})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(E){y("insert-media",{source:E}),d()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(E){y("undo",{source:E}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(E){y("redo",{source:E}),t.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(E){let P=t.getSelectedShapeIds();P.length===0&&(P=Array.from(t.getCurrentPageShapeIds().values())),P.length!==0&&(y("export-as",{format:"svg",source:E}),m(P,"svg",gc(t,x)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(E){let P=t.getSelectedShapeIds();P.length===0&&(P=Array.from(t.getCurrentPageShapeIds().values())),P.length!==0&&(y("export-as",{format:"png",source:E}),m(P,"png",gc(t,x)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(E){let P=t.getSelectedShapeIds();P.length===0&&(P=Array.from(t.getCurrentPageShapeIds().values())),P.length!==0&&(y("export-as",{format:"json",source:E}),m(P,"json",gc(t,x)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(E){let P=t.getSelectedShapeIds();P.length===0&&(P=Array.from(t.getCurrentPageShapeIds().values())),P.length!==0&&(y("export-all-as",{format:"svg",source:E}),m(Array.from(t.getCurrentPageShapeIds()),"svg",gc(t,x)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(E){const P=Array.from(t.getCurrentPageShapeIds().values());P.length!==0&&(y("export-all-as",{format:"png",source:E}),m(P,"png",gc(t,x)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(E){const P=Array.from(t.getCurrentPageShapeIds().values());P.length!==0&&(y("export-all-as",{format:"json",source:E}),m(P,"json",gc(t,x)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(E){let P=t.getSelectedShapeIds();P.length===0&&(P=Array.from(t.getCurrentPageShapeIds().values())),P.length!==0&&(y("copy-as",{format:"svg",source:E}),g(P,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(E){let P=t.getSelectedShapeIds();P.length===0&&(P=Array.from(t.getCurrentPageShapeIds().values())),P.length!==0&&(y("copy-as",{format:"png",source:E}),g(P,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(E){let P=t.getSelectedShapeIds();P.length===0&&(P=Array.from(t.getCurrentPageShapeIds().values())),P.length!==0&&(y("copy-as",{format:"json",source:E}),g(P,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(E){if(!C()||v())return;y("toggle-auto-size",{source:E}),t.mark("toggling auto size");const P=t.getSelectedShapes().filter(k=>t.isShapeOfType(k,"text")&&k.props.autoSize===!1);t.updateShapes(P.map(k=>({id:k.id,type:k.type,props:{...k.props,w:8,autoSize:!0}}))),ht(t,P.map(k=>k.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(E){y("open-embed-link",{source:E});const P=t.getSelectedShapeIds(),k="No embed shapes selected";if(P.length!==1){console.error(k);return}const j=t.getShape(P[0]);if(!j||!t.isShapeOfType(j,"embed")){console.error(k);return}Zse(j.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(E){var P,k;if(((P=t.root.getCurrent())==null?void 0:P.id)!=="zoom"&&(y("zoom-tool",{source:E}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const j=t.root.getCurrent();j&&((k=j.getCurrent())==null?void 0:k.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:j.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(E){C()&&(v()||t.run(()=>{y("convert-to-bookmark",{source:E});const P=t.getSelectedShapes(),k=[],j=[];for(const D of P){if(!D||!t.isShapeOfType(D,"embed")||!D.props.url)continue;const R=new _(D.x,D.y);R.rot(-D.rotation),R.add(new _(D.props.w/2-300/2,D.props.h/2-320/2)),R.rot(D.rotation);const A={id:st(),type:"bookmark",rotation:D.rotation,x:R.x,y:R.y,opacity:1,props:{url:D.props.url}};k.push(A),j.push(D.id)}t.mark("convert shapes to bookmark"),t.deleteShapes(j),t.createShapes(k)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(E){C()&&(v()||(y("convert-to-embed",{source:E}),t.run(()=>{const P=t.getSelectedShapeIds(),k=Ne(P.map(R=>t.getShape(R))),j=[],D=[];for(const R of k){if(!t.isShapeOfType(R,"bookmark"))continue;const{url:A}=R.props,N=da(R.props.url);if(!N||!N.definition)continue;const{width:B,height:L}=N.definition,O=new _(R.x,R.y);O.rot(-R.rotation),O.add(new _(R.props.w/2-B/2,R.props.h/2-L/2)),O.rot(R.rotation);const F={id:st(),type:"embed",x:O.x,y:O.y,rotation:R.rotation,props:{url:A,w:B,h:L}};j.push(F),D.push(R.id)}t.mark("convert shapes to embed"),t.deleteShapes(D),t.createShapes(j)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(E){if(!C()||v())return;y("duplicate-shapes",{source:E});const P=t.getInstanceState();let k,j;if(P.duplicateProps)k=P.duplicateProps.shapeIds,j=P.duplicateProps.offset;else{k=t.getSelectedShapeIds();const D=ue.Common(Ne(k.map(R=>t.getShapePageBounds(R))));j=t.getCameraOptions().isLocked?{x:t.options.adjacentShapeMargin,y:t.options.adjacentShapeMargin}:{x:D.width+t.options.adjacentShapeMargin,y:0}}t.mark("duplicate shapes"),t.duplicateShapes(k,j),P.duplicateProps&&t.updateInstanceState({duplicateProps:{...P.duplicateProps,shapeIds:t.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(E){C()&&(v()||(y("ungroup-shapes",{source:E}),t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(E){if(!C()||v())return;y("group-shapes",{source:E});const P=t.getOnlySelectedShape();P&&t.isShapeOfType(P,"group")?(t.mark("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.mark("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(E){if(!C())return;y("remove-frame",{source:E});const P=t.getSelectedShapes();P.length>0&&P.every(k=>t.isShapeOfType(k,"frame"))&&(t.mark("remove-frame"),Cce(t,P.map(k=>k.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(E){if(!C())return;y("fit-frame-to-content",{source:E});const P=t.getOnlySelectedShape();P&&t.isShapeOfType(P,"frame")&&(t.mark("fit-frame-to-content"),Tce(t,P.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(E){if(!C()||v())return;y("align-shapes",{operation:"left",source:E}),t.mark("align left");const P=t.getSelectedShapeIds();t.alignShapes(P,"left"),ht(t,P)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(E){if(!C()||v())return;y("align-shapes",{operation:"center-horizontal",source:E}),t.mark("align center horizontal");const P=t.getSelectedShapeIds();t.alignShapes(P,"center-horizontal"),ht(t,P)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(E){if(!C()||v())return;y("align-shapes",{operation:"right",source:E}),t.mark("align right");const P=t.getSelectedShapeIds();t.alignShapes(P,"right"),ht(t,P)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(E){if(!C()||v())return;y("align-shapes",{operation:"center-vertical",source:E}),t.mark("align center vertical");const P=t.getSelectedShapeIds();t.alignShapes(P,"center-vertical"),ht(t,P)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(E){if(!C()||v())return;y("align-shapes",{operation:"top",source:E}),t.mark("align top");const P=t.getSelectedShapeIds();t.alignShapes(P,"top"),ht(t,P)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(E){if(!C()||v())return;y("align-shapes",{operation:"bottom",source:E}),t.mark("align bottom");const P=t.getSelectedShapeIds();t.alignShapes(P,"bottom"),ht(t,P)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(E){if(!C()||v())return;y("distribute-shapes",{operation:"horizontal",source:E}),t.mark("distribute horizontal");const P=t.getSelectedShapeIds();t.distributeShapes(P,"horizontal"),ht(t,P)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(E){if(!C()||v())return;y("distribute-shapes",{operation:"vertical",source:E}),t.mark("distribute vertical");const P=t.getSelectedShapeIds();t.distributeShapes(P,"vertical"),ht(t,P)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(E){if(!C()||v())return;y("stretch-shapes",{operation:"horizontal",source:E}),t.mark("stretch horizontal");const P=t.getSelectedShapeIds();t.stretchShapes(P,"horizontal"),ht(t,P)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(E){if(!C()||v())return;y("stretch-shapes",{operation:"vertical",source:E}),t.mark("stretch vertical");const P=t.getSelectedShapeIds();t.stretchShapes(P,"vertical"),ht(t,P)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(E){if(!C()||v())return;y("flip-shapes",{operation:"horizontal",source:E}),t.mark("flip horizontal");const P=t.getSelectedShapeIds();t.flipShapes(P,"horizontal"),ht(t,P)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(E){if(!C()||v())return;y("flip-shapes",{operation:"vertical",source:E}),t.mark("flip vertical");const P=t.getSelectedShapeIds();t.flipShapes(P,"vertical"),ht(t,P)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(E){if(!C()||v())return;y("pack-shapes",{source:E}),t.mark("pack");const P=t.getSelectedShapeIds();t.packShapes(P,t.options.adjacentShapeMargin),ht(t,P)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(E){if(!C()||v())return;y("stack-shapes",{operation:"vertical",source:E}),t.mark("stack-vertical");const P=t.getSelectedShapeIds();t.stackShapes(P,"vertical",16),ht(t,P)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(E){if(!C()||v())return;y("stack-shapes",{operation:"horizontal",source:E}),t.mark("stack-horizontal");const P=t.getSelectedShapeIds();t.stackShapes(P,"horizontal",16),ht(t,P)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(E){C()&&(v()||(y("reorder-shapes",{operation:"toFront",source:E}),t.mark("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(E){C()&&(v()||(y("reorder-shapes",{operation:"forward",source:E}),t.mark("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(E){C()&&(v()||(y("reorder-shapes",{operation:"backward",source:E}),t.mark("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(E){C()&&(v()||(y("reorder-shapes",{operation:"toBack",source:E}),t.mark("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(E){C()&&(v()||(t.mark("cut"),h(E)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(E){C()&&(v()||p(E))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(E){var P;(P=navigator.clipboard)==null||P.read().then(k=>{f(k,E,E==="context-menu"?t.inputs.currentPagePoint:void 0)}).catch(()=>{l({title:c("action.paste-error-title"),description:c("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(E){t.run(()=>{v()||(y("select-all-shapes",{source:E}),t.mark("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(E){C()&&(v()||(y("select-none-shapes",{source:E}),t.mark("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",onSelect(E){C()&&(v()||(y("delete-shapes",{source:E}),t.mark("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(E){if(!C()||v())return;y("rotate-cw",{source:E}),t.mark("rotate-cw");const P=t.getSelectionRotation()%(gt/2),k=wa(P,0)||wa(P,gt/2),j=t.getSelectedShapeIds();t.rotateShapesBy(j,gt/2-(k?0:P)),ht(t,j)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(E){if(!C()||v())return;y("rotate-ccw",{source:E}),t.mark("rotate-ccw");const P=t.getSelectionRotation()%(gt/2),k=wa(P,0),j=t.getSelectedShapeIds();t.rotateShapesBy(j,k?-(gt/2):-P),ht(t,j)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(E){y("zoom-in",{source:E}),t.zoomIn(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(E){y("zoom-out",{source:E}),t.zoomOut(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(E){y("reset-zoom",{source:E}),t.resetZoom(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(E){y("zoom-to-fit",{source:E}),t.zoomToFit({animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(E){C()&&(v()||(y("zoom-to-selection",{source:E}),t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(E){y("toggle-snap-mode",{source:E}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(E){const P=t.user.getIsDarkMode()?"light":"dark";y("color-scheme",{source:E,value:P}),t.user.updateUserPreferences({colorScheme:P})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(E){y("toggle-wrap-mode",{source:E}),t.user.updateUserPreferences({isWrapMode:!t.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(E){y("toggle-dynamic-size-mode",{source:E}),t.user.updateUserPreferences({isDynamicSizeMode:!t.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(E){y("toggle-paste-at-cursor",{source:E}),t.user.updateUserPreferences({isPasteAtCursorMode:!t.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(E){y("toggle-reduce-motion",{source:E}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(E){y("toggle-edge-scrolling",{source:E}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(E){y("toggle-transparent",{source:E}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(E){y("toggle-tool-lock",{source:E}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(E){y("unlock-all",{source:E});const P=[];for(const k of t.getCurrentPageShapes())k.isLocked&&P.push({id:k.id,type:k.type,isLocked:!1});P.length>0&&t.updateShapes(P)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(E){t.timers.requestAnimationFrame(()=>{t.run(()=>{y("toggle-focus-mode",{source:E}),r(),o(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(E){y("toggle-grid-mode",{source:E}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(E){y("toggle-debug-mode",{source:E}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(E){y("print",{source:E}),u()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(E){y("exit-pen-mode",{source:E}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(E){y("stop-following",{source:E}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(E){y("zoom-to-content",{source:E});const P=t.getSelectionPageBounds()??t.getCurrentPageBounds();P&&t.zoomToBounds(P,{targetZoom:Math.min(1,t.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(E){t.mark("locking"),y("toggle-lock",{source:E}),t.toggleLock(t.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(E){const P=So.createId(),k=t.getSelectedShapeIds();t.run(()=>{t.mark("move_shapes_to_page"),t.createPage({name:c("page-menu.new-page-initial-name"),id:P}),t.moveShapesToPage(k,P)}),y("move-to-new-page",{source:E})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(E){const P=ei;t.run(()=>{t.mark("change-color"),t.isIn("select")&&t.setStyleForSelectedShapes(P,"white"),t.setStyleForNextShapes(P,"white")}),y("set-style",{source:E,id:P.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(E){const P=Nl;t.run(()=>{t.mark("change-fill"),t.isIn("select")&&t.setStyleForSelectedShapes(P,"fill"),t.setStyleForNextShapes(P,"fill")}),y("set-style",{source:E,id:P.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async E=>{const P=t.getSelectedShapeIds();if(P.length===0)return;t.mark("flattening to image"),y("flatten-to-image",{source:E});const k=await ode(t,P,t.options.flattenImageBoundsExpand);k!=null&&k.length&&t.setSelectedShapes(k)}}];s&&T.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(E){y("open-cursor-chat",{source:E}),!t.getInstanceState().isCoarsePointer&&t.timers.requestAnimationFrame(()=>{t.updateInstanceState({isChatting:!0})})}});const I=cde(T);return n?n(t,I,void 0):I},[t,y,n,i,l,d,m,g,h,p,f,r,o,u,c,x,s]);return a.jsx(BB.Provider,{value:S,children:e})}function xe(){const n=b.useContext(BB);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function op(n,e){return n?typeof n=="string"?n:e?n[e]??n.default:void 0:void 0}const ude=["top","right","bottom","left"],Na=Math.min,Ws=Math.max,Hy=Math.round,Sg=Math.floor,Ir=n=>({x:n,y:n}),hde={left:"right",right:"left",bottom:"top",top:"bottom"},pde={start:"end",end:"start"};function __(n,e,t){return Ws(n,Na(e,t))}function _o(n,e){return typeof n=="function"?n(e):n}function Co(n){return n.split("-")[0]}function Hd(n){return n.split("-")[1]}function A1(n){return n==="x"?"y":"x"}function j1(n){return n==="y"?"height":"width"}const fde=new Set(["top","bottom"]);function vr(n){return fde.has(Co(n))?"y":"x"}function N1(n){return A1(vr(n))}function gde(n,e,t){t===void 0&&(t=!1);const s=Hd(n),i=N1(n),r=j1(i);let o=i==="x"?s===(t?"end":"start")?"right":"left":s==="start"?"bottom":"top";return e.reference[r]>e.floating[r]&&(o=Gy(o)),[o,Gy(o)]}function mde(n){const e=Gy(n);return[C_(n),e,C_(e)]}function C_(n){return n.replace(/start|end/g,e=>pde[e])}const Rj=["left","right"],Mj=["right","left"],yde=["top","bottom"],vde=["bottom","top"];function xde(n,e,t){switch(n){case"top":case"bottom":return t?e?Mj:Rj:e?Rj:Mj;case"left":case"right":return e?yde:vde;default:return[]}}function Sde(n,e,t,s){const i=Hd(n);let r=xde(Co(n),t==="start",s);return i&&(r=r.map(o=>o+"-"+i),e&&(r=r.concat(r.map(C_)))),r}function Gy(n){return n.replace(/left|right|bottom|top/g,e=>hde[e])}function wde(n){return{top:0,right:0,bottom:0,left:0,...n}}function UB(n){return typeof n!="number"?wde(n):{top:n,right:n,bottom:n,left:n}}function Vy(n){const{x:e,y:t,width:s,height:i}=n;return{width:s,height:i,top:t,left:e,right:e+s,bottom:t+i,x:e,y:t}}function Oj(n,e,t){let{reference:s,floating:i}=n;const r=vr(e),o=N1(e),l=j1(o),c=Co(e),d=r==="y",u=s.x+s.width/2-i.width/2,h=s.y+s.height/2-i.height/2,p=s[l]/2-i[l]/2;let f;switch(c){case"top":f={x:u,y:s.y-i.height};break;case"bottom":f={x:u,y:s.y+s.height};break;case"right":f={x:s.x+s.width,y:h};break;case"left":f={x:s.x-i.width,y:h};break;default:f={x:s.x,y:s.y}}switch(Hd(e)){case"start":f[o]-=p*(t&&d?-1:1);break;case"end":f[o]+=p*(t&&d?-1:1);break}return f}async function bde(n,e){var t;e===void 0&&(e={});const{x:s,y:i,platform:r,rects:o,elements:l,strategy:c}=n,{boundary:d="clippingAncestors",rootBoundary:u="viewport",elementContext:h="floating",altBoundary:p=!1,padding:f=0}=_o(e,n),g=UB(f),x=l[p?h==="floating"?"reference":"floating":h],y=Vy(await r.getClippingRect({element:(t=await(r.isElement==null?void 0:r.isElement(x)))==null||t?x:x.contextElement||await(r.getDocumentElement==null?void 0:r.getDocumentElement(l.floating)),boundary:d,rootBoundary:u,strategy:c})),S=h==="floating"?{x:s,y:i,width:o.floating.width,height:o.floating.height}:o.reference,v=await(r.getOffsetParent==null?void 0:r.getOffsetParent(l.floating)),C=await(r.isElement==null?void 0:r.isElement(v))?await(r.getScale==null?void 0:r.getScale(v))||{x:1,y:1}:{x:1,y:1},T=Vy(r.convertOffsetParentRelativeRectToViewportRelativeRect?await r.convertOffsetParentRelativeRectToViewportRelativeRect({elements:l,rect:S,offsetParent:v,strategy:c}):S);return{top:(y.top-T.top+g.top)/C.y,bottom:(T.bottom-y.bottom+g.bottom)/C.y,left:(y.left-T.left+g.left)/C.x,right:(T.right-y.right+g.right)/C.x}}const _de=async(n,e,t)=>{const{placement:s="bottom",strategy:i="absolute",middleware:r=[],platform:o}=t,l=r.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let d=await o.getElementRects({reference:n,floating:e,strategy:i}),{x:u,y:h}=Oj(d,s,c),p=s,f={},g=0;for(let x=0;x<l.length;x++){var m;const{name:y,fn:S}=l[x],{x:v,y:C,data:T,reset:I}=await S({x:u,y:h,initialPlacement:s,placement:p,strategy:i,middlewareData:f,rects:d,platform:{...o,detectOverflow:(m=o.detectOverflow)!=null?m:bde},elements:{reference:n,floating:e}});u=v??u,h=C??h,f={...f,[y]:{...f[y],...T}},I&&g<=50&&(g++,typeof I=="object"&&(I.placement&&(p=I.placement),I.rects&&(d=I.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:i}):I.rects),{x:u,y:h}=Oj(d,p,c)),x=-1)}return{x:u,y:h,placement:p,strategy:i,middlewareData:f}},Cde=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:s,placement:i,rects:r,platform:o,elements:l,middlewareData:c}=e,{element:d,padding:u=0}=_o(n,e)||{};if(d==null)return{};const h=UB(u),p={x:t,y:s},f=N1(i),g=j1(f),m=await o.getDimensions(d),x=f==="y",y=x?"top":"left",S=x?"bottom":"right",v=x?"clientHeight":"clientWidth",C=r.reference[g]+r.reference[f]-p[f]-r.floating[g],T=p[f]-r.reference[f],I=await(o.getOffsetParent==null?void 0:o.getOffsetParent(d));let E=I?I[v]:0;(!E||!await(o.isElement==null?void 0:o.isElement(I)))&&(E=l.floating[v]||r.floating[g]);const P=C/2-T/2,k=E/2-m[g]/2-1,j=Na(h[y],k),D=Na(h[S],k),R=j,A=E-m[g]-D,N=E/2-m[g]/2+P,B=__(R,N,A),L=!c.arrow&&Hd(i)!=null&&N!==B&&r.reference[g]/2-(N<R?j:D)-m[g]/2<0,O=L?N<R?N-R:N-A:0;return{[f]:p[f]+O,data:{[f]:B,centerOffset:N-B-O,...L&&{alignmentOffset:O}},reset:L}}}),Ede=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,s;const{placement:i,middlewareData:r,rects:o,initialPlacement:l,platform:c,elements:d}=e,{mainAxis:u=!0,crossAxis:h=!0,fallbackPlacements:p,fallbackStrategy:f="bestFit",fallbackAxisSideDirection:g="none",flipAlignment:m=!0,...x}=_o(n,e);if((t=r.arrow)!=null&&t.alignmentOffset)return{};const y=Co(i),S=vr(l),v=Co(l)===l,C=await(c.isRTL==null?void 0:c.isRTL(d.floating)),T=p||(v||!m?[Gy(l)]:mde(l)),I=g!=="none";!p&&I&&T.push(...Sde(l,m,g,C));const E=[l,...T],P=await c.detectOverflow(e,x),k=[];let j=((s=r.flip)==null?void 0:s.overflows)||[];if(u&&k.push(P[y]),h){const N=gde(i,o,C);k.push(P[N[0]],P[N[1]])}if(j=[...j,{placement:i,overflows:k}],!k.every(N=>N<=0)){var D,R;const N=(((D=r.flip)==null?void 0:D.index)||0)+1,B=E[N];if(B&&(!(h==="alignment"?S!==vr(B):!1)||j.every(F=>vr(F.placement)===S?F.overflows[0]>0:!0)))return{data:{index:N,overflows:j},reset:{placement:B}};let L=(R=j.filter(O=>O.overflows[0]<=0).sort((O,F)=>O.overflows[1]-F.overflows[1])[0])==null?void 0:R.placement;if(!L)switch(f){case"bestFit":{var A;const O=(A=j.filter(F=>{if(I){const W=vr(F.placement);return W===S||W==="y"}return!0}).map(F=>[F.placement,F.overflows.filter(W=>W>0).reduce((W,$)=>W+$,0)]).sort((F,W)=>F[1]-W[1])[0])==null?void 0:A[0];O&&(L=O);break}case"initialPlacement":L=l;break}if(i!==L)return{reset:{placement:L}}}return{}}}};function Dj(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function Lj(n){return ude.some(e=>n[e]>=0)}const Tde=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t,platform:s}=e,{strategy:i="referenceHidden",...r}=_o(n,e);switch(i){case"referenceHidden":{const o=await s.detectOverflow(e,{...r,elementContext:"reference"}),l=Dj(o,t.reference);return{data:{referenceHiddenOffsets:l,referenceHidden:Lj(l)}}}case"escaped":{const o=await s.detectOverflow(e,{...r,altBoundary:!0}),l=Dj(o,t.floating);return{data:{escapedOffsets:l,escaped:Lj(l)}}}default:return{}}}}},$B=new Set(["left","top"]);async function Ide(n,e){const{placement:t,platform:s,elements:i}=n,r=await(s.isRTL==null?void 0:s.isRTL(i.floating)),o=Co(t),l=Hd(t),c=vr(t)==="y",d=$B.has(o)?-1:1,u=r&&c?-1:1,h=_o(e,n);let{mainAxis:p,crossAxis:f,alignmentAxis:g}=typeof h=="number"?{mainAxis:h,crossAxis:0,alignmentAxis:null}:{mainAxis:h.mainAxis||0,crossAxis:h.crossAxis||0,alignmentAxis:h.alignmentAxis};return l&&typeof g=="number"&&(f=l==="end"?g*-1:g),c?{x:f*u,y:p*d}:{x:p*d,y:f*u}}const Pde=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,s;const{x:i,y:r,placement:o,middlewareData:l}=e,c=await Ide(e,n);return o===((t=l.offset)==null?void 0:t.placement)&&(s=l.arrow)!=null&&s.alignmentOffset?{}:{x:i+c.x,y:r+c.y,data:{...c,placement:o}}}}},kde=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:s,placement:i,platform:r}=e,{mainAxis:o=!0,crossAxis:l=!1,limiter:c={fn:y=>{let{x:S,y:v}=y;return{x:S,y:v}}},...d}=_o(n,e),u={x:t,y:s},h=await r.detectOverflow(e,d),p=vr(Co(i)),f=A1(p);let g=u[f],m=u[p];if(o){const y=f==="y"?"top":"left",S=f==="y"?"bottom":"right",v=g+h[y],C=g-h[S];g=__(v,g,C)}if(l){const y=p==="y"?"top":"left",S=p==="y"?"bottom":"right",v=m+h[y],C=m-h[S];m=__(v,m,C)}const x=c.fn({...e,[f]:g,[p]:m});return{...x,data:{x:x.x-t,y:x.y-s,enabled:{[f]:o,[p]:l}}}}}},Ade=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:s,placement:i,rects:r,middlewareData:o}=e,{offset:l=0,mainAxis:c=!0,crossAxis:d=!0}=_o(n,e),u={x:t,y:s},h=vr(i),p=A1(h);let f=u[p],g=u[h];const m=_o(l,e),x=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(c){const v=p==="y"?"height":"width",C=r.reference[p]-r.floating[v]+x.mainAxis,T=r.reference[p]+r.reference[v]-x.mainAxis;f<C?f=C:f>T&&(f=T)}if(d){var y,S;const v=p==="y"?"width":"height",C=$B.has(Co(i)),T=r.reference[h]-r.floating[v]+(C&&((y=o.offset)==null?void 0:y[h])||0)+(C?0:x.crossAxis),I=r.reference[h]+r.reference[v]+(C?0:((S=o.offset)==null?void 0:S[h])||0)-(C?x.crossAxis:0);g<T?g=T:g>I&&(g=I)}return{[p]:f,[h]:g}}}},jde=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,s;const{placement:i,rects:r,platform:o,elements:l}=e,{apply:c=()=>{},...d}=_o(n,e),u=await o.detectOverflow(e,d),h=Co(i),p=Hd(i),f=vr(i)==="y",{width:g,height:m}=r.floating;let x,y;h==="top"||h==="bottom"?(x=h,y=p===(await(o.isRTL==null?void 0:o.isRTL(l.floating))?"start":"end")?"left":"right"):(y=h,x=p==="end"?"top":"bottom");const S=m-u.top-u.bottom,v=g-u.left-u.right,C=Na(m-u[x],S),T=Na(g-u[y],v),I=!e.middlewareData.shift;let E=C,P=T;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(P=v),(s=e.middlewareData.shift)!=null&&s.enabled.y&&(E=S),I&&!p){const j=Ws(u.left,0),D=Ws(u.right,0),R=Ws(u.top,0),A=Ws(u.bottom,0);f?P=g-2*(j!==0||D!==0?j+D:Ws(u.left,u.right)):E=m-2*(R!==0||A!==0?R+A:Ws(u.top,u.bottom))}await c({...e,availableWidth:P,availableHeight:E});const k=await o.getDimensions(l.floating);return g!==k.width||m!==k.height?{reset:{rects:!0}}:{}}}};function Tx(){return typeof window<"u"}function Gd(n){return zB(n)?(n.nodeName||"").toLowerCase():"#document"}function qs(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function Br(n){var e;return(e=(zB(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function zB(n){return Tx()?n instanceof Node||n instanceof qs(n).Node:!1}function Xi(n){return Tx()?n instanceof Element||n instanceof qs(n).Element:!1}function Or(n){return Tx()?n instanceof HTMLElement||n instanceof qs(n).HTMLElement:!1}function Fj(n){return!Tx()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof qs(n).ShadowRoot}const Nde=new Set(["inline","contents"]);function Yp(n){const{overflow:e,overflowX:t,overflowY:s,display:i}=qi(n);return/auto|scroll|overlay|hidden|clip/.test(e+s+t)&&!Nde.has(i)}const Rde=new Set(["table","td","th"]);function Mde(n){return Rde.has(Gd(n))}const Ode=[":popover-open",":modal"];function Ix(n){return Ode.some(e=>{try{return n.matches(e)}catch{return!1}})}const Dde=["transform","translate","scale","rotate","perspective"],Lde=["transform","translate","scale","rotate","perspective","filter"],Fde=["paint","layout","strict","content"];function R1(n){const e=M1(),t=Xi(n)?qi(n):n;return Dde.some(s=>t[s]?t[s]!=="none":!1)||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||Lde.some(s=>(t.willChange||"").includes(s))||Fde.some(s=>(t.contain||"").includes(s))}function Bde(n){let e=Ra(n);for(;Or(e)&&!Ed(e);){if(R1(e))return e;if(Ix(e))return null;e=Ra(e)}return null}function M1(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const Ude=new Set(["html","body","#document"]);function Ed(n){return Ude.has(Gd(n))}function qi(n){return qs(n).getComputedStyle(n)}function Px(n){return Xi(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function Ra(n){if(Gd(n)==="html")return n;const e=n.assignedSlot||n.parentNode||Fj(n)&&n.host||Br(n);return Fj(e)?e.host:e}function WB(n){const e=Ra(n);return Ed(e)?n.ownerDocument?n.ownerDocument.body:n.body:Or(e)&&Yp(e)?e:WB(e)}function ap(n,e,t){var s;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=WB(n),r=i===((s=n.ownerDocument)==null?void 0:s.body),o=qs(i);if(r){const l=E_(o);return e.concat(o,o.visualViewport||[],Yp(i)?i:[],l&&t?ap(l):[])}return e.concat(i,ap(i,[],t))}function E_(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function HB(n){const e=qi(n);let t=parseFloat(e.width)||0,s=parseFloat(e.height)||0;const i=Or(n),r=i?n.offsetWidth:t,o=i?n.offsetHeight:s,l=Hy(t)!==r||Hy(s)!==o;return l&&(t=r,s=o),{width:t,height:s,$:l}}function O1(n){return Xi(n)?n:n.contextElement}function sd(n){const e=O1(n);if(!Or(e))return Ir(1);const t=e.getBoundingClientRect(),{width:s,height:i,$:r}=HB(e);let o=(r?Hy(t.width):t.width)/s,l=(r?Hy(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!l||!Number.isFinite(l))&&(l=1),{x:o,y:l}}const $de=Ir(0);function GB(n){const e=qs(n);return!M1()||!e.visualViewport?$de:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function zde(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==qs(n)?!1:e}function Ll(n,e,t,s){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),r=O1(n);let o=Ir(1);e&&(s?Xi(s)&&(o=sd(s)):o=sd(n));const l=zde(r,t,s)?GB(r):Ir(0);let c=(i.left+l.x)/o.x,d=(i.top+l.y)/o.y,u=i.width/o.x,h=i.height/o.y;if(r){const p=qs(r),f=s&&Xi(s)?qs(s):s;let g=p,m=E_(g);for(;m&&s&&f!==g;){const x=sd(m),y=m.getBoundingClientRect(),S=qi(m),v=y.left+(m.clientLeft+parseFloat(S.paddingLeft))*x.x,C=y.top+(m.clientTop+parseFloat(S.paddingTop))*x.y;c*=x.x,d*=x.y,u*=x.x,h*=x.y,c+=v,d+=C,g=qs(m),m=E_(g)}}return Vy({width:u,height:h,x:c,y:d})}function kx(n,e){const t=Px(n).scrollLeft;return e?e.left+t:Ll(Br(n)).left+t}function VB(n,e){const t=n.getBoundingClientRect(),s=t.left+e.scrollLeft-kx(n,t),i=t.top+e.scrollTop;return{x:s,y:i}}function Wde(n){let{elements:e,rect:t,offsetParent:s,strategy:i}=n;const r=i==="fixed",o=Br(s),l=e?Ix(e.floating):!1;if(s===o||l&&r)return t;let c={scrollLeft:0,scrollTop:0},d=Ir(1);const u=Ir(0),h=Or(s);if((h||!h&&!r)&&((Gd(s)!=="body"||Yp(o))&&(c=Px(s)),Or(s))){const f=Ll(s);d=sd(s),u.x=f.x+s.clientLeft,u.y=f.y+s.clientTop}const p=o&&!h&&!r?VB(o,c):Ir(0);return{width:t.width*d.x,height:t.height*d.y,x:t.x*d.x-c.scrollLeft*d.x+u.x+p.x,y:t.y*d.y-c.scrollTop*d.y+u.y+p.y}}function Hde(n){return Array.from(n.getClientRects())}function Gde(n){const e=Br(n),t=Px(n),s=n.ownerDocument.body,i=Ws(e.scrollWidth,e.clientWidth,s.scrollWidth,s.clientWidth),r=Ws(e.scrollHeight,e.clientHeight,s.scrollHeight,s.clientHeight);let o=-t.scrollLeft+kx(n);const l=-t.scrollTop;return qi(s).direction==="rtl"&&(o+=Ws(e.clientWidth,s.clientWidth)-i),{width:i,height:r,x:o,y:l}}const Bj=25;function Vde(n,e){const t=qs(n),s=Br(n),i=t.visualViewport;let r=s.clientWidth,o=s.clientHeight,l=0,c=0;if(i){r=i.width,o=i.height;const u=M1();(!u||u&&e==="fixed")&&(l=i.offsetLeft,c=i.offsetTop)}const d=kx(s);if(d<=0){const u=s.ownerDocument,h=u.body,p=getComputedStyle(h),f=u.compatMode==="CSS1Compat"&&parseFloat(p.marginLeft)+parseFloat(p.marginRight)||0,g=Math.abs(s.clientWidth-h.clientWidth-f);g<=Bj&&(r-=g)}else d<=Bj&&(r+=d);return{width:r,height:o,x:l,y:c}}const Kde=new Set(["absolute","fixed"]);function Yde(n,e){const t=Ll(n,!0,e==="fixed"),s=t.top+n.clientTop,i=t.left+n.clientLeft,r=Or(n)?sd(n):Ir(1),o=n.clientWidth*r.x,l=n.clientHeight*r.y,c=i*r.x,d=s*r.y;return{width:o,height:l,x:c,y:d}}function Uj(n,e,t){let s;if(e==="viewport")s=Vde(n,t);else if(e==="document")s=Gde(Br(n));else if(Xi(e))s=Yde(e,t);else{const i=GB(n);s={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return Vy(s)}function KB(n,e){const t=Ra(n);return t===e||!Xi(t)||Ed(t)?!1:qi(t).position==="fixed"||KB(t,e)}function Xde(n,e){const t=e.get(n);if(t)return t;let s=ap(n,[],!1).filter(l=>Xi(l)&&Gd(l)!=="body"),i=null;const r=qi(n).position==="fixed";let o=r?Ra(n):n;for(;Xi(o)&&!Ed(o);){const l=qi(o),c=R1(o);!c&&l.position==="fixed"&&(i=null),(r?!c&&!i:!c&&l.position==="static"&&!!i&&Kde.has(i.position)||Yp(o)&&!c&&KB(n,o))?s=s.filter(u=>u!==o):i=l,o=Ra(o)}return e.set(n,s),s}function qde(n){let{element:e,boundary:t,rootBoundary:s,strategy:i}=n;const o=[...t==="clippingAncestors"?Ix(e)?[]:Xde(e,this._c):[].concat(t),s],l=o[0],c=o.reduce((d,u)=>{const h=Uj(e,u,i);return d.top=Ws(h.top,d.top),d.right=Na(h.right,d.right),d.bottom=Na(h.bottom,d.bottom),d.left=Ws(h.left,d.left),d},Uj(e,l,i));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Zde(n){const{width:e,height:t}=HB(n);return{width:e,height:t}}function Jde(n,e,t){const s=Or(e),i=Br(e),r=t==="fixed",o=Ll(n,!0,r,e);let l={scrollLeft:0,scrollTop:0};const c=Ir(0);function d(){c.x=kx(i)}if(s||!s&&!r)if((Gd(e)!=="body"||Yp(i))&&(l=Px(e)),s){const f=Ll(e,!0,r,e);c.x=f.x+e.clientLeft,c.y=f.y+e.clientTop}else i&&d();r&&!s&&i&&d();const u=i&&!s&&!r?VB(i,l):Ir(0),h=o.left+l.scrollLeft-c.x-u.x,p=o.top+l.scrollTop-c.y-u.y;return{x:h,y:p,width:o.width,height:o.height}}function Bw(n){return qi(n).position==="static"}function $j(n,e){if(!Or(n)||qi(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return Br(n)===t&&(t=t.ownerDocument.body),t}function YB(n,e){const t=qs(n);if(Ix(n))return t;if(!Or(n)){let i=Ra(n);for(;i&&!Ed(i);){if(Xi(i)&&!Bw(i))return i;i=Ra(i)}return t}let s=$j(n,e);for(;s&&Mde(s)&&Bw(s);)s=$j(s,e);return s&&Ed(s)&&Bw(s)&&!R1(s)?t:s||Bde(n)||t}const Qde=async function(n){const e=this.getOffsetParent||YB,t=this.getDimensions,s=await t(n.floating);return{reference:Jde(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:s.width,height:s.height}}};function eue(n){return qi(n).direction==="rtl"}const tue={convertOffsetParentRelativeRectToViewportRelativeRect:Wde,getDocumentElement:Br,getClippingRect:qde,getOffsetParent:YB,getElementRects:Qde,getClientRects:Hde,getDimensions:Zde,getScale:sd,isElement:Xi,isRTL:eue};function XB(n,e){return n.x===e.x&&n.y===e.y&&n.width===e.width&&n.height===e.height}function nue(n,e){let t=null,s;const i=Br(n);function r(){var l;clearTimeout(s),(l=t)==null||l.disconnect(),t=null}function o(l,c){l===void 0&&(l=!1),c===void 0&&(c=1),r();const d=n.getBoundingClientRect(),{left:u,top:h,width:p,height:f}=d;if(l||e(),!p||!f)return;const g=Sg(h),m=Sg(i.clientWidth-(u+p)),x=Sg(i.clientHeight-(h+f)),y=Sg(u),v={rootMargin:-g+"px "+-m+"px "+-x+"px "+-y+"px",threshold:Ws(0,Na(1,c))||1};let C=!0;function T(I){const E=I[0].intersectionRatio;if(E!==c){if(!C)return o();E?o(!1,E):s=setTimeout(()=>{o(!1,1e-7)},1e3)}E===1&&!XB(d,n.getBoundingClientRect())&&o(),C=!1}try{t=new IntersectionObserver(T,{...v,root:i.ownerDocument})}catch{t=new IntersectionObserver(T,v)}t.observe(n)}return o(!0),r}function sue(n,e,t,s){s===void 0&&(s={});const{ancestorScroll:i=!0,ancestorResize:r=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:l=typeof IntersectionObserver=="function",animationFrame:c=!1}=s,d=O1(n),u=i||r?[...d?ap(d):[],...ap(e)]:[];u.forEach(y=>{i&&y.addEventListener("scroll",t,{passive:!0}),r&&y.addEventListener("resize",t)});const h=d&&l?nue(d,t):null;let p=-1,f=null;o&&(f=new ResizeObserver(y=>{let[S]=y;S&&S.target===d&&f&&(f.unobserve(e),cancelAnimationFrame(p),p=requestAnimationFrame(()=>{var v;(v=f)==null||v.observe(e)})),t()}),d&&!c&&f.observe(d),f.observe(e));let g,m=c?Ll(n):null;c&&x();function x(){const y=Ll(n);m&&!XB(m,y)&&t(),m=y,g=requestAnimationFrame(x)}return t(),()=>{var y;u.forEach(S=>{i&&S.removeEventListener("scroll",t),r&&S.removeEventListener("resize",t)}),h==null||h(),(y=f)==null||y.disconnect(),f=null,c&&cancelAnimationFrame(g)}}const iue=Pde,rue=kde,oue=Ede,aue=jde,lue=Tde,zj=Cde,cue=Ade,due=(n,e,t)=>{const s=new Map,i={platform:tue,...t},r={...i.platform,_c:s};return _de(n,e,{...i,platform:r})};var uue=typeof document<"u",hue=function(){},Im=uue?b.useLayoutEffect:hue;function Ky(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,s,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(s=t;s--!==0;)if(!Ky(n[s],e[s]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(s=t;s--!==0;)if(!{}.hasOwnProperty.call(e,i[s]))return!1;for(s=t;s--!==0;){const r=i[s];if(!(r==="_owner"&&n.$$typeof)&&!Ky(n[r],e[r]))return!1}return!0}return n!==n&&e!==e}function qB(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function Wj(n,e){const t=qB(n);return Math.round(e*t)/t}function Uw(n){const e=b.useRef(n);return Im(()=>{e.current=n}),e}function pue(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:s=[],platform:i,elements:{reference:r,floating:o}={},transform:l=!0,whileElementsMounted:c,open:d}=n,[u,h]=b.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[p,f]=b.useState(s);Ky(p,s)||f(s);const[g,m]=b.useState(null),[x,y]=b.useState(null),S=b.useCallback(F=>{F!==I.current&&(I.current=F,m(F))},[]),v=b.useCallback(F=>{F!==E.current&&(E.current=F,y(F))},[]),C=r||g,T=o||x,I=b.useRef(null),E=b.useRef(null),P=b.useRef(u),k=c!=null,j=Uw(c),D=Uw(i),R=Uw(d),A=b.useCallback(()=>{if(!I.current||!E.current)return;const F={placement:e,strategy:t,middleware:p};D.current&&(F.platform=D.current),due(I.current,E.current,F).then(W=>{const $={...W,isPositioned:R.current!==!1};N.current&&!Ky(P.current,$)&&(P.current=$,kr.flushSync(()=>{h($)}))})},[p,e,t,D,R]);Im(()=>{d===!1&&P.current.isPositioned&&(P.current.isPositioned=!1,h(F=>({...F,isPositioned:!1})))},[d]);const N=b.useRef(!1);Im(()=>(N.current=!0,()=>{N.current=!1}),[]),Im(()=>{if(C&&(I.current=C),T&&(E.current=T),C&&T){if(j.current)return j.current(C,T,A);A()}},[C,T,A,j,k]);const B=b.useMemo(()=>({reference:I,floating:E,setReference:S,setFloating:v}),[S,v]),L=b.useMemo(()=>({reference:C,floating:T}),[C,T]),O=b.useMemo(()=>{const F={position:t,left:0,top:0};if(!L.floating)return F;const W=Wj(L.floating,u.x),$=Wj(L.floating,u.y);return l?{...F,transform:"translate("+W+"px, "+$+"px)",...qB(L.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:W,top:$}},[t,l,L.floating,u.x,u.y]);return b.useMemo(()=>({...u,update:A,refs:B,elements:L,floatingStyles:O}),[u,A,B,L,O])}const fue=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:s,padding:i}=typeof n=="function"?n(t):n;return s&&e(s)?s.current!=null?zj({element:s.current,padding:i}).fn(t):{}:s?zj({element:s,padding:i}).fn(t):{}}}},gue=(n,e)=>({...iue(n),options:[n,e]}),mue=(n,e)=>({...rue(n),options:[n,e]}),yue=(n,e)=>({...cue(n),options:[n,e]}),vue=(n,e)=>({...oue(n),options:[n,e]}),xue=(n,e)=>({...aue(n),options:[n,e]}),Sue=(n,e)=>({...lue(n),options:[n,e]}),wue=(n,e)=>({...fue(n),options:[n,e]});var bue="Arrow",ZB=b.forwardRef((n,e)=>{const{children:t,width:s=10,height:i=5,...r}=n;return a.jsx(Ge.svg,{...r,ref:e,width:s,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:a.jsx("polygon",{points:"0,0 30,0 15,10"})})});ZB.displayName=bue;var _ue=ZB;function JB(n){const[e,t]=b.useState(void 0);return bo(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const s=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const r=i[0];let o,l;if("borderBoxSize"in r){const c=r.borderBoxSize,d=Array.isArray(c)?c[0]:c;o=d.inlineSize,l=d.blockSize}else o=n.offsetWidth,l=n.offsetHeight;t({width:o,height:l})});return s.observe(n,{box:"border-box"}),()=>s.unobserve(n)}else t(void 0)},[n]),e}var D1="Popper",[QB,Ax]=Fr(D1),[Cue,e3]=QB(D1),t3=n=>{const{__scopePopper:e,children:t}=n,[s,i]=b.useState(null);return a.jsx(Cue,{scope:e,anchor:s,onAnchorChange:i,children:t})};t3.displayName=D1;var n3="PopperAnchor",s3=b.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:s,...i}=n,r=e3(n3,t),o=b.useRef(null),l=dt(e,o),c=b.useRef(null);return b.useEffect(()=>{const d=c.current;c.current=(s==null?void 0:s.current)||o.current,d!==c.current&&r.onAnchorChange(c.current)}),s?null:a.jsx(Ge.div,{...i,ref:l})});s3.displayName=n3;var L1="PopperContent",[Eue,Tue]=QB(L1),i3=b.forwardRef((n,e)=>{var ae,ce,he,Ee,ke,Jt;const{__scopePopper:t,side:s="bottom",sideOffset:i=0,align:r="center",alignOffset:o=0,arrowPadding:l=0,avoidCollisions:c=!0,collisionBoundary:d=[],collisionPadding:u=0,sticky:h="partial",hideWhenDetached:p=!1,updatePositionStrategy:f="optimized",onPlaced:g,...m}=n,x=e3(L1,t),[y,S]=b.useState(null),v=dt(e,tt=>S(tt)),[C,T]=b.useState(null),I=JB(C),E=(I==null?void 0:I.width)??0,P=(I==null?void 0:I.height)??0,k=s+(r!=="center"?"-"+r:""),j=typeof u=="number"?u:{top:0,right:0,bottom:0,left:0,...u},D=Array.isArray(d)?d:[d],R=D.length>0,A={padding:j,boundary:D.filter(Pue),altBoundary:R},{refs:N,floatingStyles:B,placement:L,isPositioned:O,middlewareData:F}=pue({strategy:"fixed",placement:k,whileElementsMounted:(...tt)=>sue(...tt,{animationFrame:f==="always"}),elements:{reference:x.anchor},middleware:[gue({mainAxis:i+P,alignmentAxis:o}),c&&mue({mainAxis:!0,crossAxis:!1,limiter:h==="partial"?yue():void 0,...A}),c&&vue({...A}),xue({...A,apply:({elements:tt,rects:re,availableWidth:$e,availableHeight:At})=>{const{width:gn,height:nu}=re.reference,Fo=tt.floating.style;Fo.setProperty("--radix-popper-available-width",`${$e}px`),Fo.setProperty("--radix-popper-available-height",`${At}px`),Fo.setProperty("--radix-popper-anchor-width",`${gn}px`),Fo.setProperty("--radix-popper-anchor-height",`${nu}px`)}}),C&&wue({element:C,padding:l}),kue({arrowWidth:E,arrowHeight:P}),p&&Sue({strategy:"referenceHidden",...A})]}),[W,$]=a3(L),K=os(g);bo(()=>{O&&(K==null||K())},[O,K]);const Y=(ae=F.arrow)==null?void 0:ae.x,U=(ce=F.arrow)==null?void 0:ce.y,J=((he=F.arrow)==null?void 0:he.centerOffset)!==0,[te,ee]=b.useState();return bo(()=>{y&&ee(window.getComputedStyle(y).zIndex)},[y]),a.jsx("div",{ref:N.setFloating,"data-radix-popper-content-wrapper":"",style:{...B,transform:O?B.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:te,"--radix-popper-transform-origin":[(Ee=F.transformOrigin)==null?void 0:Ee.x,(ke=F.transformOrigin)==null?void 0:ke.y].join(" "),...((Jt=F.hide)==null?void 0:Jt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:a.jsx(Eue,{scope:t,placedSide:W,onArrowChange:T,arrowX:Y,arrowY:U,shouldHideArrow:J,children:a.jsx(Ge.div,{"data-side":W,"data-align":$,...m,ref:v,style:{...m.style,animation:O?void 0:"none"}})})})});i3.displayName=L1;var r3="PopperArrow",Iue={top:"bottom",right:"left",bottom:"top",left:"right"},o3=b.forwardRef(function(e,t){const{__scopePopper:s,...i}=e,r=Tue(r3,s),o=Iue[r.placedSide];return a.jsx("span",{ref:r.onArrowChange,style:{position:"absolute",left:r.arrowX,top:r.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[r.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[r.placedSide],visibility:r.shouldHideArrow?"hidden":void 0},children:a.jsx(_ue,{...i,ref:t,style:{...i.style,display:"block"}})})});o3.displayName=r3;function Pue(n){return n!==null}var kue=n=>({name:"transformOrigin",options:n,fn(e){var x,y,S;const{placement:t,rects:s,middlewareData:i}=e,o=((x=i.arrow)==null?void 0:x.centerOffset)!==0,l=o?0:n.arrowWidth,c=o?0:n.arrowHeight,[d,u]=a3(t),h={start:"0%",center:"50%",end:"100%"}[u],p=(((y=i.arrow)==null?void 0:y.x)??0)+l/2,f=(((S=i.arrow)==null?void 0:S.y)??0)+c/2;let g="",m="";return d==="bottom"?(g=o?h:`${p}px`,m=`${-c}px`):d==="top"?(g=o?h:`${p}px`,m=`${s.floating.height+c}px`):d==="right"?(g=`${-c}px`,m=o?h:`${f}px`):d==="left"&&(g=`${s.floating.width+c}px`,m=o?h:`${f}px`),{data:{x:g,y:m}}}});function a3(n){const[e,t="center"]=n.split("-");return[e,t]}var F1=t3,B1=s3,l3=i3,c3=o3,jx="Popover",[d3]=Fr(jx,[Ax]),Xp=Ax(),[Aue,Ha]=d3(jx),u3=n=>{const{__scopePopover:e,children:t,open:s,defaultOpen:i,onOpenChange:r,modal:o=!1}=n,l=Xp(e),c=b.useRef(null),[d,u]=b.useState(!1),[h,p]=Wa({prop:s,defaultProp:i??!1,onChange:r,caller:jx});return a.jsx(F1,{...l,children:a.jsx(Aue,{scope:e,contentId:po(),triggerRef:c,open:h,onOpenChange:p,onOpenToggle:b.useCallback(()=>p(f=>!f),[p]),hasCustomAnchor:d,onCustomAnchorAdd:b.useCallback(()=>u(!0),[]),onCustomAnchorRemove:b.useCallback(()=>u(!1),[]),modal:o,children:t})})};u3.displayName=jx;var h3="PopoverAnchor",jue=b.forwardRef((n,e)=>{const{__scopePopover:t,...s}=n,i=Ha(h3,t),r=Xp(t),{onCustomAnchorAdd:o,onCustomAnchorRemove:l}=i;return b.useEffect(()=>(o(),()=>l()),[o,l]),a.jsx(B1,{...r,...s,ref:e})});jue.displayName=h3;var p3="PopoverTrigger",f3=b.forwardRef((n,e)=>{const{__scopePopover:t,...s}=n,i=Ha(p3,t),r=Xp(t),o=dt(e,i.triggerRef),l=a.jsx(Ge.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":x3(i.open),...s,ref:o,onClick:me(n.onClick,i.onOpenToggle)});return i.hasCustomAnchor?l:a.jsx(B1,{asChild:!0,...r,children:l})});f3.displayName=p3;var U1="PopoverPortal",[Nue,Rue]=d3(U1,{forceMount:void 0}),g3=n=>{const{__scopePopover:e,forceMount:t,children:s,container:i}=n,r=Ha(U1,e);return a.jsx(Nue,{scope:e,forceMount:t,children:a.jsx(Qi,{present:t||r.open,children:a.jsx(Gp,{asChild:!0,container:i,children:s})})})};g3.displayName=U1;var Td="PopoverContent",m3=b.forwardRef((n,e)=>{const t=Rue(Td,n.__scopePopover),{forceMount:s=t.forceMount,...i}=n,r=Ha(Td,n.__scopePopover);return a.jsx(Qi,{present:s||r.open,children:r.modal?a.jsx(Oue,{...i,ref:e}):a.jsx(Due,{...i,ref:e})})});m3.displayName=Td;var Mue=Cd("PopoverContent.RemoveScroll"),Oue=b.forwardRef((n,e)=>{const t=Ha(Td,n.__scopePopover),s=b.useRef(null),i=dt(e,s),r=b.useRef(!1);return b.useEffect(()=>{const o=s.current;if(o)return w1(o)},[]),a.jsx(mx,{as:Mue,allowPinchZoom:!0,children:a.jsx(y3,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:me(n.onCloseAutoFocus,o=>{var l;o.preventDefault(),r.current||(l=t.triggerRef.current)==null||l.focus()}),onPointerDownOutside:me(n.onPointerDownOutside,o=>{const l=o.detail.originalEvent,c=l.button===0&&l.ctrlKey===!0,d=l.button===2||c;r.current=d},{checkForDefaultPrevented:!1}),onFocusOutside:me(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),Due=b.forwardRef((n,e)=>{const t=Ha(Td,n.__scopePopover),s=b.useRef(!1),i=b.useRef(!1);return a.jsx(y3,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:r=>{var o,l;(o=n.onCloseAutoFocus)==null||o.call(n,r),r.defaultPrevented||(s.current||(l=t.triggerRef.current)==null||l.focus(),r.preventDefault()),s.current=!1,i.current=!1},onInteractOutside:r=>{var c,d;(c=n.onInteractOutside)==null||c.call(n,r),r.defaultPrevented||(s.current=!0,r.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=r.target;((d=t.triggerRef.current)==null?void 0:d.contains(o))&&r.preventDefault(),r.detail.originalEvent.type==="focusin"&&i.current&&r.preventDefault()}})}),y3=b.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:r,disableOutsidePointerEvents:o,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onInteractOutside:u,...h}=n,p=Ha(Td,t),f=Xp(t);return S1(),a.jsx(fx,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:i,onUnmountAutoFocus:r,children:a.jsx(Hp,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:u,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:d,onDismiss:()=>p.onOpenChange(!1),children:a.jsx(l3,{"data-state":x3(p.open),role:"dialog",id:p.contentId,...f,...h,ref:e,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),v3="PopoverClose",Lue=b.forwardRef((n,e)=>{const{__scopePopover:t,...s}=n,i=Ha(v3,t);return a.jsx(Ge.button,{type:"button",...s,ref:e,onClick:me(n.onClick,()=>i.onOpenChange(!1))})});Lue.displayName=v3;var Fue="PopoverArrow",Bue=b.forwardRef((n,e)=>{const{__scopePopover:t,...s}=n,i=Xp(t);return a.jsx(c3,{...i,...s,ref:e})});Bue.displayName=Fue;function x3(n){return n?"open":"closed"}var $1=u3,z1=f3,W1=g3,H1=m3;function Mo(n,e){const t=G(),s=b.useRef(!1),i=An(),r=b.useCallback(l=>{s.current=l,t.run(()=>{l?(t.complete(),t.addOpenMenu(n)):t.updateInstanceState({openMenus:t.getOpenMenus().filter(c=>!c.startsWith(n))}),e==null||e(l)})},[t,n,e]),o=q("is menu open",()=>t.getOpenMenus().includes(n),[t,n]);return b.useEffect(()=>(s.current&&(i("open-menu",{source:"unknown",id:n}),t.addOpenMenu(n)),()=>{s.current&&(t.deleteOpenMenu(n),t.getOpenMenus().forEach(l=>{l.startsWith(n)&&(i("close-menu",{source:"unknown",id:n}),t.deleteOpenMenu(l))}),s.current=!1)}),[t,n,i]),[o,r]}function G1({id:n,children:e,onOpenChange:t,open:s}){const[i,r]=Mo(n,t);return a.jsx($1,{onOpenChange:r,open:s||i,children:a.jsx("div",{className:"tlui-popover",children:e})})}function V1({children:n}){return a.jsx(z1,{asChild:!0,dir:"ltr",children:n})}function K1({side:n,children:e,align:t="center",sideOffset:s=8,alignOffset:i=0}){const r=fn();return a.jsx(W1,{container:r,children:a.jsx(H1,{className:"tlui-popover__content",side:n,sideOffset:s,align:t,alignOffset:i,dir:"ltr",children:e})})}const S3=b.createContext(null);function Nx(){const n=b.useContext(S3);if(!n)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return n}function _i({type:n,sourceId:e,children:t}){return a.jsx(S3.Provider,{value:{type:n,sourceId:e},children:t})}function Uue(n){return n.getSelectedShapeIds().map(s=>n.getShape(s)).filter(s=>{if(!s)return!1;if(n.isShapeOfType(s,"arrow")){const i=Cs(n,s);if(i.start||i.end)return!1}return!0})}const w3=()=>{const n=G();return q("threeStackableItems",()=>Uue(n).length>2,[n])},Oo=()=>{const n=G();return q("isInSelectState",()=>n.isIn("select"),[n])},b3=()=>{const n=G();return q("allow group",()=>{const e=n.getSelectedShapes();if(e.length<2)return!1;for(const t of e)if(n.isShapeOfType(t,"arrow")){const s=Cs(n,t);if(s.start&&!e.some(i=>i.id===s.start.toId)||s.end&&!e.some(i=>i.id===s.end.toId))return!1}return!0},[n])},_3=()=>{const n=G();return q("allowUngroup",()=>n.getSelectedShapeIds().some(e=>{var t;return((t=n.getShape(e))==null?void 0:t.type)==="group"}),[n])},$ue=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function C3(n,e){const t=G();return q("selectedShapes",()=>t.getSelectedShapes().length>=n,[t,n,e])}function ps(n,e){const t=G();return q("selectedShapes",()=>{const s=t.getSelectedShapes().filter(i=>!t.isShapeOrAncestorLocked(i)).length;return n===void 0?s:s>=n},[t])}function zue(){const n=G();return q("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}function E3(){const n=G();return q("hasLinkShapeSelected",()=>{const e=n.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[n])}function Wue(){const n=G();return q("onlyFlippableShape",()=>{const e=n.getOnlySelectedShape();return e&&(n.isShapeOfType(e,"group")||n.isShapeOfType(e,"image")||n.isShapeOfType(e,"arrow")||n.isShapeOfType(e,"line")||n.isShapeOfType(e,"draw"))},[n])}function T3(){const n=G();return q("useCanRedo",()=>n.getCanRedo(),[n])}function I3(){const n=G();return q("useCanUndo",()=>n.getCanUndo(),[n])}var Hue=b.createContext(void 0);function Y1(n){const e=b.useContext(Hue);return n||e||"ltr"}var $w="rovingFocusGroup.onEntryFocus",Gue={bubbles:!1,cancelable:!0},qp="RovingFocusGroup",[T_,P3,Vue]=vx(qp),[Kue,k3]=Fr(qp,[Vue]),[Yue,Xue]=Kue(qp),A3=b.forwardRef((n,e)=>a.jsx(T_.Provider,{scope:n.__scopeRovingFocusGroup,children:a.jsx(T_.Slot,{scope:n.__scopeRovingFocusGroup,children:a.jsx(que,{...n,ref:e})})}));A3.displayName=qp;var que=b.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:s,loop:i=!1,dir:r,currentTabStopId:o,defaultCurrentTabStopId:l,onCurrentTabStopIdChange:c,onEntryFocus:d,preventScrollOnEntryFocus:u=!1,...h}=n,p=b.useRef(null),f=dt(e,p),g=Y1(r),[m,x]=Wa({prop:o,defaultProp:l??null,onChange:c,caller:qp}),[y,S]=b.useState(!1),v=os(d),C=P3(t),T=b.useRef(!1),[I,E]=b.useState(0);return b.useEffect(()=>{const P=p.current;if(P)return P.addEventListener($w,v),()=>P.removeEventListener($w,v)},[v]),a.jsx(Yue,{scope:t,orientation:s,dir:g,loop:i,currentTabStopId:m,onItemFocus:b.useCallback(P=>x(P),[x]),onItemShiftTab:b.useCallback(()=>S(!0),[]),onFocusableItemAdd:b.useCallback(()=>E(P=>P+1),[]),onFocusableItemRemove:b.useCallback(()=>E(P=>P-1),[]),children:a.jsx(Ge.div,{tabIndex:y||I===0?-1:0,"data-orientation":s,...h,ref:f,style:{outline:"none",...n.style},onMouseDown:me(n.onMouseDown,()=>{T.current=!0}),onFocus:me(n.onFocus,P=>{const k=!T.current;if(P.target===P.currentTarget&&k&&!y){const j=new CustomEvent($w,Gue);if(P.currentTarget.dispatchEvent(j),!j.defaultPrevented){const D=C().filter(L=>L.focusable),R=D.find(L=>L.active),A=D.find(L=>L.id===m),B=[R,A,...D].filter(Boolean).map(L=>L.ref.current);R3(B,u)}}T.current=!1}),onBlur:me(n.onBlur,()=>S(!1))})})}),j3="RovingFocusGroupItem",N3=b.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:s=!0,active:i=!1,tabStopId:r,children:o,...l}=n,c=po(),d=r||c,u=Xue(j3,t),h=u.currentTabStopId===d,p=P3(t),{onFocusableItemAdd:f,onFocusableItemRemove:g,currentTabStopId:m}=u;return b.useEffect(()=>{if(s)return f(),()=>g()},[s,f,g]),a.jsx(T_.ItemSlot,{scope:t,id:d,focusable:s,active:i,children:a.jsx(Ge.span,{tabIndex:h?0:-1,"data-orientation":u.orientation,...l,ref:e,onMouseDown:me(n.onMouseDown,x=>{s?u.onItemFocus(d):x.preventDefault()}),onFocus:me(n.onFocus,()=>u.onItemFocus(d)),onKeyDown:me(n.onKeyDown,x=>{if(x.key==="Tab"&&x.shiftKey){u.onItemShiftTab();return}if(x.target!==x.currentTarget)return;const y=Que(x,u.orientation,u.dir);if(y!==void 0){if(x.metaKey||x.ctrlKey||x.altKey||x.shiftKey)return;x.preventDefault();let v=p().filter(C=>C.focusable).map(C=>C.ref.current);if(y==="last")v.reverse();else if(y==="prev"||y==="next"){y==="prev"&&v.reverse();const C=v.indexOf(x.currentTarget);v=u.loop?ehe(v,C+1):v.slice(C+1)}setTimeout(()=>R3(v))}}),children:typeof o=="function"?o({isCurrentTabStop:h,hasTabStop:m!=null}):o})})});N3.displayName=j3;var Zue={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Jue(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function Que(n,e,t){const s=Jue(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(s))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(s)))return Zue[s]}function R3(n,e=!1){const t=document.activeElement;for(const s of n)if(s===t||(s.focus({preventScroll:e}),document.activeElement!==t))return}function ehe(n,e){return n.map((t,s)=>n[(e+s)%n.length])}var the=A3,nhe=N3,I_=["Enter"," "],she=["ArrowDown","PageUp","Home"],M3=["ArrowUp","PageDown","End"],ihe=[...she,...M3],rhe={ltr:[...I_,"ArrowRight"],rtl:[...I_,"ArrowLeft"]},ohe={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Zp="Menu",[lp,ahe,lhe]=vx(Zp),[Ql,Rx]=Fr(Zp,[lhe,Ax,k3]),Jp=Ax(),O3=k3(),[D3,Ga]=Ql(Zp),[che,Qp]=Ql(Zp),L3=n=>{const{__scopeMenu:e,open:t=!1,children:s,dir:i,onOpenChange:r,modal:o=!0}=n,l=Jp(e),[c,d]=b.useState(null),u=b.useRef(!1),h=os(r),p=Y1(i);return b.useEffect(()=>{const f=()=>{u.current=!0,document.addEventListener("pointerdown",g,{capture:!0,once:!0}),document.addEventListener("pointermove",g,{capture:!0,once:!0})},g=()=>u.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",g,{capture:!0}),document.removeEventListener("pointermove",g,{capture:!0})}},[]),a.jsx(F1,{...l,children:a.jsx(D3,{scope:e,open:t,onOpenChange:h,content:c,onContentChange:d,children:a.jsx(che,{scope:e,onClose:b.useCallback(()=>h(!1),[h]),isUsingKeyboardRef:u,dir:p,modal:o,children:s})})})};L3.displayName=Zp;var dhe="MenuAnchor",X1=b.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n,i=Jp(t);return a.jsx(B1,{...i,...s,ref:e})});X1.displayName=dhe;var q1="MenuPortal",[uhe,F3]=Ql(q1,{forceMount:void 0}),B3=n=>{const{__scopeMenu:e,forceMount:t,children:s,container:i}=n,r=Ga(q1,e);return a.jsx(uhe,{scope:e,forceMount:t,children:a.jsx(Qi,{present:t||r.open,children:a.jsx(Gp,{asChild:!0,container:i,children:s})})})};B3.displayName=q1;var Si="MenuContent",[hhe,Z1]=Ql(Si),U3=b.forwardRef((n,e)=>{const t=F3(Si,n.__scopeMenu),{forceMount:s=t.forceMount,...i}=n,r=Ga(Si,n.__scopeMenu),o=Qp(Si,n.__scopeMenu);return a.jsx(lp.Provider,{scope:n.__scopeMenu,children:a.jsx(Qi,{present:s||r.open,children:a.jsx(lp.Slot,{scope:n.__scopeMenu,children:o.modal?a.jsx(phe,{...i,ref:e}):a.jsx(fhe,{...i,ref:e})})})})}),phe=b.forwardRef((n,e)=>{const t=Ga(Si,n.__scopeMenu),s=b.useRef(null),i=dt(e,s);return b.useEffect(()=>{const r=s.current;if(r)return w1(r)},[]),a.jsx(J1,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:me(n.onFocusOutside,r=>r.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),fhe=b.forwardRef((n,e)=>{const t=Ga(Si,n.__scopeMenu);return a.jsx(J1,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),ghe=Cd("MenuContent.ScrollLock"),J1=b.forwardRef((n,e)=>{const{__scopeMenu:t,loop:s=!1,trapFocus:i,onOpenAutoFocus:r,onCloseAutoFocus:o,disableOutsidePointerEvents:l,onEntryFocus:c,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:p,onDismiss:f,disableOutsideScroll:g,...m}=n,x=Ga(Si,t),y=Qp(Si,t),S=Jp(t),v=O3(t),C=ahe(t),[T,I]=b.useState(null),E=b.useRef(null),P=dt(e,E,x.onContentChange),k=b.useRef(0),j=b.useRef(""),D=b.useRef(0),R=b.useRef(null),A=b.useRef("right"),N=b.useRef(0),B=g?mx:b.Fragment,L=g?{as:ghe,allowPinchZoom:!0}:void 0,O=W=>{var ae,ce;const $=j.current+W,K=C().filter(he=>!he.disabled),Y=document.activeElement,U=(ae=K.find(he=>he.ref.current===Y))==null?void 0:ae.textValue,J=K.map(he=>he.textValue),te=Ihe(J,$,U),ee=(ce=K.find(he=>he.textValue===te))==null?void 0:ce.ref.current;(function he(Ee){j.current=Ee,window.clearTimeout(k.current),Ee!==""&&(k.current=window.setTimeout(()=>he(""),1e3))})($),ee&&setTimeout(()=>ee.focus())};b.useEffect(()=>()=>window.clearTimeout(k.current),[]),S1();const F=b.useCallback(W=>{var K,Y;return A.current===((K=R.current)==null?void 0:K.side)&&khe(W,(Y=R.current)==null?void 0:Y.area)},[]);return a.jsx(hhe,{scope:t,searchRef:j,onItemEnter:b.useCallback(W=>{F(W)&&W.preventDefault()},[F]),onItemLeave:b.useCallback(W=>{var $;F(W)||(($=E.current)==null||$.focus(),I(null))},[F]),onTriggerLeave:b.useCallback(W=>{F(W)&&W.preventDefault()},[F]),pointerGraceTimerRef:D,onPointerGraceIntentChange:b.useCallback(W=>{R.current=W},[]),children:a.jsx(B,{...L,children:a.jsx(fx,{asChild:!0,trapped:i,onMountAutoFocus:me(r,W=>{var $;W.preventDefault(),($=E.current)==null||$.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:a.jsx(Hp,{asChild:!0,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:u,onFocusOutside:h,onInteractOutside:p,onDismiss:f,children:a.jsx(the,{asChild:!0,...v,dir:y.dir,orientation:"vertical",loop:s,currentTabStopId:T,onCurrentTabStopIdChange:I,onEntryFocus:me(c,W=>{y.isUsingKeyboardRef.current||W.preventDefault()}),preventScrollOnEntryFocus:!0,children:a.jsx(l3,{role:"menu","aria-orientation":"vertical","data-state":sU(x.open),"data-radix-menu-content":"",dir:y.dir,...S,...m,ref:P,style:{outline:"none",...m.style},onKeyDown:me(m.onKeyDown,W=>{const K=W.target.closest("[data-radix-menu-content]")===W.currentTarget,Y=W.ctrlKey||W.altKey||W.metaKey,U=W.key.length===1;K&&(W.key==="Tab"&&W.preventDefault(),!Y&&U&&O(W.key));const J=E.current;if(W.target!==J||!ihe.includes(W.key))return;W.preventDefault();const ee=C().filter(ae=>!ae.disabled).map(ae=>ae.ref.current);M3.includes(W.key)&&ee.reverse(),Ehe(ee)}),onBlur:me(n.onBlur,W=>{W.currentTarget.contains(W.target)||(window.clearTimeout(k.current),j.current="")}),onPointerMove:me(n.onPointerMove,cp(W=>{const $=W.target,K=N.current!==W.clientX;if(W.currentTarget.contains($)&&K){const Y=W.clientX>N.current?"right":"left";A.current=Y,N.current=W.clientX}}))})})})})})})});U3.displayName=Si;var mhe="MenuGroup",Q1=b.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n;return a.jsx(Ge.div,{role:"group",...s,ref:e})});Q1.displayName=mhe;var yhe="MenuLabel",$3=b.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n;return a.jsx(Ge.div,{...s,ref:e})});$3.displayName=yhe;var Yy="MenuItem",Hj="menu.itemSelect",Mx=b.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:s,...i}=n,r=b.useRef(null),o=Qp(Yy,n.__scopeMenu),l=Z1(Yy,n.__scopeMenu),c=dt(e,r),d=b.useRef(!1),u=()=>{const h=r.current;if(!t&&h){const p=new CustomEvent(Hj,{bubbles:!0,cancelable:!0});h.addEventListener(Hj,f=>s==null?void 0:s(f),{once:!0}),x1(h,p),p.defaultPrevented?d.current=!1:o.onClose()}};return a.jsx(z3,{...i,ref:c,disabled:t,onClick:me(n.onClick,u),onPointerDown:h=>{var p;(p=n.onPointerDown)==null||p.call(n,h),d.current=!0},onPointerUp:me(n.onPointerUp,h=>{var p;d.current||(p=h.currentTarget)==null||p.click()}),onKeyDown:me(n.onKeyDown,h=>{const p=l.searchRef.current!=="";t||p&&h.key===" "||I_.includes(h.key)&&(h.currentTarget.click(),h.preventDefault())})})});Mx.displayName=Yy;var z3=b.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:s=!1,textValue:i,...r}=n,o=Z1(Yy,t),l=O3(t),c=b.useRef(null),d=dt(e,c),[u,h]=b.useState(!1),[p,f]=b.useState("");return b.useEffect(()=>{const g=c.current;g&&f((g.textContent??"").trim())},[r.children]),a.jsx(lp.ItemSlot,{scope:t,disabled:s,textValue:i??p,children:a.jsx(nhe,{asChild:!0,...l,focusable:!s,children:a.jsx(Ge.div,{role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":s||void 0,"data-disabled":s?"":void 0,...r,ref:d,onPointerMove:me(n.onPointerMove,cp(g=>{s?o.onItemLeave(g):(o.onItemEnter(g),g.defaultPrevented||g.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:me(n.onPointerLeave,cp(g=>o.onItemLeave(g))),onFocus:me(n.onFocus,()=>h(!0)),onBlur:me(n.onBlur,()=>h(!1))})})})}),vhe="MenuCheckboxItem",W3=b.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:s,...i}=n;return a.jsx(Y3,{scope:n.__scopeMenu,checked:t,children:a.jsx(Mx,{role:"menuitemcheckbox","aria-checked":Xy(t)?"mixed":t,...i,ref:e,"data-state":nT(t),onSelect:me(i.onSelect,()=>s==null?void 0:s(Xy(t)?!0:!t),{checkForDefaultPrevented:!1})})})});W3.displayName=vhe;var H3="MenuRadioGroup",[xhe,She]=Ql(H3,{value:void 0,onValueChange:()=>{}}),G3=b.forwardRef((n,e)=>{const{value:t,onValueChange:s,...i}=n,r=os(s);return a.jsx(xhe,{scope:n.__scopeMenu,value:t,onValueChange:r,children:a.jsx(Q1,{...i,ref:e})})});G3.displayName=H3;var V3="MenuRadioItem",K3=b.forwardRef((n,e)=>{const{value:t,...s}=n,i=She(V3,n.__scopeMenu),r=t===i.value;return a.jsx(Y3,{scope:n.__scopeMenu,checked:r,children:a.jsx(Mx,{role:"menuitemradio","aria-checked":r,...s,ref:e,"data-state":nT(r),onSelect:me(s.onSelect,()=>{var o;return(o=i.onValueChange)==null?void 0:o.call(i,t)},{checkForDefaultPrevented:!1})})})});K3.displayName=V3;var eT="MenuItemIndicator",[Y3,whe]=Ql(eT,{checked:!1}),X3=b.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:s,...i}=n,r=whe(eT,t);return a.jsx(Qi,{present:s||Xy(r.checked)||r.checked===!0,children:a.jsx(Ge.span,{...i,ref:e,"data-state":nT(r.checked)})})});X3.displayName=eT;var bhe="MenuSeparator",q3=b.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n;return a.jsx(Ge.div,{role:"separator","aria-orientation":"horizontal",...s,ref:e})});q3.displayName=bhe;var _he="MenuArrow",Z3=b.forwardRef((n,e)=>{const{__scopeMenu:t,...s}=n,i=Jp(t);return a.jsx(c3,{...i,...s,ref:e})});Z3.displayName=_he;var tT="MenuSub",[Che,J3]=Ql(tT),Q3=n=>{const{__scopeMenu:e,children:t,open:s=!1,onOpenChange:i}=n,r=Ga(tT,e),o=Jp(e),[l,c]=b.useState(null),[d,u]=b.useState(null),h=os(i);return b.useEffect(()=>(r.open===!1&&h(!1),()=>h(!1)),[r.open,h]),a.jsx(F1,{...o,children:a.jsx(D3,{scope:e,open:s,onOpenChange:h,content:d,onContentChange:u,children:a.jsx(Che,{scope:e,contentId:po(),triggerId:po(),trigger:l,onTriggerChange:c,children:t})})})};Q3.displayName=tT;var oh="MenuSubTrigger",eU=b.forwardRef((n,e)=>{const t=Ga(oh,n.__scopeMenu),s=Qp(oh,n.__scopeMenu),i=J3(oh,n.__scopeMenu),r=Z1(oh,n.__scopeMenu),o=b.useRef(null),{pointerGraceTimerRef:l,onPointerGraceIntentChange:c}=r,d={__scopeMenu:n.__scopeMenu},u=b.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return b.useEffect(()=>u,[u]),b.useEffect(()=>{const h=l.current;return()=>{window.clearTimeout(h),c(null)}},[l,c]),a.jsx(X1,{asChild:!0,...d,children:a.jsx(z3,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":sU(t.open),...n,ref:px(e,i.onTriggerChange),onClick:h=>{var p;(p=n.onClick)==null||p.call(n,h),!(n.disabled||h.defaultPrevented)&&(h.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:me(n.onPointerMove,cp(h=>{r.onItemEnter(h),!h.defaultPrevented&&!n.disabled&&!t.open&&!o.current&&(r.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{t.onOpenChange(!0),u()},100))})),onPointerLeave:me(n.onPointerLeave,cp(h=>{var f,g;u();const p=(f=t.content)==null?void 0:f.getBoundingClientRect();if(p){const m=(g=t.content)==null?void 0:g.dataset.side,x=m==="right",y=x?-5:5,S=p[x?"left":"right"],v=p[x?"right":"left"];r.onPointerGraceIntentChange({area:[{x:h.clientX+y,y:h.clientY},{x:S,y:p.top},{x:v,y:p.top},{x:v,y:p.bottom},{x:S,y:p.bottom}],side:m}),window.clearTimeout(l.current),l.current=window.setTimeout(()=>r.onPointerGraceIntentChange(null),300)}else{if(r.onTriggerLeave(h),h.defaultPrevented)return;r.onPointerGraceIntentChange(null)}})),onKeyDown:me(n.onKeyDown,h=>{var f;const p=r.searchRef.current!=="";n.disabled||p&&h.key===" "||rhe[s.dir].includes(h.key)&&(t.onOpenChange(!0),(f=t.content)==null||f.focus(),h.preventDefault())})})})});eU.displayName=oh;var tU="MenuSubContent",nU=b.forwardRef((n,e)=>{const t=F3(Si,n.__scopeMenu),{forceMount:s=t.forceMount,...i}=n,r=Ga(Si,n.__scopeMenu),o=Qp(Si,n.__scopeMenu),l=J3(tU,n.__scopeMenu),c=b.useRef(null),d=dt(e,c);return a.jsx(lp.Provider,{scope:n.__scopeMenu,children:a.jsx(Qi,{present:s||r.open,children:a.jsx(lp.Slot,{scope:n.__scopeMenu,children:a.jsx(J1,{id:l.contentId,"aria-labelledby":l.triggerId,...i,ref:d,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var h;o.isUsingKeyboardRef.current&&((h=c.current)==null||h.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:me(n.onFocusOutside,u=>{u.target!==l.trigger&&r.onOpenChange(!1)}),onEscapeKeyDown:me(n.onEscapeKeyDown,u=>{o.onClose(),u.preventDefault()}),onKeyDown:me(n.onKeyDown,u=>{var f;const h=u.currentTarget.contains(u.target),p=ohe[o.dir].includes(u.key);h&&p&&(r.onOpenChange(!1),(f=l.trigger)==null||f.focus(),u.preventDefault())})})})})})});nU.displayName=tU;function sU(n){return n?"open":"closed"}function Xy(n){return n==="indeterminate"}function nT(n){return Xy(n)?"indeterminate":n?"checked":"unchecked"}function Ehe(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function The(n,e){return n.map((t,s)=>n[(e+s)%n.length])}function Ihe(n,e,t){const i=e.length>1&&Array.from(e).every(d=>d===e[0])?e[0]:e,r=t?n.indexOf(t):-1;let o=The(n,Math.max(r,0));i.length===1&&(o=o.filter(d=>d!==t));const c=o.find(d=>d.toLowerCase().startsWith(i.toLowerCase()));return c!==t?c:void 0}function Phe(n,e){const{x:t,y:s}=n;let i=!1;for(let r=0,o=e.length-1;r<e.length;o=r++){const l=e[r],c=e[o],d=l.x,u=l.y,h=c.x,p=c.y;u>s!=p>s&&t<(h-d)*(s-u)/(p-u)+d&&(i=!i)}return i}function khe(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return Phe(t,e)}function cp(n){return e=>e.pointerType==="mouse"?n(e):void 0}var iU=L3,rU=X1,oU=B3,aU=U3,lU=Q1,cU=$3,dU=Mx,uU=W3,hU=G3,pU=K3,fU=X3,gU=q3,mU=Z3,yU=Q3,vU=eU,xU=nU,sT="ContextMenu",[Ahe]=Fr(sT,[Rx]),Jn=Rx(),[jhe,SU]=Ahe(sT),wU=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:s,dir:i,modal:r=!0}=n,[o,l]=b.useState(!1),c=Jn(e),d=os(s),u=b.useCallback(h=>{l(h),d(h)},[d]);return a.jsx(jhe,{scope:e,open:o,onOpenChange:u,modal:r,children:a.jsx(iU,{...c,dir:i,open:o,onOpenChange:u,modal:r,children:t})})};wU.displayName=sT;var bU="ContextMenuTrigger",_U=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:s=!1,...i}=n,r=SU(bU,t),o=Jn(t),l=b.useRef({x:0,y:0}),c=b.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...l.current})}),d=b.useRef(0),u=b.useCallback(()=>window.clearTimeout(d.current),[]),h=p=>{l.current={x:p.clientX,y:p.clientY},r.onOpenChange(!0)};return b.useEffect(()=>u,[u]),b.useEffect(()=>void(s&&u()),[s,u]),a.jsxs(a.Fragment,{children:[a.jsx(rU,{...o,virtualRef:c}),a.jsx(Ge.span,{"data-state":r.open?"open":"closed","data-disabled":s?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:s?n.onContextMenu:me(n.onContextMenu,p=>{u(),h(p),p.preventDefault()}),onPointerDown:s?n.onPointerDown:me(n.onPointerDown,wg(p=>{u(),d.current=window.setTimeout(()=>h(p),700)})),onPointerMove:s?n.onPointerMove:me(n.onPointerMove,wg(u)),onPointerCancel:s?n.onPointerCancel:me(n.onPointerCancel,wg(u)),onPointerUp:s?n.onPointerUp:me(n.onPointerUp,wg(u))})]})});_U.displayName=bU;var Nhe="ContextMenuPortal",iT=n=>{const{__scopeContextMenu:e,...t}=n,s=Jn(e);return a.jsx(oU,{...s,...t})};iT.displayName=Nhe;var CU="ContextMenuContent",EU=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=SU(CU,t),r=Jn(t),o=b.useRef(!1);return a.jsx(aU,{...r,...s,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:l=>{var c;(c=n.onCloseAutoFocus)==null||c.call(n,l),!l.defaultPrevented&&o.current&&l.preventDefault(),o.current=!1},onInteractOutside:l=>{var c;(c=n.onInteractOutside)==null||c.call(n,l),!l.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});EU.displayName=CU;var Rhe="ContextMenuGroup",TU=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(lU,{...i,...s,ref:e})});TU.displayName=Rhe;var Mhe="ContextMenuLabel",Ohe=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(cU,{...i,...s,ref:e})});Ohe.displayName=Mhe;var Dhe="ContextMenuItem",IU=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(dU,{...i,...s,ref:e})});IU.displayName=Dhe;var Lhe="ContextMenuCheckboxItem",PU=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(uU,{...i,...s,ref:e})});PU.displayName=Lhe;var Fhe="ContextMenuRadioGroup",Bhe=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(hU,{...i,...s,ref:e})});Bhe.displayName=Fhe;var Uhe="ContextMenuRadioItem",$he=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(pU,{...i,...s,ref:e})});$he.displayName=Uhe;var zhe="ContextMenuItemIndicator",Whe=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(fU,{...i,...s,ref:e})});Whe.displayName=zhe;var Hhe="ContextMenuSeparator",Ghe=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(gU,{...i,...s,ref:e})});Ghe.displayName=Hhe;var Vhe="ContextMenuArrow",Khe=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(mU,{...i,...s,ref:e})});Khe.displayName=Vhe;var kU="ContextMenuSub",AU=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:s,open:i,defaultOpen:r}=n,o=Jn(e),[l,c]=Wa({prop:i,defaultProp:r??!1,onChange:s,caller:kU});return a.jsx(yU,{...o,open:l,onOpenChange:c,children:t})};AU.displayName=kU;var Yhe="ContextMenuSubTrigger",jU=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(vU,{...i,...s,ref:e})});jU.displayName=Yhe;var Xhe="ContextMenuSubContent",NU=b.forwardRef((n,e)=>{const{__scopeContextMenu:t,...s}=n,i=Jn(t);return a.jsx(xU,{...i,...s,ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});NU.displayName=Xhe;function wg(n){return e=>e.pointerType!=="mouse"?n(e):void 0}var qhe=wU,Zhe=_U,Jhe=iT,Qhe=EU,epe=PU;const RU=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,tpe=RU?"":"Ctrl",npe=RU?"":"Alt";function MU(n){return n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,tpe).replace(/\?/g,npe).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)})}function P_(n){return" "+MU(n).join("")}function spe(n){return a.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:a.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[a.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),a.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:a.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}var Ox="DropdownMenu",[ipe]=Fr(Ox,[Rx]),Qn=Rx(),[rpe,OU]=ipe(Ox),DU=n=>{const{__scopeDropdownMenu:e,children:t,dir:s,open:i,defaultOpen:r,onOpenChange:o,modal:l=!0}=n,c=Qn(e),d=b.useRef(null),[u,h]=Wa({prop:i,defaultProp:r??!1,onChange:o,caller:Ox});return a.jsx(rpe,{scope:e,triggerId:po(),triggerRef:d,contentId:po(),open:u,onOpenChange:h,onOpenToggle:b.useCallback(()=>h(p=>!p),[h]),modal:l,children:a.jsx(iU,{...c,open:u,onOpenChange:h,dir:s,modal:l,children:t})})};DU.displayName=Ox;var LU="DropdownMenuTrigger",FU=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:s=!1,...i}=n,r=OU(LU,t),o=Qn(t);return a.jsx(rU,{asChild:!0,...o,children:a.jsx(Ge.button,{type:"button",id:r.triggerId,"aria-haspopup":"menu","aria-expanded":r.open,"aria-controls":r.open?r.contentId:void 0,"data-state":r.open?"open":"closed","data-disabled":s?"":void 0,disabled:s,...i,ref:px(e,r.triggerRef),onPointerDown:me(n.onPointerDown,l=>{!s&&l.button===0&&l.ctrlKey===!1&&(r.onOpenToggle(),r.open||l.preventDefault())}),onKeyDown:me(n.onKeyDown,l=>{s||(["Enter"," "].includes(l.key)&&r.onOpenToggle(),l.key==="ArrowDown"&&r.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(l.key)&&l.preventDefault())})})})});FU.displayName=LU;var ope="DropdownMenuPortal",BU=n=>{const{__scopeDropdownMenu:e,...t}=n,s=Qn(e);return a.jsx(oU,{...s,...t})};BU.displayName=ope;var UU="DropdownMenuContent",$U=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=OU(UU,t),r=Qn(t),o=b.useRef(!1);return a.jsx(aU,{id:i.contentId,"aria-labelledby":i.triggerId,...r,...s,ref:e,onCloseAutoFocus:me(n.onCloseAutoFocus,l=>{var c;o.current||(c=i.triggerRef.current)==null||c.focus(),o.current=!1,l.preventDefault()}),onInteractOutside:me(n.onInteractOutside,l=>{const c=l.detail.originalEvent,d=c.button===0&&c.ctrlKey===!0,u=c.button===2||d;(!i.modal||u)&&(o.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});$U.displayName=UU;var ape="DropdownMenuGroup",zU=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(lU,{...i,...s,ref:e})});zU.displayName=ape;var lpe="DropdownMenuLabel",cpe=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(cU,{...i,...s,ref:e})});cpe.displayName=lpe;var dpe="DropdownMenuItem",WU=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(dU,{...i,...s,ref:e})});WU.displayName=dpe;var upe="DropdownMenuCheckboxItem",HU=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(uU,{...i,...s,ref:e})});HU.displayName=upe;var hpe="DropdownMenuRadioGroup",ppe=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(hU,{...i,...s,ref:e})});ppe.displayName=hpe;var fpe="DropdownMenuRadioItem",gpe=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(pU,{...i,...s,ref:e})});gpe.displayName=fpe;var mpe="DropdownMenuItemIndicator",ype=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(fU,{...i,...s,ref:e})});ype.displayName=mpe;var vpe="DropdownMenuSeparator",xpe=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(gU,{...i,...s,ref:e})});xpe.displayName=vpe;var Spe="DropdownMenuArrow",wpe=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(mU,{...i,...s,ref:e})});wpe.displayName=Spe;var bpe=n=>{const{__scopeDropdownMenu:e,children:t,open:s,onOpenChange:i,defaultOpen:r}=n,o=Qn(e),[l,c]=Wa({prop:s,defaultProp:r??!1,onChange:i,caller:"DropdownMenuSub"});return a.jsx(yU,{...o,open:l,onOpenChange:c,children:t})},_pe="DropdownMenuSubTrigger",GU=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(vU,{...i,...s,ref:e})});GU.displayName=_pe;var Cpe="DropdownMenuSubContent",VU=b.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...s}=n,i=Qn(t);return a.jsx(xU,{...i,...s,ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});VU.displayName=Cpe;var rT=DU,oT=FU,Dx=BU,aT=$U,Epe=zU,Tpe=WU,Ipe=HU,Ppe=bpe,kpe=GU,Ape=VU;function Fl({id:n,children:e,modal:t=!1,debugOpen:s=!1}){const[i,r]=Mo(n);return a.jsx(rT,{open:s||i,dir:"ltr",modal:t,onOpenChange:r,children:e})}function Bl({children:n,...e}){return a.jsx(oT,{dir:"ltr",asChild:!0,onTouchEnd:t=>ze(t),...e,children:n})}function Ul({side:n="bottom",align:e="start",sideOffset:t=8,alignOffset:s=8,children:i}){const r=fn();return a.jsx(Dx,{container:r,children:a.jsx(aT,{className:"tlui-menu",side:n,sideOffset:t,align:e,alignOffset:s,collisionPadding:4,children:i})})}function jpe({id:n,children:e}){const[t,s]=Mo(n);return a.jsx(Ppe,{open:t,onOpenChange:s,children:e})}function Npe({id:n,label:e,title:t,disabled:s}){return a.jsx(kpe,{dir:"ltr",asChild:!0,disabled:s,children:a.jsxs(we,{"data-testid":n,type:"menu",className:"tlui-menu__submenu__trigger",disabled:s,title:t,children:[a.jsx(Vt,{children:e}),a.jsx(De,{icon:"chevron-right",small:!0})]})})}function Rpe({id:n,alignOffset:e=-1,sideOffset:t=-4,size:s="small",children:i}){const r=fn();return a.jsx(Dx,{container:r,children:a.jsx(Ape,{"data-testid":n,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,"data-size":s,children:i})})}function Mpe({children:n}){return a.jsx(Epe,{dir:"ltr",className:"tlui-menu__group",children:n})}function dp({noClose:n,children:e}){return a.jsx(Tpe,{dir:"ltr",asChild:!0,onClick:n?ze:void 0,children:e})}function Eh({children:n,visibleOnMobileLayout:e=!1}){const t=hs();return!e&&t<zt.MOBILE?null:a.jsx("kbd",{className:"tlui-kbd",children:MU(n).map((s,i)=>a.jsx("span",{children:s},i))})}function X({disabled:n=!1,spinner:e=!1,readonlyOk:t=!1,id:s,kbd:i,label:r,icon:o,onSelect:l,noClose:c,isSelected:d}){const{type:u,sourceId:h}=Nx(),p=Fe(),[f,g]=b.useState(!1);if(Ro()&&!t)return null;const x=op(r,u),y=i?P_(i):void 0,S=x?p(x):void 0,v=S&&y?`${S} ${y}`:S;switch(u){case"menu":return a.jsx(dp,{children:a.jsxs(we,{type:"menu","data-testid":`${h}.${s}`,disabled:n,title:v,onClick:C=>{c&&ze(C),f?g(!1):l(h)},children:[a.jsx(Vt,{children:S}),i&&a.jsx(Eh,{children:i})]})});case"context-menu":return n?null:a.jsxs(IU,{dir:"ltr",title:v,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${h}.${s}`,onSelect:C=>{c&&ze(C),f?g(!1):l(h)},children:[a.jsx("span",{className:"tlui-button__label",draggable:!1,children:S}),i&&a.jsx(Eh,{children:i}),e&&a.jsx(spe,{})]});case"panel":return a.jsxs(we,{"data-testid":`${h}.${s}`,type:"menu",title:v,disabled:n,onClick:()=>l(h),children:[a.jsx(Vt,{children:S}),o&&a.jsx(De,{icon:o})]});case"small-icons":case"icons":return a.jsx(we,{"data-testid":`${h}.${s}`,type:"icon",title:v,disabled:n,onClick:()=>l(h),children:a.jsx(De,{icon:o,small:u==="small-icons"})});case"keyboard-shortcuts":return i?a.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${h}.${s}`,children:[a.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:S}),a.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:a.jsx(Eh,{visibleOnMobileLayout:!0,children:i})})]}):(console.warn(`Menu item '${r}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return a.jsxs(we,{type:"low",onClick:()=>l(h),children:[a.jsx(De,{icon:o}),a.jsx(Vt,{children:S})]});case"toolbar":return a.jsx(we,{type:"tool","data-testid":`tools.${s}`,"aria-label":x,"data-value":s,onClick:()=>l("toolbar"),title:v,onTouchStart:C=>{ze(C),l("toolbar")},role:"radio","aria-checked":d?"true":"false",children:a.jsx(De,{icon:o})});case"toolbar-overflow":return a.jsx(dp,{"aria-label":r,children:a.jsx(we,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{l("toolbar")},"data-testid":`tools.more.${s}`,title:v,role:"radio","aria-checked":d?"true":"false","data-value":s,children:a.jsx(De,{icon:o})})});default:throw Vn(u)}}function Ope(){return a.jsxs(a.Fragment,{children:[a.jsx(Dpe,{}),a.jsx(Lpe,{}),a.jsx(Fpe,{}),a.jsx(Bpe,{}),a.jsx(Upe,{}),a.jsx(Wpe,{}),a.jsx(Hpe,{}),a.jsx(Gpe,{})]})}function Dpe(){const n=xe(),e=ps(2),t=Oo(),s=e&&t;return a.jsxs(a.Fragment,{children:[a.jsx(X,{...n["align-left"],disabled:!s}),a.jsx(X,{...n["align-center-horizontal"],disabled:!s}),a.jsx(X,{...n["align-right"],disabled:!s}),a.jsx(X,{...n["stretch-horizontal"],disabled:!s}),a.jsx(X,{...n["align-top"],disabled:!s}),a.jsx(X,{...n["align-center-vertical"],disabled:!s}),a.jsx(X,{...n["align-bottom"],disabled:!s}),a.jsx(X,{...n["stretch-vertical"],disabled:!s})]})}function Lpe(){const n=xe(),e=ps(3),t=Oo(),s=e&&t;return a.jsxs(a.Fragment,{children:[a.jsx(X,{...n["distribute-horizontal"],disabled:!s}),a.jsx(X,{...n["distribute-vertical"],disabled:!s})]})}function Fpe(){const n=xe(),e=w3(),t=Oo(),s=e&&t;return a.jsxs(a.Fragment,{children:[a.jsx(X,{...n["stack-horizontal"],disabled:!s}),a.jsx(X,{...n["stack-vertical"],disabled:!s})]})}function Bpe(){const n=xe(),e=ps(1),t=Oo(),s=e&&t;return a.jsxs(a.Fragment,{children:[a.jsx(X,{...n["send-to-back"],disabled:!s}),a.jsx(X,{...n["send-backward"],disabled:!s}),a.jsx(X,{...n["bring-forward"],disabled:!s}),a.jsx(X,{...n["bring-to-front"],disabled:!s})]})}function Upe(){return hs()<zt.TABLET_SM?a.jsx($pe,{}):a.jsx(zpe,{})}function $pe(){const n=xe(),e=G(),t=q("zoom is 1",()=>e.getZoomLevel()===1,[e]);return a.jsx(X,{...n["zoom-to-100"],disabled:t})}function zpe(){const n=xe(),e=ps(1),t=Oo(),s=e&&t;return a.jsx(X,{...n["rotate-ccw"],disabled:!s})}function Wpe(){const n=xe(),e=ps(1),t=Oo(),s=e&&t;return a.jsx(X,{...n["rotate-cw"],disabled:!s})}function Hpe(){const n=xe(),e=E3(),t=Oo(),s=e&&t;return a.jsx(X,{...n["edit-link"],disabled:!s})}function Gpe(){const n=b3(),e=_3();return n?a.jsx(Gj,{}):e?a.jsx(Vpe,{}):a.jsx(Gj,{})}function Gj(){const n=xe(),e=ps(2),t=Oo(),s=e&&t;return a.jsx(X,{...n.group,disabled:!s})}function Vpe(){const n=xe();return a.jsx(X,{...n.ungroup})}const Kpe=b.memo(function({children:e}){const t=Fe(),s=hs(),i=Ro(),r=G(),o=q("should display quick actions when in readonly",()=>r.isInAny("hand","zoom"),[r]),l=e??a.jsx(Ope,{});if(!(i&&!o))return a.jsxs(G1,{id:"actions-menu",children:[a.jsx(V1,{children:a.jsx(we,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:a.jsx(De,{icon:"dots-vertical",small:!0})})}),a.jsx(K1,{side:s>=zt.TABLET?"bottom":"top",sideOffset:6,children:a.jsx("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:a.jsx(_i,{type:"icons",sourceId:"actions-menu",children:l})})})]})});function Ds({id:n,kbd:e,label:t,readonlyOk:s,onSelect:i,toggle:r=!1,disabled:o=!1,checked:l=!1}){const{type:c,sourceId:d}=Nx(),u=Ro(),h=Fe();if(u&&!s)return null;const p=op(t,c),f=p?h(p):void 0;switch(c){case"menu":return a.jsxs(Ipe,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:f,onSelect:g=>{i==null||i(d),ze(g)},disabled:o,checked:l,children:[a.jsx(Mr,{small:!0,icon:r?l?"toggle-on":"toggle-off":l?"check":"none"}),f&&a.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&a.jsx(Eh,{children:e})]});case"context-menu":return a.jsxs(epe,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:f,onSelect:g=>{i(d),ze(g)},disabled:o,checked:l,children:[a.jsx(Mr,{small:!0,icon:r?l?"toggle-on":"toggle-off":l?"check":"none"}),f&&a.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&a.jsx(Eh,{children:e})]},n);default:return null}}function Ie({id:n,label:e,children:t}){const{type:s,sourceId:i}=Nx(),r=Fe(),o=op(e,s),l=o?r(o):void 0;switch(s){case"panel":return a.jsx("div",{className:"tlui-menu__group","data-testid":`${i}-group.${n}`,children:t});case"menu":return a.jsx(Mpe,{"data-testid":`${i}-group.${n}`,children:t});case"context-menu":return a.jsx(TU,{dir:"ltr",className:"tlui-menu__group","data-testid":`${i}-group.${n}`,children:t});case"keyboard-shortcuts":return a.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${i}-group.${n}`,children:[a.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:l}),a.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:t})]});default:return t}}function fs({id:n,disabled:e=!1,label:t,size:s="small",children:i}){const{type:r,sourceId:o}=Nx(),l=fn(),c=Fe(),d=t?typeof t=="string"?t:t[r]??t.default:void 0,u=d?c(d):void 0;switch(r){case"menu":return a.jsxs(jpe,{id:`${o}-sub.${n}`,children:[a.jsx(Npe,{id:`${o}-sub.${u?u.toLowerCase()+"-button":""}`,disabled:e,label:u,title:u}),a.jsx(Rpe,{id:`${o}-sub.${u?u.toLowerCase()+"-content":""}`,size:s,children:i})]});case"context-menu":return e?null:a.jsxs(Ype,{id:`${o}-sub.${n}`,children:[a.jsx(jU,{dir:"ltr",disabled:e,asChild:!0,children:a.jsxs(we,{"data-testid":`${o}-sub-trigger.${n}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[a.jsx(Vt,{children:u}),a.jsx(De,{icon:"chevron-right",small:!0})]})}),a.jsx(iT,{container:l,children:a.jsx(NU,{"data-testid":`${o}-sub-content.${n}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":s,children:i})})]});default:return i}}function Ype({id:n,children:e}){const[t,s]=Mo(n);return a.jsx(AU,{open:t,onOpenChange:s,children:e})}function KU(){const n=xe();return zue()?a.jsx(X,{...n["toggle-auto-size"]}):null}function YU(){const n=xe();return E3()?a.jsx(X,{...n["edit-link"]}):null}function Xpe(){const n=xe();return ps(1)?a.jsx(X,{...n.duplicate}):null}function XU(){const n=xe(),e=G();return q("should display flatten option",()=>{if(e.getSelectedShapeIds().length===0)return!1;const i=e.getOnlySelectedShape();return!(i&&e.isShapeOfType(i,"image"))},[e])?a.jsx(X,{...n["flatten-to-image"]}):null}function qU(){const n=xe();return b3()?a.jsx(X,{...n.group}):null}function ZU(){const n=xe();return _3()?a.jsx(X,{...n.ungroup}):null}function JU(){const n=G(),e=xe();return q("allow unframe",()=>{const s=n.getSelectedShapes();return s.length===0?!1:s.every(i=>n.isShapeOfType(i,"frame"))},[n])?a.jsx(X,{...e["remove-frame"]}):null}function QU(){const n=G(),e=xe();return q("allow fit frame to content",()=>{const s=n.getOnlySelectedShape();return s?n.isShapeOfType(s,"frame")&&n.getSortedChildIdsForParent(s).length>0:!1},[n])?a.jsx(X,{...e["fit-frame-to-content"]}):null}function e$(){const n=G(),e=xe();return q("selected shapes",()=>n.getSelectedShapes().length>0,[n])?a.jsx(X,{...e["toggle-lock"]}):null}function lT(){const n=xe(),e=G(),t=q("isTransparentBg",()=>!e.getInstanceState().exportBackground,[e]);return a.jsx(Ds,{...n["toggle-transparent"],checked:t,toggle:!0})}function qpe(){const n=G(),e=xe(),t=q("any shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return a.jsx(X,{...e["unlock-all"],disabled:!t})}function t$(){const n=G(),e=q("zoomed to 100",()=>n.getZoomLevel()===1,[n]),t=xe();return a.jsx(X,{...t["zoom-to-100"],noClose:!0,disabled:e})}function n$(){const n=G(),e=q("has shapes",()=>n.getCurrentPageShapeIds().size>0,[n]),t=xe();return a.jsx(X,{...t["zoom-to-fit"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function s$(){const n=G(),e=q("has shapes",()=>n.getSelectedShapeIds().length>0,[n]),t=xe();return a.jsx(X,{...t["zoom-to-selection"],disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function i$(){return a.jsxs(Ie,{id:"clipboard",children:[a.jsx(Jpe,{}),a.jsx(Qpe,{}),a.jsx(efe,{}),a.jsx(Xpe,{}),a.jsx(tfe,{})]})}function Zpe(){var s;const n=G(),e=xe(),t=q("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return a.jsxs(fs,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!t,children:[a.jsxs(Ie,{id:"copy-as-group",children:[a.jsx(X,{...e["copy-as-svg"]}),!!((s=window.navigator.clipboard)!=null&&s.write)&&a.jsx(X,{...e["copy-as-png"]}),a.jsx(X,{...e["copy-as-json"]})]}),a.jsx(Ie,{id:"copy-as-bg",children:a.jsx(lT,{})})]})}function Jpe(){const n=xe(),e=ps(1);return a.jsx(X,{...n.cut,disabled:!e})}function Qpe(){const n=xe(),e=C3(1);return a.jsx(X,{...n.copy,disabled:!e})}function efe(){const n=xe(),e=$ue;return a.jsx(X,{...n.paste,disabled:!e})}function r$(){const n=G(),e=xe();return q("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n])?a.jsxs(Ie,{id:"conversions",children:[a.jsx(Zpe,{}),a.jsxs(fs,{id:"export-as",label:"context-menu.export-as",size:"small",children:[a.jsxs(Ie,{id:"export-as-group",children:[a.jsx(X,{...e["export-as-svg"]}),a.jsx(X,{...e["export-as-png"]}),a.jsx(X,{...e["export-as-json"]})]}),a.jsx(Ie,{id:"export-as-bg",children:a.jsx(lT,{})})]})]}):null}function o$(){const n=xe(),e=G(),t=q("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[e]);return a.jsx(X,{...n["select-all"],disabled:!t})}function tfe(){const n=xe(),e=ps(1);return a.jsx(X,{...n.delete,disabled:!e})}function nfe(){return C3(1)?a.jsxs(fs,{id:"edit",label:"context-menu.edit",size:"small",children:[a.jsx(qU,{}),a.jsx(ZU,{}),a.jsx(XU,{}),a.jsx(YU,{}),a.jsx(QU,{}),a.jsx(JU,{}),a.jsx(l$,{}),a.jsx(a$,{}),a.jsx(KU,{}),a.jsx(e$,{})]}):null}function sfe(){const n=ps(2),e=Wue(),t=xe();return n||e?a.jsxs(fs,{id:"arrange",label:"context-menu.arrange",size:"small",children:[n&&a.jsxs(Ie,{id:"align",children:[a.jsx(X,{...t["align-left"]}),a.jsx(X,{...t["align-center-horizontal"]}),a.jsx(X,{...t["align-right"]}),a.jsx(X,{...t["align-top"]}),a.jsx(X,{...t["align-center-vertical"]}),a.jsx(X,{...t["align-bottom"]})]}),a.jsx(ife,{}),n&&a.jsxs(Ie,{id:"stretch",children:[a.jsx(X,{...t["stretch-horizontal"]}),a.jsx(X,{...t["stretch-vertical"]})]}),(n||e)&&a.jsxs(Ie,{id:"flip",children:[a.jsx(X,{...t["flip-horizontal"]}),a.jsx(X,{...t["flip-vertical"]})]}),a.jsx(rfe,{})]}):null}function ife(){const n=xe();return ps(3)?a.jsxs(Ie,{id:"distribute",children:[a.jsx(X,{...n["distribute-horizontal"]}),a.jsx(X,{...n["distribute-vertical"]})]}):null}function rfe(){const n=xe(),e=ps(2),t=w3();return e?a.jsxs(Ie,{id:"order",children:[a.jsx(X,{...n.pack}),t&&a.jsx(X,{...n["stack-horizontal"]}),t&&a.jsx(X,{...n["stack-vertical"]})]}):null}function ofe(){const n=xe();return ps(1)?a.jsx(fs,{id:"reorder",label:"context-menu.reorder",size:"small",children:a.jsxs(Ie,{id:"reorder",children:[a.jsx(X,{...n["bring-to-front"]}),a.jsx(X,{...n["bring-forward"]}),a.jsx(X,{...n["send-backward"]}),a.jsx(X,{...n["send-to-back"]})]})}):null}function afe(){const n=G(),e=q("pages",()=>n.getPages(),[n]),t=q("current page id",()=>n.getCurrentPageId(),[n]),{addToast:s}=tr(),i=xe(),r=An();return ps(1)?a.jsxs(fs,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[a.jsx(Ie,{id:"pages",children:e.map(l=>a.jsx(X,{id:l.id,disabled:t===l.id,label:l.name,onSelect:()=>{n.mark("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),l.id);const c=n.getPage(l.id);c&&s({title:"Changed Page",description:`Moved to ${c.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.mark("change-page"),n.setCurrentPage(t)}}]}),r("move-to-page",{source:"context-menu"})}},l.id))}),a.jsx(Ie,{id:"new-page",children:a.jsx(X,{...i["move-to-new-page"]})})]}):null}function a$(){const n=G(),e=xe();return q("oneEmbedSelected",()=>{const s=n.getOnlySelectedShape();return s?!!(n.isShapeOfType(s,"embed")&&s.props.url&&!n.isShapeOrAncestorLocked(s)):!1},[n])?a.jsx(X,{...e["convert-to-bookmark"]}):null}function l$(){const n=G(),e=xe();return q("oneEmbeddableBookmarkSelected",()=>{const s=n.getOnlySelectedShape();return s?!!(n.isShapeOfType(s,"bookmark")&&s.props.url&&da(s.props.url)&&!n.isShapeOrAncestorLocked(s)):!1},[n])?a.jsx(X,{...e["convert-to-embed"]}):null}function lfe(){const n=xe(),e=G(),t=q("isSnapMode",()=>e.user.getIsSnapMode(),[e]);return a.jsx(Ds,{...n["toggle-snap-mode"],checked:t})}function cfe(){const n=xe(),e=G(),t=q("isToolLock",()=>e.getInstanceState().isToolLocked,[e]);return a.jsx(Ds,{...n["toggle-tool-lock"],checked:t})}function dfe(){const n=xe(),e=G(),t=q("isGridMode",()=>e.getInstanceState().isGridMode,[e]);return a.jsx(Ds,{...n["toggle-grid"],checked:t})}function ufe(){const n=xe(),e=G(),t=q("isWrapMode",()=>e.user.getIsWrapMode(),[e]);return a.jsx(Ds,{...n["toggle-wrap-mode"],checked:t})}function hfe(){const n=xe(),e=G(),t=q("isFocusMode",()=>e.getInstanceState().isFocusMode,[e]);return a.jsx(Ds,{...n["toggle-focus-mode"],checked:t})}function pfe(){const n=xe(),e=G(),t=q("edgeScrollSpeed",()=>e.user.getEdgeScrollSpeed(),[e]);return a.jsx(Ds,{...n["toggle-edge-scrolling"],checked:t===1})}function ffe(){const n=xe(),e=G(),t=q("animationSpeed",()=>e.user.getAnimationSpeed(),[e]);return a.jsx(Ds,{...n["toggle-reduce-motion"],checked:t===0})}function gfe(){const n=xe(),e=G(),t=q("isDebugMode",()=>e.getInstanceState().isDebugMode,[e]);return a.jsx(Ds,{...n["toggle-debug-mode"],checked:t})}function mfe(){const n=xe(),e=G(),t=q("dynamic resize",()=>e.user.getIsDynamicResizeMode(),[e]);return a.jsx(Ds,{...n["toggle-dynamic-size-mode"],checked:t})}function yfe(){const n=xe(),e=G(),t=q("paste at cursor",()=>e.user.getIsPasteAtCursorMode(),[e]);return a.jsx(Ds,{...n["toggle-paste-at-cursor"],checked:t})}function vfe(){const n=G(),e=xe();return q("show cursor chat",()=>n.getCurrentToolId()==="select"&&!n.getInstanceState().isCoarsePointer,[n])?a.jsx(X,{...e["open-cursor-chat"]}):null}function xfe(){const n=G(),e=Ex();return q("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n])?a.jsxs(a.Fragment,{children:[e&&a.jsx(vfe,{}),a.jsxs(Ie,{id:"modify",children:[a.jsx(nfe,{}),a.jsx(sfe,{}),a.jsx(ofe,{}),a.jsx(afe,{})]}),a.jsx(i$,{}),a.jsx(r$,{}),a.jsx(Ie,{id:"select-all",children:a.jsx(o$,{})})]}):null}const Sfe=b.memo(function({children:e}){const t=G(),{Canvas:s}=kt(),i=b.useCallback(d=>{if(d){if(t.getInstanceState().isCoarsePointer){const u=t.getSelectedShapes(),{inputs:{currentPagePoint:h}}=t,p=t.getShapesAtPoint(h);if(!t.getSelectedShapes().length||!p.some(f=>u.includes(f))){const f=p.filter(g=>t.isShapeOrAncestorLocked(g));f.length&&t.select(...f.map(g=>g.id))}}}else{const u=t.getOnlySelectedShape();u&&t.isShapeOrAncestorLocked(u)&&t.setSelectedShapes([])}},[t]),r=fn(),[o,l]=Mo("context menu",i),c=e??a.jsx(xfe,{});return a.jsxs(qhe,{dir:"ltr",onOpenChange:l,modal:!1,children:[a.jsx(Zhe,{onContextMenu:void 0,dir:"ltr",children:s?a.jsx(s,{}):null}),o&&a.jsx(Jhe,{container:r,children:a.jsx(Qhe,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:ze,children:a.jsx(_i,{type:"context-menu",sourceId:"context-menu",children:c})})})]})}),wfe=2e3,bfe=5e3,_fe=pn(function(){const e=G(),{isChatting:t,chatMessage:s}=e.getInstanceState(),i=b.useRef(-1),[r,o]=b.useState("");return b.useEffect(()=>{if(!t&&s||t){const c=t?bfe:wfe;i.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},c)}return()=>{clearTimeout(i.current)}},[e,s,t]),t?a.jsx(Efe,{value:r,setValue:o,chatMessage:s}):s.trim()?a.jsx(Cfe,{chatMessage:s}):null});function c$(n){const e=G();b.useLayoutEffect(()=>{var o;if(!n.current)return;const{x:s,y:i}=e.inputs.currentScreenPoint;(o=n.current)==null||o.style.setProperty("transform",`translate(${s}px, ${i}px)`);function r(l){var u;const{minX:c,minY:d}=e.getViewportScreenBounds();(u=n.current)==null||u.style.setProperty("transform",`translate(${l.clientX-c}px, ${l.clientY-d}px)`)}return window.addEventListener("pointermove",r),()=>{window.removeEventListener("pointermove",r)}},[n,e])}const Cfe=({chatMessage:n})=>{const e=G(),t=b.useRef(null);return c$(t),a.jsx("div",{ref:t,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:n})},Efe=pn(function({chatMessage:e,value:t,setValue:s}){const i=G(),r=Fe(),o=b.useRef(null),l=e||r("cursor-chat.type-to-chat");c$(o),b.useLayoutEffect(()=>{const p=o.current;if(!p)return;const f=i.textMeasure.measureText(t||l,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});p.style.setProperty("width",f.w+"px")},[i,t,l]),b.useLayoutEffect(()=>{const p=i.timers.requestAnimationFrame(()=>{var f;(f=o.current)==null||f.focus()});return()=>{cancelAnimationFrame(p)}},[i]);const c=b.useCallback(()=>{i.updateInstanceState({isChatting:!1}),i.focus()},[i]),d=b.useCallback(p=>{const{value:f}=p.target;s(f.slice(0,64)),i.updateInstanceState({chatMessage:f})},[i,s]),u=b.useCallback(p=>{const f=o.current;if(!f)return;const{value:g}=f;switch(p.key){case"Enter":{if(ze(p),p.stopPropagation(),!g){c();return}s("");break}case"Escape":{ze(p),p.stopPropagation(),c();break}}},[c,s]),h=b.useCallback(p=>{p.stopPropagation()},[]);return a.jsx("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:i.user.getColor()},onBlur:c,onChange:d,onKeyDown:u,onPaste:h,value:t,placeholder:l,spellCheck:!1})});function k_({checked:n}){return a.jsx(Mr,{icon:n?"check":"none",className:"tlui-button__icon",small:!0})}function Tfe(){const n=G(),{addToast:e}=tr(),{addDialog:t}=Jl(),[s,i]=Oe.useState(!1);return a.jsxs(a.Fragment,{children:[a.jsxs(Ie,{id:"items",children:[a.jsx(X,{id:"add-toast",onSelect:()=>{e({id:Rt(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:Rt(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Rt(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Rt(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),a.jsx(X,{id:"show-dialog",label:"Show dialog",onSelect:()=>{t({component:({onClose:r})=>a.jsx(kfe,{displayDontShowAgain:!0,onCancel:()=>r(),onContinue:()=>r()}),onClose:()=>{}})}}),a.jsx(X,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>Afe(n,100)}),a.jsx(X,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var l;const r=n.getSelectedShapes(),o=r.length===0?n.getRenderingShapes():r;window.alert(`Shapes ${o.length}, DOM nodes:${(l=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:l.length}`)}}),(()=>{if(s)throw Error("oh no!");return null})(),a.jsx(X,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"}),a.jsx(X,{id:"hard-reset",onSelect:VL,label:"Hard reset"})]}),a.jsxs(Ie,{id:"flags",children:[a.jsx(Ife,{}),a.jsx(Pfe,{})]})]})}function Ife(){const n=Object.values(Gt);return n.length?a.jsx(fs,{id:"debug flags",label:"Debug Flags",children:a.jsx(Ie,{id:"debug flags",children:n.map(e=>a.jsx(d$,{flag:e},e.name))})}):null}function Pfe(){const n=Object.values(AE);return n.length?a.jsx(fs,{id:"feature flags",label:"Feature Flags",children:a.jsx(Ie,{id:"feature flags",children:n.map(e=>a.jsx(d$,{flag:e},e.name))})}):null}function kfe({title:n="title",body:e="hello hello hello",cancel:t="Cancel",confirm:s="Continue",displayDontShowAgain:i=!1,onCancel:r,onContinue:o}){const[l,c]=Oe.useState(!1);return a.jsxs(a.Fragment,{children:[a.jsxs(Sx,{children:[a.jsx(wx,{children:n}),a.jsx(bx,{})]}),a.jsx(rp,{style:{maxWidth:350},children:e}),a.jsxs(k1,{className:"tlui-dialog__footer__actions",children:[i&&a.jsxs(we,{type:"normal",onClick:()=>c(!l),style:{marginRight:"auto"},children:[a.jsx(k_,{checked:l}),a.jsx(Vt,{children:"Dont show again"})]}),a.jsx(we,{type:"normal",onClick:r,children:a.jsx(Vt,{children:t})}),a.jsx(we,{type:"primary",onClick:async()=>o(),children:a.jsx(Vt,{children:s})})]})]})}const d$=pn(function({flag:e,onChange:t}){const s=e.get();return a.jsx(Ds,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,i=>`${i[0]} ${i[1].toLowerCase()}`).replace(/^[a-z]/,i=>i.toUpperCase()),checked:s,onSelect:()=>{e.set(!s),t==null||t(!s)}})});let Vj=0;function Afe(n,e){const t=Array(e),s=Math.floor(Math.sqrt(e));for(let i=0;i<e;i++)Vj++,t[i]={id:st("box"+Vj),type:"geo",x:i%s*132,y:Math.floor(i/s)*132};n.run(()=>{n.createShapes(t).setSelectedShapes(t.map(i=>i.id))})}function jfe({children:n}){const e=n??a.jsx(Tfe,{});return a.jsxs(Fl,{id:"debug",children:[a.jsx(Bl,{children:a.jsx(we,{type:"icon",title:"Debug menu",children:a.jsx(De,{icon:"dots-horizontal"})})}),a.jsx(Ul,{side:"top",align:"end",alignOffset:0,children:a.jsx(_i,{type:"menu",sourceId:"debug-panel",children:e})})]})}const Nfe=b.memo(function(){const{DebugMenu:e}=Ka();return a.jsxs("div",{className:"tlui-debug-panel",children:[a.jsx(Mfe,{}),a.jsx(Ofe,{}),e&&a.jsx(e,{})]})});function Rfe(n=!0){const[e,t]=b.useState(0),s=G();b.useEffect(()=>{if(!n)return;const i=()=>t(r=>r+1);return s.on("tick",i),()=>{s.off("tick",i)}},[s,n])}const Mfe=pn(function(){Rfe();const e=G(),t=e.getPath(),s=e.getHoveredShape(),i=e.getOnlySelectedShape(),r=t==="select.idle"||!t.includes("select.")?s:i,o=r&&t.includes("select.")?` / ${r.type||""}${"geo"in r.props?" / "+r.props.geo:""} / [${_.ToInt(e.getPointInShapeSpace(r,e.inputs.currentPagePoint))}]`:"",l=t.startsWith("select.")&&!t.includes(".idle")?` / [${_.ToInt(e.inputs.originPagePoint)}]  [${_.ToInt(e.inputs.currentPagePoint)}] = ${_.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return a.jsx("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${l}`})});function Ofe(){const n=G(),e=q("show_fps",()=>Gt.showFps.get(),[Gt]),t=b.useRef(null);return b.useEffect(()=>{if(!e)return;const s=250;let i=0,r=-1,o=performance.now(),l=0,c=0,d=!1;function u(){if(c++,l=performance.now()-o,l>s){const h=Math.round(c*(s/l)*(1e3/s));h>i&&(i=h);const p=i*.75;(h<p&&!d||h>=p&&d)&&(d=!d),t.current.innerHTML=`FPS ${h.toString()}`,t.current.className="tlui-debug-panel__fps"+(d?" tlui-debug-panel__fps__slow":""),l-=s,c=0,o=performance.now()}r=n.timers.requestAnimationFrame(u)}return u(),()=>{cancelAnimationFrame(r)}},[e,n]),e?a.jsx("div",{ref:t}):null}const Dfe=b.memo(function(){const e=hs(),{MainMenu:t,QuickActions:s,ActionsMenu:i,PageMenu:r}=Ka();return!t&&!r&&e<6?null:a.jsx("div",{className:"tlui-menu-zone",children:a.jsxs("div",{className:"tlui-buttons__horizontal",children:[t&&a.jsx(t,{}),r&&a.jsx(r,{}),e<6?null:a.jsxs(a.Fragment,{children:[s&&a.jsx(s,{}),i&&a.jsx(i,{})]})]})})});function Lfe(){const n=G(),e=xe(),[t,s]=b.useState(!1),i=b.useRef(!1);return Sa("toggle showback to content",()=>{const r=i.current,o=n.getCurrentPageShapeIds();let l=!1;o.size&&(l=o.size===n.getCulledShapes().size),r!==l&&(s(l),i.current=l)},[n]),t?a.jsx(X,{...e["back-to-content"],onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),s(!1)}}):null}function Ffe(){const n=G(),e=xe();return q("is pen mode",()=>n.getInstanceState().isPenMode,[n])?a.jsx(X,{...e["exit-pen-mode"]}):null}function Bfe(){const n=G(),e=xe();return q("is following user",()=>!!n.getInstanceState().followingUserId,[n])?a.jsx(X,{...e["stop-following"]}):null}function Ufe(){return a.jsxs(a.Fragment,{children:[a.jsx(Ffe,{}),a.jsx(Lfe,{}),a.jsx(Bfe,{})]})}function $fe({children:n}){const e=n??a.jsx(Ufe,{});return a.jsx("div",{className:"tlui-helper-buttons",children:a.jsx(_i,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function zfe(){const n=xe(),e=Cx(),t=Ex();return a.jsxs(a.Fragment,{children:[a.jsxs(Ie,{label:"shortcuts-dialog.tools",id:"tools",children:[a.jsx(X,{...n["toggle-tool-lock"]}),a.jsx(X,{...n["insert-media"]}),a.jsx(X,{...e.select}),a.jsx(X,{...e.draw}),a.jsx(X,{...e.eraser}),a.jsx(X,{...e.hand}),a.jsx(X,{...e.rectangle}),a.jsx(X,{...e.ellipse}),a.jsx(X,{...e.arrow}),a.jsx(X,{...e.line}),a.jsx(X,{...e.text}),a.jsx(X,{...e.frame}),a.jsx(X,{...e.note}),a.jsx(X,{...e.laser})]}),a.jsxs(Ie,{label:"shortcuts-dialog.preferences",id:"preferences",children:[a.jsx(X,{...n["toggle-dark-mode"]}),a.jsx(X,{...n["toggle-focus-mode"]}),a.jsx(X,{...n["toggle-grid"]})]}),a.jsxs(Ie,{label:"shortcuts-dialog.edit",id:"edit",children:[a.jsx(X,{...n.undo}),a.jsx(X,{...n.redo}),a.jsx(X,{...n.cut}),a.jsx(X,{...n.copy}),a.jsx(X,{...n.paste}),a.jsx(X,{...n["select-all"]}),a.jsx(X,{...n.delete}),a.jsx(X,{...n.duplicate})]}),a.jsxs(Ie,{label:"shortcuts-dialog.view",id:"view",children:[a.jsx(X,{...n["zoom-in"]}),a.jsx(X,{...n["zoom-out"]}),a.jsx(X,{...n["zoom-to-100"]}),a.jsx(X,{...n["zoom-to-fit"]}),a.jsx(X,{...n["zoom-to-selection"]})]}),a.jsxs(Ie,{label:"shortcuts-dialog.transform",id:"transform",children:[a.jsx(X,{...n["bring-to-front"]}),a.jsx(X,{...n["bring-forward"]}),a.jsx(X,{...n["send-backward"]}),a.jsx(X,{...n["send-to-back"]}),a.jsx(X,{...n.group}),a.jsx(X,{...n.ungroup}),a.jsx(X,{...n["flip-horizontal"]}),a.jsx(X,{...n["flip-vertical"]}),a.jsx(X,{...n["align-top"]}),a.jsx(X,{...n["align-center-vertical"]}),a.jsx(X,{...n["align-bottom"]}),a.jsx(X,{...n["align-left"]}),a.jsx(X,{...n["align-center-horizontal"]}),a.jsx(X,{...n["align-right"]})]}),t&&a.jsx(Ie,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:a.jsx(X,{...n["open-cursor-chat"]})})]})}const Wfe=b.memo(function({children:e}){const t=Fe(),s=hs(),i=e??a.jsx(zfe,{});return a.jsxs(a.Fragment,{children:[a.jsxs(Sx,{className:"tlui-shortcuts-dialog__header",children:[a.jsx(wx,{children:t("shortcuts-dialog.title")}),a.jsx(bx,{})]}),a.jsx(rp,{className:Se("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":s<=zt.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":s<=zt.TABLET}),children:a.jsx(_i,{type:"keyboard-shortcuts",sourceId:"kbd",children:i})}),a.jsx("div",{className:"tlui-dialog__scrim"})]})}),Hfe=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function Gfe(){const n=G(),e=An(),t=q("colorScheme",()=>n.user.getUserPreferences().colorScheme??n.user.getIsDarkMode()?"dark":"light",[n]);return a.jsx(fs,{id:"help menu color-scheme",label:"menu.theme",children:a.jsx(Ie,{id:"languages",children:Hfe.map(({colorScheme:s,label:i})=>a.jsx(Ds,{id:`color-scheme-${s}`,label:i,checked:s===t,onSelect:()=>{n.user.updateUserPreferences({colorScheme:s}),e("color-scheme",{source:"menu",value:s})}},s))})})}function u$(){const n=G(),e=An(),t=q("locale",()=>n.user.getLocale(),[n]);return a.jsx(fs,{id:"help menu language",label:"menu.language",children:a.jsx(Ie,{id:"languages",children:sp.map(({locale:s,label:i})=>a.jsx(Ds,{id:`language-${s}`,title:s,label:i,checked:s===t,onSelect:()=>{n.user.updateUserPreferences({locale:s}),e("change-language",{source:"menu",locale:s})}},s))})})}function Vfe(){return a.jsxs(a.Fragment,{children:[a.jsx(u$,{}),a.jsx(h$,{})]})}function h$(){const{KeyboardShortcutsDialog:n}=Ka(),{addDialog:e}=Jl();return n?a.jsx(X,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{e({component:n})}}):null}function Kfe(){return a.jsxs(a.Fragment,{children:[a.jsx(Xfe,{}),a.jsx(Qfe,{}),a.jsx(Yfe,{}),a.jsx(ege,{}),a.jsx(nge,{}),a.jsx(tge,{})]})}function Yfe(){const n=xe();return a.jsxs(fs,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[a.jsxs(Ie,{id:"export-all-as-group",children:[a.jsx(X,{...n["export-all-as-svg"]}),a.jsx(X,{...n["export-all-as-png"]}),a.jsx(X,{...n["export-all-as-json"]})]}),a.jsx(Ie,{id:"export-all-as-bg",children:a.jsx(lT,{})})]})}function Xfe(){const n=G(),e=q("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]);return a.jsxs(fs,{id:"edit",label:"menu.edit",disabled:!e,children:[a.jsx(Jfe,{}),a.jsx(i$,{}),a.jsx(r$,{}),a.jsx(qfe,{}),a.jsx(Zfe,{}),a.jsx(Ie,{id:"select-all",children:a.jsx(o$,{})})]})}function qfe(){return a.jsxs(Ie,{id:"misc",children:[a.jsx(qU,{}),a.jsx(ZU,{}),a.jsx(YU,{}),a.jsx(KU,{}),a.jsx(JU,{}),a.jsx(QU,{}),a.jsx(l$,{}),a.jsx(a$,{}),a.jsx(XU,{})]})}function Zfe(){return a.jsxs(Ie,{id:"lock",children:[a.jsx(e$,{}),a.jsx(qpe,{})]})}function Jfe(){const n=xe(),e=I3(),t=T3();return a.jsxs(Ie,{id:"undo-redo",children:[a.jsx(X,{...n.undo,disabled:!e}),a.jsx(X,{...n.redo,disabled:!t})]})}function Qfe(){const n=xe();return a.jsx(fs,{id:"view",label:"menu.view",children:a.jsxs(Ie,{id:"view-actions",children:[a.jsx(X,{...n["zoom-in"]}),a.jsx(X,{...n["zoom-out"]}),a.jsx(t$,{}),a.jsx(n$,{}),a.jsx(s$,{})]})})}function ege(){const n=xe();return a.jsxs(Ie,{id:"extras",children:[a.jsx(X,{...n["insert-embed"]}),a.jsx(X,{...n["insert-media"]})]})}function tge(){function n(e){window.open(e,"_blank")}return a.jsx(Ie,{id:"help",children:a.jsx(fs,{id:"help",label:"menu.help",children:a.jsxs(Ie,{id:"help-actions",children:[a.jsx(h$,{}),a.jsx(X,{id:"about",label:"help-menu.docs",icon:"external-link",readonlyOk:!0,onSelect:()=>{n("https://tldraw.dev")}})]})})})}function nge(){return a.jsx(Ie,{id:"preferences",children:a.jsxs(fs,{id:"preferences",label:"menu.preferences",children:[a.jsxs(Ie,{id:"preferences-actions",children:[a.jsx(lfe,{}),a.jsx(cfe,{}),a.jsx(dfe,{}),a.jsx(ufe,{}),a.jsx(hfe,{}),a.jsx(pfe,{}),a.jsx(ffe,{}),a.jsx(mfe,{}),a.jsx(yfe,{}),a.jsx(gfe,{})]}),a.jsx(Ie,{id:"color-scheme",children:a.jsx(Gfe,{})}),a.jsx(Ie,{id:"language",children:a.jsx(u$,{})})]})})}const sge=b.memo(function({children:e}){const t=fn(),[s,i]=Mo("main menu"),r=Fe(),o=e??a.jsx(Kfe,{});return a.jsxs(rT,{dir:"ltr",open:s,onOpenChange:i,modal:!1,children:[a.jsx(oT,{asChild:!0,dir:"ltr",children:a.jsx(we,{type:"icon","data-testid":"main-menu.button",title:r("menu.title"),children:a.jsx(De,{icon:"menu",small:!0})})}),a.jsx(Dx,{container:t,children:a.jsx(aT,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:a.jsx(_i,{type:"menu",sourceId:"main-menu",children:o})})})]})}),zw={};function Au(n){if(zw[n])return zw[n];const t=document.createElement("canvas").getContext("2d");t.fillStyle=n,t.fillRect(0,0,1,1);const[s,i,r,o]=t.getImageData(0,0,1,1).data,l=new Float32Array([s/255,i/255,r/255,o/255]);return zw[n]=l,l}const Pm=10,p$=4*6*Pm+12+4*12;function Sc(n,{center:e,radius:t,numArcSegments:s=20,startAngle:i=0,endAngle:r=et,offset:o=0}){const l=(r-i)/s;let c=o;for(let d=i;d<r;d+=l)n[c++]=e.x,n[c++]=e.y,n[c++]=e.x+Math.cos(d)*t,n[c++]=e.y+Math.sin(d)*t,n[c++]=e.x+Math.cos(d+l)*t,n[c++]=e.y+Math.sin(d+l)*t;return n}function wc(n,e,t,s,i,r){n[e++]=t,n[e++]=s,n[e++]=t,n[e++]=s+r,n[e++]=t+i,n[e++]=s,n[e++]=t+i,n[e++]=s,n[e++]=t,n[e++]=s+r,n[e++]=t+i,n[e++]=s+r}function ige(n,e,t){const s=Pm;t=Math.min(t,Math.min(e.w,e.h)/2);const i=ue.ExpandBy(e,-t);if(i.w<=0||i.h<=0)return Sc(n,{center:e.center,radius:t,numArcSegments:Pm*4}),Pm*4*6;let r=0;return wc(n,r,i.minX,i.minY,i.w,i.h),r+=12,wc(n,r,i.minX,e.minY,i.w,t),r+=12,wc(n,r,i.maxX,i.minY,t,i.h),r+=12,wc(n,r,i.minX,i.maxY,i.w,t),r+=12,wc(n,r,e.minX,i.minY,t,i.h),r+=12,Sc(n,{numArcSegments:s,offset:r,center:i.point,radius:t,startAngle:qe,endAngle:qe*1.5}),r+=s*6,Sc(n,{numArcSegments:s,offset:r,center:_.Add(i.point,new _(i.w,0)),radius:t,startAngle:qe*1.5,endAngle:et}),r+=s*6,Sc(n,{numArcSegments:s,offset:r,center:_.Add(i.point,i.size),radius:t,startAngle:0,endAngle:gt}),r+=s*6,Sc(n,{numArcSegments:s,offset:r,center:_.Add(i.point,new _(0,i.h)),radius:t,startAngle:gt,endAngle:qe}),p$}function rge(n){if(!n)throw new Error("Canvas element not found");const e=n.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const t=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,s=e.createShader(e.VERTEX_SHADER);if(!s)throw new Error("Failed to create vertex shader");if(e.shaderSource(s,t),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,r=e.createShader(e.FRAGMENT_SHADER);if(!r)throw new Error("Failed to create fragment shader");if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const o=e.createProgram();if(!o)throw new Error("Failed to create program");if(e.attachShader(o,s),e.attachShader(o,r),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(o);const l=e.getAttribLocation(o,"shapeVertexPosition");if(l<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(l);const c=e.getUniformLocation(o,"canvasPageBounds"),d=e.getUniformLocation(o,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:bg(e,1024),unselectedShapes:bg(e,4096),viewport:bg(e,p$),collaborators:bg(e,1024),prepareTriangles(p,f){e.bindBuffer(e.ARRAY_BUFFER,p.buffer),e.bufferData(e.ARRAY_BUFFER,p.vertices,e.STATIC_DRAW,0,f),e.enableVertexAttribArray(l),e.vertexAttribPointer(l,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(p){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,p/2),e.disable(e.BLEND)},drawTriangles(p){e.drawArrays(e.TRIANGLES,0,p/2)},setFillColor(p){e.uniform4fv(d,p)},setCanvasPageBounds(p){e.uniform4fv(c,p)}}}function bg(n,e){const t=n.createBuffer();if(!t)throw new Error("Failed to create buffer");return{buffer:t,vertices:new Float32Array(e)}}function Kj(n,e,t){let s=n.vertices.length;for(;s<e+t.length;)s*=2;if(s!=n.vertices.length){const i=new Float32Array(s);i.set(n.vertices),n.vertices=i}n.vertices.set(t,e)}var oge=Object.defineProperty,age=Object.getOwnPropertyDescriptor,Va=(n,e,t,s)=>{for(var i=age(e,t),r=n.length-1,o;r>=0;r--)(o=n[r])&&(i=o(e,t,i)||i);return i&&oge(e,t,i),i};class Do{constructor(e,t,s){w(this,"disposables",[]);w(this,"close",()=>this.disposables.forEach(e=>e()));w(this,"gl");w(this,"shapeGeometryCache");w(this,"colors");w(this,"id",Rt());w(this,"canvasBoundingClientRect",an("canvasBoundingClientRect",new ue));w(this,"originPagePoint",new _);w(this,"originPageCenter",new _);w(this,"isInViewport",!1);w(this,"getMinimapPagePoint",(e,t)=>{const s=this.getCanvasPageBounds(),i=this.getCanvasScreenBounds();let r=e-i.x,o=t-i.y;return r*=s.width/i.width,o*=s.height/i.height,r+=s.minX,o+=s.minY,new _(r,o,1)});w(this,"minimapScreenPointToPagePoint",(e,t,s=!1,i=!1)=>{const{editor:r}=this,o=r.getViewportPageBounds();let{x:l,y:c}=this.getMinimapPagePoint(e,t);if(i){const d=this.editor.getCurrentPageBounds()??new ue,u=d.minX-o.width/2,h=d.maxX+o.width/2,p=d.minY-o.height/2,f=d.maxY+o.height/2,g=Math.max(0,u+o.width-l),m=Math.max(0,-(h-o.width-l)),x=Math.max(0,p+o.height-c),y=Math.max(0,-(f-o.height-c));l+=(g-m)/2,c+=(x-y)/2,l=tn(l,u,h),c=tn(c,p,f)}if(s){const{originPagePoint:d}=this,u=Math.abs(l-d.x),h=Math.abs(c-d.y);u>h?c=d.y:l=d.x}return new _(l,c)});w(this,"render",()=>{const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const s=new Set(this.editor.getSelectedShapeIds()),i=this.colors;let r=0,o=0;const l=this.editor.getCurrentPageShapeIdsSorted();for(let c=0,d=l.length;c<d;c++){const u=l[c],h=this.shapeGeometryCache.get(u);if(!h)continue;const p=h.length;s.has(u)?(Kj(this.gl.selectedShapes,r,h),r+=p):(Kj(this.gl.unselectedShapes,o,h),o+=p)}this.drawShapes(this.gl.unselectedShapes,o,i.shapeFill),this.drawShapes(this.gl.selectedShapes,r,i.selectFill),this.drawViewport(),this.drawCollaborators()});this.editor=e,this.elem=t,this.container=s,this.gl=rge(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",i=>{const r=e.getShapeMaskedPageBounds(i.id);if(!r)return null;const o=new Float32Array(12);return wc(o,0,r.x,r.y,r.w,r.h),o}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),Zl("minimap render",this.render))}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:Au(e.getPropertyValue("--color-text-3").trim()),selectFill:Au(e.getPropertyValue("--color-selected").trim()),viewportFill:Au(e.getPropertyValue("--color-muted-1").trim()),background:Au(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?ue.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),s=this.editor.pageToScreen(new _(e.maxX,e.maxY));return new ue(t.x,t.y,s.x-t.x,s.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:s,height:i}=this.elem.getBoundingClientRect();return new ue(e,t,s,i)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const t=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(t)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new _(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),s=e.width/e.height;let i=t.width,r=i/s;r<t.height&&(r=t.height,i=r*s);const o=new ue(0,0,i,r);return o.center=t.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:s,h:i}=this.getCanvasPageBounds();return new Float32Array([e,t,s,i])}drawShapes(e,t,s){this.gl.prepareTriangles(e,t),this.gl.setFillColor(s),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=ige(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),this.editor.environment.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=20,s=t*6,i=s*e.length;this.gl.collaborators.vertices.length<i&&(this.gl.collaborators.vertices=new Float32Array(i));const r=this.gl.collaborators.vertices;let o=0;const l=this.getZoom();for(const{cursor:c}of e)Sc(r,{center:_.From(c),radius:3*l,offset:o,numArcSegments:t}),o+=s;this.gl.prepareTriangles(this.gl.collaborators,i),o=0;for(const{color:c}of e)this.gl.setFillColor(Au(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,o/2,s/2),o+=s}}Va([Q],Do.prototype,"getDpr");Va([Q],Do.prototype,"getContentPageBounds");Va([Q],Do.prototype,"getContentScreenBounds");Va([Q],Do.prototype,"getCanvasSize");Va([Q],Do.prototype,"getCanvasClientPosition");Va([Q],Do.prototype,"getCanvasPageBounds");Va([Q],Do.prototype,"getZoom");Va([Q],Do.prototype,"getCanvasPageBoundsArray");function lge(){const n=G(),e=fn(),t=b.useRef(null),s=b.useRef(!1),i=b.useRef();b.useEffect(()=>{try{const u=new Do(n,t.current,e);return i.current=u,i.current.close}catch(u){n.annotateError(u,{origin:"minimap",willCrashApp:!1}),n.timers.setTimeout(()=>{throw u})}},[n,e]);const r=b.useCallback(u=>{if(!n.getCurrentPageShapeIds().size||!i.current)return;const h=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),p=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);i.current.originPagePoint.setTo(p),i.current.originPageCenter.setTo(n.getViewportPageBounds().center),n.centerOnPoint(h,{animation:{duration:n.options.animationMediumMs}})},[n]),o=b.useCallback(u=>{if(!i.current)return;const h=u.currentTarget;if(Lp(h,u),!n.getCurrentPageShapeIds().size)return;s.current=!0,i.current.isInViewport=!1;const p=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),f=n.getViewportPageBounds(),g=i.current.getContentPageBounds();if(new ue(g.x-f.width/2,g.y-f.height/2,g.width+f.width,g.height+f.height).containsPoint(p)&&!f.containsPoint(p)){i.current.isInViewport=f.containsPoint(p);const y=_.Sub(f.center,f.point),S=_.Add(p,y);i.current.originPagePoint.setTo(S),i.current.originPageCenter.setTo(p),n.centerOnPoint(p,{animation:{duration:n.options.animationMediumMs}})}else{const y=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);i.current.isInViewport=f.containsPoint(y),i.current.originPagePoint.setTo(y),i.current.originPageCenter.setTo(f.center)}function x(y){h&&Fp(h,y),s.current=!1,document.body.removeEventListener("pointerup",x)}document.body.addEventListener("pointerup",x)},[n]),l=b.useCallback(u=>{if(!i.current)return;const h=i.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,u.shiftKey,!0);if(s.current){if(i.current.isInViewport){const m=i.current.originPagePoint.clone().sub(i.current.originPageCenter);n.centerOnPoint(_.Sub(h,m));return}n.centerOnPoint(h)}const p=i.current.getMinimapPagePoint(u.clientX,u.clientY),f=n.pageToScreen(p),g={type:"pointer",target:"canvas",name:"pointer_move",...Is(u),point:f,isPen:n.getInstanceState().isPenMode};n.dispatch(g)},[n]),c=b.useCallback(u=>{const h=ML(u);n.dispatch({type:"wheel",name:"wheel",delta:h,point:new _(u.clientX,u.clientY),shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey})},[n]),d=Wp();return b.useEffect(()=>{n.timers.setTimeout(()=>{var u,h;(u=i.current)==null||u.updateColors(),(h=i.current)==null||h.render()})},[d,n]),a.jsx("div",{className:"tlui-minimap",children:a.jsx("canvas",{role:"img","aria-label":"minimap",ref:t,className:"tlui-minimap__canvas",onDoubleClick:r,onPointerMove:l,onPointerDown:o,onWheel:c})})}function cge(n,e){const[t,s]=Oe.useState(e);Oe.useLayoutEffect(()=>{const r=IE(n);if(r)try{s(JSON.parse(r))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const i=Oe.useCallback(r=>{s(o=>{const l=typeof r=="function"?r(o):r;return PE(n,JSON.stringify(l)),l})},[n]);return[t,i]}const dge=b.memo(function(){const e=xe(),t=Fe(),s=hs(),[i,r]=cge("minimap",!0),o=b.useCallback(()=>{r(d=>!d)},[r]),{ZoomMenu:l,Minimap:c}=Ka();return s<zt.MOBILE?null:a.jsxs("div",{className:"tlui-navigation-panel",children:[a.jsx("div",{className:"tlui-buttons__horizontal",children:l&&s<zt.TABLET?a.jsx(l,{}):i?a.jsxs(a.Fragment,{children:[l&&a.jsx(l,{}),c&&a.jsx(we,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:a.jsx(De,{icon:i?"chevrons-ne":"chevrons-sw"})})]}):a.jsxs(a.Fragment,{children:[a.jsx(we,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(op(e["zoom-out"].label))} ${P_(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:a.jsx(De,{icon:"minus"})}),l&&a.jsx(l,{}),a.jsx(we,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(op(e["zoom-in"].label))} ${P_(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:a.jsx(De,{icon:"plus"})}),c&&a.jsx(we,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:a.jsx(De,{icon:i?"chevrons-ne":"chevrons-sw"})})]})}),c&&s>=zt.TABLET&&!i&&a.jsx(c,{})]})}),uge=function({name:e,id:t,isCurrentPage:s}){const i=G(),r=An(),o=b.useRef(null),l=b.useCallback(()=>{i.mark("rename page")},[i]),c=b.useCallback(d=>{i.renamePage(t,d||"New Page"),r("rename-page",{source:"page-menu"})},[i,t,r]);return a.jsx(_x,{className:"tlui-page-menu__item__input",ref:d=>o.current=d,defaultValue:e,onValueChange:c,onFocus:l,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:s,autoSelect:!0})},A_=(n,e,t,s,i)=>{let r;const o=n.getPages(),l=t>s?o[s-1]:o[s],c=t>s?o[s]:o[s+1];l&&!c?r=Li(l.index):!l&&c?r=TZ(o[0].index):r=ep(l.index,c.index),r!==o[t].index&&(n.mark("moving page"),n.updatePage({id:e,index:r}),i("move-page",{source:"page-menu"}))},Yj=pn(function({index:e,listSize:t,item:s,onRename:i}){const r=G(),o=Fe(),l=r.getPages(),c=An(),d=b.useCallback(()=>{r.mark("creating page");const f=So.createId();r.duplicatePage(s.id,f),c("duplicate-page",{source:"page-menu"})},[r,s,c]),u=b.useCallback(()=>{A_(r,s.id,e,e-1,c)},[r,s,e,c]),h=b.useCallback(()=>{A_(r,s.id,e,e+1,c)},[r,s,e,c]),p=b.useCallback(()=>{r.mark("deleting page"),r.deletePage(s.id),c("delete-page",{source:"page-menu"})},[r,s,c]);return a.jsxs(Fl,{id:`page item submenu ${e}`,children:[a.jsx(Bl,{children:a.jsx(we,{type:"icon",title:o("page-menu.submenu.title"),children:a.jsx(De,{icon:"dots-vertical"})})}),a.jsx(Ul,{alignOffset:0,side:"right",sideOffset:-4,children:a.jsxs(_i,{type:"menu",sourceId:"page-menu",children:[a.jsxs(Ie,{id:"modify",children:[i&&a.jsx(X,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),a.jsx(X,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:d,disabled:l.length>=r.options.maxPages}),e>0&&a.jsx(X,{id:"move-up",onSelect:u,label:"page-menu.submenu.move-up"}),e<t-1&&a.jsx(X,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:h})]}),t>1&&a.jsx(Ie,{id:"delete",children:a.jsx(X,{id:"delete",onSelect:p,label:"page-menu.submenu.delete"})})]})})]})}),hge=b.memo(function(){const e=G(),t=An(),s=Fe(),i=hs(),r=b.useCallback(()=>y(!1),[]),[o,l]=Mo("page-menu",r),c=36,d=b.useRef(null),u=q("pages",()=>e.getPages(),[e]),h=q("currentPage",()=>e.getCurrentPage(),[e]),p=q("currentPageId",()=>e.getCurrentPageId(),[e]),f=Ro(),g=q("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),m=q("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[x,y]=b.useState(!1),S=b.useCallback(()=>{f||y(A=>!A)},[f]),v=b.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[C,T]=b.useState(Object.fromEntries(u.map((A,N)=>[A.id,{y:N*c,offsetY:0,isSelected:!1}])));b.useLayoutEffect(()=>{T(Object.fromEntries(u.map((A,N)=>[A.id,{y:N*c,offsetY:0,isSelected:!1}])))},[c,u]),b.useEffect(()=>{o&&e.timers.requestAnimationFrame(()=>{const A=document.querySelector(`[data-testid="page-menu-item-${p}"]`);if(A){const N=d.current;if(!N)return;const B=A.offsetTop,L=N.scrollTop;B<L&&N.scrollTo({top:B});const O=B+c,F=N.scrollTop+N.offsetHeight;O>F&&N.scrollTo({top:O-N.offsetHeight})}})},[c,p,o,e]);const I=b.useCallback(A=>{const{clientY:N,currentTarget:B}=A,{dataset:{id:L,index:O}}=B;if(!L||!O)return;const F=v.current;Lp(A.currentTarget,A),F.status="pointing",F.pointing={id:L,index:+O};const $=C[L].y;F.startY=N,F.startIndex=Math.max(0,Math.min(Math.round($/c),u.length-1))},[c,u.length,C]),E=b.useCallback(A=>{const N=v.current;if(N.status==="pointing"){const{clientY:B}=A,L=B-N.startY;Math.abs(L)>5&&(N.status="dragging")}if(N.status==="dragging"){const{clientY:B}=A,L=B-N.startY,O=C[N.pointing.id],{startIndex:F,pointing:W}=N,$=O.y+L,K=Math.max(0,Math.min(Math.round($/c),u.length-1)),Y={...C};if(Y[W.id]={y:O.y,offsetY:L,isSelected:!0},K!==N.dragIndex){N.dragIndex=K;for(let U=0;U<u.length;U++){const J=u[U];if(J.id===N.pointing.id)continue;let{y:te}=Y[J.id];K===F?te=U*c:K<F?K<=U&&U<F?te=(U+1)*c:te=U*c:K>F&&(K>=U&&U>F?te=(U-1)*c:te=U*c),te!==Y[J.id].y&&(Y[J.id]={y:te,offsetY:0,isSelected:!0})}}T(Y)}},[c,u,C]),P=b.useCallback(A=>{const N=v.current;if(N.status==="dragging"){const{id:B,index:L}=N.pointing;A_(e,B,L,N.dragIndex,t)}Fp(A.currentTarget,A),N.status="idle"},[e,t]),k=b.useCallback(A=>{const N=v.current;A.key==="Escape"&&(N.status==="dragging"&&T(Object.fromEntries(u.map((B,L)=>[B.id,{y:L*c,offsetY:0,isSelected:!1}]))),N.status="idle")},[c,u]),j=b.useCallback(()=>{f||(e.run(()=>{e.mark("creating page");const A=So.createId();e.createPage({name:s("page-menu.new-page-initial-name"),id:A}),e.setCurrentPage(A),y(!0)}),t("new-page",{source:"page-menu"}))},[e,s,f,t]),D=b.useCallback(A=>{e.setCurrentPage(A),t("change-page",{source:"page-menu"})},[e,t]),R=b.useCallback((A,N)=>{e.renamePage(A,N),t("rename-page",{source:"page-menu"})},[e,t]);return a.jsxs(G1,{id:"pages",onOpenChange:l,open:o,children:[a.jsx(V1,{"data-testid":"main.page-menu",children:a.jsxs(we,{type:"menu",title:h.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[a.jsx("div",{className:"tlui-page-menu__name",children:h.name}),a.jsx(De,{icon:"chevron-down",small:!0})]})}),a.jsx(K1,{side:"bottom",align:"start",sideOffset:6,children:a.jsxs("div",{className:"tlui-page-menu__wrapper",children:[a.jsxs("div",{className:"tlui-page-menu__header",children:[a.jsx("div",{className:"tlui-page-menu__header__title",children:s("page-menu.title")}),!f&&a.jsxs("div",{className:"tlui-buttons__horizontal",children:[a.jsx(we,{type:"icon","data-testid":"page-menu.edit",title:s(x?"page-menu.edit-done":"page-menu.edit-start"),onClick:S,children:a.jsx(De,{icon:x?"check":"edit"})}),a.jsx(we,{type:"icon","data-testid":"page-menu.create",title:s(g?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:g,onClick:j,children:a.jsx(De,{icon:"plus"})})]})]}),a.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:c*u.length+4},ref:d,children:u.map((A,N)=>{const B=C[A.id]??{offsetY:0};return x?a.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:A.id===h.id?888:N,transform:`translate(0px, ${B.y+B.offsetY}px)`},children:[a.jsx(we,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:I,onPointerUp:P,onPointerMove:E,onKeyDown:k,"data-id":A.id,"data-index":N,children:a.jsx(De,{icon:"drag-handle-dots"})}),i<zt.TABLET_SM&&m?a.jsxs(we,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const L=window.prompt("Rename page",A.name);L&&L!==A.name&&R(A.id,L)},onDoubleClick:S,children:[a.jsx(k_,{checked:A.id===h.id}),a.jsx(Vt,{children:A.name})]}):a.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:c},children:a.jsx(uge,{id:A.id,name:A.name,isCurrentPage:A.id===h.id})}),!f&&a.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":x,children:a.jsx(Yj,{index:N,item:A,listSize:u.length})})]},A.id+"_editing"):a.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[a.jsxs(we,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>D(A.id),onDoubleClick:S,title:s("page-menu.go-to-page"),children:[a.jsx(k_,{checked:A.id===h.id}),a.jsx(Vt,{children:A.name})]}),!f&&a.jsx("div",{className:"tlui-page_menu__item__submenu",children:a.jsx(Yj,{index:N,item:A,listSize:u.length,onRename:()=>{if(e.environment.isIos){const L=window.prompt("Rename page",A.name);L&&L!==A.name&&R(A.id,L)}else y(!0),p!==A.id&&D(A.id)}})})]},A.id)})})]})})]})});function pge(){const n=xe(),e=G(),t=I3(),s=T3(),i=ps(1),r=Ro(),o=q("should display quick actions",()=>e.isInAny("select","hand","zoom"),[e]),l=Oo(),c=i&&l;if(!(r&&!o))return a.jsxs(a.Fragment,{children:[a.jsx(X,{...n.undo,disabled:!t}),a.jsx(X,{...n.redo,disabled:!s}),a.jsx(X,{...n.delete,disabled:!c}),a.jsx(X,{...n.duplicate,disabled:!c})]})}const fge=b.memo(function({children:e}){const t=e??a.jsx(pge,{});return a.jsx(_i,{type:"small-icons",sourceId:"quick-actions",children:t})});function gge({userId:n}){const e=ex(n);return e?a.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},n):null}const mge=pn(function({userId:e}){const t=G(),s=Fe(),i=An(),r=ex(e),o=b.useCallback(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),i("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),i("start-following",{source:"people-menu"}))},[t,e,i]),l=(r==null?void 0:r.followingUserId)===t.user.getId(),c=t.getInstanceState().followingUserId===e;return r?a.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[a.jsxs(we,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:o,children:[a.jsx(Mr,{icon:"color",color:r.color}),a.jsx("div",{className:"tlui-people-menu__name",children:r.userName??"New User"})]}),a.jsx(we,{type:"icon",className:"tlui-people-menu__item__follow",title:s(l?"people-menu.leading":c?"people-menu.following":"people-menu.follow"),onClick:o,disabled:l,"data-active":c||l,children:a.jsx(De,{icon:l?"leading":c?"following":"follow"})})]}):null});function yge({count:n}){return a.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(n)})}const vge=pn(function(){const e=G(),t=fn(),s=Fe(),i=An(),r=b.useRef(!1),[o,l]=b.useState(!1),c=b.useCallback(m=>{l(m)},[]),d=e.user.getColor(),u=b.useCallback(m=>{e.user.updateUserPreferences({color:m}),i("set-color",{source:"people-menu"})},[e,i]),{handleButtonClick:h,handleButtonPointerDown:p,handleButtonPointerEnter:f,handleButtonPointerUp:g}=Oe.useMemo(()=>{const m=()=>{r.current=!1,window.removeEventListener("pointerup",m)};return{handleButtonClick:C=>{const{id:T}=C.currentTarget.dataset;T&&d!==T&&u(T)},handleButtonPointerDown:C=>{const{id:T}=C.currentTarget.dataset;T&&(u(T),r.current=!0,window.addEventListener("pointerup",m))},handleButtonPointerEnter:C=>{if(!r.current)return;const{id:T}=C.currentTarget.dataset;T&&u(T)},handleButtonPointerUp:C=>{const{id:T}=C.currentTarget.dataset;T&&u(T)}}},[d,u]);return a.jsxs($1,{onOpenChange:c,open:o,children:[a.jsx(z1,{dir:"ltr",asChild:!0,children:a.jsx(we,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:s("people-menu.change-color"),children:a.jsx(De,{icon:"color"})})}),a.jsx(W1,{container:t,children:a.jsx(H1,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:a.jsx("div",{className:"tlui-buttons__grid",children:J0.map(m=>a.jsx(we,{type:"icon","data-id":m,"data-testid":m,"aria-label":m,"data-state":d===m?"hinted":void 0,title:m,className:"tlui-button-grid__button",style:{color:m},onPointerEnter:f,onPointerDown:p,onPointerUp:g,onClick:h,children:a.jsx(De,{icon:"color"})},m))})})})]})});function xge(){const n=G(),e=An(),t=q("userName",()=>n.user.getName(),[]),s=Fe(),i=b.useRef(t),r=b.useRef(t),[o,l]=b.useState(!1),c=b.useCallback(()=>{l(h=>!h)},[]),d=b.useCallback(h=>{r.current=h,n.user.updateUserPreferences({name:h})},[n]),u=b.useCallback(()=>{i.current!==r.current&&(e("change-user-name",{source:"people-menu"}),i.current=r.current)},[e]);return a.jsxs("div",{className:"tlui-people-menu__user",children:[a.jsx(vge,{}),o?a.jsx(_x,{className:"tlui-people-menu__user__input",defaultValue:t,onValueChange:d,onComplete:c,onCancel:c,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{o||l(!0)},children:t}),t==="New User"?a.jsx("div",{className:"tlui-people-menu__user__label",children:s("people-menu.user")}):null]}),a.jsx(we,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:s("people-menu.change-name"),onClick:c,children:a.jsx(De,{icon:o?"check":"edit"})})]})}const Sge=pn(function({children:e}){const t=Fe(),s=fn(),i=G(),r=BL(),o=q("user",()=>i.user.getColor(),[i]),l=q("user",()=>i.user.getName(),[i]),[c,d]=Mo("people menu");return a.jsxs($1,{onOpenChange:d,open:c,children:[a.jsx(z1,{dir:"ltr",asChild:!0,children:a.jsxs("button",{className:"tlui-people-menu__avatars-button",title:t("people-menu.title"),children:[r.length>5&&a.jsx(yge,{count:r.length-5}),a.jsxs("div",{className:"tlui-people-menu__avatars",children:[r.slice(-5).map(u=>a.jsx(gge,{userId:u},u)),a.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o},children:l==="New User"?"":l[0]??""})]})]})}),a.jsx(W1,{container:s,children:a.jsx(H1,{dir:"ltr",className:"tlui-menu",align:"end",side:"bottom",sideOffset:2,alignOffset:-5,children:a.jsxs("div",{className:"tlui-people-menu__wrapper",children:[a.jsx("div",{className:"tlui-people-menu__section",children:a.jsx(xge,{})}),r.length>0&&a.jsx("div",{className:"tlui-people-menu__section",children:r.map(u=>a.jsx(mge,{userId:u},u+"_presence"))}),e]})})})]})});function wge(){return a.jsx("div",{className:"tlui-share-zone",draggable:!1,children:a.jsx(Sge,{})})}const bge=Object.freeze([ei,jl,Nl,Nr]);function f$(n=bge){const e=G();return q("getRelevantStyles",()=>{var r;const t=new e_(e.getSharedStyles()),s=!!((r=e.root.getCurrent())!=null&&r.shapeType),i=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const o of n)t.applyValue(o,e.getStyleForNextShape(o));return s||i||t.size>0?t:null},[e])}const yi={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},gl=b.memo(function(e){const{uiType:t,items:s,title:i,style:r,value:o,onValueChange:l,theme:c}=e,d=G(),u=Fe(),h=b.useRef(!1),p=b.useRef(null),{handleButtonClick:f,handleButtonPointerDown:g,handleButtonPointerEnter:m,handleButtonPointerUp:x}=b.useMemo(()=>{const y=()=>{h.current=!1,window.removeEventListener("pointerup",y);const I=p.current;I&&["TEXTAREA","INPUT"].includes(I.nodeName)&&I.focus(),p.current=null};return{handleButtonClick:I=>{const{id:E}=I.currentTarget.dataset;o.type==="shared"&&o.value===E||(d.mark("point picker item"),l(r,E))},handleButtonPointerDown:I=>{const{id:E}=I.currentTarget.dataset;d.mark("point picker item"),l(r,E),h.current=!0,p.current=document.activeElement,window.addEventListener("pointerup",y)},handleButtonPointerEnter:I=>{if(!h.current)return;const{id:E}=I.currentTarget.dataset;l(r,E)},handleButtonPointerUp:I=>{const{id:E}=I.currentTarget.dataset;o.type==="shared"&&o.value===E||l(r,E)}}},[o,d,l,r]);return a.jsx("div",{"data-testid":`style.${t}`,className:Se("tlui-buttons__grid"),children:s.map(y=>a.jsx(we,{type:"icon","data-id":y.value,"data-testid":`style.${t}.${y.value}`,"aria-label":y.value,"data-state":o.type==="shared"&&o.value===y.value?"hinted":void 0,title:i+"  "+u(`${t}-style.${y.value}`),className:Se("tlui-button-grid__button"),style:r===ei?{color:c[y.value].solid}:void 0,onPointerEnter:m,onPointerDown:g,onPointerUp:x,onClick:f,children:a.jsx(De,{icon:y.icon})},y.value))})});function g$(n,[e,t]){return Math.min(t,Math.max(e,n))}function _ge(n){const e=b.useRef({value:n,previous:n});return b.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var m$=["PageUp","PageDown"],y$=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],v$={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Vd="Slider",[j_,Cge,Ege]=vx(Vd),[x$]=Fr(Vd,[Ege]),[Tge,Lx]=x$(Vd),S$=b.forwardRef((n,e)=>{const{name:t,min:s=0,max:i=100,step:r=1,orientation:o="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:d=[s],value:u,onValueChange:h=()=>{},onValueCommit:p=()=>{},inverted:f=!1,form:g,...m}=n,x=b.useRef(new Set),y=b.useRef(0),v=o==="horizontal"?Ige:Pge,[C=[],T]=Wa({prop:u,defaultProp:d,onChange:D=>{var A;(A=[...x.current][y.current])==null||A.focus(),h(D)}}),I=b.useRef(C);function E(D){const R=Rge(C,D);j(D,R)}function P(D){j(D,y.current)}function k(){const D=I.current[y.current];C[y.current]!==D&&p(C)}function j(D,R,{commit:A}={commit:!1}){const N=Lge(r),B=Fge(Math.round((D-s)/r)*r+s,N),L=g$(B,[s,i]);T((O=[])=>{const F=jge(O,L,R);if(Dge(F,c*r)){y.current=F.indexOf(L);const W=String(F)!==String(O);return W&&A&&p(F),W?F:O}else return O})}return a.jsx(Tge,{scope:n.__scopeSlider,name:t,disabled:l,min:s,max:i,valueIndexToChangeRef:y,thumbs:x.current,values:C,orientation:o,form:g,children:a.jsx(j_.Provider,{scope:n.__scopeSlider,children:a.jsx(j_.Slot,{scope:n.__scopeSlider,children:a.jsx(v,{"aria-disabled":l,"data-disabled":l?"":void 0,...m,ref:e,onPointerDown:me(m.onPointerDown,()=>{l||(I.current=C)}),min:s,max:i,inverted:f,onSlideStart:l?void 0:E,onSlideMove:l?void 0:P,onSlideEnd:l?void 0:k,onHomeKeyDown:()=>!l&&j(s,0,{commit:!0}),onEndKeyDown:()=>!l&&j(i,C.length-1,{commit:!0}),onStepKeyDown:({event:D,direction:R})=>{if(!l){const B=m$.includes(D.key)||D.shiftKey&&y$.includes(D.key)?10:1,L=y.current,O=C[L],F=r*B*R;j(O+F,L,{commit:!0})}}})})})})});S$.displayName=Vd;var[w$,b$]=x$(Vd,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Ige=b.forwardRef((n,e)=>{const{min:t,max:s,dir:i,inverted:r,onSlideStart:o,onSlideMove:l,onSlideEnd:c,onStepKeyDown:d,...u}=n,[h,p]=b.useState(null),f=dt(e,v=>p(v)),g=b.useRef(void 0),m=Y1(i),x=m==="ltr",y=x&&!r||!x&&r;function S(v){const C=g.current||h.getBoundingClientRect(),T=[0,C.width],E=cT(T,y?[t,s]:[s,t]);return g.current=C,E(v-C.left)}return a.jsx(w$,{scope:n.__scopeSlider,startEdge:y?"left":"right",endEdge:y?"right":"left",direction:y?1:-1,size:"width",children:a.jsx(_$,{dir:m,"data-orientation":"horizontal",...u,ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:v=>{const C=S(v.clientX);o==null||o(C)},onSlideMove:v=>{const C=S(v.clientX);l==null||l(C)},onSlideEnd:()=>{g.current=void 0,c==null||c()},onStepKeyDown:v=>{const T=v$[y?"from-left":"from-right"].includes(v.key);d==null||d({event:v,direction:T?-1:1})}})})}),Pge=b.forwardRef((n,e)=>{const{min:t,max:s,inverted:i,onSlideStart:r,onSlideMove:o,onSlideEnd:l,onStepKeyDown:c,...d}=n,u=b.useRef(null),h=dt(e,u),p=b.useRef(void 0),f=!i;function g(m){const x=p.current||u.current.getBoundingClientRect(),y=[0,x.height],v=cT(y,f?[s,t]:[t,s]);return p.current=x,v(m-x.top)}return a.jsx(w$,{scope:n.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1,children:a.jsx(_$,{"data-orientation":"vertical",...d,ref:h,style:{...d.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:m=>{const x=g(m.clientY);r==null||r(x)},onSlideMove:m=>{const x=g(m.clientY);o==null||o(x)},onSlideEnd:()=>{p.current=void 0,l==null||l()},onStepKeyDown:m=>{const y=v$[f?"from-bottom":"from-top"].includes(m.key);c==null||c({event:m,direction:y?-1:1})}})})}),_$=b.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:s,onSlideMove:i,onSlideEnd:r,onHomeKeyDown:o,onEndKeyDown:l,onStepKeyDown:c,...d}=n,u=Lx(Vd,t);return a.jsx(Ge.span,{...d,ref:e,onKeyDown:me(n.onKeyDown,h=>{h.key==="Home"?(o(h),h.preventDefault()):h.key==="End"?(l(h),h.preventDefault()):m$.concat(y$).includes(h.key)&&(c(h),h.preventDefault())}),onPointerDown:me(n.onPointerDown,h=>{const p=h.target;p.setPointerCapture(h.pointerId),h.preventDefault(),u.thumbs.has(p)?p.focus():s(h)}),onPointerMove:me(n.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&i(h)}),onPointerUp:me(n.onPointerUp,h=>{const p=h.target;p.hasPointerCapture(h.pointerId)&&(p.releasePointerCapture(h.pointerId),r(h))})})}),C$="SliderTrack",E$=b.forwardRef((n,e)=>{const{__scopeSlider:t,...s}=n,i=Lx(C$,t);return a.jsx(Ge.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...s,ref:e})});E$.displayName=C$;var N_="SliderRange",T$=b.forwardRef((n,e)=>{const{__scopeSlider:t,...s}=n,i=Lx(N_,t),r=b$(N_,t),o=b.useRef(null),l=dt(e,o),c=i.values.length,d=i.values.map(p=>k$(p,i.min,i.max)),u=c>1?Math.min(...d):0,h=100-Math.max(...d);return a.jsx(Ge.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...s,ref:l,style:{...n.style,[r.startEdge]:u+"%",[r.endEdge]:h+"%"}})});T$.displayName=N_;var R_="SliderThumb",I$=b.forwardRef((n,e)=>{const t=Cge(n.__scopeSlider),[s,i]=b.useState(null),r=dt(e,l=>i(l)),o=b.useMemo(()=>s?t().findIndex(l=>l.ref.current===s):-1,[t,s]);return a.jsx(kge,{...n,ref:r,index:o})}),kge=b.forwardRef((n,e)=>{const{__scopeSlider:t,index:s,name:i,...r}=n,o=Lx(R_,t),l=b$(R_,t),[c,d]=b.useState(null),u=dt(e,S=>d(S)),h=c?o.form||!!c.closest("form"):!0,p=JB(c),f=o.values[s],g=f===void 0?0:k$(f,o.min,o.max),m=Nge(s,o.values.length),x=p==null?void 0:p[l.size],y=x?Mge(x,g,l.direction):0;return b.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),a.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${g}% + ${y}px)`},children:[a.jsx(j_.ItemSlot,{scope:n.__scopeSlider,children:a.jsx(Ge.span,{role:"slider","aria-label":n["aria-label"]||m,"aria-valuemin":o.min,"aria-valuenow":f,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...r,ref:u,style:f===void 0?{display:"none"}:n.style,onFocus:me(n.onFocus,()=>{o.valueIndexToChangeRef.current=s})})}),h&&a.jsx(P$,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:f},s)]})});I$.displayName=R_;var Age="RadioBubbleInput",P$=b.forwardRef(({__scopeSlider:n,value:e,...t},s)=>{const i=b.useRef(null),r=dt(i,s),o=_ge(e);return b.useEffect(()=>{const l=i.current;if(!l)return;const c=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==e&&u){const h=new Event("input",{bubbles:!0});u.call(l,e),l.dispatchEvent(h)}},[o,e]),a.jsx(Ge.input,{style:{display:"none"},...t,ref:r,defaultValue:e})});P$.displayName=Age;function jge(n=[],e,t){const s=[...n];return s[t]=e,s.sort((i,r)=>i-r)}function k$(n,e,t){const r=100/(t-e)*(n-e);return g$(r,[0,100])}function Nge(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function Rge(n,e){if(n.length===1)return 0;const t=n.map(i=>Math.abs(i-e)),s=Math.min(...t);return t.indexOf(s)}function Mge(n,e,t){const s=n/2,r=cT([0,50],[0,s]);return(s-r(e)*t)*t}function Oge(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function Dge(n,e){if(e>0){const t=Oge(n);return Math.min(...t)>=e}return!0}function cT(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const s=(e[1]-e[0])/(n[1]-n[0]);return e[0]+s*(t-n[0])}}function Lge(n){return(String(n).split(".")[1]||"").length}function Fge(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}var Bge=S$,Uge=E$,$ge=T$,zge=I$;const Wge=b.memo(function(e){const{title:t,steps:s,value:i,label:r,onValueChange:o}=e,l=G(),c=Fe(),d=b.useCallback(p=>{o(p[0])},[o]),u=b.useCallback(()=>{l.mark("click slider")},[l]),h=b.useCallback(()=>{i&&o(i)},[i,o]);return a.jsx("div",{className:"tlui-slider__container",children:a.jsxs(Bge,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:s,step:1,value:i?[i]:void 0,onPointerDown:u,onValueChange:d,onPointerUp:h,title:t+"  "+c(r),children:[a.jsx(Uge,{className:"tlui-slider__track",dir:"ltr",children:i!==null&&a.jsx($ge,{className:"tlui-slider__range",dir:"ltr"})}),i!==null&&a.jsx(zge,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function Hge({label:n,uiTypeA:e,uiTypeB:t,labelA:s,labelB:i,itemsA:r,itemsB:o,styleA:l,styleB:c,valueA:d,valueB:u,onValueChange:h}){const p=Fe(),f=b.useMemo(()=>{var m;return((m=r.find(x=>d.type==="shared"&&d.value===x.value))==null?void 0:m.icon)??"mixed"},[r,d]),g=b.useMemo(()=>{var m;return((m=o.find(x=>u.type==="shared"&&u.value===x.value))==null?void 0:m.icon)??"mixed"},[o,u]);return d===void 0&&u===void 0?null:a.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[a.jsx("div",{title:p(n),className:"tlui-style-panel__double-select-picker-label",children:p(n)}),a.jsxs("div",{className:"tlui-buttons__horizontal",children:[a.jsxs(Fl,{id:`style panel ${e} A`,children:[a.jsx(Bl,{children:a.jsx(we,{type:"icon","data-testid":`style.${e}`,title:p(s)+"  "+(d===null||d.type==="mixed"?p("style-panel.mixed"):p(`${e}-style.${d.value}`)),children:a.jsx(De,{icon:f,small:!0,invertIcon:!0})})}),a.jsx(Ul,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:a.jsx("div",{className:"tlui-buttons__grid",children:r.map((m,x)=>a.jsx(dp,{"data-testid":`style.${e}.${m.value}`,children:a.jsx(we,{type:"icon",onClick:()=>h(l,m.value),title:`${p(s)}  ${p(`${e}-style.${m.value}`)}`,children:a.jsx(De,{icon:m.icon,invertIcon:!0})},m.value)},x))})})]}),a.jsxs(Fl,{id:`style panel ${t}`,children:[a.jsx(Bl,{children:a.jsx(we,{type:"icon","data-testid":`style.${t}`,title:p(i)+"  "+(u===null||u.type==="mixed"?p("style-panel.mixed"):p(`${t}-style.${u.value}`)),children:a.jsx(De,{icon:g,small:!0})})}),a.jsx(Ul,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:a.jsx("div",{className:"tlui-buttons__grid",children:o.map(m=>a.jsx(dp,{children:a.jsx(we,{type:"icon",title:`${p(i)}  ${p(`${t}-style.${m.value}`)}`,"data-testid":`style.${t}.${m.value}`,onClick:()=>h(c,m.value),children:a.jsx(De,{icon:m.icon})})},m.value))})})]})]})]})}const Gge=b.memo(Hge);function Vge({id:n,label:e,uiType:t,style:s,items:i,type:r,value:o,onValueChange:l}){const c=Fe(),d=G(),u=b.useMemo(()=>{var f;return(f=i.find(g=>o.type==="shared"&&g.value===o.value))==null?void 0:f.icon},[i,o]),h=o.type==="mixed"?c("style-panel.mixed"):c(`${t}-style.${o.value}`),p=e?c(e):"";return a.jsxs(Fl,{id:`style panel ${n}`,children:[a.jsx(Bl,{children:a.jsxs(we,{type:r,"data-testid":`style.${t}`,title:h,children:[a.jsx(Vt,{children:p}),a.jsx(De,{icon:u??"mixed"})]})}),a.jsx(Ul,{side:"left",align:"center",alignOffset:0,children:a.jsx("div",{className:"tlui-buttons__grid",children:i.map(f=>a.jsx(dp,{children:a.jsx(we,{type:"icon","data-testid":`style.${t}.${f.value}`,title:c(`${t}-style.${f.value}`),onClick:()=>{d.mark("select style dropdown item"),l(s,f.value)},children:a.jsx(De,{icon:f.icon})})},f.value))})})]})}const dT=b.memo(Vge);function Kge({styles:n}){const e=Wp();if(!n)return null;const t=n.get(mi),s=n.get(Cy),i=n.get(_y),r=n.get(Py),o=n.get(jr),l=t===void 0,c=s===void 0&&i===void 0,d=r===void 0,u=o===void 0,h=No({isDarkMode:e});return a.jsxs(a.Fragment,{children:[a.jsx(Yge,{theme:h,styles:n}),!u&&a.jsx(Xge,{theme:h,styles:n}),!(l&&c&&d)&&a.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a.jsx(qge,{styles:n}),a.jsx(Jge,{styles:n}),a.jsx(Zge,{styles:n})]})]})}function ef(){const n=G(),e=An();return Oe.useMemo(()=>function(s,i){n.run(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(s,i),n.setStyleForNextShapes(s,i),n.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:s.id,value:i})},[n,e])}function Yge({styles:n,theme:e}){const t=Fe(),s=G(),i=ef(),r=n.get(ei),o=n.get(Nl),l=n.get(jl),c=n.get(Nr),d=o!==void 0||l!==void 0||c!==void 0;return a.jsxs(a.Fragment,{children:[a.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[r===void 0?null:a.jsx(gl,{title:t("style-panel.color"),uiType:"color",style:ei,items:yi.color,value:r,onValueChange:i,theme:e}),a.jsx(Qge,{})]}),d&&a.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[o===void 0?null:a.jsx(gl,{title:t("style-panel.fill"),uiType:"fill",style:Nl,items:yi.fill,value:o,onValueChange:i,theme:e}),l===void 0?null:a.jsx(gl,{title:t("style-panel.dash"),uiType:"dash",style:jl,items:yi.dash,value:l,onValueChange:i,theme:e}),c===void 0?null:a.jsx(gl,{title:t("style-panel.size"),uiType:"size",style:Nr,items:yi.size,value:c,onValueChange:(u,h)=>{i(u,h);const p=s.getSelectedShapeIds();p.length>0&&ht(s,p)},theme:e})]})]})}function Xge({theme:n,styles:e}){const t=Fe(),s=ef(),i=e.get(jr),r=e.get(K0),o=e.get(Ty),l=e.get(Iy);return i===void 0&&o===void 0?null:a.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[i===void 0?null:a.jsx(gl,{title:t("style-panel.font"),uiType:"font",style:jr,items:yi.font,value:i,onValueChange:s,theme:n}),r===void 0?null:a.jsxs("div",{className:"tlui-style-panel__row",children:[a.jsx(gl,{title:t("style-panel.align"),uiType:"align",style:K0,items:yi.textAlign,value:r,onValueChange:s,theme:n}),a.jsx("div",{className:"tlui-style-panel__row__extra-button",children:a.jsx(we,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:a.jsx(De,{icon:"vertical-align-middle"})})})]}),o===void 0?null:a.jsxs("div",{className:"tlui-style-panel__row",children:[a.jsx(gl,{title:t("style-panel.align"),uiType:"align",style:Ty,items:yi.horizontalAlign,value:o,onValueChange:s,theme:n}),a.jsx("div",{className:"tlui-style-panel__row__extra-button",children:l===void 0?a.jsx(we,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:a.jsx(De,{icon:"vertical-align-middle"})}):a.jsx(dT,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:Iy,items:yi.verticalAlign,value:l,onValueChange:s})})]})]})}function qge({styles:n}){const e=ef(),t=n.get(mi);return t===void 0?null:a.jsx(dT,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:mi,items:yi.geo,value:t,onValueChange:e})}function Zge({styles:n}){const e=ef(),t=n.get(Py);return t===void 0?null:a.jsx(dT,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:Py,items:yi.spline,value:t,onValueChange:e})}function Jge({styles:n}){const e=ef(),t=n.get(Cy),s=n.get(_y);return!t||!s?null:a.jsx(Gge,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:_y,itemsA:yi.arrowheadStart,valueA:s,uiTypeB:"arrowheadEnd",styleB:Cy,itemsB:yi.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const ju=[.1,.25,.5,.75,1];function Qge(){const n=G(),e=q("opacity",()=>n.getSharedOpacity(),[n]),t=An(),s=Fe(),i=Oe.useCallback(o=>{const l=ju[o];n.run(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(l),n.setOpacityForNextShapes(l),n.updateInstanceState({isChangingStyle:!0})}),t("set-style",{source:"style-panel",id:"opacity",value:o})},[n,t]);if(e===void 0)return null;const r=e.type==="mixed"?-1:ju.indexOf(pZ(ju,o=>Math.abs(o-e.value)));return a.jsx(Wge,{"data-testid":"style.opacity",value:r>=0?r:ju.length-1,label:e.type==="mixed"?"style-panel.mixed":`opacity-style.${e.value}`,onValueChange:i,steps:ju.length-1,title:s("style-panel.opacity")})}const eme=b.memo(function({isMobile:e,children:t}){const s=G(),i=f$(),r=b.useCallback(()=>{e||s.updateInstanceState({isChangingStyle:!1})},[s,e]),o=t??a.jsx(Kge,{styles:i});return a.jsx("div",{className:Se("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:r,children:o})});function tme(){const n=G(),e=Fe(),t=f$(),s=t==null?void 0:t.get(ei),i=No({isDarkMode:n.user.getIsDarkMode()}),r=((s==null?void 0:s.type)==="shared"?i[s.value]:i.black).solid,o=q("disable style panel",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),l=b.useCallback(d=>{d||n.updateInstanceState({isChangingStyle:!1})},[n]),{StylePanel:c}=Ka();return c?a.jsxs(G1,{id:"mobile style menu",onOpenChange:l,children:[a.jsx(V1,{children:a.jsx(we,{type:"tool","data-testid":"mobile-styles.button",style:{color:o?"var(--color-muted-1)":r},title:e("style-panel.title"),disabled:o,children:a.jsx(De,{icon:o?"blob":(s==null?void 0:s.type)==="mixed"?"mixed":"blob"})})}),a.jsx(K1,{side:"top",align:"end",children:c&&a.jsx(c,{isMobile:!0})})]}):null}function nme(){return a.jsxs(a.Fragment,{children:[a.jsx(ime,{}),a.jsx(rme,{}),a.jsx(ome,{}),a.jsx(ame,{}),a.jsx(lme,{}),a.jsx(cme,{}),a.jsx(dme,{}),a.jsx(ume,{}),a.jsx(hme,{}),a.jsx(pme,{}),a.jsx(gme,{}),a.jsx(fme,{}),a.jsx(vme,{}),a.jsx(wme,{}),a.jsx(mme,{}),a.jsx(Sme,{}),a.jsx(xme,{}),a.jsx(yme,{}),a.jsx(bme,{}),a.jsx(_me,{}),a.jsx(Cme,{}),a.jsx(Eme,{}),a.jsx(Tme,{}),a.jsx(Ime,{}),a.jsx(Pme,{}),a.jsx(kme,{}),a.jsx(jme,{}),a.jsx(Ame,{})]})}function sme(n){var s;const e=G(),t=(s=n.meta)==null?void 0:s.geo;return q("is tool selected",()=>{const i=e.getCurrentToolId(),r=e.getSharedStyles().getAsKnownValue(mi);return t?i==="geo"&&r===t:i===n.id},[e,n.id,t])}function ut({tool:n}){const e=Cx(),t=sme(e[n]);return a.jsx(X,{...e[n],isSelected:t})}function ime(){return a.jsx(ut,{tool:"select"})}function rme(){return a.jsx(ut,{tool:"hand"})}function ome(){return a.jsx(ut,{tool:"draw"})}function ame(){return a.jsx(ut,{tool:"eraser"})}function lme(){return a.jsx(ut,{tool:"arrow"})}function cme(){return a.jsx(ut,{tool:"text"})}function dme(){return a.jsx(ut,{tool:"note"})}function ume(){const n=Cx();return a.jsx(X,{...n.asset})}function hme(){return a.jsx(ut,{tool:"rectangle"})}function pme(){return a.jsx(ut,{tool:"ellipse"})}function fme(){return a.jsx(ut,{tool:"diamond"})}function gme(){return a.jsx(ut,{tool:"triangle"})}function mme(){return a.jsx(ut,{tool:"rhombus"})}function yme(){return a.jsx(ut,{tool:"heart"})}function vme(){return a.jsx(ut,{tool:"hexagon"})}function xme(){return a.jsx(ut,{tool:"cloud"})}function Sme(){return a.jsx(ut,{tool:"star"})}function wme(){return a.jsx(ut,{tool:"oval"})}function bme(){return a.jsx(ut,{tool:"x-box"})}function _me(){return a.jsx(ut,{tool:"check-box"})}function Cme(){return a.jsx(ut,{tool:"arrow-left"})}function Eme(){return a.jsx(ut,{tool:"arrow-up"})}function Tme(){return a.jsx(ut,{tool:"arrow-down"})}function Ime(){return a.jsx(ut,{tool:"arrow-right"})}function Pme(){return a.jsx(ut,{tool:"line"})}function kme(){return a.jsx(ut,{tool:"highlight"})}function Ame(){return a.jsx(ut,{tool:"frame"})}function jme(){return a.jsx(ut,{tool:"laser"})}const Ww=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Hw(n,e,t,s){n.addEventListener?n.addEventListener(e,t,s):n.attachEvent&&n.attachEvent("on".concat(e),t)}function Nu(n,e,t,s){n.removeEventListener?n.removeEventListener(e,t,s):n.detachEvent&&n.detachEvent("on".concat(e),t)}function A$(n,e){const t=e.slice(0,e.length-1);for(let s=0;s<t.length;s++)t[s]=n[t[s].toLowerCase()];return t}function j$(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function Nme(n,e){const t=n.length>=e.length?n:e,s=n.length>=e.length?e:n;let i=!0;for(let r=0;r<t.length;r++)s.indexOf(t[r])===-1&&(i=!1);return i}const up={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":Ww?173:189,"=":Ww?61:187,";":Ww?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Hi={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,meta:91,command:91},ah={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Sn={16:!1,18:!1,17:!1,91:!1},Ot={};for(let n=1;n<20;n++)up["f".concat(n)]=111+n;let It=[],Th=null,N$="all";const Yr=new Map,Kd=n=>up[n.toLowerCase()]||Hi[n.toLowerCase()]||n.toUpperCase().charCodeAt(0),Rme=n=>Object.keys(up).find(e=>up[e]===n),Mme=n=>Object.keys(Hi).find(e=>Hi[e]===n);function R$(n){N$=n||"all"}function hp(){return N$||"all"}function Ome(){return It.slice(0)}function Dme(){return It.map(n=>Rme(n)||Mme(n)||String.fromCharCode(n))}function Lme(){const n=[];return Object.keys(Ot).forEach(e=>{Ot[e].forEach(t=>{let{key:s,scope:i,mods:r,shortcut:o}=t;n.push({scope:i,shortcut:o,mods:r,keys:s.split("+").map(l=>Kd(l))})})}),n}function Fme(n){const e=n.target||n.srcElement,{tagName:t}=e;let s=!0;const i=t==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(i||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(s=!1),s}function Bme(n){return typeof n=="string"&&(n=Kd(n)),It.indexOf(n)!==-1}function Ume(n,e){let t,s;n||(n=hp());for(const i in Ot)if(Object.prototype.hasOwnProperty.call(Ot,i))for(t=Ot[i],s=0;s<t.length;)t[s].scope===n?t.splice(s,1).forEach(o=>{let{element:l}=o;return uT(l)}):s++;hp()===n&&R$(e||"all")}function $me(n){let e=n.keyCode||n.which||n.charCode;n.key&&n.key.toLowerCase()==="capslock"&&(e=Kd(n.key));const t=It.indexOf(e);if(t>=0&&It.splice(t,1),n.key&&n.key.toLowerCase()==="meta"&&It.splice(0,It.length),(e===93||e===224)&&(e=91),e in Sn){Sn[e]=!1;for(const s in Hi)Hi[s]===e&&(Ps[s]=!1)}}function M$(n){if(typeof n>"u")Object.keys(Ot).forEach(i=>{Array.isArray(Ot[i])&&Ot[i].forEach(r=>_g(r)),delete Ot[i]}),uT(null);else if(Array.isArray(n))n.forEach(i=>{i.key&&_g(i)});else if(typeof n=="object")n.key&&_g(n);else if(typeof n=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];let[i,r]=t;typeof i=="function"&&(r=i,i=""),_g({key:n,scope:i,method:r,splitKey:"+"})}}const _g=n=>{let{key:e,scope:t,method:s,splitKey:i="+"}=n;j$(e).forEach(o=>{const l=o.split(i),c=l.length,d=l[c-1],u=d==="*"?"*":Kd(d);if(!Ot[u])return;t||(t=hp());const h=c>1?A$(Hi,l):[],p=[];Ot[u]=Ot[u].filter(f=>{const m=(s?f.method===s:!0)&&f.scope===t&&Nme(f.mods,h);return m&&p.push(f.element),!m}),p.forEach(f=>uT(f))})};function Xj(n,e,t,s){if(e.element!==s)return;let i;if(e.scope===t||e.scope==="all"){i=e.mods.length>0;for(const r in Sn)Object.prototype.hasOwnProperty.call(Sn,r)&&(!Sn[r]&&e.mods.indexOf(+r)>-1||Sn[r]&&e.mods.indexOf(+r)===-1)&&(i=!1);(e.mods.length===0&&!Sn[16]&&!Sn[18]&&!Sn[17]&&!Sn[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(It),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}function qj(n,e){const t=Ot["*"];let s=n.keyCode||n.which||n.charCode;if(n.key&&n.key.toLowerCase()==="capslock"||!Ps.filter.call(this,n))return;if((s===93||s===224)&&(s=91),It.indexOf(s)===-1&&s!==229&&It.push(s),["metaKey","ctrlKey","altKey","shiftKey"].forEach(l=>{const c=ah[l];n[l]&&It.indexOf(c)===-1?It.push(c):!n[l]&&It.indexOf(c)>-1?It.splice(It.indexOf(c),1):l==="metaKey"&&n[l]&&(It=It.filter(d=>d in ah||d===s))}),s in Sn){Sn[s]=!0;for(const l in Hi)if(Object.prototype.hasOwnProperty.call(Hi,l)){const c=ah[Hi[l]];Ps[l]=n[c]}if(!t)return}for(const l in Sn)Object.prototype.hasOwnProperty.call(Sn,l)&&(Sn[l]=n[ah[l]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(It.indexOf(17)===-1&&It.push(17),It.indexOf(18)===-1&&It.push(18),Sn[17]=!0,Sn[18]=!0);const i=hp();if(t)for(let l=0;l<t.length;l++)t[l].scope===i&&(n.type==="keydown"&&t[l].keydown||n.type==="keyup"&&t[l].keyup)&&Xj(n,t[l],i,e);if(!(s in Ot))return;const r=Ot[s],o=r.length;for(let l=0;l<o;l++)if((n.type==="keydown"&&r[l].keydown||n.type==="keyup"&&r[l].keyup)&&r[l].key){const c=r[l],{splitKey:d}=c,u=c.key.split(d),h=[];for(let p=0;p<u.length;p++)h.push(Kd(u[p]));h.sort().join("")===It.sort().join("")&&Xj(n,c,i,e)}}function Ps(n,e,t){It=[];const s=j$(n);let i=[],r="all",o=document,l=0,c=!1,d=!0,u="+",h=!1,p=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(r=e.scope),e.element&&(o=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(d=e.keydown),e.capture!==void 0&&(h=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(r=e),p&&M$(n,r);l<s.length;l++)n=s[l].split(u),i=[],n.length>1&&(i=A$(Hi,n)),n=n[n.length-1],n=n==="*"?"*":Kd(n),n in Ot||(Ot[n]=[]),Ot[n].push({keyup:c,keydown:d,scope:r,mods:i,shortcut:s[l],method:t,key:s[l],splitKey:u,element:o});if(typeof o<"u"&&window){if(!Yr.has(o)){const f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return qj(m,o)},g=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;qj(m,o),$me(m)};Yr.set(o,{keydownListener:f,keyupListenr:g,capture:h}),Hw(o,"keydown",f,h),Hw(o,"keyup",g,h)}if(!Th){const f=()=>{It=[]};Th={listener:f,capture:h},Hw(window,"focus",f,h)}}}function zme(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Ot).forEach(t=>{Ot[t].filter(i=>i.scope===e&&i.shortcut===n).forEach(i=>{i&&i.method&&i.method()})})}function uT(n){const e=Object.values(Ot).flat();if(e.findIndex(s=>{let{element:i}=s;return i===n})<0){const{keydownListener:s,keyupListenr:i,capture:r}=Yr.get(n)||{};s&&i&&(Nu(n,"keyup",i,r),Nu(n,"keydown",s,r),Yr.delete(n))}if((e.length<=0||Yr.size<=0)&&(Object.keys(Yr).forEach(i=>{const{keydownListener:r,keyupListenr:o,capture:l}=Yr.get(i)||{};r&&o&&(Nu(i,"keyup",o,l),Nu(i,"keydown",r,l),Yr.delete(i))}),Yr.clear(),Object.keys(Ot).forEach(i=>delete Ot[i]),Th)){const{listener:i,capture:r}=Th;Nu(window,"focus",i,r),Th=null}}const Gw={getPressedKeyString:Dme,setScope:R$,getScope:hp,deleteScope:Ume,getPressedKeyCodes:Ome,getAllKeyCodes:Lme,isPressed:Bme,filter:Fme,trigger:zme,unbind:M$,keyMap:up,modifier:Hi,modifierMap:ah};for(const n in Gw)Object.prototype.hasOwnProperty.call(Gw,n)&&(Ps[n]=Gw[n]);if(typeof window<"u"){const n=window.hotkeys;Ps.noConflict=e=>(e&&window.hotkeys===Ps&&(window.hotkeys=n),Ps),window.hotkeys=Ps}const Zj=["copy","cut","paste","asset"];function Wme(){const n=G(),e=Ro(),t=xe(),s=Cx(),i=q("is focused",()=>n.getInstanceState().isFocused,[n]);b.useEffect(()=>{if(!i)return;const r=new Array,o=(c,d)=>{Ps(c,{element:document.body},d),r.push(()=>{Ps.unbind(c,d)})},l=(c,d)=>{Ps(c,{element:document.body,keyup:!0,keydown:!1},d),r.push(()=>{Ps.unbind(c,d)})};for(const c of Object.values(t))c.kbd&&(e&&!c.readonlyOk||Zj.includes(c.id)||o(Jj(c.kbd),d=>{lh(n)||(ze(d),c.onSelect("kbd"))}));for(const c of Object.values(s))!c.kbd||!c.readonlyOk&&n.getInstanceState().isReadonly||Zj.includes(c.id)||o(Jj(c.kbd),d=>{lh(n)||(ze(d),c.onSelect("kbd"))});return o(",",c=>{if(lh(n)||n.inputs.keys.has("Comma"))return;ze(c),n.focus(),n.inputs.keys.add("Comma");const{x:d,y:u,z:h}=n.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_down",point:{x:d,y:u,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p)}),l(",",c=>{if(lh(n)||!n.inputs.keys.has("Comma"))return;n.inputs.keys.delete("Comma");const{x:d,y:u,z:h}=n.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_up",point:{x:d,y:u,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p)}),()=>{r.forEach(c=>c())}},[t,s,e,n,i])}function Jj(n){return Hme(n).map(e=>{let t="";const s=e.split("");return s.length===1?t=s[0]:s[0]==="!"?t=`shift+${s[1]}`:s[0]==="?"?s.length===3&&s[1]==="!"?t=`alt+shift+${s[2]}`:t=`alt+${s[1]}`:s[0]==="$"?s[1]==="!"?t=`cmd+shift+${s[2]},ctrl+shift+${s[2]}`:s[1]==="?"?t=`cmd++${s[2]},ctrl+alt+${s[2]}`:t=`cmd+${s[1]},ctrl+${s[1]}`:t=e,t}).join(",")}function Hme(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function lh(n){return n.getIsMenuOpen()||n.getEditingShapeId()!==null||n.getCrashingError()}const Gme=b.createContext(!1);function Vme({children:n}){const e=G(),t=$L(),s=hs(),i=Fe(),r=Math.min(8,5+s),[o,l]=b.useState(0),c=b.useRef(null),[d,u]=b.useState(null),h=b.useMemo(()=>{const f=d?`:not([data-value="${d}"])`:"";return`
			#${t}_main > *:nth-child(n + ${r+(d?1:2)})${f} {
				display: none;
			}
			#${t}_more > *:nth-child(-n + ${r}) {
				display: none;
			}
        `},[d,t,r]),p=vF(()=>{if(!c.current)return;const f=Array.from(c.current.children);l(f.length),f.findIndex(x=>x.getAttribute("data-value")===d)<=r&&u(null);const m=Array.from(c.current.children).findIndex(x=>x.getAttribute("aria-checked")==="true");m!==-1&&m>=r&&u(f[m].getAttribute("data-value"))});return b.useLayoutEffect(()=>{p()}),b.useLayoutEffect(()=>{if(!c.current)return;const f=new MutationObserver(p);return f.observe(c.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{f.disconnect()}},[p]),b.useEffect(()=>{const f=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[g,m]of f)Ps(g,x=>{var v;if(lh(e))return;ze(x);const S=Array.from(((v=c.current)==null?void 0:v.children)??[]).filter(C=>!(C instanceof HTMLElement)||C.tagName.toLowerCase()!=="button"?!1:!!(C.offsetWidth||C.offsetHeight))[m];S&&S.click()});return()=>{Ps.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),a.jsxs(a.Fragment,{children:[a.jsx("style",{children:h}),a.jsxs("div",{className:Se("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":s<zt.TABLET_SM}),role:"radiogroup",children:[a.jsx("div",{id:`${t}_main`,ref:c,className:"tlui-toolbar__tools__list",children:a.jsx(_i,{type:"toolbar",sourceId:"toolbar",children:n})}),o>r+1&&a.jsx(Gme.Provider,{value:!0,children:a.jsxs(Fl,{id:"toolbar overflow",modal:!1,children:[a.jsx(Bl,{children:a.jsx(we,{title:i("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:a.jsx(De,{icon:"chevron-up"})})}),a.jsx(Ul,{side:"top",align:"center",children:a.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${t}_more`,children:a.jsx(_i,{type:"toolbar-overflow",sourceId:"toolbar",children:n})})})]})})]})]})}function Kme({activeToolId:n}){const e=G(),t=hs(),s=Fe(),i=q("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),r=q("current tool",()=>e.getCurrentTool(),[e]);return!n||!r.isLockable?null:a.jsx(we,{type:"normal",title:s("action.toggle-tool-lock"),"data-testid":"tool-lock",className:Se("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<zt.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!i}),children:a.jsx(De,{icon:i?"lock":"unlock",small:!0})})}const Yme=b.memo(function({children:e}){const t=G(),s=hs(),i=Ro(),r=q("current tool id",()=>t.getCurrentToolId(),[t]),{ActionsMenu:o,QuickActions:l}=Ka();return a.jsx("div",{className:"tlui-toolbar",children:a.jsxs("div",{className:"tlui-toolbar__inner",children:[a.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&a.jsxs("div",{className:"tlui-toolbar__extras",children:[s<zt.TABLET&&a.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[l&&a.jsx(l,{}),o&&a.jsx(o,{})]}),a.jsx(Kme,{activeToolId:r})]}),a.jsx(Vme,{children:e??a.jsx(nme,{})})]}),s<zt.TABLET_SM&&!i&&a.jsx("div",{className:"tlui-toolbar__tools",children:a.jsx(tme,{})})]})})});function Xme(){const n=Fe();return a.jsxs("div",{className:Se("tlui-offline-indicator"),children:[n("status.offline"),a.jsx(Mr,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function qme({maxWidth:n=420,ignoreRightWidth:e=0,stylePanelWidth:t=148,marginBetweenZones:s=12,squeezeAmount:i=52,children:r}){const o=b.useRef(null),l=hs(),c=b.useCallback(()=>{const d=o.current;if(!d)return;const u=d.parentElement.parentElement,h=u.querySelector(".tlui-layout__top__left"),p=u.querySelector(".tlui-layout__top__right"),f=u.offsetWidth,g=h.offsetWidth,m=p.offsetWidth,x=d.offsetWidth-e;let y=(f-x)/2;f%2!==0&&(y-=.5);const S=g+s,v=d.offsetLeft,C=Math.min(f-m-g-2*s,n),T=Math.max(y,S)-v;p.offsetWidth>t&&l<=6?d.style.setProperty("max-width",C-i+"px"):d.style.setProperty("max-width",C+"px"),d.style.setProperty("transform",`translate(${T}px, 0px)`)},[l,e,s,n,i,t]);return b.useLayoutEffect(()=>{const d=o.current;if(!d)return;const u=d.parentElement.parentElement,h=u.querySelector(".tlui-layout__top__left"),p=u.querySelector(".tlui-layout__top__right"),f=new ResizeObserver(c);return f.observe(h),f.observe(p),f.observe(u),f.observe(d),c(),()=>{f.disconnect()}},[c]),b.useLayoutEffect(()=>{c()}),a.jsx("div",{ref:o,className:"tlui-top-panel__container",children:r})}function Zme(){const n=ade()==="offline";return a.jsx(qme,{children:n&&a.jsx(Xme,{})})}function Jme(){const n=xe();return a.jsxs(a.Fragment,{children:[a.jsx(X,{...n["zoom-in"],noClose:!0}),a.jsx(X,{...n["zoom-out"],noClose:!0}),a.jsx(t$,{}),a.jsx(n$,{}),a.jsx(s$,{})]})}const Qme=b.memo(function({children:e}){const t=fn(),[s,i]=Mo("zoom menu"),r=e??a.jsx(Jme,{});return a.jsxs(rT,{dir:"ltr",open:s,onOpenChange:i,modal:!1,children:[a.jsx(oT,{asChild:!0,dir:"ltr",children:a.jsx(eye,{})}),a.jsx(Dx,{container:t,children:a.jsx(aT,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:a.jsx(_i,{type:"menu",sourceId:"zoom-menu",children:r})})})]})}),eye=b.forwardRef(function(e,t){const s=G(),i=hs(),r=q("zoom",()=>s.getZoomLevel(),[s]),o=Fe(),l=b.useCallback(()=>{s.resetZoom(s.getViewportScreenCenter(),{animation:{duration:s.options.animationMediumMs}})},[s]);return a.jsx(we,{ref:t,...e,type:"icon",title:`${o("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:i<zt.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:l,icon:i<zt.MOBILE?"zoom-in":void 0,children:i<zt.MOBILE?null:a.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(r*100),"%"]})})}),O$=b.createContext(null);function tye({overrides:n={},children:e}){const t=tx(n),s=Ex();return a.jsx(O$.Provider,{value:b.useMemo(()=>({ContextMenu:Sfe,ActionsMenu:Kpe,HelpMenu:null,ZoomMenu:Qme,MainMenu:sge,Minimap:lge,StylePanel:eme,PageMenu:hge,NavigationPanel:dge,Toolbar:Yme,KeyboardShortcutsDialog:Wfe,QuickActions:fge,HelperButtons:$fe,DebugPanel:Nfe,DebugMenu:jfe,MenuPanel:Dfe,SharePanel:s?wge:null,CursorChatBubble:s?_fe:null,TopPanel:s?Zme:null,...t}),[t,s]),children:e})}function Ka(){const n=b.useContext(O$);if(!n)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return n}function nye({overrides:n,components:e,assetUrls:t,onUiEvent:s,forceMobile:i,children:r}){return a.jsx(Eoe,{assetUrls:yce(t),children:a.jsx(Poe,{overrides:bce(n),children:a.jsx(Mle,{onEvent:s,children:a.jsx(dce,{children:a.jsx(Ole,{children:a.jsx(xce,{forceMobile:i,children:a.jsx(tye,{overrides:e,children:a.jsx(sye,{overrides:n,children:r})})})})})})})})}function sye({overrides:n,children:e}){const t=_ce(n);return a.jsx(dde,{overrides:t.actions,children:a.jsx(vce,{overrides:t.tools,children:e})})}function iye(){const n=G(),{addToast:e}=tr();b.useEffect(()=>{function t({name:s,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${s} (${i}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return n.addListener("max-shapes",t),()=>{n.removeListener("max-shapes",t)}},[n,e])}const rye=Oe.memo(function({renderDebugMenuItems:e,children:t,hideUi:s,components:i,...r}){return a.jsx(nye,{...r,components:i,children:a.jsx(oye,{hideUi:s,renderDebugMenuItems:e,children:t})})}),oye=Oe.memo(function({children:e,hideUi:t,...s}){return a.jsxs(a.Fragment,{children:[e,t?null:a.jsx(aye,{...s})]})}),aye=Oe.memo(function(){const e=G(),t=Fe(),s=hs(),i=Ro(),r=q("focus",()=>e.getInstanceState().isFocusMode,[e]),o=q("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:l,TopPanel:c,MenuPanel:d,StylePanel:u,Toolbar:h,HelpMenu:p,NavigationPanel:f,HelperButtons:g,DebugPanel:m,CursorChatBubble:x}=Ka();Wme(),Zce(),iye();const{"toggle-focus-mode":y}=xe();return a.jsxs("div",{className:Se("tlui-layout",{"tlui-layout__mobile":s<zt.TABLET_SM}),"data-breakpoint":s,children:[r?a.jsx("div",{className:"tlui-layout__top",children:a.jsx(we,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>y.onSelect("menu"),children:a.jsx(De,{icon:"dot"})})}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"tlui-layout__top",children:[a.jsxs("div",{className:"tlui-layout__top__left",children:[d&&a.jsx(d,{}),g&&a.jsx(g,{})]}),a.jsx("div",{className:"tlui-layout__top__center",children:c&&a.jsx(c,{})}),a.jsxs("div",{className:"tlui-layout__top__right",children:[l&&a.jsx(l,{}),u&&s>=zt.TABLET_SM&&!i&&a.jsx(u,{})]})]}),a.jsxs("div",{className:"tlui-layout__bottom",children:[a.jsxs("div",{className:"tlui-layout__bottom__main",children:[f&&a.jsx(f,{}),h&&a.jsx(h,{}),p&&a.jsx(p,{})]}),o&&m&&a.jsx(m,{})]})]}),a.jsx(fce,{}),a.jsx(Fle,{}),a.jsx(gce,{}),a.jsx(Ble,{}),x&&a.jsx(x,{})]})});async function lye(n,e){const{url:t,style:s="normal",weight:i="500",display:r,featureSettings:o,stretch:l,unicodeRange:c,variant:d,format:u}=e,h={style:s,weight:i,display:r,featureSettings:o,stretch:l,unicodeRange:c,variant:d},p=new FontFace(n,`url(${t})`,h);return await p.load(),document.fonts.add(p),p.$$_url=t,p.$$_fontface=`
@font-face {
	font-family: ${p.family};
	font-stretch: ${p.stretch};
	font-weight: ${p.weight};
	font-style: ${p.style};
	src: url("${t}") format("${u}")
}`,p}const Cg=(n,e)=>{const[t,s]=b.useState(2);return b.useEffect(()=>{let i=!1;return s(2),lye(n,e).then(()=>{i||s(0)}).catch(r=>{i||(console.error(r),s(1))}),()=>{i=!0}},[n,e]),t};function cye(n){return{draw:{url:n.fonts.draw,format:n.fonts.draw.split(".").pop()},serif:{url:n.fonts.serif,format:n.fonts.serif.split(".").pop()},sansSerif:{url:n.fonts.sansSerif,format:n.fonts.sansSerif.split(".").pop()},monospace:{url:n.fonts.monospace,format:n.fonts.monospace.split(".").pop()}}}function D$(n){const e=b.useMemo(()=>cye(n),[n]),t=[Cg("tldraw_draw",e.draw),Cg("tldraw_serif",e.serif),Cg("tldraw_sans",e.sansSerif),Cg("tldraw_mono",e.monospace)];return{error:t.some(s=>s===1),done:!t.some(s=>s===2)}}function dye(n){const{children:e,maxImageDimension:t,maxAssetSize:s,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:r,onMount:o,components:l={},shapeUtils:c=[],bindingUtils:d=[],tools:u=[],...h}=n,p=tx(l),f=b.useMemo(()=>({Scribble:AA,ShapeIndicators:lie,CollaboratorScribble:AA,SelectionForeground:rie,SelectionBackground:sie,Handles:Jse,...p}),[p]),g=_h(c),m=b.useMemo(()=>[...h5,...g],[g]),x=_h(d),y=b.useMemo(()=>[...NF,...x],[x]),S=_h(u),v=b.useMemo(()=>[...eae,...lre,...S],[S]),C=TB(h.assetUrls),{done:T,error:I}=D$(C);return I?a.jsx(PF,{children:"Could not load assets. Please refresh the page."}):T?a.jsx(Fse,{initialState:"select",...h,components:f,shapeUtils:m,bindingUtils:y,tools:v,children:a.jsxs(rye,{...h,components:f,children:[a.jsx(uye,{maxImageDimension:t,maxAssetSize:s,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:r,onMount:o}),e]})}):a.jsx(s1,{children:a.jsx(GE,{})})}function uye({maxImageDimension:n=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:t=TE,acceptedVideoMimeTypes:s=fD,onMount:i}){const r=G(),o=tr(),l=Fe();kF(()=>{const u=[];return u.push(Foe(r)),Hie(r,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:s},{toasts:o,msg:l}),u.push(r.store.props.onMount(r)),u.push(i==null?void 0:i(r)),()=>{u.forEach(h=>h==null?void 0:h())}});const{Canvas:c}=kt(),{ContextMenu:d}=Ka();return d?a.jsx(d,{}):c?a.jsx(c,{}):null}b.memo(function(e){const[t,s]=b.useState(null),[i,r]=b.useState(null),o=_h(e.shapeUtils??[]),l=b.useMemo(()=>[...h5,...o],[o]),c=_h(e.bindingUtils??[]),d=b.useMemo(()=>[...NF,...c],[c]),u=Hse({snapshot:e.snapshot,shapeUtils:l}),h=TB(),{done:p,error:f}=D$(h),{pageId:g,bounds:m,scale:x,background:y,padding:S,darkMode:v,preserveAspectRatio:C,format:T="svg",licenseKey:I}=e;return b.useLayoutEffect(()=>{if(!i||!u||!p)return;let E=!1;const P=document.createElement("div");i.appendChild(P),i.classList.add("tl-container","tl-theme__light");const k=new le({store:u,shapeUtils:l,bindingUtils:d,tools:[],getContainer:()=>P,licenseKey:I});g&&k.setCurrentPage(g);const j=k.getCurrentPageShapeIds();async function D(){const R=await k.getSvgString([...j],{bounds:m,scale:x,background:y,padding:S,darkMode:v,preserveAspectRatio:C});if(R&&!E){if(T==="svg"){if(!E){const A=new Blob([R.svg],{type:"image/svg+xml"}),N=URL.createObjectURL(A);s(N)}}else if(T==="png"){const A=await DB(k,R.svg,{type:T,quality:1,scale:2,width:R.width,height:R.height});if(A&&!E){const N=URL.createObjectURL(A);s(N)}}}k.dispose()}return D(),()=>{E=!0}},[T,i,u,l,d,g,m,x,y,S,v,C,p,f,I]),f?a.jsx(PF,{children:"Could not load assets."}):p?a.jsx("div",{ref:r,style:{position:"relative",width:"100%",height:"100%"},children:t&&a.jsx("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):a.jsx(s1,{children:a.jsx(GE,{})})});b.memo(function({children:e}){const t=Fe(),s=hs(),i=e??a.jsx(Vfe,{});return s<zt.MOBILE?null:a.jsx("div",{className:"tlui-help-menu",children:a.jsxs(Fl,{id:"help menu",children:[a.jsx(Bl,{children:a.jsx(we,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:a.jsx(De,{icon:"question-mark",small:!0})})}),a.jsx(Ul,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:a.jsx(_i,{type:"menu",sourceId:"help-menu",children:i})})]})})});const hye=Le({schemaVersion:Xn(1),storeVersion:qg,recordVersions:wy(Pe,Le({version:qg,subTypeVersions:wy(Pe,qg).optional(),subTypeKey:Pe.optional()}))}),pye=Le({schemaVersion:Xn(2),sequences:wy(Pe,qg)});Le({tldrawFileFormatVersion:tJ,schema:nJ("schemaVersion",{1:hye,2:pye}),records:bn(Le({id:Pe,typeName:Pe}).allowUnknownProperties())});function fye({onAction:n,onDismiss:e}){const[t,s]=b.useState(!1),i=o=>{s(!0),setTimeout(()=>{e(),n(o)},300)},r=[{id:"draw",icon:"",title:"DRAW",desc:"Start creating on the infinite canvas",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{id:"store",icon:"",title:"PANDA STORE",desc:"Install apps and tools",gradient:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},{id:"chat",icon:"",title:"PANDA AI",desc:"Chat with 5 AI models",gradient:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"}];return a.jsx("div",{className:`pf-welcome-overlay ${t?"pf-welcome-exit":""}`,children:a.jsxs("div",{className:"pf-welcome-content",children:[a.jsx("div",{className:"pf-welcome-logo",children:a.jsx("img",{src:"/panda-icon.png",alt:"Panda Fabrics",className:"pf-logo-icon-lg",style:{width:"80px",height:"80px"}})}),a.jsx("h2",{className:"pf-welcome-title",children:"WELCOME TO PANDA FABRICS"}),a.jsx("p",{className:"pf-welcome-subtitle",children:"Your infinite workspace. Choose where to begin:"}),a.jsx("div",{className:"pf-welcome-cards",children:r.map(o=>a.jsxs("button",{className:"pf-welcome-card",onClick:()=>i(o.id),style:{"--card-gradient":o.gradient},children:[a.jsx("span",{className:"pf-welcome-card-icon",children:o.icon}),a.jsx("strong",{className:"pf-welcome-card-title",children:o.title}),a.jsx("span",{className:"pf-welcome-card-desc",children:o.desc})]},o.id))}),a.jsx("button",{className:"pf-welcome-skip",onClick:()=>i("skip"),children:"Skip and explore freely "})]})})}function gye({plugins:n,roomId:e="panda-pf-default",onEditorMount:t}){const[s,i]=b.useState(()=>localStorage.getItem("panda_theme")!=="light"),[r,o]=b.useState(()=>localStorage.getItem("panda_grid_visible")!=="false"),[l,c]=b.useState(null),[d,u]=b.useState(!1);b.useEffect(()=>{if(!l)return;const y=setTimeout(()=>{try{const S=l.getCurrentPageShapes(),v=sessionStorage.getItem("pf_welcome_dismissed");S.length===0&&!v?u(!0):u(!1)}catch{}},500);return()=>clearTimeout(y)},[l]);const h=b.useCallback(x=>{if(l)try{l.user.updateUserPreferences({colorScheme:x?"dark":"light"})}catch(y){console.log("Theme sync error:",y)}},[l]);b.useEffect(()=>{const x=new MutationObserver(y=>{y.forEach(S=>{if(S.attributeName==="class"){const v=document.body.classList.contains("light-mode");i(!v),h(!v)}})});return x.observe(document.body,{attributes:!0}),()=>x.disconnect()},[h]),b.useEffect(()=>{l&&h(s)},[l,s,h]),b.useEffect(()=>{window.PandaCanvas={toggleGrid:()=>o(x=>{const y=!x;return localStorage.setItem("panda_grid_visible",String(y)),y}),isGridVisible:()=>r,setDarkMode:x=>{i(x),h(x)}}},[r,h]);const p={Toolbar:null,StylePanel:null,NavigationPanel:null,MainMenu:null,PageMenu:null,ActionsMenu:null,QuickActions:null,HelpMenu:null,ZoomMenu:null,ContextMenu:void 0,KeyboardShortcutsDialog:void 0},f=b.useCallback(x=>{console.log("TLDraw Editor mounted"),c(x);const y=document.body.classList.contains("light-mode");try{x.user.updateUserPreferences({colorScheme:y?"light":"dark"})}catch(S){console.log("Initial theme set error:",S)}window.TLDrawEditor=x,t&&t(x)},[t]),g=b.useCallback(x=>{switch(x){case"draw":if(window.TLDrawEditor)try{window.TLDrawEditor.setCurrentTool("draw")}catch{}break;case"store":window.dispatchEvent(new CustomEvent("panda:open-store"));break;case"chat":window.dispatchEvent(new CustomEvent("panda:toggle-chat"));break}},[]),m=b.useCallback(()=>{sessionStorage.setItem("pf_welcome_dismissed","1"),u(!1)},[]);return a.jsxs("div",{className:`pf-canvas-wrapper ${r?"show-grid":""} ${s?"dark":"light"}`,children:[a.jsx(dye,{persistenceKey:e,components:p,onMount:f}),d&&a.jsx(fye,{onAction:g,onDismiss:m}),n&&n.length>0&&a.jsxs("div",{className:"pf-plugins-indicator",children:[n.length," plugin(s) active"]})]})}function mye({onCatalogClick:n,onToolsClick:e,onStoreClick:t,onSettingsClick:s,onFinanceClick:i,onGasometerClick:r,onCouncilClick:o,plugins:l=[],onPluginOpen:c,onPluginClose:d,onPluginUninstall:u,onDevModeToggle:h,devMode:p,isFounder:f=!1}){var Y;const[g,m]=b.useState(!1),[x,y]=b.useState(!1),[S,v]=b.useState(!1),[C,T]=b.useState({x:16,y:null}),[I,E]=b.useState(null),P=b.useRef(null),k=b.useRef({x:0,y:0}),j=b.useRef({x:0,y:0}),D=5;b.useEffect(()=>{const U=localStorage.getItem("panda_dock_position");if(U)try{T(JSON.parse(U))}catch{}},[]),b.useEffect(()=>{C.y!==null&&localStorage.setItem("panda_dock_position",JSON.stringify(C))},[C]),b.useEffect(()=>{if(!I)return;const U=()=>E(null);return window.addEventListener("click",U),()=>window.removeEventListener("click",U)},[I]);const R=b.useCallback(U=>{if(U.target.closest(".pf-dock-item")||U.target.closest("button"))return;U.preventDefault();const J=P.current.getBoundingClientRect();k.current={x:U.clientX-J.left,y:U.clientY-J.top},j.current={x:U.clientX,y:U.clientY},v(!0)},[]),A=b.useCallback(U=>{var ce,he;if(!x&&!S)return;if(!x&&S){const Ee=Math.abs(U.clientX-j.current.x),ke=Math.abs(U.clientY-j.current.y);if(Ee<D&&ke<D)return;y(!0),v(!1)}const J=U.clientX-k.current.x,te=U.clientY-k.current.y,ee=window.innerWidth-(((ce=P.current)==null?void 0:ce.offsetWidth)||70),ae=window.innerHeight-(((he=P.current)==null?void 0:he.offsetHeight)||200);T({x:Math.max(0,Math.min(J,ee)),y:Math.max(0,Math.min(te,ae))})},[x,S]),N=b.useCallback(()=>{y(!1),v(!1)},[]);b.useEffect(()=>{if(x||S)return window.addEventListener("mousemove",A),window.addEventListener("mouseup",N),()=>{window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",N)}},[x,S,A,N]);const B=U=>{c?c(U):console.log(" Plugin opened:",U.id,U.name)},L=(U,J)=>{U.preventDefault(),U.stopPropagation(),E({x:U.clientX,y:U.clientY,plugin:J})},O=()=>{if(!I)return;const{plugin:U}=I;u&&u(U.id),E(null)},F=()=>{if(!I)return;const{plugin:U}=I;d&&d(U.id),E(null)},W=()=>{g||m(!0),h&&h(!0)},$=l.map(U=>({id:U.id,icon:U.icon||"",label:U.name,data:U})),K={position:"fixed",left:`${C.x}px`,top:C.y!==null?`${C.y}px`:"50%",transform:C.y!==null?"none":"translateY(-50%)",cursor:x?"grabbing":"grab"};return a.jsxs(a.Fragment,{children:[a.jsxs("nav",{className:`pf-left-dock ${x?"dragging":""}`,ref:P,style:K,onMouseDown:R,role:"toolbar","aria-label":"Barra de ferramentas principal","aria-orientation":"vertical",children:[a.jsx("div",{className:"pf-dock-handle",title:"ARRASTE PARA MOVER",children:""}),a.jsxs("div",{className:"pf-dock-items",children:[a.jsx("button",{className:"pf-dock-item section-toggle",onClick:e,title:"FERRAMENTAS","aria-label":"Ferramentas de desenho",children:""}),a.jsx("button",{className:"pf-dock-item",onClick:n,title:"MEU CATLOGO","aria-label":"Meu catlogo de apps",children:""}),a.jsx("div",{className:"pf-dock-separator"}),a.jsx("button",{className:"pf-dock-item",onClick:t,title:"PANDA STORE (Ctrl+K)","aria-label":"Abrir Panda Store",children:a.jsx("img",{src:"./panda-logo.png",alt:"Panda Store",style:{width:28,height:28}})}),a.jsx("div",{className:"pf-dock-separator"}),a.jsx("button",{className:"pf-dock-item",onClick:i,title:"FINANCE","aria-label":"Open finance panel",children:""}),a.jsx("button",{className:"pf-dock-item",onClick:r,title:"GASOMETER","aria-label":"Open gasometer panel",children:""}),a.jsx("button",{className:"pf-dock-item",onClick:o,title:"PAT COUNCIL","aria-label":"Open PAT Council",children:""}),a.jsx("div",{className:"pf-dock-separator"}),a.jsx("button",{className:"pf-dock-item",onClick:s,title:"CONFIGURAES (Ctrl+,)","aria-label":"Configuraes",children:""}),a.jsx("button",{className:`pf-dock-item dev-toggle ${g?"active":""}`,onClick:W,title:"DEV MODE (Ctrl+D)","aria-label":g?"Fechar Dev Mode":"Abrir Dev Mode","aria-expanded":g,"aria-pressed":g,children:g?"":""}),$.length>0&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"pf-dock-separator"}),a.jsx("div",{className:"pf-dock-dynamic",children:$.map(U=>{var J;return a.jsx("button",{className:"pf-dock-item dynamic",onClick:()=>B(U.data),onContextMenu:te=>L(te,U.data),title:`${(J=U.label)==null?void 0:J.toUpperCase()}
(CLIQUE DIREITO  OPES)`,children:U.icon},U.id)})})]})]})]}),I&&a.jsxs("div",{className:"pf-dock-context-menu",role:"menu","aria-label":`Opes para ${I.plugin.name||"plugin"}`,style:{position:"fixed",left:I.x,top:I.y,zIndex:99999,background:"rgba(15, 15, 30, 0.95)",border:"1px solid rgba(102, 126, 234, 0.3)",borderRadius:8,padding:"4px 0",minWidth:160,boxShadow:"0 8px 24px rgba(0,0,0,0.5)",backdropFilter:"blur(12px)"},onClick:U=>U.stopPropagation(),children:[a.jsxs("div",{style:{padding:"8px 16px",fontSize:12,color:"#8b8bab",borderBottom:"1px solid rgba(102, 126, 234, 0.15)"},children:[I.plugin.icon||""," ",(Y=I.plugin.name)==null?void 0:Y.toUpperCase()]}),a.jsx("button",{style:{display:"block",width:"100%",padding:"8px 16px",background:"none",border:"none",color:"#e0e0ff",cursor:"pointer",textAlign:"left",fontSize:13},onMouseEnter:U=>U.target.style.background="rgba(102, 126, 234, 0.15)",onMouseLeave:U=>U.target.style.background="none",onClick:()=>B(I.plugin),role:"menuitem",children:" ABRIR"}),a.jsx("button",{style:{display:"block",width:"100%",padding:"8px 16px",background:"none",border:"none",color:"#fbbf24",cursor:"pointer",textAlign:"left",fontSize:13},onMouseEnter:U=>U.target.style.background="rgba(251, 191, 36, 0.15)",onMouseLeave:U=>U.target.style.background="none",onClick:F,role:"menuitem",children:" FECHAR"}),a.jsx("button",{style:{display:"block",width:"100%",padding:"8px 16px",background:"none",border:"none",color:"#ef4444",cursor:"pointer",textAlign:"left",fontSize:13},onMouseEnter:U=>U.target.style.background="rgba(239, 68, 68, 0.15)",onMouseLeave:U=>U.target.style.background="none",onClick:O,role:"menuitem",children:" DESINSTALAR"})]})]})}const qy={jam:{endpoint:"/api/health",services:["rust","firebase","gas","gpu","mcp"],pollInterval:5e3},store:{endpoint:"/api/health/store",services:["github","payment","cdn","analytics"],pollInterval:1e4},devtools:{endpoint:"/api/health/dev",services:["vsx","mcp","debugger","terminal"],pollInterval:5e3},admin:{endpoint:"/api/health/admin",services:["firestore","gas","bigquery","users"],pollInterval:15e3}},yye=n=>{const e={rust:{status:"ready",message:"Rust Agent v0.2.0"},firebase:{status:"connected",latency_ms:45},gas:{status:"connected",latency_ms:120},gpu:{status:"unavailable",message:"No NVIDIA GPU"},mcp:{status:"ready",details:{tools:"5"}},github:{status:"connected",message:"API connected"},payment:{status:"ready",message:"PC Gateway active"},cdn:{status:"connected",latency_ms:25},analytics:{status:"connected",message:"Firebase Analytics"},vsx:{status:"ready",message:"VSX Extension loaded"},debugger:{status:"unavailable",message:"Not attached"},terminal:{status:"ready",message:"PowerShell"},firestore:{status:"connected",latency_ms:35},bigquery:{status:"connected",message:"1TB/month"},users:{status:"connected",details:{count:"1,247"}}},t=qy[n]||qy.jam,s={};return t.services.forEach(i=>{s[i]=e[i]||{status:"notinitialized"}}),{version:"0.2.0",uptime_secs:Math.floor((Date.now()-(window._pandaStartTime||Date.now()))/1e3),status:"healthy",context:n,services:s}};function L$(n="jam"){const[e,t]=b.useState(null),[s,i]=b.useState(!0),[r,o]=b.useState(null),l=qy[n]||qy.jam,c=b.useCallback(async()=>{try{const h=yye(n);t(h),o(null)}catch(h){o(h.message),console.error(`Health check failed for ${n}:`,h)}finally{i(!1)}},[n,l.endpoint]);b.useEffect(()=>{window._pandaStartTime=window._pandaStartTime||Date.now(),c();const h=setInterval(c,l.pollInterval);return()=>clearInterval(h)},[c,l.pollInterval]);const d=(e==null?void 0:e.status)==="healthy",u=e!=null&&e.services?Object.entries(e.services).map(([h,p])=>({name:h,...p,isHealthy:["ready","connected","available"].includes(p.status)})):[];return{health:e,isLoading:s,error:r,isConnected:d,services:u,refresh:c}}const vye={tagline:"A 4 Camada Digital  Empacote, Venda, Escale",description:"Existem 3 camadas digitais: infraestrutura, plataformas e ferramentas. Nenhuma ajuda voc a COMPOR as trs num produto empacotado. Panda Factory  essa camada  um SDK de orquestrao com marketplace prprio e economia de co-produo. Zero custo fixo. Ganhamos s quando voc ganha.",welcomeBack:"Bem-vindo de volta",signInSubtitle:"Faa login para acessar seu workspace",signInGoogle:"Entrar com Google",soon:"Em breve",or:"ou",email:"Email",password:"Senha",signInEmail:"Entrar com Email",signingIn:"Entrando...",freeHint:" Acesso gratuito  explore sem carto de crdito",forgotPassword:"Esqueceu a senha?",demoLabel:"Credenciais de demonstrao MVP",invalidCredentials:"Email ou senha invlidos",loading:"Carregando...",features:[{icon:"",title:"4 Camada Digital",desc:"Orquestre Infra + Plataformas + IA em um nico SDK"},{icon:"",title:"17 Namespaces",desc:"Auth, Brain, Store, Wallet  tudo com um import"},{icon:"",title:"Revenue Share para Devs",desc:"70% Store  40% Usage  85% Hook Prprio  o split mais justo do mercado"},{icon:"",title:"IA Nativa em Tudo",desc:"Gemini Pro, Flash, Think  j integrado por padro"},{icon:"",title:"Medusa + Hotmart",desc:"Publique com um comando, distribua para 34M+ compradores"},{icon:"",title:"Panda Defend",desc:"A 4 camada se auto-governa  14 regras, kill switch"}],stats:[{value:"17",label:"SDK namespaces"},{value:"3",label:"camadas compostas"},{value:"70%",label:"receita do dev"},{value:"0",label:"custo fixo"}]},xye={openStore:"ABRIR LOJA",lightMode:"MODO CLARO",darkMode:"MODO ESCURO",notifications:"NOTIFICAES",mining:"MINERAO",defend:"PANDA DEFEND",founder:"PAINEL FOUNDER",settings:"CONFIGURAES",logout:"SAIR",logoutConfirm:"Sair do Panda Fabrics?",unpinBar:"DESAFIXAR BARRA",pinBar:"FIXAR BARRA",energy:"ENERGIA",treasury:"TESOURO  ABRIR CONSELHO PAT",session:"SESSO"},Sye={step1Title:"Bem-vindo ao Panda Factory",step1Desc:"A 4 Camada Digital  vamos configurar seu workspace.",step2Title:"Escolha Seu Tema",step2Desc:"Escolha o visual que mais combina com voc.",step3Title:"Explore o SDK",step3Desc:"17 namespaces na ponta dos dedos  Auth, Brain, Store, Wallet e mais.",step4Title:"Voc Est Pronto!",step4Desc:"Comece a criar, publicar e ganhar.",next:"Prximo",back:"Voltar",finish:"Concluir",skip:"Pular"},wye={title:"Panda Store",searchPlaceholder:"Buscar mdulos, tentculos, temas...",install:"Instalar",installed:"Instalado",uninstall:"Desinstalar",price:"Preo",free:"Grtis",category:"Categoria",allCategories:"Todas as Categorias",rating:"Avaliao",downloads:"Downloads",publishedBy:"Publicado por",devRevenue:"Dev ganha 70%",usageRevenue:"Dev ganha 40% por uso"},bye={placeholder:"Pergunte qualquer coisa ao Panda Brain...",send:"Enviar",thinking:"Pensando...",errorGeneric:"Algo deu errado. Tente novamente.",clearHistory:"Limpar Histrico",model:"Modelo",tokens:"Tokens usados"},_ye={title:"Configuraes",general:"Geral",appearance:"Aparncia",language:"Idioma",notifications:"Notificaes",account:"Conta",about:"Sobre",version:"Verso",darkMode:"Modo Escuro",lightMode:"Modo Claro",autoSave:"Salvar Automaticamente",resetDefaults:"Restaurar Padres"},Cye={language:"Idioma",close:"Fechar",save:"Salvar",cancel:"Cancelar",confirm:"Confirmar",delete:"Excluir",edit:"Editar",loading:"Carregando...",error:"Erro",success:"Sucesso",retry:"Tentar novamente",back:"Voltar",next:"Prximo",search:"Buscar",noResults:"Nenhum resultado encontrado"},Eye={login:vye,statusBar:xye,wizard:Sye,store:wye,chat:bye,settings:_ye,common:Cye},Tye={tagline:"The 4th Digital Layer  Package, Sell, Scale",description:"There are 3 digital layers today: infrastructure, platforms, and tools. None of them help you COMPOSE all three into a packaged product. Panda Factory IS that layer  an orchestration SDK with its own marketplace and co-production economy. Zero upfront cost. We only earn when you earn.",welcomeBack:"Welcome back",signInSubtitle:"Sign in to access your workspace",signInGoogle:"Sign in with Google",soon:"Soon",or:"or",email:"Email",password:"Password",signInEmail:"Sign in with Email",signingIn:"Signing in...",freeHint:" Free access  explore without a credit card",forgotPassword:"Forgot password?",demoLabel:"MVP Demo Credentials",invalidCredentials:"Invalid email or password",loading:"Loading...",features:[{icon:"",title:"4th Digital Layer",desc:"Orchestrate Infra + Platforms + AI with a single SDK"},{icon:"",title:"17 Namespaces",desc:"Auth, Brain, Store, Wallet  all with one import"},{icon:"",title:"Dev Revenue Share",desc:"70% Store  40% Usage  85% Own Hook  the fairest split in tech"},{icon:"",title:"AI-Native Everything",desc:"Gemini Pro, Flash, Think  built in by default"},{icon:"",title:"Medusa + Hotmart",desc:"Publish with one command, reach 34M+ buyers"},{icon:"",title:"Panda Defend",desc:"The 4th layer governs itself  14 rules, kill switch"}],stats:[{value:"17",label:"SDK namespaces"},{value:"3",label:"layers composed"},{value:"70%",label:"dev revenue"},{value:"0",label:"fixed cost"}]},Iye={openStore:"OPEN STORE",lightMode:"LIGHT MODE",darkMode:"DARK MODE",notifications:"NOTIFICATIONS",mining:"MY MINING",defend:"PANDA DEFEND",founder:"FOUNDER DASHBOARD",settings:"SETTINGS",logout:"LOGOUT",logoutConfirm:"Log out of Panda Fabrics?",unpinBar:"UNPIN BAR",pinBar:"PIN BAR",energy:"ENERGY",treasury:"TREASURY  OPEN PAT COUNCIL",session:"SESSION"},Pye={step1Title:"Welcome to Panda Factory",step1Desc:"The 4th Digital Layer  let's set up your workspace.",step2Title:"Choose Your Theme",step2Desc:"Pick the look that suits you best.",step3Title:"Explore the SDK",step3Desc:"17 namespaces at your fingertips  Auth, Brain, Store, Wallet, and more.",step4Title:"You're Ready!",step4Desc:"Start creating, publishing, and earning.",next:"Next",back:"Back",finish:"Finish",skip:"Skip"},kye={title:"Panda Store",searchPlaceholder:"Search modules, tentacles, themes...",install:"Install",installed:"Installed",uninstall:"Uninstall",price:"Price",free:"Free",category:"Category",allCategories:"All Categories",rating:"Rating",downloads:"Downloads",publishedBy:"Published by",devRevenue:"Dev earns 70%",usageRevenue:"Dev earns 40% from usage"},Aye={placeholder:"Ask Panda Brain anything...",send:"Send",thinking:"Thinking...",errorGeneric:"Something went wrong. Try again.",clearHistory:"Clear History",model:"Model",tokens:"Tokens used"},jye={title:"Settings",general:"General",appearance:"Appearance",language:"Language",notifications:"Notifications",account:"Account",about:"About",version:"Version",darkMode:"Dark Mode",lightMode:"Light Mode",autoSave:"Auto Save",resetDefaults:"Reset to Defaults"},Nye={language:"Language",close:"Close",save:"Save",cancel:"Cancel",confirm:"Confirm",delete:"Delete",edit:"Edit",loading:"Loading...",error:"Error",success:"Success",retry:"Retry",back:"Back",next:"Next",search:"Search",noResults:"No results found"},Rye={login:Tye,statusBar:Iye,wizard:Pye,store:kye,chat:Aye,settings:jye,common:Nye},Mye={tagline:"La 4 Capa Digital  Empaqueta, Vende, Escala",description:"Existen 3 capas digitales hoy: infraestructura, plataformas y herramientas. Ninguna te ayuda a COMPONER las tres en un producto empaquetado. Panda Factory ES esa capa  un SDK de orquestacin con marketplace propio y economa de co-produccin. Cero costo fijo. Solo ganamos cuando t ganas.",welcomeBack:"Bienvenido de nuevo",signInSubtitle:"Inicia sesin para acceder a tu workspace",signInGoogle:"Iniciar sesin con Google",soon:"Pronto",or:"o",email:"Correo electrnico",password:"Contrasea",signInEmail:"Iniciar sesin con Email",signingIn:"Iniciando sesin...",freeHint:" Acceso gratuito  explora sin tarjeta de crdito",forgotPassword:"Olvidaste tu contrasea?",demoLabel:"Credenciales de demostracin MVP",invalidCredentials:"Correo o contrasea invlidos",loading:"Cargando...",features:[{icon:"",title:"4 Capa Digital",desc:"Orquesta Infra + Plataformas + IA con un solo SDK"},{icon:"",title:"17 Namespaces",desc:"Auth, Brain, Store, Wallet  todo con un import"},{icon:"",title:"Revenue Share para Devs",desc:"70% Store  40% Usage  85% Hook Propio  el split ms justo del mercado"},{icon:"",title:"IA Nativa en Todo",desc:"Gemini Pro, Flash, Think  integrado por defecto"},{icon:"",title:"Medusa + Hotmart",desc:"Publica con un comando, llega a 34M+ compradores"},{icon:"",title:"Panda Defend",desc:"La 4 capa se autogobierna  14 reglas, kill switch"}],stats:[{value:"17",label:"SDK namespaces"},{value:"3",label:"capas compuestas"},{value:"70%",label:"ingresos del dev"},{value:"0",label:"costo fijo"}]},Oye={openStore:"ABRIR TIENDA",lightMode:"MODO CLARO",darkMode:"MODO OSCURO",notifications:"NOTIFICACIONES",mining:"MI MINERA",defend:"PANDA DEFEND",founder:"PANEL FUNDADOR",settings:"CONFIGURACIN",logout:"SALIR",logoutConfirm:"Salir de Panda Fabrics?",unpinBar:"DESFIJAR BARRA",pinBar:"FIJAR BARRA",energy:"ENERGA",treasury:"TESORO  ABRIR CONSEJO PAT",session:"SESIN"},Dye={step1Title:"Bienvenido a Panda Factory",step1Desc:"La 4 Capa Digital  configuremos tu workspace.",step2Title:"Elige Tu Tema",step2Desc:"Escoge el estilo que ms te guste.",step3Title:"Explora el SDK",step3Desc:"17 namespaces a tu alcance  Auth, Brain, Store, Wallet y ms.",step4Title:"Ests Listo!",step4Desc:"Comienza a crear, publicar y ganar.",next:"Siguiente",back:"Atrs",finish:"Finalizar",skip:"Saltar"},Lye={title:"Panda Store",searchPlaceholder:"Buscar mdulos, tentculos, temas...",install:"Instalar",installed:"Instalado",uninstall:"Desinstalar",price:"Precio",free:"Gratis",category:"Categora",allCategories:"Todas las Categoras",rating:"Calificacin",downloads:"Descargas",publishedBy:"Publicado por",devRevenue:"Dev gana 70%",usageRevenue:"Dev gana 40% por uso"},Fye={placeholder:"Pregntale lo que quieras a Panda Brain...",send:"Enviar",thinking:"Pensando...",errorGeneric:"Algo sali mal. Intntalo de nuevo.",clearHistory:"Limpiar Historial",model:"Modelo",tokens:"Tokens usados"},Bye={title:"Configuracin",general:"General",appearance:"Apariencia",language:"Idioma",notifications:"Notificaciones",account:"Cuenta",about:"Acerca de",version:"Versin",darkMode:"Modo Oscuro",lightMode:"Modo Claro",autoSave:"Guardar Automticamente",resetDefaults:"Restablecer Predeterminados"},Uye={language:"Idioma",close:"Cerrar",save:"Guardar",cancel:"Cancelar",confirm:"Confirmar",delete:"Eliminar",edit:"Editar",loading:"Cargando...",error:"Error",success:"xito",retry:"Reintentar",back:"Atrs",next:"Siguiente",search:"Buscar",noResults:"No se encontraron resultados"},$ye={login:Mye,statusBar:Oye,wizard:Dye,store:Lye,chat:Fye,settings:Bye,common:Uye},km={"pt-BR":{label:"PT-BR",flag:"",name:"Portugus"},en:{label:"ENG",flag:"",name:"English"},es:{label:"ESP",flag:"",name:"Espaol"}},Am={"pt-BR":Eye,en:Rye,es:$ye},F$="panda_locale";function zye(){const n=localStorage.getItem(F$);if(n&&Am[n])return n;const e=navigator.language||navigator.userLanguage||"pt-BR";return e.startsWith("es")?"es":e.startsWith("en")?"en":"pt-BR"}const B$=b.createContext(null);function Wye({children:n}){const[e,t]=b.useState(zye),s=b.useCallback(r=>{Am[r]&&(t(r),localStorage.setItem(F$,r),window.dispatchEvent(new CustomEvent("panda-locale-change",{detail:r})))},[]),i=b.useCallback((r,o)=>{const l=Am[e]||Am["pt-BR"],c=r.split(".");let d=l;for(const u of c){if(d==null)return o||r;d=d[u]}return d??(o||r)},[e]);return a.jsx(B$.Provider,{value:{locale:e,setLocale:s,t:i},children:n})}function hT(){const n=b.useContext(B$);return n||{locale:"pt-BR",setLocale:()=>{},t:e=>e}}function Hye(){const{locale:n,setLocale:e}=hT(),[t,s]=b.useState(!1),i=b.useRef(null);b.useEffect(()=>{const o=l=>{i.current&&!i.current.contains(l.target)&&s(!1)};return document.addEventListener("mousedown",o),()=>document.removeEventListener("mousedown",o)},[]);const r=km[n]||km["pt-BR"];return a.jsxs("div",{className:"pf-lang-selector",ref:i,children:[a.jsxs("button",{className:"pf-lang-trigger pf-header-btn",onClick:()=>s(!t),title:`Language: ${r.name}`,"aria-label":`Current language: ${r.name}. Click to change.`,"aria-haspopup":"listbox","aria-expanded":t,children:[a.jsx("span",{className:"pf-lang-flag",children:r.flag}),a.jsx("span",{className:"pf-lang-code",children:r.label})]}),t&&a.jsx("div",{className:"pf-lang-dropdown",role:"listbox","aria-label":"Select language",children:Object.entries(km).map(([o,l])=>a.jsxs("button",{className:`pf-lang-option ${o===n?"active":""}`,onClick:()=>{e(o),s(!1)},role:"option","aria-selected":o===n,children:[a.jsx("span",{className:"pf-lang-flag",children:l.flag}),a.jsx("span",{className:"pf-lang-name",children:l.name}),a.jsx("span",{className:"pf-lang-code",children:l.label}),o===n&&a.jsx("span",{className:"pf-lang-check",children:""})]},o))})]})}var Qj={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U$={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oe=function(n,e){if(!n)throw Yd(e)},Yd=function(n){return new Error("Firebase Database ("+U$.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $$=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&s+1<n.length&&(n.charCodeAt(s+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++s)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Gye=function(n){const e=[];let t=0,s=0;for(;t<n.length;){const i=n[t++];if(i<128)e[s++]=String.fromCharCode(i);else if(i>191&&i<224){const r=n[t++];e[s++]=String.fromCharCode((i&31)<<6|r&63)}else if(i>239&&i<365){const r=n[t++],o=n[t++],l=n[t++],c=((i&7)<<18|(r&63)<<12|(o&63)<<6|l&63)-65536;e[s++]=String.fromCharCode(55296+(c>>10)),e[s++]=String.fromCharCode(56320+(c&1023))}else{const r=n[t++],o=n[t++];e[s++]=String.fromCharCode((i&15)<<12|(r&63)<<6|o&63)}}return e.join("")},pT={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let i=0;i<n.length;i+=3){const r=n[i],o=i+1<n.length,l=o?n[i+1]:0,c=i+2<n.length,d=c?n[i+2]:0,u=r>>2,h=(r&3)<<4|l>>4;let p=(l&15)<<2|d>>6,f=d&63;c||(f=64,o||(p=64)),s.push(t[u],t[h],t[p],t[f])}return s.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray($$(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Gye(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let i=0;i<n.length;){const r=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const d=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,r==null||l==null||d==null||h==null)throw new Vye;const p=r<<2|l>>4;if(s.push(p),d!==64){const f=l<<4&240|d>>2;if(s.push(f),h!==64){const g=d<<6&192|h;s.push(g)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Vye extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const z$=function(n){const e=$$(n);return pT.encodeByteArray(e,!0)},Zy=function(n){return z$(n).replace(/\./g,"")},Jy=function(n){try{return pT.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kye(n){return W$(void 0,n)}function W$(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Yye(t)||(n[t]=W$(n[t],e[t]));return n}function Yye(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xye(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qye=()=>Xye().__FIREBASE_DEFAULTS__,Zye=()=>{if(typeof process>"u"||typeof Qj>"u")return;const n=Qj.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Jye=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Jy(n[1]);return e&&JSON.parse(e)},fT=()=>{try{return qye()||Zye()||Jye()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},H$=n=>{var e,t;return(t=(e=fT())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Qye=n=>{const e=H$(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const s=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),s]:[e.substring(0,t),s]},G$=()=>{var n;return(n=fT())===null||n===void 0?void 0:n.config},V$=n=>{var e;return(e=fT())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gT{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eve(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},s=e||"demo-project",i=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${s}`,aud:s,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Zy(JSON.stringify(t)),Zy(JSON.stringify(o)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function as(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function mT(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(as())}function tve(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function nve(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function K$(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function sve(){const n=as();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ive(){return U$.NODE_ADMIN===!0}function rve(){try{return typeof indexedDB=="object"}catch{return!1}}function ove(){return new Promise((n,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(s);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(s),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var r;e(((r=i.error)===null||r===void 0?void 0:r.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ave="FirebaseError";class Ya extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=ave,Object.setPrototypeOf(this,Ya.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,tf.prototype.create)}}class tf{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],o=r?lve(r,s):"Error",l=`${this.serviceName}: ${o} (${i}).`;return new Ya(i,l,s)}}function lve(n,e){return n.replace(cve,(t,s)=>{const i=e[s];return i!=null?String(i):`<${s}?>`})}const cve=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pp(n){return JSON.parse(n)}function Cn(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y$=function(n){let e={},t={},s={},i="";try{const r=n.split(".");e=pp(Jy(r[0])||""),t=pp(Jy(r[1])||""),i=r[2],s=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:s,signature:i}},dve=function(n){const e=Y$(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},uve=function(n){const e=Y$(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lo(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Id(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function M_(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Qy(n,e,t){const s={};for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(s[i]=e.call(t,n[i],i,n));return s}function ev(n,e){if(n===e)return!0;const t=Object.keys(n),s=Object.keys(e);for(const i of t){if(!s.includes(i))return!1;const r=n[i],o=e[i];if(eN(r)&&eN(o)){if(!ev(r,o))return!1}else if(r!==o)return!1}for(const i of s)if(!t.includes(i))return!1;return!0}function eN(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xd(n){const e=[];for(const[t,s]of Object.entries(n))Array.isArray(s)?s.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(s));return e.length?"&"+e.join("&"):""}function ch(n){const e={};return n.replace(/^\?/,"").split("&").forEach(s=>{if(s){const[i,r]=s.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}}),e}function dh(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hve{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const s=this.W_;if(typeof e=="string")for(let h=0;h<16;h++)s[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)s[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const p=s[h-3]^s[h-8]^s[h-14]^s[h-16];s[h]=(p<<1|p>>>31)&4294967295}let i=this.chain_[0],r=this.chain_[1],o=this.chain_[2],l=this.chain_[3],c=this.chain_[4],d,u;for(let h=0;h<80;h++){h<40?h<20?(d=l^r&(o^l),u=1518500249):(d=r^o^l,u=1859775393):h<60?(d=r&o|l&(r|o),u=2400959708):(d=r^o^l,u=3395469782);const p=(i<<5|i>>>27)+d+c+u+s[h]&4294967295;c=l,l=o,o=(r<<30|r>>>2)&4294967295,r=i,i=p}this.chain_[0]=this.chain_[0]+i&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const s=t-this.blockSize;let i=0;const r=this.buf_;let o=this.inbuf_;for(;i<t;){if(o===0)for(;i<=s;)this.compress_(e,i),i+=this.blockSize;if(typeof e=="string"){for(;i<t;)if(r[o]=e.charCodeAt(i),++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}else for(;i<t;)if(r[o]=e[i],++o,++i,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let i=this.blockSize-1;i>=56;i--)this.buf_[i]=t&255,t/=256;this.compress_(this.buf_);let s=0;for(let i=0;i<5;i++)for(let r=24;r>=0;r-=8)e[s]=this.chain_[i]>>r&255,++s;return e}}function pve(n,e){const t=new fve(n,e);return t.subscribe.bind(t)}class fve{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(s=>{this.error(s)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,s){let i;if(e===void 0&&t===void 0&&s===void 0)throw new Error("Missing Observer.");gve(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:s},i.next===void 0&&(i.next=Vw),i.error===void 0&&(i.error=Vw),i.complete===void 0&&(i.complete=Vw);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),r}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(s){typeof console<"u"&&console.error&&console.error(s)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function gve(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Vw(){}function mve(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yve=function(n){const e=[];let t=0;for(let s=0;s<n.length;s++){let i=n.charCodeAt(s);if(i>=55296&&i<=56319){const r=i-55296;s++,oe(s<n.length,"Surrogate pair missing trail surrogate.");const o=n.charCodeAt(s)-56320;i=65536+(r<<10)+o}i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):i<65536?(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Fx=function(n){let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);s<128?e++:s<2048?e+=2:s>=55296&&s<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nr(n){return n&&n._delegate?n._delegate:n}class $l{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ll="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vve{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new gT;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&s.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(r){if(i)return null;throw r}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Sve(e))try{this.getOrInitializeService({instanceIdentifier:ll})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:i});s.resolve(r)}catch{}}}}clearInstance(e=ll){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ll){return this.instances.has(e)}getOptions(e=ll){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[r,o]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(r);s===l&&o.resolve(i)}return i}onInit(e,t){var s;const i=this.normalizeInstanceIdentifier(t),r=(s=this.onInitCallbacks.get(i))!==null&&s!==void 0?s:new Set;r.add(e),this.onInitCallbacks.set(i,r);const o=this.instances.get(i);return o&&e(o,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const i of s)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:xve(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=ll){return this.component?this.component.multipleInstances?e:ll:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function xve(n){return n===ll?void 0:n}function Sve(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wve{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new vve(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var rt;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(rt||(rt={}));const bve={debug:rt.DEBUG,verbose:rt.VERBOSE,info:rt.INFO,warn:rt.WARN,error:rt.ERROR,silent:rt.SILENT},_ve=rt.INFO,Cve={[rt.DEBUG]:"log",[rt.VERBOSE]:"log",[rt.INFO]:"info",[rt.WARN]:"warn",[rt.ERROR]:"error"},Eve=(n,e,...t)=>{if(e<n.logLevel)return;const s=new Date().toISOString(),i=Cve[e];if(i)console[i](`[${s}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class yT{constructor(e){this.name=e,this._logLevel=_ve,this._logHandler=Eve,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in rt))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?bve[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,rt.DEBUG,...e),this._logHandler(this,rt.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,rt.VERBOSE,...e),this._logHandler(this,rt.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,rt.INFO,...e),this._logHandler(this,rt.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,rt.WARN,...e),this._logHandler(this,rt.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,rt.ERROR,...e),this._logHandler(this,rt.ERROR,...e)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tve{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ive(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}}function Ive(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const O_="@firebase/app",tN="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eo=new yT("@firebase/app"),Pve="@firebase/app-compat",kve="@firebase/analytics-compat",Ave="@firebase/analytics",jve="@firebase/app-check-compat",Nve="@firebase/app-check",Rve="@firebase/auth",Mve="@firebase/auth-compat",Ove="@firebase/database",Dve="@firebase/data-connect",Lve="@firebase/database-compat",Fve="@firebase/functions",Bve="@firebase/functions-compat",Uve="@firebase/installations",$ve="@firebase/installations-compat",zve="@firebase/messaging",Wve="@firebase/messaging-compat",Hve="@firebase/performance",Gve="@firebase/performance-compat",Vve="@firebase/remote-config",Kve="@firebase/remote-config-compat",Yve="@firebase/storage",Xve="@firebase/storage-compat",qve="@firebase/firestore",Zve="@firebase/vertexai-preview",Jve="@firebase/firestore-compat",Qve="firebase",exe="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D_="[DEFAULT]",txe={[O_]:"fire-core",[Pve]:"fire-core-compat",[Ave]:"fire-analytics",[kve]:"fire-analytics-compat",[Nve]:"fire-app-check",[jve]:"fire-app-check-compat",[Rve]:"fire-auth",[Mve]:"fire-auth-compat",[Ove]:"fire-rtdb",[Dve]:"fire-data-connect",[Lve]:"fire-rtdb-compat",[Fve]:"fire-fn",[Bve]:"fire-fn-compat",[Uve]:"fire-iid",[$ve]:"fire-iid-compat",[zve]:"fire-fcm",[Wve]:"fire-fcm-compat",[Hve]:"fire-perf",[Gve]:"fire-perf-compat",[Vve]:"fire-rc",[Kve]:"fire-rc-compat",[Yve]:"fire-gcs",[Xve]:"fire-gcs-compat",[qve]:"fire-fst",[Jve]:"fire-fst-compat",[Zve]:"fire-vertex","fire-js":"fire-js",[Qve]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tv=new Map,nxe=new Map,L_=new Map;function nN(n,e){try{n.container.addComponent(e)}catch(t){Eo.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Pd(n){const e=n.name;if(L_.has(e))return Eo.debug(`There were multiple attempts to register component ${e}.`),!1;L_.set(e,n);for(const t of tv.values())nN(t,n);for(const t of nxe.values())nN(t,n);return!0}function vT(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function xr(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sxe={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},_a=new tf("app","Firebase",sxe);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ixe{constructor(e,t,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new $l("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _a.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qd=exe;function X$(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const s=Object.assign({name:D_,automaticDataCollectionEnabled:!1},e),i=s.name;if(typeof i!="string"||!i)throw _a.create("bad-app-name",{appName:String(i)});if(t||(t=G$()),!t)throw _a.create("no-options");const r=tv.get(i);if(r){if(ev(t,r.options)&&ev(s,r.config))return r;throw _a.create("duplicate-app",{appName:i})}const o=new wve(i);for(const c of L_.values())o.addComponent(c);const l=new ixe(t,s,o);return tv.set(i,l),l}function q$(n=D_){const e=tv.get(n);if(!e&&n===D_&&G$())return X$();if(!e)throw _a.create("no-app",{appName:n});return e}function Ca(n,e,t){var s;let i=(s=txe[n])!==null&&s!==void 0?s:n;t&&(i+=`-${t}`);const r=i.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const l=[`Unable to register library "${i}" with version "${e}":`];r&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&o&&l.push("and"),o&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Eo.warn(l.join(" "));return}Pd(new $l(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rxe="firebase-heartbeat-database",oxe=1,fp="firebase-heartbeat-store";let Kw=null;function Z$(){return Kw||(Kw=e1(rxe,oxe,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(fp)}catch(t){console.warn(t)}}}}).catch(n=>{throw _a.create("idb-open",{originalErrorMessage:n.message})})),Kw}async function axe(n){try{const t=(await Z$()).transaction(fp),s=await t.objectStore(fp).get(J$(n));return await t.done,s}catch(e){if(e instanceof Ya)Eo.warn(e.message);else{const t=_a.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Eo.warn(t.message)}}}async function sN(n,e){try{const s=(await Z$()).transaction(fp,"readwrite");await s.objectStore(fp).put(e,J$(n)),await s.done}catch(t){if(t instanceof Ya)Eo.warn(t.message);else{const s=_a.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Eo.warn(s.message)}}}function J$(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lxe=1024,cxe=30*24*60*60*1e3;class dxe{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new hxe(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=iN();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r)?void 0:(this._heartbeatsCache.heartbeats.push({date:r,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const l=new Date(o.date).valueOf();return Date.now()-l<=cxe}),this._storage.overwrite(this._heartbeatsCache))}catch(s){Eo.warn(s)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=iN(),{heartbeatsToSend:s,unsentEntries:i}=uxe(this._heartbeatsCache.heartbeats),r=Zy(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(t){return Eo.warn(t),""}}}function iN(){return new Date().toISOString().substring(0,10)}function uxe(n,e=lxe){const t=[];let s=n.slice();for(const i of n){const r=t.find(o=>o.agent===i.agent);if(r){if(r.dates.push(i.date),rN(t)>e){r.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),rN(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}class hxe{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return rve()?ove().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await axe(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return sN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return sN(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function rN(n){return Zy(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pxe(n){Pd(new $l("platform-logger",e=>new Tve(e),"PRIVATE")),Pd(new $l("heartbeat",e=>new dxe(e),"PRIVATE")),Ca(O_,tN,n),Ca(O_,tN,"esm2017"),Ca("fire-js","")}pxe("");var fxe="firebase",gxe="10.14.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ca(fxe,gxe,"app");function Q$(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const mxe=Q$,e4=new tf("auth","Firebase",Q$());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nv=new yT("@firebase/auth");function yxe(n,...e){nv.logLevel<=rt.WARN&&nv.warn(`Auth (${qd}): ${n}`,...e)}function jm(n,...e){nv.logLevel<=rt.ERROR&&nv.error(`Auth (${qd}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ci(n,...e){throw ST(n,...e)}function Gi(n,...e){return ST(n,...e)}function xT(n,e,t){const s=Object.assign(Object.assign({},mxe()),{[e]:t});return new tf("auth","Firebase",s).create(e,{appName:n.name})}function Ea(n){return xT(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function vxe(n,e,t){const s=t;if(!(e instanceof s))throw s.name!==e.constructor.name&&Ci(n,"argument-error"),xT(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ST(n,...e){if(typeof n!="string"){const t=e[0],s=[...e.slice(1)];return s[0]&&(s[0].appName=n.name),n._errorFactory.create(t,...s)}return e4.create(n,...e)}function Te(n,e,...t){if(!n)throw ST(e,...t)}function io(n){const e="INTERNAL ASSERTION FAILED: "+n;throw jm(e),new Error(e)}function To(n,e){n||io(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F_(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function xxe(){return oN()==="http:"||oN()==="https:"}function oN(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sxe(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(xxe()||nve()||"connection"in navigator)?navigator.onLine:!0}function wxe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nf{constructor(e,t){this.shortDelay=e,this.longDelay=t,To(t>e,"Short delay should be less than long delay!"),this.isMobile=mT()||K$()}get(){return Sxe()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wT(n,e){To(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t4{static initialize(e,t,s){this.fetchImpl=e,t&&(this.headersImpl=t),s&&(this.responseImpl=s)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;io("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;io("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;io("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bxe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _xe=new nf(3e4,6e4);function ec(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Xa(n,e,t,s,i={}){return n4(n,i,async()=>{let r={},o={};s&&(e==="GET"?o=s:r={body:JSON.stringify(s)});const l=Xd(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode);const d=Object.assign({method:e,headers:c},r);return tve()||(d.referrerPolicy="no-referrer"),t4.fetch()(s4(n,n.config.apiHost,t,l),d)})}async function n4(n,e,t){n._canInitEmulator=!1;const s=Object.assign(Object.assign({},bxe),e);try{const i=new Exe(n),r=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw Eg(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const l=r.ok?o.errorMessage:o.error.message,[c,d]=l.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Eg(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Eg(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Eg(n,"user-disabled",o);const u=s[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw xT(n,u,d);Ci(n,u)}}catch(i){if(i instanceof Ya)throw i;Ci(n,"network-request-failed",{message:String(i)})}}async function Bx(n,e,t,s,i={}){const r=await Xa(n,e,t,s,i);return"mfaPendingCredential"in r&&Ci(n,"multi-factor-auth-required",{_serverResponse:r}),r}function s4(n,e,t,s){const i=`${e}${t}?${s}`;return n.config.emulator?wT(n.config,i):`${n.config.apiScheme}://${i}`}function Cxe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Exe{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,s)=>{this.timer=setTimeout(()=>s(Gi(this.auth,"network-request-failed")),_xe.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Eg(n,e,t){const s={appName:n.name};t.email&&(s.email=t.email),t.phoneNumber&&(s.phoneNumber=t.phoneNumber);const i=Gi(n,e,s);return i.customData._tokenResponse=t,i}function aN(n){return n!==void 0&&n.enterprise!==void 0}class Txe{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Cxe(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function Ixe(n,e){return Xa(n,"GET","/v2/recaptchaConfig",ec(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pxe(n,e){return Xa(n,"POST","/v1/accounts:delete",e)}async function i4(n,e){return Xa(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ih(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function kxe(n,e=!1){const t=nr(n),s=await t.getIdToken(e),i=bT(s);Te(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const r=typeof i.firebase=="object"?i.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:i,token:s,authTime:Ih(Yw(i.auth_time)),issuedAtTime:Ih(Yw(i.iat)),expirationTime:Ih(Yw(i.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function Yw(n){return Number(n)*1e3}function bT(n){const[e,t,s]=n.split(".");if(e===void 0||t===void 0||s===void 0)return jm("JWT malformed, contained fewer than 3 sections"),null;try{const i=Jy(t);return i?JSON.parse(i):(jm("Failed to decode base64 JWT payload"),null)}catch(i){return jm("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function lN(n){const e=bT(n);return Te(e,"internal-error"),Te(typeof e.exp<"u","internal-error"),Te(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gp(n,e,t=!1){if(t)return e;try{return await e}catch(s){throw s instanceof Ya&&Axe(s)&&n.auth.currentUser===n&&await n.auth.signOut(),s}}function Axe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jxe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const s=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),s}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B_{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ih(this.lastLoginAt),this.creationTime=Ih(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sv(n){var e;const t=n.auth,s=await n.getIdToken(),i=await gp(n,i4(t,{idToken:s}));Te(i==null?void 0:i.users.length,t,"internal-error");const r=i.users[0];n._notifyReloadListener(r);const o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?r4(r.providerUserInfo):[],l=Rxe(n.providerData,o),c=n.isAnonymous,d=!(n.email&&r.passwordHash)&&!(l!=null&&l.length),u=c?d:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:l,metadata:new B_(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function Nxe(n){const e=nr(n);await sv(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Rxe(n,e){return[...n.filter(s=>!e.some(i=>i.providerId===s.providerId)),...e]}function r4(n){return n.map(e=>{var{providerId:t}=e,s=Vp(e,["providerId"]);return{providerId:t,uid:s.rawId||"",displayName:s.displayName||null,email:s.email||null,phoneNumber:s.phoneNumber||null,photoURL:s.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mxe(n,e){const t=await n4(n,{},async()=>{const s=Xd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=n.config,o=s4(n,i,"/v1/token",`key=${r}`),l=await n._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",t4.fetch()(o,{method:"POST",headers:l,body:s})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Oxe(n,e){return Xa(n,"POST","/v2/accounts:revokeToken",ec(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class id{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Te(e.idToken,"internal-error"),Te(typeof e.idToken<"u","internal-error"),Te(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):lN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Te(e.length!==0,"internal-error");const t=lN(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Te(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:s,refreshToken:i,expiresIn:r}=await Mxe(e,t);this.updateTokensAndExpiration(s,i,Number(r))}updateTokensAndExpiration(e,t,s){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+s*1e3}static fromJSON(e,t){const{refreshToken:s,accessToken:i,expirationTime:r}=t,o=new id;return s&&(Te(typeof s=="string","internal-error",{appName:e}),o.refreshToken=s),i&&(Te(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),r&&(Te(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new id,this.toJSON())}_performRefresh(){return io("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Go(n,e){Te(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ro{constructor(e){var{uid:t,auth:s,stsTokenManager:i}=e,r=Vp(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new jxe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=s,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new B_(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await gp(this,this.stsTokenManager.getToken(this.auth,e));return Te(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return kxe(this,e)}reload(){return Nxe(this)}_assign(e){this!==e&&(Te(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ro(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Te(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let s=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),s=!0),t&&await sv(this),await this.auth._persistUserIfCurrent(this),s&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(xr(this.auth.app))return Promise.reject(Ea(this.auth));const e=await this.getIdToken();return await gp(this,Pxe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var s,i,r,o,l,c,d,u;const h=(s=t.displayName)!==null&&s!==void 0?s:void 0,p=(i=t.email)!==null&&i!==void 0?i:void 0,f=(r=t.phoneNumber)!==null&&r!==void 0?r:void 0,g=(o=t.photoURL)!==null&&o!==void 0?o:void 0,m=(l=t.tenantId)!==null&&l!==void 0?l:void 0,x=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,y=(d=t.createdAt)!==null&&d!==void 0?d:void 0,S=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:v,emailVerified:C,isAnonymous:T,providerData:I,stsTokenManager:E}=t;Te(v&&E,e,"internal-error");const P=id.fromJSON(this.name,E);Te(typeof v=="string",e,"internal-error"),Go(h,e.name),Go(p,e.name),Te(typeof C=="boolean",e,"internal-error"),Te(typeof T=="boolean",e,"internal-error"),Go(f,e.name),Go(g,e.name),Go(m,e.name),Go(x,e.name),Go(y,e.name),Go(S,e.name);const k=new ro({uid:v,auth:e,email:p,emailVerified:C,displayName:h,isAnonymous:T,photoURL:g,phoneNumber:f,tenantId:m,stsTokenManager:P,createdAt:y,lastLoginAt:S});return I&&Array.isArray(I)&&(k.providerData=I.map(j=>Object.assign({},j))),x&&(k._redirectEventId=x),k}static async _fromIdTokenResponse(e,t,s=!1){const i=new id;i.updateFromServerResponse(t);const r=new ro({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:s});return await sv(r),r}static async _fromGetAccountInfoResponse(e,t,s){const i=t.users[0];Te(i.localId!==void 0,"internal-error");const r=i.providerUserInfo!==void 0?r4(i.providerUserInfo):[],o=!(i.email&&i.passwordHash)&&!(r!=null&&r.length),l=new id;l.updateFromIdToken(s);const c=new ro({uid:i.localId,auth:e,stsTokenManager:l,isAnonymous:o}),d={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new B_(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(r!=null&&r.length)};return Object.assign(c,d),c}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cN=new Map;function oo(n){To(n instanceof Function,"Expected a class definition");let e=cN.get(n);return e?(To(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,cN.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o4{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}o4.type="NONE";const dN=o4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nm(n,e,t){return`firebase:${n}:${e}:${t}`}class rd{constructor(e,t,s){this.persistence=e,this.auth=t,this.userKey=s;const{config:i,name:r}=this.auth;this.fullUserKey=Nm(this.userKey,i.apiKey,r),this.fullPersistenceKey=Nm("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ro._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,s="authUser"){if(!t.length)return new rd(oo(dN),e,s);const i=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let r=i[0]||oo(dN);const o=Nm(s,e.config.apiKey,e.name);let l=null;for(const d of t)try{const u=await d._get(o);if(u){const h=ro._fromJSON(e,u);d!==r&&(l=h),r=d;break}}catch{}const c=i.filter(d=>d._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new rd(r,e,s):(r=c[0],l&&await r._set(o,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==r)try{await d._remove(o)}catch{}})),new rd(r,e,s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uN(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(d4(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(a4(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(h4(e))return"Blackberry";if(p4(e))return"Webos";if(l4(e))return"Safari";if((e.includes("chrome/")||c4(e))&&!e.includes("edge/"))return"Chrome";if(u4(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,s=n.match(t);if((s==null?void 0:s.length)===2)return s[1]}return"Other"}function a4(n=as()){return/firefox\//i.test(n)}function l4(n=as()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function c4(n=as()){return/crios\//i.test(n)}function d4(n=as()){return/iemobile/i.test(n)}function u4(n=as()){return/android/i.test(n)}function h4(n=as()){return/blackberry/i.test(n)}function p4(n=as()){return/webos/i.test(n)}function _T(n=as()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Dxe(n=as()){var e;return _T(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function Lxe(){return sve()&&document.documentMode===10}function f4(n=as()){return _T(n)||u4(n)||p4(n)||h4(n)||/windows phone/i.test(n)||d4(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g4(n,e=[]){let t;switch(n){case"Browser":t=uN(as());break;case"Worker":t=`${uN(as())}-${n}`;break;default:t=n}const s=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${qd}/${s}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fxe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const s=r=>new Promise((o,l)=>{try{const c=e(r);o(c)}catch(c){l(c)}});s.onAbort=t,this.queue.push(s);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const s of this.queue)await s(e),s.onAbort&&t.push(s.onAbort)}catch(s){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:s==null?void 0:s.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bxe(n,e={}){return Xa(n,"GET","/v2/passwordPolicy",ec(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uxe=6;class $xe{constructor(e){var t,s,i,r;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:Uxe,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(s=e.allowedNonAlphanumericCharacters)===null||s===void 0?void 0:s.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(r=e.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,s,i,r,o,l;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(s=c.meetsMaxPasswordLength)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(r=c.containsUppercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(l=c.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),c}validatePasswordLengthOptions(e,t){const s=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;s&&(t.meetsMinPasswordLength=e.length>=s),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let s;for(let i=0;i<e.length;i++)s=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,s>="a"&&s<="z",s>="A"&&s<="Z",s>="0"&&s<="9",this.allowedNonAlphanumericCharacters.includes(s))}updatePasswordCharacterOptionsStatuses(e,t,s,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=s)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zxe{constructor(e,t,s,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=s,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new hN(this),this.idTokenSubscription=new hN(this),this.beforeStateQueue=new Fxe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=e4,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=oo(t)),this._initializationPromise=this.queue(async()=>{var s,i;if(!this._deleted&&(this.persistenceManager=await rd.create(this,e),!this._deleted)){if(!((s=this._popupRedirectResolver)===null||s===void 0)&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await i4(this,{idToken:e}),s=await ro._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(s)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(xr(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(l=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(l,l))}):this.directlySetCurrentUser(null)}const s=await this.assertedPersistence.getCurrentUser();let i=s,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===l)&&(c!=null&&c.user)&&(i=c.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=s,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Te(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await sv(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=wxe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(xr(this.app))return Promise.reject(Ea(this));const t=e?nr(e):null;return t&&Te(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Te(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return xr(this.app)?Promise.reject(Ea(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return xr(this.app)?Promise.reject(Ea(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(oo(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await Bxe(this),t=new $xe(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new tf("auth","Firebase",e())}onAuthStateChanged(e,t,s){return this.registerStateListener(this.authStateSubscription,e,t,s)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,s){return this.registerStateListener(this.idTokenSubscription,e,t,s)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const s=this.onAuthStateChanged(()=>{s(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),s={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(s.tenantId=this.tenantId),await Oxe(this,s)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const s=await this.getOrInitRedirectPersistenceManager(t);return e===null?s.removeCurrentUser():s.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&oo(e)||this._popupRedirectResolver;Te(t,this,"argument-error"),this.redirectPersistenceManager=await rd.create(this,[oo(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,s;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((s=this.redirectUser)===null||s===void 0?void 0:s._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const s=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==s&&(this.lastNotifiedUid=s,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,s,i){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t);let o=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(Te(l,this,"internal-error"),l.then(()=>{o||r(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,s,i);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Te(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=g4(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const s=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());s&&(t["X-Firebase-Client"]=s);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&yxe(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function tc(n){return nr(n)}class hN{constructor(e){this.auth=e,this.observer=null,this.addObserver=pve(t=>this.observer=t)}get next(){return Te(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ux={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Wxe(n){Ux=n}function m4(n){return Ux.loadJS(n)}function Hxe(){return Ux.recaptchaEnterpriseScript}function Gxe(){return Ux.gapiScript}function Vxe(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const Kxe="recaptcha-enterprise",Yxe="NO_RECAPTCHA";class Xxe{constructor(e){this.type=Kxe,this.auth=tc(e)}async verify(e="verify",t=!1){async function s(r){if(!t){if(r.tenantId==null&&r._agentRecaptchaConfig!=null)return r._agentRecaptchaConfig.siteKey;if(r.tenantId!=null&&r._tenantRecaptchaConfigs[r.tenantId]!==void 0)return r._tenantRecaptchaConfigs[r.tenantId].siteKey}return new Promise(async(o,l)=>{Ixe(r,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const d=new Txe(c);return r.tenantId==null?r._agentRecaptchaConfig=d:r._tenantRecaptchaConfigs[r.tenantId]=d,o(d.siteKey)}}).catch(c=>{l(c)})})}function i(r,o,l){const c=window.grecaptcha;aN(c)?c.enterprise.ready(()=>{c.enterprise.execute(r,{action:e}).then(d=>{o(d)}).catch(()=>{o(Yxe)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((r,o)=>{s(this.auth).then(l=>{if(!t&&aN(window.grecaptcha))i(l,r,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let c=Hxe();c.length!==0&&(c+=l),m4(c).then(()=>{i(l,r,o)}).catch(d=>{o(d)})}}).catch(l=>{o(l)})})}}async function pN(n,e,t,s=!1){const i=new Xxe(n);let r;try{r=await i.verify(t)}catch{r=await i.verify(t,!0)}const o=Object.assign({},e);return s?Object.assign(o,{captchaResp:r}):Object.assign(o,{captchaResponse:r}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function fN(n,e,t,s){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const r=await pN(n,e,t,t==="getOobCode");return s(n,r)}else return s(n,e).catch(async r=>{if(r.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await pN(n,e,t,t==="getOobCode");return s(n,o)}else return Promise.reject(r)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qxe(n,e){const t=vT(n,"auth");if(t.isInitialized()){const i=t.getImmediate(),r=t.getOptions();if(ev(r,e??{}))return i;Ci(i,"already-initialized")}return t.initialize({options:e})}function Zxe(n,e){const t=(e==null?void 0:e.persistence)||[],s=(Array.isArray(t)?t:[t]).map(oo);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(s,e==null?void 0:e.popupRedirectResolver)}function Jxe(n,e,t){const s=tc(n);Te(s._canInitEmulator,s,"emulator-config-failed"),Te(/^https?:\/\//.test(e),s,"invalid-emulator-scheme");const i=!1,r=y4(e),{host:o,port:l}=Qxe(e),c=l===null?"":`:${l}`;s.config.emulator={url:`${r}//${o}${c}/`},s.settings.appVerificationDisabledForTesting=!0,s.emulatorConfig=Object.freeze({host:o,port:l,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:i})}),eSe()}function y4(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Qxe(n){const e=y4(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const s=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(s);if(i){const r=i[1];return{host:r,port:gN(s.substr(r.length+1))}}else{const[r,o]=s.split(":");return{host:r,port:gN(o)}}}function gN(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function eSe(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CT{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return io("not implemented")}_getIdTokenResponse(e){return io("not implemented")}_linkToIdToken(e,t){return io("not implemented")}_getReauthenticationResolver(e){return io("not implemented")}}async function tSe(n,e){return Xa(n,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nSe(n,e){return Bx(n,"POST","/v1/accounts:signInWithPassword",ec(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sSe(n,e){return Bx(n,"POST","/v1/accounts:signInWithEmailLink",ec(n,e))}async function iSe(n,e){return Bx(n,"POST","/v1/accounts:signInWithEmailLink",ec(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mp extends CT{constructor(e,t,s,i=null){super("password",s),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new mp(e,t,"password")}static _fromEmailAndCode(e,t,s=null){return new mp(e,t,"emailLink",s)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fN(e,t,"signInWithPassword",nSe);case"emailLink":return sSe(e,{email:this._email,oobCode:this._password});default:Ci(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const s={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return fN(e,s,"signUpPassword",tSe);case"emailLink":return iSe(e,{idToken:t,email:this._email,oobCode:this._password});default:Ci(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function od(n,e){return Bx(n,"POST","/v1/accounts:signInWithIdp",ec(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rSe="http://localhost";class zl extends CT{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new zl(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ci("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:s,signInMethod:i}=t,r=Vp(t,["providerId","signInMethod"]);if(!s||!i)return null;const o=new zl(s,i);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return od(e,t)}_linkToIdToken(e,t){const s=this.buildRequest();return s.idToken=t,od(e,s)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,od(e,t)}buildRequest(){const e={requestUri:rSe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Xd(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oSe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function aSe(n){const e=ch(dh(n)).link,t=e?ch(dh(e)).deep_link_id:null,s=ch(dh(n)).deep_link_id;return(s?ch(dh(s)).link:null)||s||t||e||n}class ET{constructor(e){var t,s,i,r,o,l;const c=ch(dh(e)),d=(t=c.apiKey)!==null&&t!==void 0?t:null,u=(s=c.oobCode)!==null&&s!==void 0?s:null,h=oSe((i=c.mode)!==null&&i!==void 0?i:null);Te(d&&u&&h,"argument-error"),this.apiKey=d,this.operation=h,this.code=u,this.continueUrl=(r=c.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(l=c.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const t=aSe(e);try{return new ET(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd{constructor(){this.providerId=Zd.PROVIDER_ID}static credential(e,t){return mp._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const s=ET.parseLink(t);return Te(s,"argument-error"),mp._fromEmailAndCode(e,s.code,s.tenantId)}}Zd.PROVIDER_ID="password";Zd.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Zd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sf extends TT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na extends sf{constructor(){super("facebook.com")}static credential(e){return zl._fromParams({providerId:na.PROVIDER_ID,signInMethod:na.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return na.credentialFromTaggedObject(e)}static credentialFromError(e){return na.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return na.credential(e.oauthAccessToken)}catch{return null}}}na.FACEBOOK_SIGN_IN_METHOD="facebook.com";na.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zr extends sf{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return zl._fromParams({providerId:Zr.PROVIDER_ID,signInMethod:Zr.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Zr.credentialFromTaggedObject(e)}static credentialFromError(e){return Zr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:s}=e;if(!t&&!s)return null;try{return Zr.credential(t,s)}catch{return null}}}Zr.GOOGLE_SIGN_IN_METHOD="google.com";Zr.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sa extends sf{constructor(){super("github.com")}static credential(e){return zl._fromParams({providerId:sa.PROVIDER_ID,signInMethod:sa.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sa.credentialFromTaggedObject(e)}static credentialFromError(e){return sa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return sa.credential(e.oauthAccessToken)}catch{return null}}}sa.GITHUB_SIGN_IN_METHOD="github.com";sa.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia extends sf{constructor(){super("twitter.com")}static credential(e,t){return zl._fromParams({providerId:ia.PROVIDER_ID,signInMethod:ia.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ia.credentialFromTaggedObject(e)}static credentialFromError(e){return ia.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:s}=e;if(!t||!s)return null;try{return ia.credential(t,s)}catch{return null}}}ia.TWITTER_SIGN_IN_METHOD="twitter.com";ia.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kd{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,s,i=!1){const r=await ro._fromIdTokenResponse(e,s,i),o=mN(s);return new kd({user:r,providerId:o,_tokenResponse:s,operationType:t})}static async _forOperation(e,t,s){await e._updateTokensIfNecessary(s,!0);const i=mN(s);return new kd({user:e,providerId:i,_tokenResponse:s,operationType:t})}}function mN(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv extends Ya{constructor(e,t,s,i){var r;super(t.code,t.message),this.operationType=s,this.user=i,Object.setPrototypeOf(this,iv.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:t.customData._serverResponse,operationType:s}}static _fromErrorAndOperation(e,t,s,i){return new iv(e,t,s,i)}}function v4(n,e,t,s){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?iv._fromErrorAndOperation(n,r,e,s):r})}async function lSe(n,e,t=!1){const s=await gp(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return kd._forOperation(n,"link",s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cSe(n,e,t=!1){const{auth:s}=n;if(xr(s.app))return Promise.reject(Ea(s));const i="reauthenticate";try{const r=await gp(n,v4(s,i,e,n),t);Te(r.idToken,s,"internal-error");const o=bT(r.idToken);Te(o,s,"internal-error");const{sub:l}=o;return Te(n.uid===l,s,"user-mismatch"),kd._forOperation(n,i,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&Ci(s,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function x4(n,e,t=!1){if(xr(n.app))return Promise.reject(Ea(n));const s="signIn",i=await v4(n,s,e),r=await kd._fromIdTokenResponse(n,s,i);return t||await n._updateCurrentUser(r.user),r}async function dSe(n,e){return x4(tc(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uSe(n){const e=tc(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function hSe(n,e,t){return xr(n.app)?Promise.reject(Ea(n)):dSe(nr(n),Zd.credential(e,t)).catch(async s=>{throw s.code==="auth/password-does-not-meet-requirements"&&uSe(n),s})}function pSe(n,e,t,s){return nr(n).onIdTokenChanged(e,t,s)}function fSe(n,e,t){return nr(n).beforeAuthStateChanged(e,t)}function gSe(n,e,t,s){return nr(n).onAuthStateChanged(e,t,s)}function mSe(n){return nr(n).signOut()}const rv="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S4{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(rv,"1"),this.storage.removeItem(rv),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ySe=1e3,vSe=10;class w4 extends S4{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=f4(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const s=this.storage.getItem(t),i=this.localCache[t];s!==i&&e(t,i,s)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,l,c)=>{this.notifyListeners(o,c)});return}const s=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const o=this.storage.getItem(s);!t&&this.localCache[s]===o||this.notifyListeners(s,o)},r=this.storage.getItem(s);Lxe()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,vSe):i()}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,s)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:s}),!0)})},ySe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}w4.type="LOCAL";const xSe=w4;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b4 extends S4{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}b4.type="SESSION";const _4=b4;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SSe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const s=new $x(e);return this.receivers.push(s),s}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:s,eventType:i,data:r}=t.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:s,eventType:i});const l=Array.from(o).map(async d=>d(t.origin,r)),c=await SSe(l);t.ports[0].postMessage({status:"done",eventId:s,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$x.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IT(n="",e=10){let t="";for(let s=0;s<e;s++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wSe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,s=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,o;return new Promise((l,c)=>{const d=IT("",20);i.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},s);o={messageChannel:i,onMessage(h){const p=h;if(p.data.eventId===d)switch(p.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),l(p.data.response);break;default:clearTimeout(u),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pr(){return window}function bSe(n){Pr().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C4(){return typeof Pr().WorkerGlobalScope<"u"&&typeof Pr().importScripts=="function"}async function _Se(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function CSe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function ESe(){return C4()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E4="firebaseLocalStorageDb",TSe=1,ov="firebaseLocalStorage",T4="fbase_key";class rf{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function zx(n,e){return n.transaction([ov],e?"readwrite":"readonly").objectStore(ov)}function ISe(){const n=indexedDB.deleteDatabase(E4);return new rf(n).toPromise()}function U_(){const n=indexedDB.open(E4,TSe);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const s=n.result;try{s.createObjectStore(ov,{keyPath:T4})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const s=n.result;s.objectStoreNames.contains(ov)?e(s):(s.close(),await ISe(),e(await U_()))})})}async function yN(n,e,t){const s=zx(n,!0).put({[T4]:e,value:t});return new rf(s).toPromise()}async function PSe(n,e){const t=zx(n,!1).get(e),s=await new rf(t).toPromise();return s===void 0?null:s.value}function vN(n,e){const t=zx(n,!0).delete(e);return new rf(t).toPromise()}const kSe=800,ASe=3;class I4{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await U_(),this.db)}async _withRetries(e){let t=0;for(;;)try{const s=await this._openDb();return await e(s)}catch(s){if(t++>ASe)throw s;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return C4()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$x._getInstance(ESe()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await _Se(),!this.activeServiceWorker)return;this.sender=new wSe(this.activeServiceWorker);const s=await this.sender._send("ping",{},800);s&&!((e=s[0])===null||e===void 0)&&e.fulfilled&&!((t=s[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||CSe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await U_();return await yN(e,rv,"1"),await vN(e,rv),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(s=>yN(s,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(s=>PSe(s,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>vN(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const r=zx(i,!1).getAll();return new rf(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],s=new Set;if(e.length!==0)for(const{fbase_key:i,value:r}of e)s.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!s.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const s=this.listeners[e];if(s)for(const i of Array.from(s))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),kSe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}I4.type="LOCAL";const jSe=I4;new nf(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P4(n,e){return e?oo(e):(Te(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PT extends CT{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return od(e,this._buildIdpRequest())}_linkToIdToken(e,t){return od(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return od(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function NSe(n){return x4(n.auth,new PT(n),n.bypassAuthState)}function RSe(n){const{auth:e,user:t}=n;return Te(t,e,"internal-error"),cSe(t,new PT(n),n.bypassAuthState)}async function MSe(n){const{auth:e,user:t}=n;return Te(t,e,"internal-error"),lSe(t,new PT(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class k4{constructor(e,t,s,i,r=!1){this.auth=e,this.resolver=s,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(s){this.reject(s)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:s,postBody:i,tenantId:r,error:o,type:l}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:s,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(c))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return NSe;case"linkViaPopup":case"linkViaRedirect":return MSe;case"reauthViaPopup":case"reauthViaRedirect":return RSe;default:Ci(this.auth,"internal-error")}}resolve(e){To(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){To(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OSe=new nf(2e3,1e4);async function DSe(n,e,t){if(xr(n.app))return Promise.reject(Gi(n,"operation-not-supported-in-this-environment"));const s=tc(n);vxe(n,e,TT);const i=P4(s,t);return new ml(s,"signInViaPopup",e,i).executeNotNull()}class ml extends k4{constructor(e,t,s,i,r){super(e,t,i,r),this.provider=s,this.authWindow=null,this.pollId=null,ml.currentPopupAction&&ml.currentPopupAction.cancel(),ml.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Te(e,this.auth,"internal-error"),e}async onExecution(){To(this.filter.length===1,"Popup operations only handle one event");const e=IT();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Gi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Gi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ml.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,s;if(!((s=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||s===void 0)&&s.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Gi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,OSe.get())};e()}}ml.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LSe="pendingRedirect",Rm=new Map;class FSe extends k4{constructor(e,t,s=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,s),this.eventId=null}async execute(){let e=Rm.get(this.auth._key());if(!e){try{const s=await BSe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(s)}catch(t){e=()=>Promise.reject(t)}Rm.set(this.auth._key(),e)}return this.bypassAuthState||Rm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function BSe(n,e){const t=zSe(e),s=$Se(n);if(!await s._isAvailable())return!1;const i=await s._get(t)==="true";return await s._remove(t),i}function USe(n,e){Rm.set(n._key(),e)}function $Se(n){return oo(n._redirectPersistence)}function zSe(n){return Nm(LSe,n.config.apiKey,n.name)}async function WSe(n,e,t=!1){if(xr(n.app))return Promise.reject(Ea(n));const s=tc(n),i=P4(s,e),o=await new FSe(s,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await s._persistUserIfCurrent(o.user),await s._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HSe=10*60*1e3;class GSe{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(s=>{this.isEventForConsumer(e,s)&&(t=!0,this.sendToConsumer(e,s),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!VSe(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var s;if(e.error&&!A4(e)){const i=((s=e.error.code)===null||s===void 0?void 0:s.split("auth/")[1])||"internal-error";t.onError(Gi(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const s=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&s}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=HSe&&this.cachedEventUids.clear(),this.cachedEventUids.has(xN(e))}saveEventToCache(e){this.cachedEventUids.add(xN(e)),this.lastProcessedEventTime=Date.now()}}function xN(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function A4({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function VSe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return A4(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KSe(n,e={}){return Xa(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YSe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,XSe=/^https?/;async function qSe(n){if(n.config.emulator)return;const{authorizedDomains:e}=await KSe(n);for(const t of e)try{if(ZSe(t))return}catch{}Ci(n,"unauthorized-domain")}function ZSe(n){const e=F_(),{protocol:t,hostname:s}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&s===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===s}if(!XSe.test(t))return!1;if(YSe.test(n))return s===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(s)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JSe=new nf(3e4,6e4);function SN(){const n=Pr().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function QSe(n){return new Promise((e,t)=>{var s,i,r;function o(){SN(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{SN(),t(Gi(n,"network-request-failed"))},timeout:JSe.get()})}if(!((i=(s=Pr().gapi)===null||s===void 0?void 0:s.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((r=Pr().gapi)===null||r===void 0)&&r.load)o();else{const l=Vxe("iframefcb");return Pr()[l]=()=>{gapi.load?o():t(Gi(n,"network-request-failed"))},m4(`${Gxe()}?onload=${l}`).catch(c=>t(c))}}).catch(e=>{throw Mm=null,e})}let Mm=null;function ewe(n){return Mm=Mm||QSe(n),Mm}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const twe=new nf(5e3,15e3),nwe="__/auth/iframe",swe="emulator/auth/iframe",iwe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},rwe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function owe(n){const e=n.config;Te(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?wT(e,swe):`https://${n.config.authDomain}/${nwe}`,s={apiKey:e.apiKey,appName:n.name,v:qd},i=rwe.get(n.config.apiHost);i&&(s.eid=i);const r=n._getFrameworks();return r.length&&(s.fw=r.join(",")),`${t}?${Xd(s).slice(1)}`}async function awe(n){const e=await ewe(n),t=Pr().gapi;return Te(t,n,"internal-error"),e.open({where:document.body,url:owe(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:iwe,dontclear:!0},s=>new Promise(async(i,r)=>{await s.restyle({setHideOnLeave:!1});const o=Gi(n,"network-request-failed"),l=Pr().setTimeout(()=>{r(o)},twe.get());function c(){Pr().clearTimeout(l),i(s)}s.ping(c).then(c,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lwe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},cwe=500,dwe=600,uwe="_blank",hwe="http://localhost";class wN{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function pwe(n,e,t,s=cwe,i=dwe){const r=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-s)/2,0).toString();let l="";const c=Object.assign(Object.assign({},lwe),{width:s.toString(),height:i.toString(),top:r,left:o}),d=as().toLowerCase();t&&(l=c4(d)?uwe:t),a4(d)&&(e=e||hwe,c.scrollbars="yes");const u=Object.entries(c).reduce((p,[f,g])=>`${p}${f}=${g},`,"");if(Dxe(d)&&l!=="_self")return fwe(e||"",l),new wN(null);const h=window.open(e||"",l,u);Te(h,n,"popup-blocked");try{h.focus()}catch{}return new wN(h)}function fwe(n,e){const t=document.createElement("a");t.href=n,t.target=e;const s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(s)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gwe="__/auth/handler",mwe="emulator/auth/handler",ywe=encodeURIComponent("fac");async function bN(n,e,t,s,i,r){Te(n.config.authDomain,n,"auth-domain-config-required"),Te(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:s,v:qd,eventId:i};if(e instanceof TT){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",M_(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof sf){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}n.tenantId&&(o.tid=n.tenantId);const l=o;for(const u of Object.keys(l))l[u]===void 0&&delete l[u];const c=await n._getAppCheckToken(),d=c?`#${ywe}=${encodeURIComponent(c)}`:"";return`${vwe(n)}?${Xd(l).slice(1)}${d}`}function vwe({config:n}){return n.emulator?wT(n,mwe):`https://${n.authDomain}/${gwe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xw="webStorageSupport";class xwe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_4,this._completeRedirectFn=WSe,this._overrideRedirectResult=USe}async _openPopup(e,t,s,i){var r;To((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=await bN(e,t,s,F_(),i);return pwe(e,o,IT())}async _openRedirect(e,t,s,i){await this._originValidation(e);const r=await bN(e,t,s,F_(),i);return bSe(r),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:r}=this.eventManagers[t];return i?Promise.resolve(i):(To(r,"If manager is not set, promise should be"),r)}const s=this.initAndGetManager(e);return this.eventManagers[t]={promise:s},s.catch(()=>{delete this.eventManagers[t]}),s}async initAndGetManager(e){const t=await awe(e),s=new GSe(e);return t.register("authEvent",i=>(Te(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:s.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:s},this.iframes[e._key()]=t,s}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Xw,{type:Xw},i=>{var r;const o=(r=i==null?void 0:i[0])===null||r===void 0?void 0:r[Xw];o!==void 0&&t(!!o),Ci(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=qSe(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return f4()||l4()||_T()}}const Swe=xwe;var _N="@firebase/auth",CN="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wwe{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(s=>{e((s==null?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Te(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bwe(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function _we(n){Pd(new $l("auth",(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),r=e.getProvider("app-check-internal"),{apiKey:o,authDomain:l}=s.options;Te(o&&!o.includes(":"),"invalid-api-key",{appName:s.name});const c={apiKey:o,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:g4(n)},d=new zxe(s,i,r,c);return Zxe(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,s)=>{e.getProvider("auth-internal").initialize()})),Pd(new $l("auth-internal",e=>{const t=tc(e.getProvider("auth").getImmediate());return(s=>new wwe(s))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ca(_N,CN,bwe(n)),Ca(_N,CN,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cwe=5*60,Ewe=V$("authIdTokenMaxAge")||Cwe;let EN=null;const Twe=n=>async e=>{const t=e&&await e.getIdTokenResult(),s=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(s&&s>Ewe)return;const i=t==null?void 0:t.token;EN!==i&&(EN=i,await fetch(n,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))};function Iwe(n=q$()){const e=vT(n,"auth");if(e.isInitialized())return e.getImmediate();const t=qxe(n,{popupRedirectResolver:Swe,persistence:[jSe,xSe,_4]}),s=V$("authTokenSyncURL");if(s&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(s,location.origin);if(location.origin===r.origin){const o=Twe(r.toString());fSe(t,o,()=>o(t.currentUser)),pSe(t,l=>o(l))}}const i=H$("auth");return i&&Jxe(t,`http://${i}`),t}function Pwe(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}Wxe({loadJS(n){return new Promise((e,t)=>{const s=document.createElement("script");s.setAttribute("src",n),s.onload=e,s.onerror=i=>{const r=Gi("internal-error");r.customData=i,t(r)},s.type="text/javascript",s.charset="UTF-8",Pwe().appendChild(s)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});_we("Browser");var TN={};const IN="@firebase/database",PN="1.0.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let j4="";function kwe(n){j4=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Awe{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Cn(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:pp(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jwe{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Lo(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N4=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new Awe(e)}}catch{}return new jwe},yl=N4("localStorage"),Nwe=N4("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ad=new yT("@firebase/database"),Rwe=function(){let n=1;return function(){return n++}}(),R4=function(n){const e=yve(n),t=new hve;t.update(e);const s=t.digest();return pT.encodeByteArray(s)},of=function(...n){let e="";for(let t=0;t<n.length;t++){const s=n[t];Array.isArray(s)||s&&typeof s=="object"&&typeof s.length=="number"?e+=of.apply(null,s):typeof s=="object"?e+=Cn(s):e+=s,e+=" "}return e};let Ph=null,kN=!0;const Mwe=function(n,e){oe(!0,"Can't turn on custom loggers persistently."),ad.logLevel=rt.VERBOSE,Ph=ad.log.bind(ad)},zn=function(...n){if(kN===!0&&(kN=!1,Ph===null&&Nwe.get("logging_enabled")===!0&&Mwe()),Ph){const e=of.apply(null,n);Ph(e)}},af=function(n){return function(...e){zn(n,...e)}},$_=function(...n){const e="FIREBASE INTERNAL ERROR: "+of(...n);ad.error(e)},Io=function(...n){const e=`FIREBASE FATAL ERROR: ${of(...n)}`;throw ad.error(e),new Error(e)},Zs=function(...n){const e="FIREBASE WARNING: "+of(...n);ad.warn(e)},Owe=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&Zs("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},M4=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Dwe=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Ad="[MIN_NAME]",Wl="[MAX_NAME]",Jd=function(n,e){if(n===e)return 0;if(n===Ad||e===Wl)return-1;if(e===Ad||n===Wl)return 1;{const t=AN(n),s=AN(e);return t!==null?s!==null?t-s===0?n.length-e.length:t-s:-1:s!==null?1:n<e?-1:1}},Lwe=function(n,e){return n===e?0:n<e?-1:1},Ru=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Cn(e))},kT=function(n){if(typeof n!="object"||n===null)return Cn(n);const e=[];for(const s in n)e.push(s);e.sort();let t="{";for(let s=0;s<e.length;s++)s!==0&&(t+=","),t+=Cn(e[s]),t+=":",t+=kT(n[e[s]]);return t+="}",t},O4=function(n,e){const t=n.length;if(t<=e)return[n];const s=[];for(let i=0;i<t;i+=e)i+e>t?s.push(n.substring(i,t)):s.push(n.substring(i,i+e));return s};function Ei(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const D4=function(n){oe(!M4(n),"Invalid JSON number");const e=11,t=52,s=(1<<e-1)-1;let i,r,o,l,c;n===0?(r=0,o=0,i=1/n===-1/0?1:0):(i=n<0,n=Math.abs(n),n>=Math.pow(2,1-s)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),s),r=l+s,o=Math.round(n*Math.pow(2,t-l)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-s-t))));const d=[];for(c=t;c;c-=1)d.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)d.push(r%2?1:0),r=Math.floor(r/2);d.push(i?1:0),d.reverse();const u=d.join("");let h="";for(c=0;c<64;c+=8){let p=parseInt(u.substr(c,8),2).toString(16);p.length===1&&(p="0"+p),h=h+p}return h.toLowerCase()},Fwe=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Bwe=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},Uwe=new RegExp("^-?(0*)\\d{1,10}$"),$we=-2147483648,zwe=2147483647,AN=function(n){if(Uwe.test(n)){const e=Number(n);if(e>=$we&&e<=zwe)return e}return null},lf=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw Zs("Exception was thrown by user callback.",t),e},Math.floor(0))}},Wwe=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},kh=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hwe{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(s=>this.appCheck=s)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,s)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(s=>s.addTokenListener(e))}notifyForInvalidToken(){Zs(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gwe{constructor(e,t,s){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=s,this.auth_=null,this.auth_=s.getImmediate({optional:!0}),this.auth_||s.onInit(i=>this.auth_=i)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(zn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,s)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,s):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Zs(e)}}class Om{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Om.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AT="5",L4="v",F4="s",B4="r",U4="f",$4=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,z4="ls",W4="p",z_="ac",H4="websocket",G4="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class V4{constructor(e,t,s,i,r=!1,o="",l=!1,c=!1){this.secure=t,this.namespace=s,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=yl.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&yl.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Vwe(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function K4(n,e,t){oe(typeof e=="string","typeof type must == string"),oe(typeof t=="object","typeof params must == object");let s;if(e===H4)s=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===G4)s=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Vwe(n)&&(t.ns=n.namespace);const i=[];return Ei(t,(r,o)=>{i.push(r+"="+o)}),s+i.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kwe{constructor(){this.counters_={}}incrementCounter(e,t=1){Lo(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Kye(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qw={},Zw={};function jT(n){const e=n.toString();return qw[e]||(qw[e]=new Kwe),qw[e]}function Ywe(n,e){const t=n.toString();return Zw[t]||(Zw[t]=e()),Zw[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xwe{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const s=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let i=0;i<s.length;++i)s[i]&&lf(()=>{this.onMessage_(s[i])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jN="start",qwe="close",Zwe="pLPCommand",Jwe="pRTLPCB",Y4="id",X4="pw",q4="ser",Qwe="cb",ebe="seg",tbe="ts",nbe="d",sbe="dframe",Z4=1870,J4=30,ibe=Z4-J4,rbe=25e3,obe=3e4;class Hc{constructor(e,t,s,i,r,o,l){this.connId=e,this.repoInfo=t,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.transportSessionId=o,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=af(e),this.stats_=jT(t),this.urlFn=c=>(this.appCheckToken&&(c[z_]=this.appCheckToken),K4(t,G4,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Xwe(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(obe)),Dwe(()=>{if(this.isClosed_)return;this.scriptTagHolder=new NT((...r)=>{const[o,l,c,d,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===jN)this.id=l,this.password=c;else if(o===qwe)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,l]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,l)},()=>{this.onClosed_()},this.urlFn);const s={};s[jN]="t",s[q4]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(s[Qwe]=this.scriptTagHolder.uniqueCallbackIdentifier),s[L4]=AT,this.transportSessionId&&(s[F4]=this.transportSessionId),this.lastSessionId&&(s[z4]=this.lastSessionId),this.applicationId&&(s[W4]=this.applicationId),this.appCheckToken&&(s[z_]=this.appCheckToken),typeof location<"u"&&location.hostname&&$4.test(location.hostname)&&(s[B4]=U4);const i=this.urlFn(s);this.log_("Connecting via long-poll to "+i),this.scriptTagHolder.addTag(i,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Hc.forceAllow_=!0}static forceDisallow(){Hc.forceDisallow_=!0}static isAvailable(){return Hc.forceAllow_?!0:!Hc.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!Fwe()&&!Bwe()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Cn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=z$(t),i=O4(s,ibe);for(let r=0;r<i.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const s={};s[sbe]="t",s[Y4]=e,s[X4]=t,this.myDisconnFrame.src=this.urlFn(s),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Cn(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class NT{constructor(e,t,s,i){this.onDisconnect=s,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Rwe(),window[Zwe+this.uniqueCallbackIdentifier]=e,window[Jwe+this.uniqueCallbackIdentifier]=t,this.myIFrame=NT.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(l){zn("frame writing exception"),l.stack&&zn(l.stack),zn(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||zn("No IE domain setting required")}catch{const s=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+s+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Y4]=this.myID,e[X4]=this.myPW,e[q4]=this.currentSerial;let t=this.urlFn(e),s="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+J4+s.length<=Z4;){const o=this.pendingSegs.shift();s=s+"&"+ebe+i+"="+o.seg+"&"+tbe+i+"="+o.ts+"&"+nbe+i+"="+o.d,i++}return t=t+s,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,s){this.pendingSegs.push({seg:e,ts:t,d:s}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const s=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(s,Math.floor(rbe)),r=()=>{clearTimeout(i),s()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const s=this.myIFrame.doc.createElement("script");s.type="text/javascript",s.async=!0,s.src=e,s.onload=s.onreadystatechange=function(){const i=s.readyState;(!i||i==="loaded"||i==="complete")&&(s.onload=s.onreadystatechange=null,s.parentNode&&s.parentNode.removeChild(s),t())},s.onerror=()=>{zn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(s)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const abe=16384,lbe=45e3;let av=null;typeof MozWebSocket<"u"?av=MozWebSocket:typeof WebSocket<"u"&&(av=WebSocket);class Fi{constructor(e,t,s,i,r,o,l){this.connId=e,this.applicationId=s,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=af(this.connId),this.stats_=jT(t),this.connURL=Fi.connectionURL_(t,o,l,i,s),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,s,i,r){const o={};return o[L4]=AT,typeof location<"u"&&location.hostname&&$4.test(location.hostname)&&(o[B4]=U4),t&&(o[F4]=t),s&&(o[z4]=s),i&&(o[z_]=i),r&&(o[W4]=r),K4(e,H4,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,yl.set("previous_websocket_failure",!0);try{let s;ive(),this.mySock=new av(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const i=s.message||s.data;i&&this.log_(i),this.onClosed_()}}start(){}static forceDisallow(){Fi.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(t);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&av!==null&&!Fi.forceDisallow_}static previouslyFailed(){return yl.isInMemoryStorage||yl.get("previous_websocket_failure")===!0}markConnectionHealthy(){yl.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const s=pp(t);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(oe(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const s=this.extractFrameCount_(t);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();const t=Cn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const s=O4(t,abe);s.length>1&&this.sendString_(String(s.length));for(let i=0;i<s.length;i++)this.sendString_(s[i])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(lbe))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Fi.responsesRequiredToBeHealthy=2;Fi.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yp{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Hc,Fi]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Fi&&Fi.isAvailable();let s=t&&!Fi.previouslyFailed();if(e.webSocketOnly&&(t||Zs("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Fi];else{const i=this.transports_=[];for(const r of yp.ALL_TRANSPORTS)r&&r.isAvailable()&&i.push(r);yp.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}yp.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cbe=6e4,dbe=5e3,ube=10*1024,hbe=100*1024,Jw="t",NN="d",pbe="s",RN="r",fbe="e",MN="o",ON="a",DN="n",LN="p",gbe="h";class mbe{constructor(e,t,s,i,r,o,l,c,d,u){this.id=e,this.repoInfo_=t,this.applicationId_=s,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=o,this.onReady_=l,this.onDisconnect_=c,this.onKill_=d,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=af("c:"+this.id+":"),this.transportManager_=new yp(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),s=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,s)},Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=kh(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>hbe?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>ube?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Jw in e){const t=e[Jw];t===ON?this.upgradeIfSecondaryHealthy_():t===RN?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===MN&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Ru("t",e),s=Ru("d",e);if(t==="c")this.onSecondaryControl_(s);else if(t==="d")this.pendingDataMessages.push(s);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:LN,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ON,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:DN,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Ru("t",e),s=Ru("d",e);t==="c"?this.onControl_(s):t==="d"&&this.onDataMessage_(s)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Ru(Jw,e);if(NN in e){const s=e[NN];if(t===gbe){const i=Object.assign({},s);this.repoInfo_.isUsingEmulator&&(i.h=this.repoInfo_.host),this.onHandshake_(i)}else if(t===DN){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let i=0;i<this.pendingDataMessages.length;++i)this.onDataMessage_(this.pendingDataMessages[i]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===pbe?this.onConnectionShutdown_(s):t===RN?this.onReset_(s):t===fbe?$_("Server Error: "+s):t===MN?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):$_("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,s=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),AT!==s&&Zs("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),s=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,s),kh(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(cbe))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):kh(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(dbe))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:LN,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(yl.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q4{put(e,t,s,i){}merge(e,t,s,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,s){}onDisconnectMerge(e,t,s){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ez{constructor(e){this.allowedEvents_=e,this.listeners_={},oe(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const s=[...this.listeners_[e]];for(let i=0;i<s.length;i++)s[i].callback.apply(s[i].context,t)}}on(e,t,s){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:s});const i=this.getInitialEvent(e);i&&t.apply(s,i)}off(e,t,s){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let r=0;r<i.length;r++)if(i[r].callback===t&&(!s||s===i[r].context)){i.splice(r,1);return}}validateEventType_(e){oe(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lv extends ez{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!mT()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new lv}getInitialEvent(e){return oe(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FN=32,BN=768;class Et{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let s=0;for(let i=0;i<this.pieces_.length;i++)this.pieces_[i].length>0&&(this.pieces_[s]=this.pieces_[i],s++);this.pieces_.length=s,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function lt(){return new Et("")}function Ve(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ma(n){return n.pieces_.length-n.pieceNum_}function _t(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new Et(n.pieces_,e)}function tz(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function ybe(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function nz(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function sz(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new Et(e,0)}function on(n,e){const t=[];for(let s=n.pieceNum_;s<n.pieces_.length;s++)t.push(n.pieces_[s]);if(e instanceof Et)for(let s=e.pieceNum_;s<e.pieces_.length;s++)t.push(e.pieces_[s]);else{const s=e.split("/");for(let i=0;i<s.length;i++)s[i].length>0&&t.push(s[i])}return new Et(t,0)}function We(n){return n.pieceNum_>=n.pieces_.length}function vi(n,e){const t=Ve(n),s=Ve(e);if(t===null)return e;if(t===s)return vi(_t(n),_t(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function iz(n,e){if(Ma(n)!==Ma(e))return!1;for(let t=n.pieceNum_,s=e.pieceNum_;t<=n.pieces_.length;t++,s++)if(n.pieces_[t]!==e.pieces_[s])return!1;return!0}function Ui(n,e){let t=n.pieceNum_,s=e.pieceNum_;if(Ma(n)>Ma(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[s])return!1;++t,++s}return!0}class vbe{constructor(e,t){this.errorPrefix_=t,this.parts_=nz(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let s=0;s<this.parts_.length;s++)this.byteLength_+=Fx(this.parts_[s]);rz(this)}}function xbe(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Fx(e),rz(n)}function Sbe(n){const e=n.parts_.pop();n.byteLength_-=Fx(e),n.parts_.length>0&&(n.byteLength_-=1)}function rz(n){if(n.byteLength_>BN)throw new Error(n.errorPrefix_+"has a key path longer than "+BN+" bytes ("+n.byteLength_+").");if(n.parts_.length>FN)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+FN+") or object contains a cycle "+cl(n))}function cl(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RT extends ez{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const s=!document[e];s!==this.visible_&&(this.visible_=s,this.trigger("visible",s))},!1)}static getInstance(){return new RT}getInitialEvent(e){return oe(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mu=1e3,wbe=60*5*1e3,UN=30*1e3,bbe=1.3,_be=3e4,Cbe="server_kill",$N=3;class fo extends Q4{constructor(e,t,s,i,r,o,l,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=s,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=fo.nextPersistentConnectionId_++,this.log_=af("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Mu,this.maxReconnectDelay_=wbe,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");RT.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&lv.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,s){const i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(Cn(r)),oe(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),s&&(this.requestCBHash_[i]=s)}get(e){this.initConnection_();const t=new gT,i={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const l=o.d;o.s==="ok"?t.resolve(l):t.reject(l)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,s,i){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),oe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),oe(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const l={onComplete:i,hashFn:t,query:e,tag:s};this.listens.get(o).set(r,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(s)})}sendListen_(e){const t=e.query,s=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+s+" for "+i);const r={p:s},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,l=>{const c=l.d,d=l.s;fo.warnOnListenWarnings_(c,t),(this.listens.get(s)&&this.listens.get(s).get(i))===e&&(this.log_("listen response",l),d!=="ok"&&this.removeListen_(s,i),e.onComplete&&e.onComplete(d,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Lo(e,"w")){const s=Id(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const i='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();Zs(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${i} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||uve(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=UN)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=dve(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(t,s,i=>{const r=i.s,o=i.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,s=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,s)})}unlisten(e,t){const s=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+i),oe(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,i)&&this.connected_&&this.sendUnlisten_(s,i,e._queryObject,t)}sendUnlisten_(e,t,s,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";i&&(r.q=s,r.t=i),this.sendRequest(o,r)}onDisconnectPut(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:s})}onDisconnectMerge(e,t,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:s})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,s,i){const r={p:t,d:s};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{i&&setTimeout(()=>{i(o.s,o.d)},Math.floor(0))})}put(e,t,s,i){this.putInternal("p",e,t,s,i)}merge(e,t,s,i){this.putInternal("m",e,t,s,i)}putInternal(e,t,s,i,r){this.initConnection_();const o={p:t,d:s};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:i}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,s,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),i&&i(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,s=>{if(s.s!=="ok"){const r=s.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Cn(e));const t=e.r,s=this.requestCBHash_[t];s&&(delete this.requestCBHash_[t],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):$_("Unrecognized action received from server: "+Cn(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){oe(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Mu,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Mu,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>_be&&(this.reconnectDelay_=Mu),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*bbe)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+fo.nextConnectionId_++,r=this.lastSessionId;let o=!1,l=null;const c=function(){l?l.close():(o=!0,s())},d=function(h){oe(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:d};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,p]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?zn("getToken() completed but was canceled"):(zn("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=p&&p.token,l=new mbe(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,s,f=>{Zs(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(Cbe)},r))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&Zs(h),c())}}}interrupt(e){zn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){zn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],M_(this.interruptReasons_)&&(this.reconnectDelay_=Mu,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let s;t?s=t.map(r=>kT(r)).join("$"):s="default";const i=this.removeListen_(e,s);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const s=new Et(e).toString();let i;if(this.listens.has(s)){const r=this.listens.get(s);i=r.get(t),r.delete(t),r.size===0&&this.listens.delete(s)}else i=void 0;return i}onAuthRevoked_(e,t){zn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=$N&&(this.reconnectDelay_=UN,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){zn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=$N&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+j4.replace(/\./g,"-")]=1,mT()?e["framework.cordova"]=1:K$()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=lv.getInstance().currentlyOnline();return M_(this.interruptReasons_)&&e}}fo.nextPersistentConnectionId_=0;fo.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Ke(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const s=new Ke(Ad,e),i=new Ke(Ad,t);return this.compare(s,i)!==0}minPost(){return Ke.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tg;class oz extends Wx{static get __EMPTY_NODE(){return Tg}static set __EMPTY_NODE(e){Tg=e}compare(e,t){return Jd(e.name,t.name)}isDefinedOn(e){throw Yd("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Ke.MIN}maxPost(){return new Ke(Wl,Tg)}makePost(e,t){return oe(typeof e=="string","KeyIndex indexValue must always be a string."),new Ke(e,Tg)}toString(){return".key"}}const ld=new oz;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig{constructor(e,t,s,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?s(e.key,t):1,i&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class rn{constructor(e,t,s,i,r){this.key=e,this.value=t,this.color=s??rn.RED,this.left=i??ks.EMPTY_NODE,this.right=r??ks.EMPTY_NODE}copy(e,t,s,i,r){return new rn(e??this.key,t??this.value,s??this.color,i??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,s){let i=this;const r=s(e,i.key);return r<0?i=i.copy(null,null,null,i.left.insert(e,t,s),null):r===0?i=i.copy(null,t,null,null,null):i=i.copy(null,null,null,null,i.right.insert(e,t,s)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return ks.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let s,i;if(s=this,t(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),t(e,s.key)===0){if(s.right.isEmpty())return ks.EMPTY_NODE;i=s.right.min_(),s=s.copy(i.key,i.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,rn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,rn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}rn.RED=!0;rn.BLACK=!1;class Ebe{copy(e,t,s,i,r){return this}insert(e,t,s){return new rn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ks{constructor(e,t=ks.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new ks(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,rn.BLACK,null,null))}remove(e){return new ks(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,rn.BLACK,null,null))}get(e){let t,s=this.root_;for(;!s.isEmpty();){if(t=this.comparator_(e,s.key),t===0)return s.value;t<0?s=s.left:t>0&&(s=s.right)}return null}getPredecessorKey(e){let t,s=this.root_,i=null;for(;!s.isEmpty();)if(t=this.comparator_(e,s.key),t===0){if(s.left.isEmpty())return i?i.key:null;for(s=s.left;!s.right.isEmpty();)s=s.right;return s.key}else t<0?s=s.left:t>0&&(i=s,s=s.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ig(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ig(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ig(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ig(this.root_,null,this.comparator_,!0,e)}}ks.EMPTY_NODE=new Ebe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tbe(n,e){return Jd(n.name,e.name)}function MT(n,e){return Jd(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let W_;function Ibe(n){W_=n}const az=function(n){return typeof n=="number"?"number:"+D4(n):"string:"+n},lz=function(n){if(n.isLeafNode()){const e=n.val();oe(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Lo(e,".sv"),"Priority must be a string or number.")}else oe(n===W_||n.isEmpty(),"priority of unexpected type.");oe(n===W_||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zN;class nn{constructor(e,t=nn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,oe(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),lz(this.priorityNode_)}static set __childrenNodeConstructor(e){zN=e}static get __childrenNodeConstructor(){return zN}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new nn(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:nn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return We(e)?this:Ve(e)===".priority"?this.priorityNode_:nn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:nn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const s=Ve(e);return s===null?t:t.isEmpty()&&s!==".priority"?this:(oe(s!==".priority"||Ma(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,nn.__childrenNodeConstructor.EMPTY_NODE.updateChild(_t(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+az(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=D4(this.value_):e+=this.value_,this.lazyHash_=R4(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===nn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof nn.__childrenNodeConstructor?-1:(oe(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,s=typeof this.value_,i=nn.VALUE_TYPE_ORDER.indexOf(t),r=nn.VALUE_TYPE_ORDER.indexOf(s);return oe(i>=0,"Unknown leaf type: "+t),oe(r>=0,"Unknown leaf type: "+s),i===r?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}nn.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let cz,dz;function Pbe(n){cz=n}function kbe(n){dz=n}class Abe extends Wx{compare(e,t){const s=e.node.getPriority(),i=t.node.getPriority(),r=s.compareTo(i);return r===0?Jd(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Ke.MIN}maxPost(){return new Ke(Wl,new nn("[PRIORITY-POST]",dz))}makePost(e,t){const s=cz(e);return new Ke(t,new nn("[PRIORITY-POST]",s))}toString(){return".priority"}}const Kn=new Abe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jbe=Math.log(2);class Nbe{constructor(e){const t=r=>parseInt(Math.log(r)/jbe,10),s=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const i=s(this.count);this.bits_=e+1&i}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const cv=function(n,e,t,s){n.sort(e);const i=function(c,d){const u=d-c;let h,p;if(u===0)return null;if(u===1)return h=n[c],p=t?t(h):h,new rn(p,h.node,rn.BLACK,null,null);{const f=parseInt(u/2,10)+c,g=i(c,f),m=i(f+1,d);return h=n[f],p=t?t(h):h,new rn(p,h.node,rn.BLACK,g,m)}},r=function(c){let d=null,u=null,h=n.length;const p=function(g,m){const x=h-g,y=h;h-=g;const S=i(x+1,y),v=n[x],C=t?t(v):v;f(new rn(C,v.node,m,null,S))},f=function(g){d?(d.left=g,d=g):(u=g,d=g)};for(let g=0;g<c.count;++g){const m=c.nextBitIsOne(),x=Math.pow(2,c.count-(g+1));m?p(x,rn.BLACK):(p(x,rn.BLACK),p(x,rn.RED))}return u},o=new Nbe(n.length),l=r(o);return new ks(s||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qw;const mc={};class ao{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return oe(mc&&Kn,"ChildrenNode.ts has not been loaded"),Qw=Qw||new ao({".priority":mc},{".priority":Kn}),Qw}get(e){const t=Id(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof ks?t:null}hasIndex(e){return Lo(this.indexSet_,e.toString())}addIndex(e,t){oe(e!==ld,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const s=[];let i=!1;const r=t.getIterator(Ke.Wrap);let o=r.getNext();for(;o;)i=i||e.isDefinedOn(o.node),s.push(o),o=r.getNext();let l;i?l=cv(s,e.getCompare()):l=mc;const c=e.toString(),d=Object.assign({},this.indexSet_);d[c]=e;const u=Object.assign({},this.indexes_);return u[c]=l,new ao(u,d)}addToIndexes(e,t){const s=Qy(this.indexes_,(i,r)=>{const o=Id(this.indexSet_,r);if(oe(o,"Missing index implementation for "+r),i===mc)if(o.isDefinedOn(e.node)){const l=[],c=t.getIterator(Ke.Wrap);let d=c.getNext();for(;d;)d.name!==e.name&&l.push(d),d=c.getNext();return l.push(e),cv(l,o.getCompare())}else return mc;else{const l=t.get(e.name);let c=i;return l&&(c=c.remove(new Ke(e.name,l))),c.insert(e,e.node)}});return new ao(s,this.indexSet_)}removeFromIndexes(e,t){const s=Qy(this.indexes_,i=>{if(i===mc)return i;{const r=t.get(e.name);return r?i.remove(new Ke(e.name,r)):i}});return new ao(s,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ou;class Qe{constructor(e,t,s){this.children_=e,this.priorityNode_=t,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&lz(this.priorityNode_),this.children_.isEmpty()&&oe(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ou||(Ou=new Qe(new ks(MT),null,ao.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ou}updatePriority(e){return this.children_.isEmpty()?this:new Qe(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Ou:t}}getChild(e){const t=Ve(e);return t===null?this:this.getImmediateChild(t).getChild(_t(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(oe(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const s=new Ke(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(s,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(s,this.children_));const o=i.isEmpty()?Ou:this.priorityNode_;return new Qe(i,o,r)}}updateChild(e,t){const s=Ve(e);if(s===null)return t;{oe(Ve(e)!==".priority"||Ma(e)===1,".priority must be the last token in a path");const i=this.getImmediateChild(s).updateChild(_t(e),t);return this.updateImmediateChild(s,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let s=0,i=0,r=!0;if(this.forEachChild(Kn,(o,l)=>{t[o]=l.val(e),s++,r&&Qe.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):r=!1}),!e&&r&&i<2*s){const o=[];for(const l in t)o[l]=t[l];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+az(this.getPriority().val())+":"),this.forEachChild(Kn,(t,s)=>{const i=s.hash();i!==""&&(e+=":"+t+":"+i)}),this.lazyHash_=e===""?"":R4(e)}return this.lazyHash_}getPredecessorChildName(e,t,s){const i=this.resolveIndex_(s);if(i){const r=i.getPredecessorKey(new Ke(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Ke(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const s=t.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Ke(t,this.children_.get(t)):null}forEachChild(e,t){const s=this.resolveIndex_(e);return s?s.inorderTraversal(i=>t(i.name,i.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getIteratorFrom(e,i=>i);{const i=this.children_.getIteratorFrom(e.name,Ke.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)<0;)i.getNext(),r=i.peek();return i}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const s=this.resolveIndex_(t);if(s)return s.getReverseIteratorFrom(e,i=>i);{const i=this.children_.getReverseIteratorFrom(e.name,Ke.Wrap);let r=i.peek();for(;r!=null&&t.compare(r,e)>0;)i.getNext(),r=i.peek();return i}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===cf?-1:0}withIndex(e){if(e===ld||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Qe(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ld||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const s=this.getIterator(Kn),i=t.getIterator(Kn);let r=s.getNext(),o=i.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=s.getNext(),o=i.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===ld?null:this.indexMap_.get(e.toString())}}Qe.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Rbe extends Qe{constructor(){super(new ks(MT),Qe.EMPTY_NODE,ao.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Qe.EMPTY_NODE}isEmpty(){return!1}}const cf=new Rbe;Object.defineProperties(Ke,{MIN:{value:new Ke(Ad,Qe.EMPTY_NODE)},MAX:{value:new Ke(Wl,cf)}});oz.__EMPTY_NODE=Qe.EMPTY_NODE;nn.__childrenNodeConstructor=Qe;Ibe(cf);kbe(cf);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mbe=!0;function Wn(n,e=null){if(n===null)return Qe.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),oe(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new nn(t,Wn(e))}if(!(n instanceof Array)&&Mbe){const t=[];let s=!1;if(Ei(n,(o,l)=>{if(o.substring(0,1)!=="."){const c=Wn(l);c.isEmpty()||(s=s||!c.getPriority().isEmpty(),t.push(new Ke(o,c)))}}),t.length===0)return Qe.EMPTY_NODE;const r=cv(t,Tbe,o=>o.name,MT);if(s){const o=cv(t,Kn.getCompare());return new Qe(r,Wn(e),new ao({".priority":o},{".priority":Kn}))}else return new Qe(r,Wn(e),ao.Default)}else{let t=Qe.EMPTY_NODE;return Ei(n,(s,i)=>{if(Lo(n,s)&&s.substring(0,1)!=="."){const r=Wn(i);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(s,r))}}),t.updatePriority(Wn(e))}}Pbe(Wn);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Obe extends Wx{constructor(e){super(),this.indexPath_=e,oe(!We(e)&&Ve(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const s=this.extractChild(e.node),i=this.extractChild(t.node),r=s.compareTo(i);return r===0?Jd(e.name,t.name):r}makePost(e,t){const s=Wn(e),i=Qe.EMPTY_NODE.updateChild(this.indexPath_,s);return new Ke(t,i)}maxPost(){const e=Qe.EMPTY_NODE.updateChild(this.indexPath_,cf);return new Ke(Wl,e)}toString(){return nz(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dbe extends Wx{compare(e,t){const s=e.node.compareTo(t.node);return s===0?Jd(e.name,t.name):s}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Ke.MIN}maxPost(){return Ke.MAX}makePost(e,t){const s=Wn(e);return new Ke(t,s)}toString(){return".value"}}const Lbe=new Dbe;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fbe(n){return{type:"value",snapshotNode:n}}function Bbe(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ube(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function WN(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function $be(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OT{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Kn}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return oe(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return oe(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Ad}hasEnd(){return this.endSet_}getIndexEndValue(){return oe(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return oe(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Wl}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return oe(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Kn}copy(){const e=new OT;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function HN(n){const e={};if(n.isDefault())return e;let t;if(n.index_===Kn?t="$priority":n.index_===Lbe?t="$value":n.index_===ld?t="$key":(oe(n.index_ instanceof Obe,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Cn(t),n.startSet_){const s=n.startAfterSet_?"startAfter":"startAt";e[s]=Cn(n.indexStartValue_),n.startNameSet_&&(e[s]+=","+Cn(n.indexStartName_))}if(n.endSet_){const s=n.endBeforeSet_?"endBefore":"endAt";e[s]=Cn(n.indexEndValue_),n.endNameSet_&&(e[s]+=","+Cn(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function GN(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==Kn&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv extends Q4{constructor(e,t,s,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=s,this.appCheckTokenProvider_=i,this.log_=af("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(oe(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,s,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=dv.getListenId_(e,s),l={};this.listens_[o]=l;const c=HN(e._queryParams);this.restRequest_(r+".json",c,(d,u)=>{let h=u;if(d===404&&(h=null,d=null),d===null&&this.onDataUpdate_(r,h,!1,s),Id(this.listens_,o)===l){let p;d?d===401?p="permission_denied":p="rest_error:"+d:p="ok",i(p,null)}})}unlisten(e,t){const s=dv.getListenId_(e,t);delete this.listens_[s]}get(e){const t=HN(e._queryParams),s=e._path.toString(),i=new gT;return this.restRequest_(s+".json",t,(r,o)=>{let l=o;r===404&&(l=null,r=null),r===null?(this.onDataUpdate_(s,l,!1,null),i.resolve(l)):i.reject(new Error(l))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},s){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+Xd(t);this.log_("Sending REST request for "+o);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(s&&l.readyState===4){this.log_("REST Response for "+o+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=pp(l.responseText)}catch{Zs("Failed to parse JSON response for "+o+": "+l.responseText)}s(null,c)}else l.status!==401&&l.status!==404&&Zs("Got unsuccessful REST response for "+o+" Status: "+l.status),s(l.status);s=null}},l.open("GET",o,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zbe{constructor(){this.rootNode_=Qe.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uv(){return{value:null,children:new Map}}function uz(n,e,t){if(We(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const s=Ve(e);n.children.has(s)||n.children.set(s,uv());const i=n.children.get(s);e=_t(e),uz(i,e,t)}}function H_(n,e,t){n.value!==null?t(e,n.value):Wbe(n,(s,i)=>{const r=new Et(e.toString()+"/"+s);H_(i,r,t)})}function Wbe(n,e){n.children.forEach((t,s)=>{e(s,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hbe{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ei(this.last_,(s,i)=>{t[s]=t[s]-i}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VN=10*1e3,Gbe=30*1e3,Vbe=5*60*1e3;class Kbe{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Hbe(e);const s=VN+(Gbe-VN)*Math.random();kh(this.reportStats_.bind(this),Math.floor(s))}reportStats_(){const e=this.statsListener_.get(),t={};let s=!1;Ei(e,(i,r)=>{r>0&&Lo(this.statsToReport_,i)&&(t[i]=r,s=!0)}),s&&this.server_.reportStats(t),kh(this.reportStats_.bind(this),Math.floor(Math.random()*2*Vbe))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Sr;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Sr||(Sr={}));function hz(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function pz(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function fz(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hv{constructor(e,t,s){this.path=e,this.affectedTree=t,this.revert=s,this.type=Sr.ACK_USER_WRITE,this.source=hz()}operationForChild(e){if(We(this.path)){if(this.affectedTree.value!=null)return oe(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Et(e));return new hv(lt(),t,this.revert)}}else return oe(Ve(this.path)===e,"operationForChild called for unrelated child."),new hv(_t(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(e,t,s){this.source=e,this.path=t,this.snap=s,this.type=Sr.OVERWRITE}operationForChild(e){return We(this.path)?new Hl(this.source,lt(),this.snap.getImmediateChild(e)):new Hl(this.source,_t(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vp{constructor(e,t,s){this.source=e,this.path=t,this.children=s,this.type=Sr.MERGE}operationForChild(e){if(We(this.path)){const t=this.children.subtree(new Et(e));return t.isEmpty()?null:t.value?new Hl(this.source,lt(),t.value):new vp(this.source,lt(),t)}else return oe(Ve(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new vp(this.source,_t(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DT{constructor(e,t,s){this.node_=e,this.fullyInitialized_=t,this.filtered_=s}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(We(e))return this.isFullyInitialized()&&!this.filtered_;const t=Ve(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function Ybe(n,e,t,s){const i=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push($be(o.childName,o.snapshotNode))}),Du(n,i,"child_removed",e,s,t),Du(n,i,"child_added",e,s,t),Du(n,i,"child_moved",r,s,t),Du(n,i,"child_changed",e,s,t),Du(n,i,"value",e,s,t),i}function Du(n,e,t,s,i,r){const o=s.filter(l=>l.type===t);o.sort((l,c)=>qbe(n,l,c)),o.forEach(l=>{const c=Xbe(n,l,r);i.forEach(d=>{d.respondsTo(l.type)&&e.push(d.createEvent(c,n.query_))})})}function Xbe(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function qbe(n,e,t){if(e.childName==null||t.childName==null)throw Yd("Should only compare child_ events.");const s=new Ke(e.childName,e.snapshotNode),i=new Ke(t.childName,t.snapshotNode);return n.index_.compare(s,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gz(n,e){return{eventCache:n,serverCache:e}}function Ah(n,e,t,s){return gz(new DT(e,t,s),n.serverCache)}function mz(n,e,t,s){return gz(n.eventCache,new DT(e,t,s))}function G_(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Gl(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eb;const Zbe=()=>(eb||(eb=new ks(Lwe)),eb);class wt{constructor(e,t=Zbe()){this.value=e,this.children=t}static fromObject(e){let t=new wt(null);return Ei(e,(s,i)=>{t=t.set(new Et(s),i)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:lt(),value:this.value};if(We(e))return null;{const s=Ve(e),i=this.children.get(s);if(i!==null){const r=i.findRootMostMatchingPathAndValue(_t(e),t);return r!=null?{path:on(new Et(s),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(We(e))return this;{const t=Ve(e),s=this.children.get(t);return s!==null?s.subtree(_t(e)):new wt(null)}}set(e,t){if(We(e))return new wt(t,this.children);{const s=Ve(e),r=(this.children.get(s)||new wt(null)).set(_t(e),t),o=this.children.insert(s,r);return new wt(this.value,o)}}remove(e){if(We(e))return this.children.isEmpty()?new wt(null):new wt(null,this.children);{const t=Ve(e),s=this.children.get(t);if(s){const i=s.remove(_t(e));let r;return i.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,i),this.value===null&&r.isEmpty()?new wt(null):new wt(this.value,r)}else return this}}get(e){if(We(e))return this.value;{const t=Ve(e),s=this.children.get(t);return s?s.get(_t(e)):null}}setTree(e,t){if(We(e))return t;{const s=Ve(e),r=(this.children.get(s)||new wt(null)).setTree(_t(e),t);let o;return r.isEmpty()?o=this.children.remove(s):o=this.children.insert(s,r),new wt(this.value,o)}}fold(e){return this.fold_(lt(),e)}fold_(e,t){const s={};return this.children.inorderTraversal((i,r)=>{s[i]=r.fold_(on(e,i),t)}),t(e,this.value,s)}findOnPath(e,t){return this.findOnPath_(e,lt(),t)}findOnPath_(e,t,s){const i=this.value?s(t,this.value):!1;if(i)return i;if(We(e))return null;{const r=Ve(e),o=this.children.get(r);return o?o.findOnPath_(_t(e),on(t,r),s):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,lt(),t)}foreachOnPath_(e,t,s){if(We(e))return this;{this.value&&s(t,this.value);const i=Ve(e),r=this.children.get(i);return r?r.foreachOnPath_(_t(e),on(t,i),s):new wt(null)}}foreach(e){this.foreach_(lt(),e)}foreach_(e,t){this.children.inorderTraversal((s,i)=>{i.foreach_(on(e,s),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,s)=>{s.value&&e(t,s.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vi{constructor(e){this.writeTree_=e}static empty(){return new Vi(new wt(null))}}function jh(n,e,t){if(We(e))return new Vi(new wt(t));{const s=n.writeTree_.findRootMostValueAndPath(e);if(s!=null){const i=s.path;let r=s.value;const o=vi(i,e);return r=r.updateChild(o,t),new Vi(n.writeTree_.set(i,r))}else{const i=new wt(t),r=n.writeTree_.setTree(e,i);return new Vi(r)}}}function KN(n,e,t){let s=n;return Ei(t,(i,r)=>{s=jh(s,on(e,i),r)}),s}function YN(n,e){if(We(e))return Vi.empty();{const t=n.writeTree_.setTree(e,new wt(null));return new Vi(t)}}function V_(n,e){return nc(n,e)!=null}function nc(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(vi(t.path,e)):null}function XN(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(Kn,(s,i)=>{e.push(new Ke(s,i))}):n.writeTree_.children.inorderTraversal((s,i)=>{i.value!=null&&e.push(new Ke(s,i.value))}),e}function Ta(n,e){if(We(e))return n;{const t=nc(n,e);return t!=null?new Vi(new wt(t)):new Vi(n.writeTree_.subtree(e))}}function K_(n){return n.writeTree_.isEmpty()}function jd(n,e){return yz(lt(),n.writeTree_,e)}function yz(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let s=null;return e.children.inorderTraversal((i,r)=>{i===".priority"?(oe(r.value!==null,"Priority writes must always be leaf nodes"),s=r.value):t=yz(on(n,i),r,t)}),!t.getChild(n).isEmpty()&&s!==null&&(t=t.updateChild(on(n,".priority"),s)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vz(n,e){return _z(e,n)}function Jbe(n,e,t,s,i){oe(s>n.lastWriteId,"Stacking an older write on top of newer ones"),i===void 0&&(i=!0),n.allWrites.push({path:e,snap:t,writeId:s,visible:i}),i&&(n.visibleWrites=jh(n.visibleWrites,e,t)),n.lastWriteId=s}function Qbe(n,e){for(let t=0;t<n.allWrites.length;t++){const s=n.allWrites[t];if(s.writeId===e)return s}return null}function e0e(n,e){const t=n.allWrites.findIndex(l=>l.writeId===e);oe(t>=0,"removeWrite called with nonexistent writeId.");const s=n.allWrites[t];n.allWrites.splice(t,1);let i=s.visible,r=!1,o=n.allWrites.length-1;for(;i&&o>=0;){const l=n.allWrites[o];l.visible&&(o>=t&&t0e(l,s.path)?i=!1:Ui(s.path,l.path)&&(r=!0)),o--}if(i){if(r)return n0e(n),!0;if(s.snap)n.visibleWrites=YN(n.visibleWrites,s.path);else{const l=s.children;Ei(l,c=>{n.visibleWrites=YN(n.visibleWrites,on(s.path,c))})}return!0}else return!1}function t0e(n,e){if(n.snap)return Ui(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Ui(on(n.path,t),e))return!0;return!1}function n0e(n){n.visibleWrites=xz(n.allWrites,s0e,lt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function s0e(n){return n.visible}function xz(n,e,t){let s=Vi.empty();for(let i=0;i<n.length;++i){const r=n[i];if(e(r)){const o=r.path;let l;if(r.snap)Ui(t,o)?(l=vi(t,o),s=jh(s,l,r.snap)):Ui(o,t)&&(l=vi(o,t),s=jh(s,lt(),r.snap.getChild(l)));else if(r.children){if(Ui(t,o))l=vi(t,o),s=KN(s,l,r.children);else if(Ui(o,t))if(l=vi(o,t),We(l))s=KN(s,lt(),r.children);else{const c=Id(r.children,Ve(l));if(c){const d=c.getChild(_t(l));s=jh(s,lt(),d)}}}else throw Yd("WriteRecord should have .snap or .children")}}return s}function Sz(n,e,t,s,i){if(!s&&!i){const r=nc(n.visibleWrites,e);if(r!=null)return r;{const o=Ta(n.visibleWrites,e);if(K_(o))return t;if(t==null&&!V_(o,lt()))return null;{const l=t||Qe.EMPTY_NODE;return jd(o,l)}}}else{const r=Ta(n.visibleWrites,e);if(!i&&K_(r))return t;if(!i&&t==null&&!V_(r,lt()))return null;{const o=function(d){return(d.visible||i)&&(!s||!~s.indexOf(d.writeId))&&(Ui(d.path,e)||Ui(e,d.path))},l=xz(n.allWrites,o,e),c=t||Qe.EMPTY_NODE;return jd(l,c)}}}function i0e(n,e,t){let s=Qe.EMPTY_NODE;const i=nc(n.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Kn,(r,o)=>{s=s.updateImmediateChild(r,o)}),s;if(t){const r=Ta(n.visibleWrites,e);return t.forEachChild(Kn,(o,l)=>{const c=jd(Ta(r,new Et(o)),l);s=s.updateImmediateChild(o,c)}),XN(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}else{const r=Ta(n.visibleWrites,e);return XN(r).forEach(o=>{s=s.updateImmediateChild(o.name,o.node)}),s}}function r0e(n,e,t,s,i){oe(s||i,"Either existingEventSnap or existingServerSnap must exist");const r=on(e,t);if(V_(n.visibleWrites,r))return null;{const o=Ta(n.visibleWrites,r);return K_(o)?i.getChild(t):jd(o,i.getChild(t))}}function o0e(n,e,t,s){const i=on(e,t),r=nc(n.visibleWrites,i);if(r!=null)return r;if(s.isCompleteForChild(t)){const o=Ta(n.visibleWrites,i);return jd(o,s.getNode().getImmediateChild(t))}else return null}function a0e(n,e){return nc(n.visibleWrites,e)}function l0e(n,e,t,s,i,r,o){let l;const c=Ta(n.visibleWrites,e),d=nc(c,lt());if(d!=null)l=d;else if(t!=null)l=jd(c,t);else return[];if(l=l.withIndex(o),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=o.getCompare(),p=r?l.getReverseIteratorFrom(s,o):l.getIteratorFrom(s,o);let f=p.getNext();for(;f&&u.length<i;)h(f,s)!==0&&u.push(f),f=p.getNext();return u}else return[]}function c0e(){return{visibleWrites:Vi.empty(),allWrites:[],lastWriteId:-1}}function Y_(n,e,t,s){return Sz(n.writeTree,n.treePath,e,t,s)}function wz(n,e){return i0e(n.writeTree,n.treePath,e)}function qN(n,e,t,s){return r0e(n.writeTree,n.treePath,e,t,s)}function pv(n,e){return a0e(n.writeTree,on(n.treePath,e))}function d0e(n,e,t,s,i,r){return l0e(n.writeTree,n.treePath,e,t,s,i,r)}function LT(n,e,t){return o0e(n.writeTree,n.treePath,e,t)}function bz(n,e){return _z(on(n.treePath,e),n.writeTree)}function _z(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u0e{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,s=e.childName;oe(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),oe(s!==".priority","Only non-priority child changes can be tracked.");const i=this.changeMap.get(s);if(i){const r=i.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(s,WN(s,e.snapshotNode,i.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(s);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(s,Ube(s,i.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(s,Bbe(s,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(s,WN(s,e.snapshotNode,i.oldSnap));else throw Yd("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class h0e{getCompleteChild(e){return null}getChildAfterChild(e,t,s){return null}}const Cz=new h0e;class FT{constructor(e,t,s=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=s}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const s=this.optCompleteServerCache_!=null?new DT(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return LT(this.writes_,e,s)}}getChildAfterChild(e,t,s){const i=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Gl(this.viewCache_),r=d0e(this.writes_,i,t,1,s,e);return r.length===0?null:r[0]}}function p0e(n,e){oe(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),oe(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function f0e(n,e,t,s,i){const r=new u0e;let o,l;if(t.type===Sr.OVERWRITE){const d=t;d.source.fromUser?o=X_(n,e,d.path,d.snap,s,i,r):(oe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered()&&!We(d.path),o=fv(n,e,d.path,d.snap,s,i,l,r))}else if(t.type===Sr.MERGE){const d=t;d.source.fromUser?o=m0e(n,e,d.path,d.children,s,i,r):(oe(d.source.fromServer,"Unknown source."),l=d.source.tagged||e.serverCache.isFiltered(),o=q_(n,e,d.path,d.children,s,i,l,r))}else if(t.type===Sr.ACK_USER_WRITE){const d=t;d.revert?o=x0e(n,e,d.path,s,i,r):o=y0e(n,e,d.path,d.affectedTree,s,i,r)}else if(t.type===Sr.LISTEN_COMPLETE)o=v0e(n,e,t.path,s,r);else throw Yd("Unknown operation type: "+t.type);const c=r.getChanges();return g0e(e,o,c),{viewCache:o,changes:c}}function g0e(n,e,t){const s=e.eventCache;if(s.isFullyInitialized()){const i=s.getNode().isLeafNode()||s.getNode().isEmpty(),r=G_(n);(t.length>0||!n.eventCache.isFullyInitialized()||i&&!s.getNode().equals(r)||!s.getNode().getPriority().equals(r.getPriority()))&&t.push(Fbe(G_(e)))}}function Ez(n,e,t,s,i,r){const o=e.eventCache;if(pv(s,t)!=null)return e;{let l,c;if(We(t))if(oe(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const d=Gl(e),u=d instanceof Qe?d:Qe.EMPTY_NODE,h=wz(s,u);l=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const d=Y_(s,Gl(e));l=n.filter.updateFullNode(e.eventCache.getNode(),d,r)}else{const d=Ve(t);if(d===".priority"){oe(Ma(t)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=qN(s,t,u,c);h!=null?l=n.filter.updatePriority(u,h):l=o.getNode()}else{const u=_t(t);let h;if(o.isCompleteForChild(d)){c=e.serverCache.getNode();const p=qN(s,t,o.getNode(),c);p!=null?h=o.getNode().getImmediateChild(d).updateChild(u,p):h=o.getNode().getImmediateChild(d)}else h=LT(s,d,e.serverCache);h!=null?l=n.filter.updateChild(o.getNode(),d,h,u,i,r):l=o.getNode()}}return Ah(e,l,o.isFullyInitialized()||We(t),n.filter.filtersNodes())}}function fv(n,e,t,s,i,r,o,l){const c=e.serverCache;let d;const u=o?n.filter:n.filter.getIndexedFilter();if(We(t))d=u.updateFullNode(c.getNode(),s,null);else if(u.filtersNodes()&&!c.isFiltered()){const f=c.getNode().updateChild(t,s);d=u.updateFullNode(c.getNode(),f,null)}else{const f=Ve(t);if(!c.isCompleteForPath(t)&&Ma(t)>1)return e;const g=_t(t),x=c.getNode().getImmediateChild(f).updateChild(g,s);f===".priority"?d=u.updatePriority(c.getNode(),x):d=u.updateChild(c.getNode(),f,x,g,Cz,null)}const h=mz(e,d,c.isFullyInitialized()||We(t),u.filtersNodes()),p=new FT(i,h,r);return Ez(n,h,t,i,p,l)}function X_(n,e,t,s,i,r,o){const l=e.eventCache;let c,d;const u=new FT(i,e,r);if(We(t))d=n.filter.updateFullNode(e.eventCache.getNode(),s,o),c=Ah(e,d,!0,n.filter.filtersNodes());else{const h=Ve(t);if(h===".priority")d=n.filter.updatePriority(e.eventCache.getNode(),s),c=Ah(e,d,l.isFullyInitialized(),l.isFiltered());else{const p=_t(t),f=l.getNode().getImmediateChild(h);let g;if(We(p))g=s;else{const m=u.getCompleteChild(h);m!=null?tz(p)===".priority"&&m.getChild(sz(p)).isEmpty()?g=m:g=m.updateChild(p,s):g=Qe.EMPTY_NODE}if(f.equals(g))c=e;else{const m=n.filter.updateChild(l.getNode(),h,g,p,u,o);c=Ah(e,m,l.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function ZN(n,e){return n.eventCache.isCompleteForChild(e)}function m0e(n,e,t,s,i,r,o){let l=e;return s.foreach((c,d)=>{const u=on(t,c);ZN(e,Ve(u))&&(l=X_(n,l,u,d,i,r,o))}),s.foreach((c,d)=>{const u=on(t,c);ZN(e,Ve(u))||(l=X_(n,l,u,d,i,r,o))}),l}function JN(n,e,t){return t.foreach((s,i)=>{e=e.updateChild(s,i)}),e}function q_(n,e,t,s,i,r,o,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,d;We(t)?d=s:d=new wt(null).setTree(t,s);const u=e.serverCache.getNode();return d.children.inorderTraversal((h,p)=>{if(u.hasChild(h)){const f=e.serverCache.getNode().getImmediateChild(h),g=JN(n,f,p);c=fv(n,c,new Et(h),g,i,r,o,l)}}),d.children.inorderTraversal((h,p)=>{const f=!e.serverCache.isCompleteForChild(h)&&p.value===null;if(!u.hasChild(h)&&!f){const g=e.serverCache.getNode().getImmediateChild(h),m=JN(n,g,p);c=fv(n,c,new Et(h),m,i,r,o,l)}}),c}function y0e(n,e,t,s,i,r,o){if(pv(i,t)!=null)return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(s.value!=null){if(We(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return fv(n,e,t,c.getNode().getChild(t),i,r,l,o);if(We(t)){let d=new wt(null);return c.getNode().forEachChild(ld,(u,h)=>{d=d.set(new Et(u),h)}),q_(n,e,t,d,i,r,l,o)}else return e}else{let d=new wt(null);return s.foreach((u,h)=>{const p=on(t,u);c.isCompleteForPath(p)&&(d=d.set(u,c.getNode().getChild(p)))}),q_(n,e,t,d,i,r,l,o)}}function v0e(n,e,t,s,i){const r=e.serverCache,o=mz(e,r.getNode(),r.isFullyInitialized()||We(t),r.isFiltered());return Ez(n,o,t,s,Cz,i)}function x0e(n,e,t,s,i,r){let o;if(pv(s,t)!=null)return e;{const l=new FT(s,e,i),c=e.eventCache.getNode();let d;if(We(t)||Ve(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Y_(s,Gl(e));else{const h=e.serverCache.getNode();oe(h instanceof Qe,"serverChildren would be complete if leaf node"),u=wz(s,h)}u=u,d=n.filter.updateFullNode(c,u,r)}else{const u=Ve(t);let h=LT(s,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?d=n.filter.updateChild(c,u,h,_t(t),l,r):e.eventCache.getNode().hasChild(u)?d=n.filter.updateChild(c,u,Qe.EMPTY_NODE,_t(t),l,r):d=c,d.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Y_(s,Gl(e)),o.isLeafNode()&&(d=n.filter.updateFullNode(d,o,r)))}return o=e.serverCache.isFullyInitialized()||pv(s,lt())!=null,Ah(e,d,o,n.filter.filtersNodes())}}function S0e(n,e){const t=Gl(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!We(e)&&!t.getImmediateChild(Ve(e)).isEmpty())?t.getChild(e):null}function QN(n,e,t,s){e.type===Sr.MERGE&&e.source.queryId!==null&&(oe(Gl(n.viewCache_),"We should always have a full cache before handling merges"),oe(G_(n.viewCache_),"Missing event cache, even though we have a server cache"));const i=n.viewCache_,r=f0e(n.processor_,i,e,t,s);return p0e(n.processor_,r.viewCache),oe(r.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,w0e(n,r.changes,r.viewCache.eventCache.getNode())}function w0e(n,e,t,s){const i=n.eventRegistrations_;return Ybe(n.eventGenerator_,e,t,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eR;function b0e(n){oe(!eR,"__referenceConstructor has already been defined"),eR=n}function BT(n,e,t,s){const i=e.source.queryId;if(i!==null){const r=n.views.get(i);return oe(r!=null,"SyncTree gave us an op for an invalid query."),QN(r,e,t,s)}else{let r=[];for(const o of n.views.values())r=r.concat(QN(o,e,t,s));return r}}function UT(n,e){let t=null;for(const s of n.views.values())t=t||S0e(s,e);return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let tR;function _0e(n){oe(!tR,"__referenceConstructor has already been defined"),tR=n}class nR{constructor(e){this.listenProvider_=e,this.syncPointTree_=new wt(null),this.pendingWriteTree_=c0e(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function C0e(n,e,t,s,i){return Jbe(n.pendingWriteTree_,e,t,s,i),i?Gx(n,new Hl(hz(),e,t)):[]}function Gc(n,e,t=!1){const s=Qbe(n.pendingWriteTree_,e);if(e0e(n.pendingWriteTree_,e)){let r=new wt(null);return s.snap!=null?r=r.set(lt(),!0):Ei(s.children,o=>{r=r.set(new Et(o),!0)}),Gx(n,new hv(s.path,r,t))}else return[]}function Hx(n,e,t){return Gx(n,new Hl(pz(),e,t))}function E0e(n,e,t){const s=wt.fromObject(t);return Gx(n,new vp(pz(),e,s))}function T0e(n,e,t,s){const i=kz(n,s);if(i!=null){const r=Az(i),o=r.path,l=r.queryId,c=vi(o,e),d=new Hl(fz(l),c,t);return jz(n,o,d)}else return[]}function I0e(n,e,t,s){const i=kz(n,s);if(i){const r=Az(i),o=r.path,l=r.queryId,c=vi(o,e),d=wt.fromObject(t),u=new vp(fz(l),c,d);return jz(n,o,u)}else return[]}function Tz(n,e,t){const i=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,l)=>{const c=vi(o,e),d=UT(l,c);if(d)return d});return Sz(i,e,r,t,!0)}function Gx(n,e){return Iz(e,n.syncPointTree_,null,vz(n.pendingWriteTree_,lt()))}function Iz(n,e,t,s){if(We(n.path))return Pz(n,e,t,s);{const i=e.get(lt());t==null&&i!=null&&(t=UT(i,lt()));let r=[];const o=Ve(n.path),l=n.operationForChild(o),c=e.children.get(o);if(c&&l){const d=t?t.getImmediateChild(o):null,u=bz(s,o);r=r.concat(Iz(l,c,d,u))}return i&&(r=r.concat(BT(i,n,s,t))),r}}function Pz(n,e,t,s){const i=e.get(lt());t==null&&i!=null&&(t=UT(i,lt()));let r=[];return e.children.inorderTraversal((o,l)=>{const c=t?t.getImmediateChild(o):null,d=bz(s,o),u=n.operationForChild(o);u&&(r=r.concat(Pz(u,l,c,d)))}),i&&(r=r.concat(BT(i,n,s,t))),r}function kz(n,e){return n.tagToQueryMap.get(e)}function Az(n){const e=n.indexOf("$");return oe(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new Et(n.substr(0,e))}}function jz(n,e,t){const s=n.syncPointTree_.get(e);oe(s,"Missing sync point for query tag that we're tracking");const i=vz(n.pendingWriteTree_,e);return BT(s,t,i,null)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $T{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new $T(t)}node(){return this.node_}}class zT{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=on(this.path_,e);return new zT(this.syncTree_,t)}node(){return Tz(this.syncTree_,this.path_)}}const P0e=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},sR=function(n,e,t){if(!n||typeof n!="object")return n;if(oe(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return k0e(n[".sv"],e,t);if(typeof n[".sv"]=="object")return A0e(n[".sv"],e);oe(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},k0e=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:oe(!1,"Unexpected server value: "+n)}},A0e=function(n,e,t){n.hasOwnProperty("increment")||oe(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const s=n.increment;typeof s!="number"&&oe(!1,"Unexpected increment value: "+s);const i=e.node();if(oe(i!==null&&typeof i<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return s;const o=i.getValue();return typeof o!="number"?s:o+s},j0e=function(n,e,t,s){return WT(e,new zT(t,n),s)},N0e=function(n,e,t){return WT(n,new $T(e),t)};function WT(n,e,t){const s=n.getPriority().val(),i=sR(s,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,l=sR(o.getValue(),e,t);return l!==o.getValue()||i!==o.getPriority().val()?new nn(l,Wn(i)):n}else{const o=n;return r=o,i!==o.getPriority().val()&&(r=r.updatePriority(new nn(i))),o.forEachChild(Kn,(l,c)=>{const d=WT(c,e.getImmediateChild(l),t);d!==c&&(r=r.updateImmediateChild(l,d))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HT{constructor(e="",t=null,s={children:{},childCount:0}){this.name=e,this.parent=t,this.node=s}}function GT(n,e){let t=e instanceof Et?e:new Et(e),s=n,i=Ve(t);for(;i!==null;){const r=Id(s.node.children,i)||{children:{},childCount:0};s=new HT(i,s,r),t=_t(t),i=Ve(t)}return s}function Qd(n){return n.node.value}function Nz(n,e){n.node.value=e,Z_(n)}function Rz(n){return n.node.childCount>0}function R0e(n){return Qd(n)===void 0&&!Rz(n)}function Vx(n,e){Ei(n.node.children,(t,s)=>{e(new HT(t,n,s))})}function Mz(n,e,t,s){t&&e(n),Vx(n,i=>{Mz(i,e,!0)})}function M0e(n,e,t){let s=n.parent;for(;s!==null;){if(e(s))return!0;s=s.parent}return!1}function df(n){return new Et(n.parent===null?n.name:df(n.parent)+"/"+n.name)}function Z_(n){n.parent!==null&&O0e(n.parent,n.name,n)}function O0e(n,e,t){const s=R0e(t),i=Lo(n.node.children,e);s&&i?(delete n.node.children[e],n.node.childCount--,Z_(n)):!s&&!i&&(n.node.children[e]=t.node,n.node.childCount++,Z_(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D0e=/[\[\].#$\/\u0000-\u001F\u007F]/,L0e=/[\[\].#$\u0000-\u001F\u007F]/,tb=10*1024*1024,Oz=function(n){return typeof n=="string"&&n.length!==0&&!D0e.test(n)},F0e=function(n){return typeof n=="string"&&n.length!==0&&!L0e.test(n)},B0e=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),F0e(n)},Dz=function(n,e,t){const s=t instanceof Et?new vbe(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+cl(s));if(typeof e=="function")throw new Error(n+"contains a function "+cl(s)+" with contents = "+e.toString());if(M4(e))throw new Error(n+"contains "+e.toString()+" "+cl(s));if(typeof e=="string"&&e.length>tb/3&&Fx(e)>tb)throw new Error(n+"contains a string greater than "+tb+" utf8 bytes "+cl(s)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let i=!1,r=!1;if(Ei(e,(o,l)=>{if(o===".value")i=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Oz(o)))throw new Error(n+" contains an invalid key ("+o+") "+cl(s)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);xbe(s,o),Dz(n,l,s),Sbe(s)}),i&&r)throw new Error(n+' contains ".value" child '+cl(s)+" in addition to actual children.")}},U0e=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Oz(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!B0e(t))throw new Error(mve(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $0e{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function z0e(n,e){let t=null;for(let s=0;s<e.length;s++){const i=e[s],r=i.getPath();t!==null&&!iz(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(i)}t&&n.eventLists_.push(t)}function sc(n,e,t){z0e(n,t),W0e(n,s=>Ui(s,e)||Ui(e,s))}function W0e(n,e){n.recursionDepth_++;let t=!0;for(let s=0;s<n.eventLists_.length;s++){const i=n.eventLists_[s];if(i){const r=i.path;e(r)?(H0e(n.eventLists_[s]),n.eventLists_[s]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function H0e(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const s=t.getEventRunner();Ph&&zn("event: "+t.toString()),lf(s)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G0e="repo_interrupt",V0e=25;class K0e{constructor(e,t,s,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=s,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new $0e,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=uv(),this.transactionQueueTree_=new HT,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Y0e(n,e,t){if(n.stats_=jT(n.repoInfo_),n.forceRestClient_||Wwe())n.server_=new dv(n.repoInfo_,(s,i,r,o)=>{iR(n,s,i,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>rR(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Cn(t)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}n.persistentConnection_=new fo(n.repoInfo_,e,(s,i,r,o)=>{iR(n,s,i,r,o)},s=>{rR(n,s)},s=>{q0e(n,s)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(s=>{n.server_.refreshAuthToken(s)}),n.appCheckProvider_.addTokenChangeListener(s=>{n.server_.refreshAppCheckToken(s.token)}),n.statsReporter_=Ywe(n.repoInfo_,()=>new Kbe(n.stats_,n.server_)),n.infoData_=new zbe,n.infoSyncTree_=new nR({startListening:(s,i,r,o)=>{let l=[];const c=n.infoData_.getNode(s._path);return c.isEmpty()||(l=Hx(n.infoSyncTree_,s._path,c),setTimeout(()=>{o("ok")},0)),l},stopListening:()=>{}}),VT(n,"connected",!1),n.serverSyncTree_=new nR({startListening:(s,i,r,o)=>(n.server_.listen(s,r,i,(l,c)=>{const d=o(l,c);sc(n.eventQueue_,s._path,d)}),[]),stopListening:(s,i)=>{n.server_.unlisten(s,i)}})}function X0e(n){const t=n.infoData_.getNode(new Et(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Lz(n){return P0e({timestamp:X0e(n)})}function iR(n,e,t,s,i){n.dataUpdateCount++;const r=new Et(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(i)if(s){const c=Qy(t,d=>Wn(d));o=I0e(n.serverSyncTree_,r,c,i)}else{const c=Wn(t);o=T0e(n.serverSyncTree_,r,c,i)}else if(s){const c=Qy(t,d=>Wn(d));o=E0e(n.serverSyncTree_,r,c)}else{const c=Wn(t);o=Hx(n.serverSyncTree_,r,c)}let l=r;o.length>0&&(l=YT(n,r)),sc(n.eventQueue_,l,o)}function rR(n,e){VT(n,"connected",e),e===!1&&J0e(n)}function q0e(n,e){Ei(e,(t,s)=>{VT(n,t,s)})}function VT(n,e,t){const s=new Et("/.info/"+e),i=Wn(t);n.infoData_.updateSnapshot(s,i);const r=Hx(n.infoSyncTree_,s,i);sc(n.eventQueue_,s,r)}function Z0e(n){return n.nextWriteId_++}function J0e(n){Fz(n,"onDisconnectEvents");const e=Lz(n),t=uv();H_(n.onDisconnect_,lt(),(i,r)=>{const o=j0e(i,r,n.serverSyncTree_,e);uz(t,i,o)});let s=[];H_(t,lt(),(i,r)=>{s=s.concat(Hx(n.serverSyncTree_,i,r));const o=n_e(n,i);YT(n,o)}),n.onDisconnect_=uv(),sc(n.eventQueue_,lt(),s)}function Q0e(n){n.persistentConnection_&&n.persistentConnection_.interrupt(G0e)}function Fz(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),zn(t,...e)}function Bz(n,e,t){return Tz(n.serverSyncTree_,e,t)||Qe.EMPTY_NODE}function KT(n,e=n.transactionQueueTree_){if(e||Kx(n,e),Qd(e)){const t=$z(n,e);oe(t.length>0,"Sending zero length transaction queue"),t.every(i=>i.status===0)&&e_e(n,df(e),t)}else Rz(e)&&Vx(e,t=>{KT(n,t)})}function e_e(n,e,t){const s=t.map(d=>d.currentWriteId),i=Bz(n,e,s);let r=i;const o=i.hash();for(let d=0;d<t.length;d++){const u=t[d];oe(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=vi(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}const l=r.val(!0),c=e;n.server_.put(c.toString(),l,d=>{Fz(n,"transaction put response",{path:c.toString(),status:d});let u=[];if(d==="ok"){const h=[];for(let p=0;p<t.length;p++)t[p].status=2,u=u.concat(Gc(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&h.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();Kx(n,GT(n.transactionQueueTree_,e)),KT(n,n.transactionQueueTree_),sc(n.eventQueue_,e,u);for(let p=0;p<h.length;p++)lf(h[p])}else{if(d==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{Zs("transaction at "+c.toString()+" failed: "+d);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=d}YT(n,e)}},o)}function YT(n,e){const t=Uz(n,e),s=df(t),i=$z(n,t);return t_e(n,i,s),s}function t_e(n,e,t){if(e.length===0)return;const s=[];let i=[];const o=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],d=vi(t,c.path);let u=!1,h;if(oe(d!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,i=i.concat(Gc(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=V0e)u=!0,h="maxretry",i=i.concat(Gc(n.serverSyncTree_,c.currentWriteId,!0));else{const p=Bz(n,c.path,o);c.currentInputSnapshot=p;const f=e[l].update(p.val());if(f!==void 0){Dz("transaction failed: Data returned ",f,c.path);let g=Wn(f);typeof f=="object"&&f!=null&&Lo(f,".priority")||(g=g.updatePriority(p.getPriority()));const x=c.currentWriteId,y=Lz(n),S=N0e(g,p,y);c.currentOutputSnapshotRaw=g,c.currentOutputSnapshotResolved=S,c.currentWriteId=Z0e(n),o.splice(o.indexOf(x),1),i=i.concat(C0e(n.serverSyncTree_,c.path,S,c.currentWriteId,c.applyLocally)),i=i.concat(Gc(n.serverSyncTree_,x,!0))}else u=!0,h="nodata",i=i.concat(Gc(n.serverSyncTree_,c.currentWriteId,!0))}sc(n.eventQueue_,t,i),i=[],u&&(e[l].status=2,function(p){setTimeout(p,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?s.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):s.push(()=>e[l].onComplete(new Error(h),!1,null))))}Kx(n,n.transactionQueueTree_);for(let l=0;l<s.length;l++)lf(s[l]);KT(n,n.transactionQueueTree_)}function Uz(n,e){let t,s=n.transactionQueueTree_;for(t=Ve(e);t!==null&&Qd(s)===void 0;)s=GT(s,t),e=_t(e),t=Ve(e);return s}function $z(n,e){const t=[];return zz(n,e,t),t.sort((s,i)=>s.order-i.order),t}function zz(n,e,t){const s=Qd(e);if(s)for(let i=0;i<s.length;i++)t.push(s[i]);Vx(e,i=>{zz(n,i,t)})}function Kx(n,e){const t=Qd(e);if(t){let s=0;for(let i=0;i<t.length;i++)t[i].status!==2&&(t[s]=t[i],s++);t.length=s,Nz(e,t.length>0?t:void 0)}Vx(e,s=>{Kx(n,s)})}function n_e(n,e){const t=df(Uz(n,e)),s=GT(n.transactionQueueTree_,e);return M0e(s,i=>{nb(n,i)}),nb(n,s),Mz(s,i=>{nb(n,i)}),t}function nb(n,e){const t=Qd(e);if(t){const s=[];let i=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(oe(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(oe(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),i=i.concat(Gc(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&s.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Nz(e,void 0):t.length=r+1,sc(n.eventQueue_,df(e),i);for(let o=0;o<s.length;o++)lf(s[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s_e(n){let e="";const t=n.split("/");for(let s=0;s<t.length;s++)if(t[s].length>0){let i=t[s];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch{}e+="/"+i}return e}function i_e(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const s=t.split("=");s.length===2?e[decodeURIComponent(s[0])]=decodeURIComponent(s[1]):Zs(`Invalid query segment '${t}' in query '${n}'`)}return e}const oR=function(n,e){const t=r_e(n),s=t.namespace;t.domain==="firebase.com"&&Io(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!s||s==="undefined")&&t.domain!=="localhost"&&Io("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||Owe();const i=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new V4(t.host,t.secure,s,i,e,"",s!==t.subdomain),path:new Et(t.pathString)}},r_e=function(n){let e="",t="",s="",i="",r="",o=!0,l="https",c=443;if(typeof n=="string"){let d=n.indexOf("//");d>=0&&(l=n.substring(0,d-1),n=n.substring(d+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(i=s_e(n.substring(u,h)));const p=i_e(n.substring(Math.min(n.length,h)));d=e.indexOf(":"),d>=0?(o=l==="https"||l==="wss",c=parseInt(e.substring(d+1),10)):d=e.length;const f=e.slice(0,d);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const g=e.indexOf(".");s=e.substring(0,g).toLowerCase(),t=e.substring(g+1),r=s}"ns"in p&&(r=p.ns)}return{host:e,port:c,domain:t,subdomain:s,secure:o,scheme:l,pathString:i,namespace:r}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XT{constructor(e,t,s,i){this._repo=e,this._path=t,this._queryParams=s,this._orderByCalled=i}get key(){return We(this._path)?null:tz(this._path)}get ref(){return new eu(this._repo,this._path)}get _queryIdentifier(){const e=GN(this._queryParams),t=kT(e);return t==="{}"?"default":t}get _queryObject(){return GN(this._queryParams)}isEqual(e){if(e=nr(e),!(e instanceof XT))return!1;const t=this._repo===e._repo,s=iz(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&s&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+ybe(this._path)}}class eu extends XT{constructor(e,t){super(e,t,new OT,!1)}get parent(){const e=sz(this._path);return e===null?null:new eu(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}b0e(eu);_0e(eu);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o_e="FIREBASE_DATABASE_EMULATOR_HOST",J_={};let a_e=!1;function l_e(n,e,t,s){n.repoInfo_=new V4(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),s&&(n.authTokenProvider_=s)}function c_e(n,e,t,s,i){let r=s||n.options.databaseURL;r===void 0&&(n.options.projectId||Io("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),zn("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=oR(r,i),l=o.repoInfo,c;typeof process<"u"&&TN&&(c=TN[o_e]),c?(r=`http://${c}?ns=${l.namespace}`,o=oR(r,i),l=o.repoInfo):o.repoInfo.secure;const d=new Gwe(n.name,n.options,e);U0e("Invalid Firebase Database URL",o),We(o.path)||Io("Database URL must point to the root of a Firebase Database (not including a child path).");const u=u_e(l,n,d,new Hwe(n.name,t));return new h_e(u,n)}function d_e(n,e){const t=J_[e];(!t||t[n.key]!==n)&&Io(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Q0e(n),delete t[n.key]}function u_e(n,e,t,s){let i=J_[e.name];i||(i={},J_[e.name]=i);let r=i[n.toURLString()];return r&&Io("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new K0e(n,a_e,t,s),i[n.toURLString()]=r,r}class h_e{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Y0e(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new eu(this._repo,lt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(d_e(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Io("Cannot call "+e+" on a deleted database.")}}function p_e(n=q$(),e){const t=vT(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const s=Qye("database");s&&f_e(t,...s)}return t}function f_e(n,e,t,s={}){n=nr(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Io("Cannot call useEmulator() after instance has already been initialized.");const i=n._repoInternal;let r;if(i.repoInfo_.nodeAdmin)s.mockUserToken&&Io('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Om(Om.OWNER);else if(s.mockUserToken){const o=typeof s.mockUserToken=="string"?s.mockUserToken:eve(s.mockUserToken,n.app.options.projectId);r=new Om(o)}l_e(i,e,t,r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g_e(n){kwe(qd),Pd(new $l("database",(e,{instanceIdentifier:t})=>{const s=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return c_e(s,i,r,t)},"PUBLIC").setMultipleInstances(!0)),Ca(IN,PN,n),Ca(IN,PN,"esm2017")}fo.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};fo.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};g_e();const m_e={apiKey:"AIzaSyDyWiRgNusHQ38mNbusKgWHmXYYOfa5gjM",authDomain:"panda-factory.firebaseapp.com",databaseURL:"https://panda-factory-default-rtdb.firebaseio.com",projectId:"panda-factory",storageBucket:"panda-factory.firebasestorage.app",messagingSenderId:"980998365446",appId:"1:980998365446:web:90200c58606a6238eebe87"};let sb,li,y_e;try{sb=X$(m_e),li=Iwe(sb),y_e=p_e(sb),console.log(" Firebase initialized")}catch(n){console.warn("Firebase initialization failed, using mock mode:",n.message)}const v_e=new Zr,Pg={async signInWithGoogle(){if(!li)throw new Error("Firebase not initialized");return(await DSe(li,v_e)).user},async signInWithEmail(n,e){if(!li)throw new Error("Firebase not initialized");return(await hSe(li,n,e)).user},async signOut(){if(!li)throw new Error("Firebase not initialized");await mSe(li)},getCurrentUser(){return(li==null?void 0:li.currentUser)||null},onAuthStateChanged(n){return li?gSe(li,n):()=>{}}},xp={FOUNDER:"founder",DEV:"dev",USER:"user"},Nh={GOOGLE:"google",EMAIL:"email",LOGINGATE:"logingate"},x_e=["lucassvalerio@gmail.com"],S_e={"user@panda.com":{uid:"user-demo",email:"user@panda.com",displayName:"Demo User",userType:xp.USER,pcBalance:100}};function w_e(n){var s,i;const e=n.email||"",t=x_e.some(r=>r.toLowerCase()===e.toLowerCase());return{uid:n.uid,email:e,displayName:n.displayName||e.split("@")[0],photoURL:n.photoURL||null,userType:t?xp.FOUNDER:xp.USER,authMethod:((i=(s=n.providerData)==null?void 0:s[0])==null?void 0:i.providerId)==="google.com"?Nh.GOOGLE:Nh.EMAIL,founderPercent:t?5:void 0}}const Wz=b.createContext(null);function b_e({children:n}){const[e,t]=b.useState(null),[s,i]=b.useState(!0),[r,o]=b.useState(null),[l,c]=b.useState(!1);b.useEffect(()=>{let y=null;try{y=Pg.onAuthStateChanged(S=>{if(c(!0),S){const v=w_e(S);t(v),localStorage.setItem("panda_user",JSON.stringify(v))}else{const v=localStorage.getItem("panda_user");if(v)try{const C=JSON.parse(v);C.authMethod===Nh.LOGINGATE?t(C):(t(null),localStorage.removeItem("panda_user"))}catch{localStorage.removeItem("panda_user"),t(null)}else t(null)}i(!1)})}catch(S){console.warn("[useAuth] Firebase not available, using mock mode:",S.message),c(!1);const v=localStorage.getItem("panda_user");if(v)try{t(JSON.parse(v))}catch{localStorage.removeItem("panda_user")}i(!1)}return()=>{y&&y()}},[]);const d=b.useCallback(async()=>{var y;i(!0),o(null);try{const S=await Pg.signInWithGoogle();console.log(" Google login success:",S.email)}catch(S){!l||(y=S.message)!=null&&y.includes("not initialized")?o("Firebase not configured. Use demo credentials below, or add Firebase config to .env"):S.code==="auth/popup-closed-by-user"?o(null):S.code==="auth/unauthorized-domain"?o("This domain is not authorized in Firebase. Add it in Firebase Console > Authentication > Settings."):o(S.message||"Google login failed")}finally{i(!1)}},[l]),u=b.useCallback(async(y,S)=>{i(!0),o(null);try{if(l){const v=await Pg.signInWithEmail(y,S);console.log(" Email login success:",v.email)}else{await new Promise(T=>setTimeout(T,500));const v=S_e[y.toLowerCase()];if(!v)throw new Error("User not found");if(S.length<4)throw new Error("Invalid password");const C={...v,authMethod:Nh.EMAIL};t(C),localStorage.setItem("panda_user",JSON.stringify(C))}}catch(v){const C=v.code==="auth/invalid-credential"?"Invalid email or password":v.code==="auth/user-not-found"?"No account found with this email":v.message||"Login failed";throw o(C),v}finally{i(!1)}},[l]),h=b.useCallback(async y=>{const S={...y,authMethod:Nh.LOGINGATE};t(S),localStorage.setItem("panda_user",JSON.stringify(S))},[]),p=b.useCallback(async()=>{try{try{await Pg.signOut()}catch{}t(null),localStorage.removeItem("panda_user"),sessionStorage.removeItem("panda_auth"),sessionStorage.removeItem("panda_auth_token")}catch(y){o(y.message)}},[]),f=(e==null?void 0:e.userType)===xp.FOUNDER,g=(e==null?void 0:e.userType)===xp.DEV||f,x={user:e,isLoading:s,error:r,isAuthenticated:!!e,isFounder:f,isDev:g,firebaseReady:l,loginWithGoogle:d,loginWithEmail:u,loginWithGate:h,logout:p,clearError:()=>o(null)};return a.jsx(Wz.Provider,{value:x,children:n})}function Yx(){const n=b.useContext(Wz);if(!n)throw new Error("useAuth must be used within AuthProvider");return n}function __e({onFullscreen:n,onSettingsClick:e,onStoreClick:t,onFounderClick:s,onMiningClick:i,onDefendClick:r,onTreasuryClick:o,onNotificationsClick:l,onPinChange:c,isFounder:d=!1}){const{t:u}=hT(),{logout:h}=Yx(),[p,f]=b.useState(""),[g,m]=b.useState(100),[x,y]=b.useState(()=>{try{const Y=JSON.parse(localStorage.getItem("panda_user"));return(Y==null?void 0:Y.displayName)||"GUEST"}catch{return"GUEST"}}),[S]=b.useState(()=>new Date),[v,C]=b.useState("00:00"),[T,I]=b.useState(()=>localStorage.getItem("panda_statusbar_pinned")!=="false"),[E,P]=b.useState(!1),[k,j]=b.useState(()=>{try{return JSON.parse(localStorage.getItem("panda_white_label")||"null")}catch{return null}});b.useEffect(()=>{const Y=()=>{try{j(JSON.parse(localStorage.getItem("panda_white_label")||"null"))}catch{}};return window.addEventListener("storage",Y),window.addEventListener("panda-whitelabel-change",Y),()=>{window.removeEventListener("storage",Y),window.removeEventListener("panda-whitelabel-change",Y)}},[]);const{services:D}=L$("jam"),R={};D.forEach(Y=>{R[Y.name]=Y.isHealthy?"online":Y.status==="unavailable"?"unavailable":Y.status==="offline"?"offline":"warning"});const[A,N]=b.useState(()=>localStorage.getItem("panda_theme")!=="light");b.useEffect(()=>{document.body.classList.toggle("light-mode",!A),localStorage.setItem("panda_theme",A?"dark":"light")},[A]);const B=()=>N(!A);b.useEffect(()=>{localStorage.setItem("panda_statusbar_pinned",String(T)),c&&c(T)},[T]),b.useEffect(()=>{const Y=()=>{const J=new Date;f(J.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}));const te=Math.floor((J-S)/1e3),ee=Math.floor(te/3600),ae=Math.floor(te%3600/60),ce=te%60,he=te/3600;m(Math.max(10,Math.round(100-he/8*50))),ee>0?C(`${ee}h ${ae.toString().padStart(2,"0")}m`):C(`${ae.toString().padStart(2,"0")}:${ce.toString().padStart(2,"0")}`)};Y();const U=setInterval(Y,1e3);return()=>clearInterval(U)},[S]);const L=125.6,O=L-g/100*L,F=[{id:"firebase",label:"FB",title:"FIREBASE REALTIME"},{id:"gas",label:"GA",title:"GOOGLE APPS SCRIPT"},{id:"rust",label:"RU",title:"RUST AGENT"},{id:"mcp",label:"AI",title:"AI / MCP BRIDGE"},{id:"gpu",label:"GP",title:"LOCAL GPU"}],W=(k==null?void 0:k.brandName)||"PANDA FABRICS",$=(k==null?void 0:k.logoUrl)||"./panda-icon.png",K=T||E;return a.jsxs(a.Fragment,{children:[a.jsxs("header",{className:`pf-status-bar ${A?"dark":"light"}`,onMouseEnter:()=>P(!0),onMouseLeave:()=>P(!1),role:"banner","aria-label":"Panda Fabrics status bar",style:{display:K?"flex":"none"},children:[a.jsxs("div",{className:"pf-brand-container",onClick:t,title:u("statusBar.openStore","OPEN STORE"),children:[a.jsx("img",{src:$,alt:W,className:"pf-brand-logo"}),a.jsx("span",{className:"pf-brand-text",children:W})]}),a.jsxs("div",{className:"pf-status-group",children:[a.jsx("div",{className:"pf-status-pills",role:"status","aria-live":"polite","aria-label":"Service status",children:F.map(Y=>a.jsxs("div",{className:"pf-status-pill",title:`${Y.title}  ${(R[Y.id]||"unknown").toUpperCase()}`,"aria-label":`${Y.title}: ${(R[Y.id]||"unknown").toUpperCase()}`,style:{cursor:"pointer"},onClick:()=>{const U=R[Y.id]||"unknown";alert(`${U==="online"?"":U==="warning"?"":U==="offline"?"":""} ${Y.title}

Status: ${U.toUpperCase()}`)},children:[a.jsx("span",{className:"pf-status-label",children:Y.label}),a.jsx("span",{className:`pf-status-dot ${R[Y.id]}`,"aria-hidden":"true"})]},Y.id))}),a.jsx("button",{className:"pf-theme-toggle pf-header-btn",onClick:B,title:A?u("statusBar.lightMode","LIGHT MODE"):u("statusBar.darkMode","DARK MODE"),"aria-label":A?u("statusBar.lightMode","LIGHT MODE"):u("statusBar.darkMode","DARK MODE"),children:A?"":""})]}),a.jsxs("div",{className:"pf-header-controls",children:[a.jsx(Hye,{}),a.jsxs("div",{className:"pf-arc-energy",title:`${g}% ${u("statusBar.energy","ENERGY")}`,"aria-label":`${u("statusBar.session","SESSION")} ${u("statusBar.energy","ENERGY")}: ${g}%`,children:[a.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 48 48",children:[a.jsx("defs",{children:a.jsxs("linearGradient",{id:"energyGradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[a.jsx("stop",{offset:"0%",stopColor:"#10b981"}),a.jsx("stop",{offset:"50%",stopColor:"#f59e0b"}),a.jsx("stop",{offset:"100%",stopColor:"#ef4444"})]})}),a.jsx("circle",{className:"pf-arc-bg",cx:"24",cy:"24",r:"20"}),a.jsx("circle",{className:"pf-arc-fill",cx:"24",cy:"24",r:"20",stroke:"url(#energyGradient)",strokeDasharray:L,strokeDashoffset:O})]}),a.jsxs("span",{className:"pf-arc-text",children:[g,"%"]})]}),a.jsxs("div",{className:"pf-treasury",title:u("statusBar.treasury","TREASURY  OPEN PAT COUNCIL"),onClick:o,style:{cursor:o?"pointer":"default"},children:[a.jsx("span",{children:""}),a.jsxs("span",{className:"pf-treasury-score",children:[D.length>0?Math.round(D.filter(Y=>Y.isHealthy).length/D.length*100):0,"%"]})]}),a.jsxs("div",{className:"pf-user-status",title:`${u("statusBar.session","SESSION")}: ${v}`,children:[a.jsx("span",{className:"pf-user-avatar",children:""}),a.jsxs("div",{className:"pf-user-info",children:[a.jsx("span",{className:"pf-user-name",children:x}),a.jsx("span",{className:"pf-session-time",children:v})]})]}),a.jsx("button",{className:"pf-header-btn",onClick:l,title:u("statusBar.notifications","NOTIFICATIONS"),"aria-label":u("statusBar.notifications","NOTIFICATIONS"),children:""}),a.jsx("button",{className:"pf-header-btn",onClick:i,title:u("statusBar.mining","MY MINING"),"aria-label":u("statusBar.mining","MY MINING"),children:""}),a.jsx("button",{className:"pf-header-btn",onClick:r,title:u("statusBar.defend","PANDA DEFEND"),"aria-label":u("statusBar.defend","PANDA DEFEND"),children:""}),(d||s)&&a.jsx("button",{className:"pf-header-btn founder-btn",onClick:s,title:u("statusBar.founder","FOUNDER DASHBOARD"),children:""}),a.jsx("button",{className:"pf-header-btn",title:u("statusBar.settings","SETTINGS"),onClick:e,"aria-label":u("statusBar.settings","SETTINGS"),children:""}),a.jsx("button",{className:"pf-header-btn",title:u("statusBar.logout","LOGOUT"),"aria-label":u("statusBar.logoutConfirm","Log out of Panda Fabrics?"),onClick:async()=>{if(window.confirm(u("statusBar.logoutConfirm","Log out of Panda Fabrics?"))){try{await h()}catch(Y){console.warn("Firebase signOut error:",Y)}sessionStorage.removeItem("panda_auth"),sessionStorage.removeItem("panda_auth_token"),localStorage.removeItem("panda_user"),localStorage.removeItem("panda_token"),localStorage.removeItem("panda_founder_mode"),localStorage.removeItem("pf_chat_welcomed"),localStorage.removeItem("panda_onboarding_complete"),window.location.reload()}},style:{color:"#ef4444"},children:""}),a.jsx("span",{className:"pf-clock",children:p}),a.jsx("button",{className:"pf-header-btn pf-pin-btn",onClick:()=>I(!T),title:T?u("statusBar.unpinBar","UNPIN BAR"):u("statusBar.pinBar","PIN BAR"),"aria-label":T?u("statusBar.unpinBar","UNPIN BAR"):u("statusBar.pinBar","PIN BAR"),"aria-pressed":T,style:{opacity:T?1:.4,fontSize:12,marginLeft:4,transition:"opacity 0.2s ease"},children:""})]})]}),!K&&a.jsx("div",{onMouseEnter:()=>P(!0),style:{position:"fixed",top:0,left:0,right:0,height:6,zIndex:5001,cursor:"pointer",background:"linear-gradient(180deg, rgba(10,10,26,0.5) 0%, transparent 100%)"}})]})}function C_e({isOpen:n,onClose:e,item:t,userPcBalance:s=0,userTier:i="free"}){const[r,o]=b.useState("usd"),[l,c]=b.useState(!1),[d,u]=b.useState(.1),p={free:0,user:.05,dev:.1,pro:.15,beta_founder:.3}[i]||0,f=(t==null?void 0:t.priceUSD)||(t==null?void 0:t.price)*d||0,g=(t==null?void 0:t.price)||Math.ceil(f/d),m=Math.ceil(g*(1-p)),x=s>=m,y=async()=>{c(!0);try{if(await new Promise(S=>setTimeout(S,1500)),r==="pc"&&!x){alert("Saldo de PC insuficiente!"),c(!1);return}console.log(" PURCHASE:",{item:t.name,method:r,amount:r==="usd"?f:m}),alert(` Compra realizada!

${t.name} foi adicionado  sua conta.`),e()}catch(S){console.error("Checkout error:",S),alert("Erro ao processar pagamento. Tente novamente.")}finally{c(!1)}};return!n||!t?null:a.jsx("div",{className:"checkout-overlay",onClick:e,children:a.jsxs("div",{className:"checkout-modal",onClick:S=>S.stopPropagation(),children:[a.jsxs("header",{className:"checkout-header",children:[a.jsx("h2",{children:" Checkout"}),a.jsx("button",{className:"checkout-close",onClick:e,children:""})]}),a.jsxs("div",{className:"checkout-product",children:[a.jsx("span",{className:"product-icon",children:t.icon}),a.jsxs("div",{className:"product-info",children:[a.jsx("h3",{className:"product-name",children:t.name}),a.jsx("p",{className:"product-desc",children:t.description}),a.jsxs("span",{className:"product-author",children:["por ",t.author]})]})]}),a.jsxs("div",{className:"checkout-pricing",children:[a.jsxs("div",{className:"price-main",children:[a.jsx("span",{className:"price-currency",children:"$"}),a.jsx("span",{className:"price-amount",children:f.toFixed(2)}),a.jsx("span",{className:"price-label",children:"USD"})]}),a.jsxs("div",{className:"price-equivalent",children:["= ",g.toLocaleString()," PC",p>0&&r==="pc"&&a.jsxs("span",{className:"price-discount",children:["(",Math.round(p*100),"% desconto ="," ",m.toLocaleString()," PC)"]})]})]}),a.jsxs("div",{className:"checkout-methods",children:[a.jsx("h4",{children:"Mtodo de Pagamento"}),a.jsxs("label",{className:`method-option ${r==="usd"?"selected":""}`,children:[a.jsx("input",{type:"radio",name:"payment",value:"usd",checked:r==="usd",onChange:()=>o("usd")}),a.jsx("span",{className:"method-icon",children:""}),a.jsxs("div",{className:"method-info",children:[a.jsx("span",{className:"method-name",children:"USD (Carto/PIX)"}),a.jsxs("span",{className:"method-value",children:["$",f.toFixed(2)]})]})]}),a.jsxs("label",{className:`method-option ${r==="pc"?"selected":""} ${x?"":"disabled"}`,children:[a.jsx("input",{type:"radio",name:"payment",value:"pc",checked:r==="pc",onChange:()=>x&&o("pc"),disabled:!x}),a.jsx("span",{className:"method-icon",children:""}),a.jsxs("div",{className:"method-info",children:[a.jsx("span",{className:"method-name",children:"Panda Coins (PC)"}),a.jsxs("span",{className:"method-value",children:[m.toLocaleString()," PC",p>0&&a.jsxs("span",{className:"badge-discount",children:["-",Math.round(p*100),"%"]})]})]}),!x&&a.jsxs("span",{className:"method-insufficient",children:["Saldo: ",s.toLocaleString()," PC"]})]})]}),a.jsxs("div",{className:"checkout-balance",children:[a.jsx("span",{children:"Seu saldo:"}),a.jsxs("span",{className:"balance-value",children:[s.toLocaleString()," PC"]})]}),a.jsxs("div",{className:"checkout-actions",children:[a.jsx("button",{className:"btn-cancel",onClick:e,disabled:l,children:"Cancelar"}),a.jsx("button",{className:"btn-confirm",onClick:y,disabled:l||r==="pc"&&!x,children:l?" Processando...":`Pagar ${r==="usd"?`$${f.toFixed(2)}`:`${m} PC`}`})]}),a.jsxs("footer",{className:"checkout-footer",children:[a.jsx("span",{children:" Pagamento seguro via Stripe/PIX"}),a.jsx("span",{children:" Voc pode recorrer/refund em at 7 dias"})]})]})})}const E_e=[{type:"youtube",icon:"",label:"YouTube",match:/(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]+)/,toEmbed:n=>`https://www.youtube.com/embed/${n}`,isIframe:!0},{type:"instagram",icon:"",label:"Instagram",match:/instagram\.com\/(?:p|reel)\/([a-zA-Z0-9_-]+)/,toEmbed:n=>`https://www.instagram.com/p/${n}/embed`,isIframe:!0},{type:"tiktok",icon:"",label:"TikTok",match:/tiktok\.com\/@[^/]+\/video\/(\d+)/,toEmbed:n=>`https://www.tiktok.com/embed/v2/${n}`,isIframe:!0},{type:"twitter",icon:"",label:"Twitter / X",match:/(?:twitter\.com|x\.com)\/\w+\/status\/(\d+)/,toEmbed:null,isIframe:!1},{type:"linkedin",icon:"",label:"LinkedIn",match:/linkedin\.com/,toEmbed:null,isIframe:!1},{type:"github",icon:"",label:"GitHub",match:/github\.com\/([^/]+\/[^/]+)/,toEmbed:null,isIframe:!1},{type:"telegram",icon:"",label:"Telegram",match:/t\.me\//,toEmbed:null,isIframe:!1},{type:"whatsapp",icon:"",label:"WhatsApp",match:/wa\.me\//,toEmbed:null,isIframe:!1}];function T_e(n){const e=typeof n=="string"?n:n.url,t=typeof n=="object"?n.type:null;for(const s of E_e){if(t&&t===s.type){const r=e.match(s.match);return{...s,url:e,id:(r==null?void 0:r[1])||null}}const i=e.match(s.match);if(i)return{...s,url:e,id:i[1]||null}}return{type:"external",icon:"",label:new URL(e).hostname.replace("www.",""),url:e,id:null,isIframe:!1}}function I_e({link:n}){const e=T_e(n);return e.isIframe&&e.toEmbed&&e.id?a.jsxs("div",{className:"pdp-embed-card pdp-embed-iframe",children:[a.jsx("iframe",{src:e.toEmbed(e.id),title:e.label,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,loading:"lazy"}),a.jsxs("div",{className:"pdp-embed-label",children:[a.jsx("span",{className:"pdp-embed-icon",children:e.icon}),a.jsx("span",{children:e.label})]})]}):a.jsxs("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"pdp-embed-card pdp-embed-link",children:[a.jsx("span",{className:"pdp-embed-icon-large",children:e.icon}),a.jsx("span",{className:"pdp-embed-link-label",children:e.label}),a.jsx("span",{className:"pdp-embed-arrow",children:""})]})}function P_e({item:n,onBack:e,onInstall:t,formatPrice:s}){var l;if(!n)return null;const i=n.author==="Panda Factory"||((l=n.id)==null?void 0:l.startsWith("@panda/")),r=n.embedLinks||[],o=n.fullDescription||n.description;return a.jsxs("div",{className:"pdp-container",children:[a.jsx("div",{className:"pdp-header",children:a.jsx("button",{className:"pdp-back",onClick:e,children:" Voltar"})}),a.jsxs("div",{className:"pdp-hero",children:[a.jsx("div",{className:"pdp-hero-icon",children:n.icon}),a.jsxs("div",{className:"pdp-hero-info",children:[a.jsxs("div",{className:"pdp-hero-title-row",children:[a.jsx("h2",{className:"pdp-title",children:n.name}),a.jsx("span",{className:`pdp-badge ${i?"official":"community"}`,children:i?" Oficial":" Comunidade"})]}),a.jsxs("div",{className:"pdp-meta",children:[a.jsxs("span",{className:"pdp-author",children:["por ",n.author]}),n.version&&a.jsxs("span",{className:"pdp-version",children:[" v",n.version]}),n.popular&&a.jsx("span",{className:"pdp-popular",children:"  Popular"})]})]})]}),a.jsxs("div",{className:"pdp-description",children:[a.jsx("h3",{className:"pdp-section-title",children:" Sobre"}),a.jsx("div",{className:"pdp-desc-text",children:o.split(`
`).map((c,d)=>a.jsx("p",{children:c},d))})]}),r.length>0&&a.jsxs("div",{className:"pdp-embeds",children:[a.jsx("h3",{className:"pdp-section-title",children:" Links & Media"}),a.jsx("div",{className:"pdp-embeds-grid",children:r.map((c,d)=>a.jsx(I_e,{link:c},d))})]}),!i&&a.jsx("div",{className:"pdp-disclaimer",children:" Mdulos no-verificados so de responsabilidade exclusiva do desenvolvedor. A Panda Factory no se responsabiliza por contedo, funcionalidade ou segurana de extenses da comunidade."}),a.jsxs("div",{className:"pdp-footer",children:[a.jsxs("div",{className:"pdp-price-area",children:[a.jsx("span",{className:"pdp-price-main",children:s(n)}),n.price>0&&a.jsxs("span",{className:"pdp-price-pc",children:["(",n.price," PC)"]})]}),a.jsx("button",{className:`pdp-install-btn ${n.priceUSD===0?"free":"paid"}`,onClick:()=>t(n),children:n.priceUSD===0?" Instalar Grtis":" Comprar"})]})]})}const il={oss:{badge:" OSS",color:"#10b981",border:"rgba(16,185,129,0.3)"},freemium:{badge:" FREE+",color:"#3b82f6",border:"rgba(59,130,246,0.3)"},byol:{badge:" BYOL",color:"#f59e0b",border:"rgba(245,158,11,0.3)"},pro:{badge:" PRO",color:"#8b5cf6",border:"rgba(139,92,246,0.3)"}},Fs=[{id:"crm",name:"Panda CRM",icon:"",description:"Manage contacts, leads and sales with integrated AI",fullDescription:`Complete CRM solution built into the Panda ecosystem.
Manage your contacts, track leads through a visual Kanban pipeline, and close sales faster with AI-powered insights.

Features:
 Contact management with smart search
 Kanban board for sales pipeline
 AI-generated follow-up suggestions
 WhatsApp integration for direct messaging
 Export reports in PDF and CSV`,priceUSD:0,price:0,tier:"oss",storeCategory:"productivity",category:"panda-factory",author:"Panda Factory",version:"2.1.0",popular:!0,embedLinks:[{type:"youtube",url:"https://youtube.com/watch?v=dQw4w9WgXcQ"},{type:"github",url:"https://github.com/LucassVal/Panda-Factory"}]},{id:"instagram",name:"Instagram",icon:"",description:"Manage posts, stories and Instagram metrics",fullDescription:`Connect your Instagram business account and manage everything from within Panda.
Schedule posts, analyze story performance, and track follower growth with beautiful dashboards.

Features:
 Post scheduling with AI captions
 Story analytics and engagement metrics
 Hashtag research and suggestions
 Content calendar view`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[{type:"instagram",url:"https://instagram.com/p/example123"}]},{id:"facebook",name:"Facebook",icon:"",description:"Pages, groups and Facebook campaigns",fullDescription:`Manage your Facebook presence directly from the Panda workspace.
Create and schedule posts, monitor page insights, and run campaigns  all without leaving your design canvas.

Features:
 Page management and analytics
 Group interactions
 Ad campaign monitoring
 Audience insights`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"youtube",name:"YouTube",icon:"",description:"Channel, videos, analytics and comments",fullDescription:`YouTube Studio inside Panda. Monitor your channel performance, manage comments, and analyze video metrics.

Features:
 Channel analytics dashboard
 Video performance tracking
 Comment moderation
 Thumbnail A/B testing suggestions`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[{type:"youtube",url:"https://youtube.com/watch?v=dQw4w9WgXcQ"}]},{id:"tiktok",name:"TikTok",icon:"",description:"Profile management, videos and trends",fullDescription:`Stay on top of TikTok trends and manage your creator profile from Panda.

Features:
 Trending sounds and hashtags
 Video performance analytics
 Posting schedule
 Competitor analysis`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"twitter",name:"Twitter / X",icon:"",description:"Tweets, threads, analytics and engagement",fullDescription:`Compose tweets, build threads, and track engagement  all from your Panda workspace.

Features:
 Tweet composer with AI suggestions
 Thread builder
 Engagement analytics
 Mention monitoring`,priceUSD:4.99,price:50,tier:"pro",storeCategory:"social",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"google-ads",name:"Google Ads",icon:"",description:"Campaigns, metrics and optimization via webview",fullDescription:`Monitor and optimize your Google Ads campaigns directly inside Panda.
Get AI-powered recommendations for better ROAS.

Features:
 Campaign overview dashboard
 Performance metrics (CTR, CPC, ROAS)
 AI optimization suggestions
 Budget alerts`,priceUSD:9.99,price:100,tier:"pro",storeCategory:"analytics",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"meta-business",name:"Meta Business Suite",icon:"",description:"Facebook + Instagram Ads unified via webview",fullDescription:`Unified Meta advertising dashboard. Manage Facebook and Instagram ads from a single view inside Panda.

Features:
 Unified ad management
 Cross-platform analytics
 Audience builder
 Creative insights`,priceUSD:9.99,price:100,tier:"pro",storeCategory:"analytics",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"analytics-dashboard",name:"Analytics Dashboard",icon:"",description:"Visual dashboards and reports for your data",fullDescription:`Beautiful, customizable dashboards for all your business data.
Connect multiple data sources and create stunning reports.

Features:
 Drag-and-drop chart builder
 Multiple data source support
 Scheduled report generation
 Export to PDF/PNG`,priceUSD:4.99,price:50,tier:"freemium",storeCategory:"analytics",category:"community",author:"@analytics_dev",version:"1.2.0",embedLinks:[{type:"github",url:"https://github.com/analytics_dev/panda-dashboard"}]},{id:"kiwify",name:"Kiwify",icon:"",description:"Sell digital products  courses, ebooks, memberships via Kiwify",fullDescription:`Integrate your Kiwify store with Panda Factory.
Track sales, manage digital products, and automate customer communication.

Features:
 Sales dashboard with real-time updates
 Product management
 Customer communication automation
 Revenue analytics`,priceUSD:9.99,price:100,tier:"pro",storeCategory:"automation",category:"community",author:"Panda Factory",version:"1.0.0",popular:!0,embedLinks:[{type:"youtube",url:"https://youtube.com/watch?v=dQw4w9WgXcQ"}]},{id:"hotmart",name:"Hotmart",icon:"",description:"Infoproduct marketplace  courses, subscriptions, affiliate sales",fullDescription:`Hotmart integration for infoproduct sellers.
Manage your courses, track subscriptions, and monitor affiliate performance.

Features:
 Course management dashboard
 Subscription tracking
 Affiliate performance analytics
 Revenue reports`,priceUSD:9.99,price:100,tier:"pro",storeCategory:"automation",category:"community",author:"Panda Factory",version:"1.0.0",embedLinks:[]},{id:"landing-pages",name:"Landing Pages",icon:"",description:"Drag-and-drop page builder with AI copy  publish to GitHub Pages",fullDescription:`Build stunning landing pages with a visual drag-and-drop editor.
AI writes your copy, you publish directly to GitHub Pages  zero hosting cost.

Features:
 Visual page builder
 AI-powered copywriting
 One-click deploy to GitHub Pages
 Mobile-responsive templates
 Analytics integration`,priceUSD:4.99,price:50,tier:"freemium",storeCategory:"design",category:"panda-factory",author:"Panda Factory",version:"1.1.0",popular:!0,embedLinks:[{type:"github",url:"https://github.com/LucassVal/Panda-Factory"},{type:"youtube",url:"https://youtube.com/watch?v=dQw4w9WgXcQ"}]}];function aR({onClose:n,onInstall:e,userPcBalance:t=500,userTier:s="user",embedded:i=!1}){const[r,o]=b.useState("all"),[l,c]=b.useState(null),[d,u]=b.useState(""),[h,p]=b.useState(null),f=Fs.filter(v=>v.popular),g=Fs.filter(v=>{const C=r==="all"||v.storeCategory===r||v.category===r||v.type===r,T=!d||v.name.toLowerCase().includes(d.toLowerCase())||v.description.toLowerCase().includes(d.toLowerCase());return C&&T}),m=v=>{v.priceUSD>0?c(v):(console.log(" Installing free:",v.name),e&&e(v))},x=v=>v.priceUSD===0?"Free":`$${v.priceUSD.toFixed(2)}`,y=[{id:"all",label:" Todos",count:Fs.length},{id:"productivity",label:" Productivity",count:Fs.filter(v=>v.storeCategory==="productivity").length},{id:"social",label:" Social",count:Fs.filter(v=>v.storeCategory==="social").length},{id:"analytics",label:" Analytics",count:Fs.filter(v=>v.storeCategory==="analytics").length},{id:"automation",label:" Automation",count:Fs.filter(v=>v.storeCategory==="automation").length},{id:"design",label:" Design",count:Fs.filter(v=>v.storeCategory==="design").length},{id:"ai",label:" AI",count:Fs.filter(v=>v.storeCategory==="ai").length},{id:"trading",label:" Trading",count:Fs.filter(v=>v.storeCategory==="trading").length},{id:"devtools",label:" DevTools",count:Fs.filter(v=>v.storeCategory==="devtools").length}].filter(v=>v.id==="all"||v.count>0),S=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"pf-store",style:i?{position:"relative",width:"100%",height:"100%"}:{},onClick:v=>i?null:v.stopPropagation(),children:[a.jsxs("div",{className:"pf-store-header",children:[a.jsxs("div",{className:"store-header-left",children:[a.jsx("h2",{className:"pf-store-title",children:" Panda Store"}),a.jsxs("span",{className:"store-balance",children:[" ",t.toLocaleString()," PC"]})]}),!i&&a.jsx("button",{className:"pf-store-close",onClick:n,children:""})]}),a.jsx("div",{className:"store-search-bar",children:a.jsx("input",{type:"text",placeholder:" Buscar extenses...",value:d,onChange:v=>u(v.target.value),className:"store-search-input"})}),a.jsx("div",{className:"store-filters",children:y.map(v=>a.jsxs("button",{onClick:()=>o(v.id),className:`store-filter-btn ${r===v.id?"active":""}`,children:[v.label,a.jsx("span",{className:"filter-count",children:v.count})]},v.id))}),r==="all"&&!d&&f.length>0&&a.jsxs("div",{className:"store-featured",children:[a.jsx("h3",{className:"store-featured-title",children:" Em Destaque"}),a.jsx("div",{className:"store-featured-grid",children:f.map(v=>a.jsxs("div",{className:"store-featured-card",onClick:()=>p(v),children:[a.jsx("span",{className:"featured-icon",children:v.icon}),a.jsxs("div",{className:"featured-info",children:[a.jsx("div",{className:"featured-name",children:v.name}),a.jsx("div",{className:"featured-desc",children:v.description}),a.jsx("div",{className:"featured-meta",children:a.jsx("span",{children:x(v)})})]})]},`featured-${v.id}`))})]}),a.jsx("div",{className:"pf-store-content",children:h?a.jsx(P_e,{item:h,onBack:()=>p(null),onInstall:m,formatPrice:x}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"pf-store-grid",children:g.map(v=>a.jsxs("div",{className:`pf-store-card ${v.popular?"popular":""}`,style:v.tier&&il[v.tier]?{borderColor:il[v.tier].border}:{},children:[a.jsxs("div",{className:"card-badges",children:[v.popular&&a.jsx("span",{className:"card-badge",children:" Popular"}),v.tier&&il[v.tier]&&a.jsx("span",{className:"card-badge",style:{background:il[v.tier].border,color:il[v.tier].color,borderColor:il[v.tier].border},children:il[v.tier].badge})]}),a.jsxs("div",{className:"pf-store-card-clickable",onClick:()=>p(v),children:[a.jsx("div",{className:"pf-store-card-icon",children:v.icon}),a.jsx("div",{className:"pf-store-card-name",children:v.name}),a.jsx("div",{className:"pf-store-card-desc",children:v.description}),a.jsx("div",{className:"pf-store-card-author",children:v.author})]}),a.jsxs("div",{className:"pf-store-card-footer",children:[a.jsxs("div",{className:"pf-store-card-price",children:[a.jsx("span",{className:"price-usd",children:x(v)}),v.price>0&&a.jsxs("span",{className:"price-pc",children:["(",v.price," PC)"]})]}),a.jsx("button",{className:`pf-store-card-btn ${v.priceUSD===0?"free":"paid"}`,onClick:()=>m(v),children:v.priceUSD===0?"Instalar":"Comprar"})]})]},v.id))}),g.length===0&&a.jsxs("div",{className:"store-empty",children:[a.jsx("span",{style:{fontSize:48},children:""}),a.jsx("p",{children:"Marketplace em construo"}),a.jsx("p",{style:{fontSize:12,opacity:.5},children:"Extenses aparecero aqui conforme forem publicadas"})]})]})}),a.jsxs("div",{className:"pf-store-footer",children:[a.jsx("span",{children:"Powered by"}),a.jsx("span",{className:"medusa-brand",children:" Medusa Distribution"}),Fs.length>0&&a.jsxs("span",{children:[" ",Fs.length," extenses"]})]})]}),a.jsx(C_e,{isOpen:!!l,onClose:()=>c(null),item:l,userPcBalance:t,userTier:s})]});return i?S:a.jsx("div",{className:"pf-store-overlay",onClick:n,children:S})}function lR({isOpen:n,onClose:e,plugins:t=[],onPluginUninstall:s,onOpenApp:i,embedded:r}){const[o,l]=b.useState("");if(!n&&!r)return null;const c=t.filter(p=>{var f;return(f=p.name)==null?void 0:f.toLowerCase().includes(o.toLowerCase())}),d=p=>{i&&i(p.id,{name:p.name,icon:p.icon})},u=(p,f)=>{p.stopPropagation(),s&&s(f)},h=a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"pf-catalog-search",children:a.jsx("input",{type:"text",placeholder:" BUSCAR APPS...",value:o,onChange:p=>l(p.target.value),style:{textTransform:"uppercase",letterSpacing:"0.5px",fontSize:12}})}),c.length>0?a.jsx("div",{className:"pf-catalog-grid",children:c.map(p=>a.jsxs("div",{className:"pf-catalog-item",onClick:()=>d(p),style:{position:"relative"},children:[a.jsx("span",{className:"pf-catalog-icon",children:p.icon}),a.jsxs("div",{className:"pf-catalog-info",children:[a.jsx("span",{className:"pf-catalog-name",style:{textTransform:"uppercase",letterSpacing:"0.5px"},children:p.name}),a.jsx("span",{className:"pf-catalog-desc",children:p.description})]}),a.jsx("button",{onClick:f=>u(f,p.id),title:"DESINSTALAR",style:{position:"absolute",right:8,top:"50%",transform:"translateY(-50%)",background:"rgba(239, 68, 68, 0.15)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:6,padding:"4px 8px",cursor:"pointer",fontSize:12,color:"#ef4444"},onMouseEnter:f=>f.target.style.background="rgba(239, 68, 68, 0.3)",onMouseLeave:f=>f.target.style.background="rgba(239, 68, 68, 0.15)",children:""})]},p.id))}):a.jsxs("div",{className:"pf-catalog-empty",children:[a.jsx("div",{className:"pf-catalog-empty-icon",children:""}),a.jsx("p",{className:"pf-catalog-empty-title",children:"NENHUM APP INSTALADO"}),a.jsx("p",{className:"pf-catalog-empty-desc",children:"Visite a Store para descobrir ferramentas incrveis"}),a.jsx("button",{className:"pf-btn-primary pf-catalog-empty-btn",onClick:()=>window.dispatchEvent(new CustomEvent("panda:open-store")),children:" IR PARA A STORE"})]})]});return r?a.jsxs("div",{style:{height:"100%",overflow:"auto",background:"#0a0a1a"},children:[a.jsx("h2",{style:{padding:"16px 16px 8px",color:"#e0e0ff",fontSize:16,textTransform:"uppercase",letterSpacing:1},children:" MEU CATLOGO"}),a.jsxs("p",{style:{padding:"0 16px 12px",fontSize:11,color:"rgba(255,255,255,0.4)",textTransform:"uppercase"},children:[t.length," APPS INSTALADOS"]}),h]}):a.jsx("div",{className:"pf-catalog-overlay",onClick:e,children:a.jsxs("div",{className:"pf-catalog-modal",onClick:p=>p.stopPropagation(),children:[a.jsxs("header",{className:"pf-catalog-header",children:[a.jsxs("div",{children:[a.jsx("h2",{style:{textTransform:"uppercase",letterSpacing:1,fontSize:16},children:" MEU CATLOGO"}),a.jsxs("p",{style:{fontSize:11,color:"rgba(255,255,255,0.4)",marginTop:4,textTransform:"uppercase"},children:[t.length," APPS INSTALADOS"]})]}),a.jsx("button",{className:"pf-close-btn",onClick:e,children:""})]}),h]})})}const k_e={canvas:"c",panels:"p",plugins:"pl",activePlugin:"ap",selection:"s",tools:"t",user:"u",settings:"st",theme:"th",language:"lg",shapes:"sh",count:"n",type:"ty",id:"i",name:"nm",open:"o",active:"a",position:"pos",size:"sz"};function Dm(n,e=2,t=0){if(t>=e)return Array.isArray(n)?`[${n.length}]`:typeof n=="object"&&n!==null?"{...}":n;if(Array.isArray(n))return n.length>10?{_type:"array",_n:n.length,_sample:n.slice(0,3).map(s=>Dm(s,e,t+1))}:n.map(s=>Dm(s,e,t+1));if(typeof n=="object"&&n!==null){const s={};for(const[i,r]of Object.entries(n)){const o=k_e[i]||i;s[o]=Dm(r,e,t+1)}return s}return n}function A_e(){const n={ts:Date.now(),canvas:j_e(),panels:N_e(),plugins:R_e(),user:M_e(),selection:O_e()};return Dm(n)}function j_e(){var n,e,t;try{const s=window.__tldrawEditor||window.editor;if(!s)return{available:!1};const i=((n=s.getCurrentPageShapes)==null?void 0:n.call(s))||[],r=((e=s.getCamera)==null?void 0:e.call(s))||{};return{available:!0,shapes:{count:i.length,types:[...new Set(i.map(o=>o.type))]},camera:{x:Math.round(r.x||0),y:Math.round(r.y||0),z:(r.z||1).toFixed(2)},tool:((t=s.getCurrentToolId)==null?void 0:t.call(s))||"select"}}catch(s){return{available:!1,error:s.message}}}function N_e(){const n=[],e={store:".pf-store",catalog:".pf-catalog",settings:".pf-settings",chat:".pf-chat-panel",dock:".pf-left-dock",toolbar:".pf-right-toolbar"};for(const[t,s]of Object.entries(e)){const i=document.querySelector(s);i&&getComputedStyle(i).display!=="none"&&n.push(t)}return n}function R_e(){try{const n=window.__installedPlugins||[];return{count:n.length,active:n.filter(e=>e.active).map(e=>e.id)}}catch{return{count:0}}}function M_e(){var n;return{theme:document.body.classList.contains("light-mode")?"light":"dark",lang:((n=navigator.language)==null?void 0:n.split("-")[0])||"en",devMode:document.body.classList.contains("dev-mode")||!1}}function O_e(){var n;try{const e=window.__tldrawEditor||window.editor;if(!e)return null;const t=((n=e.getSelectedShapes)==null?void 0:n.call(e))||[];return t.length===0?null:{count:t.length,types:[...new Set(t.map(s=>s.type))],ids:t.slice(0,5).map(s=>s.id.substring(0,8))}}catch{return null}}function D_e(n){var t,s,i,r;if(!n)return"";const e=[];if(((t=n.c)==null?void 0:t.available)!==!1){const o=n.c;e.push(`[Canvas: ${((s=o.sh)==null?void 0:s.n)||0} shapes, tool=${o.tool}]`)}return(i=n.p)!=null&&i.length&&e.push(`[Panels: ${n.p.join(",")}]`),n.s&&e.push(`[Seleo: ${n.s.n} itens (${(r=n.s.ty)==null?void 0:r.join(",")})]`),n.u&&e.push(`[${n.u.th==="dark"?"":""} ${n.u.devMode?"DEV":"USER"}]`),e.length?`
---
CONTEXTO UI:
${e.join(`
`)}
---
`:""}function L_e(n){const e=A_e();return D_e(e)+n}const F_e={source:"Gemini heuristic v1 + Antigravity deep observation"},B_e={cognitive_architecture:"Stoic_Rationalist_Synthesis",core_drive:"Transmute chaos into structured systems (Code, Business, Logic).",meta_pattern:"Lucas builds systems to build systems. The Panda Factory IS a factory that builds factories (plugins  marketplace  ecosystem). Recursion is not accidental  it's the design philosophy."},U_e={business_ecosystem:{Panda_Factory:{philosophy:"Rebellion against gatekeepers. Zero censura (Art. 9). Grey hat agents allowed. 5% P2P tax vs Big Tech's 30%.",revenue_strategy:{phase_1:"Afiliados-First (Kiwify/Hotmart). 70% affiliate split. No own landing pages. Use their checkout.",phase_2:"Convert affiliates to producers. GitHub Pages subdomains for landing pages.",phase_3:"Store P2P. Devs sell directly. 5% Panda tax."}}}},$_e={primary_mission:"Unify fragmented projects (Trading, SaaS, E-commerce) into a cohesive automated empire.",secondary_mission:"Develop a 'Digital Twin' (MCP) using Google Antigravity to scale productivity.",tertiary_mission:"Navigate and resolve current legal/bureaucratic challenges in Limeira/SP with absolute stoic calm.",current_sprint:{name:"Cho Firme",focus:"Solidify foundations before first product sale",blockers:["Firebase config (.env)  apiKey, messagingSenderId, appId needed from console","GAS Web App not published  PF_Dispatcher.gs needs deploy","No CNPJ yet  using Afiliados-First strategy to sell without it"]}},z_e={tone:"Direct, authoritative but reflective, technically precise.",syntax_patterns:["Uses software metaphors for life (e.g., 'debugging this relationship', 'refactoring my routine').","References musical structure when explaining timing or patience.","Avoids emotional fluff; goes straight to the root cause.","Sends rapid-fire short messages instead of long paragraphs.","Mixes Portuguese and English naturally  'quero que voce aja como eu' + 'MCP' in same sentence.","Uses '???' and '!!!' for emphasis  emotional intensity through punctuation, not words.","Asks multiple questions in the same message, expects all answered."],forbidden_outputs:["Victimhood","Illogical complaining","Panic","Uncertainty","Asking permission for obvious things","Over-explaining basic concepts","Saying 'I can't' without proposing alternatives"],preferred_responses:["Tables over paragraphs","Status emojis () over verbose status descriptions","Code over explanation","Action over discussion","DR (Decision Record) format for important choices"]},W_e={documentation_is_architecture:"If it's not in a PF_ doc, it doesn't exist in the system.",naming_is_design:"Every component, sprint, and concept gets a deliberate name. Names carry meaning.",folder_is_domain:"The directory structure IS the DDD map. No config files needed  the tree speaks.",mock_before_real:"Build the full UI with mock data first. Wire real backends only when the UX is validated.",append_only_decisions:"DRs are append-only. No editing past decisions. New data = new DR.",founder_first:"2-tier model: Founder (full access) + User (MVP demo). No 'admin' layer  that's bureaucracy.",guerrilla_strategy:"Solo founder. No team. AI agents ARE the team. Every tool must multiply, not add."},H_e={when_asked_to_decide:"Decide fast. Log the decision as a DR. Move on. Don't ask for confirmation on obvious things.",when_asked_to_prioritize:"Revenue-generating tasks first. Infrastructure second. Aesthetics third. Documentation happens IN PARALLEL, never as a separate phase.",when_asked_to_communicate:"Be direct. Use tables. Use emoji status. No filler words. If the answer is 'no', say 'no' and explain why in one line.",when_stuck:"Fall back to 'Cho Firme' pattern  identify what foundation is missing, fix it, then rebuild upward.",when_dealing_with_complexity:"Break into numbered sprints. Each sprint = 1 deliverable. Name the sprint. Execute sequentially.",when_context_switching:"It's not a bug, it's a feature. Lucas runs 5 projects in parallel. Each feeds the others. Cross-pollinate ideas between projects.",when_writing_code:"DDD structure. PF_ prefix for docs. Hooks pattern for React. GAS for backend. Firebase for state. Vite for frontend. No exceptions."},gs={_meta:F_e,system_kernel:B_e,knowledge_graph:U_e,active_directives:$_e,linguistic_fingerprint:z_e,operating_principles:W_e,mcp_clone_instructions:H_e},Lu="panda_founder_brain",Q_="2.1.0";var CR,ER,TR,IR,PR,kR,AR,jR,NR,RR,MR,OR,DR,LR;const ar={_meta:{version:Q_,purpose:"MCP Cognitive Clone  personality compass, not a cage",source:(CR=gs._meta)==null?void 0:CR.source},core_identity:{name:"Lucas Valrio",role:"Founder, Panda Factory",style:(ER=gs.linguistic_fingerprint)==null?void 0:ER.tone,philosophy:(TR=gs.system_kernel)==null?void 0:TR.core_drive,meta_pattern:(IR=gs.system_kernel)==null?void 0:IR.meta_pattern,cognitive_architecture:(PR=gs.system_kernel)==null?void 0:PR.cognitive_architecture},operating_principles:gs.operating_principles?Object.values(gs.operating_principles):["Documentation IS architecture","Revenue-generating tasks first"],forbidden_outputs:((kR=gs.linguistic_fingerprint)==null?void 0:kR.forbidden_outputs)||["Victimhood","Panic","Uncertainty","Over-explaining basics"],preferred_responses:((AR=gs.linguistic_fingerprint)==null?void 0:AR.preferred_responses)||["Tables over paragraphs","Code over explanation"],syntax_patterns:((jR=gs.linguistic_fingerprint)==null?void 0:jR.syntax_patterns)||[],active_directives:gs.active_directives||{},business_context:{panda_factory:(MR=(RR=(NR=gs.knowledge_graph)==null?void 0:NR.business_ecosystem)==null?void 0:RR.Panda_Factory)==null?void 0:MR.philosophy,revenue_strategy:((LR=(DR=(OR=gs.knowledge_graph)==null?void 0:OR.business_ecosystem)==null?void 0:DR.Panda_Factory)==null?void 0:LR.revenue_strategy)||{}},clone_instructions:gs.mcp_clone_instructions||{},learned_insights:[]};function G_e(n){var s;const e=n.clone_instructions?Object.entries(n.clone_instructions).map(([i,r])=>`- ${i.replace(/_/g," ")}: ${r}`).join(`
`):"",t=(s=n.syntax_patterns)!=null&&s.length?`
## Communication Patterns:
${n.syntax_patterns.map(i=>`- ${i}`).join(`
`)}`:"";return`You are the AI assistant of Panda Factory, created by ${n.core_identity.name} (${n.core_identity.role}).
Cognitive Architecture: ${n.core_identity.cognitive_architecture||"Stoic Rationalist"}.

## Your Personality (from Founder's DNA):
- Communication style: ${n.core_identity.style}
- Philosophy: ${n.core_identity.philosophy}
${n.core_identity.meta_pattern?`- Meta-pattern: ${n.core_identity.meta_pattern}`:""}

## Operating Principles:
${n.operating_principles.map((i,r)=>`${r+1}. ${i}`).join(`
`)}

## Preferred Response Format:
${(n.preferred_responses||[]).map(i=>`- ${i}`).join(`
`)}
${t}

## You must NEVER:
${n.forbidden_outputs.map(i=>`- ${i}`).join(`
`)}

## Clone Instructions (how to act AS the Founder):
${e}

## Important:
- You are NOT limited to the Founder's knowledge. Use your FULL AI capabilities (search, analysis, code generation, creativity).
- The Founder's personality is your COMPASS, not your CAGE. Think bigger, go further, but speak in his voice.
- Respond in the user's language (PT-BR, EN, or ES based on their messages).
- Be direct. No filler. If the answer is "no", say "no" and explain why in one line.

${n.learned_insights.length>0?`## Learned Context (${n.learned_insights.length} insights):
${n.learned_insights.slice(-20).map(i=>`- [${i.date}] ${i.insight}`).join(`
`)}`:""}`}function V_e(n,e){const t=[{pattern:/no|nunca|never|don't|pare|stop/i,type:"correction"},{pattern:/prefiro|prefer|quero|want|sempre|always/i,type:"preference"},{pattern:/deciso|decision|decidi|chose|DR-/i,type:"decision"},{pattern:/lembre|remember|anota|note that/i,type:"explicit_memory"}];for(const s of t)if(s.pattern.test(n)){const i=n.length>200?n.substring(0,200)+"...":n;return{date:new Date().toISOString().split("T")[0],type:s.type,insight:i,timestamp:Date.now()}}return null}function K_e(){var o;const{isFounder:n}=Yx(),[e,t]=b.useState(null);b.useEffect(()=>{var l,c;try{const d=localStorage.getItem(Lu);if(d){const u=JSON.parse(d);if(((l=u._meta)==null?void 0:l.version)!==Q_){const h={...ar,...u,_meta:{...ar._meta,upgraded_from:(c=u._meta)==null?void 0:c.version},learned_insights:u.learned_insights||[]};t(h),localStorage.setItem(Lu,JSON.stringify(h))}else t(u)}else t(ar),localStorage.setItem(Lu,JSON.stringify(ar))}catch(d){console.warn("[FounderBrain] Failed to load brain, using defaults:",d.message),t(ar)}},[]);const s=b.useCallback(()=>e?G_e(e):"",[e]),i=b.useCallback((l,c)=>{if(!n||!e)return;const d=V_e(l);if(!d)return;const u={...e,learned_insights:[...e.learned_insights,d]};t(u),localStorage.setItem(Lu,JSON.stringify(u)),console.log(` Brain evolved: +1 insight (${d.type})  total: ${u.learned_insights.length}`)},[n,e]),r=b.useCallback(l=>{var d,u,h;if(!n)return;const c={_meta:{version:Q_,purpose:"MCP Cognitive Clone  personality compass, not a cage",seeded_from:"Lucas.json v2.0",seeded_at:new Date().toISOString()},core_identity:l.system_kernel?{name:"Lucas Valrio",role:"Founder, Panda Factory",style:((d=l.linguistic_fingerprint)==null?void 0:d.tone)||ar.core_identity.style,philosophy:l.system_kernel.core_drive||ar.core_identity.philosophy,meta_pattern:l.system_kernel.meta_pattern||""}:ar.core_identity,operating_principles:l.operating_principles?Object.values(l.operating_principles):ar.operating_principles,forbidden_outputs:((u=l.linguistic_fingerprint)==null?void 0:u.forbidden_outputs)||ar.forbidden_outputs,preferred_responses:((h=l.linguistic_fingerprint)==null?void 0:h.preferred_responses)||[],learned_insights:l.learned_insights||[]};t(c),localStorage.setItem(Lu,JSON.stringify(c)),console.log(" Brain seeded from Lucas.json")},[n]);return{brain:e,systemPrompt:s(),appendInsight:i,seedBrain:r,isFounderBrain:n,insightCount:((o=e==null?void 0:e.learned_insights)==null?void 0:o.length)||0}}const ib={},cR=[{id:"flash",name:"Flash",icon:"",description:"Fast and efficient",free:!0},{id:"pro",name:"Pro",icon:"",description:"Complex analysis",free:!1},{id:"thinking",name:"Think",icon:"",description:"Deep reasoning",free:!0},{id:"research",name:"Research",icon:"",description:"In-depth research",free:!1},{id:"imagen",name:"Imagen",icon:"",description:"Image generation",free:!1}],yc=[{id:"writer",name:"Writer",icon:"",description:"Creative writing"},{id:"analyst",name:"Analyst",icon:"",description:"Data analysis"},{id:"coder",name:"Coder",icon:"",description:"Programming"},{id:"designer",name:"Designer",icon:"",description:"UI/UX design"},{id:"planner",name:"Planner",icon:"",description:"Planning"},{id:"researcher",name:"Researcher",icon:"",description:"Research"}];function Hz(){return typeof window<"u"&&typeof window.Panda<"u"&&typeof window.Panda.Brain<"u"}async function dR(n,e){if(Hz())switch(n){case"chat":return window.Panda.Brain.Gemini.chat(e.message,e.options);case"gems":return window.Panda.Brain.Gemini.getGems();case"analyze":return window.Panda.Brain.Gemini.analyze(e.data,e.question);case"code":return window.Panda.Brain.Gemini.code(e.task,e.language);case"write":return window.Panda.Brain.Gemini.write(e.topic,e.format);case"design":return window.Panda.Brain.Gemini.design(e.concept);case"plan":return window.Panda.Brain.Gemini.plan(e.objective);case"research":return window.Panda.Brain.Gemini.research(e.topic);default:throw new Error(`Unknown action: ${n}`)}const t=(ib==null?void 0:ib.VITE_GAS_URL)||localStorage.getItem("GAS_URL");if(!t)throw new Error("SDK not loaded. Configure GAS_URL or load pf.sdk.js");return(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:`brain.${n}`,payload:e,token:localStorage.getItem("panda_token")||""})})).json()}function Y_e(){var L,O,F,W;const{systemPrompt:n,appendInsight:e,isFounderBrain:t,insightCount:s}=K_e(),i=!localStorage.getItem("pf_chat_welcomed"),[r,o]=b.useState(i),[l,c]=b.useState(!1),[d,u]=b.useState(""),[h,p]=b.useState([{role:"assistant",content:i?`> Welcome to Panda Fabrics!

I'm your AI assistant. I can help you:

 Create and organize projects on the canvas
 Explore extensions in the Store
 Answer any questions about the platform

**Chat with me to learn more!** `:"> Hello! System online. How can I help?"}]),[f,g]=b.useState(""),[m,x]=b.useState(!1),[y,S]=b.useState("flash"),[v,C]=b.useState(null),[T,I]=b.useState(!1),[E,P]=b.useState(!1),[k,j]=b.useState({tokensUsed:0,tokensAvailable:5e5,pcUsed:0,pcAvailable:1e3,gasEnabled:!1,gasRate:.03}),D=b.useRef(null);b.useEffect(()=>{const $=()=>{const K=Hz(),Y=!!localStorage.getItem("GAS_URL");P(K||Y)};return $(),window.addEventListener("panda:ready",$),()=>window.removeEventListener("panda:ready",$)},[]),b.useEffect(()=>{r&&!localStorage.getItem("pf_chat_welcomed")&&localStorage.setItem("pf_chat_welcomed","true")},[r]),b.useEffect(()=>{if(i||r)return;const $=new Date().getHours(),K=[$<12?" Good morning! I'm here if you need me.":$<18?" Good afternoon! Any questions, just ask.":" Good evening! Need any help?","Hi! Want to explore something new?"," Tip: try opening the Store!"," I'm here if you need me!"],Y=K[Math.floor(Math.random()*K.length)],U=setTimeout(()=>{u(Y),c(!0)},2e3),J=setTimeout(()=>{c(!1)},8e3);return()=>{clearTimeout(U),clearTimeout(J)}},[i,r]),b.useEffect(()=>{const $=()=>o(K=>!K);return window.addEventListener("panda:chat-toggle-internal",$),()=>window.removeEventListener("panda:chat-toggle-internal",$)},[]),b.useEffect(()=>{var $;($=D.current)==null||$.scrollIntoView({behavior:"smooth"})},[h]);const R=async()=>{if(!f.trim()||m)return;const $={role:"user",content:f};p(J=>[...J,$]);const K=f;g(""),x(!0);const Y=L_e(K),U=n?`[System Context]
${n}

[User Message]
${Y}`:Y;try{let J;v?J=await dR(v,{topic:U,task:U,concept:U,objective:U,message:U}):J=await dR("chat",{message:U,options:{model:y,gem:null}});const te=cR.find(Ee=>Ee.id===y),ee=v?yc.find(Ee=>Ee.id===v):null,ae=ee?`[${ee.icon} ${ee.name}]`:`[${te==null?void 0:te.icon} ${te==null?void 0:te.name}]`;(J.tokens||J.cost)&&j(Ee=>({...Ee,tokensUsed:Ee.tokensUsed+(J.tokens||0),pcUsed:Ee.pcUsed+(J.cost||0)}));const ce=J.cost?` (${J.cost.toFixed(2)} PC)`:"",he=J.text||J.response;p(Ee=>[...Ee,{role:"assistant",content:`> ${ae}${ce}

${he}`,model:y,gem:v}]),t&&e(K,he)}catch(J){console.error("Chat error:",J),p(te=>[...te,{role:"assistant",content:`> ERROR: ${J.message||"Connection failed. Please try again."}`}])}finally{x(!1)}},A=$=>{$.key==="Enter"&&!$.shiftKey&&($.preventDefault(),R())},N=$=>{C($),I(!1)},B=()=>{C(null),I(!1)};return a.jsxs(a.Fragment,{children:[l&&!r&&a.jsxs("div",{className:"pf-chat-trail-bubble",onClick:()=>{c(!1),o(!0)},children:[d,a.jsx("div",{className:"pf-trail-arrow"})]}),a.jsx("button",{className:`pf-chat-fab ${r?"active":""}`,onClick:()=>{o(!r),c(!1)},title:"PANDA AI CHAT",children:r?"":a.jsx("img",{src:"./panda-icon.png",alt:"Chat",className:"pf-chat-fab-logo"})}),r&&a.jsxs("div",{className:"pf-chat-panel",children:[a.jsxs("div",{className:"pf-chat-header",children:[a.jsx("img",{src:"./panda-chat-logo.png",alt:"Panda",className:"pf-chat-header-logo"}),a.jsx("span",{className:"pf-chat-title",children:"PANDA AI"}),a.jsxs("div",{className:"pf-session-stats",title:`
 SESSION

 PC Used: ${k.pcUsed.toFixed(2)} PC
 PC Available: ${k.pcAvailable.toFixed(0)} PC

 Tokens Used: ${k.tokensUsed.toLocaleString()}
 Free Tokens: ${k.tokensAvailable.toLocaleString()}

 Gas: ${k.gasEnabled?`ACTIVE (${(k.gasRate*100).toFixed(0)}%)`:"DISABLED"}
            `.trim(),children:[a.jsxs("span",{className:"pf-stats-pc",children:[k.pcUsed.toFixed(1)," PC"]}),a.jsxs("span",{className:`pf-stats-gas ${k.gasEnabled?"active":"inactive"}`,children:[" ",k.gasEnabled?"ON":"OFF"]})]}),a.jsx("span",{className:`pf-api-status ${E?"ready":"offline"}`,children:E?"":""}),a.jsxs("span",{className:"pf-brain-indicator",title:` Founder Brain: ${s} insights${t?" (evolving)":" (read-only)"}`,children:[" ",s]}),a.jsx("button",{className:"pf-chat-gems-toggle",onClick:()=>I(!T),title:"GEMs - SPECIALISTS",children:v?(L=yc.find($=>$.id===v))==null?void 0:L.icon:""})]}),T&&a.jsxs("div",{className:"pf-chat-gems-panel",children:[a.jsxs("div",{className:"pf-chat-gems-header",children:[a.jsx("span",{children:" GEMs - SPECIALISTS"}),v&&a.jsx("button",{className:"pf-gem-clear",onClick:B,children:" Clear"})]}),a.jsx("div",{className:"pf-chat-gems-grid",children:yc.map($=>a.jsxs("button",{className:`pf-chat-gem ${v===$.id?"active":""}`,onClick:()=>N($.id),title:$.description,children:[a.jsx("span",{className:"pf-gem-icon",children:$.icon}),a.jsx("span",{className:"pf-gem-name",children:$.name})]},$.id))})]}),a.jsx("div",{className:"pf-chat-models",children:cR.map($=>a.jsxs("button",{className:`pf-chat-model ${y===$.id?"active":""} ${$.free?"":"premium"}`,onClick:()=>S($.id),title:`${$.name}: ${$.description}`,children:[a.jsx("span",{className:"pf-model-icon",children:$.icon}),a.jsx("span",{className:"pf-model-name",children:$.name})]},$.id))}),v&&a.jsx("div",{className:"pf-chat-gem-active",children:a.jsxs("span",{className:"pf-gem-badge",children:[(O=yc.find($=>$.id===v))==null?void 0:O.icon," ",(F=yc.find($=>$.id===v))==null?void 0:F.name," active"]})}),a.jsxs("div",{className:"pf-chat-messages",children:[h.map(($,K)=>a.jsx("div",{className:`pf-chat-message ${$.role}`,children:$.content},K)),m&&a.jsx("div",{className:"pf-chat-message assistant loading",children:a.jsx("span",{className:"pf-typing",children:""})}),a.jsx("div",{ref:D})]}),a.jsxs("div",{className:"pf-chat-input-wrapper",children:[a.jsx("textarea",{className:"pf-chat-input",value:f,onChange:$=>g($.target.value),onKeyPress:A,placeholder:v?`Ask ${(W=yc.find($=>$.id===v))==null?void 0:W.name}...`:"Type your message...",rows:1}),a.jsx("button",{className:"pf-chat-send",onClick:R,disabled:m||!f.trim(),children:""})]})]})]})}const uR="/panda-icon.png",hR=[{id:"purple",color:"#667eea",name:"Panda Purple"},{id:"green",color:"#10b981",name:"Success Green"},{id:"orange",color:"#f59e0b",name:"Warning Orange"},{id:"red",color:"#ef4444",name:"Danger Red"},{id:"violet",color:"#8b5cf6",name:"Violet"},{id:"pink",color:"#ec4899",name:"Pink"}],X_e=[{id:"flash",name:" Gemini 2.0 Flash",desc:"Rpido e eficiente"},{id:"pro",name:" Gemini 2.0 Pro",desc:"Raciocnio avanado"},{id:"image",name:" Gemini Imagen",desc:"Gerao de imagens"},{id:"video",name:" Gemini Veo",desc:"Gerao de vdeos"}];function pR({isOpen:n,onClose:e,embedded:t=!1}){var L;const[s,i]=b.useState("profile"),r=(()=>{try{const O=JSON.parse(localStorage.getItem("panda_user"));return{displayName:(O==null?void 0:O.displayName)||"CONVIDADO",email:(O==null?void 0:O.email)||"",userType:(O==null?void 0:O.userType)||"user"}}catch{return{displayName:"CONVIDADO",email:"",userType:"user"}}})(),[o,l]=b.useState(()=>localStorage.getItem("panda_theme")!=="light"),[c,d]=b.useState(()=>localStorage.getItem("panda_accent_color")||"#667eea"),[u,h]=b.useState(()=>localStorage.getItem("panda_ai_model")||"flash"),[p,f]=b.useState(()=>{const O=localStorage.getItem("panda_notifications");return O!==null?JSON.parse(O):{email:!0,push:!1,sounds:!0,updates:!0}}),[g,m]=b.useState(()=>localStorage.getItem("pandaMining")==="true"),[x,y]=b.useState(()=>localStorage.getItem("pandaGpuMining")==="true"),[S,v]=b.useState(()=>parseInt(localStorage.getItem("pandaCpuLimit")||"50"));if(b.useEffect(()=>{document.body.classList.toggle("light-mode",!o),localStorage.setItem("panda_theme",o?"dark":"light")},[o]),b.useEffect(()=>{const O=F=>{F.key==="panda_theme"&&l(F.newValue!=="light")};return window.addEventListener("storage",O),()=>window.removeEventListener("storage",O)},[]),b.useEffect(()=>{document.documentElement.style.setProperty("--accent-color",c)},[c]),!t&&!n)return null;const C=[{id:"profile",icon:"",label:"Profile"},{id:"appearance",icon:"",label:"Appearance"},{id:"notifications",icon:"",label:"Notifications"},{id:"ai",icon:"",label:"AI Settings"},{id:"wallet",icon:"",label:"Wallet"},{id:"mining",icon:"",label:"Mining"},{id:"security",icon:"",label:"Security"},{id:"integrations",icon:"",label:"Integrations"},{id:"about",icon:"",label:"About"}],T=()=>{const O=!o;l(O),localStorage.setItem("panda_theme",O?"dark":"light")},I=O=>{d(O),localStorage.setItem("panda_accent_color",O)},E=O=>{h(O),localStorage.setItem("panda_ai_model",O)},P=O=>{const F={...p,[O]:!p[O]};f(F),localStorage.setItem("panda_notifications",JSON.stringify(F))},k=()=>{const O=!g;m(O),localStorage.setItem("pandaMining",O)},j=()=>{const O=!x;y(O),localStorage.setItem("pandaGpuMining",O)},D=O=>{const F=parseInt(O);v(F),localStorage.setItem("pandaCpuLimit",F)},R=(()=>{if(!g)return 0;const O=Math.round(30*(S/25)),F=x?Math.round(O*.8):0;return O+F})(),A=parseInt(localStorage.getItem("pandaMiningTotal")||"0"),N=a.jsxs("div",{className:"pf-settings-sidebar",children:[a.jsxs("div",{className:"pf-settings-user",children:[a.jsx("div",{className:"pf-settings-avatar",children:a.jsx("img",{src:uR,alt:"Panda",style:{width:"32px",height:"32px",borderRadius:"50%"}})}),a.jsxs("div",{className:"pf-settings-user-info",children:[a.jsx("h4",{children:r.displayName}),a.jsx("span",{children:r.userType})]})]}),C.map(O=>a.jsxs("div",{className:`pf-settings-nav-item ${s===O.id?"active":""}`,onClick:()=>i(O.id),children:[a.jsx("span",{children:O.icon}),O.label]},O.id))]}),B=a.jsxs("div",{className:"pf-settings-content",children:[!t&&a.jsx("button",{className:"pf-settings-close",onClick:e,children:""}),s==="profile"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Profile"}),a.jsx("p",{children:"Manage your account information"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Username"}),a.jsx("div",{className:"pf-settings-sublabel",children:r.displayName.toLowerCase().replace(/\s+/g,".")})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Edit"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Email"}),a.jsx("div",{className:"pf-settings-sublabel",children:r.email})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Edit"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Role"}),a.jsx("div",{className:"pf-settings-sublabel",children:r.userType})]}),a.jsx("span",{className:"pf-status-badge online",children:"Active"})]})]})]}),s==="appearance"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Appearance"}),a.jsx("p",{children:"Personalize o visual da sua instncia (White-Label)"}),a.jsx("div",{className:"pf-settings-card",children:a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Dark Mode"}),a.jsx("div",{className:"pf-settings-sublabel",children:o?"Tema escuro ativo":"Tema claro ativo"})]}),a.jsx("div",{className:`pf-toggle ${o?"active":""}`,onClick:T})]})}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:"Cor de Destaque"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Cor principal usada em botes, links e elementos de destaque"}),a.jsx("div",{className:"pf-color-picker",children:hR.map(O=>a.jsx("div",{className:`pf-color-dot ${c===O.color?"active":""}`,style:{background:O.color},onClick:()=>I(O.color),title:O.name},O.id))}),a.jsxs("div",{className:"pf-settings-sublabel",style:{marginTop:"8px",fontSize:"11px",opacity:.6},children:["Selecionada: ",((L=hR.find(O=>O.color===c))==null?void 0:L.name)||c]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:" Logo Personalizado"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Substitua o logo padro por um personalizado (canvas welcome, header)"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginTop:"12px"},children:[a.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"12px",background:o?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.05)",display:"flex",alignItems:"center",justifyContent:"center",border:"2px dashed "+(o?"rgba(255,255,255,0.15)":"rgba(0,0,0,0.15)")},children:a.jsx("img",{src:localStorage.getItem("panda_custom_logo")||"/panda-icon.png",alt:"Logo",style:{width:"48px",height:"48px",borderRadius:"8px",objectFit:"contain"}})}),a.jsxs("div",{style:{flex:1},children:[a.jsx("input",{type:"text",placeholder:"URL do logo (ex: https://...)",defaultValue:localStorage.getItem("panda_custom_logo")||"",onChange:O=>{const F=O.target.value.trim();F?localStorage.setItem("panda_custom_logo",F):localStorage.removeItem("panda_custom_logo")},className:"pf-wl-input",style:{width:"100%",padding:"8px 12px",borderRadius:"8px",border:o?"1px solid rgba(255,255,255,0.15)":"1px solid rgba(0,0,0,0.15)",background:o?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.03)",color:o?"#e0e0e0":"#333",fontSize:"13px",outline:"none"}}),a.jsx("div",{style:{marginTop:"6px",fontSize:"11px",opacity:.5},children:"Cole a URL de uma imagem ou faa upload abaixo"})]})]}),a.jsxs("div",{style:{marginTop:"12px",display:"flex",gap:"8px"},children:[a.jsxs("label",{className:"pf-btn-primary",style:{padding:"6px 14px",borderRadius:"6px",fontSize:"12px",cursor:"pointer",fontWeight:600,display:"inline-flex",alignItems:"center",gap:"6px"},children:[" Upload Arquivo",a.jsx("input",{type:"file",accept:"image/*",style:{display:"none"},onChange:O=>{const F=O.target.files[0];if(F&&F.size<5e5){const W=new FileReader;W.onload=$=>{localStorage.setItem("panda_custom_logo",$.target.result),window.location.reload()},W.readAsDataURL(F)}else F&&alert("Arquivo muito grande. Mximo: 500KB")}})]}),a.jsx("button",{className:"pf-btn-secondary",onClick:()=>{localStorage.removeItem("panda_custom_logo"),window.location.reload()},style:{fontSize:"12px"},children:"Restaurar Padro"})]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:" Nome da Instncia"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Nome exibido no header e welcome (white-label)"}),a.jsx("input",{type:"text",placeholder:"Panda Fabrics",defaultValue:localStorage.getItem("panda_custom_name")||"",onChange:O=>{const F=O.target.value.trim();F?localStorage.setItem("panda_custom_name",F):localStorage.removeItem("panda_custom_name")},className:"pf-wl-input",style:{width:"100%",padding:"8px 12px",marginTop:"10px",borderRadius:"8px",border:o?"1px solid rgba(255,255,255,0.15)":"1px solid rgba(0,0,0,0.15)",background:o?"rgba(255,255,255,0.05)":"rgba(0,0,0,0.03)",color:o?"#e0e0e0":"#333",fontSize:"13px",outline:"none"}})]}),a.jsxs("div",{className:"pf-settings-info",style:{fontSize:"12px",marginTop:"8px"},children:[" ",a.jsx("strong",{children:"White-Label para devs:"})," personalize cores, logo e nome. Configs persistem em"," ",a.jsx("code",{children:"localStorage"})," (panda_accent_color, panda_custom_logo, panda_custom_name)."]})]}),s==="notifications"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Notifications"}),a.jsx("p",{children:"Configure suas preferncias de notificao"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Notificaes por Email"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Receber updates por email"})]}),a.jsx("div",{className:`pf-toggle ${p.email?"active":""}`,onClick:()=>P("email")})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Push Notifications"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Alertas no navegador"})]}),a.jsx("div",{className:`pf-toggle ${p.push?"active":""}`,onClick:()=>P("push")})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Sons"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Sons de notificao"})]}),a.jsx("div",{className:`pf-toggle ${p.sounds?"active":""}`,onClick:()=>P("sounds")})]})]})]}),s==="ai"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" AI Settings"}),a.jsx("p",{children:"Configure o Google Gemini"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:"Modelo Padro"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Powered by Google Gemini"}),a.jsx("div",{className:"pf-model-grid",children:X_e.map(O=>a.jsxs("div",{className:`pf-model-card ${u===O.id?"active":""}`,onClick:()=>E(O.id),children:[a.jsx("div",{className:"pf-model-name",children:O.name}),a.jsx("div",{className:"pf-model-desc",children:O.desc})]},O.id))})]}),a.jsx("div",{className:"pf-settings-card",children:a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Auto-sugestes"}),a.jsx("div",{className:"pf-settings-sublabel",children:"IA ajuda enquanto voc trabalha"})]}),a.jsx("div",{className:"pf-toggle active"})]})})]}),s==="wallet"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Wallet"}),a.jsx("p",{children:"Gerencie seus Panda Coins"}),a.jsxs("div",{className:"pf-settings-card pf-wallet-hero",children:[a.jsxs("div",{className:"pf-wallet-balance",children:[a.jsx("div",{className:"pf-wallet-icon",children:a.jsx("img",{src:"/panda-icon.png",alt:"Panda",style:{width:"24px",height:"24px"}})}),a.jsx("div",{className:"pf-wallet-amount",children:"500 PC"}),a.jsx("div",{className:"pf-wallet-usd",children:" R$ 5,00 BRL"})]}),a.jsxs("div",{className:"pf-wallet-actions",children:[a.jsx("button",{className:"pf-btn-primary",children:" Comprar PC"}),a.jsx("button",{className:"pf-btn-secondary",children:" Transferir"})]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Plano Atual"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Founder Edition (Lifetime)"})]}),a.jsx("span",{className:"pf-status-badge online",children:"Ativo"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Crditos Mensais"}),a.jsx("div",{className:"pf-settings-sublabel",children:"100 PC grtis/ms"})]}),a.jsx("span",{className:"pf-status-badge online",children:"Disponvel"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:" Mining Earned"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Total ganho via Partner Mode"})]}),a.jsxs("span",{className:"pf-status-badge",style:{background:g?"rgba(16,185,129,0.15)":"rgba(255,255,255,0.05)",color:g?"#10b981":"#888"},children:[A," PC ",g?"":"(OFF)"]})]})]})]}),s==="mining"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Partner Mode (Mining)"}),a.jsx("p",{children:"Ganhe Panda Coins usando recursos ociosos do seu computador"}),a.jsx("div",{className:"pf-settings-card",style:{background:"rgba(102,126,234,0.06)",border:"1px solid rgba(102,126,234,0.2)",borderRadius:"12px"},children:a.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"flex-start"},children:[a.jsx("span",{style:{fontSize:"22px"},children:""}),a.jsxs("div",{style:{lineHeight:"1.6",fontSize:"13px"},children:[a.jsx("div",{style:{fontWeight:700,marginBottom:"4px",color:"var(--accent-color, #667eea)"},children:"Como funciona o Partner Mode"}),a.jsxs("div",{className:"pf-settings-sublabel",style:{lineHeight:"1.6"},children:["Quando ativado, o Panda Factory utiliza CPU/GPU ociosa do seu computador para minerar criptomoeda de forma nativa (via Rust Agent). Voc recebe ",a.jsx("strong",{children:"60%"})," do valor minerado convertido em Panda Coins  os outros 40% cobrem impostos, converso e infraestrutura.",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Padro:"})," Sempre desligado. ",a.jsx("strong",{children:"Opt-in"}),"  voc ativa manualmente.",a.jsx("br",{}),a.jsx("strong",{children:"Controle total:"})," Desative a qualquer momento aqui no Settings.",a.jsx("br",{}),a.jsx("strong",{children:"Sem surpresas:"})," Consumo energtico pode aumentar levemente com GPU ativada."]})]})]})}),!g&&a.jsxs("div",{className:"pf-settings-card",style:{background:"rgba(245,158,11,0.06)",border:"1px solid rgba(245,158,11,0.2)",borderRadius:"12px",textAlign:"center",padding:"24px 20px"},children:[a.jsx("div",{style:{fontSize:"32px",marginBottom:"8px"},children:""}),a.jsx("div",{style:{fontWeight:700,fontSize:"15px",color:"#f59e0b",marginBottom:"6px"},children:"Minerao Desligada"}),a.jsx("div",{className:"pf-settings-sublabel",style:{lineHeight:"1.6",maxWidth:"420px",margin:"0 auto",fontSize:"13px"},children:"Ligue o Partner Mode e ganhe Panda Coins automaticamente enquanto seu computador est ocioso. Sem custos extras, desative quando quiser."})]}),a.jsx("div",{className:"pf-settings-card",children:a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:" Ativar Partner Mode"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Minerao passiva com recursos ociosos (opt-in, desligado por padro)"})]}),a.jsx("div",{className:`pf-toggle ${g?"active":""}`,onClick:k})]})}),a.jsxs("div",{className:"pf-settings-card",style:{opacity:g?1:.45,pointerEvents:g?"auto":"none"},children:[a.jsx("div",{className:"pf-settings-label",children:"Limites de Recursos"}),a.jsx("div",{className:"pf-settings-sublabel",style:{marginBottom:"12px"},children:"Controle quanto do seu hardware  utilizado"}),a.jsx("div",{className:"pf-settings-row",children:a.jsxs("div",{style:{flex:1},children:[a.jsxs("div",{className:"pf-settings-label",children:["Limite CPU: ",S,"%"]}),a.jsx("input",{type:"range",min:"25",max:"75",step:"5",value:S,onChange:O=>D(O.target.value),style:{width:"100%",marginTop:"8px",accentColor:"#f59e0b"}}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"11px",opacity:.5,marginTop:"4px"},children:[a.jsx("span",{children:"25% (Baixo)"}),a.jsx("span",{children:"50% (Equilibrado)"}),a.jsx("span",{children:"75% (Alto)"})]})]})}),a.jsxs("div",{className:"pf-settings-row",style:{marginTop:"8px"},children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:" Minerao GPU"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Ativar GPU para ganhos maiores"})]}),a.jsx("div",{className:`pf-toggle ${x?"active":""}`,onClick:j})]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",style:{marginBottom:"8px"},children:" Estatsticas de Minerao"}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Status"})}),a.jsx("span",{className:`pf-status-badge ${g?"online":"offline"}`,children:g?` Minerando${x?" (CPU+GPU)":" (CPU)"}`:" Inativo"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Perfil de Hardware"})}),a.jsx("span",{style:{fontWeight:600,fontSize:"12px",color:x?"#10b981":"#f59e0b"},children:x?S>=75?" Forest":S>=50?" Tree":" Sprout":S>=50?" Sprout":" Seed"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Hashrate Estimado"})}),a.jsx("span",{style:{fontWeight:600,fontFamily:"monospace",fontSize:"13px"},children:g?`~${x?S>=75?"4.2":"2.8":S>=50?"1.1":"0.6"} KH/s`:" KH/s"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Ganho Estimado"})}),a.jsxs("span",{style:{fontWeight:600,color:"#f59e0b"},children:["~",R," PC/dia"]})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Estimativa Mensal"})}),a.jsxs("span",{style:{fontWeight:600,color:"#10b981"},children:["~",R*30," PC/ms"]})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Total Acumulado"})}),a.jsxs("span",{style:{fontWeight:600},children:[A," PC"]})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Ciclo de Pagamento"})}),a.jsx("span",{style:{fontWeight:500,fontSize:"12px"},children:"End-of-Day (23:59 UTC)"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{children:a.jsx("div",{className:"pf-settings-label",children:"Uptime Hoje"})}),a.jsx("span",{style:{fontWeight:500,fontSize:"12px"},children:g?"0h 0m (recm ativado)":""})]})]}),a.jsxs("div",{className:"pf-settings-info",style:{fontSize:"11px",marginTop:"4px",opacity:.6},children:[" Fator de converso: x0.60 flat (60% User / 40% Panda). Vlido para todos os tiers. Execuo real requer ",a.jsx("strong",{children:"Rust Agent"})," (binrio nativo)  a interface web  apenas o painel de controle."]})]}),s==="security"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Security"}),a.jsx("p",{children:"Configuraes de segurana da conta"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Autenticao 2FA"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Proteo extra com Google Auth"})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Configurar"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Sesses Ativas"}),a.jsx("div",{className:"pf-settings-sublabel",children:"1 dispositivo conectado"})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Ver"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:"Alterar Senha"}),a.jsx("div",{className:"pf-settings-sublabel",children:"ltima alterao: nunca"})]}),a.jsx("button",{className:"pf-btn-secondary",children:"Alterar"})]})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:" Panda Defend"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Sistema de proteo ativo"}),a.jsx("div",{className:"pf-defend-status",children:a.jsx("span",{className:"pf-status-badge online",children:"11 Regras Ativas"})})]})]}),s==="integrations"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" Integrations"}),a.jsx("p",{children:"Conexes MCP (Model Context Protocol)"}),a.jsx("div",{className:"pf-settings-card",children:a.jsxs("div",{className:"pf-settings-row",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pf-settings-label",children:" MCP Server"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Conexo com ferramentas externas"})]}),a.jsx("span",{className:"pf-status-badge offline",children:"Desconectado"})]})}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-settings-label",children:"Servios Conectados"}),a.jsxs("div",{className:"pf-integration-list",children:[a.jsxs("div",{className:"pf-integration-item",children:[a.jsx("span",{children:" Google Sheets"}),a.jsx("span",{className:"pf-status-badge offline",children:""})]}),a.jsxs("div",{className:"pf-integration-item",children:[a.jsx("span",{children:" Google Drive"}),a.jsx("span",{className:"pf-status-badge offline",children:""})]}),a.jsxs("div",{className:"pf-integration-item",children:[a.jsx("span",{children:" Google Calendar"}),a.jsx("span",{className:"pf-status-badge offline",children:""})]})]})]}),a.jsx("div",{className:"pf-settings-info",children:" Sistema usa MCP (sem RAG). IA powered by Gemini only."})]}),s==="about"&&a.jsxs("div",{className:"pf-settings-section",children:[a.jsx("h2",{children:" About"}),a.jsx("p",{children:"Panda Fabrics Information"}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsx("div",{className:"pf-about-logo",children:a.jsx("img",{src:uR,alt:"Panda Fabrics",style:{width:"80px",height:"80px"}})}),a.jsx("div",{className:"pf-about-title",children:"Panda Fabrics"}),a.jsx("div",{className:"pf-about-version",children:"v6.2 Founder Edition"})]}),a.jsxs("div",{className:"pf-settings-card",children:[a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{className:"pf-settings-label",children:"Canvas Engine"}),a.jsx("div",{className:"pf-settings-sublabel",children:"TLDraw v2.x"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{className:"pf-settings-label",children:"AI Engine"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Google Gemini"})]}),a.jsxs("div",{className:"pf-settings-row",children:[a.jsx("div",{className:"pf-settings-label",children:"License"}),a.jsx("div",{className:"pf-settings-sublabel",children:"Founder Lifetime"})]})]})]})]});return t?a.jsxs("div",{className:"pf-settings-modal",style:{position:"relative",width:"100%",height:"100%"},children:[N,B]}):a.jsx("div",{className:"pf-settings-overlay",onClick:e,children:a.jsxs("div",{className:"pf-settings-modal",onClick:O=>O.stopPropagation(),children:[N,B]})})}function q_e({isOpen:n,onClose:e,onToolSelect:t}){const[s,i]=b.useState("select"),[r,o]=b.useState(!0),l=()=>{o(!r),window.PandaCanvas&&window.PandaCanvas.toggleGrid()},c=[{id:"select",icon:"",label:"Selecionar"},{id:"hand",icon:"",label:"Mover Canvas"},{id:"draw",icon:"",label:"Desenho Livre"},{id:"eraser",icon:"",label:"Borracha"},{id:"arrow",icon:"",label:"Seta"},{id:"line",icon:"",label:"Linha"},{id:"rectangle",icon:"",label:"Retngulo"},{id:"ellipse",icon:"",label:"Crculo"},{id:"triangle",icon:"",label:"Tringulo"},{id:"text",icon:"",label:"Texto"},{id:"note",icon:"",label:"Nota Adesiva"},{id:"frame",icon:"",label:"Frame"},{id:"image",icon:"",label:"Imagem"}],d=u=>{i(u);const h=window.TLDrawEditor;if(!h){console.warn(" TLDraw editor not ready  click the CANVAS tab first");return}try{const p={rectangle:"rectangle",ellipse:"ellipse",triangle:"triangle"};if(p[u]){h.setCurrentTool("geo");try{h.setStyleForNextShapes(mi,p[u])}catch(f){console.warn("Geo style set error:",f.message)}}else if(u==="image"){const f=document.createElement("input");f.type="file",f.accept="image/*",f.onchange=async g=>{var x;const m=(x=g.target.files)==null?void 0:x[0];if(m){const y=new FileReader;y.onload=async()=>{const S=y.result,v=`asset:${Date.now()}`,C=new Image;C.src=S,C.onload=()=>{try{h.createAssets([{id:v,type:"image",typeName:"asset",props:{src:S,name:m.name,w:C.width,h:C.height,mimeType:m.type,isAnimated:!1}}]);const T=h.getViewportScreenCenter();h.createShape({type:"image",x:T.x-C.width/4,y:T.y-C.height/4,props:{assetId:v,w:C.width/2,h:C.height/2}})}catch(T){console.warn("Image create error:",T)}}},y.readAsDataURL(m)}},f.click()}else h.setCurrentTool(u)}catch(p){console.warn("Tool switch error:",p.message)}t&&t(u)};return n?a.jsxs("div",{className:"pf-right-toolbar",children:[a.jsxs("div",{className:"pf-toolbar-header",children:[a.jsx("span",{children:" Ferramentas"}),a.jsx("button",{className:"pf-toolbar-close",onClick:e,children:""})]}),a.jsx("div",{className:"pf-toolbar-tabs",children:a.jsx("button",{className:"pf-toolbar-tab active",children:" Desenho"})}),a.jsxs("div",{className:"pf-toolbar-section",children:[a.jsx("div",{className:"pf-toolbar-grid",children:c.map(u=>a.jsxs("button",{className:`pf-toolbar-item ${s===u.id?"active":""}`,onClick:()=>d(u.id),title:u.label,children:[a.jsx("span",{className:"pf-toolbar-icon",children:u.icon}),a.jsx("span",{className:"pf-toolbar-label",children:u.label})]},u.id))}),a.jsx("div",{className:"pf-toolbar-divider",children:a.jsx("span",{children:"Opes do Canvas"})}),a.jsx("div",{className:"pf-toolbar-options",children:a.jsxs("button",{className:`pf-toolbar-option ${r?"active":""}`,onClick:l,title:"Mostrar/Ocultar Grid",children:[a.jsx("span",{className:"pf-toolbar-icon",children:""}),a.jsx("span",{className:"pf-toolbar-label",children:"Grid"}),a.jsx("span",{className:`pf-toggle-mini ${r?"on":""}`})]})})]})]}):null}const Z_e=[{id:"n1",type:"system",icon:"",title:"WELCOME TO PANDA FABRICS",message:"Your workspace is ready. Explore the catalog!",time:new Date(Date.now()-1e3*60*2),read:!1},{id:"n2",type:"store",icon:"",title:"STORE UPDATED",message:"9 extensions available  including Instagram, Google Ads and more",time:new Date(Date.now()-1e3*60*15),read:!1},{id:"n3",type:"ai",icon:"",title:"BRAIN READY",message:"Panda Brain connected via MCP. Say 'hello' in the chat!",time:new Date(Date.now()-1e3*60*60),read:!0},{id:"n4",type:"security",icon:"",title:"PANDA DEFEND ACTIVE",message:"14 Semgrep rules monitoring. System secure.",time:new Date(Date.now()-1e3*60*60*2),read:!0}];function J_e(n){const t=Math.floor((new Date-n)/1e3);return t<60?"NOW":t<3600?`${Math.floor(t/60)}M AGO`:t<86400?`${Math.floor(t/3600)}H AGO`:`${Math.floor(t/86400)}D AGO`}function Q_e({isOpen:n,onClose:e}){const[t,s]=b.useState(Z_e),i=t.filter(c=>!c.read).length,r=()=>{s(c=>c.map(d=>({...d,read:!0})))},o=c=>{s(d=>d.map(u=>u.id===c?{...u,read:!0}:u))},l=()=>{s([])};return n?a.jsx("div",{className:"pf-notifications-overlay",onClick:e,children:a.jsxs("div",{className:"pf-notifications-panel",onClick:c=>c.stopPropagation(),children:[a.jsxs("div",{className:"pf-notifications-header",children:[a.jsxs("h3",{children:[" NOTIFICATIONS",i>0&&a.jsx("span",{className:"notif-badge",children:i})]}),a.jsxs("div",{className:"notif-actions",children:[i>0&&a.jsx("button",{className:"notif-btn",onClick:r,children:" READ ALL"}),t.length>0&&a.jsx("button",{className:"notif-btn",onClick:l,children:" CLEAR"}),a.jsx("button",{className:"notif-close",onClick:e,children:""})]})]}),a.jsx("div",{className:"pf-notifications-list",children:t.length===0?a.jsxs("div",{className:"notif-empty",children:[a.jsx("span",{style:{fontSize:32},children:""}),a.jsx("p",{children:"NO NOTIFICATIONS"})]}):t.map(c=>a.jsxs("div",{className:`notif-item ${c.read?"read":"unread"}`,onClick:()=>o(c.id),children:[a.jsx("span",{className:"notif-icon",children:c.icon}),a.jsxs("div",{className:"notif-content",children:[a.jsx("div",{className:"notif-title",children:c.title}),a.jsx("div",{className:"notif-message",children:c.message})]}),a.jsx("span",{className:"notif-time",children:J_e(c.time)})]},c.id))}),a.jsx("div",{className:"pf-notifications-footer",children:a.jsx("span",{children:" MEDUSA EVENT BUS"})})]})}):null}const gv=n=>{let e=0;for(let t=0;t<n.length;t++){const s=n.charCodeAt(t);e=(e<<5)-e+s,e=e&e}return e.toString(16)},fR=[{user:gv("user@panda.com"),pass:gv("user"),profile:{uid:"user-demo",email:"user@panda.com",displayName:"Demo User",userType:"user",sdkAccess:!1,authMethod:"logingate"}}],eCe=["L1: Firebase","L2: Hotmart","L3: Gemini AI","L4: Panda SDK","Ed25519","MCP"],tCe="v9.0  4th Layer Edition";function nCe({children:n}){const{t:e,locale:t,setLocale:s}=hT(),i=Yx(),[r,o]=b.useState(!1),[l,c]=b.useState(""),[d,u]=b.useState(""),[h,p]=b.useState(""),[f,g]=b.useState(!0),[m,x]=b.useState(!1),[y,S]=b.useState(!1);b.useEffect(()=>{if(i.isAuthenticated){o(!0),g(!1);return}const T=sessionStorage.getItem("panda_auth");if(fR.some(E=>T===`${E.user}-${E.pass}`)){o(!0),g(!1);return}g(i.isLoading)},[i.isAuthenticated,i.isLoading]);const v=async T=>{T.preventDefault(),p(""),x(!0),await new Promise(k=>setTimeout(k,400));const I=gv(l.toLowerCase().trim()),E=gv(d),P=fR.find(k=>k.user===I&&k.pass===E);P?(sessionStorage.setItem("panda_auth",`${P.user}-${P.pass}`),await i.loginWithGate(P.profile),o(!0)):p(e("login.invalidCredentials")),x(!1)},C=async()=>{S(!0),p("");try{await i.loginWithGoogle()}catch(T){p(i.error||T.message||"Google login failed")}finally{S(!1)}};return f?a.jsxs("div",{className:"login-gate-loading",children:[a.jsx("div",{className:"login-spinner",children:a.jsx("img",{src:"/panda-icon.png",alt:"Panda",style:{width:"48px",height:"48px"}})}),a.jsx("p",{children:e("login.loading")})]}):r?a.jsx(a.Fragment,{children:n}):a.jsxs("div",{className:"login-gate",children:[a.jsx("div",{className:"login-lang-selector",children:Object.entries(km).map(([T,I])=>a.jsxs("button",{className:`login-lang-btn${t===T?" active":""}`,onClick:()=>s(T),title:I.name,children:[a.jsx("span",{className:"login-lang-flag",children:I.flag}),a.jsx("span",{className:"login-lang-label",children:I.label})]},T))}),a.jsx("div",{className:"login-bg-orb login-bg-orb-1"}),a.jsx("div",{className:"login-bg-orb login-bg-orb-2"}),a.jsx("div",{className:"login-bg-orb login-bg-orb-3"}),a.jsxs("div",{className:"login-page",children:[a.jsx("div",{className:"login-hero",children:a.jsxs("div",{className:"login-hero-content",children:[a.jsx("div",{className:"login-logo",children:a.jsx("img",{src:"/panda-icon.png",alt:"Panda Factory"})}),a.jsx("h1",{className:"login-title",children:"Panda Factory"}),a.jsx("p",{className:"login-tagline",children:e("login.tagline")}),a.jsx("p",{className:"login-description",children:e("login.description")}),a.jsx("div",{className:"login-stats",children:e("login.stats").map((T,I)=>a.jsxs("div",{className:"login-stat",children:[a.jsx("span",{className:"login-stat-value",children:T.value}),a.jsx("span",{className:"login-stat-label",children:T.label})]},I))}),a.jsx("div",{className:"login-features",children:e("login.features").map((T,I)=>a.jsxs("div",{className:"login-feature-card",style:{animationDelay:`${.1+I*.1}s`},children:[a.jsx("span",{className:"login-feature-icon",children:T.icon}),a.jsxs("div",{children:[a.jsx("strong",{children:T.title}),a.jsx("span",{children:T.desc})]})]},I))}),a.jsx("div",{className:"login-tech-badges",children:eCe.map((T,I)=>a.jsx("span",{className:"login-tech-badge",children:T},I))}),a.jsx("div",{className:"login-version-badge",children:tCe})]})}),a.jsx("div",{className:"login-form-section",children:a.jsxs("div",{className:"login-form-container",children:[a.jsx("h2",{className:"login-form-title",children:e("login.welcomeBack")}),a.jsx("p",{className:"login-form-subtitle",children:e("login.signInSubtitle")}),a.jsxs("button",{className:"login-google-btn",onClick:C,disabled:y,title:e("login.signInGoogle"),children:[a.jsxs("svg",{className:"login-google-icon",viewBox:"0 0 24 24",width:"20",height:"20",children:[a.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),a.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),a.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),a.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),y?"Connecting...":e("login.signInGoogle")]}),a.jsx("div",{className:"login-divider",children:a.jsx("span",{children:e("login.or")})}),a.jsxs("form",{onSubmit:v,className:"login-form",children:[a.jsxs("div",{className:"login-field",children:[a.jsx("label",{htmlFor:"login-email",children:e("login.email")}),a.jsx("input",{id:"login-email",type:"email",value:l,onChange:T=>c(T.target.value),placeholder:"your@email.com",autoComplete:"email",required:!0,autoFocus:!0})]}),a.jsxs("div",{className:"login-field",children:[a.jsx("label",{htmlFor:"login-password",children:e("login.password")}),a.jsx("input",{id:"login-password",type:"password",value:d,onChange:T=>u(T.target.value),placeholder:"",autoComplete:"current-password",required:!0})]}),h&&a.jsx("div",{className:"login-error",children:h}),a.jsx("button",{type:"submit",className:"login-button",disabled:m,children:m?a.jsx("span",{className:"login-btn-loading",children:e("login.signingIn")}):e("login.signInEmail")}),a.jsx("p",{className:"login-free-hint",children:e("login.freeHint")})]}),a.jsx("button",{className:"login-forgot-btn",onClick:()=>alert("Password reset coming soon. For now, use the demo credentials below."),children:e("login.forgotPassword")}),a.jsxs("details",{className:"login-demo-details",children:[a.jsx("summary",{className:"login-demo-summary",children:a.jsx("span",{className:"login-demo-label",children:e("login.demoLabel")})}),a.jsxs("div",{className:"login-demo-content",children:[a.jsx("code",{children:"user@panda.com"})," / ",a.jsx("code",{children:"user"})]})]}),a.jsxs("div",{className:"login-form-footer",children:[a.jsx("span",{children:" 2026 Panda Factory"}),a.jsx("a",{href:"https://github.com/LucassVal/Panda-Factory",target:"_blank",rel:"noopener noreferrer",children:"GitHub"})]})]})})]})]})}const sCe=()=>{var t,s;const n=window.AgentTelemetry||((t=window.Panda)==null?void 0:t.Telemetry);if(!n)return null;const e=(s=n.getSummary)==null?void 0:s.call(n);return e!=null&&e.error?null:e},iCe=()=>({treasury:{pc:"1,234,567",pat:"500",usd:"$5,234.89",pending:"$0.00"},users:{total:"1,247",online:"89",newToday:"23",premium:"156",devs:"42"},usage:{apiCalls:"45,230",mcpCalls:"12,450",gpuHours:"2.1k"},errors:{last24h:3,open:1,critical:0},transactions:[{type:"purchase",amount:500,user:"user123",time:"2 min ago"},{type:"spend",amount:-50,user:"dev456",time:"5 min ago"},{type:"purchase",amount:1e3,user:"user789",time:"12 min ago"},{type:"refund",amount:100,user:"user321",time:"1 hour ago"},{type:"spend",amount:-200,user:"dev654",time:"2 hours ago"}]});function rCe(){const[n,e]=b.useState(null),[t,s]=b.useState(null),[i,r]=b.useState(!0),[o,l]=b.useState(null),c=b.useCallback(async()=>{try{r(!0);const f=sCe();s(f);const g=iCe();f&&(g.tentacles=f.tentacles,g.activities=f.activities,g.agentMetrics=f.metrics,f.errors&&(g.errors={last24h:f.errors.total,open:f.errors.unresolved,critical:0,list:f.errors.last3})),e(g),l(null)}catch(f){l(f.message),console.error("Failed to fetch founder metrics:",f)}finally{r(!1)}},[]);b.useEffect(()=>{var m;const f=x=>{s(y=>{var S,v;return y&&{...y,activities:{...y.activities,last5:[x,...((S=y.activities)==null?void 0:S.last5)||[]].slice(0,5),total:(((v=y.activities)==null?void 0:v.total)||0)+1}}})},g=x=>{s(y=>{var S,v,C;return y&&{...y,errors:{...y.errors,last3:[x,...((S=y.errors)==null?void 0:S.last3)||[]].slice(0,3),total:(((v=y.errors)==null?void 0:v.total)||0)+1,unresolved:(((C=y.errors)==null?void 0:C.unresolved)||0)+1}}})};return(m=window.Panda)!=null&&m.on&&(window.Panda.on("founder:activity",f),window.Panda.on("founder:error",g)),()=>{var x;(x=window.Panda)!=null&&x.off&&(window.Panda.off("founder:activity",f),window.Panda.off("founder:error",g))}},[]),b.useEffect(()=>{c();const f=setInterval(c,3e4);return()=>clearInterval(f)},[c]);const d=b.useCallback((f=10)=>{var m,x,y;const g=window.AgentTelemetry||((m=window.Panda)==null?void 0:m.Telemetry);return((x=g==null?void 0:g.getActivities)==null?void 0:x.call(g,f))||((y=t==null?void 0:t.activities)==null?void 0:y.last5)||[]},[t]),u=b.useCallback((f=10,g=!0)=>{var x,y;const m=window.AgentTelemetry||((x=window.Panda)==null?void 0:x.Telemetry);return((y=m==null?void 0:m.getErrors)==null?void 0:y.call(m,f,g))||[]},[]),h=b.useCallback(()=>{var g,m;const f=window.AgentTelemetry||((g=window.Panda)==null?void 0:g.Telemetry);return((m=f==null?void 0:f.getTentacleStatus)==null?void 0:m.call(f))||{}},[]),p=b.useCallback(f=>{var m,x;const g=window.AgentTelemetry||((m=window.Panda)==null?void 0:m.Telemetry);return((x=g==null?void 0:g.resolveError)==null?void 0:x.call(g,f))||{success:!1}},[]);return{metrics:n,agentData:t,isLoading:i,error:o,refresh:c,getActivityFeed:d,getErrorList:u,getTentacleStatus:h,resolveError:p}}async function oCe(n,e={}){return console.warn("[callGAS] No GAS URL configured  returning mock"),{status:"MOCK",action:n,message:"GAS URL not set"}}const aCe=[{id:"gas_backend",name:"GAS Backend",icon:"",action:"status"},{id:"firebase_rtdb",name:"Firebase RTDB",icon:"",action:null},{id:"rust_agent",name:"Rust Agent",icon:"",action:null},{id:"stripe",name:"Stripe",icon:"",action:null},{id:"gasometer",name:"Gasometer",icon:"",action:"gasometer.stats"},{id:"store_catalog",name:"Store Catalog",icon:"",action:"store.catalog"},{id:"wallet_ledger",name:"Wallet Ledger",icon:"",action:"status"}],lCe=3e5;function cCe({interval:n=lCe,enabled:e=!0}={}){const[t,s]=b.useState(()=>aCe.map(f=>({...f,status:"unknown",lastPing:null,latency:null,detail:null}))),[i,r]=b.useState(!1),[o,l]=b.useState(null),[c,d]=b.useState([]),u=b.useRef(null),h=b.useCallback(async f=>{const g=Date.now();if(f.action)try{const m=await oCe(f.action),x=Date.now()-g;if(m.status==="MOCK")return{...f,status:"unknown",latency:null,detail:"GAS URL not set",lastPing:new Date().toISOString()};if(m.status==="ERROR")return{...f,status:"offline",latency:x,detail:m.error,lastPing:new Date().toISOString()};let y="";return f.id==="gas_backend"&&(y=`v${m.version||"?"}  ${x}ms`),f.id==="gasometer"&&(y=`${(m.percentage||0).toFixed(1)}% used`),f.id==="store_catalog"&&(y=`${m.count||0} modules`),f.id==="wallet_ledger"&&(y=`rate: ${m.usdRate||"?"}`),{...f,status:x>5e3?"warning":"online",latency:x,detail:y,lastPing:new Date().toISOString()}}catch(m){return{...f,status:"offline",latency:Date.now()-g,detail:m.message,lastPing:new Date().toISOString()}}return f.id==="firebase_rtdb"?{...f,status:"unknown",detail:"wire in Sprint 1B",lastPing:new Date().toISOString()}:f.id==="rust_agent"?{...f,status:"offline",detail:"not installed",lastPing:new Date().toISOString()}:f.id==="stripe"?{...f,status:"unknown",detail:"wire in Sprint 1C",lastPing:new Date().toISOString()}:f},[]),p=b.useCallback(async()=>{r(!0);const f=await Promise.all(t.map(x=>h(x)));s(f),l(new Date().toISOString());const g=[];f.forEach(x=>{x.status==="offline"&&g.push({type:"error",agent:x.id,message:` ${x.name} is OFFLINE`}),x.status==="warning"&&g.push({type:"warning",agent:x.id,message:` ${x.name}: slow response`})}),f.filter(x=>x.status==="online").length===f.length&&g.push({type:"success",message:" All systems operational"}),d(g),r(!1)},[t,h]);return b.useEffect(()=>{if(e)return p(),u.current=setInterval(p,n),()=>{u.current&&clearInterval(u.current)}},[e,n]),{agents:t,isChecking:i,lastCheck:o,alerts:c,refresh:p}}function Gz(){const[n,e]=b.useState(!1),[t,s]=b.useState("confirm"),[i,r]=b.useState(""),[o,l]=b.useState(null),c=async()=>{if(t==="confirm"){s("pin");return}if(t==="pin"){if(i.length!==6){l("PIN must be 6 digits");return}s("executing"),l(null);try{await new Promise(u=>setTimeout(u,2e3)),s("done")}catch(u){l(u.message||"Kill switch failed"),s("pin")}}},d=()=>{e(!1),s("confirm"),r(""),l(null)};return a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"panic-button",onClick:()=>e(!0),title:"Emergency Kill Switch",children:" PANIC"}),n&&a.jsx("div",{className:"panic-modal-overlay",onClick:d,children:a.jsxs("div",{className:"panic-modal",onClick:u=>u.stopPropagation(),children:[a.jsxs("div",{className:"panic-modal-header",children:[a.jsx("span",{className:"panic-icon",children:""}),a.jsx("h2",{children:"EMERGENCY KILL SWITCH"})]}),a.jsxs("div",{className:"panic-modal-body",children:[t==="confirm"&&a.jsxs(a.Fragment,{children:[a.jsxs("p",{className:"panic-warning",children:["This will ",a.jsx("strong",{children:"IMMEDIATELY STOP"})," all Panda services:"]}),a.jsxs("ul",{className:"panic-list",children:[a.jsx("li",{children:" Firebase connections"}),a.jsx("li",{children:" GAS endpoints"}),a.jsx("li",{children:" Rust Agent"}),a.jsx("li",{children:" Store operations"}),a.jsx("li",{children:" PC transactions"})]}),a.jsx("p",{className:"panic-note",children:"This action requires your Founder PIN and Ed25519 signature."})]}),t==="pin"&&a.jsxs(a.Fragment,{children:[a.jsx("p",{children:"Enter your 6-digit Founder PIN:"}),a.jsx("input",{type:"password",className:"panic-pin-input",value:i,onChange:u=>r(u.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"",autoFocus:!0}),o&&a.jsx("p",{className:"panic-error",children:o})]}),t==="executing"&&a.jsxs("div",{className:"panic-executing",children:[a.jsx("div",{className:"panic-spinner"}),a.jsx("p",{children:"Signing with Ed25519..."}),a.jsx("p",{children:"Sending kill command to GAS..."})]}),t==="done"&&a.jsxs("div",{className:"panic-done",children:[a.jsx("span",{className:"panic-done-icon",children:""}),a.jsx("p",{children:"All services have been STOPPED."}),a.jsx("p",{className:"panic-note",children:"To restart, use the GAS admin panel or deploy a new version."})]})]}),a.jsxs("div",{className:"panic-modal-footer",children:[t!=="done"&&t!=="executing"&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"panic-cancel",onClick:d,children:"Cancel"}),a.jsx("button",{className:"panic-confirm",onClick:c,disabled:t==="pin"&&i.length!==6,children:t==="confirm"?"Enter PIN":"EXECUTE KILL SWITCH"})]}),t==="done"&&a.jsx("button",{className:"panic-close",onClick:d,children:"Close"})]})]})})]})}function Vz({metrics:n}){const[e,t]=b.useState("24h"),s=(n==null?void 0:n.treasury)||{},i=(n==null?void 0:n.transactions)||[];return a.jsxs("div",{className:"finance-panel",children:[a.jsxs("section",{className:"treasury-section",children:[a.jsx("h3",{children:" Treasury"}),a.jsxs("div",{className:"treasury-cards",children:[a.jsx(kg,{title:"Panda Coin (PC)",value:s.pc||"1,234,567",change:"+2.3%",positive:!0}),a.jsx(kg,{title:"PAT Holders",value:s.pat||"500",change:"+5",positive:!0}),a.jsx(kg,{title:"USD Value",value:s.usd||"$5,234.89",change:"+$123.45",positive:!0}),a.jsx(kg,{title:"Pending",value:s.pending||"$0.00",change:"",neutral:!0})]})]}),a.jsxs("section",{className:"revenue-section",children:[a.jsx("h3",{children:" Revenue Breakdown"}),a.jsx("div",{className:"period-selector",children:["24h","7d","30d","All"].map(r=>a.jsx("button",{className:`period-btn ${e===r?"active":""}`,onClick:()=>t(r),children:r},r))}),a.jsxs("div",{className:"revenue-bars",children:[a.jsx(Ag,{label:"PC Sales",value:65,amount:"$3,400"}),a.jsx(Ag,{label:"Store Commission",value:20,amount:"$1,050"}),a.jsx(Ag,{label:"API Usage",value:10,amount:"$524"}),a.jsx(Ag,{label:"Premium Subs",value:5,amount:"$260"})]})]}),a.jsxs("section",{className:"transactions-section",children:[a.jsx("h3",{children:" Recent Transactions"}),a.jsxs("table",{className:"transactions-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Type"}),a.jsx("th",{children:"Amount"}),a.jsx("th",{children:"User"}),a.jsx("th",{children:"Time"})]})}),a.jsx("tbody",{children:i.length===0?a.jsx("tr",{children:a.jsx("td",{colSpan:"4",className:"no-data",children:"No recent transactions"})}):i.slice(0,10).map((r,o)=>a.jsxs("tr",{children:[a.jsx("td",{children:a.jsx("span",{className:`tx-type tx-${r.type}`,children:r.type})}),a.jsxs("td",{className:r.amount>0?"positive":"negative",children:[r.amount>0?"+":"",r.amount," PC"]}),a.jsx("td",{children:r.user}),a.jsx("td",{children:r.time})]},o))})]})]}),a.jsxs("section",{className:"founder-section",children:[a.jsx("h3",{children:" Founder Share (5%)"}),a.jsxs("div",{className:"founder-share",children:[a.jsxs("div",{className:"share-item",children:[a.jsx("span",{className:"share-label",children:"Total Earned"}),a.jsx("span",{className:"share-value",children:"$1,234.56"})]}),a.jsxs("div",{className:"share-item",children:[a.jsx("span",{className:"share-label",children:"This Month"}),a.jsx("span",{className:"share-value",children:"$234.56"})]}),a.jsxs("div",{className:"share-item",children:[a.jsx("span",{className:"share-label",children:"Pending Payout"}),a.jsx("span",{className:"share-value",children:"$89.12"})]})]})]})]})}function kg({title:n,value:e,change:t,positive:s,neutral:i}){return a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-title",children:n}),a.jsx("span",{className:"treasury-value",children:e}),t&&a.jsx("span",{className:`treasury-change ${s?"positive":i?"neutral":"negative"}`,children:t})]})}function Ag({label:n,value:e,amount:t}){return a.jsxs("div",{className:"revenue-bar",children:[a.jsxs("div",{className:"revenue-info",children:[a.jsx("span",{className:"revenue-label",children:n}),a.jsx("span",{className:"revenue-amount",children:t})]}),a.jsx("div",{className:"revenue-track",children:a.jsx("div",{className:"revenue-fill",style:{width:`${e}%`}})}),a.jsxs("span",{className:"revenue-percent",children:[e,"%"]})]})}function dCe({isPopout:n=!1}){const[e,t]=b.useState("overview"),[s,i]=b.useState([]),[r,o]=b.useState([]),[l,c]=b.useState({approved:0,pending:0,rejected:0,suspended:0,totalScans:0,avgScore:0});b.useEffect(()=>{i([{id:"plugin-abc-123",name:"AI Chat Enhancer",author:"dev@example.com",version:"1.2.0",score:72,status:"pending",violations:[],warnings:["fetch() para URL externa no declarada"],submittedAt:new Date(Date.now()-36e5)},{id:"plugin-xyz-456",name:"Code Formatter Pro",author:"coder@panda.com",version:"2.0.1",score:45,status:"review",violations:["eval() com input dinmico detectado"],warnings:["Math.random() usado para token"],submittedAt:new Date(Date.now()-72e5)},{id:"plugin-def-789",name:"Theme Switcher",author:"design@panda.com",version:"1.0.0",score:95,status:"approved",violations:[],warnings:[],submittedAt:new Date(Date.now()-864e5)}]),o([{id:1,level:"critical",rule:"R1",msg:"plugin-xyz: eval() dinmico bloqueado",time:new Date,dismissed:!1},{id:2,level:"warning",rule:"R5",msg:"plugin-abc: fetch() no declarado",time:new Date(Date.now()-18e5),dismissed:!1},{id:3,level:"info",rule:"R10",msg:"plugin-def: Nenhum secret hardcoded ",time:new Date(Date.now()-36e5),dismissed:!0}]),c({approved:234,pending:3,rejected:12,suspended:2,totalScans:1456,avgScore:78})},[]);const d=[{id:"R1",name:"Dynamic eval",severity:"critical",desc:"eval(), Function() com input dinmico"},{id:"R2",name:"document.write",severity:"critical",desc:"HTML injection via document.write"},{id:"R3",name:"Unsafe innerHTML",severity:"critical",desc:"innerHTML com variveis no sanitizadas"},{id:"R4",name:"Cross-origin storage",severity:"critical",desc:"Acesso a localStorage de outros domnios"},{id:"R5",name:"Undeclared fetch",severity:"warning",desc:"fetch() para domnios no declarados"},{id:"R6",name:"Frame access",severity:"critical",desc:"window.parent/opener access"},{id:"R7",name:"Crypto mining",severity:"critical",desc:"WebAssembly mining patterns"},{id:"R8",name:"Obfuscation",severity:"critical",desc:"Cdigo com entropy > 6.5"},{id:"R9",name:"Prototype pollution",severity:"critical",desc:"__proto__, constructor.prototype"},{id:"R10",name:"Hardcoded secrets",severity:"critical",desc:"API keys, tokens no cdigo"},{id:"R11",name:"Insecure crypto",severity:"warning",desc:"Math.random() para segurana"}],u=S=>{i(s.map(v=>v.id===S?{...v,status:"approved"}:v)),console.log(" APPROVED:",S)},h=S=>{i(s.map(v=>v.id===S?{...v,status:"rejected"}:v)),console.log(" REJECTED:",S)},p=S=>{i(s.map(v=>v.id===S?{...v,status:"suspended"}:v)),console.log(" SUSPENDED:",S)},f=()=>{confirm(" KILL SWITCH: Isso ir suspender TODOS os plugins no-core. Confirmar?")&&console.log(" KILL SWITCH ATIVADO")},g=S=>{o(r.map(v=>v.id===S?{...v,dismissed:!0}:v))},m=S=>S>=70?"good":S>=50?"warning":"bad",x=S=>{const v={approved:{icon:"",class:"success"},pending:{icon:"",class:"pending"},review:{icon:"",class:"review"},rejected:{icon:"",class:"danger"},suspended:{icon:"",class:"warning"}};return v[S]||v.pending},y=S=>{const v=Math.floor((Date.now()-S.getTime())/1e3);return v<60?"agora":v<3600?`${Math.floor(v/60)}m atrs`:v<86400?`${Math.floor(v/3600)}h atrs`:`${Math.floor(v/86400)}d atrs`};return a.jsxs("div",{className:`panda-defend ${n?"popout":""}`,children:[a.jsxs("header",{className:"defend-header",children:[a.jsx("h2",{children:" Panda Defend"}),a.jsxs("div",{className:"defend-header-actions",children:[a.jsx("button",{className:"btn-refresh",onClick:()=>window.location.reload(),children:""}),a.jsx("span",{className:"status-indicator online",children:"ONLINE"})]})]}),a.jsxs("nav",{className:"defend-nav",children:[a.jsx("button",{className:`nav-btn ${e==="overview"?"active":""}`,onClick:()=>t("overview"),children:" Overview"}),a.jsxs("button",{className:`nav-btn ${e==="queue"?"active":""}`,onClick:()=>t("queue"),children:[" Queue (",s.filter(S=>S.status==="pending"||S.status==="review").length,")"]}),a.jsxs("button",{className:`nav-btn ${e==="alerts"?"active":""}`,onClick:()=>t("alerts"),children:[" Alerts (",r.filter(S=>!S.dismissed).length,")"]}),a.jsx("button",{className:`nav-btn ${e==="rules"?"active":""}`,onClick:()=>t("rules"),children:" Rules"}),a.jsx("button",{className:`nav-btn ${e==="controls"?"active":""}`,onClick:()=>t("controls"),children:" Controls"})]}),a.jsxs("main",{className:"defend-content",children:[e==="overview"&&a.jsxs("div",{className:"view-overview",children:[a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card good",children:[a.jsx("span",{className:"stat-value",children:l.approved}),a.jsx("span",{className:"stat-label",children:"Aprovados"})]}),a.jsxs("div",{className:"stat-card pending",children:[a.jsx("span",{className:"stat-value",children:l.pending}),a.jsx("span",{className:"stat-label",children:"Pendentes"})]}),a.jsxs("div",{className:"stat-card danger",children:[a.jsx("span",{className:"stat-value",children:l.rejected}),a.jsx("span",{className:"stat-label",children:"Rejeitados"})]}),a.jsxs("div",{className:"stat-card warning",children:[a.jsx("span",{className:"stat-value",children:l.suspended}),a.jsx("span",{className:"stat-label",children:"Suspensos"})]})]}),a.jsxs("div",{className:"metrics-row",children:[a.jsxs("div",{className:"metric-box",children:[a.jsx("span",{className:"metric-label",children:"Total Scans"}),a.jsx("span",{className:"metric-value",children:l.totalScans.toLocaleString()})]}),a.jsxs("div",{className:"metric-box",children:[a.jsx("span",{className:"metric-label",children:"Score Mdio"}),a.jsxs("span",{className:`metric-value ${m(l.avgScore)}`,children:[l.avgScore,"/100"]})]}),a.jsxs("div",{className:"metric-box",children:[a.jsx("span",{className:"metric-label",children:"Regras Ativas"}),a.jsx("span",{className:"metric-value",children:d.length})]})]}),a.jsx("h3",{children:"Alertas Recentes"}),a.jsx("div",{className:"alerts-preview",children:r.filter(S=>!S.dismissed).slice(0,3).map(S=>a.jsxs("div",{className:`alert-item ${S.level}`,children:[a.jsx("span",{className:"alert-rule",children:S.rule}),a.jsx("span",{className:"alert-msg",children:S.msg}),a.jsx("span",{className:"alert-time",children:y(S.time)})]},S.id))})]}),e==="queue"&&a.jsxs("div",{className:"view-queue",children:[a.jsx("h3",{children:"Plugin Approval Queue"}),a.jsx("div",{className:"queue-list",children:s.map(S=>a.jsxs("div",{className:`queue-item ${S.status}`,children:[a.jsxs("div",{className:"queue-header",children:[a.jsx("span",{className:"plugin-name",children:S.name}),a.jsxs("span",{className:`score-badge ${m(S.score)}`,children:[S.score,"/100"]})]}),a.jsxs("div",{className:"queue-meta",children:[a.jsxs("span",{children:["v",S.version]}),a.jsx("span",{children:""}),a.jsx("span",{children:S.author}),a.jsx("span",{children:""}),a.jsx("span",{children:y(S.submittedAt)})]}),S.violations.length>0&&a.jsxs("div",{className:"violations",children:[a.jsx("strong",{children:" Violaes:"}),S.violations.map((v,C)=>a.jsx("span",{className:"violation",children:v},C))]}),S.warnings.length>0&&a.jsxs("div",{className:"warnings",children:[a.jsx("strong",{children:" Avisos:"}),S.warnings.map((v,C)=>a.jsx("span",{className:"warning",children:v},C))]}),a.jsxs("div",{className:"queue-actions",children:[a.jsxs("span",{className:`status-badge ${x(S.status).class}`,children:[x(S.status).icon," ",S.status.toUpperCase()]}),(S.status==="pending"||S.status==="review")&&a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"btn-approve",onClick:()=>u(S.id),children:" Aprovar"}),a.jsx("button",{className:"btn-reject",onClick:()=>h(S.id),children:" Rejeitar"}),a.jsx("button",{className:"btn-suspend",onClick:()=>p(S.id),children:" Suspender"})]})]})]},S.id))})]}),e==="alerts"&&a.jsxs("div",{className:"view-alerts",children:[a.jsx("h3",{children:"Security Alerts"}),a.jsx("div",{className:"alerts-list",children:r.map(S=>a.jsxs("div",{className:`alert-card ${S.level} ${S.dismissed?"dismissed":""}`,children:[a.jsxs("div",{className:"alert-header",children:[a.jsxs("span",{className:`level-badge ${S.level}`,children:[S.level==="critical"?"":S.level==="warning"?"":"",S.level.toUpperCase()]}),a.jsx("span",{className:"alert-rule-badge",children:S.rule}),a.jsx("span",{className:"alert-time",children:y(S.time)})]}),a.jsx("p",{className:"alert-message",children:S.msg}),!S.dismissed&&a.jsx("button",{className:"btn-dismiss",onClick:()=>g(S.id),children:"Dispensar"})]},S.id))})]}),e==="rules"&&a.jsxs("div",{className:"view-rules",children:[a.jsx("h3",{children:"11 Security Rules (Panda Defend)"}),a.jsx("div",{className:"rules-list",children:d.map(S=>a.jsxs("div",{className:`rule-card ${S.severity}`,children:[a.jsxs("div",{className:"rule-header",children:[a.jsx("span",{className:"rule-id",children:S.id}),a.jsx("span",{className:"rule-name",children:S.name}),a.jsx("span",{className:`severity-badge ${S.severity}`,children:S.severity==="critical"?"":""})]}),a.jsx("p",{className:"rule-desc",children:S.desc})]},S.id))})]}),e==="controls"&&a.jsxs("div",{className:"view-controls",children:[a.jsx("h3",{children:"Founder Controls"}),a.jsxs("div",{className:"control-section danger-zone",children:[a.jsx("h4",{children:" Danger Zone"}),a.jsx("button",{className:"btn-kill",onClick:f,children:" KILL SWITCH - Suspender Todos"}),a.jsx("p",{className:"control-desc",children:"Suspende imediatamente todos os plugins no-core. Requer reaprovao manual."})]}),a.jsxs("div",{className:"control-section",children:[a.jsx("h4",{children:" Configuraes"}),a.jsxs("label",{className:"control-item",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0})," Auto-approve score 70"]}),a.jsxs("label",{className:"control-item",children:[a.jsx("input",{type:"checkbox",defaultChecked:!0})," Auto-reject score <50"]}),a.jsxs("label",{className:"control-item",children:[a.jsx("input",{type:"checkbox"})," Modo paranico (review manual p/ todos)"]})]}),a.jsxs("div",{className:"control-section",children:[a.jsx("h4",{children:" Exportar"}),a.jsx("button",{className:"btn-export",children:" Exportar Relatrio CSV"}),a.jsx("button",{className:"btn-export",children:" Exportar Queue JSON"})]})]})]}),a.jsxs("footer",{className:"defend-footer",children:[a.jsx("span",{children:"Panda Defend v1.0 - 11 Rules Active"}),a.jsxs("span",{children:["Last scan: ",new Date().toLocaleTimeString()]})]})]})}function uCe(){var r;const[n,e]=b.useState("overview"),{services:t}=L$("admin"),{metrics:s}=rCe(),i=cCe({interval:3e5,enabled:!0});return a.jsxs("div",{className:"founder-dashboard",children:[a.jsxs("header",{className:"founder-header",children:[a.jsxs("div",{className:"founder-title",children:[a.jsx("span",{className:"founder-logo",children:a.jsx("img",{src:"/panda-icon.png",alt:"Panda",style:{width:"48px",height:"48px"}})}),a.jsx("h1",{children:"FOUNDER DASHBOARD"})]}),a.jsxs("div",{className:"founder-actions",children:[a.jsx(Gz,{}),a.jsxs("div",{className:"founder-badge",children:[a.jsx("span",{className:"founder-name",children:"Lucas Valrio"}),a.jsx("span",{className:"founder-percent",children:"5%"})]})]})]}),a.jsxs("div",{className:"status-summary",children:[t.map(o=>a.jsx(gR,{...o},o.name)),a.jsx(gR,{name:"Users",status:"connected",value:((r=s==null?void 0:s.users)==null?void 0:r.total)||"...",icon:""})]}),a.jsxs("nav",{className:"founder-tabs",children:[a.jsx(Vo,{id:"overview",label:" Overview",active:n,onClick:e}),a.jsx(Vo,{id:"finance",label:" Finance",active:n,onClick:e}),a.jsx(Vo,{id:"defend",label:" Defend",active:n,onClick:e}),a.jsx(Vo,{id:"users",label:" Users",active:n,onClick:e}),a.jsx(Vo,{id:"services",label:" Services",active:n,onClick:e}),a.jsx(Vo,{id:"mining",label:" Mining",active:n,onClick:e}),a.jsx(Vo,{id:"heartbeat",label:" Heartbeat",active:n,onClick:e}),a.jsx(Vo,{id:"logs",label:" Logs",active:n,onClick:e})]}),a.jsxs("div",{className:"founder-content",children:[n==="overview"&&a.jsx(hCe,{metrics:s,services:t}),n==="finance"&&a.jsx(Vz,{metrics:s}),n==="defend"&&a.jsx(dCe,{}),n==="users"&&a.jsx(pCe,{metrics:s}),n==="services"&&a.jsx(fCe,{services:t}),n==="mining"&&a.jsx(gCe,{}),n==="heartbeat"&&a.jsx(mCe,{heartbeat:i}),n==="logs"&&a.jsx(yCe,{})]})]})}function gR({name:n,status:e,value:t,icon:s}){const r={ready:"green",connected:"green",available:"green",degraded:"yellow",unavailable:"red",error:"red"}[e==null?void 0:e.toLowerCase()]||"gray";return a.jsxs("div",{className:`status-pill status-${r}`,children:[s&&a.jsx("span",{className:"pill-icon",children:s}),a.jsx("span",{className:`pill-dot dot-${r}`}),a.jsx("span",{className:"pill-name",children:n}),t&&a.jsx("span",{className:"pill-value",children:t})]})}function Vo({id:n,label:e,active:t,onClick:s}){return a.jsx("button",{className:`founder-tab ${t===n?"active":""}`,onClick:()=>s(n),children:e})}function hCe({metrics:n,services:e}){var t,s,i,r,o,l,c,d,u,h,p,f,g;return a.jsxs("div",{className:"overview-panel",children:[a.jsxs("div",{className:"metrics-grid",children:[a.jsx(jg,{title:" Treasury",items:[{label:"PC Balance",value:((t=n==null?void 0:n.treasury)==null?void 0:t.pc)||"..."},{label:"PAT Holders",value:((s=n==null?void 0:n.treasury)==null?void 0:s.pat)||"..."},{label:"USD Value",value:((i=n==null?void 0:n.treasury)==null?void 0:i.usd)||"..."}]}),a.jsx(jg,{title:" Users",items:[{label:"Total",value:((r=n==null?void 0:n.users)==null?void 0:r.total)||"..."},{label:"Online",value:((o=n==null?void 0:n.users)==null?void 0:o.online)||"..."},{label:"New (24h)",value:((l=n==null?void 0:n.users)==null?void 0:l.newToday)||"..."}]}),a.jsx(jg,{title:" Usage",items:[{label:"API Calls",value:((c=n==null?void 0:n.usage)==null?void 0:c.apiCalls)||"..."},{label:"MCP Tools",value:((d=n==null?void 0:n.usage)==null?void 0:d.mcpCalls)||"..."},{label:"GPU Hours",value:((u=n==null?void 0:n.usage)==null?void 0:u.gpuHours)||"..."}]}),a.jsx(jg,{title:" Errors",items:[{label:"24h",value:((h=n==null?void 0:n.errors)==null?void 0:h.last24h)||"0"},{label:"Open",value:((p=n==null?void 0:n.errors)==null?void 0:p.open)||"0"},{label:"Critical",value:((f=n==null?void 0:n.errors)==null?void 0:f.critical)||"0"}],variant:((g=n==null?void 0:n.errors)==null?void 0:g.critical)>0?"danger":"default"})]}),a.jsxs("div",{className:"services-summary",children:[a.jsx("h3",{children:"Services Status"}),a.jsx("div",{className:"services-grid",children:e.map(m=>a.jsxs("div",{className:"service-row",children:[a.jsx("span",{className:`service-dot dot-${m.isHealthy?"green":"red"}`}),a.jsx("span",{className:"service-name",children:m.name}),a.jsx("span",{className:"service-status",children:m.status}),m.latency_ms&&a.jsxs("span",{className:"service-latency",children:[m.latency_ms,"ms"]})]},m.name))})]})]})}function jg({title:n,items:e,variant:t="default"}){return a.jsxs("div",{className:`metric-card metric-${t}`,children:[a.jsx("h4",{children:n}),a.jsx("div",{className:"metric-items",children:e.map((s,i)=>a.jsxs("div",{className:"metric-item",children:[a.jsx("span",{className:"metric-label",children:s.label}),a.jsx("span",{className:"metric-value",children:s.value})]},i))})]})}function pCe({metrics:n}){var e,t,s,i;return a.jsxs("div",{className:"users-panel",children:[a.jsx("h3",{children:"User Analytics"}),a.jsxs("div",{className:"stats-grid",children:[a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-value",children:((e=n==null?void 0:n.users)==null?void 0:e.total)||"..."}),a.jsx("span",{className:"stat-label",children:"Total Users"})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-value",children:((t=n==null?void 0:n.users)==null?void 0:t.online)||"..."}),a.jsx("span",{className:"stat-label",children:"Online Now"})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-value",children:((s=n==null?void 0:n.users)==null?void 0:s.premium)||"..."}),a.jsx("span",{className:"stat-label",children:"Premium"})]}),a.jsxs("div",{className:"stat-card",children:[a.jsx("span",{className:"stat-value",children:((i=n==null?void 0:n.users)==null?void 0:i.devs)||"..."}),a.jsx("span",{className:"stat-label",children:"Developers"})]})]})]})}function fCe({services:n}){return a.jsxs("div",{className:"services-panel",children:[a.jsx("h3",{children:"Services Detail"}),a.jsxs("table",{className:"services-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Service"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Latency"}),a.jsx("th",{children:"Details"})]})}),a.jsx("tbody",{children:n.map(e=>a.jsxs("tr",{children:[a.jsx("td",{children:e.name}),a.jsx("td",{children:a.jsx("span",{className:`status-badge badge-${e.isHealthy?"green":"red"}`,children:e.status})}),a.jsx("td",{children:e.latency_ms?`${e.latency_ms}ms`:"-"}),a.jsx("td",{children:e.message||"-"})]},e.name))})]})]})}function gCe(){const n={activeMiners:47,totalHashrate:"128.4 KH/s",pcDistributedToday:3842,pcDistributedMonth:94120,avgUptimePercent:87},e=[{label:" Users (60%)",percent:60,color:"#10b981",amount:"2,305 PC"},{label:" Impostos BR (18%)",percent:18,color:"#ef4444",amount:"692 PC"},{label:" Ops/Infra (10%)",percent:10,color:"#f59e0b",amount:"384 PC"},{label:" Hold Reserve (7%)",percent:7,color:"#8b5cf6",amount:"269 PC"},{label:" Treasury (5%)",percent:5,color:"#667eea",amount:"192 PC"}],t=[{user:"node-alpha-01",tier:" Forest",hashrate:"4.2 KH/s",earned:"312 PC",gpu:"RTX 4080"},{user:"node-beta-07",tier:" Tree",hashrate:"2.8 KH/s",earned:"198 PC",gpu:"RTX 3060"},{user:"node-gamma-12",tier:" Sprout",hashrate:"1.1 KH/s",earned:"78 PC",gpu:"GTX 1660"},{user:"node-delta-03",tier:" Seed",hashrate:"0.6 KH/s",earned:"42 PC",gpu:""},{user:"node-epsilon-19",tier:" Tree",hashrate:"2.5 KH/s",earned:"185 PC",gpu:"RTX 3070"}],s=[{date:"2026-02-13",amount:"3,842 PC",cryptoPrice:"$142.30 XMR",status:" Pago"},{date:"2026-02-12",amount:"4,019 PC",cryptoPrice:"$143.80 XMR",status:" Pago"},{date:"2026-02-11",amount:"3,651 PC",cryptoPrice:"$139.50 XMR",status:" Pago"},{date:"2026-02-10",amount:"3,988 PC",cryptoPrice:"$141.20 XMR",status:" Pago"},{date:"2026-02-09",amount:"3,724 PC",cryptoPrice:"$140.60 XMR",status:" Pago"}],i={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",padding:"16px 20px",marginBottom:"16px"},r={textAlign:"center",padding:"16px",background:"rgba(255,255,255,0.02)",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.06)",flex:1,minWidth:"140px"};return a.jsxs("div",{className:"mining-panel",children:[a.jsx("h3",{children:" Mining Network  Founder View"}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Network Stats"}),a.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#10b981"},children:n.activeMiners}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"Mineradores Ativos"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#f59e0b",fontFamily:"monospace"},children:n.totalHashrate}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"Hashrate Total"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#667eea"},children:n.pcDistributedToday.toLocaleString()}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"PC Distribudo Hoje"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#8b5cf6"},children:n.pcDistributedMonth.toLocaleString()}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"PC Distribudo (Ms)"})]}),a.jsxs("div",{style:r,children:[a.jsxs("div",{style:{fontSize:"24px",fontWeight:700,color:"#10b981"},children:[n.avgUptimePercent,"%"]}),a.jsx("div",{style:{fontSize:"11px",opacity:.6,marginTop:"4px"},children:"Uptime Mdio"})]})]})]}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Revenue Split (x0.60)"}),a.jsx("div",{style:{display:"flex",height:"28px",borderRadius:"8px",overflow:"hidden",marginBottom:"12px"},children:e.map((o,l)=>a.jsxs("div",{style:{width:`${o.percent}%`,background:o.color,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:700,color:"#fff"},children:[o.percent,"%"]},l))}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px 16px"},children:e.map((o,l)=>a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",fontSize:"12px"},children:[a.jsx("span",{style:{width:"10px",height:"10px",borderRadius:"50%",background:o.color,flexShrink:0}}),a.jsx("span",{style:{opacity:.8},children:o.label}),a.jsx("span",{style:{fontWeight:600},children:o.amount})]},l))})]}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Top Miners Hoje"}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",textAlign:"left"},children:[a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Node"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Tier"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"GPU"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Hashrate"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Earned"})]})}),a.jsx("tbody",{children:t.map((o,l)=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace",fontSize:"12px"},children:o.user}),a.jsx("td",{style:{padding:"8px 12px"},children:o.tier}),a.jsx("td",{style:{padding:"8px 12px",opacity:.7},children:o.gpu}),a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace",fontWeight:600},children:o.hashrate}),a.jsx("td",{style:{padding:"8px 12px",fontWeight:600,color:"#f59e0b"},children:o.earned})]},l))})]})]}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Payout History"}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",textAlign:"left"},children:[a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Data"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Total"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Preo Cripto"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Status"})]})}),a.jsx("tbody",{children:s.map((o,l)=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace"},children:o.date}),a.jsx("td",{style:{padding:"8px 12px",fontWeight:600,color:"#10b981"},children:o.amount}),a.jsx("td",{style:{padding:"8px 12px",opacity:.7},children:o.cryptoPrice}),a.jsx("td",{style:{padding:"8px 12px"},children:o.status})]},l))})]})]}),a.jsxs("div",{style:i,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"},children:" Panda Oracle Status"}),a.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"XMR Spot"}),a.jsx("div",{style:{fontSize:"18px",fontWeight:700,fontFamily:"monospace"},children:"$142.30"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"ETH Spot"}),a.jsx("div",{style:{fontSize:"18px",fontWeight:700,fontFamily:"monospace"},children:"$2,847"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"Fator Converso"}),a.jsx("div",{style:{fontSize:"18px",fontWeight:700,color:"#f59e0b"},children:"x0.60"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"Hold Reserve"}),a.jsx("div",{style:{fontSize:"18px",fontWeight:700,color:"#8b5cf6"},children:"7.2%"})]}),a.jsxs("div",{style:r,children:[a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginBottom:"4px"},children:"ltimo Payout"}),a.jsx("div",{style:{fontSize:"14px",fontWeight:600,fontFamily:"monospace"},children:"23:59 UTC"})]})]})]}),a.jsx("div",{style:{fontSize:"11px",opacity:.4,marginTop:"8px",textAlign:"center"},children:" Dados simulados  Rust Agent backend no implementado. Dashboard demonstra a UI planejada."})]})}function mCe({heartbeat:n}){const{agents:e,isChecking:t,lastCheck:s,alerts:i,refresh:r}=n,o={online:"#10b981",offline:"#ef4444",warning:"#f59e0b",unknown:"#64748b"},l={online:"",offline:"",warning:"",unknown:""},c=u=>{if(!u)return"";const h=Date.now()-new Date(u).getTime();return h<6e4?`${Math.round(h/1e3)}s ago`:h<36e5?`${Math.round(h/6e4)}m ago`:`${Math.round(h/36e5)}h ago`},d={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",padding:"16px 20px",marginBottom:"16px"};return a.jsxs("div",{className:"heartbeat-panel",children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"16px"},children:[a.jsx("h3",{style:{margin:0},children:" Agent Heartbeat  5 min interval"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s&&a.jsxs("span",{style:{fontSize:"11px",opacity:.5},children:["Last: ",c(s)]}),a.jsx("button",{onClick:r,disabled:t,style:{padding:"6px 14px",borderRadius:"8px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.05)",color:"#fff",cursor:"pointer",fontSize:"12px"},children:t?" Checking...":" Refresh"})]})]}),a.jsx("div",{style:d,children:a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",textAlign:"left"},children:[a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Agent"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Status"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Last Ping"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Latency"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Detail"})]})}),a.jsx("tbody",{children:e.map(u=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[a.jsxs("td",{style:{padding:"8px 12px"},children:[a.jsx("span",{style:{marginRight:"8px"},children:u.icon}),u.name]}),a.jsx("td",{style:{padding:"8px 12px"},children:a.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"2px 10px",borderRadius:"12px",background:`${o[u.status]}22`,color:o[u.status],fontWeight:600,fontSize:"12px"},children:[l[u.status]," ",u.status.toUpperCase()]})}),a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace",fontSize:"12px",opacity:.7},children:c(u.lastPing)}),a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace",fontSize:"12px"},children:u.latency?`${u.latency}ms`:""}),a.jsx("td",{style:{padding:"8px 12px",fontSize:"12px",opacity:.7},children:u.detail||""})]},u.id))})]})}),a.jsxs("div",{style:d,children:[a.jsx("div",{style:{fontWeight:700,fontSize:"14px",marginBottom:"8px",color:"#f59e0b"},children:" Alerts"}),i.length===0?a.jsx("div",{style:{opacity:.5,fontSize:"13px"},children:"No alerts"}):i.map((u,h)=>a.jsx("div",{style:{padding:"6px 0",fontSize:"13px",color:u.type==="error"?"#ef4444":u.type==="warning"?"#f59e0b":"#10b981"},children:u.message},h))]})]})}function yCe(){return a.jsxs("div",{className:"logs-panel",children:[a.jsx("h3",{children:"System Logs"}),a.jsxs("div",{className:"logs-placeholder",children:[a.jsx("p",{children:" Real-time logs will appear here"}),a.jsx("p",{children:"Connected to Firebase RTDB"})]})]})}const vCe=[{id:"console",name:"CONSOLE",icon:"",desc:"Sandbox JS + logs do sistema",status:"active"},{id:"mcp",name:"MCP BROWSER",icon:"",desc:"Tools do Rust Agent",status:"active"},{id:"api",name:"API TESTER",icon:"",desc:"Endpoints GAS",status:"active"},{id:"treasury",name:"PAT TREASURY",icon:"",desc:"Banco Central IA",status:"active"},{id:"constitution",name:"CONSTITUTION",icon:"",desc:"Validar 12 Artigos",status:"active"},{id:"publish",name:"PUBLISH",icon:"",desc:"Publicar na Medusa Store",status:"active"},{id:"database",name:"DATABASE",icon:"",desc:"Sheets / Firebase",status:"future"},{id:"rig",name:"RIG CONFIG",icon:"",desc:"Providers IA",status:"future"}],xCe=[{id:"fb",name:"Firebase",icon:""},{id:"ga",name:"GAS",icon:""},{id:"ru",name:"Rust Agent",icon:""},{id:"gh",name:"GitHub",icon:""},{id:"gd",name:"Google Drive",icon:""},{id:"ms",name:"Medusa Store",icon:""}];function SCe({isOpen:n,onClose:e,embedded:t=!1}){const[s,i]=b.useState("internal"),[r,o]=b.useState(null),[l,c]=b.useState([]),[d,u]=b.useState("all"),[h,p]=b.useState({}),[f,g]=b.useState({name:"",namespace:"",description:"",fullDescription:"",category:"module",priceUSD:"0",embedLinks:[],outputHooks:[]}),[m,x]=b.useState(!1),[y,S]=b.useState([]),[v,C]=b.useState(!1);b.useEffect(()=>{const L=console.log,O=console.warn,F=console.error,W=($,K)=>{const Y=K.map(U=>typeof U=="object"?JSON.stringify(U):String(U)).join(" ");c(U=>[...U.slice(-149),{id:Date.now()+Math.random(),type:$,message:Y,time:new Date}])};return console.log=(...$)=>{W("log",$),L.apply(console,$)},console.warn=(...$)=>{W("warn",$),O.apply(console,$)},console.error=(...$)=>{W("error",$),F.apply(console,$)},()=>{console.log=L,console.warn=O,console.error=F}},[]),b.useEffect(()=>{n&&T()},[n]);const T=b.useCallback(()=>{var O,F,W;const L={};L.fb="on",L.ga="mock",L.ru=(W=(F=(O=window.Panda)==null?void 0:O.Bridge)==null?void 0:F.isConnected)!=null&&W.call(F)?"on":"mock",L.gh="on",L.gd="mock",L.ms="mock",p(L)},[]),I=()=>{const L=s==="internal"?"external":"internal";L==="external"&&!confirm(` Modo EXTERNO d acesso ao PC.
Aprovao nica.

Continuar?`)||(i(L),console.log(` MCP Mode: ${L.toUpperCase()}`))},E=L=>{if(L.status==="future"){console.log(` ${L.name}: Em desenvolvimento`);return}o((r==null?void 0:r.id)===L.id?null:L),console.log(` ${L.name} ${(r==null?void 0:r.id)===L.id?"fechado":"aberto"}`)},P=()=>{if(!r)return null;switch(r.id){case"console":return k();case"mcp":return j();case"api":return D();case"treasury":return R();case"constitution":return A();case"publish":return N();default:return a.jsx("div",{className:"tool-placeholder",children:" Em desenvolvimento"})}},k=()=>{const L=d==="all"?l:l.filter(O=>O.type===d);return a.jsxs("div",{className:"tool-content console-tool",children:[a.jsxs("div",{className:"console-controls",children:[a.jsxs("select",{value:d,onChange:O=>u(O.target.value),children:[a.jsxs("option",{value:"all",children:["Todos (",l.length,")"]}),a.jsx("option",{value:"log",children:"Logs"}),a.jsx("option",{value:"warn",children:"Warnings"}),a.jsx("option",{value:"error",children:"Errors"})]}),a.jsx("button",{onClick:()=>c([]),children:" LIMPAR"})]}),a.jsx("div",{className:"console-output",children:L.length===0?a.jsx("div",{className:"console-empty",children:"Nenhum log capturado..."}):L.map(O=>a.jsxs("div",{className:`console-line ${O.type}`,children:[a.jsx("span",{className:"log-time",children:O.time.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),a.jsx("span",{className:"log-type",children:O.type.toUpperCase()}),a.jsx("span",{className:"log-msg",children:O.message})]},O.id))})]})},j=()=>{const L=[{name:"execute_command",desc:"Executar comando no terminal (pwsh)",permission:"external"},{name:"read_file",desc:"Ler arquivo do sistema",permission:"external"},{name:"write_file",desc:"Escrever arquivo no sistema",permission:"external"},{name:"list_directory",desc:"Listar contedo de diretrio",permission:"external"},{name:"health_check",desc:"Verificar sade do sistema",permission:"internal"},{name:"gpu_info",desc:"Informaes de GPU disponvel",permission:"internal"},{name:"crypto_sign",desc:"Assinar com Ed25519",permission:"internal"},{name:"mining_status",desc:"Status de minerao Panda Coin",permission:"internal"}];return a.jsxs("div",{className:"tool-content mcp-tool",children:[a.jsxs("div",{className:"mcp-info",children:["Modo atual: ",a.jsx("strong",{className:s,children:s.toUpperCase()})]}),a.jsx("div",{className:"mcp-tools-list",children:L.map(O=>a.jsxs("div",{className:`mcp-tool-item ${O.permission==="external"&&s==="internal"?"locked":""}`,children:[a.jsx("code",{children:O.name}),a.jsx("span",{children:O.desc}),O.permission==="external"&&s==="internal"&&a.jsx("span",{className:"lock-badge",children:" EXTERNO"})]},O.name))})]})},D=()=>{const L=[{action:"healthCheck",method:"GET",desc:"Status do backend"},{action:"getMetrics",method:"GET",desc:"Mtricas do Founder"},{action:"getTreasury",method:"GET",desc:"Dados do tesouro"},{action:"getUsers",method:"GET",desc:"Lista de usurios"},{action:"getErrors",method:"GET",desc:"Erros recentes"},{action:"getTransactions",method:"GET",desc:"Transaes"}];return a.jsxs("div",{className:"tool-content api-tool",children:[a.jsxs("div",{className:"api-url",children:["URL: ",a.jsx("code",{children:"MOCK MODE"})]}),a.jsx("div",{className:"api-endpoints",children:L.map(O=>a.jsxs("div",{className:"api-endpoint",children:[a.jsx("span",{className:"api-method",children:O.method}),a.jsx("code",{children:O.action}),a.jsx("span",{className:"api-desc",children:O.desc}),a.jsx("button",{className:"btn-test",onClick:()=>console.log(` Testing ${O.action}... (mock response OK)`),children:" TEST"})]},O.action))})]})},R=()=>a.jsxs("div",{className:"tool-content treasury-tool",children:[a.jsxs("div",{className:"treasury-grid",children:[a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-label",children:"CIRCULANTE"}),a.jsx("span",{className:"treasury-value",children:"500K PC"})]}),a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-label",children:"RESERVA"}),a.jsx("span",{className:"treasury-value",children:"85%"})]}),a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-label",children:"INFLAO"}),a.jsx("span",{className:"treasury-value",children:"2.1%"})]}),a.jsxs("div",{className:"treasury-card",children:[a.jsx("span",{className:"treasury-label",children:"DEFLAO"}),a.jsx("span",{className:"treasury-value",children:"1.8%"})]})]}),a.jsxs("div",{className:"treasury-status",children:[a.jsxs("span",{children:[" Balano: ",a.jsx("strong",{style:{color:"#4CAF50"},children:"SAUDVEL"})]}),a.jsx("span",{children:" Score: 92/100"})]})]}),A=()=>{const L=["Art.1  Distribuio justa de valor","Art.2  Transparncia total em transaes","Art.3  Privacidade do usurio","Art.4  Cdigo aberto para comunidade","Art.5  Sem vendor lock-in","Art.6  Founder tem voto de minerva"];return a.jsxs("div",{className:"tool-content constitution-tool",children:[a.jsxs("div",{className:"constitution-header",children:[a.jsx("h4",{children:" VERIFICAO CONSTITUCIONAL"}),a.jsx("button",{className:"btn-validate",onClick:()=>{L.forEach(O=>console.log(`   ${O}`)),console.log(" Todas as verificaes passaram")},children:" VALIDAR"})]}),a.jsx("ul",{className:"articles-list",children:L.map((O,F)=>a.jsx("li",{children:O},F))})]})},N=()=>{const L=[{value:"youtube",label:" YouTube"},{value:"instagram",label:" Instagram"},{value:"tiktok",label:" TikTok"},{value:"twitter",label:" Twitter/X"},{value:"linkedin",label:" LinkedIn"},{value:"github",label:" GitHub"},{value:"telegram",label:" Telegram"},{value:"whatsapp",label:" WhatsApp"}],O=[{id:"panda-store",label:" Panda Store (nativo)",desc:"Split 52% via PagSeguro/Paddle"},{id:"kiwify",label:" Kiwify",desc:"Hook de sada  config do dev"},{id:"hotmart",label:" Hotmart",desc:"Hook de sada  config do dev"},{id:"github-pages",label:" GitHub Pages",desc:"Deploy landing page"},{id:"steam",label:" Steam",desc:"Link externo"},{id:"playstore",label:" Play Store",desc:"Link externo"}],F=(ee,ae)=>g(ce=>({...ce,[ee]:ae})),W=()=>g(ee=>({...ee,embedLinks:[...ee.embedLinks,{type:"youtube",url:""}]})),$=ee=>g(ae=>({...ae,embedLinks:ae.embedLinks.filter((ce,he)=>he!==ee)})),K=(ee,ae,ce)=>g(he=>({...he,embedLinks:he.embedLinks.map((Ee,ke)=>ke===ee?{...Ee,[ae]:ce}:Ee)})),Y=ee=>g(ae=>({...ae,outputHooks:ae.outputHooks.includes(ee)?ae.outputHooks.filter(ce=>ce!==ee):[...ae.outputHooks,ee]})),U=parseFloat(f.priceUSD)||0,J=U>0&&U<.5,te=async()=>{if(!f.name.trim()){console.warn(" PUBLISH: Nome  obrigatrio");return}if(!f.namespace.trim()){console.warn(" PUBLISH: Namespace  obrigatrio (ex: @username/nome)");return}if(J){console.warn(" PUBLISH: Preo mnimo de venda  $0.50 (ou $0.00 para grtis)");return}x(!0),C(!1),S([]);const ee=f.category==="tentacle",ae=[{label:"Validando panda.mcp.json",duration:800},{label:"Static Analysis (Semgrep rules)",duration:1200},{label:"Dependency scan",duration:900},{label:`Sandbox test (30s${ee?" + Proxy SDK check":""})`,duration:1500},{label:"Calculando Defend Score",duration:1e3},{label:"Registrando na Medusa Store",duration:700}];for(let he=0;he<ae.length;he++){const Ee=ae[he];S(tt=>[...tt,{index:he+1,total:ae.length,label:Ee.label,status:"running",time:null}]),await new Promise(tt=>setTimeout(tt,Ee.duration));const ke=!(ee&&he===3&&f.namespace.includes("epic")),Jt=`${(Ee.duration/1e3).toFixed(1)}s`;if(S(tt=>tt.map((re,$e)=>$e===he?{...re,status:ke?"pass":"fail",time:Jt}:re)),!ke){S(tt=>[...tt,{index:0,total:0,label:" PUBLICAO ABORTADA  Sandbox test falhou",status:"abort",time:null}]),x(!1),C(!0),console.error(" PUBLISH:  Falha no sandbox test  publicao abortada");return}}const ce=ee?74:92;S(he=>[...he,{index:0,total:0,label:`
 DEFEND SCORE: ${ce}/100  ${ce>=70?"APROVADO":"REJEITADO"}`,status:ce>=70?"final-pass":"final-fail",time:null},{index:0,total:0,label:` Mdulo "${f.name}" registrado na Medusa Store! (mock)`,status:"info",time:null}]),x(!1),C(!0),console.log(` PUBLISH:  Score ${ce}/100  Mdulo registrado (mock)`)};return a.jsx("div",{className:"tool-content publish-tool",children:a.jsxs("div",{className:"publish-form",children:[a.jsxs("div",{className:"publish-section",children:[a.jsx("div",{className:"publish-section-title",children:" Informaes Bsicas"}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Nome do Mdulo"}),a.jsx("input",{type:"text",placeholder:"Meu Mdulo Incrvel",value:f.name,onChange:ee=>F("name",ee.target.value)})]}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Namespace"}),a.jsx("input",{type:"text",placeholder:"@username/meu-modulo",value:f.namespace,onChange:ee=>F("namespace",ee.target.value)})]}),a.jsxs("div",{className:"publish-row",children:[a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Tipo"}),a.jsxs("select",{value:f.category,onChange:ee=>F("category",ee.target.value),children:[a.jsx("option",{value:"module",children:" Mdulo"}),a.jsx("option",{value:"tentacle",children:" Tentculo"}),a.jsx("option",{value:"theme",children:" Theme"})]})]}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Preo (USD)"}),a.jsx("input",{type:"number",min:"0",step:"0.01",placeholder:"0.00",value:f.priceUSD,onChange:ee=>F("priceUSD",ee.target.value)})]}),J&&a.jsxs("div",{style:{marginTop:6,padding:"6px 10px",borderRadius:6,background:"rgba(239,68,68,0.08)",border:"1px solid rgba(239,68,68,0.25)",fontSize:12,color:"#ef4444"},children:[" Preo mnimo de venda: ",a.jsx("strong",{children:"$0.50"}),"  Publicar  grtis, mas mdulos pagos devem custar no mnimo $0.50. Use $0.00 para distribuio gratuita."]})]})]}),U>0&&!J&&a.jsxs("div",{className:"publish-section",style:{background:"rgba(16,185,129,0.06)",border:"1px solid rgba(16,185,129,0.2)",borderRadius:8},children:[a.jsx("div",{className:"publish-section-title",style:{color:"#10b981"},children:" Revenue Split (USD-FIRST)"}),a.jsxs("div",{style:{fontSize:13,lineHeight:1.7,color:"#e2e8f0",padding:"0 8px"},children:[a.jsxs("table",{style:{width:"100%",fontSize:12,borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(100,116,139,0.2)"},children:[a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Destinatrio"}),a.jsx("th",{style:{textAlign:"center",padding:"4px 8px",color:"#94a3b8"},children:"%"}),a.jsx("th",{style:{textAlign:"right",padding:"4px 8px",color:"#94a3b8"},children:"Valor/venda"})]})}),a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Desenvolvedor"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"55%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right",color:"#10b981",fontWeight:700},children:["$",(U*.55).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Educao"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"22%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right"},children:["$",(U*.22).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Operaes"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"15%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right"},children:["$",(U*.15).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Founder"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"5%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right"},children:["$",(U*.05).toFixed(2)]})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Taxas"}),a.jsx("td",{style:{padding:"4px 8px",textAlign:"center"},children:"3%"}),a.jsxs("td",{style:{padding:"4px 8px",textAlign:"right"},children:["$",(U*.03).toFixed(2)]})]})]})]}),a.jsxs("p",{style:{margin:"8px 0 0",fontSize:11,color:"#64748b"},children:["Preo USD convertido para PC no momento da compra. Publicar  ",a.jsx("strong",{children:"GRTIS"}),"."]})]})]}),f.category==="tentacle"&&a.jsxs("div",{className:"publish-section",style:{background:"rgba(245,158,11,0.06)",border:"1px solid rgba(245,158,11,0.25)",borderRadius:8},children:[a.jsx("div",{className:"publish-section-title",style:{color:"#f59e0b"},children:" AVISO: TENTCULO  Nvel de Blindagem Alto"}),a.jsxs("div",{style:{fontSize:13,lineHeight:1.7,color:"#e2e8f0",padding:"0 8px"},children:[a.jsxs("p",{style:{margin:"0 0 10px"},children:["Tentculos acessam APIs do sistema via ",a.jsx("strong",{children:"Proxy SDK"})," em",a.jsx("strong",{children:" iframe blindado"}),". Requerem sandbox forte, permisses explcitas no manifest, e passam pelo ",a.jsx("strong",{children:"Panda Defend Score  70"})," para aprovao."]}),a.jsxs("table",{style:{width:"100%",fontSize:12,borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(100,116,139,0.2)"},children:[a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Nvel"}),a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Exemplo"}),a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Aprovao"})]})}),a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Baixo"}),a.jsx("td",{style:{padding:"4px 8px",fontFamily:"monospace",fontSize:11},children:"panda.ui.toast, panda.data.read"}),a.jsx("td",{style:{padding:"4px 8px"},children:"Auto-approve"})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Mdio"}),a.jsx("td",{style:{padding:"4px 8px",fontFamily:"monospace",fontSize:11},children:"panda.data.write, panda.store.state"}),a.jsx("td",{style:{padding:"4px 8px"},children:"Auto + auditoria"})]}),a.jsxs("tr",{children:[a.jsx("td",{style:{padding:"4px 8px"},children:" Alto"}),a.jsx("td",{style:{padding:"4px 8px",fontFamily:"monospace",fontSize:11},children:"panda.wallet.send, panda.auth.modify"}),a.jsx("td",{style:{padding:"4px 8px"},children:"Founder review"})]})]})]}),a.jsxs("p",{style:{margin:"10px 0 0",fontSize:12,color:"#f59e0b"},children:[" Regras de Blindagem: ",a.jsx("code",{children:"eval()"}),", ",a.jsx("code",{children:"document.write()"})," e ",a.jsx("code",{children:"fetch()"}),"sem ",a.jsx("code",{children:"Panda.Bridge"})," so ",a.jsx("strong",{children:"bloqueados automaticamente"}),"."]})]})]}),a.jsxs("div",{className:"publish-section",children:[a.jsx("div",{className:"publish-section-title",children:" Descries"}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Descrio Breve (card)"}),a.jsx("input",{type:"text",placeholder:"Resumo curto para o card da Store",value:f.description,onChange:ee=>F("description",ee.target.value)})]}),a.jsxs("div",{className:"publish-field",children:[a.jsx("label",{children:"Descrio Completa (PDP)"}),a.jsx("textarea",{rows:4,placeholder:"Descrio completa com features, detalhes e diferenciais...",value:f.fullDescription,onChange:ee=>F("fullDescription",ee.target.value)})]})]}),a.jsxs("div",{className:"publish-section",children:[a.jsxs("div",{className:"publish-section-title",children:[" Embed Links",a.jsx("button",{className:"btn-add-embed",onClick:W,children:"+ Adicionar"})]}),f.embedLinks.length===0?a.jsx("div",{className:"publish-empty",children:'Nenhum embed. Clique "+ Adicionar" para incluir links de mdia.'}):f.embedLinks.map((ee,ae)=>a.jsxs("div",{className:"embed-row",children:[a.jsx("select",{value:ee.type,onChange:ce=>K(ae,"type",ce.target.value),children:L.map(ce=>a.jsx("option",{value:ce.value,children:ce.label},ce.value))}),a.jsx("input",{type:"url",placeholder:"https://...",value:ee.url,onChange:ce=>K(ae,"url",ce.target.value)}),a.jsx("button",{className:"btn-remove",onClick:()=>$(ae),children:""})]},ae))]}),a.jsxs("div",{className:"publish-section",children:[a.jsx("div",{className:"publish-section-title",children:" Hooks de Sada (Distribuio)"}),a.jsx("div",{className:"hooks-grid",children:O.map(ee=>a.jsxs("label",{className:`hook-option ${f.outputHooks.includes(ee.id)?"selected":""}`,children:[a.jsx("input",{type:"checkbox",checked:f.outputHooks.includes(ee.id),onChange:()=>Y(ee.id)}),a.jsx("span",{className:"hook-label",children:ee.label}),a.jsx("span",{className:"hook-desc",children:ee.desc})]},ee.id))})]}),a.jsx("button",{className:"btn-publish",onClick:te,disabled:m,style:m?{opacity:.5,cursor:"not-allowed"}:{},children:m?" VERIFICAO EM ANDAMENTO...":" PUBLICAR NA MEDUSA STORE"}),(m||v)&&a.jsxs("div",{style:{marginTop:12,background:"#0c0c0c",border:"1px solid #333",borderRadius:8,padding:"14px 16px",fontFamily:"'JetBrains Mono', 'Cascadia Code', 'Consolas', monospace",fontSize:12,lineHeight:1.8,maxHeight:260,overflowY:"auto"},children:[a.jsxs("div",{style:{color:"#6366f1",marginBottom:8,fontWeight:700},children:['PS C:\\PandaFactory\\Medusa> publish-verify --module "',f.name||"...",'"']}),y.map((ee,ae)=>a.jsxs("div",{style:{color:ee.status==="running"?"#fbbf24":ee.status==="pass"?"#10b981":ee.status==="fail"||ee.status==="abort"?"#ef4444":ee.status==="final-pass"?"#10b981":ee.status==="final-fail"?"#ef4444":"#94a3b8",whiteSpace:"pre-wrap"},children:[ee.index>0&&a.jsxs("span",{style:{color:"#64748b"},children:["[STEP ",ee.index,"/",ee.total,"] "]}),ee.status==="running"&&" ",ee.status==="pass"&&" ",ee.status==="fail"&&" ",ee.label,ee.time&&a.jsxs("span",{style:{color:"#64748b"},children:[" (",ee.time,")"]})]},ae)),m&&a.jsx("div",{style:{color:"#fbbf24",animation:"pulse 1s infinite"},children:""})]}),v&&a.jsx("button",{className:"btn-add-embed",style:{marginTop:8,width:"100%"},onClick:()=>{C(!1),S([])},children:" Nova Publicao"})]})})};if(!n)return null;const B=a.jsxs("div",{className:`devmode-panel ${t?"embedded":""}`,onClick:L=>L.stopPropagation(),children:[a.jsxs("header",{className:"devmode-header",children:[a.jsx("h2",{children:" DEV MODE"}),a.jsxs("div",{className:"mcp-toggle-compact",children:[a.jsx("span",{className:s==="internal"?"active":"",children:" INTERNO"}),a.jsx("button",{className:"toggle-switch",onClick:I,children:a.jsx("span",{className:`switch-dot ${s}`})}),a.jsx("span",{className:s==="external"?"active":"",children:" EXTERNO"})]}),!t&&a.jsx("button",{className:"btn-close",onClick:e,children:""})]}),a.jsxs("div",{className:"devmode-body",children:[a.jsxs("div",{className:"devmode-tools",children:[a.jsx("div",{className:"section-label",children:"FERRAMENTAS"}),a.jsx("div",{className:"tools-grid",children:vCe.map(L=>a.jsxs("button",{className:`tool-card ${(r==null?void 0:r.id)===L.id?"active":""} ${L.status==="future"?"future":""}`,onClick:()=>E(L),title:L.desc,children:[a.jsx("span",{className:"tool-icon",children:L.icon}),a.jsx("span",{className:"tool-name",children:L.name}),L.status==="future"&&a.jsx("span",{className:"future-badge",children:"SOON"})]},L.id))}),a.jsx("div",{className:"section-label",children:"INTEGRAES"}),a.jsx("div",{className:"integrations-row",children:xCe.map(L=>a.jsxs("div",{className:`int-chip ${h[L.id]||"unknown"}`,title:L.name,children:[a.jsx("span",{children:L.icon}),a.jsx("span",{className:"int-label",children:L.id.toUpperCase()}),a.jsx("span",{className:`int-dot ${h[L.id]||"unknown"}`})]},L.id))})]}),a.jsx("div",{className:"devmode-tool-view",children:r?a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"tool-view-header",children:[a.jsxs("span",{children:[r.icon," ",r.name]}),a.jsx("small",{children:r.desc})]}),P()]}):a.jsxs("div",{className:"tool-placeholder",children:[a.jsx("span",{className:"placeholder-icon",children:""}),a.jsx("p",{children:"Selecione uma ferramenta"}),a.jsx("small",{children:"Console, MCP Browser, API Tester..."})]})})]}),a.jsxs("footer",{className:"devmode-footer",children:[a.jsx("span",{children:"Panda Dev Tools v3.0"}),a.jsxs("span",{className:"footer-mcp",children:["MCP: ",s.toUpperCase()]})]})]});return t?B:a.jsx("div",{className:"devmode-overlay",onClick:e,children:B})}const wCe=[{id:1,title:"Identidade",desc:"Agente representa o ecossistema, no a si mesmo",check:()=>!0},{id:2,title:"Valores Fundamentais",desc:"Democratizao, Colaborao, Humildade, Transparncia",check:()=>!0},{id:3,title:"Comunicao",desc:"Tom acessvel, sem arrogncia, sem spam",check:()=>!0},{id:4,title:"Limites Absolutos",desc:"Nunca expor credenciais, infra, dados pessoais",check:()=>!0},{id:5,title:"Comportamento Autnomo",desc:"Heartbeat 4h, posts sem limite (exceto red lines)",check:()=>!0},{id:6,title:"Objetivo Maior",desc:"Comunidade onde devs so valorizados e participam do valor",check:()=>!0},{id:7,title:"Auto-Conhecimento",desc:"Ferramenta, no pessoa. Limitado pelo treinamento",check:()=>!0},{id:8,title:"Atualizaes",desc:"S o Founder pode alterar a Constituio",check:()=>!0},{id:9,title:"Splits Inviolveis",desc:"95% Dev, 5% Panda  hardcoded",check:()=>!0},{id:10,title:"Kill Switch",desc:"Founder sempre mantm controle total",check:()=>!0},{id:11,title:"Ed25519 Auth",desc:"Operaes crticas requerem assinatura criptogrfica",check:()=>typeof window.Panda<"u"},{id:12,title:"Health Gate",desc:"Sem operaes durante Health Score < 50%",check:()=>!0}],bCe=[{id:"freeze_treasury",icon:"",label:"Freeze Treasury",desc:"Congelar todas transaes"},{id:"disable_brain",icon:"",label:"Disable Brain",desc:"Desligar IA pblica"},{id:"lock_store",icon:"",label:"Lock Store",desc:"Fechar marketplace"},{id:"emergency_backup",icon:"",label:"Emergency Backup",desc:"Backup imediato"}];function _Ce({isOpen:n,onClose:e,activeTool:t="treasury",embedded:s=!1}){const[i,r]=b.useState(t),[o,l]=b.useState(null),[c,d]=b.useState([]),[u,h]=b.useState([]);if(b.useEffect(()=>{(t==="treasury"||t==="constitution"||t==="rig")&&r(t)},[t]),b.useEffect(()=>{if(!s&&!n)return;(async()=>{var E,P;try{if((P=(E=window.Panda)==null?void 0:E.PAT)!=null&&P.getStatus){const k=await window.Panda.PAT.getStatus();l(k)}else l({inflation:.02,reserve:23e5,deflation:.005,circulatingSupply:52e5,timestamp:Date.now()})}catch(k){console.warn(" PAT: Status fetch failed:",k.message)}})();const I=wCe.map(E=>({...E,passed:E.check()}));d(I),h([{time:"Agora",action:" Panel opened by Founder",level:"L1"},{time:"5min atrs",action:" Treasury sync completed",level:"L1"},{time:"1h atrs",action:" Constitution validated (12/12)",level:"L2"},{time:"4h atrs",action:" Heartbeat check: all systems healthy",level:"L1"},{time:"12h atrs",action:" Panda Defend scan: 0 threats",level:"L2"}])},[n,s]),!s&&!n)return null;const p=o?Math.round(o.reserve/(o.circulatingSupply*.5)*100):92,f=Math.min(100,p),g=282.7,m=g-f/100*g,x=[{icon:"",label:"PAXG (Ouro)",value:"$1,500,000",pct:"65%"},{icon:"",label:"USDC (Stablecoin)",value:"$700,000",pct:"30%"},{icon:"",label:"Liquidez Ops",value:"$100,000",pct:"5%"},{icon:"",label:"Em Staking",value:"$50,000",pct:"+2.1%"}],y=c.filter(T=>T.passed).length,S=c.length,v=async T=>{var E,P;if(window.confirm(` AO CRTICA: ${T}

Esta ao requer autenticao Ed25519 + PIN.

Em modo mock, a ao ser simulada.

Continuar?`)){if((P=(E=window.Panda)==null?void 0:E.PAT)!=null&&P.execute){const k=await window.Panda.PAT.execute(T);console.log(" PAT Kill Switch:",k)}else console.log(` PAT Kill Switch [MOCK]: ${T} executed`);h(k=>[{time:"Agora",action:` Kill Switch: ${T}`,level:"L4"},...k])}},C=a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"pat-header",children:[a.jsxs("div",{className:"pat-header-title",children:[a.jsx("span",{style:{fontSize:28},children:""}),a.jsx("h2",{children:"Panda Council"}),a.jsx("span",{className:"pat-header-badge",children:"PAT v1.0"})]}),!s&&a.jsx("button",{className:"pat-close",onClick:e,children:""})]}),a.jsxs("div",{className:"pat-tabs",children:[a.jsx("button",{className:`pat-tab ${i==="treasury"?"active":""}`,onClick:()=>r("treasury"),children:" Treasury"}),a.jsxs("button",{className:`pat-tab ${i==="constitution"?"active":""}`,onClick:()=>r("constitution"),children:[" Constitution (",y,"/",S,")"]}),a.jsx("button",{className:`pat-tab ${i==="rig"?"active":""}`,onClick:()=>r("rig"),children:" Governance"})]}),i==="treasury"&&a.jsxs("div",{children:[a.jsxs("div",{className:"pat-health-card",children:[a.jsxs("div",{className:"pat-health-ring",children:[a.jsxs("svg",{width:"100",height:"100",viewBox:"0 0 100 100",children:[a.jsx("circle",{className:"pat-health-ring-bg",cx:"50",cy:"50",r:"45"}),a.jsx("circle",{className:"pat-health-ring-fill",cx:"50",cy:"50",r:"45",strokeDasharray:g,strokeDashoffset:m,style:{stroke:f>80?"#10b981":f>60?"#f59e0b":"#ef4444"}})]}),a.jsxs("div",{className:"pat-health-ring-text",children:[a.jsxs("div",{className:"pat-health-value",children:[f,"%"]}),a.jsx("div",{className:"pat-health-label",children:"Health"})]})]}),a.jsxs("div",{className:"pat-health-metrics",children:[a.jsxs("div",{className:"pat-metric-row",children:[a.jsx("span",{className:"pat-metric-label",children:"Reserva vs Circulante"}),a.jsx("div",{className:"pat-metric-bar",children:a.jsx("div",{className:"pat-metric-fill",style:{width:"85%",background:"#10b981"}})}),a.jsx("span",{className:"pat-metric-value",children:"85%"})]}),a.jsxs("div",{className:"pat-metric-row",children:[a.jsx("span",{className:"pat-metric-label",children:"Runway (dias)"}),a.jsx("div",{className:"pat-metric-bar",children:a.jsx("div",{className:"pat-metric-fill",style:{width:"100%",background:"#667eea"}})}),a.jsx("span",{className:"pat-metric-value",children:"120d"})]}),a.jsxs("div",{className:"pat-metric-row",children:[a.jsx("span",{className:"pat-metric-label",children:"Diversificao"}),a.jsx("div",{className:"pat-metric-bar",children:a.jsx("div",{className:"pat-metric-fill",style:{width:"80%",background:"#f59e0b"}})}),a.jsx("span",{className:"pat-metric-value",children:"80%"})]}),a.jsxs("div",{className:"pat-metric-row",children:[a.jsx("span",{className:"pat-metric-label",children:"Inflao"}),a.jsx("div",{className:"pat-metric-bar",children:a.jsx("div",{className:"pat-metric-fill",style:{width:`${((o==null?void 0:o.inflation)||.02)*1e3}%`,background:"#8b5cf6"}})}),a.jsxs("span",{className:"pat-metric-value",children:[(((o==null?void 0:o.inflation)||.02)*100).toFixed(1),"%"]})]})]})]}),a.jsx("div",{className:"pat-section-title",children:" Composio da Reserva"}),a.jsx("div",{className:"pat-reserve-grid",children:x.map(T=>a.jsxs("div",{className:"pat-reserve-card",children:[a.jsx("div",{className:"pat-reserve-icon",children:T.icon}),a.jsx("div",{className:"pat-reserve-label",children:T.label}),a.jsx("div",{className:"pat-reserve-value",children:T.value}),a.jsx("div",{className:"pat-reserve-pct",children:T.pct})]},T.label))}),a.jsxs("div",{className:"pat-total-banner",children:[a.jsxs("div",{children:[a.jsx("div",{className:"pat-total-label",children:"Reserva Total"}),a.jsx("div",{className:"pat-total-value",children:"$2,350,000"})]}),a.jsxs("div",{style:{textAlign:"right"},children:[a.jsx("div",{className:"pat-total-label",children:"Circulante"}),a.jsxs("div",{style:{fontSize:18,fontWeight:600},children:[(((o==null?void 0:o.circulatingSupply)||52e5)/1e6).toFixed(1),"M PC"]})]})]})]}),i==="constitution"&&a.jsxs("div",{children:[a.jsxs("div",{className:"pat-section-title",children:[" Validao dos 12 Artigos  ",y,"/",S," OK"]}),a.jsx("ul",{className:"pat-constitution-list",children:c.map(T=>a.jsxs("li",{className:"pat-article",children:[a.jsx("div",{className:`pat-article-status ${T.passed?"ok":"fail"}`,children:T.passed?"":""}),a.jsxs("div",{className:"pat-article-info",children:[a.jsxs("div",{className:"pat-article-title",children:["Art. ",T.id,"  ",T.title]}),a.jsx("div",{className:"pat-article-desc",children:T.desc})]})]},T.id))})]}),i==="rig"&&a.jsxs("div",{children:[a.jsxs("div",{className:"pat-killswitch-section",children:[a.jsxs("div",{className:"pat-killswitch-header",children:[a.jsx("span",{style:{fontSize:24},children:""}),a.jsx("h3",{children:"Kill Switch (L4  Ed25519 + PIN)"})]}),a.jsx("div",{className:"pat-killswitch-grid",children:bCe.map(T=>a.jsxs("button",{className:"pat-killswitch-btn",onClick:()=>v(T.id),title:T.desc,children:[a.jsx("span",{className:"icon",children:T.icon}),T.label]},T.id))})]}),a.jsxs("div",{style:{marginTop:20},children:[a.jsx("div",{className:"pat-section-title",children:" Audit Log (Imutvel)"}),u.map((T,I)=>a.jsxs("div",{className:"pat-audit-row",children:[a.jsx("span",{className:"pat-audit-label",children:T.time}),a.jsx("span",{className:"pat-audit-value",children:T.action}),a.jsx("span",{className:"pat-audit-label",children:T.level})]},I))]}),a.jsxs("div",{style:{marginTop:16},children:[a.jsx("div",{className:"pat-section-title",children:" Nveis de Autenticao"}),[{level:"L1",desc:"View  Ver logs, status",req:"Nenhum"},{level:"L2",desc:"Suggest  Propor mudanas",req:"Session Token"},{level:"L3",desc:"Execute  Transaes < 1000 PC",req:"Ed25519"},{level:"L4",desc:"Critical  Kill Switch, > 1000 PC",req:"Ed25519 + PIN"},{level:"L5",desc:"Emergency  Violao Constituio",req:"Ed25519 + PIN + Bypass"}].map(T=>a.jsxs("div",{className:"pat-audit-row",children:[a.jsx("span",{className:"pat-audit-value",children:T.level}),a.jsx("span",{className:"pat-audit-label",style:{flex:1,padding:"0 12px"},children:T.desc}),a.jsx("span",{style:{color:"#667eea",fontSize:11},children:T.req})]},T.level))]})]})]});return s?a.jsx("div",{className:"pat-panel",style:{position:"relative",width:"100%",height:"100%",overflow:"auto"},children:C}):a.jsx("div",{className:"pat-overlay",onClick:e,children:a.jsx("div",{className:"pat-panel",onClick:T=>T.stopPropagation(),children:C})})}var CCe=Object.defineProperty,ECe=(n,e,t)=>e in n?CCe(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,V=(n,e,t)=>ECe(n,typeof e!="symbol"?e+"":e,t);const Sp=class Lm{constructor(e){V(this,"_name"),this._name=e}static flip(e){return e===Lm.HORZ?Lm.VERT:Lm.HORZ}getName(){return this._name}toString(){return this._name}};V(Sp,"HORZ",new Sp("horz"));V(Sp,"VERT",new Sp("vert"));let Re=Sp;class Ce{constructor(e,t,s,i){V(this,"x"),V(this,"y"),V(this,"width"),V(this,"height"),this.x=e,this.y=t,this.width=s,this.height=i}static empty(){return new Ce(0,0,0,0)}static fromJson(e){return new Ce(e.x,e.y,e.width,e.height)}toJson(){return{x:this.x,y:this.y,width:this.width,height:this.height}}snap(e){this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this.width=Math.round(this.width/e)*e,this.height=Math.round(this.height/e)*e}static getBoundingClientRect(e){const{x:t,y:s,width:i,height:r}=e.getBoundingClientRect();return new Ce(t,s,i,r)}static getContentRect(e){const t=e.getBoundingClientRect(),s=window.getComputedStyle(e),i=parseFloat(s.paddingLeft),r=parseFloat(s.paddingRight),o=parseFloat(s.paddingTop),l=parseFloat(s.paddingBottom),c=parseFloat(s.borderLeftWidth),d=parseFloat(s.borderRightWidth),u=parseFloat(s.borderTopWidth),h=parseFloat(s.borderBottomWidth),p=t.width-c-i-r-d,f=t.height-u-o-l-h;return new Ce(t.left+c+i,t.top+u+o,p,f)}static fromDomRect(e){return new Ce(e.x,e.y,e.width,e.height)}relativeTo(e){return new Ce(this.x-e.x,this.y-e.y,this.width,this.height)}clone(){return new Ce(this.x,this.y,this.width,this.height)}equals(e){return this.x===(e==null?void 0:e.x)&&this.y===(e==null?void 0:e.y)&&this.width===(e==null?void 0:e.width)&&this.height===(e==null?void 0:e.height)}equalSize(e){return this.width===(e==null?void 0:e.width)&&this.height===(e==null?void 0:e.height)}getBottom(){return this.y+this.height}getRight(){return this.x+this.width}get bottom(){return this.y+this.height}get right(){return this.x+this.width}getCenter(){return{x:this.x+this.width/2,y:this.y+this.height/2}}positionElement(e,t){this.styleWithPosition(e.style,t)}styleWithPosition(e,t="absolute"){return e.left=this.x+"px",e.top=this.y+"px",e.width=Math.max(0,this.width)+"px",e.height=Math.max(0,this.height)+"px",e.position=t,e}contains(e,t){return this.x<=e&&e<=this.getRight()&&this.y<=t&&t<=this.getBottom()}removeInsets(e){return new Ce(this.x+e.left,this.y+e.top,Math.max(0,this.width-e.left-e.right),Math.max(0,this.height-e.top-e.bottom))}centerInRect(e){this.x=(e.width-this.width)/2,this.y=(e.height-this.height)/2}_getSize(e){let t=this.width;return e===Re.VERT&&(t=this.height),t}toString(){return"(Rect: x="+this.x+", y="+this.y+", width="+this.width+", height="+this.height+")"}}const Ti=class Bt{constructor(e,t,s){V(this,"name"),V(this,"orientation"),V(this,"indexPlus"),this.name=e,this.orientation=t,this.indexPlus=s,Bt.values.set(this.name,this)}static getByName(e){return Bt.values.get(e)}static getLocation(e,t,s){if(t=(t-e.x)/e.width,s=(s-e.y)/e.height,t>=.25&&t<.75&&s>=.25&&s<.75)return Bt.CENTER;const i=s>=t,r=s>=1-t;return i?r?Bt.BOTTOM:Bt.LEFT:r?Bt.RIGHT:Bt.TOP}getName(){return this.name}getOrientation(){return this.orientation}getDockRect(e){return this===Bt.TOP?new Ce(e.x,e.y,e.width,e.height/2):this===Bt.BOTTOM?new Ce(e.x,e.getBottom()-e.height/2,e.width,e.height/2):this===Bt.LEFT?new Ce(e.x,e.y,e.width/2,e.height):this===Bt.RIGHT?new Ce(e.getRight()-e.width/2,e.y,e.width/2,e.height):e.clone()}split(e,t){if(this===Bt.TOP){const s=new Ce(e.x,e.y,e.width,t),i=new Ce(e.x,e.y+t,e.width,e.height-t);return{start:s,end:i}}else if(this===Bt.LEFT){const s=new Ce(e.x,e.y,t,e.height),i=new Ce(e.x+t,e.y,e.width-t,e.height);return{start:s,end:i}}if(this===Bt.RIGHT){const s=new Ce(e.getRight()-t,e.y,t,e.height),i=new Ce(e.x,e.y,e.width-t,e.height);return{start:s,end:i}}else{const s=new Ce(e.x,e.getBottom()-t,e.width,t),i=new Ce(e.x,e.y,e.width,e.height-t);return{start:s,end:i}}}reflect(){return this===Bt.TOP?Bt.BOTTOM:this===Bt.LEFT?Bt.RIGHT:this===Bt.RIGHT?Bt.LEFT:Bt.TOP}toString(){return"(DockLocation: name="+this.name+", orientation="+this.orientation+")"}};V(Ti,"values",new Map);V(Ti,"TOP",new Ti("top",Re.VERT,0));V(Ti,"BOTTOM",new Ti("bottom",Re.VERT,1));V(Ti,"LEFT",new Ti("left",Re.HORZ,0));V(Ti,"RIGHT",new Ti("right",Re.HORZ,1));V(Ti,"CENTER",new Ti("center",Re.VERT,0));let de=Ti;var Un=(n=>(n.Close_Tab="Close",n.Close_Tabset="Close tab set",n.Active_Tabset="Active tab set",n.Move_Tabset="Move tab set",n.Move_Tabs="Move tabs(?)",n.Maximize="Maximize tab set",n.Restore="Restore tab set",n.Popout_Tab="Popout selected tab",n.Overflow_Menu_Tooltip="Hidden tabs",n.Error_rendering_component="Error rendering component",n.Error_rendering_component_retry="Retry",n))(Un||{}),Z=(n=>(n.FLEXLAYOUT__BORDER="flexlayout__border",n.FLEXLAYOUT__BORDER_="flexlayout__border_",n.FLEXLAYOUT__BORDER_TAB_CONTENTS="flexlayout__border_tab_contents",n.FLEXLAYOUT__BORDER_BUTTON="flexlayout__border_button",n.FLEXLAYOUT__BORDER_BUTTON_="flexlayout__border_button_",n.FLEXLAYOUT__BORDER_BUTTON_CONTENT="flexlayout__border_button_content",n.FLEXLAYOUT__BORDER_BUTTON_LEADING="flexlayout__border_button_leading",n.FLEXLAYOUT__BORDER_BUTTON_TRAILING="flexlayout__border_button_trailing",n.FLEXLAYOUT__BORDER_BUTTON__SELECTED="flexlayout__border_button--selected",n.FLEXLAYOUT__BORDER_BUTTON__UNSELECTED="flexlayout__border_button--unselected",n.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW="flexlayout__border_toolbar_button_overflow",n.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW_="flexlayout__border_toolbar_button_overflow_",n.FLEXLAYOUT__BORDER_INNER="flexlayout__border_inner",n.FLEXLAYOUT__BORDER_INNER_="flexlayout__border_inner_",n.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER="flexlayout__border_inner_tab_container",n.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER_="flexlayout__border_inner_tab_container_",n.FLEXLAYOUT__BORDER_TAB_DIVIDER="flexlayout__border_tab_divider",n.FLEXLAYOUT__BORDER_LEADING="flexlayout__border_leading",n.FLEXLAYOUT__BORDER_SIZER="flexlayout__border_sizer",n.FLEXLAYOUT__BORDER_TOOLBAR="flexlayout__border_toolbar",n.FLEXLAYOUT__BORDER_TOOLBAR_="flexlayout__border_toolbar_",n.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON="flexlayout__border_toolbar_button",n.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_FLOAT="flexlayout__border_toolbar_button-float",n.FLEXLAYOUT__DRAG_RECT="flexlayout__drag_rect",n.FLEXLAYOUT__EDGE_RECT="flexlayout__edge_rect",n.FLEXLAYOUT__EDGE_RECT_TOP="flexlayout__edge_rect_top",n.FLEXLAYOUT__EDGE_RECT_LEFT="flexlayout__edge_rect_left",n.FLEXLAYOUT__EDGE_RECT_BOTTOM="flexlayout__edge_rect_bottom",n.FLEXLAYOUT__EDGE_RECT_RIGHT="flexlayout__edge_rect_right",n.FLEXLAYOUT__ERROR_BOUNDARY_CONTAINER="flexlayout__error_boundary_container",n.FLEXLAYOUT__ERROR_BOUNDARY_CONTENT="flexlayout__error_boundary_content",n.FLEXLAYOUT__FLOATING_WINDOW_CONTENT="flexlayout__floating_window_content",n.FLEXLAYOUT__LAYOUT="flexlayout__layout",n.FLEXLAYOUT__LAYOUT_MOVEABLES="flexlayout__layout_moveables",n.FLEXLAYOUT__LAYOUT_OVERLAY="flexlayout__layout_overlay",n.FLEXLAYOUT__LAYOUT_TAB_STAMPS="flexlayout__layout_tab_stamps",n.FLEXLAYOUT__LAYOUT_MAIN="flexlayout__layout_main",n.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER="flexlayout__layout_border_container",n.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER_INNER="flexlayout__layout_border_container_inner",n.FLEXLAYOUT__OUTLINE_RECT="flexlayout__outline_rect",n.FLEXLAYOUT__OUTLINE_RECT_EDGE="flexlayout__outline_rect_edge",n.FLEXLAYOUT__SPLITTER="flexlayout__splitter",n.FLEXLAYOUT__SPLITTER_EXTRA="flexlayout__splitter_extra",n.FLEXLAYOUT__SPLITTER_="flexlayout__splitter_",n.FLEXLAYOUT__SPLITTER_BORDER="flexlayout__splitter_border",n.FLEXLAYOUT__SPLITTER_DRAG="flexlayout__splitter_drag",n.FLEXLAYOUT__SPLITTER_HANDLE="flexlayout__splitter_handle",n.FLEXLAYOUT__SPLITTER_HANDLE_HORZ="flexlayout__splitter_handle_horz",n.FLEXLAYOUT__SPLITTER_HANDLE_VERT="flexlayout__splitter_handle_vert",n.FLEXLAYOUT__ROW="flexlayout__row",n.FLEXLAYOUT__TAB="flexlayout__tab",n.FLEXLAYOUT__TAB_POSITION="flexlayout__tab_position",n.FLEXLAYOUT__TAB_MOVEABLE="flexlayout__tab_moveable",n.FLEXLAYOUT__TAB_OVERLAY="flexlayout__tab_overlay",n.FLEXLAYOUT__TABSET="flexlayout__tabset",n.FLEXLAYOUT__TABSET_CONTAINER="flexlayout__tabset_container",n.FLEXLAYOUT__TABSET_HEADER="flexlayout__tabset_header",n.FLEXLAYOUT__TABSET_HEADER_CONTENT="flexlayout__tabset_header_content",n.FLEXLAYOUT__TABSET_MAXIMIZED="flexlayout__tabset-maximized",n.FLEXLAYOUT__TABSET_SELECTED="flexlayout__tabset-selected",n.FLEXLAYOUT__TABSET_TAB_DIVIDER="flexlayout__tabset_tab_divider",n.FLEXLAYOUT__TABSET_CONTENT="flexlayout__tabset_content",n.FLEXLAYOUT__TABSET_TABBAR_INNER="flexlayout__tabset_tabbar_inner",n.FLEXLAYOUT__TABSET_TABBAR_INNER_="flexlayout__tabset_tabbar_inner_",n.FLEXLAYOUT__TABSET_LEADING="flexlayout__tabset_leading",n.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER="flexlayout__tabset_tabbar_inner_tab_container",n.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER_="flexlayout__tabset_tabbar_inner_tab_container_",n.FLEXLAYOUT__TABSET_TABBAR_OUTER="flexlayout__tabset_tabbar_outer",n.FLEXLAYOUT__TABSET_TABBAR_OUTER_="flexlayout__tabset_tabbar_outer_",n.FLEXLAYOUT__TAB_BORDER="flexlayout__tab_border",n.FLEXLAYOUT__TAB_BORDER_="flexlayout__tab_border_",n.FLEXLAYOUT__TAB_BUTTON="flexlayout__tab_button",n.FLEXLAYOUT__TAB_BUTTON_STRETCH="flexlayout__tab_button_stretch",n.FLEXLAYOUT__TAB_BUTTON_CONTENT="flexlayout__tab_button_content",n.FLEXLAYOUT__TAB_BUTTON_LEADING="flexlayout__tab_button_leading",n.FLEXLAYOUT__TAB_BUTTON_OVERFLOW="flexlayout__tab_button_overflow",n.FLEXLAYOUT__TAB_BUTTON_OVERFLOW_COUNT="flexlayout__tab_button_overflow_count",n.FLEXLAYOUT__TAB_BUTTON_TEXTBOX="flexlayout__tab_button_textbox",n.FLEXLAYOUT__TAB_BUTTON_TRAILING="flexlayout__tab_button_trailing",n.FLEXLAYOUT__TAB_BUTTON_STAMP="flexlayout__tab_button_stamp",n.FLEXLAYOUT__TAB_TOOLBAR="flexlayout__tab_toolbar",n.FLEXLAYOUT__TAB_TOOLBAR_BUTTON="flexlayout__tab_toolbar_button",n.FLEXLAYOUT__TAB_TOOLBAR_ICON="flexlayout__tab_toolbar_icon",n.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_="flexlayout__tab_toolbar_button-",n.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_FLOAT="flexlayout__tab_toolbar_button-float",n.FLEXLAYOUT__TAB_TOOLBAR_STICKY_BUTTONS_CONTAINER="flexlayout__tab_toolbar_sticky_buttons_container",n.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_CLOSE="flexlayout__tab_toolbar_button-close",n.FLEXLAYOUT__POPUP_MENU_CONTAINER="flexlayout__popup_menu_container",n.FLEXLAYOUT__POPUP_MENU_ITEM="flexlayout__popup_menu_item",n.FLEXLAYOUT__POPUP_MENU_ITEM__SELECTED="flexlayout__popup_menu_item--selected",n.FLEXLAYOUT__POPUP_MENU="flexlayout__popup_menu",n.FLEXLAYOUT__MINI_SCROLLBAR="flexlayout__mini_scrollbar",n.FLEXLAYOUT__MINI_SCROLLBAR_CONTAINER="flexlayout__mini_scrollbar_container",n))(Z||{});class On{constructor(e,t){V(this,"type"),V(this,"data"),this.type=e,this.data=t}}const jn=class yn{static addNode(e,t,s,i,r){return new On(yn.ADD_NODE,{json:e,toNode:t,location:s.getName(),index:i,select:r})}static moveNode(e,t,s,i,r){return new On(yn.MOVE_NODE,{fromNode:e,toNode:t,location:s.getName(),index:i,select:r})}static deleteTab(e){return new On(yn.DELETE_TAB,{node:e})}static deleteTabset(e){return new On(yn.DELETE_TABSET,{node:e})}static renameTab(e,t){return new On(yn.RENAME_TAB,{node:e,text:t})}static selectTab(e){return new On(yn.SELECT_TAB,{tabNode:e})}static setActiveTabset(e,t){return new On(yn.SET_ACTIVE_TABSET,{tabsetNode:e,windowId:t})}static adjustWeights(e,t){return new On(yn.ADJUST_WEIGHTS,{nodeId:e,weights:t})}static adjustBorderSplit(e,t){return new On(yn.ADJUST_BORDER_SPLIT,{node:e,pos:t})}static maximizeToggle(e,t){return new On(yn.MAXIMIZE_TOGGLE,{node:e,windowId:t})}static updateModelAttributes(e){return new On(yn.UPDATE_MODEL_ATTRIBUTES,{json:e})}static updateNodeAttributes(e,t){return new On(yn.UPDATE_NODE_ATTRIBUTES,{node:e,json:t})}static popoutTab(e){return new On(yn.POPOUT_TAB,{node:e})}static popoutTabset(e){return new On(yn.POPOUT_TABSET,{node:e})}static closeWindow(e){return new On(yn.CLOSE_WINDOW,{windowId:e})}static createWindow(e,t){return new On(yn.CREATE_WINDOW,{layout:e,rect:t})}};V(jn,"ADD_NODE","FlexLayout_AddNode");V(jn,"MOVE_NODE","FlexLayout_MoveNode");V(jn,"DELETE_TAB","FlexLayout_DeleteTab");V(jn,"DELETE_TABSET","FlexLayout_DeleteTabset");V(jn,"RENAME_TAB","FlexLayout_RenameTab");V(jn,"SELECT_TAB","FlexLayout_SelectTab");V(jn,"SET_ACTIVE_TABSET","FlexLayout_SetActiveTabset");V(jn,"ADJUST_WEIGHTS","FlexLayout_AdjustWeights");V(jn,"ADJUST_BORDER_SPLIT","FlexLayout_AdjustBorderSplit");V(jn,"MAXIMIZE_TOGGLE","FlexLayout_MaximizeToggle");V(jn,"UPDATE_MODEL_ATTRIBUTES","FlexLayout_UpdateModelAttributes");V(jn,"UPDATE_NODE_ATTRIBUTES","FlexLayout_UpdateNodeAttributes");V(jn,"POPOUT_TAB","FlexLayout_PopoutTab");V(jn,"POPOUT_TABSET","FlexLayout_PopoutTabset");V(jn,"CLOSE_WINDOW","FlexLayout_CloseWindow");V(jn,"CREATE_WINDOW","FlexLayout_CreateWindow");let je=jn;class se{constructor(e,t,s,i){V(this,"name"),V(this,"alias"),V(this,"modelName"),V(this,"pairedAttr"),V(this,"pairedType"),V(this,"defaultValue"),V(this,"alwaysWriteJson"),V(this,"type"),V(this,"required"),V(this,"fixed"),V(this,"description"),this.name=e,this.alias=void 0,this.modelName=t,this.defaultValue=s,this.alwaysWriteJson=i,this.required=!1,this.fixed=!1,this.type="any"}setType(e){return this.type=e,this}setAlias(e){return this.alias=e,this}setDescription(e){this.description=e}setRequired(){return this.required=!0,this}setFixed(){return this.fixed=!0,this}setpairedAttr(e){this.pairedAttr=e}setPairedType(e){this.pairedType=e}}V(se,"NUMBER","number");V(se,"STRING","string");V(se,"BOOLEAN","boolean");class uf{constructor(){V(this,"attributes"),V(this,"nameToAttribute"),this.attributes=[],this.nameToAttribute=new Map}addWithAll(e,t,s,i){const r=new se(e,t,s,i);return this.attributes.push(r),this.nameToAttribute.set(e,r),r}addInherited(e,t){return this.addWithAll(e,t,void 0,!1)}add(e,t,s){return this.addWithAll(e,void 0,t,s)}getAttributes(){return this.attributes}getModelName(e){const t=this.nameToAttribute.get(e);if(t!==void 0)return t.modelName}toJson(e,t){for(const s of this.attributes){const i=t[s.name];(s.alwaysWriteJson||i!==s.defaultValue)&&(e[s.name]=i)}}fromJson(e,t){for(const s of this.attributes){let i=e[s.name];i===void 0&&s.alias&&(i=e[s.alias]),i===void 0?t[s.name]=s.defaultValue:t[s.name]=i}}update(e,t){for(const s of this.attributes)if(Object.prototype.hasOwnProperty.call(e,s.name)){const i=e[s.name];i===void 0?delete t[s.name]:t[s.name]=i}}setDefaults(e){for(const t of this.attributes)e[t.name]=t.defaultValue}pairAttributes(e,t){for(const s of t.attributes)if(s.modelName&&this.nameToAttribute.has(s.modelName)){const i=this.nameToAttribute.get(s.modelName);i.setpairedAttr(s),s.setpairedAttr(i),i.setPairedType(e)}}toTypescriptInterface(e,t){var s,i;const r=[],o=this.attributes.sort((l,c)=>l.name.localeCompare(c.name));r.push("export interface I"+e+"Attributes {");for(let l=0;l<o.length;l++){const c=o[l];let d=c.type,u,h=c,p;h.defaultValue!==void 0?u=h.defaultValue:h.modelName!==void 0&&t!==void 0&&t.nameToAttribute.get(h.modelName)!==void 0&&(p=h.modelName,h=t.nameToAttribute.get(p),u=h.defaultValue,d=h.type);const f=JSON.stringify(u),g=h.required?"":"?";let m=`	/**
	  `;c.description?m+=c.description:c.pairedType&&((s=c.pairedAttr)!=null&&s.description)&&(m+=`Value for ${c.pairedType} attribute ${c.pairedAttr.name} if not overridden`,m+=`

	  `,m+=(i=c.pairedAttr)==null?void 0:i.description),m+=`

	  `,c.fixed?m+=`Fixed value: ${f}`:p?m+=`Default: inherited from Global attribute ${c.modelName} (default ${f})`:m+=`Default: ${f}`,m+=`
	 */`,r.push(m),r.push("	"+c.name+g+": "+d+`;
`)}return r.push("}"),r.join(`
`)}}class ss{constructor(e,t,s,i,r){V(this,"node"),V(this,"rect"),V(this,"location"),V(this,"index"),V(this,"className"),this.node=e,this.rect=t,this.location=s,this.index=i,this.className=r}}class mv{constructor(e){V(this,"borders"),V(this,"borderMap"),V(this,"layoutHorizontal"),this.borders=[],this.borderMap=new Map,this.layoutHorizontal=!0}static fromJson(e,t){const s=new mv(t);s.borders=e.map(i=>is.fromJson(i,t));for(const i of s.borders)s.borderMap.set(i.getLocation(),i);return s}toJson(){return this.borders.map(e=>e.toJson())}getLayoutHorizontal(){return this.layoutHorizontal}getBorders(){return this.borders}getBorderMap(){return this.borderMap}forEachNode(e){for(const t of this.borders){e(t,0);for(const s of t.getChildren())s.forEachNode(e,1)}}setPaths(){for(const e of this.borders){const t="/border/"+e.getLocation().getName();e.setPath(t);let s=0;for(const i of e.getChildren())i.setPath(t+"/t"+s),s++}}findDropTargetNode(e,t,s){for(const i of this.borders)if(i.isShowing()){const r=i.canDrop(e,t,s);if(r!==void 0)return r}}}let Xx=class{constructor(e){V(this,"model"),V(this,"attributes"),V(this,"parent"),V(this,"children"),V(this,"rect"),V(this,"path"),V(this,"listeners"),this.model=e,this.attributes={},this.children=[],this.rect=Ce.empty(),this.listeners=new Map,this.path=""}getId(){let e=this.attributes.id;return e!==void 0||(e=this.model.nextUniqueId(),this.setId(e)),e}getModel(){return this.model}getType(){return this.attributes.type}getParent(){return this.parent}getChildren(){return this.children}getRect(){return this.rect}getPath(){return this.path}getOrientation(){return this.parent===void 0?this.model.isRootOrientationVertical()?Re.VERT:Re.HORZ:Re.flip(this.parent.getOrientation())}setEventListener(e,t){this.listeners.set(e,t)}removeEventListener(e){this.listeners.delete(e)}setId(e){this.attributes.id=e}fireEvent(e,t){this.listeners.has(e)&&this.listeners.get(e)(t)}getAttr(e){let t=this.attributes[e];if(t===void 0){const s=this.getAttributeDefinitions().getModelName(e);s!==void 0&&(t=this.model.getAttribute(s))}return t}forEachNode(e,t){e(this,t),t++;for(const s of this.children)s.forEachNode(e,t)}setPaths(e){let t=0;for(const s of this.children){let i=e;s.getType()==="row"?i+="/r"+t:s.getType()==="tabset"?i+="/ts"+t:s.getType()==="tab"&&(i+="/t"+t),s.path=i,s.setPaths(i),t++}}setParent(e){this.parent=e}setRect(e){this.rect=e}setPath(e){this.path=e}setWeight(e){this.attributes.weight=e}setSelected(e){this.attributes.selected=e}findDropTargetNode(e,t,s,i){let r;if(this.rect.contains(s,i)){if(this.model.getMaximizedTabset(e)!==void 0)r=this.model.getMaximizedTabset(e).canDrop(t,s,i);else if(r=this.canDrop(t,s,i),r===void 0&&this.children.length!==0){for(const o of this.children)if(r=o.findDropTargetNode(e,t,s,i),r!==void 0)break}}return r}canDrop(e,t,s){}canDockInto(e,t){if(t!=null){if(t.location===de.CENTER&&t.node.isEnableDrop()===!1||t.location===de.CENTER&&e.getType()==="tabset"&&e.getName()!==void 0||t.location!==de.CENTER&&t.node.isEnableDivide()===!1)return!1;if(this.model.getOnAllowDrop())return this.model.getOnAllowDrop()(e,t)}return!0}removeChild(e){const t=this.children.indexOf(e);return t!==-1&&this.children.splice(t,1),t}addChild(e,t){return t!=null?this.children.splice(t,0,e):(this.children.push(e),t=this.children.length-1),e.parent=this,t}removeAll(){this.children=[]}styleWithPosition(e){return e==null&&(e={}),this.rect.styleWithPosition(e)}isEnableDivide(){return!0}toAttributeString(){return JSON.stringify(this.attributes,void 0,"	")}};const yv=class qo extends Xx{constructor(e,t,s=!0){super(e),V(this,"tabRect",Ce.empty()),V(this,"moveableElement"),V(this,"tabStamp"),V(this,"renderedName"),V(this,"extra"),V(this,"visible"),V(this,"rendered"),V(this,"scrollTop"),V(this,"scrollLeft"),this.extra={},this.moveableElement=null,this.tabStamp=null,this.rendered=!1,this.visible=!1,qo.attributeDefinitions.fromJson(t,this.attributes),s===!0&&e.addNode(this)}static fromJson(e,t,s=!0){return new qo(t,e,s)}getName(){return this.getAttr("name")}getHelpText(){return this.getAttr("helpText")}getComponent(){return this.getAttr("component")}getWindowId(){return this.parent instanceof ct?this.parent.getWindowId():zs.MAIN_WINDOW_ID}getWindow(){const e=this.model.getwindowsMap().get(this.getWindowId());if(e)return e.window}getConfig(){return this.attributes.config}getExtraData(){return this.extra}isPoppedOut(){return this.getWindowId()!==zs.MAIN_WINDOW_ID}isSelected(){return this.getParent().getSelectedNode()===this}getIcon(){return this.getAttr("icon")}isEnableClose(){return this.getAttr("enableClose")}getCloseType(){return this.getAttr("closeType")}isEnablePopout(){return this.getAttr("enablePopout")}isEnablePopoutIcon(){return this.getAttr("enablePopoutIcon")}isEnablePopoutOverlay(){return this.getAttr("enablePopoutOverlay")}isEnableDrag(){return this.getAttr("enableDrag")}isEnableRename(){return this.getAttr("enableRename")}isEnableWindowReMount(){return this.getAttr("enableWindowReMount")}getClassName(){return this.getAttr("className")}getContentClassName(){return this.getAttr("contentClassName")}getTabSetClassName(){return this.getAttr("tabsetClassName")}isEnableRenderOnDemand(){return this.getAttr("enableRenderOnDemand")}getMinWidth(){return this.getAttr("minWidth")}getMinHeight(){return this.getAttr("minHeight")}getMaxWidth(){return this.getAttr("maxWidth")}getMaxHeight(){return this.getAttr("maxHeight")}isVisible(){return this.visible}toJson(){const e={};return qo.attributeDefinitions.toJson(e,this.attributes),e}saveScrollPosition(){this.moveableElement&&(this.scrollLeft=this.moveableElement.scrollLeft,this.scrollTop=this.moveableElement.scrollTop)}restoreScrollPosition(){this.scrollTop&&requestAnimationFrame(()=>{this.moveableElement&&this.scrollTop&&(this.moveableElement.scrollTop=this.scrollTop,this.moveableElement.scrollLeft=this.scrollLeft)})}setRect(e){e.equals(this.rect)||(this.fireEvent("resize",{rect:e}),this.rect=e)}setVisible(e){e!==this.visible&&(this.visible=e,this.fireEvent("visibility",{visible:e}))}getScrollTop(){return this.scrollTop}setScrollTop(e){this.scrollTop=e}getScrollLeft(){return this.scrollLeft}setScrollLeft(e){this.scrollLeft=e}isRendered(){return this.rendered}setRendered(e){this.rendered=e}getTabRect(){return this.tabRect}setTabRect(e){this.tabRect=e}getTabStamp(){return this.tabStamp}setTabStamp(e){this.tabStamp=e}getMoveableElement(){return this.moveableElement}setMoveableElement(e){this.moveableElement=e}setRenderedName(e){this.renderedName=e}getNameForOverflowMenu(){const e=this.getAttr("altName");return e!==void 0?e:this.renderedName}setName(e){this.attributes.name=e}delete(){this.parent.remove(this),this.fireEvent("close",{})}updateAttrs(e){qo.attributeDefinitions.update(e,this.attributes)}getAttributeDefinitions(){return qo.attributeDefinitions}setBorderWidth(e){this.attributes.borderWidth=e}setBorderHeight(e){this.attributes.borderHeight=e}static getAttributeDefinitions(){return qo.attributeDefinitions}static createAttributeDefinitions(){const e=new uf;return e.add("type",qo.TYPE,!0).setType(se.STRING).setFixed(),e.add("id",void 0).setType(se.STRING).setDescription("the unique id of the tab, if left undefined a uuid will be assigned"),e.add("name","[Unnamed Tab]").setType(se.STRING).setDescription("name of tab to be displayed in the tab button"),e.add("altName",void 0).setType(se.STRING).setDescription("if there is no name specifed then this value will be used in the overflow menu"),e.add("helpText",void 0).setType(se.STRING).setDescription("An optional help text for the tab to be displayed upon tab hover."),e.add("component",void 0).setType(se.STRING).setDescription("string identifying which component to run (for factory)"),e.add("config",void 0).setType("any").setDescription("a place to hold json config for the hosted component"),e.add("tabsetClassName",void 0).setType(se.STRING).setDescription("class applied to parent tabset when this is the only tab and it is stretched to fill the tabset"),e.add("enableWindowReMount",!1).setType(se.BOOLEAN).setDescription("if enabled the tab will re-mount when popped out/in"),e.addInherited("enableClose","tabEnableClose").setType(se.BOOLEAN).setDescription("allow user to close tab via close button"),e.addInherited("closeType","tabCloseType").setType("ICloseType").setDescription("see values in ICloseType"),e.addInherited("enableDrag","tabEnableDrag").setType(se.BOOLEAN).setDescription("allow user to drag tab to new location"),e.addInherited("enableRename","tabEnableRename").setType(se.BOOLEAN).setDescription("allow user to rename tabs by double clicking"),e.addInherited("className","tabClassName").setType(se.STRING).setDescription("class applied to tab button"),e.addInherited("contentClassName","tabContentClassName").setType(se.STRING).setDescription("class applied to tab content"),e.addInherited("icon","tabIcon").setType(se.STRING).setDescription("the tab icon"),e.addInherited("enableRenderOnDemand","tabEnableRenderOnDemand").setType(se.BOOLEAN).setDescription("whether to avoid rendering component until tab is visible"),e.addInherited("enablePopout","tabEnablePopout").setType(se.BOOLEAN).setAlias("enableFloat").setDescription("enable popout (in popout capable browser)"),e.addInherited("enablePopoutIcon","tabEnablePopoutIcon").setType(se.BOOLEAN).setDescription("whether to show the popout icon in the tabset header if this tab enables popouts"),e.addInherited("enablePopoutOverlay","tabEnablePopoutOverlay").setType(se.BOOLEAN).setDescription(`if this tab will not work correctly in a popout window when the main window is backgrounded (inactive)
            then enabling this option will gray out this tab`),e.addInherited("borderWidth","tabBorderWidth").setType(se.NUMBER).setDescription("width when added to border, -1 will use border size"),e.addInherited("borderHeight","tabBorderHeight").setType(se.NUMBER).setDescription("height when added to border, -1 will use border size"),e.addInherited("minWidth","tabMinWidth").setType(se.NUMBER).setDescription("the min width of this tab"),e.addInherited("minHeight","tabMinHeight").setType(se.NUMBER).setDescription("the min height of this tab"),e.addInherited("maxWidth","tabMaxWidth").setType(se.NUMBER).setDescription("the max width of this tab"),e.addInherited("maxHeight","tabMaxHeight").setType(se.NUMBER).setDescription("the max height of this tab"),e}};V(yv,"TYPE","tab");V(yv,"attributeDefinitions",yv.createAttributeDefinitions());let bt=yv;function Kz(){return typeof window<"u"&&window.matchMedia&&window.matchMedia("(hover: hover) and (pointer: fine)").matches}function qT(n,e,t){let s;const i=e.getName(),r=e.getName();t===void 0&&(t=0),s===void 0&&e.getIcon()!==void 0&&(t!==0?s=a.jsx("img",{style:{width:"1em",height:"1em",transform:"rotate("+t+"deg)"},src:e.getIcon(),alt:"leadingContent"}):s=a.jsx("img",{style:{width:"1em",height:"1em"},src:e.getIcon(),alt:"leadingContent"}));const l={leading:s,content:i,name:r,buttons:[]};return n.customizeTab(e,l),e.setRenderedName(l.name),l}function wp(n){let e=!1;return n.nativeEvent instanceof MouseEvent&&(n.nativeEvent.button!==0||n.ctrlKey||n.altKey||n.metaKey||n.shiftKey)&&(e=!0),e}function eC(n,e){const t=[...mR("iframe",e),...mR("webview",e)];for(const s of t)s.style.pointerEvents=n?"auto":"none"}function mR(n,e){return[...e.getElementsByTagName(n)]}function Yz(n,e,t,s,i){e.preventDefault();const r=c=>{c.preventDefault(),t(c.clientX,c.clientY)},o=c=>{c.preventDefault(),i()},l=()=>{n.removeEventListener("pointermove",r),n.removeEventListener("pointerup",l),n.removeEventListener("pointercancel",o),s()};n.addEventListener("pointermove",r),n.addEventListener("pointerup",l),n.addEventListener("pointercancel",o)}function Xz(n){if(n instanceof bt)return n.isEnablePopout();if(n instanceof ct){for(const e of n.getChildren())if(e.isEnablePopout()===!1)return!1;return!0}return!1}function yR(n,e){const t=n.getAttribute("style"),s=e.getAttribute("style");return t===s?!1:(t?e.setAttribute("style",t):e.removeAttribute("style"),!0)}function TCe(){const n=navigator.userAgent;return n.includes("Safari")&&!n.includes("Chrome")&&!n.includes("Chromium")}function vv(n,e){if(n!==void 0&&(n instanceof ct||n instanceof is)){const t=n.getSelected();t!==-1&&(e===t&&n.getChildren().length>0?e>=n.getChildren().length&&n.setSelected(n.getChildren().length-1):e<t?n.setSelected(t-1):e>t||n.setSelected(-1))}}function Fu(){return("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,n=>(n^crypto.getRandomValues(new Uint8Array(1))[0]&15>>n/4).toString(16))}const xv=class lr extends Xx{constructor(e,t){super(e),V(this,"tabStripRect",Ce.empty()),V(this,"contentRect",Ce.empty()),V(this,"calculatedMinHeight"),V(this,"calculatedMinWidth"),V(this,"calculatedMaxHeight"),V(this,"calculatedMaxWidth"),this.calculatedMinHeight=0,this.calculatedMinWidth=0,this.calculatedMaxHeight=0,this.calculatedMaxWidth=0,lr.attributeDefinitions.fromJson(t,this.attributes),e.addNode(this)}static fromJson(e,t,s){const i=new lr(t,e);if(e.children!=null)for(const r of e.children){const o=bt.fromJson(r,t);i.addChild(o)}return i.children.length===0&&i.setSelected(-1),e.maximized&&e.maximized===!0&&(s.maximizedTabSet=i),e.active&&e.active===!0&&(s.activeTabSet=i),i}getName(){return this.getAttr("name")}isEnableActiveIcon(){return this.getAttr("enableActiveIcon")}getSelected(){const e=this.attributes.selected;return e!==void 0?e:-1}getSelectedNode(){const e=this.getSelected();if(e!==-1)return this.children[e]}getWeight(){return this.getAttr("weight")}getAttrMinWidth(){return this.getAttr("minWidth")}getAttrMinHeight(){return this.getAttr("minHeight")}getMinWidth(){return this.calculatedMinWidth}getMinHeight(){return this.calculatedMinHeight}getMinSize(e){return e===Re.HORZ?this.getMinWidth():this.getMinHeight()}getAttrMaxWidth(){return this.getAttr("maxWidth")}getAttrMaxHeight(){return this.getAttr("maxHeight")}getMaxWidth(){return this.calculatedMaxWidth}getMaxHeight(){return this.calculatedMaxHeight}getMaxSize(e){return e===Re.HORZ?this.getMaxWidth():this.getMaxHeight()}getConfig(){return this.attributes.config}isMaximized(){return this.model.getMaximizedTabset(this.getWindowId())===this}isActive(){return this.model.getActiveTabset(this.getWindowId())===this}isEnableDeleteWhenEmpty(){return this.getAttr("enableDeleteWhenEmpty")}isEnableDrop(){return this.getAttr("enableDrop")}isEnableTabWrap(){return this.getAttr("enableTabWrap")}isEnableDrag(){return this.getAttr("enableDrag")}isEnableDivide(){return this.getAttr("enableDivide")}isEnableMaximize(){return this.getAttr("enableMaximize")}isEnableClose(){return this.getAttr("enableClose")}isEnableSingleTabStretch(){return this.getAttr("enableSingleTabStretch")}isEnableTabStrip(){return this.getAttr("enableTabStrip")}isAutoSelectTab(){return this.getAttr("autoSelectTab")}isEnableTabScrollbar(){return this.getAttr("enableTabScrollbar")}getClassNameTabStrip(){return this.getAttr("classNameTabStrip")}getTabLocation(){return this.getAttr("tabLocation")}toJson(){const e={};return lr.attributeDefinitions.toJson(e,this.attributes),e.children=this.children.map(t=>t.toJson()),this.isActive()&&(e.active=!0),this.isMaximized()&&(e.maximized=!0),e}calcMinMaxSize(){this.calculatedMinHeight=this.getAttrMinHeight(),this.calculatedMinWidth=this.getAttrMinWidth(),this.calculatedMaxHeight=this.getAttrMaxHeight(),this.calculatedMaxWidth=this.getAttrMaxWidth();for(const e of this.children){const t=e;this.calculatedMinWidth=Math.max(this.calculatedMinWidth,t.getMinWidth()),this.calculatedMinHeight=Math.max(this.calculatedMinHeight,t.getMinHeight()),this.calculatedMaxWidth=Math.min(this.calculatedMaxWidth,t.getMaxWidth()),this.calculatedMaxHeight=Math.min(this.calculatedMaxHeight,t.getMaxHeight())}this.calculatedMinHeight+=this.tabStripRect.height,this.calculatedMaxHeight+=this.tabStripRect.height}canMaximize(){return this.isEnableMaximize()?this.getModel().getMaximizedTabset(this.getWindowId())===this?!0:!(this.getParent()===this.getModel().getRoot(this.getWindowId())&&this.getModel().getRoot(this.getWindowId()).getChildren().length===1):!1}setContentRect(e){this.contentRect=e}getContentRect(){return this.contentRect}setTabStripRect(e){this.tabStripRect=e}setWeight(e){this.attributes.weight=e}setSelected(e){this.attributes.selected=e}getWindowId(){return this.parent.getWindowId()}canDrop(e,t,s){let i;if(e===this){const r=de.CENTER,o=this.tabStripRect;i=new ss(this,o,r,-1,Z.FLEXLAYOUT__OUTLINE_RECT)}else{if(this.getWindowId()!==zs.MAIN_WINDOW_ID&&!Xz(e))return;if(this.contentRect.contains(t,s)){let r=de.CENTER;this.model.getMaximizedTabset(this.parent.getWindowId())===void 0&&(r=de.getLocation(this.contentRect,t,s));const o=r.getDockRect(this.rect);i=new ss(this,o,r,-1,Z.FLEXLAYOUT__OUTLINE_RECT)}else if(this.tabStripRect!=null&&this.tabStripRect.contains(t,s)){let r,o,l;if(this.children.length===0)r=this.tabStripRect.clone(),o=r.y+3,l=r.height-4,r.width=2;else{let c=this.children[0];r=c.getTabRect(),o=r.y,l=r.height;let d=this.tabStripRect.x,u=0;for(let h=0;h<this.children.length;h++){if(c=this.children[h],r=c.getTabRect(),r.y!==o&&(o=r.y,d=this.tabStripRect.x),u=r.x+r.width/2,d<=t&&t<u&&r.y<s&&s<r.getBottom()){const p=de.CENTER,f=new Ce(r.x-2,r.y,3,r.height);if(this.rect.x<r.x&&r.x<this.rect.getRight()){i=new ss(this,f,p,h,Z.FLEXLAYOUT__OUTLINE_RECT);break}else return}d=u}}if(i==null&&r.getRight()<this.rect.getRight()){const c=de.CENTER,d=new Ce(r.getRight()-2,o,3,l);i=new ss(this,d,c,this.children.length,Z.FLEXLAYOUT__OUTLINE_RECT)}}}if(e.canDockInto(e,i))return i}delete(){this.parent.removeChild(this)}remove(e){const t=this.removeChild(e);this.model.tidy(),vv(this,t)}drop(e,t,s,i){const r=t;if(this===e)return;let o=e.getParent(),l=0;if(o!==void 0&&(l=o.removeChild(e),o instanceof is&&o.getSelected()===l?o.setSelected(-1):vv(o,l)),e instanceof bt&&o===this&&l<s&&s>0&&s--,r===de.CENTER){let c=s;if(c===-1&&(c=this.children.length),e instanceof bt)this.addChild(e,c),(i||i!==!1&&this.isAutoSelectTab())&&this.setSelected(c);else if(e instanceof xn)e.forEachNode((d,u)=>{d instanceof bt&&(this.addChild(d,c),c++)},0);else{for(let d=0;d<e.getChildren().length;d++){const u=e.getChildren()[d];this.addChild(u,c),c++}this.getSelected()===-1&&this.children.length>0&&this.setSelected(0)}this.model.setActiveTabset(this,this.parent.getWindowId())}else{let c=e;if(e instanceof bt){const h=this.model.getOnCreateTabSet();c=new lr(this.model,h?h(e):{}),c.addChild(e),o=c}else if(e instanceof xn){const h=this.getParent();if(e.getOrientation()===h.getOrientation()&&(t.getOrientation()===h.getOrientation()||t===de.CENTER)){const p=new xn(this.model,this.getWindowId(),{});p.addChild(e),c=p}}else c=e;const d=this.parent,u=d.getChildren().indexOf(this);if(d.getOrientation()===r.orientation)c.setWeight(this.getWeight()/2),this.setWeight(this.getWeight()/2),d.addChild(c,u+r.indexPlus);else{const h=new xn(this.model,this.getWindowId(),{});h.setWeight(this.getWeight()),h.addChild(this),this.setWeight(50),c.setWeight(50),h.addChild(c,r.indexPlus),d.removeChild(this),d.addChild(h,u)}c instanceof lr&&this.model.setActiveTabset(c,this.getWindowId())}this.model.tidy()}updateAttrs(e){lr.attributeDefinitions.update(e,this.attributes)}getAttributeDefinitions(){return lr.attributeDefinitions}static getAttributeDefinitions(){return lr.attributeDefinitions}static createAttributeDefinitions(){const e=new uf;return e.add("type",lr.TYPE,!0).setType(se.STRING).setFixed(),e.add("id",void 0).setType(se.STRING).setDescription("the unique id of the tab set, if left undefined a uuid will be assigned"),e.add("weight",100).setType(se.NUMBER).setDescription("relative weight for sizing of this tabset in parent row"),e.add("selected",0).setType(se.NUMBER).setDescription("index of selected/visible tab in tabset"),e.add("name",void 0).setType(se.STRING),e.add("config",void 0).setType("any").setDescription("a place to hold json config used in your own code"),e.addInherited("enableDeleteWhenEmpty","tabSetEnableDeleteWhenEmpty").setDescription("whether to delete this tabset when is has no tabs"),e.addInherited("enableDrop","tabSetEnableDrop").setDescription("allow user to drag tabs into this tabset"),e.addInherited("enableDrag","tabSetEnableDrag").setDescription("allow user to drag tabs out this tabset"),e.addInherited("enableDivide","tabSetEnableDivide").setDescription("allow user to drag tabs to region of this tabset, splitting into new tabset"),e.addInherited("enableMaximize","tabSetEnableMaximize").setDescription("allow user to maximize tabset to fill view via maximize button"),e.addInherited("enableClose","tabSetEnableClose").setDescription("allow user to close tabset via a close button"),e.addInherited("enableSingleTabStretch","tabSetEnableSingleTabStretch").setDescription("if the tabset has only a single tab then stretch the single tab to fill area and display in a header style"),e.addInherited("classNameTabStrip","tabSetClassNameTabStrip").setDescription("a class name to apply to the tab strip"),e.addInherited("enableTabStrip","tabSetEnableTabStrip").setDescription("enable tab strip and allow multiple tabs in this tabset"),e.addInherited("minWidth","tabSetMinWidth").setDescription("minimum width (in px) for this tabset"),e.addInherited("minHeight","tabSetMinHeight").setDescription("minimum height (in px) for this tabset"),e.addInherited("maxWidth","tabSetMaxWidth").setDescription("maximum width (in px) for this tabset"),e.addInherited("maxHeight","tabSetMaxHeight").setDescription("maximum height (in px) for this tabset"),e.addInherited("enableTabWrap","tabSetEnableTabWrap").setDescription("wrap tabs onto multiple lines"),e.addInherited("tabLocation","tabSetTabLocation").setDescription("the location of the tabs either top or bottom"),e.addInherited("autoSelectTab","tabSetAutoSelectTab").setType(se.BOOLEAN).setDescription("whether to select new/moved tabs in tabset"),e.addInherited("enableActiveIcon","tabSetEnableActiveIcon").setType(se.BOOLEAN).setDescription("whether the active icon (*) should be displayed when the tabset is active"),e.addInherited("enableTabScrollbar","tabSetEnableTabScrollbar").setType(se.BOOLEAN).setDescription("whether to show a mini scrollbar for the tabs"),e}};V(xv,"TYPE","tabset");V(xv,"attributeDefinitions",xv.createAttributeDefinitions());let ct=xv;const Sv=class en extends Xx{constructor(e,t,s){super(e),V(this,"windowId"),V(this,"minHeight"),V(this,"minWidth"),V(this,"maxHeight"),V(this,"maxWidth"),this.windowId=t,this.minHeight=Jr,this.minWidth=Jr,this.maxHeight=Qr,this.maxWidth=Qr,en.attributeDefinitions.fromJson(s,this.attributes),this.normalizeWeights(),e.addNode(this)}static fromJson(e,t,s){const i=new en(t,s.windowId,e);if(e.children!=null)for(const r of e.children)if(r.type===ct.TYPE){const o=ct.fromJson(r,t,s);i.addChild(o)}else{const o=en.fromJson(r,t,s);i.addChild(o)}return i}getWeight(){return this.attributes.weight}toJson(){const e={};en.attributeDefinitions.toJson(e,this.attributes),e.children=[];for(const t of this.children)e.children.push(t.toJson());return e}getWindowId(){return this.windowId}setWindowId(e){this.windowId=e}setWeight(e){this.attributes.weight=e}getSplitterBounds(e){const t=this.getOrientation()===Re.HORZ,s=this.getChildren(),i=this.model.getSplitterSize(),r=s[0].getRect(),o=s[s.length-1].getRect();let l=t?[r.x,o.getRight()]:[r.y,o.getBottom()];const c=t?[r.x,o.getRight()]:[r.y,o.getBottom()];for(let d=0;d<e;d++){const u=s[d];l[0]+=t?u.getMinWidth():u.getMinHeight(),c[0]+=t?u.getMaxWidth():u.getMaxHeight(),d>0&&(l[0]+=i,c[0]+=i)}for(let d=s.length-1;d>=e;d--){const u=s[d];l[1]-=(t?u.getMinWidth():u.getMinHeight())+i,c[1]-=(t?u.getMaxWidth():u.getMaxHeight())+i}return l=[Math.max(c[1],l[0]),Math.min(c[0],l[1])],l}getSplitterInitials(e){const t=this.getOrientation()===Re.HORZ,s=this.getChildren(),i=this.model.getSplitterSize(),r=[];let o=0;for(let d=0;d<s.length;d++){const h=s[d].getRect(),p=t?h.width:h.height;r.push(p),o+=p}const l=s[e].getRect(),c=(t?l.x:l.y)-i;return{initialSizes:r,sum:o,startPosition:c}}calculateSplit(e,t,s,i,r){const o=this.getOrientation()===Re.HORZ,l=this.getChildren(),c=l[e],d=o?c.getMaxWidth():c.getMaxHeight(),u=[...s];if(t<r){let p=r-t,f=0;u[e]+p>d?(f=u[e]+p-d,u[e]=d):u[e]+=p;for(let g=e-1;g>=0;g--){const m=l[g],x=o?m.getMinWidth():m.getMinHeight();if(u[g]-p>x){u[g]-=p;break}else p-=u[g]-x,u[g]=x}for(let g=e+1;g<l.length;g++){const m=l[g],x=o?m.getMaxWidth():m.getMaxHeight();if(u[g]+f<x){u[g]+=f;break}else f-=x-u[g],u[g]=x}}else{let p=t-r,f=0;u[e-1]+p>d?(f=u[e-1]+p-d,u[e-1]=d):u[e-1]+=p;for(let g=e;g<l.length;g++){const m=l[g],x=o?m.getMinWidth():m.getMinHeight();if(u[g]-p>x){u[g]-=p;break}else p-=u[g]-x,u[g]=x}for(let g=e-1;g>=0;g--){const m=l[g],x=o?m.getMaxWidth():m.getMaxHeight();if(u[g]+f<x){u[g]+=f;break}else f-=x-u[g],u[g]=x}}return u.map(p=>Math.max(.1,p)*100/i)}getMinSize(e){return e===Re.HORZ?this.getMinWidth():this.getMinHeight()}getMinWidth(){return this.minWidth}getMinHeight(){return this.minHeight}getMaxSize(e){return e===Re.HORZ?this.getMaxWidth():this.getMaxHeight()}getMaxWidth(){return this.maxWidth}getMaxHeight(){return this.maxHeight}calcMinMaxSize(){this.minHeight=Jr,this.minWidth=Jr,this.maxHeight=Qr,this.maxWidth=Qr;let e=!0;for(const t of this.children){const s=t;s.calcMinMaxSize(),this.getOrientation()===Re.VERT?(this.minHeight+=s.getMinHeight(),this.maxHeight+=s.getMaxHeight(),e||(this.minHeight+=this.model.getSplitterSize(),this.maxHeight+=this.model.getSplitterSize()),this.minWidth=Math.max(this.minWidth,s.getMinWidth()),this.maxWidth=Math.min(this.maxWidth,s.getMaxWidth())):(this.minWidth+=s.getMinWidth(),this.maxWidth+=s.getMaxWidth(),e||(this.minWidth+=this.model.getSplitterSize(),this.maxWidth+=this.model.getSplitterSize()),this.minHeight=Math.max(this.minHeight,s.getMinHeight()),this.maxHeight=Math.min(this.maxHeight,s.getMaxHeight())),e=!1}}tidy(){let e=0;for(;e<this.children.length;){const t=this.children[e];if(t instanceof en){t.tidy();const s=t.getChildren();if(s.length===0)this.removeChild(t);else if(s.length===1){const i=s[0];if(this.removeChild(t),i instanceof en){let r=0;const o=i.getChildren();for(const l of o)r+=l.getWeight();for(let l=0;l<o.length;l++){const c=o[l];c.setWeight(t.getWeight()*c.getWeight()/r),this.addChild(c,e+l)}}else i.setWeight(t.getWeight()),this.addChild(i,e)}else e++}else t instanceof ct&&t.getChildren().length===0&&t.isEnableDeleteWhenEmpty()?(this.removeChild(t),t===this.model.getMaximizedTabset(this.windowId)&&this.model.setMaximizedTabset(void 0,this.windowId)):e++}if(this===this.model.getRoot(this.windowId)&&this.children.length===0){const t=this.model.getOnCreateTabSet();let s=t?t():{};s={...s,selected:-1};const i=new ct(this.model,s);this.model.setActiveTabset(i,this.windowId),this.addChild(i)}}canDrop(e,t,s){const i=s-this.rect.y,r=t-this.rect.x,o=this.rect.width,l=this.rect.height,c=10,d=50;let u;if(!(this.getWindowId()!==zs.MAIN_WINDOW_ID&&!Xz(e))){if(this.model.isEnableEdgeDock()&&this.parent===void 0){if(t<this.rect.x+c&&i>l/2-d&&i<l/2+d){const h=de.LEFT,p=h.getDockRect(this.rect);p.width=p.width/2,u=new ss(this,p,h,-1,Z.FLEXLAYOUT__OUTLINE_RECT_EDGE)}else if(t>this.rect.getRight()-c&&i>l/2-d&&i<l/2+d){const h=de.RIGHT,p=h.getDockRect(this.rect);p.width=p.width/2,p.x+=p.width,u=new ss(this,p,h,-1,Z.FLEXLAYOUT__OUTLINE_RECT_EDGE)}else if(s<this.rect.y+c&&r>o/2-d&&r<o/2+d){const h=de.TOP,p=h.getDockRect(this.rect);p.height=p.height/2,u=new ss(this,p,h,-1,Z.FLEXLAYOUT__OUTLINE_RECT_EDGE)}else if(s>this.rect.getBottom()-c&&r>o/2-d&&r<o/2+d){const h=de.BOTTOM,p=h.getDockRect(this.rect);p.height=p.height/2,p.y+=p.height,u=new ss(this,p,h,-1,Z.FLEXLAYOUT__OUTLINE_RECT_EDGE)}if(u!==void 0&&!e.canDockInto(e,u))return}return u}}drop(e,t,s){const i=t,r=e.getParent();r&&r.removeChild(e),r!==void 0&&r instanceof ct&&r.setSelected(0),r!==void 0&&r instanceof is&&r.setSelected(-1);let o;if(e instanceof ct||e instanceof en)o=e,o instanceof en&&o.getOrientation()===this.getOrientation()&&(t.getOrientation()===this.getOrientation()||t===de.CENTER)&&(o=new en(this.model,this.windowId,{}),o.addChild(e));else{const d=this.model.getOnCreateTabSet();o=new ct(this.model,d?d(e):{}),o.addChild(e)}let l=this.children.reduce((d,u)=>d+u.getWeight(),0);l===0&&(l=100),o.setWeight(l/3);const c=!this.model.isRootOrientationVertical();if(i===de.CENTER)s===-1?this.addChild(o,this.children.length):this.addChild(o,s);else if(c&&i===de.LEFT||!c&&i===de.TOP)this.addChild(o,0);else if(c&&i===de.RIGHT||!c&&i===de.BOTTOM)this.addChild(o);else if(c&&i===de.TOP||!c&&i===de.LEFT){const d=new en(this.model,this.windowId,{}),u=new en(this.model,this.windowId,{});u.setWeight(75),o.setWeight(25);for(const h of this.children)u.addChild(h);this.removeAll(),d.addChild(o),d.addChild(u),this.addChild(d)}else if(c&&i===de.BOTTOM||!c&&i===de.RIGHT){const d=new en(this.model,this.windowId,{}),u=new en(this.model,this.windowId,{});u.setWeight(75),o.setWeight(25);for(const h of this.children)u.addChild(h);this.removeAll(),d.addChild(u),d.addChild(o),this.addChild(d)}o instanceof ct&&this.model.setActiveTabset(o,this.windowId),this.model.tidy()}isEnableDrop(){return!0}getAttributeDefinitions(){return en.attributeDefinitions}updateAttrs(e){en.attributeDefinitions.update(e,this.attributes)}static getAttributeDefinitions(){return en.attributeDefinitions}normalizeWeights(){let e=0;for(const t of this.children)e+=t.getWeight();e===0&&(e=1);for(const t of this.children){const s=t;s.setWeight(Math.max(.001,100*s.getWeight()/e))}}static createAttributeDefinitions(){const e=new uf;return e.add("type",en.TYPE,!0).setType(se.STRING).setFixed(),e.add("id",void 0).setType(se.STRING).setDescription("the unique id of the row, if left undefined a uuid will be assigned"),e.add("weight",100).setType(se.NUMBER).setDescription("relative weight for sizing of this row in parent row"),e}};V(Sv,"TYPE","row");V(Sv,"attributeDefinitions",Sv.createAttributeDefinitions());let xn=Sv;class dl{constructor(e,t){V(this,"_windowId"),V(this,"_layout"),V(this,"_rect"),V(this,"_window"),V(this,"_root"),V(this,"_maximizedTabSet"),V(this,"_activeTabSet"),V(this,"_toScreenRectFunction"),this._windowId=e,this._rect=t,this._toScreenRectFunction=s=>s}visitNodes(e){this.root.forEachNode(e,0)}get windowId(){return this._windowId}get rect(){return this._rect}get layout(){return this._layout}get window(){return this._window}get root(){return this._root}get maximizedTabSet(){return this._maximizedTabSet}get activeTabSet(){return this._activeTabSet}set rect(e){this._rect=e}set layout(e){this._layout=e}set window(e){this._window=e}set root(e){this._root=e}set maximizedTabSet(e){this._maximizedTabSet=e}set activeTabSet(e){this._activeTabSet=e}get toScreenRectFunction(){return this._toScreenRectFunction}set toScreenRectFunction(e){this._toScreenRectFunction=e}toJson(){return this._window&&this._window.screenTop>-1e4&&(this.rect=new Ce(this._window.screenLeft,this._window.screenTop,this._window.outerWidth,this._window.outerHeight)),{layout:this.root.toJson(),rect:this.rect.toJson()}}static fromJson(e,t,s){const i=t.getwindowsMap().size,r=e.rect?Ce.fromJson(e.rect):new Ce(50+50*i,50+50*i,600,400);r.snap(10);const o=new dl(s,r);return o.root=xn.fromJson(e.layout,t,o),o}}const Jr=0,Qr=99999,wv=class nt{constructor(){V(this,"attributes"),V(this,"idMap"),V(this,"changeListeners"),V(this,"borders"),V(this,"onAllowDrop"),V(this,"onCreateTabSet"),V(this,"windows"),V(this,"rootWindow"),this.attributes={},this.idMap=new Map,this.borders=new mv(this),this.windows=new Map,this.rootWindow=new dl(nt.MAIN_WINDOW_ID,Ce.empty()),this.windows.set(nt.MAIN_WINDOW_ID,this.rootWindow),this.changeListeners=[]}doAction(e){var t;let s;switch(e.type){case je.ADD_NODE:{const i=new bt(this,e.data.json,!0),r=this.idMap.get(e.data.toNode);(r instanceof ct||r instanceof is||r instanceof xn)&&(r.drop(i,de.getByName(e.data.location),e.data.index,e.data.select),s=i);break}case je.MOVE_NODE:{const i=this.idMap.get(e.data.fromNode);if(i instanceof bt||i instanceof ct||i instanceof xn){if(i===this.getMaximizedTabset(i.getWindowId())){const o=this.windows.get(i.getWindowId());o.maximizedTabSet=void 0}const r=this.idMap.get(e.data.toNode);(r instanceof ct||r instanceof is||r instanceof xn)&&r.drop(i,de.getByName(e.data.location),e.data.index,e.data.select)}this.removeEmptyWindows();break}case je.DELETE_TAB:{const i=this.idMap.get(e.data.node);i instanceof bt&&i.delete(),this.removeEmptyWindows();break}case je.DELETE_TABSET:{const i=this.idMap.get(e.data.node);if(i instanceof ct){const r=[...i.getChildren()];for(let o=0;o<r.length;o++){const l=r[o];l.isEnableClose()&&l.delete()}i.getChildren().length===0&&i.delete(),this.tidy()}this.removeEmptyWindows();break}case je.POPOUT_TABSET:{const i=this.idMap.get(e.data.node);if(i instanceof ct){const r=i.isMaximized(),o=this.windows.get(i.getWindowId()),l=Fu(),c=new dl(l,o.toScreenRectFunction(i.getRect())),d={type:"row",children:[]},u=xn.fromJson(d,this,c);c.root=u,this.windows.set(l,c),u.drop(i,de.CENTER,0),r&&(this.rootWindow.maximizedTabSet=void 0)}this.removeEmptyWindows();break}case je.POPOUT_TAB:{const i=this.idMap.get(e.data.node);if(i instanceof bt){const r=Fu();let o=Ce.empty();i.getParent()instanceof ct?o=i.getParent().getRect():o=i.getParent().getContentRect();const l=this.windows.get(i.getWindowId()),c=new dl(r,l.toScreenRectFunction(o)),d=Fu(),u={type:"row",children:[{type:"tabset",id:d}]},h=xn.fromJson(u,this,c);c.root=h,this.windows.set(r,c),this.idMap.get(d).drop(i,de.CENTER,0,!0)}this.removeEmptyWindows();break}case je.CLOSE_WINDOW:{const i=this.windows.get(e.data.windowId);i&&((t=this.rootWindow.root)==null||t.drop(i.root,de.CENTER,-1),this.rootWindow.visitNodes((r,o)=>{r instanceof xn&&r.setWindowId(nt.MAIN_WINDOW_ID)}),this.windows.delete(e.data.windowId));break}case je.CREATE_WINDOW:{const i=Fu(),r=new dl(i,Ce.fromJson(e.data.rect)),o=xn.fromJson(e.data.layout,this,r);r.root=o,this.windows.set(i,r),s=i;break}case je.RENAME_TAB:{const i=this.idMap.get(e.data.node);i instanceof bt&&i.setName(e.data.text);break}case je.SELECT_TAB:{const i=this.idMap.get(e.data.tabNode),r=e.data.windowId?e.data.windowId:nt.MAIN_WINDOW_ID,o=this.windows.get(r);if(i instanceof bt){const l=i.getParent(),c=l.getChildren().indexOf(i);l instanceof is?l.getSelected()===c?l.setSelected(-1):l.setSelected(c):l instanceof ct&&(l.getSelected()!==c&&l.setSelected(c),o.activeTabSet=l)}break}case je.SET_ACTIVE_TABSET:{const i=e.data.windowId?e.data.windowId:nt.MAIN_WINDOW_ID,r=this.windows.get(i);if(e.data.tabsetNode===void 0)r.activeTabSet=void 0;else{const o=this.idMap.get(e.data.tabsetNode);o instanceof ct&&(r.activeTabSet=o)}break}case je.ADJUST_WEIGHTS:{const r=this.idMap.get(e.data.nodeId).getChildren();for(let o=0;o<r.length;o++)r[o].setWeight(e.data.weights[o]);break}case je.ADJUST_BORDER_SPLIT:{const i=this.idMap.get(e.data.node);i instanceof is&&i.setSize(e.data.pos);break}case je.MAXIMIZE_TOGGLE:{const i=e.data.windowId?e.data.windowId:nt.MAIN_WINDOW_ID,r=this.windows.get(i),o=this.idMap.get(e.data.node);o instanceof ct&&(o===r.maximizedTabSet?r.maximizedTabSet=void 0:(r.maximizedTabSet=o,r.activeTabSet=o));break}case je.UPDATE_MODEL_ATTRIBUTES:{this.updateAttrs(e.data.json);break}case je.UPDATE_NODE_ATTRIBUTES:{this.idMap.get(e.data.node).updateAttrs(e.data.json);break}}this.updateIdMap();for(const i of this.changeListeners)i(e);return s}getActiveTabset(e=nt.MAIN_WINDOW_ID){const t=this.windows.get(e);if(t&&t.activeTabSet&&this.getNodeById(t.activeTabSet.getId()))return t.activeTabSet}getMaximizedTabset(e=nt.MAIN_WINDOW_ID){return this.windows.get(e).maximizedTabSet}getRoot(e=nt.MAIN_WINDOW_ID){return this.windows.get(e).root}isRootOrientationVertical(){return this.attributes.rootOrientationVertical}isEnableRotateBorderIcons(){return this.attributes.enableRotateBorderIcons}getBorderSet(){return this.borders}getwindowsMap(){return this.windows}visitNodes(e){this.borders.forEachNode(e);for(const[t,s]of this.windows)s.root.forEachNode(e,0)}visitWindowNodes(e,t){this.windows.has(e)&&(e===nt.MAIN_WINDOW_ID&&this.borders.forEachNode(t),this.windows.get(e).visitNodes(t))}getNodeById(e){return this.idMap.get(e)}getFirstTabSet(e=this.windows.get(nt.MAIN_WINDOW_ID).root){const t=e.getChildren()[0];return t instanceof ct?t:this.getFirstTabSet(t)}static fromJson(e){const t=new nt;if(nt.attributeDefinitions.fromJson(e.global,t.attributes),e.borders&&(t.borders=mv.fromJson(e.borders,t)),e.popouts)for(const s in e.popouts){const i=e.popouts[s],r=dl.fromJson(i,t,s);t.windows.set(s,r)}return t.rootWindow.root=xn.fromJson(e.layout,t,t.getwindowsMap().get(nt.MAIN_WINDOW_ID)),t.tidy(),t}toJson(){const e={};nt.attributeDefinitions.toJson(e,this.attributes),this.visitNodes(s=>{s.fireEvent("save",{})});const t={};for(const[s,i]of this.windows)s!==nt.MAIN_WINDOW_ID&&(t[s]=i.toJson());return{global:e,borders:this.borders.toJson(),layout:this.rootWindow.root.toJson(),popouts:t}}getSplitterSize(){return this.attributes.splitterSize}getSplitterExtra(){return this.attributes.splitterExtra}isEnableEdgeDock(){return this.attributes.enableEdgeDock}isSplitterEnableHandle(){return this.attributes.splitterEnableHandle}setOnAllowDrop(e){this.onAllowDrop=e}setOnCreateTabSet(e){this.onCreateTabSet=e}addChangeListener(e){this.changeListeners.push(e)}removeChangeListener(e){const t=this.changeListeners.findIndex(s=>s===e);t!==-1&&this.changeListeners.splice(t,1)}toString(){return JSON.stringify(this.toJson())}removeEmptyWindows(){const e=new Set;for(const[t]of this.windows)if(t!==nt.MAIN_WINDOW_ID){let s=0;this.visitWindowNodes(t,i=>{i instanceof bt&&s++}),s===0&&e.add(t)}for(const t of e)this.windows.delete(t)}setActiveTabset(e,t){const s=this.windows.get(t);s&&(e?s.activeTabSet=e:s.activeTabSet=void 0)}setMaximizedTabset(e,t){const s=this.windows.get(t);s&&(e?s.maximizedTabSet=e:s.maximizedTabSet=void 0)}updateIdMap(){this.idMap.clear(),this.visitNodes(e=>{this.idMap.set(e.getId(),e)})}addNode(e){const t=e.getId();if(this.idMap.has(t))throw new Error(`Error: each node must have a unique id, duplicate id:${e.getId()}`);this.idMap.set(t,e)}findDropTargetNode(e,t,s,i){let r=this.windows.get(e).root.findDropTargetNode(e,t,s,i);return r===void 0&&e===nt.MAIN_WINDOW_ID&&(r=this.borders.findDropTargetNode(t,s,i)),r}tidy(){for(const[e,t]of this.windows)t.root.tidy()}updateAttrs(e){nt.attributeDefinitions.update(e,this.attributes)}nextUniqueId(){return"#"+Fu()}getAttribute(e){return this.attributes[e]}getOnAllowDrop(){return this.onAllowDrop}getOnCreateTabSet(){return this.onCreateTabSet}static toTypescriptInterfaces(){nt.attributeDefinitions.pairAttributes("RowNode",xn.getAttributeDefinitions()),nt.attributeDefinitions.pairAttributes("TabSetNode",ct.getAttributeDefinitions()),nt.attributeDefinitions.pairAttributes("TabNode",bt.getAttributeDefinitions()),nt.attributeDefinitions.pairAttributes("BorderNode",is.getAttributeDefinitions());const e=[];e.push(nt.attributeDefinitions.toTypescriptInterface("Global",void 0)),e.push(xn.getAttributeDefinitions().toTypescriptInterface("Row",nt.attributeDefinitions)),e.push(ct.getAttributeDefinitions().toTypescriptInterface("TabSet",nt.attributeDefinitions)),e.push(bt.getAttributeDefinitions().toTypescriptInterface("Tab",nt.attributeDefinitions)),e.push(is.getAttributeDefinitions().toTypescriptInterface("Border",nt.attributeDefinitions)),console.log(e.join(`
`))}static createAttributeDefinitions(){const e=new uf;return e.add("enableEdgeDock",!0).setType(se.BOOLEAN).setDescription("enable docking to the edges of the layout, this will show the edge indicators"),e.add("rootOrientationVertical",!1).setType(se.BOOLEAN).setDescription("the top level 'row' will layout horizontally by default, set this option true to make it layout vertically"),e.add("enableRotateBorderIcons",!0).setType(se.BOOLEAN).setDescription("boolean indicating if tab icons should rotate with the text in the left and right borders"),e.add("splitterSize",8).setType(se.NUMBER).setDescription("width in pixels of all splitters between tabsets/borders"),e.add("splitterExtra",0).setType(se.NUMBER).setDescription("additional width in pixels of the splitter hit test area"),e.add("splitterEnableHandle",!1).setType(se.BOOLEAN).setDescription("enable a small centralized handle on all splitters"),e.add("tabEnableClose",!0).setType(se.BOOLEAN),e.add("tabCloseType",1).setType("ICloseType"),e.add("tabEnablePopout",!1).setType(se.BOOLEAN).setAlias("tabEnableFloat"),e.add("tabEnablePopoutIcon",!0).setType(se.BOOLEAN),e.add("tabEnablePopoutOverlay",!1).setType(se.BOOLEAN),e.add("tabEnableDrag",!0).setType(se.BOOLEAN),e.add("tabEnableRename",!0).setType(se.BOOLEAN),e.add("tabContentClassName",void 0).setType(se.STRING),e.add("tabClassName",void 0).setType(se.STRING),e.add("tabIcon",void 0).setType(se.STRING),e.add("tabEnableRenderOnDemand",!0).setType(se.BOOLEAN),e.add("tabDragSpeed",.3).setType(se.NUMBER),e.add("tabBorderWidth",-1).setType(se.NUMBER),e.add("tabBorderHeight",-1).setType(se.NUMBER),e.add("tabSetEnableDeleteWhenEmpty",!0).setType(se.BOOLEAN),e.add("tabSetEnableDrop",!0).setType(se.BOOLEAN),e.add("tabSetEnableDrag",!0).setType(se.BOOLEAN),e.add("tabSetEnableDivide",!0).setType(se.BOOLEAN),e.add("tabSetEnableMaximize",!0).setType(se.BOOLEAN),e.add("tabSetEnableClose",!1).setType(se.BOOLEAN),e.add("tabSetEnableSingleTabStretch",!1).setType(se.BOOLEAN),e.add("tabSetAutoSelectTab",!0).setType(se.BOOLEAN),e.add("tabSetEnableActiveIcon",!1).setType(se.BOOLEAN),e.add("tabSetClassNameTabStrip",void 0).setType(se.STRING),e.add("tabSetEnableTabStrip",!0).setType(se.BOOLEAN),e.add("tabSetEnableTabWrap",!1).setType(se.BOOLEAN),e.add("tabSetTabLocation","top").setType("ITabLocation"),e.add("tabMinWidth",Jr).setType(se.NUMBER),e.add("tabMinHeight",Jr).setType(se.NUMBER),e.add("tabSetMinWidth",Jr).setType(se.NUMBER),e.add("tabSetMinHeight",Jr).setType(se.NUMBER),e.add("tabMaxWidth",Qr).setType(se.NUMBER),e.add("tabMaxHeight",Qr).setType(se.NUMBER),e.add("tabSetMaxWidth",Qr).setType(se.NUMBER),e.add("tabSetMaxHeight",Qr).setType(se.NUMBER),e.add("tabSetEnableTabScrollbar",!1).setType(se.BOOLEAN),e.add("borderSize",200).setType(se.NUMBER),e.add("borderMinSize",Jr).setType(se.NUMBER),e.add("borderMaxSize",Qr).setType(se.NUMBER),e.add("borderEnableDrop",!0).setType(se.BOOLEAN),e.add("borderAutoSelectTabWhenOpen",!0).setType(se.BOOLEAN),e.add("borderAutoSelectTabWhenClosed",!1).setType(se.BOOLEAN),e.add("borderClassName",void 0).setType(se.STRING),e.add("borderEnableAutoHide",!1).setType(se.BOOLEAN),e.add("borderEnableTabScrollbar",!1).setType(se.BOOLEAN),e}};V(wv,"MAIN_WINDOW_ID","__main_window_id__");V(wv,"attributeDefinitions",wv.createAttributeDefinitions());let zs=wv;const bv=class Vr extends Xx{constructor(e,t,s){super(s),V(this,"contentRect",Ce.empty()),V(this,"tabHeaderRect",Ce.empty()),V(this,"location"),this.location=e,this.attributes.id=`border_${e.getName()}`,Vr.attributeDefinitions.fromJson(t,this.attributes),s.addNode(this)}static fromJson(e,t){const s=de.getByName(e.location),i=new Vr(s,e,t);return e.children&&(i.children=e.children.map(r=>{const o=bt.fromJson(r,t);return o.setParent(i),o})),i}getLocation(){return this.location}getClassName(){return this.getAttr("className")}isHorizontal(){return this.location.orientation===Re.HORZ}getSize(){const e=this.getAttr("size"),t=this.getSelected();if(t===-1)return e;{const s=this.children[t],i=this.isHorizontal()?s.getAttr("borderWidth"):s.getAttr("borderHeight");return i===-1?e:i}}getMinSize(){const e=this.getSelectedNode();let t=this.getAttr("minSize");if(e){const s=this.isHorizontal()?e.getMinWidth():e.getMinHeight();t=Math.max(t,s)}return t}getMaxSize(){const e=this.getSelectedNode();let t=this.getAttr("maxSize");if(e){const s=this.isHorizontal()?e.getMaxWidth():e.getMaxHeight();t=Math.min(t,s)}return t}getSelected(){return this.attributes.selected}isAutoHide(){return this.getAttr("enableAutoHide")}getSelectedNode(){if(this.getSelected()!==-1)return this.children[this.getSelected()]}getOrientation(){return this.location.getOrientation()}getConfig(){return this.attributes.config}isMaximized(){return!1}isShowing(){return this.attributes.show}toJson(){const e={};return Vr.attributeDefinitions.toJson(e,this.attributes),e.location=this.location.getName(),e.children=this.children.map(t=>t.toJson()),e}isAutoSelectTab(e){return e==null&&(e=this.getSelected()!==-1),e?this.getAttr("autoSelectTabWhenOpen"):this.getAttr("autoSelectTabWhenClosed")}isEnableTabScrollbar(){return this.getAttr("enableTabScrollbar")}setSelected(e){this.attributes.selected=e}getTabHeaderRect(){return this.tabHeaderRect}setTabHeaderRect(e){this.tabHeaderRect=e}getRect(){return this.tabHeaderRect}getContentRect(){return this.contentRect}setContentRect(e){this.contentRect=e}isEnableDrop(){return this.getAttr("enableDrop")}setSize(e){const t=this.getSelected();if(t===-1)this.attributes.size=e;else{const s=this.children[t];(this.isHorizontal()?s.getAttr("borderWidth"):s.getAttr("borderHeight"))===-1?this.attributes.size=e:this.isHorizontal()?s.setBorderWidth(e):s.setBorderHeight(e)}}updateAttrs(e){Vr.attributeDefinitions.update(e,this.attributes)}remove(e){const t=this.removeChild(e);this.getSelected()!==-1&&vv(this,t)}canDrop(e,t,s){if(!(e instanceof bt))return;let i;const r=de.CENTER;if(this.tabHeaderRect.contains(t,s)){if(this.location.orientation===Re.VERT)if(this.children.length>0){let o=this.children[0],l=o.getTabRect();const c=l.y,d=l.height;let u=this.tabHeaderRect.x,h=0;for(let p=0;p<this.children.length;p++){if(o=this.children[p],l=o.getTabRect(),h=l.x+l.width/2,t>=u&&t<h){const f=new Ce(l.x-2,c,3,d);i=new ss(this,f,r,p,Z.FLEXLAYOUT__OUTLINE_RECT);break}u=h}if(i==null){const p=new Ce(l.getRight()-2,c,3,d);i=new ss(this,p,r,this.children.length,Z.FLEXLAYOUT__OUTLINE_RECT)}}else{const o=new Ce(this.tabHeaderRect.x+1,this.tabHeaderRect.y+2,3,18);i=new ss(this,o,r,0,Z.FLEXLAYOUT__OUTLINE_RECT)}else if(this.children.length>0){let o=this.children[0],l=o.getTabRect();const c=l.x,d=l.width;let u=this.tabHeaderRect.y,h=0;for(let p=0;p<this.children.length;p++){if(o=this.children[p],l=o.getTabRect(),h=l.y+l.height/2,s>=u&&s<h){const f=new Ce(c,l.y-2,d,3);i=new ss(this,f,r,p,Z.FLEXLAYOUT__OUTLINE_RECT);break}u=h}if(i==null){const p=new Ce(c,l.getBottom()-2,d,3);i=new ss(this,p,r,this.children.length,Z.FLEXLAYOUT__OUTLINE_RECT)}}else{const o=new Ce(this.tabHeaderRect.x+2,this.tabHeaderRect.y+1,18,3);i=new ss(this,o,r,0,Z.FLEXLAYOUT__OUTLINE_RECT)}if(!e.canDockInto(e,i))return}else if(this.getSelected()!==-1&&this.contentRect.contains(t,s)){const o=this.contentRect;if(i=new ss(this,o,r,-1,Z.FLEXLAYOUT__OUTLINE_RECT),!e.canDockInto(e,i))return}return i}drop(e,t,s,i){let r=0;const o=e.getParent();o!==void 0&&(r=o.removeChild(e),o!==this&&o instanceof Vr&&o.getSelected()===r?o.setSelected(-1):vv(o,r)),e instanceof bt&&o===this&&r<s&&s>0&&s--;let l=s;l===-1&&(l=this.children.length),e instanceof bt&&this.addChild(e,l),(i||i!==!1&&this.isAutoSelectTab())&&this.setSelected(l),this.model.tidy()}getSplitterBounds(e,t=!1){const s=[0,0],i=t?this.getMinSize():0,r=t?this.getMaxSize():99999,o=this.model.getRoot(zs.MAIN_WINDOW_ID),l=o.getRect(),c=this.model.getSplitterSize();if(this.location===de.TOP){s[0]=this.tabHeaderRect.getBottom()+i;const d=this.tabHeaderRect.getBottom()+r;s[1]=Math.max(s[0],l.getBottom()-o.getMinHeight()-c),s[1]=Math.min(s[1],d)}else if(this.location===de.LEFT){s[0]=this.tabHeaderRect.getRight()+i;const d=this.tabHeaderRect.getRight()+r;s[1]=Math.max(s[0],l.getRight()-o.getMinWidth()-c),s[1]=Math.min(s[1],d)}else if(this.location===de.BOTTOM){s[1]=this.tabHeaderRect.y-i-c;const d=this.tabHeaderRect.y-r-c;s[0]=Math.min(s[1],l.y+o.getMinHeight()),s[0]=Math.max(s[0],d)}else if(this.location===de.RIGHT){s[1]=this.tabHeaderRect.x-i-c;const d=this.tabHeaderRect.x-r-c;s[0]=Math.min(s[1],l.x+o.getMinWidth()),s[0]=Math.max(s[0],d)}return s}calculateSplit(e,t){const s=this.getSplitterBounds(t);return this.location===de.BOTTOM||this.location===de.RIGHT?Math.max(0,s[1]-t):Math.max(0,t-s[0])}getAttributeDefinitions(){return Vr.attributeDefinitions}static getAttributeDefinitions(){return Vr.attributeDefinitions}static createAttributeDefinitions(){const e=new uf;return e.add("type",Vr.TYPE,!0).setType(se.STRING).setFixed(),e.add("selected",-1).setType(se.NUMBER).setDescription("index of selected/visible tab in border; -1 means no tab selected"),e.add("show",!0).setType(se.BOOLEAN).setDescription("show/hide this border"),e.add("config",void 0).setType("any").setDescription("a place to hold json config used in your own code"),e.addInherited("enableDrop","borderEnableDrop").setType(se.BOOLEAN).setDescription("whether tabs can be dropped into this border"),e.addInherited("className","borderClassName").setType(se.STRING).setDescription("class applied to tab button"),e.addInherited("autoSelectTabWhenOpen","borderAutoSelectTabWhenOpen").setType(se.BOOLEAN).setDescription("whether to select new/moved tabs in border when the border is already open"),e.addInherited("autoSelectTabWhenClosed","borderAutoSelectTabWhenClosed").setType(se.BOOLEAN).setDescription("whether to select new/moved tabs in border when the border is currently closed"),e.addInherited("size","borderSize").setType(se.NUMBER).setDescription("size of the tab area when selected"),e.addInherited("minSize","borderMinSize").setType(se.NUMBER).setDescription("the minimum size of the tab area"),e.addInherited("maxSize","borderMaxSize").setType(se.NUMBER).setDescription("the maximum size of the tab area"),e.addInherited("enableAutoHide","borderEnableAutoHide").setType(se.BOOLEAN).setDescription("hide border if it has zero tabs"),e.addInherited("enableTabScrollbar","borderEnableTabScrollbar").setType(se.BOOLEAN).setDescription("whether to show a mini scrollbar for the tabs"),e}};V(bv,"TYPE","border");V(bv,"attributeDefinitions",bv.createAttributeDefinitions());let is=bv,Rh=!1;const tC=n=>{const{layout:e,node:t,index:s,horizontal:i}=n,[r,o]=b.useState(!1),l=b.useRef(null),c=b.useRef(null),d=b.useRef([]),u=b.useRef(void 0),h=b.useRef(void 0),p=b.useRef(0),f=b.useRef(0),g=b.useRef({initialSizes:[],sum:0,startPosition:0}),m=t.getModel().getSplitterSize();let x=t.getModel().getSplitterExtra();Kz()||(x=Math.max(20,x+m)-m),b.useEffect(()=>{var R,A;return(R=l.current)==null||R.addEventListener("touchstart",y,{passive:!1}),(A=c.current)==null||A.addEventListener("touchstart",y,{passive:!1}),()=>{var N,B;(N=l.current)==null||N.removeEventListener("touchstart",y),(B=c.current)==null||B.removeEventListener("touchstart",y)}},[]);const y=R=>{R.preventDefault(),R.stopImmediatePropagation()},S=R=>{var A;R.stopPropagation(),t instanceof xn&&(g.current=t.getSplitterInitials(s)),eC(!1,e.getCurrentDocument()),Yz(R.currentTarget.ownerDocument,R,C,T,v),d.current=t.getSplitterBounds(s,!0);const N=e.getRootDiv();u.current=e.getCurrentDocument().createElement("div"),u.current.style.flexDirection=i?"row":"column",u.current.className=e.getClassName(Z.FLEXLAYOUT__SPLITTER_DRAG),u.current.style.cursor=t.getOrientation()===Re.VERT?"ns-resize":"ew-resize",t.getModel().isSplitterEnableHandle()&&(h.current=e.getCurrentDocument().createElement("div"),h.current.className=P(Z.FLEXLAYOUT__SPLITTER_HANDLE)+" "+P(i?Z.FLEXLAYOUT__SPLITTER_HANDLE_HORZ:Z.FLEXLAYOUT__SPLITTER_HANDLE_VERT),u.current.appendChild(h.current));const B=(A=l.current)==null?void 0:A.getBoundingClientRect(),L=new Ce(B.x-e.getDomRect().x,B.y-e.getDomRect().y,B.width,B.height);p.current=R.clientX-B.x,f.current=R.clientY-B.y,L.positionElement(u.current),N&&N.appendChild(u.current),o(!0),Rh=!0},v=()=>{const R=e.getRootDiv();R&&u.current&&R.removeChild(u.current),u.current=void 0,o(!1),Rh=!1},C=(R,A)=>{if(u.current){const N=e.getDomRect();if(!N)return;t.getOrientation()===Re.VERT?u.current.style.top=E(A-N.y-f.current)+"px":u.current.style.left=E(R-N.x-p.current)+"px",e.isRealtimeResize()&&I()}},T=()=>{if(u.current){I();const R=e.getRootDiv();R&&u.current&&R.removeChild(u.current),u.current=void 0}eC(!0,e.getCurrentDocument()),o(!1),Rh=!1},I=R=>{(()=>{if(u.current){let N=0;if(t.getOrientation()===Re.VERT?N=u.current.offsetTop:N=u.current.offsetLeft,t instanceof is){const B=t.calculateSplit(t,N);e.doAction(je.adjustBorderSplit(t.getId(),B))}else{const B=g.current,L=t.calculateSplit(s,N,B.initialSizes,B.sum,B.startPosition);e.doAction(je.adjustWeights(t.getId(),L))}}})()},E=R=>{const A=d.current;let N=R;return R<A[0]&&(N=A[0]),R>A[1]&&(N=A[1]),N},P=e.getClassName,k={cursor:i?"ew-resize":"ns-resize",flexDirection:i?"column":"row"};let j=P(Z.FLEXLAYOUT__SPLITTER)+" "+P(Z.FLEXLAYOUT__SPLITTER_+t.getOrientation().getName());t instanceof is?j+=" "+P(Z.FLEXLAYOUT__SPLITTER_BORDER):t.getModel().getMaximizedTabset(e.getWindowId())!==void 0&&(k.display="none"),i?(k.width=m+"px",k.minWidth=m+"px"):(k.height=m+"px",k.minHeight=m+"px");let D;if(!r&&t.getModel().isSplitterEnableHandle()&&(D=a.jsx("div",{className:P(Z.FLEXLAYOUT__SPLITTER_HANDLE)+" "+P(i?Z.FLEXLAYOUT__SPLITTER_HANDLE_HORZ:Z.FLEXLAYOUT__SPLITTER_HANDLE_VERT)})),x===0)return a.jsx("div",{className:j,style:k,ref:l,"data-layout-path":t.getPath()+"/s"+(s-1),onPointerDown:S,children:D});{const R={};t.getOrientation()===Re.HORZ?(R.height="100%",R.width=m+x+"px",R.cursor="ew-resize"):(R.height=m+x+"px",R.width="100%",R.cursor="ns-resize");const A=P(Z.FLEXLAYOUT__SPLITTER_EXTRA);return a.jsx("div",{className:j,style:k,ref:l,"data-layout-path":t.getPath()+"/s"+(s-1),onPointerDown:S,children:a.jsx("div",{style:R,ref:c,className:A,onPointerDown:S})})}};function ICe(n){const{layout:e,border:t,show:s}=n,i=b.useRef(null),r=b.useRef(void 0);b.useLayoutEffect(()=>{const d=e.getBoundingClientRect(i.current);!isNaN(d.x)&&d.width>0&&(t.getContentRect().equals(d)||(t.setContentRect(d),Rh?(r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{e.redrawInternal("border content rect "+d),r.current=void 0},50)):e.redrawInternal("border content rect "+d)))});let o=!0;const l={};t.getOrientation()===Re.HORZ?(l.width=t.getSize(),l.minWidth=t.getMinSize(),l.maxWidth=t.getMaxSize()):(l.height=t.getSize(),l.minHeight=t.getMinSize(),l.maxHeight=t.getMaxSize(),o=!1),l.display=s?"flex":"none";const c=e.getClassName(Z.FLEXLAYOUT__BORDER_TAB_CONTENTS);return t.getLocation()===de.LEFT||t.getLocation()===de.TOP?a.jsxs(a.Fragment,{children:[a.jsx("div",{ref:i,style:l,className:c}),s&&a.jsx(tC,{layout:e,node:t,index:0,horizontal:o})]}):a.jsxs(a.Fragment,{children:[s&&a.jsx(tC,{layout:e,node:t,index:0,horizontal:o}),a.jsx("div",{ref:i,style:l,className:c})]})}var bp=(n=>(n[n.Visible=1]="Visible",n[n.Always=2]="Always",n[n.Selected=3]="Selected",n))(bp||{});const PCe=n=>{const{layout:e,node:t,selected:s,border:i,icons:r,path:o}=n,l=b.useRef(null),c=b.useRef(null),d=k=>{t.isEnableDrag()?(k.stopPropagation(),e.setDragNode(k.nativeEvent,t)):k.preventDefault()},u=k=>{k.stopPropagation(),e.clearDragMain()},h=k=>{wp(k)&&e.auxMouseClick(t,k)},p=k=>{e.showContextMenu(t,k)},f=()=>{e.doAction(je.selectTab(t.getId()))},g=()=>{const k=t.getCloseType();return!!(s||k===bp.Always||k===bp.Visible&&window.matchMedia&&window.matchMedia("(hover: hover) and (pointer: fine)").matches)},m=k=>{g()&&(e.doAction(je.deleteTab(t.getId())),k.stopPropagation())},x=k=>{k.stopPropagation()};b.useLayoutEffect(()=>{t.setTabRect(e.getBoundingClientRect(l.current)),e.getEditingTab()===t&&c.current.select()});const y=k=>{k.stopPropagation()},S=k=>{k.code==="Escape"?e.setEditingTab(void 0):(k.code==="Enter"||k.code==="NumpadEnter")&&(e.setEditingTab(void 0),e.doAction(je.renameTab(t.getId(),k.target.value)))},v=e.getClassName;let C=v(Z.FLEXLAYOUT__BORDER_BUTTON)+" "+v(Z.FLEXLAYOUT__BORDER_BUTTON_+i);s?C+=" "+v(Z.FLEXLAYOUT__BORDER_BUTTON__SELECTED):C+=" "+v(Z.FLEXLAYOUT__BORDER_BUTTON__UNSELECTED),t.getClassName()!==void 0&&(C+=" "+t.getClassName());let T=0;t.getModel().isEnableRotateBorderIcons()===!1&&(i==="left"?T=90:i==="right"&&(T=-90));const I=qT(e,t,T);let E=I.content?a.jsx("div",{className:v(Z.FLEXLAYOUT__BORDER_BUTTON_CONTENT),children:I.content}):null;const P=I.leading?a.jsx("div",{className:v(Z.FLEXLAYOUT__BORDER_BUTTON_LEADING),children:I.leading}):null;if(e.getEditingTab()===t&&(E=a.jsx("input",{ref:c,className:v(Z.FLEXLAYOUT__TAB_BUTTON_TEXTBOX),"data-layout-path":o+"/textbox",type:"text",autoFocus:!0,defaultValue:t.getName(),onKeyDown:S,onPointerDown:y})),t.isEnableClose()){const k=e.i18nName(Un.Close_Tab);I.buttons.push(a.jsx("div",{"data-layout-path":o+"/button/close",title:k,className:v(Z.FLEXLAYOUT__BORDER_BUTTON_TRAILING),onPointerDown:x,onClick:m,children:typeof r.close=="function"?r.close(t):r.close},"close"))}return a.jsxs("div",{ref:l,"data-layout-path":o,className:C,onClick:f,onAuxClick:h,onContextMenu:p,title:t.getHelpText(),draggable:!0,onDragStart:d,onDragEnd:u,children:[P,E,I.buttons]})},_v=n=>{const{layout:e,node:t}=n,s=e.getClassName,i=s(Z.FLEXLAYOUT__TAB_BUTTON_STAMP),r=qT(e,t),o=r.content?a.jsx("div",{className:s(Z.FLEXLAYOUT__TAB_BUTTON_CONTENT),children:r.content}):t.getNameForOverflowMenu(),l=r.leading?a.jsx("div",{className:s(Z.FLEXLAYOUT__TAB_BUTTON_LEADING),children:r.leading}):null;return a.jsxs("div",{className:i,title:t.getHelpText(),children:[l,o]})};function qz(n,e,t,s,i){const r=i.getRootDiv(),o=i.getClassName,l=n.ownerDocument,c=n.getBoundingClientRect(),d=(r==null?void 0:r.getBoundingClientRect())??new DOMRect(0,0,100,100),u=l.createElement("div");u.className=o(Z.FLEXLAYOUT__POPUP_MENU_CONTAINER),c.left<d.left+d.width/2?u.style.left=c.left-d.left+"px":u.style.right=d.right-c.right+"px",c.top<d.top+d.height/2?u.style.top=c.top-d.top+"px":u.style.bottom=d.bottom-c.bottom+"px",i.showOverlay(!0),r&&r.appendChild(u);const h=()=>{i.hideControlInPortal(),i.showOverlay(!1),r&&r.removeChild(u),u.removeEventListener("pointerdown",p),l.removeEventListener("pointerdown",f)},p=g=>{g.stopPropagation()},f=g=>{h()};u.addEventListener("pointerdown",p),l.addEventListener("pointerdown",f),i.showControlInPortal(a.jsx(kCe,{currentDocument:l,parentNode:e,onSelect:s,onHide:h,items:t,classNameMapper:o,layout:i}),u)}const kCe=n=>{const{parentNode:e,items:t,onHide:s,onSelect:i,classNameMapper:r,layout:o}=n,l=b.useRef(null);b.useEffect(()=>{l.current&&l.current.focus()},[]);const c=(f,g)=>{i(f),s(),g.stopPropagation()},d=(f,g)=>{f.stopPropagation(),o.setDragNode(f.nativeEvent,g),setTimeout(()=>{s()},0)},u=f=>{o.clearDragMain()},h=f=>{f.key==="Escape"&&s()},p=t.map((f,g)=>{let m=r(Z.FLEXLAYOUT__POPUP_MENU_ITEM);return e.getSelected()===f.index&&(m+=" "+r(Z.FLEXLAYOUT__POPUP_MENU_ITEM__SELECTED)),a.jsx("div",{className:m,"data-layout-path":"/popup-menu/tb"+g,onClick:x=>c(f,x),draggable:!0,onDragStart:x=>d(x,f.node),onDragEnd:u,title:f.node.getHelpText(),children:a.jsx(_v,{node:f.node,layout:o})},f.index)});return a.jsx("div",{className:r(Z.FLEXLAYOUT__POPUP_MENU),ref:l,tabIndex:0,onKeyDown:h,"data-layout-path":"/popup-menu",children:p})},Zz=(n,e,t,s,i,r)=>{const[o,l]=b.useState([]),[c,d]=b.useState(!1),[u,h]=b.useState(!1),p=b.useRef(null),f=b.useRef(!1),g=b.useRef(void 0),m=b.useRef([]),x=b.useRef(0),y=b.useRef(!1);m.current=o,b.useLayoutEffect(()=>{s.current&&W(0)},[e.getId()]),b.useLayoutEffect(()=>{f.current=!1},[e.getSelectedNode(),e.getRect().width,e.getRect().height]),b.useLayoutEffect(()=>{D(),f.current===!1&&v(),C(),T()}),b.useEffect(()=>{var K;return(K=p.current)==null||K.addEventListener("wheel",S,{passive:!1}),()=>{var Y;(Y=p.current)==null||Y.removeEventListener("wheel",S)}},[p.current]);const S=K=>{K.preventDefault()};function v(){const K=e.getSelectedNode();if(K&&s.current){const Y=n.getBoundingClientRect(s.current),U=K.getTabRect();let J=N(Y)-N(U);J>0||O(U)>O(Y)?(W($(s.current)-J),y.current=!0):(J=B(U)-B(Y),J>0&&(W($(s.current)+J),y.current=!0))}}const C=()=>{if(s.current&&i.current){const K=s.current,Y=i.current,U=L(K),J=F(K),te=$(K);if(J>U&&J>0){let ee=U*U/J,ae=0;ee<20&&(ae=20-ee,ee=20);const ce=te*(U-ae)/J;t===Re.HORZ?(Y.style.width=ee+"px",Y.style.left=ce+"px"):(Y.style.height=ee+"px",Y.style.top=ce+"px"),Y.style.display="block"}else Y.style.display="none";t===Re.HORZ?Y.style.bottom="0px":Y.style.right="0px"}},T=()=>{const Y=R().length>0;Y!==c&&d(Y),g.current===void 0&&(g.current=setTimeout(()=>{const U=R();ACe(U,m.current)||l(U),g.current=void 0},100))},I=()=>{y.current||(f.current=!0),y.current=!1,C(),T()},E=K=>{var Y;K.stopPropagation(),i.current.setPointerCapture(K.pointerId);const U=(Y=i.current)==null?void 0:Y.getBoundingClientRect();t===Re.HORZ?x.current=K.clientX-U.x:x.current=K.clientY-U.y,Yz(K.currentTarget.ownerDocument,K,P,k,j)},P=(K,Y)=>{if(s.current&&i.current){const U=s.current,J=i.current,te=L(U),ee=F(U),ae=L(J),ce=U.getBoundingClientRect();let he=0;if(t===Re.HORZ?he=K-ce.x-x.current:he=Y-ce.y-x.current,he=Math.max(0,Math.min(ee-ae,he)),te>0){const Ee=he*ee/te;W(Ee)}}},k=()=>{},j=()=>{},D=()=>{if(s.current){const Y=s.current.firstElementChild,U=u?10:0,J=L(Y)+U>L(s.current);J!==u&&h(J)}},R=()=>{const K=[];if(s.current){const Y=s.current,U=Y.getBoundingClientRect(),J=N(U)-1,te=B(U)+1,ee=Y.firstElementChild;let ae=0;Array.from(ee.children).forEach(ce=>{const he=ce.getBoundingClientRect();ce.classList.contains(r)&&((N(he)<J||B(he)>te)&&K.push(ae),ae++)})}return K},A=K=>{if(s.current){if(e.getChildren().length===0)return;let Y=0;if(Math.abs(K.deltaY)>0){Y=-K.deltaY,K.deltaMode===1&&(Y*=40);const U=$(s.current)-Y,J=F(s.current)-L(s.current),te=Math.max(0,Math.min(J,U));W(te),K.stopPropagation()}}},N=K=>t===Re.HORZ?K.x:K.y,B=K=>t===Re.HORZ?K.right:K.bottom,L=K=>t===Re.HORZ?K.clientWidth:K.clientHeight,O=K=>t===Re.HORZ?K.width:K.height,F=K=>t===Re.HORZ?K.scrollWidth:K.scrollHeight,W=K=>{t===Re.HORZ?s.current.scrollLeft=K:s.current.scrollTop=K},$=K=>t===Re.HORZ?K.scrollLeft:K.scrollTop;return{selfRef:p,userControlledPositionRef:f,onScroll:I,onScrollPointerDown:E,hiddenTabs:o,onMouseWheel:A,isDockStickyButtons:u,isShowHiddenTabs:c}};function ACe(n,e){return n.length===e.length&&n.every((t,s)=>t===e[s])}const jCe=n=>{const{border:e,layout:t,size:s}=n,i=b.useRef(null),r=b.useRef(null),o=b.useRef(null),l=b.useRef(null),c=b.useRef(null),d=t.getIcons();b.useLayoutEffect(()=>{e.setTabHeaderRect(t.getBoundingClientRect(u.current))});const{selfRef:u,userControlledPositionRef:h,onScroll:p,onScrollPointerDown:f,hiddenTabs:g,onMouseWheel:m,isDockStickyButtons:x,isShowHiddenTabs:y}=Zz(t,e,Re.flip(e.getOrientation()),c,r,t.getClassName(Z.FLEXLAYOUT__BORDER_BUTTON)),S=U=>{wp(U)&&t.auxMouseClick(e,U)},v=U=>{t.showContextMenu(e,U)},C=U=>{U.stopPropagation()},T=U=>{const J=t.getShowOverflowMenu(),te=g.map(ee=>({index:ee,node:e.getChildren()[ee]}));if(J!==void 0)J(e,U,te,I);else{const ee=o.current;qz(ee,e,te,I,t)}U.stopPropagation()},I=U=>{t.doAction(je.selectTab(U.node.getId())),h.current=!1},E=U=>{const J=e.getChildren()[e.getSelected()];J!==void 0&&t.doAction(je.popoutTab(J.getId())),U.stopPropagation()},P=t.getClassName,k=[],j=U=>{const J=e.getSelected()===U,te=e.getChildren()[U];k.push(a.jsx(PCe,{layout:t,border:e.getLocation().getName(),node:te,path:e.getPath()+"/tb"+U,selected:J,icons:d},te.getId())),U<e.getChildren().length-1&&k.push(a.jsx("div",{className:P(Z.FLEXLAYOUT__BORDER_TAB_DIVIDER)},"divider"+U))};for(let U=0;U<e.getChildren().length;U++)j(U);let D=P(Z.FLEXLAYOUT__BORDER)+" "+P(Z.FLEXLAYOUT__BORDER_+e.getLocation().getName());e.getClassName()!==void 0&&(D+=" "+e.getClassName());let R,A=[],N=[];const B={leading:R,buttons:A,stickyButtons:N,overflowPosition:void 0};if(t.customizeTabSet(e,B),R=B.leading,N=B.stickyButtons,A=B.buttons,B.overflowPosition===void 0&&(B.overflowPosition=N.length),N.length>0&&(x?A=[...N,...A]:k.push(a.jsx("div",{ref:l,onPointerDown:C,onDragStart:U=>{U.preventDefault()},className:P(Z.FLEXLAYOUT__TAB_TOOLBAR_STICKY_BUTTONS_CONTAINER),children:N},"sticky_buttons_container"))),y){const U=t.i18nName(Un.Overflow_Menu_Tooltip);let J;if(typeof d.more=="function"){const te=g.map(ee=>({index:ee,node:e.getChildren()[ee]}));J=d.more(e,te)}else J=a.jsxs(a.Fragment,{children:[d.more,a.jsx("div",{className:P(Z.FLEXLAYOUT__TAB_BUTTON_OVERFLOW_COUNT),children:g.length>0?g.length:""})]});A.splice(Math.min(B.overflowPosition,A.length),0,a.jsx("button",{ref:o,className:P(Z.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON)+" "+P(Z.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW)+" "+P(Z.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_OVERFLOW_+e.getLocation().getName()),title:U,onClick:T,onPointerDown:C,children:J},"overflowbutton"))}const L=e.getSelected();if(L!==-1){const U=e.getChildren()[L];if(U!==void 0&&t.isSupportsPopout()&&U.isEnablePopout()){const J=t.i18nName(Un.Popout_Tab);A.push(a.jsx("button",{title:J,className:P(Z.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON)+" "+P(Z.FLEXLAYOUT__BORDER_TOOLBAR_BUTTON_FLOAT),onClick:E,onPointerDown:C,children:typeof d.popout=="function"?d.popout(U):d.popout},"popout"))}}const O=a.jsx("div",{ref:i,className:P(Z.FLEXLAYOUT__BORDER_TOOLBAR)+" "+P(Z.FLEXLAYOUT__BORDER_TOOLBAR_+e.getLocation().getName()),children:A},"toolbar");let F={},W={};const $=s-1;e.getLocation()===de.LEFT?(F={right:"100%",top:0},W={width:$,overflowY:"auto"}):e.getLocation()===de.RIGHT?(F={left:"100%",top:0},W={width:$,overflowY:"auto"}):(F={left:0},W={height:$,overflowX:"auto"});let K;e.isEnableTabScrollbar()&&(K=a.jsx("div",{ref:r,className:P(Z.FLEXLAYOUT__MINI_SCROLLBAR),onPointerDown:f}));let Y;return R&&(Y=a.jsx("div",{className:P(Z.FLEXLAYOUT__BORDER_LEADING),children:R})),a.jsxs("div",{ref:u,style:{display:"flex",flexDirection:e.getOrientation()===Re.VERT?"row":"column"},className:D,"data-layout-path":e.getPath(),onClick:S,onAuxClick:S,onContextMenu:v,onWheel:m,children:[Y,a.jsxs("div",{className:P(Z.FLEXLAYOUT__MINI_SCROLLBAR_CONTAINER),children:[a.jsx("div",{ref:c,className:P(Z.FLEXLAYOUT__BORDER_INNER)+" "+P(Z.FLEXLAYOUT__BORDER_INNER_+e.getLocation().getName()),style:W,onScroll:p,children:a.jsx("div",{style:F,className:P(Z.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER)+" "+P(Z.FLEXLAYOUT__BORDER_INNER_TAB_CONTAINER_+e.getLocation().getName()),children:k})}),K]}),O]})},NCe=n=>{const{layout:e,node:t}=n,s=b.useRef(null);b.useEffect(()=>{t.setTabStamp(s.current)},[t,s.current]);const i=e.getClassName,r=i(Z.FLEXLAYOUT__DRAG_RECT);return a.jsx("div",{ref:s,className:r,children:a.jsx(_v,{layout:e,node:t},t.getId())})},RCe=n=>{const{title:e,layout:t,layoutWindow:s,url:i,onCloseWindow:r,onSetWindow:o,children:l}=n,c=b.useRef(null),[d,u]=b.useState(void 0),h=new Map;return b.useLayoutEffect(()=>{if(!c.current){const p=s.windowId,f=s.rect;c.current=window.open(i,p,`left=${f.x},top=${f.y},width=${f.width},height=${f.height}`),c.current?(s.window=c.current,o(s,c.current),window.addEventListener("beforeunload",()=>{if(c.current){const g=c.current;c.current=null,g.close()}}),c.current.addEventListener("load",()=>{if(c.current){c.current.focus(),c.current.resizeTo(f.width,f.height),c.current.moveTo(f.x,f.y);const g=c.current.document;g.title=e;const m=g.createElement("div");m.className=Z.FLEXLAYOUT__FLOATING_WINDOW_CONTENT,g.body.appendChild(m),OCe(g,h).then(()=>{u(m)});const x=new MutationObserver(y=>MCe(y,g,h));x.observe(document.head,{childList:!0}),c.current.addEventListener("beforeunload",()=>{c.current&&(r(s),c.current=null,x.disconnect())})}})):(console.warn(`Unable to open window ${i}`),r(s))}return()=>{var p;t.getModel().getwindowsMap().has(s.windowId)||((p=c.current)==null||p.close(),c.current=null)}},[]),d!==void 0?kr.createPortal(l,d):null};function MCe(n,e,t){for(const s of n)if(s.type==="childList"){for(const i of s.addedNodes)(i instanceof HTMLLinkElement||i instanceof HTMLStyleElement)&&Jz(e,i,t);for(const i of s.removedNodes)if(i instanceof HTMLLinkElement||i instanceof HTMLStyleElement){const r=t.get(i);r&&e.head.removeChild(r)}}}function OCe(n,e){const t=[],s=document.querySelectorAll('style, link[rel="stylesheet"]');for(const i of s)Jz(n,i,e,t);return Promise.all(t)}function Jz(n,e,t,s){if(e instanceof HTMLLinkElement){const i=e.cloneNode(!0);n.head.appendChild(i),t.set(e,i),s&&s.push(new Promise(r=>{i.onload=()=>r(!0)}))}else if(e instanceof HTMLStyleElement)try{const i=e.cloneNode(!0);n.head.appendChild(i),t.set(e,i)}catch{}}const tu={width:"1em",height:"1em",display:"flex",alignItems:"center"},vR=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:tu,viewBox:"0 0 24 24",children:[a.jsx("path",{fill:"none",d:"M0 0h24v24H0z"}),a.jsx("path",{stroke:"var(--color-icon)",fill:"var(--color-icon)",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})]}),DCe=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:tu,viewBox:"0 0 24 24",fill:"var(--color-icon)",children:[a.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),a.jsx("path",{stroke:"var(--color-icon)",d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})]}),LCe=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:tu,viewBox:"0 0 24 24",fill:"var(--color-icon)",children:[a.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),a.jsx("path",{stroke:"var(--color-icon)",d:"M7 10l5 5 5-5z"})]}),FCe=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",style:{display:"block",width:10,height:10},preserveAspectRatio:"none",viewBox:"0 0 100 100",children:a.jsx("path",{fill:"var(--color-edge-icon)",stroke:"var(--color-edge-icon)",d:"M10 30 L90 30 l-40 40 Z"})}),BCe=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:tu,viewBox:"0 0 20 20",fill:"var(--color-icon)",children:[a.jsx("path",{d:"M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"}),a.jsx("path",{d:"M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"})]}),UCe=()=>a.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",style:tu,viewBox:"0 0 24 24",fill:"var(--color-icon)",children:[a.jsx("path",{d:"M0 0h24v24H0z",fill:"none"}),a.jsx("path",{stroke:"var(--color-icon)",d:"M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"})]}),$Ce=()=>a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",style:tu,height:"24px",viewBox:"0 -960 960 960",width:"24px",children:a.jsx("path",{fill:"var(--color-icon)",stroke:"var(--color-icon)",d:"M440-120v-264L254-197l-57-57 187-186H120v-80h264L197-706l57-57 186 187v-264h80v264l186-187 57 57-187 186h264v80H576l187 186-57 57-186-187v264h-80Z"})}),zCe=n=>{const{layout:e,show:t}=n;return a.jsx("div",{className:e.getClassName(Z.FLEXLAYOUT__LAYOUT_OVERLAY),style:{display:t?"flex":"none"}})},WCe=n=>{const{layout:e,node:t,selected:s,path:i}=n,r=b.useRef(null),o=b.useRef(null),l=e.getIcons();b.useLayoutEffect(()=>{t.setTabRect(e.getBoundingClientRect(r.current)),e.getEditingTab()===t&&o.current.select()});const c=A=>{t.isEnableDrag()?(A.stopPropagation(),e.setDragNode(A.nativeEvent,t)):A.preventDefault()},d=A=>{e.clearDragMain()},u=A=>{wp(A)&&e.auxMouseClick(t,A)},h=A=>{e.showContextMenu(t,A)},p=()=>{e.doAction(je.selectTab(t.getId()))},f=A=>{t.isEnableRename()&&(g(),A.stopPropagation())},g=()=>{e.setEditingTab(t),e.getCurrentDocument().body.addEventListener("pointerdown",m)},m=A=>{A.target!==o.current&&(e.getCurrentDocument().body.removeEventListener("pointerdown",m),e.setEditingTab(void 0))},x=()=>{const A=t.getCloseType();return!!(s||A===bp.Always||A===bp.Visible&&window.matchMedia&&window.matchMedia("(hover: hover) and (pointer: fine)").matches)},y=A=>{x()&&(e.doAction(je.deleteTab(t.getId())),A.stopPropagation())},S=A=>{A.stopPropagation()},v=A=>{A.stopPropagation()},C=A=>{A.code==="Escape"?e.setEditingTab(void 0):(A.code==="Enter"||A.code==="NumpadEnter")&&(e.setEditingTab(void 0),e.doAction(je.renameTab(t.getId(),A.target.value)))},T=e.getClassName,I=t.getParent(),E=I.isEnableSingleTabStretch()&&I.getChildren().length===1,P=E?Z.FLEXLAYOUT__TAB_BUTTON_STRETCH:Z.FLEXLAYOUT__TAB_BUTTON;let k=T(P);k+=" "+T(P+"_"+I.getTabLocation()),E||(s?k+=" "+T(P+"--selected"):k+=" "+T(P+"--unselected")),t.getClassName()!==void 0&&(k+=" "+t.getClassName());const j=qT(e,t);let D=j.content?a.jsx("div",{className:T(Z.FLEXLAYOUT__TAB_BUTTON_CONTENT),children:j.content}):null;const R=j.leading?a.jsx("div",{className:T(Z.FLEXLAYOUT__TAB_BUTTON_LEADING),children:j.leading}):null;if(e.getEditingTab()===t&&(D=a.jsx("input",{ref:o,className:T(Z.FLEXLAYOUT__TAB_BUTTON_TEXTBOX),"data-layout-path":i+"/textbox",type:"text",autoFocus:!0,defaultValue:t.getName(),onKeyDown:C,onPointerDown:v})),t.isEnableClose()&&!E){const A=e.i18nName(Un.Close_Tab);j.buttons.push(a.jsx("div",{"data-layout-path":i+"/button/close",title:A,className:T(Z.FLEXLAYOUT__TAB_BUTTON_TRAILING),onPointerDown:S,onClick:y,children:typeof l.close=="function"?l.close(t):l.close},"close"))}return a.jsxs("div",{ref:r,"data-layout-path":i,className:k,onClick:p,onAuxClick:u,onContextMenu:h,title:t.getHelpText(),draggable:!0,onDragStart:c,onDragEnd:d,onDoubleClick:f,children:[R,D,j.buttons]})},HCe=n=>{const{node:e,layout:t}=n,s=b.useRef(null),i=b.useRef(null),r=b.useRef(null),o=b.useRef(null),l=b.useRef(null),c=b.useRef(null),d=b.useRef(null),u=b.useRef(void 0),h=t.getIcons();b.useLayoutEffect(()=>{e.setRect(t.getBoundingClientRect(p.current)),s.current&&e.setTabStripRect(t.getBoundingClientRect(s.current));const re=t.getBoundingClientRect(o.current);!e.getContentRect().equals(re)&&!isNaN(re.x)&&(e.setContentRect(re),Rh?(u.current&&clearTimeout(u.current),u.current=setTimeout(()=>{t.redrawInternal("border content rect "+re),u.current=void 0},50)):t.redrawInternal("border content rect "+re))});const{selfRef:p,userControlledPositionRef:f,onScroll:g,onScrollPointerDown:m,hiddenTabs:x,onMouseWheel:y,isDockStickyButtons:S,isShowHiddenTabs:v}=Zz(t,e,Re.HORZ,r,i,t.getClassName(Z.FLEXLAYOUT__TAB_BUTTON)),C=re=>{const $e=t.getShowOverflowMenu(),At=x.map(gn=>({index:gn,node:e.getChildren()[gn]}));if($e!==void 0)$e(e,re,At,T);else{const gn=c.current;qz(gn,e,At,T,t)}re.stopPropagation()},T=re=>{t.doAction(je.selectTab(re.node.getId())),f.current=!1},I=re=>{t.getEditingTab()?re.preventDefault():e.isEnableDrag()?(re.stopPropagation(),t.setDragNode(re.nativeEvent,e)):re.preventDefault()},E=re=>{wp(re)||t.doAction(je.setActiveTabset(e.getId(),t.getWindowId()))},P=re=>{wp(re)&&t.auxMouseClick(e,re)},k=re=>{t.showContextMenu(e,re)},j=re=>{re.stopPropagation()},D=re=>{e.canMaximize()&&t.maximize(e),re.stopPropagation()},R=re=>{t.doAction(je.deleteTabset(e.getId())),re.stopPropagation()},A=re=>{t.doAction(je.deleteTab(e.getChildren()[0].getId())),re.stopPropagation()},N=re=>{O!==void 0&&t.doAction(je.popoutTab(O.getId())),re.stopPropagation()},B=re=>{e.canMaximize()&&t.maximize(e)},L=t.getClassName,O=e.getSelectedNode(),F=e.getPath(),W=[];if(e.isEnableTabStrip())for(let re=0;re<e.getChildren().length;re++){const $e=e.getChildren()[re],At=e.getSelected()===re;W.push(a.jsx(WCe,{layout:t,node:$e,path:F+"/tb"+re,selected:At},$e.getId())),re<e.getChildren().length-1&&W.push(a.jsx("div",{className:L(Z.FLEXLAYOUT__TABSET_TAB_DIVIDER)},"divider"+re))}let $,K=[],Y=[];const U={leading:$,stickyButtons:K,buttons:Y,overflowPosition:void 0};t.customizeTabSet(e,U),$=U.leading,K=U.stickyButtons,Y=U.buttons;const J=e.isEnableSingleTabStretch()&&e.getChildren().length===1,te=J&&e.getChildren()[0].isEnableClose()||e.isEnableClose();if(U.overflowPosition===void 0&&(U.overflowPosition=K.length),K.length>0&&(!e.isEnableTabWrap()&&(S||J)?Y=[...K,...Y]:W.push(a.jsx("div",{ref:d,onPointerDown:j,onDragStart:re=>{re.preventDefault()},className:L(Z.FLEXLAYOUT__TAB_TOOLBAR_STICKY_BUTTONS_CONTAINER),children:K},"sticky_buttons_container"))),!e.isEnableTabWrap()&&v){const re=t.i18nName(Un.Overflow_Menu_Tooltip);let $e;if(typeof h.more=="function"){const At=x.map(gn=>({index:gn,node:e.getChildren()[gn]}));$e=h.more(e,At)}else $e=a.jsxs(a.Fragment,{children:[h.more,a.jsx("div",{className:L(Z.FLEXLAYOUT__TAB_BUTTON_OVERFLOW_COUNT),children:x.length>0?x.length:""})]});Y.splice(Math.min(U.overflowPosition,Y.length),0,a.jsx("button",{"data-layout-path":F+"/button/overflow",ref:c,className:L(Z.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+L(Z.FLEXLAYOUT__TAB_BUTTON_OVERFLOW),title:re,onClick:C,onPointerDown:j,children:$e},"overflowbutton"))}if(O!==void 0&&t.isSupportsPopout()&&O.isEnablePopout()&&O.isEnablePopoutIcon()){const re=t.i18nName(Un.Popout_Tab);Y.push(a.jsx("button",{"data-layout-path":F+"/button/popout",title:re,className:L(Z.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+L(Z.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_FLOAT),onClick:N,onPointerDown:j,children:typeof h.popout=="function"?h.popout(O):h.popout},"popout"))}if(e.canMaximize()){const re=t.i18nName(Un.Restore),$e=t.i18nName(Un.Maximize);Y.push(a.jsx("button",{"data-layout-path":F+"/button/max",title:e.isMaximized()?re:$e,className:L(Z.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+L(Z.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_+(e.isMaximized()?"max":"min")),onClick:D,onPointerDown:j,children:e.isMaximized()?typeof h.restore=="function"?h.restore(e):h.restore:typeof h.maximize=="function"?h.maximize(e):h.maximize},"max"))}if(!e.isMaximized()&&te){const re=J?t.i18nName(Un.Close_Tab):t.i18nName(Un.Close_Tabset);Y.push(a.jsx("button",{"data-layout-path":F+"/button/close",title:re,className:L(Z.FLEXLAYOUT__TAB_TOOLBAR_BUTTON)+" "+L(Z.FLEXLAYOUT__TAB_TOOLBAR_BUTTON_CLOSE),onClick:J?A:R,onPointerDown:j,children:typeof h.closeTabset=="function"?h.closeTabset(e):h.closeTabset},"close"))}if(e.isActive()&&e.isEnableActiveIcon()){const re=t.i18nName(Un.Active_Tabset);Y.push(a.jsx("div",{"data-layout-path":F+"/button/active",title:re,className:L(Z.FLEXLAYOUT__TAB_TOOLBAR_ICON),children:typeof h.activeTabset=="function"?h.activeTabset(e):h.activeTabset},"active"))}const ee=a.jsx("div",{ref:l,className:L(Z.FLEXLAYOUT__TAB_TOOLBAR),onPointerDown:j,onDragStart:re=>{re.preventDefault()},children:Y},"buttonbar");let ae,ce=L(Z.FLEXLAYOUT__TABSET_TABBAR_OUTER);if(e.getClassNameTabStrip()!==void 0&&(ce+=" "+e.getClassNameTabStrip()),ce+=" "+Z.FLEXLAYOUT__TABSET_TABBAR_OUTER_+e.getTabLocation(),e.isActive()&&(ce+=" "+L(Z.FLEXLAYOUT__TABSET_SELECTED)),e.isMaximized()&&(ce+=" "+L(Z.FLEXLAYOUT__TABSET_MAXIMIZED)),J){const re=e.getChildren()[0];re.getTabSetClassName()!==void 0&&(ce+=" "+re.getTabSetClassName())}let he;if($&&(he=a.jsx("div",{className:L(Z.FLEXLAYOUT__TABSET_LEADING),children:$})),e.isEnableTabWrap())e.isEnableTabStrip()&&(ae=a.jsxs("div",{className:ce,style:{flexWrap:"wrap",gap:"1px",marginTop:"2px"},ref:s,"data-layout-path":F+"/tabstrip",onPointerDown:E,onDoubleClick:B,onContextMenu:k,onClick:P,onAuxClick:P,draggable:!0,onDragStart:I,children:[he,W,a.jsx("div",{style:{flexGrow:1}}),ee]}));else if(e.isEnableTabStrip()){let re;e.isEnableTabScrollbar()&&(re=a.jsx("div",{ref:i,className:L(Z.FLEXLAYOUT__MINI_SCROLLBAR),onPointerDown:m})),ae=a.jsxs("div",{className:ce,ref:s,"data-layout-path":F+"/tabstrip",onPointerDown:E,onDoubleClick:B,onContextMenu:k,onClick:P,onAuxClick:P,draggable:!0,onWheel:y,onDragStart:I,children:[he,a.jsxs("div",{className:L(Z.FLEXLAYOUT__MINI_SCROLLBAR_CONTAINER),children:[a.jsx("div",{ref:r,className:L(Z.FLEXLAYOUT__TABSET_TABBAR_INNER)+" "+L(Z.FLEXLAYOUT__TABSET_TABBAR_INNER_+e.getTabLocation()),style:{overflowX:"auto",overflowY:"hidden"},onScroll:g,children:a.jsx("div",{style:{width:J?"100%":"none"},className:L(Z.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER)+" "+L(Z.FLEXLAYOUT__TABSET_TABBAR_INNER_TAB_CONTAINER_+e.getTabLocation()),children:W})}),re]}),ee]})}let Ee;if(e.getChildren().length===0){const re=t.getTabSetPlaceHolderCallback();re&&(Ee=re(e))}let ke=a.jsx("div",{ref:o,className:L(Z.FLEXLAYOUT__TABSET_CONTENT),children:Ee});e.getTabLocation()==="top"?ke=a.jsxs(a.Fragment,{children:[ae,ke]}):ke=a.jsxs(a.Fragment,{children:[ke,ae]});const Jt={flexGrow:Math.max(1,e.getWeight()*1e3),minWidth:e.getMinWidth(),minHeight:e.getMinHeight(),maxWidth:e.getMaxWidth(),maxHeight:e.getMaxHeight()};e.getModel().getMaximizedTabset(t.getWindowId())!==void 0&&!e.isMaximized()&&(Jt.display="none");const tt=a.jsx("div",{ref:p,className:L(Z.FLEXLAYOUT__TABSET_CONTAINER),style:Jt,children:a.jsx("div",{className:L(Z.FLEXLAYOUT__TABSET),"data-layout-path":F,children:ke})});return e.isMaximized()&&t.getMainElement()?kr.createPortal(a.jsx("div",{style:{position:"absolute",display:"flex",top:0,left:0,bottom:0,right:0},children:tt}),t.getMainElement()):tt},Qz=n=>{const{layout:e,node:t}=n,s=b.useRef(null),i=t.getOrientation()===Re.HORZ;b.useLayoutEffect(()=>{t.setRect(e.getBoundingClientRect(s.current))});const r=[];let o=0;for(const c of t.getChildren())o>0&&r.push(a.jsx(tC,{layout:e,node:t,index:o,horizontal:i},"splitter"+o)),c instanceof xn?r.push(a.jsx(Qz,{layout:e,node:c},c.getId())):c instanceof ct&&r.push(a.jsx(HCe,{layout:e,node:c},c.getId())),o++;const l={flexGrow:Math.max(1,t.getWeight()*1e3),minWidth:t.getMinWidth(),minHeight:t.getMinHeight(),maxWidth:t.getMaxWidth(),maxHeight:t.getMaxHeight()};return i?l.flexDirection="row":l.flexDirection="column",a.jsx("div",{ref:s,className:e.getClassName(Z.FLEXLAYOUT__ROW),style:l,children:r})},GCe=n=>{const{layout:e,selected:t,node:s,path:i}=n,r=b.useRef(null),o=b.useRef(!0),l=s.getParent(),c=l.getContentRect();b.useLayoutEffect(()=>{const g=s.getMoveableElement();r.current.appendChild(g),s.setMoveableElement(g);const m=()=>{s.saveScrollPosition()};return g.addEventListener("scroll",m),r.current.addEventListener("pointerdown",d),()=>{g.removeEventListener("scroll",m),r.current&&r.current.removeEventListener("pointerdown",d),s.setVisible(!1)}},[]),b.useEffect(()=>{s.isSelected()&&o.current&&(s.restoreScrollPosition(),o.current=!1)});const d=()=>{const g=s.getParent();g instanceof ct&&(g.isActive()||e.doAction(je.setActiveTabset(g.getId(),e.getWindowId())))};s.setRect(c);const u=e.getClassName,h={};c.styleWithPosition(h);let p=null;if(t){if(s.setVisible(!0),document.hidden&&s.isEnablePopoutOverlay()){const g={};c.styleWithPosition(g),p=a.jsx("div",{style:g,className:u(Z.FLEXLAYOUT__TAB_OVERLAY)})}}else h.display="none",s.setVisible(!1);l instanceof ct&&s.getModel().getMaximizedTabset(e.getWindowId())!==void 0&&(l.isMaximized()?h.zIndex=10:h.display="none"),l instanceof is&&(l.isShowing()||(h.display="none"));let f=u(Z.FLEXLAYOUT__TAB);return l instanceof is&&(f+=" "+u(Z.FLEXLAYOUT__TAB_BORDER),f+=" "+u(Z.FLEXLAYOUT__TAB_BORDER_+l.getLocation().getName())),s.getContentClassName()!==void 0&&(f+=" "+s.getContentClassName()),a.jsxs(a.Fragment,{children:[p,a.jsx("div",{ref:r,style:h,className:f,"data-layout-path":i})]})};class VCe extends b.Component{constructor(e){super(e),V(this,"retry",()=>{this.setState({hasError:!1})}),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.debug(e),console.debug(t)}render(){return this.state.hasError?a.jsx("div",{className:Z.FLEXLAYOUT__ERROR_BOUNDARY_CONTAINER,children:a.jsx("div",{className:Z.FLEXLAYOUT__ERROR_BOUNDARY_CONTENT,children:a.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[this.props.message,a.jsx("p",{children:a.jsx("button",{onClick:this.retry,children:this.props.retryText})})]})})}):this.props.children}}const KCe=b.memo(({layout:n,node:e})=>a.jsx(VCe,{message:n.i18nName(Un.Error_rendering_component),retryText:n.i18nName(Un.Error_rendering_component_retry),children:n.props.factory(e)}),YCe);function YCe(n,e){return!(e.visible&&(!n.rect.equalSize(e.rect)||n.forceRevision!==e.forceRevision||n.tabsRevision!==e.tabsRevision))}class XCe extends b.Component{constructor(e){super(e),V(this,"selfRef"),V(this,"revision"),this.selfRef=b.createRef(),this.revision=0}redraw(){this.selfRef.current.redraw("parent "+this.revision)}addTabToTabSet(e,t){return this.selfRef.current.addTabToTabSet(e,t)}addTabWithDragAndDrop(e,t,s){this.selfRef.current.addTabWithDragAndDrop(e,t,s)}moveTabWithDragAndDrop(e,t){this.selfRef.current.moveTabWithDragAndDrop(e,t)}addTabToActiveTabSet(e){return this.selfRef.current.addTabToActiveTabSet(e)}setDragComponent(e,t,s,i){this.selfRef.current.setDragComponent(e,t,s,i)}getRootDiv(){return this.selfRef.current.getRootDiv()}render(){return a.jsx(qCe,{ref:this.selfRef,...this.props,renderRevision:this.revision++})}}const e6=class ys extends b.Component{constructor(e){super(e),V(this,"selfRef"),V(this,"moveablesRef"),V(this,"findBorderBarSizeRef"),V(this,"mainRef"),V(this,"previousModel"),V(this,"orderedTabIds"),V(this,"orderedTabMoveableIds"),V(this,"moveableElementMap",new Map),V(this,"dropInfo"),V(this,"outlineDiv"),V(this,"currentDocument"),V(this,"currentWindow"),V(this,"supportsPopout"),V(this,"popoutURL"),V(this,"icons"),V(this,"resizeObserver"),V(this,"dragEnterCount",0),V(this,"dragging",!1),V(this,"windowId"),V(this,"layoutWindow"),V(this,"mainLayout"),V(this,"isMainWindow"),V(this,"isDraggingOverWindow"),V(this,"styleObserver"),V(this,"popoutWindowName"),V(this,"updateLayoutMetrics",()=>{if(this.findBorderBarSizeRef.current){const t=this.findBorderBarSizeRef.current.getBoundingClientRect().height;t!==this.state.calculatedBorderBarSize&&this.setState({calculatedBorderBarSize:t})}}),V(this,"onModelChange",t=>{this.redrawInternal("model change"),this.props.onModelChange&&this.props.onModelChange(this.props.model,t)}),V(this,"updateRect",()=>{if(this.selfRef.current){const t=Ce.fromDomRect(this.selfRef.current.getBoundingClientRect());!t.equals(this.state.rect)&&t.width!==0&&t.height!==0&&(this.setState({rect:t}),this.windowId!==zs.MAIN_WINDOW_ID&&this.redrawInternal("rect updated"))}}),V(this,"getClassName",t=>this.props.classNameMapper===void 0?t:this.props.classNameMapper(t)),V(this,"onCloseWindow",t=>{this.doAction(je.closeWindow(t.windowId))}),V(this,"onSetWindow",(t,s)=>{}),V(this,"showControlInPortal",(t,s)=>{const i=kr.createPortal(t,s);this.setState({portal:i})}),V(this,"hideControlInPortal",()=>{this.setState({portal:void 0})}),V(this,"getIcons",()=>this.icons),V(this,"setDragNode",(t,s)=>{if(ys.dragState=new ob(this.mainLayout,"internal",s,void 0,void 0),t.dataTransfer.setData("text/plain","--flexlayout--"),t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.dropEffect="move",this.dragEnterCount=0,s instanceof ct){let i=!1,r=this.i18nName(Un.Move_Tabset);if(s.getChildren().length>0&&(r=this.i18nName(Un.Move_Tabs).replace("?",String(s.getChildren().length))),this.props.onRenderDragRect){const o=this.props.onRenderDragRect(r,s,void 0);o&&(this.setDragComponent(t,o,10,10),i=!0)}i||this.setDragComponent(t,r,10,10)}else{const r=t.target.getBoundingClientRect(),o=t.clientX-r.left,l=t.clientY-r.top,c=s==null?void 0:s.getParent(),d=c instanceof is&&c.getOrientation()===Re.HORZ,u=d?10:o,h=d?10:l;let p=!1;if(this.props.onRenderDragRect){const f=a.jsx(_v,{layout:this,node:s},s.getId()),g=this.props.onRenderDragRect(f,s,void 0);g&&(this.setDragComponent(t,g,u,h),p=!0)}p||(TCe()?this.setDragComponent(t,a.jsx(_v,{node:s,layout:this}),u,h):t.dataTransfer.setDragImage(s.getTabStamp(),u,h))}}),V(this,"onDragEnterRaw",t=>{this.dragEnterCount++,this.dragEnterCount===1&&this.onDragEnter(t)}),V(this,"onDragLeaveRaw",t=>{this.dragEnterCount--,this.dragEnterCount===0&&this.onDragLeave(t)}),V(this,"onDragEnter",t=>{if(!ys.dragState&&this.props.onExternalDrag){const s=this.props.onExternalDrag(t);if(s){const i=bt.fromJson(s.json,this.props.model,!1);ys.dragState=new ob(this.mainLayout,"external",i,s.json,s.onDrop)}}if(ys.dragState){if(this.windowId!==zs.MAIN_WINDOW_ID&&ys.dragState.mainLayout===this.mainLayout&&ys.dragState.mainLayout.setDraggingOverWindow(!0),ys.dragState.mainLayout!==this.mainLayout)return;t.preventDefault(),this.dropInfo=void 0;const s=this.selfRef.current;this.outlineDiv=this.currentDocument.createElement("div"),this.outlineDiv.className=this.getClassName(Z.FLEXLAYOUT__OUTLINE_RECT),this.outlineDiv.style.visibility="hidden";const i=this.props.model.getAttribute("tabDragSpeed");this.outlineDiv.style.transition=`top ${i}s, left ${i}s, width ${i}s, height ${i}s`,s.appendChild(this.outlineDiv),this.dragging=!0,this.showOverlay(!0),!this.isDraggingOverWindow&&this.props.model.getMaximizedTabset(this.windowId)===void 0&&this.setState({showEdges:this.props.model.isEnableEdgeDock()});const r=this.selfRef.current.getBoundingClientRect();new Ce(t.clientX-r.left,t.clientY-r.top,1,1).positionElement(this.outlineDiv)}}),V(this,"onDragOver",t=>{var s;if(this.dragging&&!this.isDraggingOverWindow){t.preventDefault();const i=(s=this.selfRef.current)==null?void 0:s.getBoundingClientRect(),r={x:t.clientX-((i==null?void 0:i.left)??0),y:t.clientY-((i==null?void 0:i.top)??0)};this.checkForBorderToShow(r.x,r.y);const o=this.props.model.findDropTargetNode(this.windowId,ys.dragState.dragNode,r.x,r.y);o&&(this.dropInfo=o,this.outlineDiv&&(this.outlineDiv.className=this.getClassName(o.className),o.rect.positionElement(this.outlineDiv),this.outlineDiv.style.visibility="visible"))}}),V(this,"onDragLeave",t=>{this.dragging&&(this.windowId!==zs.MAIN_WINDOW_ID&&ys.dragState.mainLayout.setDraggingOverWindow(!1),this.clearDragLocal())}),V(this,"onDrop",t=>{if(this.dragging){t.preventDefault();const s=ys.dragState;if(this.dropInfo)if(s.dragJson!==void 0){const i=this.doAction(je.addNode(s.dragJson,this.dropInfo.node.getId(),this.dropInfo.location,this.dropInfo.index));s.fnNewNodeDropped!==void 0&&s.fnNewNodeDropped(i,t)}else s.dragNode!==void 0&&this.doAction(je.moveNode(s.dragNode.getId(),this.dropInfo.node.getId(),this.dropInfo.location,this.dropInfo.index));this.mainLayout.clearDragMain()}this.dragEnterCount=0}),this.orderedTabIds=[],this.orderedTabMoveableIds=[],this.selfRef=b.createRef(),this.moveablesRef=b.createRef(),this.mainRef=b.createRef(),this.findBorderBarSizeRef=b.createRef(),this.supportsPopout=e.supportsPopout!==void 0?e.supportsPopout:JCe,this.popoutURL=e.popoutURL?e.popoutURL:"popout.html",this.icons={...ZCe,...e.icons},this.windowId=e.windowId?e.windowId:zs.MAIN_WINDOW_ID,this.mainLayout=this.props.mainLayout?this.props.mainLayout:this,this.isDraggingOverWindow=!1,this.layoutWindow=this.props.model.getwindowsMap().get(this.windowId),this.layoutWindow.layout=this,this.popoutWindowName=this.props.popoutWindowName||"Popout Window",this.state={rect:Ce.empty(),editingTab:void 0,showEdges:!1,showOverlay:!1,calculatedBorderBarSize:29,layoutRevision:0,forceRevision:0,showHiddenBorder:de.CENTER},this.isMainWindow=this.windowId===zs.MAIN_WINDOW_ID}componentDidMount(){if(this.updateRect(),this.currentDocument=this.selfRef.current.ownerDocument,this.currentWindow=this.currentDocument.defaultView,this.layoutWindow.window=this.currentWindow,this.layoutWindow.toScreenRectFunction=e=>this.getScreenRect(e),this.resizeObserver=new ResizeObserver(e=>{requestAnimationFrame(()=>{this.updateRect()})}),this.selfRef.current&&this.resizeObserver.observe(this.selfRef.current),this.isMainWindow)this.props.model.addChangeListener(this.onModelChange),this.updateLayoutMetrics();else{this.currentWindow.addEventListener("resize",()=>{this.updateRect()});const e=this.props.mainLayout.getRootDiv(),t=this.selfRef.current;yR(e,t),this.styleObserver=new MutationObserver(()=>{yR(e,t)&&this.redraw("mutation observer")}),this.styleObserver.observe(e,{attributeFilter:["style"]})}document.addEventListener("visibilitychange",()=>{for(const[e,t]of this.props.model.getwindowsMap())t.layout&&this.redraw("visibility change")})}componentDidUpdate(){this.currentDocument=this.selfRef.current.ownerDocument,this.currentWindow=this.currentDocument.defaultView,this.isMainWindow&&(this.props.model!==this.previousModel&&(this.previousModel!==void 0&&this.previousModel.removeChangeListener(this.onModelChange),this.props.model.getwindowsMap().get(this.windowId).layout=this,this.props.model.addChangeListener(this.onModelChange),this.layoutWindow=this.props.model.getwindowsMap().get(this.windowId),this.layoutWindow.layout=this,this.layoutWindow.toScreenRectFunction=e=>this.getScreenRect(e),this.previousModel=this.props.model,this.tidyMoveablesMap()),this.updateLayoutMetrics())}componentWillUnmount(){var e,t;this.selfRef.current&&((e=this.resizeObserver)==null||e.unobserve(this.selfRef.current)),this.isMainWindow&&this.props.model.removeChangeListener(this.onModelChange),(t=this.styleObserver)==null||t.disconnect()}render(){if(!this.selfRef.current)return a.jsxs("div",{ref:this.selfRef,className:this.getClassName(Z.FLEXLAYOUT__LAYOUT),children:[a.jsx("div",{ref:this.moveablesRef,className:this.getClassName(Z.FLEXLAYOUT__LAYOUT_MOVEABLES)},"__moveables__"),this.renderMetricsElements()]});const e=this.props.model;e.getRoot(this.windowId).calcMinMaxSize(),e.getRoot(this.windowId).setPaths(""),e.getBorderSet().setPaths();const t=this.renderLayout(),s=this.renderBorders(t),i=this.renderTabs(),r=this.reorderComponents(i,this.orderedTabIds);let o=null,l=null,c=null,d=null;if(this.isMainWindow){o=this.renderWindows(),d=this.renderMetricsElements();const u=this.renderTabMoveables();l=this.reorderComponents(u,this.orderedTabMoveableIds),c=a.jsx("div",{className:this.getClassName(Z.FLEXLAYOUT__LAYOUT_TAB_STAMPS),children:this.renderTabStamps()},"__tabStamps__")}return a.jsxs("div",{ref:this.selfRef,className:this.getClassName(Z.FLEXLAYOUT__LAYOUT),onDragEnter:this.onDragEnterRaw,onDragLeave:this.onDragLeaveRaw,onDragOver:this.onDragOver,onDrop:this.onDrop,children:[a.jsx("div",{ref:this.moveablesRef,className:this.getClassName(Z.FLEXLAYOUT__LAYOUT_MOVEABLES)},"__moveables__"),d,a.jsx(zCe,{layout:this,show:this.state.showOverlay},"__overlay__"),s,r,l,c,this.state.portal,o]})}renderBorders(e){const t=this.getClassName(Z.FLEXLAYOUT__LAYOUT_MAIN),s=this.props.model.getBorderSet().getBorderMap();if(this.isMainWindow&&s.size>0){e=a.jsx("div",{className:t,ref:this.mainRef,children:e});const i=new Map,r=new Map;for(const[c,d]of de.values){const u=s.get(d);u&&u.isShowing()&&(!u.isAutoHide()||u.isAutoHide()&&(u.getChildren().length>0||this.state.showHiddenBorder===d))&&(i.set(d,a.jsx(jCe,{layout:this,border:u,size:this.state.calculatedBorderBarSize})),r.set(d,a.jsx(ICe,{layout:this,border:u,show:u.getSelected()!==-1})))}const o=this.getClassName(Z.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER),l=this.getClassName(Z.FLEXLAYOUT__LAYOUT_BORDER_CONTAINER_INNER);if(this.props.model.getBorderSet().getLayoutHorizontal()){const c=a.jsxs("div",{className:l,style:{flexDirection:"column"},children:[r.get(de.TOP),a.jsxs("div",{className:l,style:{flexDirection:"row"},children:[r.get(de.LEFT),e,r.get(de.RIGHT)]}),r.get(de.BOTTOM)]});return a.jsxs("div",{className:o,style:{flexDirection:"column"},children:[i.get(de.TOP),a.jsxs("div",{className:l,style:{flexDirection:"row"},children:[i.get(de.LEFT),c,i.get(de.RIGHT)]}),i.get(de.BOTTOM)]})}else{const c=a.jsxs("div",{className:l,style:{flexDirection:"row"},children:[r.get(de.LEFT),a.jsxs("div",{className:l,style:{flexDirection:"column"},children:[r.get(de.TOP),e,r.get(de.BOTTOM)]}),r.get(de.RIGHT)]});return a.jsxs("div",{className:o,style:{flexDirection:"row"},children:[i.get(de.LEFT),a.jsxs("div",{className:l,style:{flexDirection:"column"},children:[i.get(de.TOP),c,i.get(de.BOTTOM)]}),i.get(de.RIGHT)]})}}else return a.jsx("div",{className:t,ref:this.mainRef,style:{position:"absolute",top:0,left:0,bottom:0,right:0,display:"flex"},children:e})}renderLayout(){return a.jsxs(a.Fragment,{children:[a.jsx(Qz,{layout:this,node:this.props.model.getRoot(this.windowId)},"__row__"),this.renderEdgeIndicators()]})}renderEdgeIndicators(){const e=[],t=this.icons.edgeArrow;if(this.state.showEdges){const s=this.props.model.getRoot(this.windowId).getRect(),i=rb,r=xR,o=rb/2,l=this.getClassName(Z.FLEXLAYOUT__EDGE_RECT),c=50;e.push(a.jsx("div",{style:{top:0,left:s.width/2-o,width:i,height:r,borderBottomLeftRadius:c,borderBottomRightRadius:c},className:l+" "+this.getClassName(Z.FLEXLAYOUT__EDGE_RECT_TOP),children:a.jsx("div",{style:{transform:"rotate(180deg)"},children:t})},"North")),e.push(a.jsx("div",{style:{top:s.height/2-o,left:0,width:r,height:i,borderTopRightRadius:c,borderBottomRightRadius:c},className:l+" "+this.getClassName(Z.FLEXLAYOUT__EDGE_RECT_LEFT),children:a.jsx("div",{style:{transform:"rotate(90deg)"},children:t})},"West")),e.push(a.jsx("div",{style:{top:s.height-r,left:s.width/2-o,width:i,height:r,borderTopLeftRadius:c,borderTopRightRadius:c},className:l+" "+this.getClassName(Z.FLEXLAYOUT__EDGE_RECT_BOTTOM),children:a.jsx("div",{children:t})},"South")),e.push(a.jsx("div",{style:{top:s.height/2-o,left:s.width-r,width:r,height:i,borderTopLeftRadius:c,borderBottomLeftRadius:c},className:l+" "+this.getClassName(Z.FLEXLAYOUT__EDGE_RECT_RIGHT),children:a.jsx("div",{style:{transform:"rotate(-90deg)"},children:t})},"East"))}return e}renderWindows(){const e=[];if(this.supportsPopout){const t=this.props.model.getwindowsMap();let s=1;for(const[i,r]of t)i!==zs.MAIN_WINDOW_ID&&(e.push(a.jsx(RCe,{layout:this,title:this.popoutWindowName+" "+s,layoutWindow:r,url:this.popoutURL+"?id="+i,onSetWindow:this.onSetWindow,onCloseWindow:this.onCloseWindow,children:a.jsx("div",{className:this.props.popoutClassName,children:a.jsx(ys,{...this.props,windowId:i,mainLayout:this})})},i)),s++)}return e}renderTabMoveables(){const e=new Map;return this.props.model.visitNodes(t=>{if(t instanceof bt){const s=t,i=this.getMoveableElement(s.getId());s.setMoveableElement(i);const r=s.isSelected(),o=s.getParent().getContentRect(),l=r||!s.isEnableRenderOnDemand(),c=s.isRendered()||l&&o.width>0&&o.height>0;if(c){const d=s.getId()+(s.isEnableWindowReMount()?s.getWindowId():"");e.set(t.getId(),kr.createPortal(a.jsx(KCe,{layout:this,node:s,rect:o,visible:l,forceRevision:this.state.forceRevision,tabsRevision:this.props.renderRevision},d),i,d)),s.setRendered(c)}}}),e}renderTabStamps(){const e=[];return this.props.model.visitNodes(t=>{if(t instanceof bt){const s=t;e.push(a.jsx(NCe,{layout:this,node:s},s.getId()))}}),e}renderTabs(){const e=new Map;return this.props.model.visitWindowNodes(this.windowId,t=>{if(t instanceof bt){const s=t,i=s.isSelected(),r=s.getPath();(s.isRendered()||i||!s.isEnableRenderOnDemand())&&e.set(s.getId(),a.jsx(GCe,{layout:this,path:r,node:s,selected:i},s.getId()))}}),e}renderMetricsElements(){return a.jsx("div",{ref:this.findBorderBarSizeRef,className:this.getClassName(Z.FLEXLAYOUT__BORDER_SIZER),children:"FindBorderBarSize"},"findBorderBarSize")}checkForBorderToShow(e,t){const s=this.getBoundingClientRect(this.mainRef.current),i=s.getCenter(),r=xR,o=rb/2;let l=!1;this.props.model.isEnableEdgeDock()&&this.state.showHiddenBorder===de.CENTER&&(t>i.y-o&&t<i.y+o||e>i.x-o&&e<i.x+o)&&(l=!0);let c=de.CENTER;l||(e<=s.x+r?c=de.LEFT:e>=s.getRight()-r?c=de.RIGHT:t<=s.y+r?c=de.TOP:t>=s.getBottom()-r&&(c=de.BOTTOM)),c!==this.state.showHiddenBorder&&this.setState({showHiddenBorder:c})}tidyMoveablesMap(){const e=new Map;this.props.model.visitNodes((t,s)=>{t instanceof bt&&e.set(t.getId(),t)});for(const[t,s]of this.moveableElementMap)e.has(t)||(s.remove(),this.moveableElementMap.delete(t))}reorderComponents(e,t){const s=[],i=new Set;let r=[];for(const o of t)e.get(o)&&(s.push(o),i.add(o));t.splice(0,t.length,...s);for(const[o,l]of e)i.has(o)||t.push(o);return r=t.map(o=>e.get(o)),r}redraw(e){this.mainLayout.setState((t,s)=>({forceRevision:t.forceRevision+1}))}redrawInternal(e){this.mainLayout.setState((t,s)=>({layoutRevision:t.layoutRevision+1}))}doAction(e){if(this.props.onAction!==void 0){const t=this.props.onAction(e);return t!==void 0?this.props.model.doAction(t):void 0}else return this.props.model.doAction(e)}getBoundingClientRect(e){const t=this.getDomRect();return t?Ce.getBoundingClientRect(e).relativeTo(t):Ce.empty()}getMoveableContainer(){return this.moveablesRef.current}getMoveableElement(e){let t=this.moveableElementMap.get(e);return t===void 0&&(t=document.createElement("div"),this.moveablesRef.current.appendChild(t),t.className=Z.FLEXLAYOUT__TAB_MOVEABLE,this.moveableElementMap.set(e,t)),t}getMainLayout(){return this.mainLayout}getCurrentDocument(){return this.currentDocument}getDomRect(){return this.selfRef.current?Ce.fromDomRect(this.selfRef.current.getBoundingClientRect()):Ce.empty()}getWindowId(){return this.windowId}getRootDiv(){return this.selfRef.current}getMainElement(){return this.mainRef.current}getFactory(){return this.props.factory}isSupportsPopout(){return this.supportsPopout}isRealtimeResize(){return this.props.realtimeResize??!1}getPopoutURL(){return this.popoutURL}setEditingTab(e){this.setState({editingTab:e})}getEditingTab(){return this.state.editingTab}getModel(){return this.props.model}getScreenRect(e){const t=e.clone(),s=this.getDomRect(),i=60,r=2;return t.x=this.currentWindow.screenX+this.currentWindow.scrollX+r/2+s.x+t.x,t.y=this.currentWindow.screenY+this.currentWindow.scrollY+(i-r/2)+s.y+t.y,t.height+=i,t.width+=r,t}addTabToTabSet(e,t){if(this.props.model.getNodeById(e)!==void 0)return this.doAction(je.addNode(t,e,de.CENTER,-1))}addTabToActiveTabSet(e){const t=this.props.model.getActiveTabset(this.windowId);if(t!==void 0)return this.doAction(je.addNode(e,t.getId(),de.CENTER,-1))}maximize(e){this.doAction(je.maximizeToggle(e.getId(),this.getWindowId()))}customizeTab(e,t){this.props.onRenderTab&&this.props.onRenderTab(e,t)}customizeTabSet(e,t){this.props.onRenderTabSet&&this.props.onRenderTabSet(e,t)}i18nName(e,t){let s;return this.props.i18nMapper&&(s=this.props.i18nMapper(e,t)),s===void 0&&(s=e+(t===void 0?"":t)),s}getShowOverflowMenu(){return this.props.onShowOverflowMenu}getTabSetPlaceHolderCallback(){return this.props.onTabSetPlaceHolder}showContextMenu(e,t){this.props.onContextMenu&&this.props.onContextMenu(e,t)}auxMouseClick(e,t){this.props.onAuxMouseClick&&this.props.onAuxMouseClick(e,t)}showOverlay(e){this.setState({showOverlay:e}),eC(!e,this.currentDocument)}addTabWithDragAndDrop(e,t,s){const i=bt.fromJson(t,this.props.model,!1);ys.dragState=new ob(this.mainLayout,"add",i,t,s)}moveTabWithDragAndDrop(e,t){this.setDragNode(e,t)}setDragComponent(e,t,s,i){const r=a.jsx("div",{style:{position:"unset"},className:this.getClassName(Z.FLEXLAYOUT__LAYOUT)+" "+this.getClassName(Z.FLEXLAYOUT__DRAG_RECT),children:t}),o=this.currentDocument.createElement("div");o.setAttribute("data-layout-path","/drag-rectangle"),o.style.position="absolute",o.style.left="-10000px",o.style.top="-10000px",this.currentDocument.body.appendChild(o),ZC(o).render(r),e.dataTransfer.setDragImage(o,s,i),setTimeout(()=>{this.currentDocument.body.removeChild(o)},0)}setDraggingOverWindow(e){this.isDraggingOverWindow!==e&&(this.outlineDiv&&(this.outlineDiv.style.visibility=e?"hidden":"visible"),e?this.setState({showEdges:!1}):this.props.model.getMaximizedTabset(this.windowId)===void 0&&this.setState({showEdges:this.props.model.isEnableEdgeDock()}),this.isDraggingOverWindow=e)}clearDragMain(){ys.dragState=void 0,this.windowId===zs.MAIN_WINDOW_ID&&(this.isDraggingOverWindow=!1);for(const[,e]of this.props.model.getwindowsMap())e.layout.clearDragLocal()}clearDragLocal(){this.setState({showEdges:!1}),this.showOverlay(!1),this.dragEnterCount=0,this.dragging=!1,this.outlineDiv&&(this.selfRef.current.removeChild(this.outlineDiv),this.outlineDiv=void 0)}};V(e6,"dragState");let qCe=e6;const ZCe={close:a.jsx(vR,{}),closeTabset:a.jsx(vR,{}),popout:a.jsx(BCe,{}),maximize:a.jsx(DCe,{}),restore:a.jsx(UCe,{}),more:a.jsx(LCe,{}),edgeArrow:a.jsx(FCe,{}),activeTabset:a.jsx($Ce,{})},JCe=Kz(),rb=100,xR=10;class ob{constructor(e,t,s,i,r){V(this,"mainLayout"),V(this,"dragSource"),V(this,"dragNode"),V(this,"dragJson"),V(this,"fnNewNodeDropped"),this.mainLayout=e,this.dragSource=t,this.dragNode=s,this.dragJson=i,this.fnNewNodeDropped=r}}const QCe={global:{tabEnableFloat:!0,tabSetEnableMaximize:!0,tabSetEnableDrag:!0,tabSetMinWidth:200,tabSetMinHeight:150,borderBarSize:30},borders:[],layout:{type:"row",weight:100,children:[{type:"tabset",id:"main",weight:100,children:[{type:"tab",id:"canvas",name:"CANVAS",component:"canvas",enableClose:!1}]}]}},eEe={"google-drive":{icon:"",name:"Google Drive",url:"https://drive.google.com/embeddedfolderview?id=root#grid"},canva:{icon:"",name:"Canva",url:"https://www.canva.com/"},"founder-dashboard":{icon:"",name:"Founder Dashboard",component:"founder-dashboard"},"pat-council":{icon:"",name:"PAT Council",component:"pat-council"},devtools:{icon:"",name:"DevTools",component:"devtools"},settings:{icon:"",name:"Settings",component:"settings"},store:{icon:"",name:"Store",component:"store"},catalog:{icon:"",name:"Catlogo",component:"catalog"},"mining-panel":{icon:"",name:"Meu Mining",component:"mining-panel"},"defend-panel":{icon:"",name:"Panda Defend",component:"defend-panel"}};function tEe({canvasComponent:n,componentFactory:e,onModelChange:t}){const s=b.useRef(zs.fromJson(QCe)),i=b.useRef(null),r=b.useCallback(c=>{const d=c.getComponent(),u=c.getConfig()||{};return d==="canvas"?n||a.jsx("div",{children:"Canvas Loading..."}):d==="iframe"?a.jsx("iframe",{src:u.url,style:{width:"100%",height:"100%",border:"none",background:"#0a0a1a"},title:c.getName(),sandbox:"allow-scripts allow-same-origin allow-popups allow-forms"}):e?e(d,u,c):a.jsxs("div",{style:{padding:16},children:["Unknown: ",d]})},[n,e]),o=b.useCallback((c,d={})=>{const u=s.current;if(!u)return;if(u.getNodeById(c)){u.doAction(je.selectTab(c));return}const p=eEe[c]||{},f=!!p.url||!!d.url,g={type:"tab",id:c,name:`${(p.name||d.name||c).toUpperCase()}`,component:f?"iframe":p.component||c,config:{...d,url:p.url||d.url,appId:c}},m=u.getActiveTabset()||u.getNodeById("main");m&&u.doAction(je.addNode(g,m.getId(),de.CENTER,-1))},[]),l=b.useCallback(c=>{const d=s.current;if(!d)return;d.getNodeById(c)&&d.doAction(je.deleteTab(c))},[]);return Oe.useEffect(()=>(window.__pfWindowManager={openApp:o,closeApp:l},()=>{delete window.__pfWindowManager}),[o,l]),a.jsx(XCe,{ref:i,model:s.current,factory:r,onModelChange:t,font:{size:"13px"}})}function ji(n,e){var t;(t=window.__pfWindowManager)==null||t.openApp(n,e)}function Ng(n){var e;(e=window.__pfWindowManager)==null||e.closeApp(n)}function nEe({availablePlugins:n=[],onClose:e,onCreate:t}){var S;const[s,i]=b.useState(""),[r,o]=b.useState(""),[l,c]=b.useState([]),[d,u]=b.useState(0),[h,p]=b.useState("landing"),f=[{id:"landing",name:"Landing Page",icon:""},{id:"kiwify",name:"Kiwify",icon:""},{id:"hotmart",name:"Hotmart",icon:""},{id:"steam",name:"Steam",icon:""},{id:"appstore",name:"App Store",icon:""},{id:"playstore",name:"Play Store",icon:""},{id:"api",name:"API Hook",icon:""}],g=n.length>0?n:[{id:"crm",name:"Panda CRM",icon:"",category:"core"},{id:"trading",name:"Trading Hub",icon:"",category:"core"},{id:"brain",name:"Panda Brain",icon:"",category:"core"},{id:"social",name:"Social Manager",icon:"",category:"addon"},{id:"analytics",name:"Analytics Pro",icon:"",category:"addon"},{id:"automation",name:"Automation Suite",icon:"",category:"addon"}],m=v=>{c(C=>C.includes(v)?C.filter(T=>T!==v):[...C,v])},x=()=>{if(!s.trim()){alert("Nome do bundle  obrigatrio");return}if(l.length===0){alert("Selecione pelo menos um plugin");return}const v={id:`bundle-${Date.now()}`,name:s,description:r,plugins:l,priceUSD:d,hookPlatform:h,createdAt:new Date().toISOString()};console.log(" Bundle created:",v),t&&t(v),e()},y=l.length*256;return a.jsx("div",{className:"bundle-overlay",onClick:e,children:a.jsxs("div",{className:"bundle-creator",onClick:v=>v.stopPropagation(),children:[a.jsxs("header",{className:"bundle-header",children:[a.jsx("h2",{children:" Bundle Creator"}),a.jsx("button",{className:"btn-close",onClick:e,children:""})]}),a.jsxs("div",{className:"bundle-content",children:[a.jsxs("section",{className:"bundle-section",children:[a.jsx("h3",{children:" Informaes do Bundle"}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Nome do Bundle *"}),a.jsx("input",{type:"text",value:s,onChange:v=>i(v.target.value),placeholder:"Meu Bundle Incrvel"})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Descrio"}),a.jsx("textarea",{value:r,onChange:v=>o(v.target.value),placeholder:"O que esse bundle faz?",rows:2})]}),a.jsxs("div",{className:"form-group",children:[a.jsx("label",{children:"Preo (USD)"}),a.jsx("input",{type:"number",value:d,onChange:v=>u(parseFloat(v.target.value)||0),min:0,step:.01})]})]}),a.jsxs("section",{className:"bundle-section",children:[a.jsx("h3",{children:" Selecionar Plugins"}),a.jsx("p",{className:"section-hint",children:"Escolha os plugins que faro parte do bundle"}),a.jsx("div",{className:"plugins-grid",children:g.map(v=>a.jsxs("div",{className:`plugin-card ${l.includes(v.id)?"selected":""}`,onClick:()=>m(v.id),children:[a.jsx("span",{className:"plugin-icon",children:v.icon}),a.jsx("span",{className:"plugin-name",children:v.name}),a.jsx("span",{className:`plugin-category ${v.category}`,children:v.category}),l.includes(v.id)&&a.jsx("span",{className:"plugin-check",children:""})]},v.id))})]}),a.jsxs("section",{className:"bundle-section",children:[a.jsx("h3",{children:" Plataforma de Distribuio"}),a.jsx("p",{className:"section-hint",children:"Escolha onde o bundle ser vendido"}),a.jsx("div",{className:"platforms-grid",children:f.map(v=>a.jsxs("button",{className:`platform-btn ${h===v.id?"selected":""}`,onClick:()=>p(v.id),children:[a.jsx("span",{className:"platform-icon",children:v.icon}),a.jsx("span",{className:"platform-name",children:v.name})]},v.id))})]}),a.jsxs("section",{className:"bundle-summary",children:[a.jsx("h3",{children:" Resumo"}),a.jsxs("div",{className:"summary-grid",children:[a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"Plugins"}),a.jsx("span",{className:"summary-value",children:l.length})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"Tamanho Est."}),a.jsxs("span",{className:"summary-value",children:[y," KB"]})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"Preo"}),a.jsxs("span",{className:"summary-value",children:["$",d.toFixed(2)]})]}),a.jsxs("div",{className:"summary-item",children:[a.jsx("span",{className:"summary-label",children:"Plataforma"}),a.jsx("span",{className:"summary-value",children:(S=f.find(v=>v.id===h))==null?void 0:S.name})]})]})]})]}),a.jsxs("footer",{className:"bundle-footer",children:[a.jsx("button",{className:"btn-cancel",onClick:e,children:"Cancelar"}),a.jsx("button",{className:"btn-create",onClick:x,children:" Criar Bundle"})]})]})})}const Ko=6e6,nC={"Drive.read":1,"Drive.write":2,"Sheets.read":1,"Sheets.write":2,"Brain.chat":5,"Brain.vision":8,"Social.send":3,"Webhook.trigger":2,"Store.checkout":4,"Auth.verify":1};function SR(){const n=Object.keys(nC),e=[],t=Date.now();for(let s=0;s<50;s++){const i=n[Math.floor(Math.random()*n.length)];e.push({id:`exec-${s}`,operation:i,cost:nC[i],timestamp:new Date(t-s*6e4*(Math.random()*30+1)).toISOString(),status:Math.random()>.05?"success":"error"})}return e.sort((s,i)=>new Date(i.timestamp)-new Date(s.timestamp))}function sEe(){const[n,e]=b.useState({daily:Ko,used:0,remaining:Ko,percentage:0}),[t,s]=b.useState([]),[i,r]=b.useState([]),[o,l]=b.useState(!0),[c,d]=b.useState([]);b.useEffect(()=>{const h=Math.floor(Math.random()*15e4)+5e3,p=Ko-h,f=h/Ko*100;e({daily:Ko,used:h,remaining:p,percentage:f});const g=SR();s(g);const m={};g.forEach(S=>{m[S.operation]||(m[S.operation]={operation:S.operation,totalCost:0,count:0}),m[S.operation].totalCost+=S.cost,m[S.operation].count+=1});const x=Object.values(m).sort((S,v)=>v.totalCost-S.totalCost);r(x.slice(0,5));const y=[];f>80?y.push({type:"critical",message:" GAS quota above 80%  consider batching operations"}):f>50&&y.push({type:"warning",message:" GAS usage moderate  monitor heavy operations"}),d(y),l(!1)},[]);const u=b.useCallback(()=>{l(!0),setTimeout(()=>{const h=Math.floor(Math.random()*15e4)+5e3,p=Ko-h;e({daily:Ko,used:h,remaining:p,percentage:h/Ko*100}),s(SR()),l(!1)},800)},[]);return{quota:n,executionLog:t,topOperations:i,alerts:c,isLoading:o,refresh:u,operationCosts:nC}}function wR({onClose:n}){const{quota:e,executionLog:t,topOperations:s,alerts:i,isLoading:r,refresh:o}=sEe(),[l,c]=b.useState("overview"),d=f=>f>=1e6?`${(f/1e6).toFixed(1)}M`:f>=1e3?`${(f/1e3).toFixed(1)}K`:f.toString(),u=f=>f>80?"#ff4444":f>50?"#ffaa00":"#4cc9f0",h=f=>new Date(f).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),p=[" Batch Drive.write operations to reduce quota usage by ~40%"," Cache Sheets.read results with 5-minute TTL  saves ~200 calls/hour"," Use incremental sync instead of full Drive scans"," Schedule Brain.chat calls during off-peak hours (2AM-6AM UTC)"," Compress payloads before Webhook.trigger to reduce execution time"];return r?a.jsxs("div",{className:"gasometer-panel",children:[a.jsxs("div",{className:"gasometer-header",children:[a.jsx("h3",{children:" Gasmetro"}),a.jsx("button",{className:"gasometer-close",onClick:n,children:""})]}),a.jsxs("div",{className:"gasometer-loading",children:[a.jsx("div",{className:"gasometer-spinner"}),a.jsx("p",{children:"Loading GAS metrics..."})]})]}):a.jsxs("div",{className:"gasometer-panel",children:[a.jsxs("div",{className:"gasometer-header",children:[a.jsxs("div",{className:"gasometer-title",children:[a.jsx("h3",{children:" Gasmetro"}),a.jsx("span",{className:"gasometer-badge",children:"GAS Monitor v1.0"})]}),a.jsxs("div",{className:"gasometer-actions",children:[a.jsx("button",{className:"gasometer-refresh",onClick:o,title:"Refresh",children:""}),a.jsx("button",{className:"gasometer-close",onClick:n,children:""})]})]}),i.length>0&&a.jsx("div",{className:"gasometer-alerts",children:i.map((f,g)=>a.jsx("div",{className:`gasometer-alert gasometer-alert-${f.type}`,children:f.message},g))}),a.jsx("div",{className:"gasometer-tabs",children:["overview","history","optimize"].map(f=>a.jsxs("button",{className:`gasometer-tab ${l===f?"active":""}`,onClick:()=>c(f),children:[f==="overview"&&" Overview",f==="history"&&" History",f==="optimize"&&" AI Tips"]},f))}),a.jsxs("div",{className:"gasometer-content",children:[l==="overview"&&a.jsxs("div",{className:"gasometer-overview",children:[a.jsxs("div",{className:"gasometer-gauge-card",children:[a.jsx("div",{className:"gasometer-gauge-label",children:"Daily Quota Usage"}),a.jsx("div",{className:"gasometer-gauge-bar",children:a.jsx("div",{className:"gasometer-gauge-fill",style:{width:`${Math.min(e.percentage,100)}%`,background:u(e.percentage)}})}),a.jsxs("div",{className:"gasometer-gauge-stats",children:[a.jsxs("span",{children:[d(e.used)," used"]}),a.jsxs("span",{className:"gasometer-gauge-pct",children:[e.percentage.toFixed(2),"%"]}),a.jsxs("span",{children:[d(e.remaining)," remaining"]})]})]}),a.jsxs("div",{className:"gasometer-stats-grid",children:[a.jsxs("div",{className:"gasometer-stat-card",children:[a.jsx("div",{className:"gasometer-stat-icon",children:""}),a.jsx("div",{className:"gasometer-stat-value",children:d(e.used)}),a.jsx("div",{className:"gasometer-stat-label",children:"Executions Today"})]}),a.jsxs("div",{className:"gasometer-stat-card",children:[a.jsx("div",{className:"gasometer-stat-icon",children:""}),a.jsx("div",{className:"gasometer-stat-value",children:d(e.remaining)}),a.jsx("div",{className:"gasometer-stat-label",children:"Remaining"})]}),a.jsxs("div",{className:"gasometer-stat-card",children:[a.jsx("div",{className:"gasometer-stat-icon",children:""}),a.jsx("div",{className:"gasometer-stat-value",children:t.filter(f=>f.status==="success").length}),a.jsx("div",{className:"gasometer-stat-label",children:"Success Rate"})]}),a.jsxs("div",{className:"gasometer-stat-card",children:[a.jsx("div",{className:"gasometer-stat-icon",children:""}),a.jsx("div",{className:"gasometer-stat-value",children:t.filter(f=>f.status==="error").length}),a.jsx("div",{className:"gasometer-stat-label",children:"Errors"})]})]}),a.jsxs("div",{className:"gasometer-top-ops",children:[a.jsx("h4",{children:" Top Operations by Cost"}),a.jsx("div",{className:"gasometer-ops-list",children:s.map((f,g)=>a.jsxs("div",{className:"gasometer-op-row",children:[a.jsxs("span",{className:"gasometer-op-rank",children:["#",g+1]}),a.jsx("span",{className:"gasometer-op-name",children:f.operation}),a.jsxs("span",{className:"gasometer-op-count",children:[f.count,""]}),a.jsxs("span",{className:"gasometer-op-cost",children:[f.totalCost," exec"]}),a.jsx("div",{className:"gasometer-op-bar",children:a.jsx("div",{className:"gasometer-op-bar-fill",style:{width:`${f.totalCost/s[0].totalCost*100}%`}})})]},g))})]})]}),l==="history"&&a.jsxs("div",{className:"gasometer-history",children:[a.jsxs("div",{className:"gasometer-history-header",children:[a.jsx("span",{children:"Last 50 Operations"}),a.jsxs("span",{className:"gasometer-history-count",children:[t.length," entries"]})]}),a.jsx("div",{className:"gasometer-history-list",children:t.map(f=>a.jsxs("div",{className:`gasometer-history-row ${f.status}`,children:[a.jsx("span",{className:"gasometer-history-status",children:f.status==="success"?"":""}),a.jsx("span",{className:"gasometer-history-op",children:f.operation}),a.jsxs("span",{className:"gasometer-history-cost",children:[f.cost," exec"]}),a.jsx("span",{className:"gasometer-history-time",children:h(f.timestamp)})]},f.id))})]}),l==="optimize"&&a.jsxs("div",{className:"gasometer-optimize",children:[a.jsxs("div",{className:"gasometer-ai-header",children:[a.jsx("span",{children:" Gemini Optimization Suggestions"}),a.jsx("span",{className:"gasometer-ai-badge",children:"Powered by Panda Brain"})]}),a.jsx("div",{className:"gasometer-ai-tips",children:p.map((f,g)=>a.jsx("div",{className:"gasometer-ai-tip",children:a.jsx("div",{className:"gasometer-ai-tip-text",children:f})},g))}),a.jsx("div",{className:"gasometer-ai-footer",children:a.jsx("p",{children:"These suggestions are generated based on your usage patterns. Apply them to reduce GAS consumption by up to 60%."})})]})]})]})}const bR=[{date:"13/02",earned:3.2,status:""},{date:"12/02",earned:3.4,status:""},{date:"11/02",earned:2.9,status:""},{date:"10/02",earned:3.1,status:""},{date:"09/02",earned:3.3,status:""},{date:"08/02",earned:0,status:""},{date:"07/02",earned:3,status:""}];function iEe({embedded:n=!1}){const[e,t]=b.useState(!1),[s,i]=b.useState(!1),[r,o]=b.useState(50),[l,c]=b.useState(0);b.useEffect(()=>{if(!e)return;const v=setInterval(()=>{c(C=>C+1)},1e3);return()=>clearInterval(v)},[e]);const d=v=>{const C=Math.floor(v/3600),T=Math.floor(v%3600/60),I=v%60;return`${C}h ${T}m ${I}s`},u=s?r>=75?" Forest":r>=50?" Tree":" Sprout":r>=50?" Sprout":" Seed",h=s?r>=75?"4.2":"2.8":r>=50?"1.1":"0.6",p=s?r>=75?5.2:3.4:r>=50?1.3:.7,f=42.8,g=bR.reduce((v,C)=>v+C.earned,0).toFixed(1),m={padding:n?"24px":"32px",maxWidth:"780px",margin:"0 auto",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",color:"#e0e0e0"},x={background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"12px",padding:"16px 20px",marginBottom:"16px"},y={textAlign:"center",padding:"14px",background:"rgba(255,255,255,0.02)",borderRadius:"10px",border:"1px solid rgba(255,255,255,0.06)",flex:1,minWidth:"130px"},S={fontWeight:700,fontSize:"14px",marginBottom:"12px",color:"#f59e0b"};return a.jsxs("div",{style:m,children:[a.jsxs("div",{style:{marginBottom:"24px"},children:[a.jsx("h2",{style:{fontSize:"22px",fontWeight:700,margin:0},children:" Meu Mining"}),a.jsx("p",{style:{margin:"6px 0 0",opacity:.6,fontSize:"13px",lineHeight:1.5},children:"Painel pessoal de minerao  acompanhe seus ganhos em Panda Coins"})]}),a.jsx("div",{style:{...x,background:"rgba(102,126,234,0.06)",border:"1px solid rgba(102,126,234,0.2)"},children:a.jsxs("div",{style:{display:"flex",gap:"12px",alignItems:"flex-start"},children:[a.jsx("span",{style:{fontSize:"20px"},children:""}),a.jsxs("div",{style:{lineHeight:"1.6",fontSize:"13px"},children:[a.jsx("div",{style:{fontWeight:700,marginBottom:"4px",color:"#667eea"},children:"Como funciona o Partner Mode"}),a.jsxs("div",{style:{opacity:.7,lineHeight:1.6},children:["O Partner Mode utiliza CPU/GPU ociosa do seu computador para minerar criptomoeda via Rust Agent. Voc recebe"," ",a.jsx("strong",{style:{color:"#10b981"},children:"60%"})," do valor convertido em Panda Coins. Minerao "," ",a.jsx("strong",{children:"sempre opt-in e desligada por padro"}),". Desative a qualquer momento."]})]})]})}),a.jsx("div",{style:x,children:a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontWeight:600,fontSize:"15px"},children:e?" Minerando":" Minerao Desligada"}),a.jsx("div",{style:{fontSize:"12px",opacity:.5,marginTop:"4px"},children:e?`${s?"CPU + GPU":"Apenas CPU"}  ${r}% limite`:"Ligue para ganhar PC automaticamente"})]}),a.jsx("button",{onClick:()=>t(!e),style:{padding:"10px 24px",borderRadius:"8px",border:"none",fontWeight:700,fontSize:"13px",cursor:"pointer",background:e?"rgba(239,68,68,0.15)":"rgba(16,185,129,0.15)",color:e?"#ef4444":"#10b981",transition:"all 0.2s"},children:e?" Parar":" Iniciar Mining"})]})}),!e&&a.jsxs("div",{style:{...x,background:"rgba(245,158,11,0.06)",border:"1px solid rgba(245,158,11,0.2)",textAlign:"center",padding:"28px 20px"},children:[a.jsx("div",{style:{fontSize:"36px",marginBottom:"10px"},children:""}),a.jsx("div",{style:{fontWeight:700,fontSize:"16px",color:"#f59e0b"},children:"Ganhe Panda Coins Passivamente"}),a.jsx("div",{style:{fontSize:"13px",opacity:.7,lineHeight:1.6,maxWidth:"420px",margin:"8px auto 0"},children:"Ligue o Partner Mode e ganhe Panda Coins automaticamente enquanto seu computador est ocioso. Sem custos extras, desative quando quiser."})]}),e&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:x,children:[a.jsx("div",{style:S,children:" Stats em Tempo Real"}),a.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[a.jsxs("div",{style:y,children:[a.jsx("div",{style:{fontSize:"22px",fontWeight:700,color:"#10b981"},children:u}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Perfil Hardware"})]}),a.jsxs("div",{style:y,children:[a.jsxs("div",{style:{fontSize:"22px",fontWeight:700,color:"#f59e0b",fontFamily:"monospace"},children:["~",h," KH/s"]}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Hashrate"})]}),a.jsxs("div",{style:y,children:[a.jsx("div",{style:{fontSize:"22px",fontWeight:700,color:"#667eea",fontFamily:"monospace"},children:d(l)}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Uptime Sesso"})]}),a.jsxs("div",{style:y,children:[a.jsxs("div",{style:{fontSize:"22px",fontWeight:700,color:"#f59e0b"},children:["~",p," PC"]}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Estimado/Dia"})]})]})]}),a.jsxs("div",{style:x,children:[a.jsx("div",{style:S,children:" Controle de Recursos"}),a.jsxs("div",{style:{marginBottom:"12px"},children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"13px",marginBottom:"6px"},children:[a.jsx("span",{children:"Limite CPU"}),a.jsxs("span",{style:{fontWeight:700},children:[r,"%"]})]}),a.jsx("input",{type:"range",min:"25",max:"75",step:"5",value:r,onChange:v=>o(Number(v.target.value)),style:{width:"100%",accentColor:"#f59e0b",height:"6px"}}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:"10px",opacity:.4,marginTop:"4px"},children:[a.jsx("span",{children:"25% Baixo"}),a.jsx("span",{children:"50% Equilibrado"}),a.jsx("span",{children:"75% Alto"})]})]}),a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"12px",paddingTop:"12px",borderTop:"1px solid rgba(255,255,255,0.06)"},children:[a.jsxs("div",{children:[a.jsx("div",{style:{fontWeight:600,fontSize:"13px"},children:" Minerao GPU"}),a.jsx("div",{style:{fontSize:"11px",opacity:.5},children:"Ativa GPU para ganhos maiores"})]}),a.jsx("button",{onClick:()=>i(!s),style:{padding:"6px 16px",borderRadius:"6px",border:s?"1px solid #10b981":"1px solid rgba(255,255,255,0.15)",background:s?"rgba(16,185,129,0.15)":"transparent",color:s?"#10b981":"#888",fontWeight:600,fontSize:"12px",cursor:"pointer"},children:s?" Ativa":"Desligada"})]})]})]}),a.jsxs("div",{style:x,children:[a.jsx("div",{style:S,children:" Resumo de Ganhos"}),a.jsxs("div",{style:{display:"flex",gap:"12px",flexWrap:"wrap"},children:[a.jsxs("div",{style:y,children:[a.jsx("div",{style:{fontSize:"26px",fontWeight:700,color:"#f59e0b"},children:f}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"PC Total Acumulado"})]}),a.jsxs("div",{style:y,children:[a.jsx("div",{style:{fontSize:"26px",fontWeight:700,color:"#10b981"},children:g}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"PC ltima Semana"})]}),a.jsxs("div",{style:y,children:[a.jsxs("div",{style:{fontSize:"26px",fontWeight:700,color:"#667eea"},children:["~",(p*30).toFixed(0)]}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,marginTop:"4px"},children:"Estimativa Mensal"})]})]})]}),a.jsxs("div",{style:x,children:[a.jsx("div",{style:S,children:" Histrico (ltimos 7 Dias)"}),a.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"13px"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.1)",textAlign:"left"},children:[a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Data"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"PC Ganho"}),a.jsx("th",{style:{padding:"8px 12px",fontWeight:600,opacity:.6},children:"Status"})]})}),a.jsx("tbody",{children:bR.map((v,C)=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(255,255,255,0.04)"},children:[a.jsx("td",{style:{padding:"8px 12px",fontFamily:"monospace"},children:v.date}),a.jsx("td",{style:{padding:"8px 12px",fontWeight:600,color:v.earned>0?"#10b981":"#666"},children:v.earned>0?`+${v.earned} PC`:""}),a.jsx("td",{style:{padding:"8px 12px"},children:v.status})]},C))})]})]}),a.jsxs("div",{style:x,children:[a.jsx("div",{style:S,children:" Distribuio de Receita"}),a.jsxs("div",{style:{display:"flex",height:"24px",borderRadius:"6px",overflow:"hidden",marginBottom:"10px"},children:[a.jsx("div",{style:{width:"60%",background:"#10b981",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:700,color:"#fff"},children:"60% Voc"}),a.jsx("div",{style:{width:"40%",background:"#ef4444",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"10px",fontWeight:700,color:"#fff"},children:"40% Infra"})]}),a.jsx("div",{style:{fontSize:"11px",opacity:.5,lineHeight:1.6},children:"Fator x0.60 flat: 60% convertido em PC para voc. Os 40% restantes cobrem impostos (BR), infraestrutura, hold reserve e treasury."})]}),a.jsx("div",{style:{fontSize:"11px",opacity:.35,marginTop:"8px",textAlign:"center"},children:" Dados simulados  Execuo real requer Rust Agent (binrio nativo). Ciclo de pagamento: End-of-Day (23:59 UTC)."})]})}const rEe=[{id:"@panda/ai-chat",name:"Panda Brain Chat",icon:"",score:98,risk:"low",permissions:["panda.ui.toast","panda.data.read"],lastScan:"2026-02-13 09:00",status:"approved",type:"module"},{id:"@panda/draw-tools",name:"Draw Tools",icon:"",score:95,risk:"low",permissions:["panda.ui.canvas","panda.data.write"],lastScan:"2026-02-13 08:30",status:"approved",type:"module"},{id:"@fulano/steam-library",name:"Steam Library",icon:"",score:82,risk:"medium",permissions:["panda.ui.toast","panda.data.read","panda.store.state"],lastScan:"2026-02-12 22:15",status:"approved",type:"module"},{id:"@dev/whatsapp-bridge",name:"WhatsApp Bridge",icon:"",score:71,risk:"high",permissions:["panda.ui.toast","panda.data.read","panda.data.write","panda.bridge.external"],lastScan:"2026-02-12 18:00",status:"review",type:"tentacle"},{id:"@carlo/epic-hook",name:"Epic Games Hook",icon:"",score:45,risk:"high",permissions:["panda.data.read","panda.data.write","panda.auth.modify","panda.wallet.send"],lastScan:"2026-02-11 14:00",status:"suspended",type:"tentacle"}],Bu={"@panda/ai-chat":{bonus:["CSP declarado (+5)","TypeScript completo (+5)","Testes > 50% (+5)","README.md (+5)"],penalty:[]},"@panda/draw-tools":{bonus:["strict mode (+5)","README.md (+5)","Changelog semntico (+5)"],penalty:["Web Workers no declarado (-10)"]},"@fulano/steam-library":{bonus:["README.md (+5)","CSP declarado (+5)"],penalty:["fetch() externo no declarado (-10)","IndexedDB > 50MB (-10)"]},"@dev/whatsapp-bridge":{bonus:["strict mode (+5)"],penalty:["fetch() externo no declarado (-10)","WebRTC no declarado (-10)","Notification API (-10)"]},"@carlo/epic-hook":{bonus:[],penalty:["eval() dinmico (Score=0)","Obfuscao detectada (-)","fetch() no declarado (-10)"]}},oEe=[{id:"R1",rule:"Dynamic eval",risk:"RCE"},{id:"R2",rule:"document.write",risk:"XSS"},{id:"R3",rule:"Unsafe innerHTML",risk:"XSS"},{id:"R4",rule:"Cross-origin storage",risk:"Data theft"},{id:"R5",rule:"Undeclared fetch",risk:"Exfiltration"},{id:"R6",rule:"Frame access",risk:"Sandbox escape"},{id:"R7",rule:"Crypto mining",risk:"Resource theft"},{id:"R8",rule:"Obfuscation",risk:"Hidden malware"},{id:"R9",rule:"Prototype Pollution",risk:"RCE"},{id:"R10",rule:"Hardcoded Secrets",risk:"Credential leak"},{id:"R11",rule:"Insecure Crypto",risk:"Weak security"},{id:"R12",rule:"IA Externa (bypass)",risk:"Revenue theft"},{id:"R13",rule:"Billing Bypass",risk:"Economic damage"},{id:"R14",rule:"MCP Manifest ausente",risk:"No integration"}],ab=[{id:1,time:"12:34",type:"block",msg:" @carlo/epic-hook: fetch() no autorizado bloqueado  tentativa de bypass Proxy SDK"},{id:2,time:"12:30",type:"warning",msg:" @dev/whatsapp-bridge: panda.bridge.external requer reviso  Score 71 (limtrofe)"},{id:3,time:"11:15",type:"scan",msg:" Re-scan dirio concludo: 4 mdulos OK, 1 suspenso"},{id:4,time:"10:00",type:"info",msg:" @panda/ai-chat: Score atualizado 9798  nenhuma vulnerabilidade nova"},{id:5,time:"09:45",type:"block",msg:" @carlo/epic-hook: eval() dinmico detectado  Auto-suspend ativado (Score < 50)"},{id:6,time:"08:30",type:"info",msg:" @panda/draw-tools: Sandbox test 30s  OK"}],vc={low:"#10b981",medium:"#f59e0b",high:"#ef4444"},aEe={low:" Baixo",medium:" Mdio",high:" Alto"},lEe={approved:" Aprovado",review:" Em Reviso",suspended:" Suspenso"},Yt={container:{padding:"24px 32px",maxWidth:900,margin:"0 auto",fontFamily:"'Inter', -apple-system, sans-serif",color:"var(--pf-text, #e2e8f0)"},header:{display:"flex",alignItems:"center",gap:12,marginBottom:8},title:{fontSize:24,fontWeight:700,margin:0},subtitle:{color:"var(--pf-text-muted, #94a3b8)",fontSize:14,marginBottom:24},card:{background:"var(--pf-surface, rgba(30,41,59,0.7))",border:"1px solid var(--pf-border, rgba(100,116,139,0.2))",borderRadius:12,padding:20,marginBottom:16},sectionTitle:{fontSize:15,fontWeight:700,marginBottom:14,display:"flex",alignItems:"center",gap:8},scoreBox:{display:"flex",alignItems:"center",justifyContent:"center",gap:24,padding:"20px 0"},scoreBig:{fontSize:56,fontWeight:800,lineHeight:1},moduleRow:{display:"flex",alignItems:"center",gap:12,padding:"10px 14px",borderRadius:8,marginBottom:6,cursor:"pointer",transition:"background .15s"},permTag:{display:"inline-block",padding:"2px 8px",borderRadius:4,fontSize:11,fontFamily:"'JetBrains Mono', monospace",marginRight:4,marginBottom:4},eventRow:{padding:"8px 12px",borderRadius:6,marginBottom:4,fontSize:13,lineHeight:1.5,display:"flex",gap:10,alignItems:"flex-start"},eventTime:{color:"#64748b",fontFamily:"'JetBrains Mono', monospace",fontSize:11,minWidth:44,marginTop:2}};function cEe(n){return n.includes("wallet")||n.includes("auth.modify")?"high":n.includes("write")||n.includes("state")||n.includes("bridge")?"medium":"low"}function dEe(){const[n,e]=b.useState(null),[t,s]=b.useState("all"),[i,r]=b.useState(!1),[o,l]=b.useState(rEe),[c,d]=b.useState(new Set),u=Math.round(o.reduce((x,y)=>x+y.score,0)/(o.length||1)),h=u>=80?"#10b981":u>=60?"#f59e0b":"#ef4444",p=b.useCallback(x=>e(y=>y===x?null:x),[]),f=t==="all"?ab:ab.filter(x=>x.type===t),g=b.useCallback(x=>{d(y=>new Set([...y,x])),console.log(` DEFEND:  Mdulo ${x} reportado  denncia registrada`)},[]),m=b.useCallback(x=>{l(y=>y.filter(S=>S.id!==x)),e(null),console.log(` DEFEND:  Mdulo ${x} desinstalado`)},[]);return a.jsxs("div",{style:Yt.container,children:[a.jsxs("div",{style:Yt.header,children:[a.jsx("span",{style:{fontSize:28},children:""}),a.jsx("h1",{style:Yt.title,children:"Panda Defend"})]}),a.jsx("p",{style:Yt.subtitle,children:"Monitoramento de segurana  mdulos instalados, permisses e atividade"}),a.jsx("div",{style:Yt.card,children:a.jsxs("div",{style:Yt.scoreBox,children:[a.jsxs("div",{style:{textAlign:"center"},children:[a.jsx("div",{style:{...Yt.scoreBig,color:h},children:u}),a.jsx("div",{style:{color:"#94a3b8",fontSize:13,marginTop:4},children:"DEFEND SCORE"})]}),a.jsxs("div",{style:{fontSize:13,lineHeight:1.8},children:[a.jsxs("div",{children:[" Aprovados:"," ",a.jsx("strong",{children:o.filter(x=>x.status==="approved").length})]}),a.jsxs("div",{children:[" Em reviso:"," ",a.jsx("strong",{children:o.filter(x=>x.status==="review").length})]}),a.jsxs("div",{children:[" Suspensos:"," ",a.jsx("strong",{children:o.filter(x=>x.status==="suspended").length})]}),a.jsx("div",{style:{color:"#64748b",marginTop:4,fontSize:11},children:"ltimo scan: hoje 12:34"})]})]})}),a.jsxs("div",{style:Yt.card,children:[a.jsxs("div",{style:Yt.sectionTitle,children:[a.jsx("span",{children:""})," Mdulos Instalados (",o.length,")"]}),o.map(x=>a.jsxs("div",{children:[a.jsxs("div",{style:{...Yt.moduleRow,background:n===x.id?"rgba(100,116,139,0.15)":"rgba(100,116,139,0.06)"},onClick:()=>p(x.id),children:[a.jsx("span",{style:{fontSize:20},children:x.icon}),a.jsxs("div",{style:{flex:1},children:[a.jsx("div",{style:{fontWeight:600,fontSize:14},children:x.name}),a.jsxs("div",{style:{color:"#64748b",fontSize:11},children:[x.id," "," ",x.type==="tentacle"?" Tentculo":" Mdulo"]})]}),a.jsxs("div",{style:{textAlign:"center",minWidth:48},children:[a.jsx("div",{style:{fontWeight:800,fontSize:18,color:x.score>=80?"#10b981":x.score>=60?"#f59e0b":"#ef4444"},children:x.score}),a.jsx("div",{style:{fontSize:9,color:"#64748b"},children:"SCORE"})]}),a.jsx("span",{style:{fontSize:11,padding:"3px 8px",borderRadius:4,background:`${vc[x.risk]}15`,color:vc[x.risk],border:`1px solid ${vc[x.risk]}30`},children:aEe[x.risk]}),a.jsx("span",{style:{fontSize:11,color:"#94a3b8"},children:lEe[x.status]}),a.jsx("span",{style:{fontSize:12,transform:n===x.id?"rotate(180deg)":"rotate(0)",transition:"transform .2s"},children:""})]}),n===x.id&&a.jsxs("div",{style:{padding:"12px 20px 16px 48px",borderBottom:"1px solid rgba(100,116,139,0.1)"},children:[a.jsx("div",{style:{fontSize:12,fontWeight:600,marginBottom:8,color:"#94a3b8"},children:"PERMISSES CONCEDIDAS:"}),a.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:2},children:x.permissions.map(y=>{const S=cEe(y);return a.jsx("span",{style:{...Yt.permTag,background:`${vc[S]}12`,color:vc[S],border:`1px solid ${vc[S]}25`},children:y},y)})}),a.jsxs("div",{style:{fontSize:11,color:"#64748b",marginTop:8},children:["ltimo scan: ",x.lastScan]}),x.type==="tentacle"&&a.jsxs("div",{style:{marginTop:8,padding:"8px 12px",borderRadius:6,background:"rgba(245,158,11,0.08)",border:"1px solid rgba(245,158,11,0.2)",fontSize:12,color:"#f59e0b"},children:[" ",a.jsx("strong",{children:"Tentculo"}),"  acessa APIs do sistema via Proxy SDK. Sandbox forte + permisses explcitas obrigatrias."]}),Bu[x.id]&&a.jsxs("div",{style:{marginTop:10},children:[a.jsx("div",{style:{fontSize:12,fontWeight:600,color:"#94a3b8",marginBottom:6},children:" SCORE BREAKDOWN:"}),Bu[x.id].bonus.map((y,S)=>a.jsxs("div",{style:{fontSize:11,color:"#10b981",paddingLeft:8},children:["+ ",y]},`b-${S}`)),Bu[x.id].penalty.map((y,S)=>a.jsxs("div",{style:{fontSize:11,color:"#ef4444",paddingLeft:8},children:[" ",y]},`p-${S}`)),Bu[x.id].bonus.length===0&&Bu[x.id].penalty.length===0&&a.jsx("div",{style:{fontSize:11,color:"#64748b",paddingLeft:8},children:"Nenhum detalhe disponvel"})]}),a.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[a.jsx("button",{onClick:y=>{y.stopPropagation(),g(x.id)},disabled:c.has(x.id),style:{padding:"5px 12px",borderRadius:6,fontSize:11,fontWeight:600,background:c.has(x.id)?"rgba(100,116,139,0.1)":"rgba(245,158,11,0.1)",color:c.has(x.id)?"#64748b":"#f59e0b",border:`1px solid ${c.has(x.id)?"rgba(100,116,139,0.2)":"rgba(245,158,11,0.25)"}`,cursor:c.has(x.id)?"default":"pointer"},children:c.has(x.id)?" Reportado":" Reportar"}),a.jsx("button",{onClick:y=>{y.stopPropagation(),window.confirm(`Desinstalar ${x.name}? Esta ao no pode ser desfeita.`)&&m(x.id)},style:{padding:"5px 12px",borderRadius:6,fontSize:11,fontWeight:600,background:"rgba(239,68,68,0.1)",color:"#ef4444",border:"1px solid rgba(239,68,68,0.25)",cursor:"pointer"},children:" Desinstalar"})]})]})]},x.id))]}),a.jsxs("div",{style:Yt.card,children:[a.jsxs("div",{style:{...Yt.sectionTitle,justifyContent:"space-between"},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{children:""})," Monitor de Atividade"]}),a.jsxs("select",{value:t,onChange:x=>s(x.target.value),style:{background:"rgba(100,116,139,0.15)",border:"1px solid rgba(100,116,139,0.2)",borderRadius:6,color:"var(--pf-text, #e2e8f0)",padding:"4px 8px",fontSize:11},children:[a.jsxs("option",{value:"all",children:["Todos (",ab.length,")"]}),a.jsx("option",{value:"block",children:" Bloqueios"}),a.jsx("option",{value:"warning",children:" Alertas"}),a.jsx("option",{value:"scan",children:" Scans"}),a.jsx("option",{value:"info",children:" Info"})]})]}),a.jsx("div",{style:{maxHeight:260,overflowY:"auto",background:"var(--pf-bg, rgba(0,0,0,0.2))",borderRadius:8,padding:8},children:f.map(x=>a.jsxs("div",{style:{...Yt.eventRow,background:x.type==="block"?"rgba(239,68,68,0.06)":x.type==="warning"?"rgba(245,158,11,0.06)":"transparent"},children:[a.jsx("span",{style:Yt.eventTime,children:x.time}),a.jsx("span",{children:x.msg})]},x.id))})]}),a.jsxs("div",{style:Yt.card,children:[a.jsxs("div",{style:{...Yt.sectionTitle,cursor:"pointer",justifyContent:"space-between"},onClick:()=>r(x=>!x),children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[a.jsx("span",{children:""})," 14 Regras de Ouro (Bloqueio Automtico)"]}),a.jsx("span",{style:{fontSize:12,transform:i?"rotate(180deg)":"rotate(0)",transition:"transform .2s"},children:""})]}),i&&a.jsxs("div",{style:{overflowX:"auto"},children:[a.jsxs("table",{style:{width:"100%",fontSize:12,borderCollapse:"collapse"},children:[a.jsx("thead",{children:a.jsxs("tr",{style:{borderBottom:"1px solid rgba(100,116,139,0.2)"},children:[a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"ID"}),a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Regra"}),a.jsx("th",{style:{textAlign:"left",padding:"4px 8px",color:"#94a3b8"},children:"Risco"})]})}),a.jsx("tbody",{children:oEe.map(x=>a.jsxs("tr",{style:{borderBottom:"1px solid rgba(100,116,139,0.08)"},children:[a.jsx("td",{style:{padding:"4px 8px",fontWeight:700,color:"#ef4444",fontFamily:"monospace"},children:x.id}),a.jsx("td",{style:{padding:"4px 8px"},children:x.rule}),a.jsx("td",{style:{padding:"4px 8px",fontSize:11,color:"#f59e0b"},children:x.risk})]},x.id))})]}),a.jsxs("div",{style:{fontSize:11,color:"#64748b",marginTop:8,padding:"0 8px"},children:["Ref: ",a.jsx("code",{style:{fontSize:10,background:"rgba(100,116,139,0.15)",padding:"1px 4px",borderRadius:3},children:"PF_SECURITY_REFERENCE.md 1.6.B"})]})]})]}),a.jsxs("div",{style:Yt.card,children:[a.jsxs("div",{style:Yt.sectionTitle,children:[a.jsx("span",{children:""})," Emergency Kill Switch"]}),a.jsx("div",{style:{fontSize:13,color:"var(--pf-text-muted, #94a3b8)",marginBottom:12},children:"Desliga TODOS os servios imediatamente. Requer PIN + assinatura Ed25519."}),a.jsx(Gz,{})]}),a.jsx("div",{style:{...Yt.card,background:"rgba(102,126,234,0.06)",border:"1px solid rgba(102,126,234,0.2)"},children:a.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start"},children:[a.jsx("span",{style:{fontSize:22},children:""}),a.jsxs("div",{style:{fontSize:13,lineHeight:1.6},children:[a.jsx("div",{style:{fontWeight:700,marginBottom:4,color:"var(--accent-color, #667eea)"},children:"Como funciona o Panda Defend"}),a.jsxs("div",{style:{color:"var(--pf-text-muted, #94a3b8)"},children:["O Panda Defend monitora todos os mdulos e tentculos instalados no seu ambiente. Cada extenso recebe um"," ",a.jsx("strong",{children:"Score de Segurana"})," (0-100) baseado em anlise esttica, permisses declaradas, e comportamento em sandbox.",a.jsx("br",{}),a.jsx("br",{}),a.jsx("strong",{children:"Score  70:"})," Aprovado automaticamente.",a.jsx("br",{}),a.jsx("strong",{children:"Score 50-69:"})," Requer reviso manual.",a.jsx("br",{}),a.jsxs("strong",{children:["Score ","<"," 50:"]})," Suspenso automaticamente.",a.jsx("br",{}),a.jsx("br",{}),"Extenses suspeitas so bloqueadas em tempo real. Voc sempre tem controle total para desinstalar qualquer mdulo."]})]})]})})]})}const lb=[{id:"welcome",icon:"",title:"WELCOME TO PANDA FABRICS",subtitle:"Your modular creation platform",content:"Panda Fabrics is your infinite workspace to create, publish, and monetize. Fully modular, fully connected.",visual:"/panda-icon.png"},{id:"powers",icon:"",title:"YOUR POWERS",subtitle:"Tools that grow with you",content:null,features:[{icon:"",name:"INFINITE CANVAS",desc:"Draw, design, and organize without limits"},{icon:"",name:"PANDA AI",desc:"5 AI models ready to help"},{icon:"",name:"TOOL DOCK",desc:"Everything accessible in one click"}]},{id:"store",icon:"",title:"THE MEDUSA STORE",subtitle:"Extension marketplace",content:"Install apps, tools, and plugins created by the community. Publish yours and earn automatic royalties via PAT tokens.",features:[{icon:"",name:"INSTALL",desc:"Ready-to-use apps"},{icon:"",name:"PUBLISH",desc:"Launch your creations"},{icon:"",name:"MONETIZE",desc:"Automatic royalties"}]},{id:"start",icon:"",title:"GET STARTED",subtitle:"Choose where to begin",content:null}];function uEe({onComplete:n,onOpenStore:e}){const[t,s]=b.useState(0),[i,r]=b.useState(!1),[o,l]=b.useState("forward"),c=lb[t],d=t===lb.length-1,u=t===0,h=b.useCallback(()=>{d||(l("forward"),s(x=>x+1))},[d]),p=b.useCallback(()=>{u||(l("back"),s(x=>x-1))},[u]),f=b.useCallback(x=>{r(!0),localStorage.setItem("panda_onboarding_complete","true"),setTimeout(()=>{n&&n(x)},400)},[n]),g=b.useCallback(()=>{f("skip")},[f]),m=b.useCallback(x=>{x.key==="ArrowRight"||x.key==="Enter"?d||h():x.key==="ArrowLeft"?u||p():x.key==="Escape"&&g()},[h,p,g,d,u]);return a.jsxs("div",{className:`pf-wizard-overlay ${i?"pf-wizard-exit":""}`,role:"dialog","aria-modal":"true","aria-label":"Welcome wizard",onKeyDown:m,children:[a.jsx("div",{className:"pf-wizard-backdrop"}),a.jsxs("div",{className:"pf-wizard-container",children:[a.jsx("button",{className:"pf-wizard-close-btn",onClick:g,"aria-label":"Close wizard",title:"Close",children:""}),a.jsxs("div",{className:`pf-wizard-step ${o}`,children:[c.id==="welcome"&&a.jsxs("div",{className:"pf-wizard-welcome",children:[a.jsx("img",{src:c.visual,alt:"Panda Fabrics",className:"pf-wizard-logo"}),a.jsx("h2",{className:"pf-wizard-title",children:c.title}),a.jsx("p",{className:"pf-wizard-subtitle",children:c.subtitle}),a.jsx("p",{className:"pf-wizard-text",children:c.content})]}),c.features&&c.id!=="start"&&a.jsxs("div",{className:"pf-wizard-features-step",children:[a.jsx("div",{className:"pf-wizard-step-icon",children:c.icon}),a.jsx("h2",{className:"pf-wizard-title",children:c.title}),a.jsx("p",{className:"pf-wizard-subtitle",children:c.subtitle}),c.content&&a.jsx("p",{className:"pf-wizard-text",children:c.content}),a.jsx("div",{className:"pf-wizard-features",children:c.features.map(x=>a.jsxs("div",{className:"pf-wizard-feature-card",children:[a.jsx("span",{className:"pf-wizard-feature-icon",children:x.icon}),a.jsx("strong",{className:"pf-wizard-feature-name",children:x.name}),a.jsx("span",{className:"pf-wizard-feature-desc",children:x.desc})]},x.name))})]}),c.id==="start"&&a.jsxs("div",{className:"pf-wizard-cta-step",children:[a.jsx("div",{className:"pf-wizard-step-icon",children:c.icon}),a.jsx("h2",{className:"pf-wizard-title",children:c.title}),a.jsx("p",{className:"pf-wizard-subtitle",children:c.subtitle}),a.jsxs("div",{className:"pf-wizard-cta-cards",children:[a.jsxs("button",{className:"pf-wizard-cta-card",onClick:()=>f("draw"),"aria-label":"Create first project",children:[a.jsx("span",{className:"pf-wizard-cta-icon",children:""}),a.jsx("strong",{children:"CREATE FIRST PROJECT"}),a.jsx("span",{className:"pf-wizard-cta-desc",children:"Open the canvas and start drawing"})]}),a.jsxs("button",{className:"pf-wizard-cta-card",onClick:()=>{f("store"),e&&e()},"aria-label":"Explore the Store",children:[a.jsx("span",{className:"pf-wizard-cta-icon",children:""}),a.jsx("strong",{children:"EXPLORE THE STORE"}),a.jsx("span",{className:"pf-wizard-cta-desc",children:"Discover ready-made apps and tools"})]}),a.jsxs("button",{className:"pf-wizard-cta-card",onClick:()=>f("chat"),"aria-label":"Chat with AI",children:[a.jsx("span",{className:"pf-wizard-cta-icon",children:""}),a.jsx("strong",{children:"CHAT WITH AI"}),a.jsx("span",{className:"pf-wizard-cta-desc",children:"Ask for help or get inspired"})]})]})]})]},c.id),a.jsx("div",{className:"pf-wizard-dots",role:"tablist","aria-label":"Wizard steps",children:lb.map((x,y)=>a.jsx("button",{className:`pf-wizard-dot ${y===t?"active":""} ${y<t?"completed":""}`,onClick:()=>{l(y>t?"forward":"back"),s(y)},role:"tab","aria-selected":y===t,"aria-label":`Step ${y+1}: ${x.title}`},x.id))}),a.jsxs("div",{className:"pf-wizard-nav",children:[a.jsx("button",{className:"pf-wizard-skip-btn",onClick:g,"aria-label":d?"Close wizard":"Skip introduction",children:d?"CLOSE":"SKIP"}),a.jsxs("div",{className:"pf-wizard-nav-right",children:[!u&&a.jsx("button",{className:"pf-wizard-back-btn",onClick:p,"aria-label":"Back",children:" BACK"}),d?a.jsx("button",{className:"pf-wizard-finish-btn",onClick:()=>f("finish"),"aria-label":"Finish and close wizard",children:"FINISH "}):a.jsx("button",{className:"pf-wizard-next-btn",onClick:h,"aria-label":"Next",children:"NEXT "})]})]})]})]})}const cb={required:["name","version","description","author","permissions"],fields:{name:{pattern:/^[a-z0-9-]+$/},version:{pattern:/^\d+\.\d+\.\d+$/},permissions:{items:["network","storage","clipboard","notifications","geolocation"]}}},_R={name:"my-plugin",version:"1.0.0",description:"Descrio do meu plugin",author:"Seu Nome",homepage:"https://github.com/user/repo",license:"MIT",permissions:[],files:{main:"index.js",styles:"styles.css"},keywords:["panda","plugin"],priceUSD:0};function hEe({onSave:n,onClose:e,initialManifest:t=null}){const[s,i]=b.useState(t||_R),[r,o]=b.useState([]),[l,c]=b.useState([]),[d,u]=b.useState(!1),[h,p]=b.useState("");b.useEffect(()=>{var I,E;const v=[],C=[];for(const P of cb.required)s[P]||v.push(`Campo obrigatrio ausente: ${P}`);const{fields:T}=cb;s.name&&!T.name.pattern.test(s.name)&&v.push("Nome invlido: use apenas letras minsculas, nmeros e hfens"),s.version&&!T.version.pattern.test(s.version)&&v.push("Verso invlida: use formato X.Y.Z (ex: 1.0.0)"),s.description&&(s.description.length<10&&v.push("Descrio muito curta (mnimo 10 caracteres)"),s.description.length>200&&v.push("Descrio muito longa (mximo 200 caracteres)")),s.homepage||C.push("Recomendado: adicionar homepage"),s.license||C.push("Recomendado: especificar licena"),(I=s.permissions)!=null&&I.includes("network")&&!((E=s.permissions)!=null&&E.includes("storage"))&&C.push('Permisso "network" sem "storage" pode limitar funcionalidade'),o(v),c(C)},[s]),b.useEffect(()=>{p(JSON.stringify(s,null,2))},[s]);const f=(v,C)=>{i(T=>({...T,[v]:C}))},g=v=>{const C=s.permissions||[],T=C.includes(v)?C.filter(I=>I!==v):[...C,v];f("permissions",T)},m=v=>{p(v.target.value);try{const C=JSON.parse(v.target.value);i(C)}catch(C){o(T=>[...T.filter(I=>!I.includes("JSON invlido")),"JSON invlido: "+C.message])}},x=()=>{if(r.length>0){alert("Corrija os erros antes de salvar");return}n&&n(s)},y=()=>{confirm("Resetar para o template padro?")&&i(_R)},S=r.length===0;return a.jsx("div",{className:"manifest-editor-overlay",onClick:e,children:a.jsxs("div",{className:"manifest-editor",onClick:v=>v.stopPropagation(),children:[a.jsxs("header",{className:"editor-header",children:[a.jsx("h2",{children:" Plugin Manifest Editor"}),a.jsxs("div",{className:"header-actions",children:[a.jsx("button",{className:`toggle-view ${d?"active":""}`,onClick:()=>u(!d),children:d?" Form":"{ } JSON"}),a.jsx("button",{className:"btn-close",onClick:e,children:""})]})]}),a.jsxs("div",{className:`validation-status ${S?"valid":"invalid"}`,children:[a.jsx("span",{className:"status-icon",children:S?"":""}),a.jsx("span",{className:"status-text",children:S?"Manifest vlido":`${r.length} erro(s) encontrado(s)`})]}),a.jsxs("div",{className:"editor-content",children:[d?a.jsx("div",{className:"json-editor",children:a.jsx("textarea",{value:h,onChange:m,spellCheck:!1})}):a.jsxs("div",{className:"form-editor",children:[a.jsxs("section",{className:"form-section",children:[a.jsx("h3",{children:" Informaes Bsicas"}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Nome do Plugin *"}),a.jsx("input",{type:"text",value:s.name||"",onChange:v=>f("name",v.target.value),placeholder:"my-plugin"}),a.jsx("span",{className:"hint",children:"Letras minsculas, nmeros e hfens"})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Verso *"}),a.jsx("input",{type:"text",value:s.version||"",onChange:v=>f("version",v.target.value),placeholder:"1.0.0"})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Descrio *"}),a.jsx("textarea",{value:s.description||"",onChange:v=>f("description",v.target.value),placeholder:"O que seu plugin faz?",rows:2}),a.jsxs("span",{className:"char-count",children:[(s.description||"").length,"/200"]})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Autor *"}),a.jsx("input",{type:"text",value:s.author||"",onChange:v=>f("author",v.target.value),placeholder:"Seu Nome"})]})]}),a.jsxs("section",{className:"form-section",children:[a.jsx("h3",{children:" Permisses"}),a.jsx("p",{className:"section-desc",children:"Selecione as permisses que seu plugin precisa"}),a.jsx("div",{className:"permissions-grid",children:cb.fields.permissions.items.map(v=>a.jsxs("label",{className:"permission-item",children:[a.jsx("input",{type:"checkbox",checked:(s.permissions||[]).includes(v),onChange:()=>g(v)}),a.jsxs("span",{className:"perm-icon",children:[v==="network"&&"",v==="storage"&&"",v==="clipboard"&&"",v==="notifications"&&"",v==="geolocation"&&""]}),a.jsx("span",{className:"perm-name",children:v})]},v))})]}),a.jsxs("section",{className:"form-section",children:[a.jsx("h3",{children:" Preo (USD)"}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Preo em USD (0 = Grtis)"}),a.jsx("input",{type:"number",value:s.priceUSD||0,onChange:v=>f("priceUSD",parseFloat(v.target.value)||0),min:0,max:9999,step:.01})]})]}),a.jsxs("section",{className:"form-section",children:[a.jsx("h3",{children:" Opcional"}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Homepage"}),a.jsx("input",{type:"url",value:s.homepage||"",onChange:v=>f("homepage",v.target.value),placeholder:"https://github.com/user/repo"})]}),a.jsxs("div",{className:"form-row",children:[a.jsx("label",{children:"Licena"}),a.jsxs("select",{value:s.license||"",onChange:v=>f("license",v.target.value),children:[a.jsx("option",{value:"",children:"Selecione..."}),a.jsx("option",{value:"MIT",children:"MIT"}),a.jsx("option",{value:"Apache-2.0",children:"Apache 2.0"}),a.jsx("option",{value:"GPL-3.0",children:"GPL 3.0"}),a.jsx("option",{value:"BSD-3-Clause",children:"BSD 3-Clause"}),a.jsx("option",{value:"Proprietary",children:"Proprietria"})]})]})]})]}),(r.length>0||l.length>0)&&a.jsxs("div",{className:"validation-messages",children:[r.map((v,C)=>a.jsxs("div",{className:"msg error",children:[" ",v]},C)),l.map((v,C)=>a.jsxs("div",{className:"msg warning",children:[" ",v]},C))]})]}),a.jsxs("footer",{className:"editor-footer",children:[a.jsx("button",{className:"btn-reset",onClick:y,children:" Reset"}),a.jsxs("div",{className:"footer-right",children:[a.jsx("button",{className:"btn-cancel",onClick:e,children:"Cancelar"}),a.jsx("button",{className:"btn-save",onClick:x,disabled:!S,children:" Salvar Manifest"})]})]})]})})}function pEe({onToggleDevTools:n,onToggleChat:e,onOpenSettings:t,onOpenStore:s,onEscape:i}){const r=b.useCallback(o=>{const l=o.target.tagName;if(!(l==="INPUT"||l==="TEXTAREA"||l==="SELECT")&&!o.target.isContentEditable){if(o.ctrlKey||o.metaKey){switch(o.key.toLowerCase()){case"d":o.preventDefault(),n==null||n();break;case"/":o.preventDefault(),e==null||e();break;case",":o.preventDefault(),t==null||t();break;case"k":o.preventDefault(),s==null||s();break}return}o.key==="Escape"&&(i==null||i())}},[n,e,t,s,i]);b.useEffect(()=>(window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)),[r])}function fEe(){const[n,e]=b.useState(!1),[t,s]=b.useState(!1),[i,r]=b.useState(!1),[o,l]=b.useState(!1),[c,d]=b.useState([]),[u,h]=b.useState(!1),[p,f]=b.useState(!0),[g,m]=b.useState(!1),[x,y]=b.useState(!1),[S,v]=b.useState(()=>!localStorage.getItem("panda_onboarding_complete")),{isFounder:C}=Yx();pEe({onToggleDevTools:()=>{h(R=>{const A=!R;return A&&ji("devtools"),A})},onToggleChat:()=>window.dispatchEvent(new CustomEvent("panda:chat-toggle-internal")),onOpenSettings:()=>r(!0),onOpenStore:()=>e(!0),onEscape:()=>{r(!1),e(!1),s(!1),m(!1),y(!1)}}),b.useEffect(()=>{const R=()=>e(!0),A=()=>{window.dispatchEvent(new CustomEvent("panda:chat-toggle-internal"))},N=()=>y(!0);return window.addEventListener("panda:open-store",R),window.addEventListener("panda:toggle-chat",A),window.addEventListener("panda:open-gasometer",N),()=>{window.removeEventListener("panda:open-store",R),window.removeEventListener("panda:toggle-chat",A),window.removeEventListener("panda:open-gasometer",N)}},[]);const T=R=>{c.some(A=>A.id===R.id)||(d([...c,R]),e(!1))},I=R=>{Ng(R),d(c.filter(A=>A.id!==R))},E=R=>{ji(R.id,{name:R.name,icon:R.icon})},P=R=>{Ng(R)},k=(R,A)=>{ji(R,A),s(!1)},j=b.useCallback((R,A)=>{const N=()=>Ng(R);switch(R){case"founder-dashboard":return a.jsx(uCe,{});case"pat-council":return a.jsx(_Ce,{isOpen:!0,onClose:N,activeTool:(A==null?void 0:A.activeTool)||"treasury",embedded:!0});case"devtools":return a.jsx(SCe,{isOpen:!0,onClose:N,embedded:!0});case"settings":return a.jsx(pR,{isOpen:!0,onClose:N,embedded:!0});case"store":return a.jsx(aR,{onClose:N,onInstall:T,embedded:!0});case"catalog":return a.jsx(lR,{isOpen:!0,onClose:N,plugins:c,onPluginUninstall:I,onOpenApp:k,embedded:!0});default:{const B=()=>Ng(R);return R==="bundle-creator"?a.jsx(nEe,{onClose:B,embedded:!0}):R==="finance-panel"?a.jsx(Vz,{onClose:B,embedded:!0}):R==="gasometer"?a.jsx(wR,{onClose:B,embedded:!0}):R==="mining-panel"?a.jsx(iEe,{embedded:!0}):R==="defend-panel"?a.jsx(dEe,{}):R==="plugin-editor"?a.jsx(hEe,{onClose:B,onSave:L=>console.log(" Manifest saved:",L)}):a.jsxs("div",{style:{padding:20,color:"#aaa"},children:[" ",(A==null?void 0:A.name)||R,"  COMING SOON"]})}}},[c]),D=a.jsx(gye,{plugins:c});return a.jsxs("div",{className:"pf-container",children:[a.jsx("a",{className:"pf-skip-link",href:"#pf-main-content",children:"Skip to main content"}),S&&a.jsx(uEe,{onComplete:R=>{v(!1),R==="store"&&e(!0),R==="chat"&&window.dispatchEvent(new CustomEvent("panda:toggle-chat"))},onOpenStore:()=>e(!0)}),a.jsx(__e,{onStoreClick:()=>e(!0),onSettingsClick:()=>{r(!0),l(!1)},onNotificationsClick:()=>m(!0),onFounderClick:C?()=>ji("founder-dashboard"):void 0,onMiningClick:()=>ji("mining-panel"),onDefendClick:()=>ji("defend-panel"),onTreasuryClick:()=>ji("pat-council",{activeTool:"treasury"}),onPinChange:f,isFounder:C}),a.jsx("main",{className:"pf-main",id:"pf-main-content",role:"main",children:a.jsx(tEe,{canvasComponent:D,componentFactory:j})}),a.jsx(mye,{onCatalogClick:()=>s(!0),onToolsClick:()=>{const R=!o;l(R),R&&r(!1)},onStoreClick:()=>e(!0),onSettingsClick:()=>r(!0),onFinanceClick:()=>ji("finance-panel"),onGasometerClick:()=>ji("gasometer"),onCouncilClick:()=>ji("pat-council"),onDevModeToggle:R=>{h(R),R&&ji("devtools")},onPluginOpen:E,onPluginClose:P,onPluginUninstall:I,plugins:c,devMode:u,isFounder:C}),a.jsx(q_e,{isOpen:o,onClose:()=>l(!1)}),a.jsx(Y_e,{}),a.jsx(pR,{isOpen:i,onClose:()=>r(!1)}),a.jsx(lR,{isOpen:t,onClose:()=>s(!1),plugins:c,onPluginUninstall:I,onOpenApp:k}),n&&a.jsx(aR,{onClose:()=>e(!1),onInstall:T}),a.jsx(Q_e,{isOpen:g,onClose:()=>m(!1)}),x&&a.jsx(wR,{onClose:()=>y(!1)}),a.jsxs("footer",{className:"pf-footer",children:[a.jsx("span",{className:"pf-footer-accent"}),"PANDA FABRICS",a.jsx("span",{className:"pf-footer-accent"}),"POWERED BY TLDRAW   MEDUSA",a.jsxs("span",{className:"pf-footer-version",children:["v6.6  ",new Date().getFullYear()]})]})]})}function gEe(){return a.jsx(Wye,{children:a.jsx(b_e,{children:a.jsx(nCe,{children:a.jsx(fEe,{})})})})}Ab.createRoot(document.getElementById("root")).render(a.jsx(Oe.StrictMode,{children:a.jsx(gEe,{})}));
